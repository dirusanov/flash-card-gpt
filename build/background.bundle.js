(()=>{const e="anki_view_prefs_v1";function t(e){if(!e||null==e.id)return;const t=e.url||"";t.startsWith("http://")||t.startsWith("https://")?(chrome.action.setPopup({tabId:e.id,popup:""}),chrome.action.setTitle({tabId:e.id,title:"Toggle Sidebar / Floating"})):(chrome.action.setPopup({tabId:e.id,popup:"popup.html"}),chrome.action.setTitle({tabId:e.id,title:"\u0420\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435 \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u043d\u043e \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435"}))}chrome.tabs.onActivated.addListener((({tabId:e})=>chrome.tabs.get(e,t))),chrome.tabs.onUpdated.addListener(((e,a,r)=>{r&&r.active&&("complete"===a.status||a.url)&&t(r)})),chrome.runtime.onInstalled.addListener((()=>{chrome.tabs.query({currentWindow:!0,active:!0},(e=>e[0]&&t(e[0])))})),chrome.action.onClicked.addListener((async t=>{if(!t||null==t.id)return;const a=t.id,r=await new Promise((t=>{try{chrome.storage.local.get([e],(a=>{t(a[e]||{preferredModeByTab:{},visibleByTab:{}})}))}catch(e){t({preferredModeByTab:{},visibleByTab:{}})}}));"float"===(r.preferredModeByTab&&r.preferredModeByTab[a]||"sidebar")?chrome.tabs.sendMessage(a,{action:"showFloating",tabId:a}):chrome.tabs.sendMessage(a,{action:"toggleSidebar",tabId:a})})),chrome.runtime.onMessage.addListener(((e,t,a)=>"string"==typeof e&&e.startsWith("http")?(fetch(e,{method:"GET"}).then((e=>e.blob())).then((e=>new Promise(((t,a)=>{const r=new FileReader;r.onloadend=()=>t(r.result),r.onerror=a,r.readAsDataURL(e)})))).then((e=>a({status:!0,data:e}))).catch((e=>a({status:!1,error:String(e)}))),!0):e&&"getTabId"===e.action?(a({tabId:t.tab?t.tab.id:null}),!0):void 0))})();