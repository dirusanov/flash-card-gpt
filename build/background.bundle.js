console.log("I am background script"),chrome.action.onClicked.addListener((e=>{e&&null!=e.id&&chrome.tabs.sendMessage(e.id,{action:"togglePreferredUI",tabId:e.id},(e=>{chrome.runtime.lastError?console.error("togglePreferredUI error:",chrome.runtime.lastError.message):console.log("togglePreferredUI response:",e)}))})),chrome.runtime.onMessage.addListener(((e,r,t)=>{try{if("string"==typeof e&&e.startsWith("http"))return fetch(e,{method:"GET"}).then((e=>e.blob())).then((e=>{const r=new FileReader;r.onloadend=()=>t({status:!0,data:r.result}),r.onerror=e=>t({status:!1,error:String(e)}),r.readAsDataURL(e)})).catch((e=>t({status:!1,error:String(e)}))),!0;if(e&&"getTabId"===e.action)return t({tabId:r?.tab?.id??null}),!0;const o=o=>{if(!e||!e.action||!o.includes(e.action))return!1;const a=r?.tab?.id??e.tabId;return null==a?(t?.({status:!1,error:"No target tabId"}),!0):(chrome.tabs.sendMessage(a,{...e,tabId:a},(e=>{chrome.runtime.lastError?t?.({status:!1,error:chrome.runtime.lastError.message}):t?.(e||{ok:!0})})),!0)};if(o(["togglePreferredUI","toggleSidebar","forceHideSidebar","forceShowSidebar","collapseSidebar","expandSidebar","showFloating","hideFloating","toggleFloating","syncFloatingState","setPreferredMode"]))return!0;if(o(["toggleSidebar","forceHideSidebar","forceShowSidebar","collapseSidebar","expandSidebar"]))return!0;if(o(["showFloating","hideFloating","toggleFloating","syncFloatingState"]))return!0;if(o(["setPreferredMode"]))return!0}catch(e){console.error("onMessage handler error:",e);try{t?.({status:!1,error:String(e)})}catch{}}return!1})),console.log("Background script has been loaded.");