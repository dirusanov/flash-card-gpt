(()=>{console.log("I am background script");const e=e=>{if(!e||void 0===e.id)return;const r=e.url||"";r.startsWith("http://")||r.startsWith("https://")?(chrome.action.setPopup({tabId:e.id,popup:""}),chrome.action.setTitle({tabId:e.id,title:"Toggle Sidebar"})):(chrome.action.setPopup({tabId:e.id,popup:"popup.html"}),chrome.action.setTitle({tabId:e.id,title:"\u0420\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435 \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u043d\u043e \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435"}))},r=()=>{chrome.tabs.query({currentWindow:!0,active:!0},(r=>{if(chrome.runtime.lastError)return void console.error("Error querying tabs:",chrome.runtime.lastError.message);const[t]=r;e(t)}))};chrome.tabs.onActivated.addListener((({tabId:r})=>{chrome.tabs.get(r,(r=>{chrome.runtime.lastError?console.error("Error getting tab on activation:",chrome.runtime.lastError.message):e(r)}))})),chrome.tabs.onUpdated.addListener(((r,t,o)=>{o&&o.active&&("complete"===t.status||t.url)&&e(o)})),chrome.runtime.onInstalled.addListener((()=>{r()})),r(),chrome.runtime.onMessage.addListener(((e,r,t)=>{if(console.log("Message received:",e),"string"==typeof e&&e.startsWith("http"))return fetch(e,{method:"GET"}).then((e=>e.blob())).then((e=>{console.log("Blob fetched successfully.");const r=new FileReader;r.onloadend=()=>{console.log("Blob read successfully."),t({status:!0,data:r.result})},r.onerror=e=>{console.error("Error occurred while reading blob:",e),t({status:!1,error:e.toString()})},r.readAsDataURL(e)})).catch((e=>{console.error("Error occurred while fetching image:",e),t({status:!1,error:e.toString()})})),!0;if("getTabId"===e.action){const e=r.tab?r.tab.id:null;return console.log("Returning tab ID:",e),t({tabId:e}),!0}})),console.log("Background script has been loaded."),chrome.action.onClicked.addListener((e=>{console.log("Extension icon clicked. Sending message to content script..."),chrome.tabs.sendMessage(e.id,{action:"toggleSidebar",tabId:e.id},(e=>{chrome.runtime.lastError?console.error("Error sending message:",chrome.runtime.lastError.message):console.log("Response from content script:",e)}))})),chrome.runtime.onMessage.addListener(((e,r,t)=>{if("toggleSidebar"===e.action){const e=r.tab?r.tab.id:null;return chrome.tabs.sendMessage(r.tab.id,{action:"toggleSidebar",tabId:e},(e=>{chrome.runtime.lastError?(console.error("Error sending message:",chrome.runtime.lastError.message),t({status:!1,error:chrome.runtime.lastError.message})):t({status:!0,response:e})})),!0}}))})();