(()=>{"use strict";var e={146:(e,t,n)=>{var r=n(363),o={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},a={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},i={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};function l(e){return r.isMemo(e)?i:s[e.$$typeof]||o}s[r.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},s[r.Memo]=i;var c=Object.defineProperty,u=Object.getOwnPropertyNames,d=Object.getOwnPropertySymbols,p=Object.getOwnPropertyDescriptor,h=Object.getPrototypeOf,f=Object.prototype;e.exports=function e(t,n,r){if("string"!=typeof n){if(f){var o=h(n);o&&o!==f&&e(t,o,r)}var i=u(n);d&&(i=i.concat(d(n)));for(var s=l(t),g=l(n),m=0;m<i.length;++m){var y=i[m];if(!(a[y]||r&&r[y]||g&&g[y]||s&&s[y])){var v=p(n,y);try{c(t,y,v)}catch(e){}}}}return t}},551:(e,t,n)=>{
/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var r=n(540),o=n(982);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,s={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(s[e]=t,e=0;e<t.length;e++)i.add(t[e])}var u=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),d=Object.prototype.hasOwnProperty,p=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,h={},f={};function g(e,t,n,r,o,a,i){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=i}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){m[e]=new g(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];m[t]=new g(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){m[e]=new g(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){m[e]=new g(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){m[e]=new g(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){m[e]=new g(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){m[e]=new g(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){m[e]=new g(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){m[e]=new g(e,5,!1,e.toLowerCase(),null,!1,!1)}));var y=/[\-:]([a-z])/g;function v(e){return e[1].toUpperCase()}function b(e,t,n,r){var o=m.hasOwnProperty(t)?m[t]:null;(null!==o?0!==o.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null==t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,o,r)&&(n=null),r||null===o?function(e){return!!d.call(f,e)||!d.call(h,e)&&(p.test(e)?f[e]=!0:(h[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):o.mustUseProperty?e[o.propertyName]=null===n?3!==o.type&&"":n:(t=o.attributeName,r=o.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(o=o.type)||4===o&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(y,v);m[t]=new g(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(y,v);m[t]=new g(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(y,v);m[t]=new g(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){m[e]=new g(e,1,!1,e.toLowerCase(),null,!1,!1)})),m.xlinkHref=new g("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){m[e]=new g(e,1,!1,e.toLowerCase(),null,!0,!0)}));var x=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for("react.element"),S=Symbol.for("react.portal"),k=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),A=Symbol.for("react.provider"),I=Symbol.for("react.context"),T=Symbol.for("react.forward_ref"),M=Symbol.for("react.suspense"),F=Symbol.for("react.suspense_list"),z=Symbol.for("react.memo"),_=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var R=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var j=Symbol.iterator;function B(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=j&&e[j]||e["@@iterator"])?e:null}var O,N=Object.assign;function P(e){if(void 0===O)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);O=t&&t[1]||""}return"\n"+O+e}var L=!1;function D(e,t){if(!e||L)return"";L=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(e){var r=e}Reflect.construct(e,[],t)}else{try{t.call()}catch(e){r=e}e.call(t.prototype)}else{try{throw Error()}catch(e){r=e}e()}}catch(t){if(t&&r&&"string"==typeof t.stack){for(var o=t.stack.split("\n"),a=r.stack.split("\n"),i=o.length-1,s=a.length-1;1<=i&&0<=s&&o[i]!==a[s];)s--;for(;1<=i&&0<=s;i--,s--)if(o[i]!==a[s]){if(1!==i||1!==s)do{if(i--,0>--s||o[i]!==a[s]){var l="\n"+o[i].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=i&&0<=s);break}}}finally{L=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?P(e):""}function $(e){switch(e.tag){case 5:return P(e.type);case 16:return P("Lazy");case 13:return P("Suspense");case 19:return P("SuspenseList");case 0:case 2:case 15:return e=D(e.type,!1);case 11:return e=D(e.type.render,!1);case 1:return e=D(e.type,!0);default:return""}}function q(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case k:return"Fragment";case S:return"Portal";case E:return"Profiler";case C:return"StrictMode";case M:return"Suspense";case F:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case I:return(e.displayName||"Context")+".Consumer";case A:return(e._context.displayName||"Context")+".Provider";case T:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case z:return null!==(t=e.displayName||null)?t:q(e.type)||"Memo";case _:t=e._payload,e=e._init;try{return q(e(t))}catch(e){}}return null}function U(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return q(t);case 8:return t===C?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t}return null}function V(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function H(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function W(e){e._valueTracker||(e._valueTracker=function(e){var t=H(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var o=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function G(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=H(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function Y(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function X(e,t){var n=t.checked;return N({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function K(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=V(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Q(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function J(e,t){Q(e,t);var n=V(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,V(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&Y(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var o=0;o<n.length;o++)t["$"+n[o]]=!0;for(n=0;n<e.length;n++)o=t.hasOwnProperty("$"+e[n].value),e[n].selected!==o&&(e[n].selected=o),o&&r&&(e[n].defaultSelected=!0)}else{for(n=""+V(n),t=null,o=0;o<e.length;o++){if(e[o].value===n)return e[o].selected=!0,void(r&&(e[o].defaultSelected=!0));null!==t||e[o].disabled||(t=e[o])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return N({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function oe(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(a(92));if(te(n)){if(1<n.length)throw Error(a(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:V(n)}}function ae(e,t){var n=V(t.value),r=V(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function ie(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,de=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return ue(e,t)}))}:ue);function pe(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var he={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fe=["Webkit","ms","Moz","O"];function ge(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||he.hasOwnProperty(e)&&he[e]?(""+t).trim():t+"px"}function me(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),o=ge(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,o):e[n]=o}}Object.keys(he).forEach((function(e){fe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),he[t]=he[e]}))}));var ye=N({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ve(e,t){if(t){if(ye[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(a(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xe=null;function we(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Se=null,ke=null,Ce=null;function Ee(e){if(e=xo(e)){if("function"!=typeof Se)throw Error(a(280));var t=e.stateNode;t&&(t=So(t),Se(e.stateNode,e.type,t))}}function Ae(e){ke?Ce?Ce.push(e):Ce=[e]:ke=e}function Ie(){if(ke){var e=ke,t=Ce;if(Ce=ke=null,Ee(e),t)for(e=0;e<t.length;e++)Ee(t[e])}}function Te(e,t){return e(t)}function Me(){}var Fe=!1;function ze(e,t,n){if(Fe)return e(t,n);Fe=!0;try{return Te(e,t,n)}finally{Fe=!1,(null!==ke||null!==Ce)&&(Me(),Ie())}}function _e(e,t){var n=e.stateNode;if(null===n)return null;var r=So(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(a(231,t,typeof n));return n}var Re=!1;if(u)try{var je={};Object.defineProperty(je,"passive",{get:function(){Re=!0}}),window.addEventListener("test",je,je),window.removeEventListener("test",je,je)}catch(ue){Re=!1}function Be(e,t,n,r,o,a,i,s,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(e){this.onError(e)}}var Oe=!1,Ne=null,Pe=!1,Le=null,De={onError:function(e){Oe=!0,Ne=e}};function $e(e,t,n,r,o,a,i,s,l){Oe=!1,Ne=null,Be.apply(De,arguments)}function qe(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ue(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ve(e){if(qe(e)!==e)throw Error(a(188))}function He(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=qe(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,r=t;;){var o=n.return;if(null===o)break;var i=o.alternate;if(null===i){if(null!==(r=o.return)){n=r;continue}break}if(o.child===i.child){for(i=o.child;i;){if(i===n)return Ve(o),e;if(i===r)return Ve(o),t;i=i.sibling}throw Error(a(188))}if(n.return!==r.return)n=o,r=i;else{for(var s=!1,l=o.child;l;){if(l===n){s=!0,n=o,r=i;break}if(l===r){s=!0,r=o,n=i;break}l=l.sibling}if(!s){for(l=i.child;l;){if(l===n){s=!0,n=i,r=o;break}if(l===r){s=!0,r=i,n=o;break}l=l.sibling}if(!s)throw Error(a(189))}}if(n.alternate!==r)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(e))?We(e):null}function We(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=We(e);if(null!==t)return t;e=e.sibling}return null}var Ge=o.unstable_scheduleCallback,Ye=o.unstable_cancelCallback,Xe=o.unstable_shouldYield,Ke=o.unstable_requestPaint,Qe=o.unstable_now,Je=o.unstable_getCurrentPriorityLevel,Ze=o.unstable_ImmediatePriority,et=o.unstable_UserBlockingPriority,tt=o.unstable_NormalPriority,nt=o.unstable_LowPriority,rt=o.unstable_IdlePriority,ot=null,at=null;var it=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(st(e)/lt|0)|0},st=Math.log,lt=Math.LN2;var ct=64,ut=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function pt(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,o=e.suspendedLanes,a=e.pingedLanes,i=268435455&n;if(0!==i){var s=i&~o;0!==s?r=dt(s):0!==(a&=i)&&(r=dt(a))}else 0!==(i=n&~o)?r=dt(i):0!==a&&(r=dt(a));if(0===r)return 0;if(0!==t&&t!==r&&!(t&o)&&((o=r&-r)>=(a=t&-t)||16===o&&4194240&a))return t;if(4&r&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)o=1<<(n=31-it(t)),r|=e[n],t&=~o;return r}function ht(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ft(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function gt(){var e=ct;return!(4194240&(ct<<=1))&&(ct=64),e}function mt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function yt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-it(t)]=n}function vt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-it(n),o=1<<r;o&t|e[r]&t&&(e[r]|=t),n&=~o}}var bt=0;function xt(e){return 1<(e&=-e)?4<e?268435455&e?16:536870912:4:1}var wt,St,kt,Ct,Et,At=!1,It=[],Tt=null,Mt=null,Ft=null,zt=new Map,_t=new Map,Rt=[],jt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Bt(e,t){switch(e){case"focusin":case"focusout":Tt=null;break;case"dragenter":case"dragleave":Mt=null;break;case"mouseover":case"mouseout":Ft=null;break;case"pointerover":case"pointerout":zt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":_t.delete(t.pointerId)}}function Ot(e,t,n,r,o,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[o]},null!==t&&(null!==(t=xo(t))&&St(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==o&&-1===t.indexOf(o)&&t.push(o),e)}function Nt(e){var t=bo(e.target);if(null!==t){var n=qe(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ue(n)))return e.blockedOn=t,void Et(e.priority,(function(){kt(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Pt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Xt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=xo(n))&&St(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);xe=r,n.target.dispatchEvent(r),xe=null,t.shift()}return!0}function Lt(e,t,n){Pt(e)&&n.delete(t)}function Dt(){At=!1,null!==Tt&&Pt(Tt)&&(Tt=null),null!==Mt&&Pt(Mt)&&(Mt=null),null!==Ft&&Pt(Ft)&&(Ft=null),zt.forEach(Lt),_t.forEach(Lt)}function $t(e,t){e.blockedOn===t&&(e.blockedOn=null,At||(At=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,Dt)))}function qt(e){function t(t){return $t(t,e)}if(0<It.length){$t(It[0],e);for(var n=1;n<It.length;n++){var r=It[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Tt&&$t(Tt,e),null!==Mt&&$t(Mt,e),null!==Ft&&$t(Ft,e),zt.forEach(t),_t.forEach(t),n=0;n<Rt.length;n++)(r=Rt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Rt.length&&null===(n=Rt[0]).blockedOn;)Nt(n),null===n.blockedOn&&Rt.shift()}var Ut=x.ReactCurrentBatchConfig,Vt=!0;function Ht(e,t,n,r){var o=bt,a=Ut.transition;Ut.transition=null;try{bt=1,Gt(e,t,n,r)}finally{bt=o,Ut.transition=a}}function Wt(e,t,n,r){var o=bt,a=Ut.transition;Ut.transition=null;try{bt=4,Gt(e,t,n,r)}finally{bt=o,Ut.transition=a}}function Gt(e,t,n,r){if(Vt){var o=Xt(e,t,n,r);if(null===o)Vr(e,t,r,Yt,n),Bt(e,r);else if(function(e,t,n,r,o){switch(t){case"focusin":return Tt=Ot(Tt,e,t,n,r,o),!0;case"dragenter":return Mt=Ot(Mt,e,t,n,r,o),!0;case"mouseover":return Ft=Ot(Ft,e,t,n,r,o),!0;case"pointerover":var a=o.pointerId;return zt.set(a,Ot(zt.get(a)||null,e,t,n,r,o)),!0;case"gotpointercapture":return a=o.pointerId,_t.set(a,Ot(_t.get(a)||null,e,t,n,r,o)),!0}return!1}(o,e,t,n,r))r.stopPropagation();else if(Bt(e,r),4&t&&-1<jt.indexOf(e)){for(;null!==o;){var a=xo(o);if(null!==a&&wt(a),null===(a=Xt(e,t,n,r))&&Vr(e,t,r,Yt,n),a===o)break;o=a}null!==o&&r.stopPropagation()}else Vr(e,t,r,null,n)}}var Yt=null;function Xt(e,t,n,r){if(Yt=null,null!==(e=bo(e=we(r))))if(null===(t=qe(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Ue(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Yt=e,null}function Kt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case Ze:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Qt=null,Jt=null,Zt=null;function en(){if(Zt)return Zt;var e,t,n=Jt,r=n.length,o="value"in Qt?Qt.value:Qt.textContent,a=o.length;for(e=0;e<r&&n[e]===o[e];e++);var i=r-e;for(t=1;t<=i&&n[r-t]===o[a-t];t++);return Zt=o.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function on(e){function t(t,n,r,o,a){for(var i in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=o,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(i)&&(t=e[i],this[i]=t?t(o):o[i]);return this.isDefaultPrevented=(null!=o.defaultPrevented?o.defaultPrevented:!1===o.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return N(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var an,sn,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=on(cn),dn=N({},cn,{view:0,detail:0}),pn=on(dn),hn=N({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:En,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(an=e.screenX-ln.screenX,sn=e.screenY-ln.screenY):sn=an=0,ln=e),an)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),fn=on(hn),gn=on(N({},hn,{dataTransfer:0})),mn=on(N({},dn,{relatedTarget:0})),yn=on(N({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),vn=N({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=on(vn),xn=on(N({},cn,{data:0})),wn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},kn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Cn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=kn[e])&&!!t[e]}function En(){return Cn}var An=N({},dn,{key:function(e){if(e.key){var t=wn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Sn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:En,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),In=on(An),Tn=on(N({},hn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Mn=on(N({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:En})),Fn=on(N({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),zn=N({},hn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),_n=on(zn),Rn=[9,13,27,32],jn=u&&"CompositionEvent"in window,Bn=null;u&&"documentMode"in document&&(Bn=document.documentMode);var On=u&&"TextEvent"in window&&!Bn,Nn=u&&(!jn||Bn&&8<Bn&&11>=Bn),Pn=String.fromCharCode(32),Ln=!1;function Dn(e,t){switch(e){case"keyup":return-1!==Rn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function $n(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var qn=!1;var Un={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Un[e.type]:"textarea"===t}function Hn(e,t,n,r){Ae(r),0<(t=Wr(t,"onChange")).length&&(n=new un("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Wn=null,Gn=null;function Yn(e){Pr(e,0)}function Xn(e){if(G(wo(e)))return e}function Kn(e,t){if("change"===e)return t}var Qn=!1;if(u){var Jn;if(u){var Zn="oninput"in document;if(!Zn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Zn="function"==typeof er.oninput}Jn=Zn}else Jn=!1;Qn=Jn&&(!document.documentMode||9<document.documentMode)}function tr(){Wn&&(Wn.detachEvent("onpropertychange",nr),Gn=Wn=null)}function nr(e){if("value"===e.propertyName&&Xn(Gn)){var t=[];Hn(t,Gn,e,we(e)),ze(Yn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Gn=n,(Wn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function or(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Xn(Gn)}function ar(e,t){if("click"===e)return Xn(t)}function ir(e,t){if("input"===e||"change"===e)return Xn(t)}var sr="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function lr(e,t){if(sr(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var o=n[r];if(!d.call(t,o)||!sr(e[o],t[o]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ur(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function dr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?dr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function pr(){for(var e=window,t=Y();t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(e){n=!1}if(!n)break;t=Y((e=t.contentWindow).document)}return t}function hr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function fr(e){var t=pr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&dr(n.ownerDocument.documentElement,n)){if(null!==r&&hr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var o=n.textContent.length,a=Math.min(r.start,o);r=void 0===r.end?a:Math.min(r.end,o),!e.extend&&a>r&&(o=r,r=a,a=o),o=ur(n,a);var i=ur(n,r);o&&i&&(1!==e.rangeCount||e.anchorNode!==o.node||e.anchorOffset!==o.offset||e.focusNode!==i.node||e.focusOffset!==i.offset)&&((t=t.createRange()).setStart(o.node,o.offset),e.removeAllRanges(),a>r?(e.addRange(t),e.extend(i.node,i.offset)):(t.setEnd(i.node,i.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"==typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var gr=u&&"documentMode"in document&&11>=document.documentMode,mr=null,yr=null,vr=null,br=!1;function xr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;br||null==mr||mr!==Y(r)||("selectionStart"in(r=mr)&&hr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},vr&&lr(vr,r)||(vr=r,0<(r=Wr(yr,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=mr)))}function wr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Sr={animationend:wr("Animation","AnimationEnd"),animationiteration:wr("Animation","AnimationIteration"),animationstart:wr("Animation","AnimationStart"),transitionend:wr("Transition","TransitionEnd")},kr={},Cr={};function Er(e){if(kr[e])return kr[e];if(!Sr[e])return e;var t,n=Sr[e];for(t in n)if(n.hasOwnProperty(t)&&t in Cr)return kr[e]=n[t];return e}u&&(Cr=document.createElement("div").style,"AnimationEvent"in window||(delete Sr.animationend.animation,delete Sr.animationiteration.animation,delete Sr.animationstart.animation),"TransitionEvent"in window||delete Sr.transitionend.transition);var Ar=Er("animationend"),Ir=Er("animationiteration"),Tr=Er("animationstart"),Mr=Er("transitionend"),Fr=new Map,zr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function _r(e,t){Fr.set(e,t),l(t,[e])}for(var Rr=0;Rr<zr.length;Rr++){var jr=zr[Rr];_r(jr.toLowerCase(),"on"+(jr[0].toUpperCase()+jr.slice(1)))}_r(Ar,"onAnimationEnd"),_r(Ir,"onAnimationIteration"),_r(Tr,"onAnimationStart"),_r("dblclick","onDoubleClick"),_r("focusin","onFocus"),_r("focusout","onBlur"),_r(Mr,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Br="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Or=new Set("cancel close invalid load scroll toggle".split(" ").concat(Br));function Nr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,o,i,s,l,c){if($e.apply(this,arguments),Oe){if(!Oe)throw Error(a(198));var u=Ne;Oe=!1,Ne=null,Pe||(Pe=!0,Le=u)}}(r,t,void 0,e),e.currentTarget=null}function Pr(e,t){t=!!(4&t);for(var n=0;n<e.length;n++){var r=e[n],o=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var i=r.length-1;0<=i;i--){var s=r[i],l=s.instance,c=s.currentTarget;if(s=s.listener,l!==a&&o.isPropagationStopped())break e;Nr(o,s,c),a=l}else for(i=0;i<r.length;i++){if(l=(s=r[i]).instance,c=s.currentTarget,s=s.listener,l!==a&&o.isPropagationStopped())break e;Nr(o,s,c),a=l}}}if(Pe)throw e=Le,Pe=!1,Le=null,e}function Lr(e,t){var n=t[mo];void 0===n&&(n=t[mo]=new Set);var r=e+"__bubble";n.has(r)||(Ur(t,e,2,!1),n.add(r))}function Dr(e,t,n){var r=0;t&&(r|=4),Ur(n,e,r,t)}var $r="_reactListening"+Math.random().toString(36).slice(2);function qr(e){if(!e[$r]){e[$r]=!0,i.forEach((function(t){"selectionchange"!==t&&(Or.has(t)||Dr(t,!1,e),Dr(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[$r]||(t[$r]=!0,Dr("selectionchange",!1,t))}}function Ur(e,t,n,r){switch(Kt(t)){case 1:var o=Ht;break;case 4:o=Wt;break;default:o=Gt}n=o.bind(null,t,n,e),o=void 0,!Re||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(o=!0),r?void 0!==o?e.addEventListener(t,n,{capture:!0,passive:o}):e.addEventListener(t,n,!0):void 0!==o?e.addEventListener(t,n,{passive:o}):e.addEventListener(t,n,!1)}function Vr(e,t,n,r,o){var a=r;if(!(1&t||2&t||null===r))e:for(;;){if(null===r)return;var i=r.tag;if(3===i||4===i){var s=r.stateNode.containerInfo;if(s===o||8===s.nodeType&&s.parentNode===o)break;if(4===i)for(i=r.return;null!==i;){var l=i.tag;if((3===l||4===l)&&((l=i.stateNode.containerInfo)===o||8===l.nodeType&&l.parentNode===o))return;i=i.return}for(;null!==s;){if(null===(i=bo(s)))return;if(5===(l=i.tag)||6===l){r=a=i;continue e}s=s.parentNode}}r=r.return}ze((function(){var r=a,o=we(n),i=[];e:{var s=Fr.get(e);if(void 0!==s){var l=un,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=In;break;case"focusin":c="focus",l=mn;break;case"focusout":c="blur",l=mn;break;case"beforeblur":case"afterblur":l=mn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=fn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=gn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Mn;break;case Ar:case Ir:case Tr:l=yn;break;case Mr:l=Fn;break;case"scroll":l=pn;break;case"wheel":l=_n;break;case"copy":case"cut":case"paste":l=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Tn}var u=!!(4&t),d=!u&&"scroll"===e,p=u?null!==s?s+"Capture":null:s;u=[];for(var h,f=r;null!==f;){var g=(h=f).stateNode;if(5===h.tag&&null!==g&&(h=g,null!==p&&(null!=(g=_e(f,p))&&u.push(Hr(f,g,h)))),d)break;f=f.return}0<u.length&&(s=new l(s,c,null,n,o),i.push({event:s,listeners:u}))}}if(!(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===xe||!(c=n.relatedTarget||n.fromElement)||!bo(c)&&!c[go])&&(l||s)&&(s=o.window===o?o:(s=o.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=r,null!==(c=(c=n.relatedTarget||n.toElement)?bo(c):null)&&(c!==(d=qe(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=r),l!==c)){if(u=fn,g="onMouseLeave",p="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=Tn,g="onPointerLeave",p="onPointerEnter",f="pointer"),d=null==l?s:wo(l),h=null==c?s:wo(c),(s=new u(g,f+"leave",l,n,o)).target=d,s.relatedTarget=h,g=null,bo(o)===r&&((u=new u(p,f+"enter",c,n,o)).target=h,u.relatedTarget=d,g=u),d=g,l&&c)e:{for(p=c,f=0,h=u=l;h;h=Gr(h))f++;for(h=0,g=p;g;g=Gr(g))h++;for(;0<f-h;)u=Gr(u),f--;for(;0<h-f;)p=Gr(p),h--;for(;f--;){if(u===p||null!==p&&u===p.alternate)break e;u=Gr(u),p=Gr(p)}u=null}else u=null;null!==l&&Yr(i,s,l,u,!1),null!==c&&null!==d&&Yr(i,d,c,u,!0)}if("select"===(l=(s=r?wo(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var m=Kn;else if(Vn(s))if(Qn)m=ir;else{m=or;var y=rr}else(l=s.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(m=ar);switch(m&&(m=m(e,r))?Hn(i,m,n,o):(y&&y(e,s,r),"focusout"===e&&(y=s._wrapperState)&&y.controlled&&"number"===s.type&&ee(s,"number",s.value)),y=r?wo(r):window,e){case"focusin":(Vn(y)||"true"===y.contentEditable)&&(mr=y,yr=r,vr=null);break;case"focusout":vr=yr=mr=null;break;case"mousedown":br=!0;break;case"contextmenu":case"mouseup":case"dragend":br=!1,xr(i,n,o);break;case"selectionchange":if(gr)break;case"keydown":case"keyup":xr(i,n,o)}var v;if(jn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else qn?Dn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(Nn&&"ko"!==n.locale&&(qn||"onCompositionStart"!==b?"onCompositionEnd"===b&&qn&&(v=en()):(Jt="value"in(Qt=o)?Qt.value:Qt.textContent,qn=!0)),0<(y=Wr(r,b)).length&&(b=new xn(b,e,null,n,o),i.push({event:b,listeners:y}),v?b.data=v:null!==(v=$n(n))&&(b.data=v))),(v=On?function(e,t){switch(e){case"compositionend":return $n(t);case"keypress":return 32!==t.which?null:(Ln=!0,Pn);case"textInput":return(e=t.data)===Pn&&Ln?null:e;default:return null}}(e,n):function(e,t){if(qn)return"compositionend"===e||!jn&&Dn(e,t)?(e=en(),Zt=Jt=Qt=null,qn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Nn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Wr(r,"onBeforeInput")).length&&(o=new xn("onBeforeInput","beforeinput",null,n,o),i.push({event:o,listeners:r}),o.data=v))}Pr(i,t)}))}function Hr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Wr(e,t){for(var n=t+"Capture",r=[];null!==e;){var o=e,a=o.stateNode;5===o.tag&&null!==a&&(o=a,null!=(a=_e(e,n))&&r.unshift(Hr(e,a,o)),null!=(a=_e(e,t))&&r.push(Hr(e,a,o))),e=e.return}return r}function Gr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Yr(e,t,n,r,o){for(var a=t._reactName,i=[];null!==n&&n!==r;){var s=n,l=s.alternate,c=s.stateNode;if(null!==l&&l===r)break;5===s.tag&&null!==c&&(s=c,o?null!=(l=_e(n,a))&&i.unshift(Hr(n,l,s)):o||null!=(l=_e(n,a))&&i.push(Hr(n,l,s))),n=n.return}0!==i.length&&e.push({event:t,listeners:i})}var Xr=/\r\n?/g,Kr=/\u0000|\uFFFD/g;function Qr(e){return("string"==typeof e?e:""+e).replace(Xr,"\n").replace(Kr,"")}function Jr(e,t,n){if(t=Qr(t),Qr(e)!==t&&n)throw Error(a(425))}function Zr(){}var eo=null,to=null;function no(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ro="function"==typeof setTimeout?setTimeout:void 0,oo="function"==typeof clearTimeout?clearTimeout:void 0,ao="function"==typeof Promise?Promise:void 0,io="function"==typeof queueMicrotask?queueMicrotask:void 0!==ao?function(e){return ao.resolve(null).then(e).catch(so)}:ro;function so(e){setTimeout((function(){throw e}))}function lo(e,t){var n=t,r=0;do{var o=n.nextSibling;if(e.removeChild(n),o&&8===o.nodeType)if("/$"===(n=o.data)){if(0===r)return e.removeChild(o),void qt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=o}while(n);qt(t)}function co(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function uo(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var po=Math.random().toString(36).slice(2),ho="__reactFiber$"+po,fo="__reactProps$"+po,go="__reactContainer$"+po,mo="__reactEvents$"+po,yo="__reactListeners$"+po,vo="__reactHandles$"+po;function bo(e){var t=e[ho];if(t)return t;for(var n=e.parentNode;n;){if(t=n[go]||n[ho]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=uo(e);null!==e;){if(n=e[ho])return n;e=uo(e)}return t}n=(e=n).parentNode}return null}function xo(e){return!(e=e[ho]||e[go])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function wo(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function So(e){return e[fo]||null}var ko=[],Co=-1;function Eo(e){return{current:e}}function Ao(e){0>Co||(e.current=ko[Co],ko[Co]=null,Co--)}function Io(e,t){Co++,ko[Co]=e.current,e.current=t}var To={},Mo=Eo(To),Fo=Eo(!1),zo=To;function _o(e,t){var n=e.type.contextTypes;if(!n)return To;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var o,a={};for(o in n)a[o]=t[o];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Ro(e){return null!=(e=e.childContextTypes)}function jo(){Ao(Fo),Ao(Mo)}function Bo(e,t,n){if(Mo.current!==To)throw Error(a(168));Io(Mo,t),Io(Fo,n)}function Oo(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!=typeof r.getChildContext)return n;for(var o in r=r.getChildContext())if(!(o in t))throw Error(a(108,U(e)||"Unknown",o));return N({},n,r)}function No(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||To,zo=Mo.current,Io(Mo,e),Io(Fo,Fo.current),!0}function Po(e,t,n){var r=e.stateNode;if(!r)throw Error(a(169));n?(e=Oo(e,t,zo),r.__reactInternalMemoizedMergedChildContext=e,Ao(Fo),Ao(Mo),Io(Mo,e)):Ao(Fo),Io(Fo,n)}var Lo=null,Do=!1,$o=!1;function qo(e){null===Lo?Lo=[e]:Lo.push(e)}function Uo(){if(!$o&&null!==Lo){$o=!0;var e=0,t=bt;try{var n=Lo;for(bt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Lo=null,Do=!1}catch(t){throw null!==Lo&&(Lo=Lo.slice(e+1)),Ge(Ze,Uo),t}finally{bt=t,$o=!1}}return null}var Vo=[],Ho=0,Wo=null,Go=0,Yo=[],Xo=0,Ko=null,Qo=1,Jo="";function Zo(e,t){Vo[Ho++]=Go,Vo[Ho++]=Wo,Wo=e,Go=t}function ea(e,t,n){Yo[Xo++]=Qo,Yo[Xo++]=Jo,Yo[Xo++]=Ko,Ko=e;var r=Qo;e=Jo;var o=32-it(r)-1;r&=~(1<<o),n+=1;var a=32-it(t)+o;if(30<a){var i=o-o%5;a=(r&(1<<i)-1).toString(32),r>>=i,o-=i,Qo=1<<32-it(t)+o|n<<o|r,Jo=a+e}else Qo=1<<a|n<<o|r,Jo=e}function ta(e){null!==e.return&&(Zo(e,1),ea(e,1,0))}function na(e){for(;e===Wo;)Wo=Vo[--Ho],Vo[Ho]=null,Go=Vo[--Ho],Vo[Ho]=null;for(;e===Ko;)Ko=Yo[--Xo],Yo[Xo]=null,Jo=Yo[--Xo],Yo[Xo]=null,Qo=Yo[--Xo],Yo[Xo]=null}var ra=null,oa=null,aa=!1,ia=null;function sa(e,t){var n=_c(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function la(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ra=e,oa=co(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ra=e,oa=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Ko?{id:Qo,overflow:Jo}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=_c(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ra=e,oa=null,!0);default:return!1}}function ca(e){return!(!(1&e.mode)||128&e.flags)}function ua(e){if(aa){var t=oa;if(t){var n=t;if(!la(e,t)){if(ca(e))throw Error(a(418));t=co(n.nextSibling);var r=ra;t&&la(e,t)?sa(r,n):(e.flags=-4097&e.flags|2,aa=!1,ra=e)}}else{if(ca(e))throw Error(a(418));e.flags=-4097&e.flags|2,aa=!1,ra=e}}}function da(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ra=e}function pa(e){if(e!==ra)return!1;if(!aa)return da(e),aa=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!no(e.type,e.memoizedProps)),t&&(t=oa)){if(ca(e))throw ha(),Error(a(418));for(;t;)sa(e,t),t=co(t.nextSibling)}if(da(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){oa=co(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}oa=null}}else oa=ra?co(e.stateNode.nextSibling):null;return!0}function ha(){for(var e=oa;e;)e=co(e.nextSibling)}function fa(){oa=ra=null,aa=!1}function ga(e){null===ia?ia=[e]:ia.push(e)}var ma=x.ReactCurrentBatchConfig;function ya(e,t){if(e&&e.defaultProps){for(var n in t=N({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var va=Eo(null),ba=null,xa=null,wa=null;function Sa(){wa=xa=ba=null}function ka(e){var t=va.current;Ao(va),e._currentValue=t}function Ca(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Ea(e,t){ba=e,wa=xa=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(!!(e.lanes&t)&&(xs=!0),e.firstContext=null)}function Aa(e){var t=e._currentValue;if(wa!==e)if(e={context:e,memoizedValue:t,next:null},null===xa){if(null===ba)throw Error(a(308));xa=e,ba.dependencies={lanes:0,firstContext:e}}else xa=xa.next=e;return t}var Ia=null;function Ta(e){null===Ia?Ia=[e]:Ia.push(e)}function Ma(e,t,n,r){var o=t.interleaved;return null===o?(n.next=n,Ta(t)):(n.next=o.next,o.next=n),t.interleaved=n,Fa(e,r)}function Fa(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var za=!1;function _a(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ra(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function ja(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ba(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,2&Ml){var o=r.pending;return null===o?t.next=t:(t.next=o.next,o.next=t),r.pending=t,Fa(e,n)}return null===(o=r.interleaved)?(t.next=t,Ta(r)):(t.next=o.next,o.next=t),r.interleaved=t,Fa(e,n)}function Oa(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,vt(e,n)}}function Na(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var o=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var i={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?o=a=i:a=a.next=i,n=n.next}while(null!==n);null===a?o=a=t:a=a.next=t}else o=a=t;return n={baseState:r.baseState,firstBaseUpdate:o,lastBaseUpdate:a,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Pa(e,t,n,r){var o=e.updateQueue;za=!1;var a=o.firstBaseUpdate,i=o.lastBaseUpdate,s=o.shared.pending;if(null!==s){o.shared.pending=null;var l=s,c=l.next;l.next=null,null===i?a=c:i.next=c,i=l;var u=e.alternate;null!==u&&((s=(u=u.updateQueue).lastBaseUpdate)!==i&&(null===s?u.firstBaseUpdate=c:s.next=c,u.lastBaseUpdate=l))}if(null!==a){var d=o.baseState;for(i=0,u=c=l=null,s=a;;){var p=s.lane,h=s.eventTime;if((r&p)===p){null!==u&&(u=u.next={eventTime:h,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var f=e,g=s;switch(p=t,h=n,g.tag){case 1:if("function"==typeof(f=g.payload)){d=f.call(h,d,p);break e}d=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null==(p="function"==typeof(f=g.payload)?f.call(h,d,p):f))break e;d=N({},d,p);break e;case 2:za=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(p=o.effects)?o.effects=[s]:p.push(s))}else h={eventTime:h,lane:p,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===u?(c=u=h,l=d):u=u.next=h,i|=p;if(null===(s=s.next)){if(null===(s=o.shared.pending))break;s=(p=s).next,p.next=null,o.lastBaseUpdate=p,o.shared.pending=null}}if(null===u&&(l=d),o.baseState=l,o.firstBaseUpdate=c,o.lastBaseUpdate=u,null!==(t=o.shared.interleaved)){o=t;do{i|=o.lane,o=o.next}while(o!==t)}else null===a&&(o.shared.lanes=0);Nl|=i,e.lanes=i,e.memoizedState=d}}function La(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],o=r.callback;if(null!==o){if(r.callback=null,r=n,"function"!=typeof o)throw Error(a(191,o));o.call(r)}}}var Da=(new r.Component).refs;function $a(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:N({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var qa={isMounted:function(e){return!!(e=e._reactInternals)&&qe(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=tc(),o=nc(e),a=ja(r,o);a.payload=t,null!=n&&(a.callback=n),null!==(t=Ba(e,a,o))&&(rc(t,e,o,r),Oa(t,e,o))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=tc(),o=nc(e),a=ja(r,o);a.tag=1,a.payload=t,null!=n&&(a.callback=n),null!==(t=Ba(e,a,o))&&(rc(t,e,o,r),Oa(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tc(),r=nc(e),o=ja(n,r);o.tag=2,null!=t&&(o.callback=t),null!==(t=Ba(e,o,r))&&(rc(t,e,r,n),Oa(t,e,r))}};function Ua(e,t,n,r,o,a,i){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,i):!t.prototype||!t.prototype.isPureReactComponent||(!lr(n,r)||!lr(o,a))}function Va(e,t,n){var r=!1,o=To,a=t.contextType;return"object"==typeof a&&null!==a?a=Aa(a):(o=Ro(t)?zo:Mo.current,a=(r=null!=(r=t.contextTypes))?_o(e,o):To),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=qa,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=a),t}function Ha(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&qa.enqueueReplaceState(t,t.state,null)}function Wa(e,t,n,r){var o=e.stateNode;o.props=n,o.state=e.memoizedState,o.refs=Da,_a(e);var a=t.contextType;"object"==typeof a&&null!==a?o.context=Aa(a):(a=Ro(t)?zo:Mo.current,o.context=_o(e,a)),o.state=e.memoizedState,"function"==typeof(a=t.getDerivedStateFromProps)&&($a(e,t,a,n),o.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof o.getSnapshotBeforeUpdate||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||(t=o.state,"function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount(),t!==o.state&&qa.enqueueReplaceState(o,o.state,null),Pa(e,n,o,r),o.state=e.memoizedState),"function"==typeof o.componentDidMount&&(e.flags|=4194308)}function Ga(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var r=n.stateNode}if(!r)throw Error(a(147,e));var o=r,i=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===i?t.ref:(t=function(e){var t=o.refs;t===Da&&(t=o.refs={}),null===e?delete t[i]:t[i]=e},t._stringRef=i,t)}if("string"!=typeof e)throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function Ya(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Xa(e){return(0,e._init)(e._payload)}function Ka(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function o(e,t){return(e=jc(e,t)).index=0,e.sibling=null,e}function i(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=Pc(n,e.mode,r)).return=e,t):((t=o(t,n)).return=e,t)}function c(e,t,n,r){var a=n.type;return a===k?d(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===a||"object"==typeof a&&null!==a&&a.$$typeof===_&&Xa(a)===t.type)?((r=o(t,n.props)).ref=Ga(e,t,n),r.return=e,r):((r=Bc(n.type,n.key,n.props,null,e.mode,r)).ref=Ga(e,t,n),r.return=e,r)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Lc(n,e.mode,r)).return=e,t):((t=o(t,n.children||[])).return=e,t)}function d(e,t,n,r,a){return null===t||7!==t.tag?((t=Oc(n,e.mode,r,a)).return=e,t):((t=o(t,n)).return=e,t)}function p(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t)return(t=Pc(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case w:return(n=Bc(t.type,t.key,t.props,null,e.mode,n)).ref=Ga(e,null,t),n.return=e,n;case S:return(t=Lc(t,e.mode,n)).return=e,t;case _:return p(e,(0,t._init)(t._payload),n)}if(te(t)||B(t))return(t=Oc(t,e.mode,n,null)).return=e,t;Ya(e,t)}return null}function h(e,t,n,r){var o=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n)return null!==o?null:l(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case w:return n.key===o?c(e,t,n,r):null;case S:return n.key===o?u(e,t,n,r):null;case _:return h(e,t,(o=n._init)(n._payload),r)}if(te(n)||B(n))return null!==o?null:d(e,t,n,r,null);Ya(e,n)}return null}function f(e,t,n,r,o){if("string"==typeof r&&""!==r||"number"==typeof r)return l(t,e=e.get(n)||null,""+r,o);if("object"==typeof r&&null!==r){switch(r.$$typeof){case w:return c(t,e=e.get(null===r.key?n:r.key)||null,r,o);case S:return u(t,e=e.get(null===r.key?n:r.key)||null,r,o);case _:return f(e,t,n,(0,r._init)(r._payload),o)}if(te(r)||B(r))return d(t,e=e.get(n)||null,r,o,null);Ya(t,r)}return null}function g(o,a,s,l){for(var c=null,u=null,d=a,g=a=0,m=null;null!==d&&g<s.length;g++){d.index>g?(m=d,d=null):m=d.sibling;var y=h(o,d,s[g],l);if(null===y){null===d&&(d=m);break}e&&d&&null===y.alternate&&t(o,d),a=i(y,a,g),null===u?c=y:u.sibling=y,u=y,d=m}if(g===s.length)return n(o,d),aa&&Zo(o,g),c;if(null===d){for(;g<s.length;g++)null!==(d=p(o,s[g],l))&&(a=i(d,a,g),null===u?c=d:u.sibling=d,u=d);return aa&&Zo(o,g),c}for(d=r(o,d);g<s.length;g++)null!==(m=f(d,o,g,s[g],l))&&(e&&null!==m.alternate&&d.delete(null===m.key?g:m.key),a=i(m,a,g),null===u?c=m:u.sibling=m,u=m);return e&&d.forEach((function(e){return t(o,e)})),aa&&Zo(o,g),c}function m(o,s,l,c){var u=B(l);if("function"!=typeof u)throw Error(a(150));if(null==(l=u.call(l)))throw Error(a(151));for(var d=u=null,g=s,m=s=0,y=null,v=l.next();null!==g&&!v.done;m++,v=l.next()){g.index>m?(y=g,g=null):y=g.sibling;var b=h(o,g,v.value,c);if(null===b){null===g&&(g=y);break}e&&g&&null===b.alternate&&t(o,g),s=i(b,s,m),null===d?u=b:d.sibling=b,d=b,g=y}if(v.done)return n(o,g),aa&&Zo(o,m),u;if(null===g){for(;!v.done;m++,v=l.next())null!==(v=p(o,v.value,c))&&(s=i(v,s,m),null===d?u=v:d.sibling=v,d=v);return aa&&Zo(o,m),u}for(g=r(o,g);!v.done;m++,v=l.next())null!==(v=f(g,o,m,v.value,c))&&(e&&null!==v.alternate&&g.delete(null===v.key?m:v.key),s=i(v,s,m),null===d?u=v:d.sibling=v,d=v);return e&&g.forEach((function(e){return t(o,e)})),aa&&Zo(o,m),u}return function e(r,a,i,l){if("object"==typeof i&&null!==i&&i.type===k&&null===i.key&&(i=i.props.children),"object"==typeof i&&null!==i){switch(i.$$typeof){case w:e:{for(var c=i.key,u=a;null!==u;){if(u.key===c){if((c=i.type)===k){if(7===u.tag){n(r,u.sibling),(a=o(u,i.props.children)).return=r,r=a;break e}}else if(u.elementType===c||"object"==typeof c&&null!==c&&c.$$typeof===_&&Xa(c)===u.type){n(r,u.sibling),(a=o(u,i.props)).ref=Ga(r,u,i),a.return=r,r=a;break e}n(r,u);break}t(r,u),u=u.sibling}i.type===k?((a=Oc(i.props.children,r.mode,l,i.key)).return=r,r=a):((l=Bc(i.type,i.key,i.props,null,r.mode,l)).ref=Ga(r,a,i),l.return=r,r=l)}return s(r);case S:e:{for(u=i.key;null!==a;){if(a.key===u){if(4===a.tag&&a.stateNode.containerInfo===i.containerInfo&&a.stateNode.implementation===i.implementation){n(r,a.sibling),(a=o(a,i.children||[])).return=r,r=a;break e}n(r,a);break}t(r,a),a=a.sibling}(a=Lc(i,r.mode,l)).return=r,r=a}return s(r);case _:return e(r,a,(u=i._init)(i._payload),l)}if(te(i))return g(r,a,i,l);if(B(i))return m(r,a,i,l);Ya(r,i)}return"string"==typeof i&&""!==i||"number"==typeof i?(i=""+i,null!==a&&6===a.tag?(n(r,a.sibling),(a=o(a,i)).return=r,r=a):(n(r,a),(a=Pc(i,r.mode,l)).return=r,r=a),s(r)):n(r,a)}}var Qa=Ka(!0),Ja=Ka(!1),Za={},ei=Eo(Za),ti=Eo(Za),ni=Eo(Za);function ri(e){if(e===Za)throw Error(a(174));return e}function oi(e,t){switch(Io(ni,t),Io(ti,e),Io(ei,Za),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Ao(ei),Io(ei,t)}function ai(){Ao(ei),Ao(ti),Ao(ni)}function ii(e){ri(ni.current);var t=ri(ei.current),n=le(t,e.type);t!==n&&(Io(ti,e),Io(ei,n))}function si(e){ti.current===e&&(Ao(ei),Ao(ti))}var li=Eo(0);function ci(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(128&t.flags)return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ui=[];function di(){for(var e=0;e<ui.length;e++)ui[e]._workInProgressVersionPrimary=null;ui.length=0}var pi=x.ReactCurrentDispatcher,hi=x.ReactCurrentBatchConfig,fi=0,gi=null,mi=null,yi=null,vi=!1,bi=!1,xi=0,wi=0;function Si(){throw Error(a(321))}function ki(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!sr(e[n],t[n]))return!1;return!0}function Ci(e,t,n,r,o,i){if(fi=i,gi=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,pi.current=null===e||null===e.memoizedState?ss:ls,e=n(r,o),bi){i=0;do{if(bi=!1,xi=0,25<=i)throw Error(a(301));i+=1,yi=mi=null,t.updateQueue=null,pi.current=cs,e=n(r,o)}while(bi)}if(pi.current=is,t=null!==mi&&null!==mi.next,fi=0,yi=mi=gi=null,vi=!1,t)throw Error(a(300));return e}function Ei(){var e=0!==xi;return xi=0,e}function Ai(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===yi?gi.memoizedState=yi=e:yi=yi.next=e,yi}function Ii(){if(null===mi){var e=gi.alternate;e=null!==e?e.memoizedState:null}else e=mi.next;var t=null===yi?gi.memoizedState:yi.next;if(null!==t)yi=t,mi=e;else{if(null===e)throw Error(a(310));e={memoizedState:(mi=e).memoizedState,baseState:mi.baseState,baseQueue:mi.baseQueue,queue:mi.queue,next:null},null===yi?gi.memoizedState=yi=e:yi=yi.next=e}return yi}function Ti(e,t){return"function"==typeof t?t(e):t}function Mi(e){var t=Ii(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=mi,o=r.baseQueue,i=n.pending;if(null!==i){if(null!==o){var s=o.next;o.next=i.next,i.next=s}r.baseQueue=o=i,n.pending=null}if(null!==o){i=o.next,r=r.baseState;var l=s=null,c=null,u=i;do{var d=u.lane;if((fi&d)===d)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var p={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=p,s=r):c=c.next=p,gi.lanes|=d,Nl|=d}u=u.next}while(null!==u&&u!==i);null===c?s=r:c.next=l,sr(r,t.memoizedState)||(xs=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){o=e;do{i=o.lane,gi.lanes|=i,Nl|=i,o=o.next}while(o!==e)}else null===o&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Fi(e){var t=Ii(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=n.dispatch,o=n.pending,i=t.memoizedState;if(null!==o){n.pending=null;var s=o=o.next;do{i=e(i,s.action),s=s.next}while(s!==o);sr(i,t.memoizedState)||(xs=!0),t.memoizedState=i,null===t.baseQueue&&(t.baseState=i),n.lastRenderedState=i}return[i,r]}function zi(){}function _i(e,t){var n=gi,r=Ii(),o=t(),i=!sr(r.memoizedState,o);if(i&&(r.memoizedState=o,xs=!0),r=r.queue,Vi(Bi.bind(null,n,r,e),[e]),r.getSnapshot!==t||i||null!==yi&&1&yi.memoizedState.tag){if(n.flags|=2048,Li(9,ji.bind(null,n,r,o,t),void 0,null),null===Fl)throw Error(a(349));30&fi||Ri(n,t,o)}return o}function Ri(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=gi.updateQueue)?(t={lastEffect:null,stores:null},gi.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function ji(e,t,n,r){t.value=n,t.getSnapshot=r,Oi(t)&&Ni(e)}function Bi(e,t,n){return n((function(){Oi(t)&&Ni(e)}))}function Oi(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!sr(e,n)}catch(e){return!0}}function Ni(e){var t=Fa(e,1);null!==t&&rc(t,e,1,-1)}function Pi(e){var t=Ai();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ti,lastRenderedState:e},t.queue=e,e=e.dispatch=ns.bind(null,gi,e),[t.memoizedState,e]}function Li(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=gi.updateQueue)?(t={lastEffect:null,stores:null},gi.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Di(){return Ii().memoizedState}function $i(e,t,n,r){var o=Ai();gi.flags|=e,o.memoizedState=Li(1|t,n,void 0,void 0===r?null:r)}function qi(e,t,n,r){var o=Ii();r=void 0===r?null:r;var a=void 0;if(null!==mi){var i=mi.memoizedState;if(a=i.destroy,null!==r&&ki(r,i.deps))return void(o.memoizedState=Li(t,n,a,r))}gi.flags|=e,o.memoizedState=Li(1|t,n,a,r)}function Ui(e,t){return $i(8390656,8,e,t)}function Vi(e,t){return qi(2048,8,e,t)}function Hi(e,t){return qi(4,2,e,t)}function Wi(e,t){return qi(4,4,e,t)}function Gi(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Yi(e,t,n){return n=null!=n?n.concat([e]):null,qi(4,4,Gi.bind(null,t,e),n)}function Xi(){}function Ki(e,t){var n=Ii();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&ki(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Qi(e,t){var n=Ii();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&ki(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Ji(e,t,n){return 21&fi?(sr(n,t)||(n=gt(),gi.lanes|=n,Nl|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,xs=!0),e.memoizedState=n)}function Zi(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var r=hi.transition;hi.transition={};try{e(!1),t()}finally{bt=n,hi.transition=r}}function es(){return Ii().memoizedState}function ts(e,t,n){var r=nc(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},rs(e))os(t,n);else if(null!==(n=Ma(e,t,n,r))){rc(n,e,r,tc()),as(n,t,r)}}function ns(e,t,n){var r=nc(e),o={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(rs(e))os(t,o);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var i=t.lastRenderedState,s=a(i,n);if(o.hasEagerState=!0,o.eagerState=s,sr(s,i)){var l=t.interleaved;return null===l?(o.next=o,Ta(t)):(o.next=l.next,l.next=o),void(t.interleaved=o)}}catch(e){}null!==(n=Ma(e,t,o,r))&&(rc(n,e,r,o=tc()),as(n,t,r))}}function rs(e){var t=e.alternate;return e===gi||null!==t&&t===gi}function os(e,t){bi=vi=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function as(e,t,n){if(4194240&n){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,vt(e,n)}}var is={readContext:Aa,useCallback:Si,useContext:Si,useEffect:Si,useImperativeHandle:Si,useInsertionEffect:Si,useLayoutEffect:Si,useMemo:Si,useReducer:Si,useRef:Si,useState:Si,useDebugValue:Si,useDeferredValue:Si,useTransition:Si,useMutableSource:Si,useSyncExternalStore:Si,useId:Si,unstable_isNewReconciler:!1},ss={readContext:Aa,useCallback:function(e,t){return Ai().memoizedState=[e,void 0===t?null:t],e},useContext:Aa,useEffect:Ui,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,$i(4194308,4,Gi.bind(null,t,e),n)},useLayoutEffect:function(e,t){return $i(4194308,4,e,t)},useInsertionEffect:function(e,t){return $i(4,2,e,t)},useMemo:function(e,t){var n=Ai();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Ai();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=ts.bind(null,gi,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Ai().memoizedState=e},useState:Pi,useDebugValue:Xi,useDeferredValue:function(e){return Ai().memoizedState=e},useTransition:function(){var e=Pi(!1),t=e[0];return e=Zi.bind(null,e[1]),Ai().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=gi,o=Ai();if(aa){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===Fl)throw Error(a(349));30&fi||Ri(r,t,n)}o.memoizedState=n;var i={value:n,getSnapshot:t};return o.queue=i,Ui(Bi.bind(null,r,i,e),[e]),r.flags|=2048,Li(9,ji.bind(null,r,i,n,t),void 0,null),n},useId:function(){var e=Ai(),t=Fl.identifierPrefix;if(aa){var n=Jo;t=":"+t+"R"+(n=(Qo&~(1<<32-it(Qo)-1)).toString(32)+n),0<(n=xi++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=wi++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ls={readContext:Aa,useCallback:Ki,useContext:Aa,useEffect:Vi,useImperativeHandle:Yi,useInsertionEffect:Hi,useLayoutEffect:Wi,useMemo:Qi,useReducer:Mi,useRef:Di,useState:function(){return Mi(Ti)},useDebugValue:Xi,useDeferredValue:function(e){return Ji(Ii(),mi.memoizedState,e)},useTransition:function(){return[Mi(Ti)[0],Ii().memoizedState]},useMutableSource:zi,useSyncExternalStore:_i,useId:es,unstable_isNewReconciler:!1},cs={readContext:Aa,useCallback:Ki,useContext:Aa,useEffect:Vi,useImperativeHandle:Yi,useInsertionEffect:Hi,useLayoutEffect:Wi,useMemo:Qi,useReducer:Fi,useRef:Di,useState:function(){return Fi(Ti)},useDebugValue:Xi,useDeferredValue:function(e){var t=Ii();return null===mi?t.memoizedState=e:Ji(t,mi.memoizedState,e)},useTransition:function(){return[Fi(Ti)[0],Ii().memoizedState]},useMutableSource:zi,useSyncExternalStore:_i,useId:es,unstable_isNewReconciler:!1};function us(e,t){try{var n="",r=t;do{n+=$(r),r=r.return}while(r);var o=n}catch(e){o="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:t,stack:o,digest:null}}function ds(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function ps(e,t){try{console.error(t.value)}catch(e){setTimeout((function(){throw e}))}}var hs="function"==typeof WeakMap?WeakMap:Map;function fs(e,t,n){(n=ja(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Hl||(Hl=!0,Wl=r),ps(0,t)},n}function gs(e,t,n){(n=ja(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"==typeof r){var o=t.value;n.payload=function(){return r(o)},n.callback=function(){ps(0,t)}}var a=e.stateNode;return null!==a&&"function"==typeof a.componentDidCatch&&(n.callback=function(){ps(0,t),"function"!=typeof r&&(null===Gl?Gl=new Set([this]):Gl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ms(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new hs;var o=new Set;r.set(t,o)}else void 0===(o=r.get(t))&&(o=new Set,r.set(t,o));o.has(n)||(o.add(n),e=Ac.bind(null,e,t,n),t.then(e,e))}function ys(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function vs(e,t,n,r,o){return 1&e.mode?(e.flags|=65536,e.lanes=o,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=ja(-1,1)).tag=2,Ba(n,t,1))),n.lanes|=1),e)}var bs=x.ReactCurrentOwner,xs=!1;function ws(e,t,n,r){t.child=null===e?Ja(t,null,n,r):Qa(t,e.child,n,r)}function Ss(e,t,n,r,o){n=n.render;var a=t.ref;return Ea(t,o),r=Ci(e,t,n,r,a,o),n=Ei(),null===e||xs?(aa&&n&&ta(t),t.flags|=1,ws(e,t,r,o),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Hs(e,t,o))}function ks(e,t,n,r,o){if(null===e){var a=n.type;return"function"!=typeof a||Rc(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Bc(n.type,null,r,t,t.mode,o)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,Cs(e,t,a,r,o))}if(a=e.child,!(e.lanes&o)){var i=a.memoizedProps;if((n=null!==(n=n.compare)?n:lr)(i,r)&&e.ref===t.ref)return Hs(e,t,o)}return t.flags|=1,(e=jc(a,r)).ref=t.ref,e.return=t,t.child=e}function Cs(e,t,n,r,o){if(null!==e){var a=e.memoizedProps;if(lr(a,r)&&e.ref===t.ref){if(xs=!1,t.pendingProps=r=a,!(e.lanes&o))return t.lanes=e.lanes,Hs(e,t,o);131072&e.flags&&(xs=!0)}}return Is(e,t,n,r,o)}function Es(e,t,n){var r=t.pendingProps,o=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(1&t.mode){if(!(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Io(jl,Rl),Rl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==a?a.baseLanes:n,Io(jl,Rl),Rl|=r}else t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Io(jl,Rl),Rl|=n;else null!==a?(r=a.baseLanes|n,t.memoizedState=null):r=n,Io(jl,Rl),Rl|=r;return ws(e,t,o,n),t.child}function As(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Is(e,t,n,r,o){var a=Ro(n)?zo:Mo.current;return a=_o(t,a),Ea(t,o),n=Ci(e,t,n,r,a,o),r=Ei(),null===e||xs?(aa&&r&&ta(t),t.flags|=1,ws(e,t,n,o),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Hs(e,t,o))}function Ts(e,t,n,r,o){if(Ro(n)){var a=!0;No(t)}else a=!1;if(Ea(t,o),null===t.stateNode)Vs(e,t),Va(t,n,r),Wa(t,n,r,o),r=!0;else if(null===e){var i=t.stateNode,s=t.memoizedProps;i.props=s;var l=i.context,c=n.contextType;"object"==typeof c&&null!==c?c=Aa(c):c=_o(t,c=Ro(n)?zo:Mo.current);var u=n.getDerivedStateFromProps,d="function"==typeof u||"function"==typeof i.getSnapshotBeforeUpdate;d||"function"!=typeof i.UNSAFE_componentWillReceiveProps&&"function"!=typeof i.componentWillReceiveProps||(s!==r||l!==c)&&Ha(t,i,r,c),za=!1;var p=t.memoizedState;i.state=p,Pa(t,r,i,o),l=t.memoizedState,s!==r||p!==l||Fo.current||za?("function"==typeof u&&($a(t,n,u,r),l=t.memoizedState),(s=za||Ua(t,n,s,r,p,l,c))?(d||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||("function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount()),"function"==typeof i.componentDidMount&&(t.flags|=4194308)):("function"==typeof i.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),i.props=r,i.state=l,i.context=c,r=s):("function"==typeof i.componentDidMount&&(t.flags|=4194308),r=!1)}else{i=t.stateNode,Ra(e,t),s=t.memoizedProps,c=t.type===t.elementType?s:ya(t.type,s),i.props=c,d=t.pendingProps,p=i.context,"object"==typeof(l=n.contextType)&&null!==l?l=Aa(l):l=_o(t,l=Ro(n)?zo:Mo.current);var h=n.getDerivedStateFromProps;(u="function"==typeof h||"function"==typeof i.getSnapshotBeforeUpdate)||"function"!=typeof i.UNSAFE_componentWillReceiveProps&&"function"!=typeof i.componentWillReceiveProps||(s!==d||p!==l)&&Ha(t,i,r,l),za=!1,p=t.memoizedState,i.state=p,Pa(t,r,i,o);var f=t.memoizedState;s!==d||p!==f||Fo.current||za?("function"==typeof h&&($a(t,n,h,r),f=t.memoizedState),(c=za||Ua(t,n,c,r,p,f,l)||!1)?(u||"function"!=typeof i.UNSAFE_componentWillUpdate&&"function"!=typeof i.componentWillUpdate||("function"==typeof i.componentWillUpdate&&i.componentWillUpdate(r,f,l),"function"==typeof i.UNSAFE_componentWillUpdate&&i.UNSAFE_componentWillUpdate(r,f,l)),"function"==typeof i.componentDidUpdate&&(t.flags|=4),"function"==typeof i.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof i.componentDidUpdate||s===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),"function"!=typeof i.getSnapshotBeforeUpdate||s===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),i.props=r,i.state=f,i.context=l,r=c):("function"!=typeof i.componentDidUpdate||s===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),"function"!=typeof i.getSnapshotBeforeUpdate||s===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),r=!1)}return Ms(e,t,n,r,a,o)}function Ms(e,t,n,r,o,a){As(e,t);var i=!!(128&t.flags);if(!r&&!i)return o&&Po(t,n,!1),Hs(e,t,a);r=t.stateNode,bs.current=t;var s=i&&"function"!=typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&i?(t.child=Qa(t,e.child,null,a),t.child=Qa(t,null,s,a)):ws(e,t,s,a),t.memoizedState=r.state,o&&Po(t,n,!0),t.child}function Fs(e){var t=e.stateNode;t.pendingContext?Bo(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Bo(0,t.context,!1),oi(e,t.containerInfo)}function zs(e,t,n,r,o){return fa(),ga(o),t.flags|=256,ws(e,t,n,r),t.child}var _s,Rs,js,Bs,Os={dehydrated:null,treeContext:null,retryLane:0};function Ns(e){return{baseLanes:e,cachePool:null,transitions:null}}function Ps(e,t,n){var r,o=t.pendingProps,i=li.current,s=!1,l=!!(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&!!(2&i)),r?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(i|=1),Io(li,1&i),null===e)return ua(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(1&t.mode?"$!"===e.data?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(l=o.children,e=o.fallback,s?(o=t.mode,s=t.child,l={mode:"hidden",children:l},1&o||null===s?s=Nc(l,o,0,null):(s.childLanes=0,s.pendingProps=l),e=Oc(e,o,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Ns(n),t.memoizedState=Os,e):Ls(t,l));if(null!==(i=e.memoizedState)&&null!==(r=i.dehydrated))return function(e,t,n,r,o,i,s){if(n)return 256&t.flags?(t.flags&=-257,Ds(e,t,s,r=ds(Error(a(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(i=r.fallback,o=t.mode,r=Nc({mode:"visible",children:r.children},o,0,null),(i=Oc(i,o,s,null)).flags|=2,r.return=t,i.return=t,r.sibling=i,t.child=r,1&t.mode&&Qa(t,e.child,null,s),t.child.memoizedState=Ns(s),t.memoizedState=Os,i);if(!(1&t.mode))return Ds(e,t,s,null);if("$!"===o.data){if(r=o.nextSibling&&o.nextSibling.dataset)var l=r.dgst;return r=l,Ds(e,t,s,r=ds(i=Error(a(419)),r,void 0))}if(l=!!(s&e.childLanes),xs||l){if(null!==(r=Fl)){switch(s&-s){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}0!==(o=o&(r.suspendedLanes|s)?0:o)&&o!==i.retryLane&&(i.retryLane=o,Fa(e,o),rc(r,e,o,-1))}return mc(),Ds(e,t,s,r=ds(Error(a(421))))}return"$?"===o.data?(t.flags|=128,t.child=e.child,t=Tc.bind(null,e),o._reactRetry=t,null):(e=i.treeContext,oa=co(o.nextSibling),ra=t,aa=!0,ia=null,null!==e&&(Yo[Xo++]=Qo,Yo[Xo++]=Jo,Yo[Xo++]=Ko,Qo=e.id,Jo=e.overflow,Ko=t),t=Ls(t,r.children),t.flags|=4096,t)}(e,t,l,o,r,i,n);if(s){s=o.fallback,l=t.mode,r=(i=e.child).sibling;var c={mode:"hidden",children:o.children};return 1&l||t.child===i?(o=jc(i,c)).subtreeFlags=14680064&i.subtreeFlags:((o=t.child).childLanes=0,o.pendingProps=c,t.deletions=null),null!==r?s=jc(r,s):(s=Oc(s,l,n,null)).flags|=2,s.return=t,o.return=t,o.sibling=s,t.child=o,o=s,s=t.child,l=null===(l=e.child.memoizedState)?Ns(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},s.memoizedState=l,s.childLanes=e.childLanes&~n,t.memoizedState=Os,o}return e=(s=e.child).sibling,o=jc(s,{mode:"visible",children:o.children}),!(1&t.mode)&&(o.lanes=n),o.return=t,o.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=o,t.memoizedState=null,o}function Ls(e,t){return(t=Nc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Ds(e,t,n,r){return null!==r&&ga(r),Qa(t,e.child,null,n),(e=Ls(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function $s(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Ca(e.return,t,n)}function qs(e,t,n,r,o){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:o}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=o)}function Us(e,t,n){var r=t.pendingProps,o=r.revealOrder,a=r.tail;if(ws(e,t,r.children,n),2&(r=li.current))r=1&r|2,t.flags|=128;else{if(null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&$s(e,n,t);else if(19===e.tag)$s(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Io(li,r),1&t.mode)switch(o){case"forwards":for(n=t.child,o=null;null!==n;)null!==(e=n.alternate)&&null===ci(e)&&(o=n),n=n.sibling;null===(n=o)?(o=t.child,t.child=null):(o=n.sibling,n.sibling=null),qs(t,!1,o,n,a);break;case"backwards":for(n=null,o=t.child,t.child=null;null!==o;){if(null!==(e=o.alternate)&&null===ci(e)){t.child=o;break}e=o.sibling,o.sibling=n,n=o,o=e}qs(t,!0,n,null,a);break;case"together":qs(t,!1,null,null,void 0);break;default:t.memoizedState=null}else t.memoizedState=null;return t.child}function Vs(e,t){!(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Hs(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Nl|=t.lanes,!(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=jc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=jc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Ws(e,t){if(!aa)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Gs(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var o=e.child;null!==o;)n|=o.lanes|o.childLanes,r|=14680064&o.subtreeFlags,r|=14680064&o.flags,o.return=e,o=o.sibling;else for(o=e.child;null!==o;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags,r|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Ys(e,t,n){var r=t.pendingProps;switch(na(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Gs(t),null;case 1:case 17:return Ro(t.type)&&jo(),Gs(t),null;case 3:return r=t.stateNode,ai(),Ao(Fo),Ao(Mo),di(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(pa(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,null!==ia&&(sc(ia),ia=null))),Rs(e,t),Gs(t),null;case 5:si(t);var o=ri(ni.current);if(n=t.type,null!==e&&null!=t.stateNode)js(e,t,n,r,o),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(a(166));return Gs(t),null}if(e=ri(ei.current),pa(t)){r=t.stateNode,n=t.type;var i=t.memoizedProps;switch(r[ho]=t,r[fo]=i,e=!!(1&t.mode),n){case"dialog":Lr("cancel",r),Lr("close",r);break;case"iframe":case"object":case"embed":Lr("load",r);break;case"video":case"audio":for(o=0;o<Br.length;o++)Lr(Br[o],r);break;case"source":Lr("error",r);break;case"img":case"image":case"link":Lr("error",r),Lr("load",r);break;case"details":Lr("toggle",r);break;case"input":K(r,i),Lr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Lr("invalid",r);break;case"textarea":oe(r,i),Lr("invalid",r)}for(var l in ve(n,i),o=null,i)if(i.hasOwnProperty(l)){var c=i[l];"children"===l?"string"==typeof c?r.textContent!==c&&(!0!==i.suppressHydrationWarning&&Jr(r.textContent,c,e),o=["children",c]):"number"==typeof c&&r.textContent!==""+c&&(!0!==i.suppressHydrationWarning&&Jr(r.textContent,c,e),o=["children",""+c]):s.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Lr("scroll",r)}switch(n){case"input":W(r),Z(r,i,!0);break;case"textarea":W(r),ie(r);break;case"select":case"option":break;default:"function"==typeof i.onClick&&(r.onclick=Zr)}r=o,t.updateQueue=r,null!==r&&(t.flags|=4)}else{l=9===o.nodeType?o:o.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof r.is?e=l.createElement(n,{is:r.is}):(e=l.createElement(n),"select"===n&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,n),e[ho]=t,e[fo]=r,_s(e,t,!1,!1),t.stateNode=e;e:{switch(l=be(n,r),n){case"dialog":Lr("cancel",e),Lr("close",e),o=r;break;case"iframe":case"object":case"embed":Lr("load",e),o=r;break;case"video":case"audio":for(o=0;o<Br.length;o++)Lr(Br[o],e);o=r;break;case"source":Lr("error",e),o=r;break;case"img":case"image":case"link":Lr("error",e),Lr("load",e),o=r;break;case"details":Lr("toggle",e),o=r;break;case"input":K(e,r),o=X(e,r),Lr("invalid",e);break;case"option":default:o=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},o=N({},r,{value:void 0}),Lr("invalid",e);break;case"textarea":oe(e,r),o=re(e,r),Lr("invalid",e)}for(i in ve(n,o),c=o)if(c.hasOwnProperty(i)){var u=c[i];"style"===i?me(e,u):"dangerouslySetInnerHTML"===i?null!=(u=u?u.__html:void 0)&&de(e,u):"children"===i?"string"==typeof u?("textarea"!==n||""!==u)&&pe(e,u):"number"==typeof u&&pe(e,""+u):"suppressContentEditableWarning"!==i&&"suppressHydrationWarning"!==i&&"autoFocus"!==i&&(s.hasOwnProperty(i)?null!=u&&"onScroll"===i&&Lr("scroll",e):null!=u&&b(e,i,u,l))}switch(n){case"input":W(e),Z(e,r,!1);break;case"textarea":W(e),ie(e);break;case"option":null!=r.value&&e.setAttribute("value",""+V(r.value));break;case"select":e.multiple=!!r.multiple,null!=(i=r.value)?ne(e,!!r.multiple,i,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"==typeof o.onClick&&(e.onclick=Zr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Gs(t),null;case 6:if(e&&null!=t.stateNode)Bs(e,t,e.memoizedProps,r);else{if("string"!=typeof r&&null===t.stateNode)throw Error(a(166));if(n=ri(ni.current),ri(ei.current),pa(t)){if(r=t.stateNode,n=t.memoizedProps,r[ho]=t,(i=r.nodeValue!==n)&&null!==(e=ra))switch(e.tag){case 3:Jr(r.nodeValue,n,!!(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Jr(r.nodeValue,n,!!(1&e.mode))}i&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[ho]=t,t.stateNode=r}return Gs(t),null;case 13:if(Ao(li),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(aa&&null!==oa&&1&t.mode&&!(128&t.flags))ha(),fa(),t.flags|=98560,i=!1;else if(i=pa(t),null!==r&&null!==r.dehydrated){if(null===e){if(!i)throw Error(a(318));if(!(i=null!==(i=t.memoizedState)?i.dehydrated:null))throw Error(a(317));i[ho]=t}else fa(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Gs(t),i=!1}else null!==ia&&(sc(ia),ia=null),i=!0;if(!i)return 65536&t.flags?t:null}return 128&t.flags?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,1&t.mode&&(null===e||1&li.current?0===Bl&&(Bl=3):mc())),null!==t.updateQueue&&(t.flags|=4),Gs(t),null);case 4:return ai(),Rs(e,t),null===e&&qr(t.stateNode.containerInfo),Gs(t),null;case 10:return ka(t.type._context),Gs(t),null;case 19:if(Ao(li),null===(i=t.memoizedState))return Gs(t),null;if(r=!!(128&t.flags),null===(l=i.rendering))if(r)Ws(i,!1);else{if(0!==Bl||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(l=ci(e))){for(t.flags|=128,Ws(i,!1),null!==(r=l.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(i=n).flags&=14680066,null===(l=i.alternate)?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=l.childLanes,i.lanes=l.lanes,i.child=l.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=l.memoizedProps,i.memoizedState=l.memoizedState,i.updateQueue=l.updateQueue,i.type=l.type,e=l.dependencies,i.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Io(li,1&li.current|2),t.child}e=e.sibling}null!==i.tail&&Qe()>Ul&&(t.flags|=128,r=!0,Ws(i,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=ci(l))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Ws(i,!0),null===i.tail&&"hidden"===i.tailMode&&!l.alternate&&!aa)return Gs(t),null}else 2*Qe()-i.renderingStartTime>Ul&&1073741824!==n&&(t.flags|=128,r=!0,Ws(i,!1),t.lanes=4194304);i.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=i.last)?n.sibling=l:t.child=l,i.last=l)}return null!==i.tail?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=Qe(),t.sibling=null,n=li.current,Io(li,r?1&n|2:1&n),t):(Gs(t),null);case 22:case 23:return pc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&1&t.mode?!!(1073741824&Rl)&&(Gs(t),6&t.subtreeFlags&&(t.flags|=8192)):Gs(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}function Xs(e,t){switch(na(t),t.tag){case 1:return Ro(t.type)&&jo(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return ai(),Ao(Fo),Ao(Mo),di(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 5:return si(t),null;case 13:if(Ao(li),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));fa()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Ao(li),null;case 4:return ai(),null;case 10:return ka(t.type._context),null;case 22:case 23:return pc(),null;default:return null}}_s=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Rs=function(){},js=function(e,t,n,r){var o=e.memoizedProps;if(o!==r){e=t.stateNode,ri(ei.current);var a,i=null;switch(n){case"input":o=X(e,o),r=X(e,r),i=[];break;case"select":o=N({},o,{value:void 0}),r=N({},r,{value:void 0}),i=[];break;case"textarea":o=re(e,o),r=re(e,r),i=[];break;default:"function"!=typeof o.onClick&&"function"==typeof r.onClick&&(e.onclick=Zr)}for(u in ve(n,r),n=null,o)if(!r.hasOwnProperty(u)&&o.hasOwnProperty(u)&&null!=o[u])if("style"===u){var l=o[u];for(a in l)l.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(s.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var c=r[u];if(l=null!=o?o[u]:void 0,r.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(a in l)!l.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in c)c.hasOwnProperty(a)&&l[a]!==c[a]&&(n||(n={}),n[a]=c[a])}else n||(i||(i=[]),i.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(i=i||[]).push(u,c)):"children"===u?"string"!=typeof c&&"number"!=typeof c||(i=i||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(s.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&Lr("scroll",e),i||l===c||(i=[])):(i=i||[]).push(u,c))}n&&(i=i||[]).push("style",n);var u=i;(t.updateQueue=u)&&(t.flags|=4)}},Bs=function(e,t,n,r){n!==r&&(t.flags|=4)};var Ks=!1,Qs=!1,Js="function"==typeof WeakSet?WeakSet:Set,Zs=null;function el(e,t){var n=e.ref;if(null!==n)if("function"==typeof n)try{n(null)}catch(n){Ec(e,t,n)}else n.current=null}function tl(e,t,n){try{n()}catch(n){Ec(e,t,n)}}var nl=!1;function rl(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var o=r=r.next;do{if((o.tag&e)===e){var a=o.destroy;o.destroy=void 0,void 0!==a&&tl(t,n,a)}o=o.next}while(o!==r)}}function ol(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function al(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"==typeof t?t(e):t.current=e}}function il(e){var t=e.alternate;null!==t&&(e.alternate=null,il(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[ho],delete t[fo],delete t[mo],delete t[yo],delete t[vo])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function sl(e){return 5===e.tag||3===e.tag||4===e.tag}function ll(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||sl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function cl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=Zr));else if(4!==r&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}function ul(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(ul(e,t,n),e=e.sibling;null!==e;)ul(e,t,n),e=e.sibling}var dl=null,pl=!1;function hl(e,t,n){for(n=n.child;null!==n;)fl(e,t,n),n=n.sibling}function fl(e,t,n){if(at&&"function"==typeof at.onCommitFiberUnmount)try{at.onCommitFiberUnmount(ot,n)}catch(e){}switch(n.tag){case 5:Qs||el(n,t);case 6:var r=dl,o=pl;dl=null,hl(e,t,n),pl=o,null!==(dl=r)&&(pl?(e=dl,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):dl.removeChild(n.stateNode));break;case 18:null!==dl&&(pl?(e=dl,n=n.stateNode,8===e.nodeType?lo(e.parentNode,n):1===e.nodeType&&lo(e,n),qt(e)):lo(dl,n.stateNode));break;case 4:r=dl,o=pl,dl=n.stateNode.containerInfo,pl=!0,hl(e,t,n),dl=r,pl=o;break;case 0:case 11:case 14:case 15:if(!Qs&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){o=r=r.next;do{var a=o,i=a.destroy;a=a.tag,void 0!==i&&(2&a||4&a)&&tl(n,t,i),o=o.next}while(o!==r)}hl(e,t,n);break;case 1:if(!Qs&&(el(n,t),"function"==typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(e){Ec(n,t,e)}hl(e,t,n);break;case 21:hl(e,t,n);break;case 22:1&n.mode?(Qs=(r=Qs)||null!==n.memoizedState,hl(e,t,n),Qs=r):hl(e,t,n);break;default:hl(e,t,n)}}function gl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Js),t.forEach((function(t){var r=Mc.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function ml(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var o=n[r];try{var i=e,s=t,l=s;e:for(;null!==l;){switch(l.tag){case 5:dl=l.stateNode,pl=!1;break e;case 3:case 4:dl=l.stateNode.containerInfo,pl=!0;break e}l=l.return}if(null===dl)throw Error(a(160));fl(i,s,o),dl=null,pl=!1;var c=o.alternate;null!==c&&(c.return=null),o.return=null}catch(e){Ec(o,t,e)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)yl(t,e),t=t.sibling}function yl(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ml(t,e),vl(e),4&r){try{rl(3,e,e.return),ol(3,e)}catch(t){Ec(e,e.return,t)}try{rl(5,e,e.return)}catch(t){Ec(e,e.return,t)}}break;case 1:ml(t,e),vl(e),512&r&&null!==n&&el(n,n.return);break;case 5:if(ml(t,e),vl(e),512&r&&null!==n&&el(n,n.return),32&e.flags){var o=e.stateNode;try{pe(o,"")}catch(t){Ec(e,e.return,t)}}if(4&r&&null!=(o=e.stateNode)){var i=e.memoizedProps,s=null!==n?n.memoizedProps:i,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===i.type&&null!=i.name&&Q(o,i),be(l,s);var u=be(l,i);for(s=0;s<c.length;s+=2){var d=c[s],p=c[s+1];"style"===d?me(o,p):"dangerouslySetInnerHTML"===d?de(o,p):"children"===d?pe(o,p):b(o,d,p,u)}switch(l){case"input":J(o,i);break;case"textarea":ae(o,i);break;case"select":var h=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!i.multiple;var f=i.value;null!=f?ne(o,!!i.multiple,f,!1):h!==!!i.multiple&&(null!=i.defaultValue?ne(o,!!i.multiple,i.defaultValue,!0):ne(o,!!i.multiple,i.multiple?[]:"",!1))}o[fo]=i}catch(t){Ec(e,e.return,t)}}break;case 6:if(ml(t,e),vl(e),4&r){if(null===e.stateNode)throw Error(a(162));o=e.stateNode,i=e.memoizedProps;try{o.nodeValue=i}catch(t){Ec(e,e.return,t)}}break;case 3:if(ml(t,e),vl(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{qt(t.containerInfo)}catch(t){Ec(e,e.return,t)}break;case 4:default:ml(t,e),vl(e);break;case 13:ml(t,e),vl(e),8192&(o=e.child).flags&&(i=null!==o.memoizedState,o.stateNode.isHidden=i,!i||null!==o.alternate&&null!==o.alternate.memoizedState||(ql=Qe())),4&r&&gl(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?(Qs=(u=Qs)||d,ml(t,e),Qs=u):ml(t,e),vl(e),8192&r){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&1&e.mode)for(Zs=e,d=e.child;null!==d;){for(p=Zs=d;null!==Zs;){switch(f=(h=Zs).child,h.tag){case 0:case 11:case 14:case 15:rl(4,h,h.return);break;case 1:el(h,h.return);var g=h.stateNode;if("function"==typeof g.componentWillUnmount){r=h,n=h.return;try{t=r,g.props=t.memoizedProps,g.state=t.memoizedState,g.componentWillUnmount()}catch(e){Ec(r,n,e)}}break;case 5:el(h,h.return);break;case 22:if(null!==h.memoizedState){Sl(p);continue}}null!==f?(f.return=h,Zs=f):Sl(p)}d=d.sibling}e:for(d=null,p=e;;){if(5===p.tag){if(null===d){d=p;try{o=p.stateNode,u?"function"==typeof(i=o.style).setProperty?i.setProperty("display","none","important"):i.display="none":(l=p.stateNode,s=null!=(c=p.memoizedProps.style)&&c.hasOwnProperty("display")?c.display:null,l.style.display=ge("display",s))}catch(t){Ec(e,e.return,t)}}}else if(6===p.tag){if(null===d)try{p.stateNode.nodeValue=u?"":p.memoizedProps}catch(t){Ec(e,e.return,t)}}else if((22!==p.tag&&23!==p.tag||null===p.memoizedState||p===e)&&null!==p.child){p.child.return=p,p=p.child;continue}if(p===e)break e;for(;null===p.sibling;){if(null===p.return||p.return===e)break e;d===p&&(d=null),p=p.return}d===p&&(d=null),p.sibling.return=p.return,p=p.sibling}}break;case 19:ml(t,e),vl(e),4&r&&gl(e);case 21:}}function vl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(sl(n)){var r=n;break e}n=n.return}throw Error(a(160))}switch(r.tag){case 5:var o=r.stateNode;32&r.flags&&(pe(o,""),r.flags&=-33),ul(e,ll(e),o);break;case 3:case 4:var i=r.stateNode.containerInfo;cl(e,ll(e),i);break;default:throw Error(a(161))}}catch(t){Ec(e,e.return,t)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function bl(e,t,n){Zs=e,xl(e,t,n)}function xl(e,t,n){for(var r=!!(1&e.mode);null!==Zs;){var o=Zs,a=o.child;if(22===o.tag&&r){var i=null!==o.memoizedState||Ks;if(!i){var s=o.alternate,l=null!==s&&null!==s.memoizedState||Qs;s=Ks;var c=Qs;if(Ks=i,(Qs=l)&&!c)for(Zs=o;null!==Zs;)l=(i=Zs).child,22===i.tag&&null!==i.memoizedState?kl(o):null!==l?(l.return=i,Zs=l):kl(o);for(;null!==a;)Zs=a,xl(a,t,n),a=a.sibling;Zs=o,Ks=s,Qs=c}wl(e)}else 8772&o.subtreeFlags&&null!==a?(a.return=o,Zs=a):wl(e)}}function wl(e){for(;null!==Zs;){var t=Zs;if(8772&t.flags){var n=t.alternate;try{if(8772&t.flags)switch(t.tag){case 0:case 11:case 15:Qs||ol(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Qs)if(null===n)r.componentDidMount();else{var o=t.elementType===t.type?n.memoizedProps:ya(t.type,n.memoizedProps);r.componentDidUpdate(o,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;null!==i&&La(t,i,r);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}La(t,s,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var p=d.dehydrated;null!==p&&qt(p)}}}break;default:throw Error(a(163))}Qs||512&t.flags&&al(t)}catch(e){Ec(t,t.return,e)}}if(t===e){Zs=null;break}if(null!==(n=t.sibling)){n.return=t.return,Zs=n;break}Zs=t.return}}function Sl(e){for(;null!==Zs;){var t=Zs;if(t===e){Zs=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Zs=n;break}Zs=t.return}}function kl(e){for(;null!==Zs;){var t=Zs;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{ol(4,t)}catch(e){Ec(t,n,e)}break;case 1:var r=t.stateNode;if("function"==typeof r.componentDidMount){var o=t.return;try{r.componentDidMount()}catch(e){Ec(t,o,e)}}var a=t.return;try{al(t)}catch(e){Ec(t,a,e)}break;case 5:var i=t.return;try{al(t)}catch(e){Ec(t,i,e)}}}catch(e){Ec(t,t.return,e)}if(t===e){Zs=null;break}var s=t.sibling;if(null!==s){s.return=t.return,Zs=s;break}Zs=t.return}}var Cl,El=Math.ceil,Al=x.ReactCurrentDispatcher,Il=x.ReactCurrentOwner,Tl=x.ReactCurrentBatchConfig,Ml=0,Fl=null,zl=null,_l=0,Rl=0,jl=Eo(0),Bl=0,Ol=null,Nl=0,Pl=0,Ll=0,Dl=null,$l=null,ql=0,Ul=1/0,Vl=null,Hl=!1,Wl=null,Gl=null,Yl=!1,Xl=null,Kl=0,Ql=0,Jl=null,Zl=-1,ec=0;function tc(){return 6&Ml?Qe():-1!==Zl?Zl:Zl=Qe()}function nc(e){return 1&e.mode?2&Ml&&0!==_l?_l&-_l:null!==ma.transition?(0===ec&&(ec=gt()),ec):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Kt(e.type):1}function rc(e,t,n,r){if(50<Ql)throw Ql=0,Jl=null,Error(a(185));yt(e,n,r),2&Ml&&e===Fl||(e===Fl&&(!(2&Ml)&&(Pl|=n),4===Bl&&lc(e,_l)),oc(e,r),1===n&&0===Ml&&!(1&t.mode)&&(Ul=Qe()+500,Do&&Uo()))}function oc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,o=e.expirationTimes,a=e.pendingLanes;0<a;){var i=31-it(a),s=1<<i,l=o[i];-1===l?s&n&&!(s&r)||(o[i]=ht(s,t)):l<=t&&(e.expiredLanes|=s),a&=~s}}(e,t);var r=pt(e,e===Fl?_l:0);if(0===r)null!==n&&Ye(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Ye(n),1===t)0===e.tag?function(e){Do=!0,qo(e)}(cc.bind(null,e)):qo(cc.bind(null,e)),io((function(){!(6&Ml)&&Uo()})),n=null;else{switch(xt(r)){case 1:n=Ze;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Fc(n,ac.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function ac(e,t){if(Zl=-1,ec=0,6&Ml)throw Error(a(327));var n=e.callbackNode;if(kc()&&e.callbackNode!==n)return null;var r=pt(e,e===Fl?_l:0);if(0===r)return null;if(30&r||r&e.expiredLanes||t)t=yc(e,r);else{t=r;var o=Ml;Ml|=2;var i=gc();for(Fl===e&&_l===t||(Vl=null,Ul=Qe()+500,hc(e,t));;)try{bc();break}catch(t){fc(e,t)}Sa(),Al.current=i,Ml=o,null!==zl?t=0:(Fl=null,_l=0,t=Bl)}if(0!==t){if(2===t&&(0!==(o=ft(e))&&(r=o,t=ic(e,o))),1===t)throw n=Ol,hc(e,0),lc(e,r),oc(e,Qe()),n;if(6===t)lc(e,r);else{if(o=e.current.alternate,!(30&r||function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var o=n[r],a=o.getSnapshot;o=o.value;try{if(!sr(a(),o))return!1}catch(e){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(o)||(t=yc(e,r),2===t&&(i=ft(e),0!==i&&(r=i,t=ic(e,i))),1!==t)))throw n=Ol,hc(e,0),lc(e,r),oc(e,Qe()),n;switch(e.finishedWork=o,e.finishedLanes=r,t){case 0:case 1:throw Error(a(345));case 2:case 5:Sc(e,$l,Vl);break;case 3:if(lc(e,r),(130023424&r)===r&&10<(t=ql+500-Qe())){if(0!==pt(e,0))break;if(((o=e.suspendedLanes)&r)!==r){tc(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=ro(Sc.bind(null,e,$l,Vl),t);break}Sc(e,$l,Vl);break;case 4:if(lc(e,r),(4194240&r)===r)break;for(t=e.eventTimes,o=-1;0<r;){var s=31-it(r);i=1<<s,(s=t[s])>o&&(o=s),r&=~i}if(r=o,10<(r=(120>(r=Qe()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*El(r/1960))-r)){e.timeoutHandle=ro(Sc.bind(null,e,$l,Vl),r);break}Sc(e,$l,Vl);break;default:throw Error(a(329))}}}return oc(e,Qe()),e.callbackNode===n?ac.bind(null,e):null}function ic(e,t){var n=Dl;return e.current.memoizedState.isDehydrated&&(hc(e,t).flags|=256),2!==(e=yc(e,t))&&(t=$l,$l=n,null!==t&&sc(t)),e}function sc(e){null===$l?$l=e:$l.push.apply($l,e)}function lc(e,t){for(t&=~Ll,t&=~Pl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-it(t),r=1<<n;e[n]=-1,t&=~r}}function cc(e){if(6&Ml)throw Error(a(327));kc();var t=pt(e,0);if(!(1&t))return oc(e,Qe()),null;var n=yc(e,t);if(0!==e.tag&&2===n){var r=ft(e);0!==r&&(t=r,n=ic(e,r))}if(1===n)throw n=Ol,hc(e,0),lc(e,t),oc(e,Qe()),n;if(6===n)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Sc(e,$l,Vl),oc(e,Qe()),null}function uc(e,t){var n=Ml;Ml|=1;try{return e(t)}finally{0===(Ml=n)&&(Ul=Qe()+500,Do&&Uo())}}function dc(e){null!==Xl&&0===Xl.tag&&!(6&Ml)&&kc();var t=Ml;Ml|=1;var n=Tl.transition,r=bt;try{if(Tl.transition=null,bt=1,e)return e()}finally{bt=r,Tl.transition=n,!(6&(Ml=t))&&Uo()}}function pc(){Rl=jl.current,Ao(jl)}function hc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,oo(n)),null!==zl)for(n=zl.return;null!==n;){var r=n;switch(na(r),r.tag){case 1:null!=(r=r.type.childContextTypes)&&jo();break;case 3:ai(),Ao(Fo),Ao(Mo),di();break;case 5:si(r);break;case 4:ai();break;case 13:case 19:Ao(li);break;case 10:ka(r.type._context);break;case 22:case 23:pc()}n=n.return}if(Fl=e,zl=e=jc(e.current,null),_l=Rl=t,Bl=0,Ol=null,Ll=Pl=Nl=0,$l=Dl=null,null!==Ia){for(t=0;t<Ia.length;t++)if(null!==(r=(n=Ia[t]).interleaved)){n.interleaved=null;var o=r.next,a=n.pending;if(null!==a){var i=a.next;a.next=o,r.next=i}n.pending=r}Ia=null}return e}function fc(e,t){for(;;){var n=zl;try{if(Sa(),pi.current=is,vi){for(var r=gi.memoizedState;null!==r;){var o=r.queue;null!==o&&(o.pending=null),r=r.next}vi=!1}if(fi=0,yi=mi=gi=null,bi=!1,xi=0,Il.current=null,null===n||null===n.return){Bl=1,Ol=t,zl=null;break}e:{var i=e,s=n.return,l=n,c=t;if(t=_l,l.flags|=32768,null!==c&&"object"==typeof c&&"function"==typeof c.then){var u=c,d=l,p=d.tag;if(!(1&d.mode||0!==p&&11!==p&&15!==p)){var h=d.alternate;h?(d.updateQueue=h.updateQueue,d.memoizedState=h.memoizedState,d.lanes=h.lanes):(d.updateQueue=null,d.memoizedState=null)}var f=ys(s);if(null!==f){f.flags&=-257,vs(f,s,l,0,t),1&f.mode&&ms(i,u,t),c=u;var g=(t=f).updateQueue;if(null===g){var m=new Set;m.add(c),t.updateQueue=m}else g.add(c);break e}if(!(1&t)){ms(i,u,t),mc();break e}c=Error(a(426))}else if(aa&&1&l.mode){var y=ys(s);if(null!==y){!(65536&y.flags)&&(y.flags|=256),vs(y,s,l,0,t),ga(us(c,l));break e}}i=c=us(c,l),4!==Bl&&(Bl=2),null===Dl?Dl=[i]:Dl.push(i),i=s;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t,Na(i,fs(0,c,t));break e;case 1:l=c;var v=i.type,b=i.stateNode;if(!(128&i.flags||"function"!=typeof v.getDerivedStateFromError&&(null===b||"function"!=typeof b.componentDidCatch||null!==Gl&&Gl.has(b)))){i.flags|=65536,t&=-t,i.lanes|=t,Na(i,gs(i,l,t));break e}}i=i.return}while(null!==i)}wc(n)}catch(e){t=e,zl===n&&null!==n&&(zl=n=n.return);continue}break}}function gc(){var e=Al.current;return Al.current=is,null===e?is:e}function mc(){0!==Bl&&3!==Bl&&2!==Bl||(Bl=4),null===Fl||!(268435455&Nl)&&!(268435455&Pl)||lc(Fl,_l)}function yc(e,t){var n=Ml;Ml|=2;var r=gc();for(Fl===e&&_l===t||(Vl=null,hc(e,t));;)try{vc();break}catch(t){fc(e,t)}if(Sa(),Ml=n,Al.current=r,null!==zl)throw Error(a(261));return Fl=null,_l=0,Bl}function vc(){for(;null!==zl;)xc(zl)}function bc(){for(;null!==zl&&!Xe();)xc(zl)}function xc(e){var t=Cl(e.alternate,e,Rl);e.memoizedProps=e.pendingProps,null===t?wc(e):zl=t,Il.current=null}function wc(e){var t=e;do{var n=t.alternate;if(e=t.return,32768&t.flags){if(null!==(n=Xs(n,t)))return n.flags&=32767,void(zl=n);if(null===e)return Bl=6,void(zl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}else if(null!==(n=Ys(n,t,Rl)))return void(zl=n);if(null!==(t=t.sibling))return void(zl=t);zl=t=e}while(null!==t);0===Bl&&(Bl=5)}function Sc(e,t,n){var r=bt,o=Tl.transition;try{Tl.transition=null,bt=1,function(e,t,n,r){do{kc()}while(null!==Xl);if(6&Ml)throw Error(a(327));n=e.finishedWork;var o=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var i=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var o=31-it(n),a=1<<o;t[o]=0,r[o]=-1,e[o]=-1,n&=~a}}(e,i),e===Fl&&(zl=Fl=null,_l=0),!(2064&n.subtreeFlags)&&!(2064&n.flags)||Yl||(Yl=!0,Fc(tt,(function(){return kc(),null}))),i=!!(15990&n.flags),!!(15990&n.subtreeFlags)||i){i=Tl.transition,Tl.transition=null;var s=bt;bt=1;var l=Ml;Ml|=4,Il.current=null,function(e,t){if(eo=Vt,hr(e=pr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var o=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch(e){n=null;break e}var s=0,l=-1,c=-1,u=0,d=0,p=e,h=null;t:for(;;){for(var f;p!==n||0!==o&&3!==p.nodeType||(l=s+o),p!==i||0!==r&&3!==p.nodeType||(c=s+r),3===p.nodeType&&(s+=p.nodeValue.length),null!==(f=p.firstChild);)h=p,p=f;for(;;){if(p===e)break t;if(h===n&&++u===o&&(l=s),h===i&&++d===r&&(c=s),null!==(f=p.nextSibling))break;h=(p=h).parentNode}p=f}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(to={focusedElem:e,selectionRange:n},Vt=!1,Zs=t;null!==Zs;)if(e=(t=Zs).child,1028&t.subtreeFlags&&null!==e)e.return=t,Zs=e;else for(;null!==Zs;){t=Zs;try{var g=t.alternate;if(1024&t.flags)switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==g){var m=g.memoizedProps,y=g.memoizedState,v=t.stateNode,b=v.getSnapshotBeforeUpdate(t.elementType===t.type?m:ya(t.type,m),y);v.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var x=t.stateNode.containerInfo;1===x.nodeType?x.textContent="":9===x.nodeType&&x.documentElement&&x.removeChild(x.documentElement);break;default:throw Error(a(163))}}catch(e){Ec(t,t.return,e)}if(null!==(e=t.sibling)){e.return=t.return,Zs=e;break}Zs=t.return}g=nl,nl=!1}(e,n),yl(n,e),fr(to),Vt=!!eo,to=eo=null,e.current=n,bl(n,e,o),Ke(),Ml=l,bt=s,Tl.transition=i}else e.current=n;if(Yl&&(Yl=!1,Xl=e,Kl=o),i=e.pendingLanes,0===i&&(Gl=null),function(e){if(at&&"function"==typeof at.onCommitFiberRoot)try{at.onCommitFiberRoot(ot,e,void 0,!(128&~e.current.flags))}catch(e){}}(n.stateNode),oc(e,Qe()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)o=t[n],r(o.value,{componentStack:o.stack,digest:o.digest});if(Hl)throw Hl=!1,e=Wl,Wl=null,e;!!(1&Kl)&&0!==e.tag&&kc(),i=e.pendingLanes,1&i?e===Jl?Ql++:(Ql=0,Jl=e):Ql=0,Uo()}(e,t,n,r)}finally{Tl.transition=o,bt=r}return null}function kc(){if(null!==Xl){var e=xt(Kl),t=Tl.transition,n=bt;try{if(Tl.transition=null,bt=16>e?16:e,null===Xl)var r=!1;else{if(e=Xl,Xl=null,Kl=0,6&Ml)throw Error(a(331));var o=Ml;for(Ml|=4,Zs=e.current;null!==Zs;){var i=Zs,s=i.child;if(16&Zs.flags){var l=i.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Zs=u;null!==Zs;){var d=Zs;switch(d.tag){case 0:case 11:case 15:rl(8,d,i)}var p=d.child;if(null!==p)p.return=d,Zs=p;else for(;null!==Zs;){var h=(d=Zs).sibling,f=d.return;if(il(d),d===u){Zs=null;break}if(null!==h){h.return=f,Zs=h;break}Zs=f}}}var g=i.alternate;if(null!==g){var m=g.child;if(null!==m){g.child=null;do{var y=m.sibling;m.sibling=null,m=y}while(null!==m)}}Zs=i}}if(2064&i.subtreeFlags&&null!==s)s.return=i,Zs=s;else e:for(;null!==Zs;){if(2048&(i=Zs).flags)switch(i.tag){case 0:case 11:case 15:rl(9,i,i.return)}var v=i.sibling;if(null!==v){v.return=i.return,Zs=v;break e}Zs=i.return}}var b=e.current;for(Zs=b;null!==Zs;){var x=(s=Zs).child;if(2064&s.subtreeFlags&&null!==x)x.return=s,Zs=x;else e:for(s=b;null!==Zs;){if(2048&(l=Zs).flags)try{switch(l.tag){case 0:case 11:case 15:ol(9,l)}}catch(e){Ec(l,l.return,e)}if(l===s){Zs=null;break e}var w=l.sibling;if(null!==w){w.return=l.return,Zs=w;break e}Zs=l.return}}if(Ml=o,Uo(),at&&"function"==typeof at.onPostCommitFiberRoot)try{at.onPostCommitFiberRoot(ot,e)}catch(e){}r=!0}return r}finally{bt=n,Tl.transition=t}}return!1}function Cc(e,t,n){e=Ba(e,t=fs(0,t=us(n,t),1),1),t=tc(),null!==e&&(yt(e,1,t),oc(e,t))}function Ec(e,t,n){if(3===e.tag)Cc(e,e,n);else for(;null!==t;){if(3===t.tag){Cc(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===Gl||!Gl.has(r))){t=Ba(t,e=gs(t,e=us(n,e),1),1),e=tc(),null!==t&&(yt(t,1,e),oc(t,e));break}}t=t.return}}function Ac(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=tc(),e.pingedLanes|=e.suspendedLanes&n,Fl===e&&(_l&n)===n&&(4===Bl||3===Bl&&(130023424&_l)===_l&&500>Qe()-ql?hc(e,0):Ll|=n),oc(e,t)}function Ic(e,t){0===t&&(1&e.mode?(t=ut,!(130023424&(ut<<=1))&&(ut=4194304)):t=1);var n=tc();null!==(e=Fa(e,t))&&(yt(e,t,n),oc(e,n))}function Tc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Ic(e,n)}function Mc(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,o=e.memoizedState;null!==o&&(n=o.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(a(314))}null!==r&&r.delete(t),Ic(e,n)}function Fc(e,t){return Ge(e,t)}function zc(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function _c(e,t,n,r){return new zc(e,t,n,r)}function Rc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function jc(e,t){var n=e.alternate;return null===n?((n=_c(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Bc(e,t,n,r,o,i){var s=2;if(r=e,"function"==typeof e)Rc(e)&&(s=1);else if("string"==typeof e)s=5;else e:switch(e){case k:return Oc(n.children,o,i,t);case C:s=8,o|=8;break;case E:return(e=_c(12,n,t,2|o)).elementType=E,e.lanes=i,e;case M:return(e=_c(13,n,t,o)).elementType=M,e.lanes=i,e;case F:return(e=_c(19,n,t,o)).elementType=F,e.lanes=i,e;case R:return Nc(n,o,i,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case A:s=10;break e;case I:s=9;break e;case T:s=11;break e;case z:s=14;break e;case _:s=16,r=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=_c(s,n,t,o)).elementType=e,t.type=r,t.lanes=i,t}function Oc(e,t,n,r){return(e=_c(7,e,r,t)).lanes=n,e}function Nc(e,t,n,r){return(e=_c(22,e,r,t)).elementType=R,e.lanes=n,e.stateNode={isHidden:!1},e}function Pc(e,t,n){return(e=_c(6,e,null,t)).lanes=n,e}function Lc(e,t,n){return(t=_c(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Dc(e,t,n,r,o){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mt(0),this.expirationTimes=mt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mt(0),this.identifierPrefix=r,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function $c(e,t,n,r,o,a,i,s,l){return e=new Dc(e,t,n,s,l),1===t?(t=1,!0===a&&(t|=8)):t=0,a=_c(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},_a(a),e}function qc(e){if(!e)return To;e:{if(qe(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ro(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var n=e.type;if(Ro(n))return Oo(e,n,t)}return t}function Uc(e,t,n,r,o,a,i,s,l){return(e=$c(n,r,!0,e,0,a,0,s,l)).context=qc(null),n=e.current,(a=ja(r=tc(),o=nc(n))).callback=null!=t?t:null,Ba(n,a,o),e.current.lanes=o,yt(e,o,r),oc(e,r),e}function Vc(e,t,n,r){var o=t.current,a=tc(),i=nc(o);return n=qc(n),null===t.context?t.context=n:t.pendingContext=n,(t=ja(a,i)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Ba(o,t,i))&&(rc(e,o,i,a),Oa(e,o,i)),i}function Hc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Wc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Gc(e,t){Wc(e,t),(e=e.alternate)&&Wc(e,t)}Cl=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Fo.current)xs=!0;else{if(!(e.lanes&n||128&t.flags))return xs=!1,function(e,t,n){switch(t.tag){case 3:Fs(t),fa();break;case 5:ii(t);break;case 1:Ro(t.type)&&No(t);break;case 4:oi(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,o=t.memoizedProps.value;Io(va,r._currentValue),r._currentValue=o;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Io(li,1&li.current),t.flags|=128,null):n&t.child.childLanes?Ps(e,t,n):(Io(li,1&li.current),null!==(e=Hs(e,t,n))?e.sibling:null);Io(li,1&li.current);break;case 19:if(r=!!(n&t.childLanes),128&e.flags){if(r)return Us(e,t,n);t.flags|=128}if(null!==(o=t.memoizedState)&&(o.rendering=null,o.tail=null,o.lastEffect=null),Io(li,li.current),r)break;return null;case 22:case 23:return t.lanes=0,Es(e,t,n)}return Hs(e,t,n)}(e,t,n);xs=!!(131072&e.flags)}else xs=!1,aa&&1048576&t.flags&&ea(t,Go,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Vs(e,t),e=t.pendingProps;var o=_o(t,Mo.current);Ea(t,n),o=Ci(null,t,r,e,o,n);var i=Ei();return t.flags|=1,"object"==typeof o&&null!==o&&"function"==typeof o.render&&void 0===o.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ro(r)?(i=!0,No(t)):i=!1,t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null,_a(t),o.updater=qa,t.stateNode=o,o._reactInternals=t,Wa(t,r,e,n),t=Ms(null,t,r,!0,i,n)):(t.tag=0,aa&&i&&ta(t),ws(null,t,o,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Vs(e,t),e=t.pendingProps,r=(o=r._init)(r._payload),t.type=r,o=t.tag=function(e){if("function"==typeof e)return Rc(e)?1:0;if(null!=e){if((e=e.$$typeof)===T)return 11;if(e===z)return 14}return 2}(r),e=ya(r,e),o){case 0:t=Is(null,t,r,e,n);break e;case 1:t=Ts(null,t,r,e,n);break e;case 11:t=Ss(null,t,r,e,n);break e;case 14:t=ks(null,t,r,ya(r.type,e),n);break e}throw Error(a(306,r,""))}return t;case 0:return r=t.type,o=t.pendingProps,Is(e,t,r,o=t.elementType===r?o:ya(r,o),n);case 1:return r=t.type,o=t.pendingProps,Ts(e,t,r,o=t.elementType===r?o:ya(r,o),n);case 3:e:{if(Fs(t),null===e)throw Error(a(387));r=t.pendingProps,o=(i=t.memoizedState).element,Ra(e,t),Pa(t,r,null,n);var s=t.memoizedState;if(r=s.element,i.isDehydrated){if(i={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=i,t.memoizedState=i,256&t.flags){t=zs(e,t,r,n,o=us(Error(a(423)),t));break e}if(r!==o){t=zs(e,t,r,n,o=us(Error(a(424)),t));break e}for(oa=co(t.stateNode.containerInfo.firstChild),ra=t,aa=!0,ia=null,n=Ja(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fa(),r===o){t=Hs(e,t,n);break e}ws(e,t,r,n)}t=t.child}return t;case 5:return ii(t),null===e&&ua(t),r=t.type,o=t.pendingProps,i=null!==e?e.memoizedProps:null,s=o.children,no(r,o)?s=null:null!==i&&no(r,i)&&(t.flags|=32),As(e,t),ws(e,t,s,n),t.child;case 6:return null===e&&ua(t),null;case 13:return Ps(e,t,n);case 4:return oi(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Qa(t,null,r,n):ws(e,t,r,n),t.child;case 11:return r=t.type,o=t.pendingProps,Ss(e,t,r,o=t.elementType===r?o:ya(r,o),n);case 7:return ws(e,t,t.pendingProps,n),t.child;case 8:case 12:return ws(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,o=t.pendingProps,i=t.memoizedProps,s=o.value,Io(va,r._currentValue),r._currentValue=s,null!==i)if(sr(i.value,s)){if(i.children===o.children&&!Fo.current){t=Hs(e,t,n);break e}}else for(null!==(i=t.child)&&(i.return=t);null!==i;){var l=i.dependencies;if(null!==l){s=i.child;for(var c=l.firstContext;null!==c;){if(c.context===r){if(1===i.tag){(c=ja(-1,n&-n)).tag=2;var u=i.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}i.lanes|=n,null!==(c=i.alternate)&&(c.lanes|=n),Ca(i.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===i.tag)s=i.type===t.type?null:i.child;else if(18===i.tag){if(null===(s=i.return))throw Error(a(341));s.lanes|=n,null!==(l=s.alternate)&&(l.lanes|=n),Ca(s,n,t),s=i.sibling}else s=i.child;if(null!==s)s.return=i;else for(s=i;null!==s;){if(s===t){s=null;break}if(null!==(i=s.sibling)){i.return=s.return,s=i;break}s=s.return}i=s}ws(e,t,o.children,n),t=t.child}return t;case 9:return o=t.type,r=t.pendingProps.children,Ea(t,n),r=r(o=Aa(o)),t.flags|=1,ws(e,t,r,n),t.child;case 14:return o=ya(r=t.type,t.pendingProps),ks(e,t,r,o=ya(r.type,o),n);case 15:return Cs(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:ya(r,o),Vs(e,t),t.tag=1,Ro(r)?(e=!0,No(t)):e=!1,Ea(t,n),Va(t,r,o),Wa(t,r,o,n),Ms(null,t,r,!0,e,n);case 19:return Us(e,t,n);case 22:return Es(e,t,n)}throw Error(a(156,t.tag))};var Yc="function"==typeof reportError?reportError:function(e){console.error(e)};function Xc(e){this._internalRoot=e}function Kc(e){this._internalRoot=e}function Qc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Jc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Zc(){}function eu(e,t,n,r,o){var a=n._reactRootContainer;if(a){var i=a;if("function"==typeof o){var s=o;o=function(){var e=Hc(i);s.call(e)}}Vc(t,i,e,o)}else i=function(e,t,n,r,o){if(o){if("function"==typeof r){var a=r;r=function(){var e=Hc(i);a.call(e)}}var i=Uc(t,r,e,0,null,!1,0,"",Zc);return e._reactRootContainer=i,e[go]=i.current,qr(8===e.nodeType?e.parentNode:e),dc(),i}for(;o=e.lastChild;)e.removeChild(o);if("function"==typeof r){var s=r;r=function(){var e=Hc(l);s.call(e)}}var l=$c(e,0,!1,null,0,!1,0,"",Zc);return e._reactRootContainer=l,e[go]=l.current,qr(8===e.nodeType?e.parentNode:e),dc((function(){Vc(t,l,n,r)})),l}(n,t,e,o,r);return Hc(i)}Kc.prototype.render=Xc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));Vc(e,t,null,null)},Kc.prototype.unmount=Xc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;dc((function(){Vc(null,e,null,null)})),t[go]=null}},Kc.prototype.unstable_scheduleHydration=function(e){if(e){var t=Ct();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Rt.length&&0!==t&&t<Rt[n].priority;n++);Rt.splice(n,0,e),0===n&&Nt(e)}},wt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(vt(t,1|n),oc(t,Qe()),!(6&Ml)&&(Ul=Qe()+500,Uo()))}break;case 13:dc((function(){var t=Fa(e,1);if(null!==t){var n=tc();rc(t,e,1,n)}})),Gc(e,1)}},St=function(e){if(13===e.tag){var t=Fa(e,134217728);if(null!==t)rc(t,e,134217728,tc());Gc(e,134217728)}},kt=function(e){if(13===e.tag){var t=nc(e),n=Fa(e,t);if(null!==n)rc(n,e,t,tc());Gc(e,t)}},Ct=function(){return bt},Et=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},Se=function(e,t,n){switch(t){case"input":if(J(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var o=So(r);if(!o)throw Error(a(90));G(r),J(r,o)}}}break;case"textarea":ae(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Te=uc,Me=dc;var tu={usingClientEntryPoint:!1,Events:[xo,wo,So,Ae,Ie,uc]},nu={findFiberByHostInstance:bo,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},ru={bundleType:nu.bundleType,version:nu.version,rendererPackageName:nu.rendererPackageName,rendererConfig:nu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=He(e))?null:e.stateNode},findFiberByHostInstance:nu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ou=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ou.isDisabled&&ou.supportsFiber)try{ot=ou.inject(ru),at=ou}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Qc(t))throw Error(a(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:S,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Qc(e))throw Error(a(299));var n=!1,r="",o=Yc;return null!=t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(o=t.onRecoverableError)),t=$c(e,1,!1,null,0,n,0,r,o),e[go]=t.current,qr(8===e.nodeType?e.parentNode:e),new Xc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=null===(e=He(t))?null:e.stateNode},t.flushSync=function(e){return dc(e)},t.hydrate=function(e,t,n){if(!Jc(t))throw Error(a(200));return eu(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Qc(e))throw Error(a(405));var r=null!=n&&n.hydratedSources||null,o=!1,i="",s=Yc;if(null!=n&&(!0===n.unstable_strictMode&&(o=!0),void 0!==n.identifierPrefix&&(i=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Uc(t,null,e,1,null!=n?n:null,o,0,i,s),e[go]=t.current,qr(e),r)for(e=0;e<r.length;e++)o=(o=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,o]:t.mutableSourceEagerHydrationData.push(n,o);return new Kc(t)},t.render=function(e,t,n){if(!Jc(t))throw Error(a(200));return eu(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Jc(e))throw Error(a(40));return!!e._reactRootContainer&&(dc((function(){eu(null,null,e,!1,(function(){e._reactRootContainer=null,e[go]=null}))})),!0)},t.unstable_batchedUpdates=uc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Jc(n))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return eu(e,t,n,!1,r)},t.version="18.2.0-next-9e3b772b8-20220608"},338:(e,t,n)=>{var r=n(961);t.H=r.createRoot,r.hydrateRoot},961:(e,t,n)=>{!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=n(551)},799:(e,t)=>{
/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var n="function"==typeof Symbol&&Symbol.for,r=n?Symbol.for("react.element"):60103,o=n?Symbol.for("react.portal"):60106,a=n?Symbol.for("react.fragment"):60107,i=n?Symbol.for("react.strict_mode"):60108,s=n?Symbol.for("react.profiler"):60114,l=n?Symbol.for("react.provider"):60109,c=n?Symbol.for("react.context"):60110,u=n?Symbol.for("react.async_mode"):60111,d=n?Symbol.for("react.concurrent_mode"):60111,p=n?Symbol.for("react.forward_ref"):60112,h=n?Symbol.for("react.suspense"):60113,f=n?Symbol.for("react.suspense_list"):60120,g=n?Symbol.for("react.memo"):60115,m=n?Symbol.for("react.lazy"):60116,y=n?Symbol.for("react.block"):60121,v=n?Symbol.for("react.fundamental"):60117,b=n?Symbol.for("react.responder"):60118,x=n?Symbol.for("react.scope"):60119;function w(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type){case u:case d:case a:case s:case i:case h:return e;default:switch(e=e&&e.$$typeof){case c:case p:case m:case g:case l:return e;default:return t}}case o:return t}}}function S(e){return w(e)===d}t.AsyncMode=u,t.ConcurrentMode=d,t.ContextConsumer=c,t.ContextProvider=l,t.Element=r,t.ForwardRef=p,t.Fragment=a,t.Lazy=m,t.Memo=g,t.Portal=o,t.Profiler=s,t.StrictMode=i,t.Suspense=h,t.isAsyncMode=function(e){return S(e)||w(e)===u},t.isConcurrentMode=S,t.isContextConsumer=function(e){return w(e)===c},t.isContextProvider=function(e){return w(e)===l},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===r},t.isForwardRef=function(e){return w(e)===p},t.isFragment=function(e){return w(e)===a},t.isLazy=function(e){return w(e)===m},t.isMemo=function(e){return w(e)===g},t.isPortal=function(e){return w(e)===o},t.isProfiler=function(e){return w(e)===s},t.isStrictMode=function(e){return w(e)===i},t.isSuspense=function(e){return w(e)===h},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===a||e===d||e===s||e===i||e===h||e===f||"object"==typeof e&&null!==e&&(e.$$typeof===m||e.$$typeof===g||e.$$typeof===l||e.$$typeof===c||e.$$typeof===p||e.$$typeof===v||e.$$typeof===b||e.$$typeof===x||e.$$typeof===y)},t.typeOf=w},363:(e,t,n)=>{e.exports=n(799)},989:(e,t)=>{var n,r=Symbol.for("react.element"),o=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),c=Symbol.for("react.context"),u=Symbol.for("react.server_context"),d=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),h=Symbol.for("react.suspense_list"),f=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),m=Symbol.for("react.offscreen");
/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */function y(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type){case a:case s:case i:case p:case h:return e;default:switch(e=e&&e.$$typeof){case u:case c:case d:case g:case f:case l:return e;default:return t}}case o:return t}}}n=Symbol.for("react.module.reference")},737:(e,t,n)=>{n(989)},20:(e,t,n)=>{
/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var r=n(540),o=Symbol.for("react.element"),a=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,a={},c=null,u=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)i.call(t,r)&&!l.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===a[r]&&(a[r]=t[r]);return{$$typeof:o,type:e,key:c,ref:u,props:a,_owner:s.current}}t.Fragment=a,t.jsx=c,t.jsxs=c},287:(e,t)=>{
/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),h=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,m={};function y(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||f}function v(){}function b(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||f}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=y.prototype;var x=b.prototype=new v;x.constructor=b,g(x,y.prototype),x.isPureReactComponent=!0;var w=Array.isArray,S=Object.prototype.hasOwnProperty,k={current:null},C={key:!0,ref:!0,__self:!0,__source:!0};function E(e,t,r){var o,a={},i=null,s=null;if(null!=t)for(o in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(i=""+t.key),t)S.call(t,o)&&!C.hasOwnProperty(o)&&(a[o]=t[o]);var l=arguments.length-2;if(1===l)a.children=r;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];a.children=c}if(e&&e.defaultProps)for(o in l=e.defaultProps)void 0===a[o]&&(a[o]=l[o]);return{$$typeof:n,type:e,key:i,ref:s,props:a,_owner:k.current}}function A(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var I=/\/+/g;function T(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function M(e,t,o,a,i){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var l=!1;if(null===e)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case r:l=!0}}if(l)return i=i(l=e),e=""===a?"."+T(l,0):a,w(i)?(o="",null!=e&&(o=e.replace(I,"$&/")+"/"),M(i,t,o,"",(function(e){return e}))):null!=i&&(A(i)&&(i=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(i,o+(!i.key||l&&l.key===i.key?"":(""+i.key).replace(I,"$&/")+"/")+e)),t.push(i)),1;if(l=0,a=""===a?".":a+":",w(e))for(var c=0;c<e.length;c++){var u=a+T(s=e[c],c);l+=M(s,t,o,u,i)}else if(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=h&&e[h]||e["@@iterator"])?e:null}(e),"function"==typeof u)for(e=u.call(e),c=0;!(s=e.next()).done;)l+=M(s=s.value,t,o,u=a+T(s,c++),i);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function F(e,t,n){if(null==e)return e;var r=[],o=0;return M(e,r,"","",(function(e){return t.call(n,e,o++)})),r}function z(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var _={current:null},R={transition:null},j={ReactCurrentDispatcher:_,ReactCurrentBatchConfig:R,ReactCurrentOwner:k};function B(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:F,forEach:function(e,t,n){F(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return F(e,(function(){t++})),t},toArray:function(e){return F(e,(function(e){return e}))||[]},only:function(e){if(!A(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=o,t.Profiler=i,t.PureComponent=b,t.StrictMode=a,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=j,t.act=B,t.cloneElement=function(e,t,r){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var o=g({},e.props),a=e.key,i=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(i=t.ref,s=k.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)S.call(t,c)&&!C.hasOwnProperty(c)&&(o[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)o.children=r;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];o.children=l}return{$$typeof:n,type:e.type,key:a,ref:i,props:o,_owner:s}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=E,t.createFactory=function(e){var t=E.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=A,t.lazy=function(e){return{$$typeof:p,_payload:{_status:-1,_result:e},_init:z}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=R.transition;R.transition={};try{e()}finally{R.transition=t}},t.unstable_act=B,t.useCallback=function(e,t){return _.current.useCallback(e,t)},t.useContext=function(e){return _.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return _.current.useDeferredValue(e)},t.useEffect=function(e,t){return _.current.useEffect(e,t)},t.useId=function(){return _.current.useId()},t.useImperativeHandle=function(e,t,n){return _.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return _.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return _.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return _.current.useMemo(e,t)},t.useReducer=function(e,t,n){return _.current.useReducer(e,t,n)},t.useRef=function(e){return _.current.useRef(e)},t.useState=function(e){return _.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return _.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return _.current.useTransition()},t.version="18.3.1"},540:(e,t,n)=>{e.exports=n(287)},848:(e,t,n)=>{e.exports=n(20)},463:(e,t)=>{
/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,o=e[r];if(!(0<a(o,t)))break e;e[r]=t,e[n]=o,n=r}}function r(e){return 0===e.length?null:e[0]}function o(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,o=e.length,i=o>>>1;r<i;){var s=2*(r+1)-1,l=e[s],c=s+1,u=e[c];if(0>a(l,n))c<o&&0>a(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[s]=n,r=s);else{if(!(c<o&&0>a(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var i=performance;t.unstable_now=function(){return i.now()}}else{var s=Date,l=s.now();t.unstable_now=function(){return s.now()-l}}var c=[],u=[],d=1,p=null,h=3,f=!1,g=!1,m=!1,y="function"==typeof setTimeout?setTimeout:null,v="function"==typeof clearTimeout?clearTimeout:null,b="undefined"!=typeof setImmediate?setImmediate:null;function x(e){for(var t=r(u);null!==t;){if(null===t.callback)o(u);else{if(!(t.startTime<=e))break;o(u),t.sortIndex=t.expirationTime,n(c,t)}t=r(u)}}function w(e){if(m=!1,x(e),!g)if(null!==r(c))g=!0,R(S);else{var t=r(u);null!==t&&j(w,t.startTime-e)}}function S(e,n){g=!1,m&&(m=!1,v(A),A=-1),f=!0;var a=h;try{for(x(n),p=r(c);null!==p&&(!(p.expirationTime>n)||e&&!M());){var i=p.callback;if("function"==typeof i){p.callback=null,h=p.priorityLevel;var s=i(p.expirationTime<=n);n=t.unstable_now(),"function"==typeof s?p.callback=s:p===r(c)&&o(c),x(n)}else o(c);p=r(c)}if(null!==p)var l=!0;else{var d=r(u);null!==d&&j(w,d.startTime-n),l=!1}return l}finally{p=null,h=a,f=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var k,C=!1,E=null,A=-1,I=5,T=-1;function M(){return!(t.unstable_now()-T<I)}function F(){if(null!==E){var e=t.unstable_now();T=e;var n=!0;try{n=E(!0,e)}finally{n?k():(C=!1,E=null)}}else C=!1}if("function"==typeof b)k=function(){b(F)};else if("undefined"!=typeof MessageChannel){var z=new MessageChannel,_=z.port2;z.port1.onmessage=F,k=function(){_.postMessage(null)}}else k=function(){y(F,0)};function R(e){E=e,C||(C=!0,k())}function j(e,n){A=y((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){g||f||(g=!0,R(S))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(h){case 1:case 2:case 3:var t=3;break;default:t=h}var n=h;h=t;try{return e()}finally{h=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=h;h=e;try{return t()}finally{h=n}},t.unstable_scheduleCallback=function(e,o,a){var i=t.unstable_now();switch("object"==typeof a&&null!==a?a="number"==typeof(a=a.delay)&&0<a?i+a:i:a=i,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:d++,callback:o,priorityLevel:e,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>i?(e.sortIndex=a,n(u,e),null===r(c)&&e===r(u)&&(m?(v(A),A=-1):m=!0,j(w,a-i))):(e.sortIndex=s,n(c,e),g||f||(g=!0,R(S))),e},t.unstable_shouldYield=M,t.unstable_wrapCallback=function(e){var t=h;return function(){var n=h;h=t;try{return e.apply(this,arguments)}finally{h=n}}}},982:(e,t,n)=>{e.exports=n(463)},55:(e,t,n)=>{var r;n.d(t,{d:()=>r}),function(e){e.LanguageLearning="language-learning",e.GeneralTopic="general-topic"}(r||(r={}))},75:(e,t,n)=>{n.r(t),n.d(t,{correctLinguisticInfo:()=>j,createCardComponentsParallel:()=>E,createExamples:()=>S,createFastLinguisticInfo:()=>N,createFlashcard:()=>k,createFormatPreservingTranslationPrompt:()=>T,createLinguisticInfo:()=>A,createOptimizedLinguisticInfo:()=>P,createQualityLinguisticPrompt:()=>I,createTranscription:()=>C,createTranslation:()=>w,createValidatedLinguisticInfo:()=>z,getAIService:()=>b,getApiKeyForProvider:()=>x,runMultipleValidation:()=>O,validateLinguisticInfo:()=>R});var r,o=n(148),a=function(e,t,n){var r="".concat(e," - ");return r+=401===t?"Authentication error. Please check your API key.":429===t?"Rate limit exceeded. Please try again later.":500===t||503===t?"Service unavailable. The model might be overloaded or offline.":400===t?"Bad request. The input may be invalid.":"Error code ".concat(t,". ").concat(i(n))},i=function(e){if(!e)return"Unknown error";if(e.error){if("string"==typeof e.error)return e.error;if(e.error.message)return e.error.message;if(e.error.type)return"Error type: ".concat(e.error.type)}if(e.message)return e.message;try{return JSON.stringify(e)}catch(e){return"Unable to parse error details"}},s=n(743),l=n(504),c=(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),u=function(){return u=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},u.apply(this,arguments)},d=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},p=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},h=function(){function e(e,t){void 0===t&&(t=""),this.apiKey=e,this.modelName=t}return e.prototype.extractPlainText=function(e){if(!e)return null;var t=e.replace(/<\/?[^>]+(>|$)/g,"");return t=t.replace(/^#+\s+/gm,"").replace(/\*\*(.*?)\*\*/g,"$1").replace(/\*(.*?)\*/g,"$1").replace(/`(.*?)`/g,"$1").replace(/```[\s\S]*?```/g,"").replace(/\[(.*?)\]\((.*?)\)/g,"$1").trim()},e.prototype.getPrompts=function(){return{translate:function(e,t){return"Translate the following text to ".concat(t,': "').concat(e,'". \nOutput ONLY the direct translation, without any additional text, explanations, quotes, examples, or formatting.\nProvide the most common and appropriate translation. Only include multiple meanings if the word has distinctly different translations that are equally common.\nIf multiple translations are needed, separate them with commas (e.g., "\u043f\u0435\u0440\u0435\u0432\u043e\u04341, \u043f\u0435\u0440\u0435\u0432\u043e\u04342, \u043f\u0435\u0440\u0435\u0432\u043e\u04343").\nDo not include definitions, examples, notes, or part of speech information in English like (noun), (verb), (adjective), etc.\nOnly provide the clean translated word or phrase without any parenthetical information.')},examples:function(e,t){var n=t?"Give me exactly three example sentences using the word '".concat(e,"' in the language with code \"").concat(t,'".'):"Give me exactly three example sentences using the word '".concat(e,"' in its original language.");return"".concat(n,"\nEach sentence should show natural usage of '").concat(e,"' in that language.\nFormat your response as follows:\n1. [First example sentence here]\n2. [Second example sentence here] \n3. [Third example sentence here]\nDo not include definitions, explanations, or translations, ONLY the numbered example sentences as shown above.")},imageDescription:function(e){return'Create a short visual description of the word/concept "'.concat(e,'" for image generation.\nThe description should be concrete, visual, and focus on representational elements.\nKeep the description under 50 words and make sure it is purely descriptive without any formatting.')}}},e.prototype.translateText=function(e,t,n){return void 0===t&&(t="ru"),void 0===n&&(n=""),d(this,void 0,void 0,(function(){var r,o,a,i,s,c,u,d,h,f;return p(this,(function(p){switch(p.label){case 0:r=(0,l.cr)(),o=r.startRequest("Translating text","Converting your text to ".concat(t),"\u{1f30d}","#3B82F6"),p.label=1;case 1:return p.trys.push([1,3,,4]),r.setInProgress(o),a=this.getPrompts().translate(e,t),i=n?"".concat(a,". ").concat(n):a,[4,this.sendRequest(i)];case 2:return(s=p.sent())?(c=this.extractPlainText(s))&&(c=c.replace(/^translation[:\s-]*/i,"").replace(/^["']|["']$/g,"").replace(/^.*?:\s*/i,"").replace(/^\s*-\s*/,"").replace(/^translated\s*as\s*:?\s*/i,"").replace(/^\u043f\u0435\u0440\u0435\u0432\u043e\u0434\s*:?\s*/i,"").replace(/\s*definition:[\s\S]*$/i,"").replace(/\s*examples:[\s\S]*$/i,"").replace(/\s*example:[\s\S]*$/i,"").replace(/\s*example sentences:[\s\S]*$/i,"").replace(/\s*\u043f\u0440\u0438\u043c\u0435\u0440\u044b:[\s\S]*$/i,"").replace(/\s*\u043f\u0440\u0438\u043c\u0435\u0440:[\s\S]*$/i,"").replace(/\s*notes:[\s\S]*$/i,"").replace(/\s*\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435:[\s\S]*$/i,"").replace(/\s*here is the response[\s\S]*$/i,"").replace(/\s*\(adjective\)[\s\S]*$/i,"").replace(/\s*\(noun\)[\s\S]*$/i,"").replace(/\s*\(verb\)[\s\S]*$/i,"").replace(/\s*\(adverb\)[\s\S]*$/i,"").replace(/\s*\(preposition\)[\s\S]*$/i,"").replace(/\s*\(pronoun\)[\s\S]*$/i,"").replace(/\s*\(conjunction\)[\s\S]*$/i,"").replace(/\s*\(interjection\)[\s\S]*$/i,"").replace(/\s*\([^)]*\)[\s\S]*$/i,"").replace(/^the word[\s\S]*translated as[\s:]*/i,"").replace(/^\u0441\u043b\u043e\u0432\u043e\u0441\u043e\u0447\u0435\u0442\u0430\u043d\u0438\u0435[\s\S]*\u043f\u0435\u0440\u0435\u0432\u043e\u0434\u0438\u0442\u0441\u044f \u043a\u0430\u043a[\s:]*/i,"").replace(/^\u0441\u043b\u043e\u0432\u043e[\s\S]*\u043f\u0435\u0440\u0435\u0432\u043e\u0434\u0438\u0442\u0441\u044f \u043a\u0430\u043a[\s:]*/i,"").replace(/^.*?\u044d\u0442\u043e[\s:]*/i,"").replace(/^.*?\u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442[\s:]*/i,"").replace(/^.*?means[\s:]*/i,"").replace(/^the translation is[\s:]*/i,"").split("\n")[0].trim(),u=c.split(/\s+/),c.includes(",")?(d=c.split(",").map((function(e){return e.trim()})).filter((function(e){return e.length>0})).slice(0,3),c=d.join(", ")):u.length>8&&((h=e.split(/\s+/).length)<=5||u.length<=2*h||(console.log("Translation too long, trimming:",c),c=u.slice(0,8).join(" "))),!c&&s)?[2,s.split("\n")[0].trim()]:(console.log("Original translation:",s),console.log("Cleaned translation:",c),r.completeRequest(o),[2,c]):(r.errorRequest(o),[2,null]);case 3:throw f=p.sent(),console.error("Error during translation:",f),r.errorRequest(o),f;case 4:return[2]}}))}))},e.prototype.getExamples=function(e,t,n,r,o){return void 0===n&&(n=!1),void 0===r&&(r=""),d(this,void 0,void 0,(function(){var a,i,s,c,u,d,h,f,g,m,y,v,b,x,w,S,k;return p(this,(function(p){switch(p.label){case 0:a=(0,l.cr)(),i=a.startRequest("Creating example sentences",'Generating helpful examples for "'.concat(e,'"'),"\u{1f4a1}","#F59E0B"),p.label=1;case 1:return p.trys.push([1,10,,11]),a.setInProgress(i),s=this.getPrompts().examples(e,o),c=r?"".concat(s," ").concat(r.replace(/\{word\}/g,e)):s,[4,this.sendRequest(c)];case 2:if(!(u=p.sent()))throw new Error("Failed to generate examples. Please try again with a different word.");for(console.log("Raw examples response:",u),d=this.extractPlainText(u)||"",h=d.replace(/^[\s\S]*?((?:\d+\s*\.\s*|\u2022\s*|[\-\*]\s*).+$)/m,"$1").trim(),f=/(?:^|\n)(?:\d+\s*\.\s*|\u2022\s*|[\-\*]\s*)(.+?)(?=(?:\n+(?:\d+\s*\.\s*|\u2022\s*|[\-\*]\s*)|\n*$))/g,g=[],m=void 0;null!==(m=f.exec(h));)m[1]&&g.push(m[1].trim());0===g.length&&(g=h.split(/\n+/).map((function(e){return e.replace(/^\d+\s*\.\s*|^\s*\u2022\s*|^\s*[\-\*]\s*/,"").trim()})).filter((function(t){return t.length>0&&t.toLowerCase().includes(e.toLowerCase())})).slice(0,3)),0===g.length&&(g=h.split(/\n+/).map((function(e){return e.replace(/^\d+\s*\.\s*|^\s*\u2022\s*|^\s*[\-\*]\s*/,"").trim()})).filter((function(e){return e.length>0})).slice(0,3)),g=g.map((function(e){return e.replace(/^(example|sentence|\u043f\u0440\u0438\u043c\u0435\u0440|\u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u0435)[\s:]*/i,"").replace(/^["']|["']$/g,"")})),console.log("Processed examples:",g),y=[],v=0,b=g,p.label=3;case 3:if(!(v<b.length))return[3,9];if(!(x=b[v]).trim())return[3,8];if(w=null,!n)return[3,7];p.label=4;case 4:return p.trys.push([4,6,,7]),[4,this.translateText(x,t)];case 5:return w=p.sent(),[3,7];case 6:return S=p.sent(),console.error("Error translating example:",S),[3,7];case 7:if(y.push([x,w]),y.length>=3)return[3,9];p.label=8;case 8:return v++,[3,3];case 9:return 0===y.length?(console.warn("No examples were generated, but continuing with card creation"),a.completeRequest(i),[2,[]]):(a.completeRequest(i),[2,y]);case 10:throw k=p.sent(),console.error("Error getting examples:",k),a.errorRequest(i),k;case 11:return[2]}}))}))},e.prototype.getDescriptionImage=function(e,t){return void 0===t&&(t=""),d(this,void 0,void 0,(function(){var n,r,o,a,i,s,c;return p(this,(function(u){switch(u.label){case 0:n=(0,l.cr)(),r=n.startRequest("Crafting image description",'Creating detailed prompt for "'.concat(e,'" visualization'),"\u{1f3a8}","#EC4899"),u.label=1;case 1:return u.trys.push([1,3,,4]),n.setInProgress(r),o=this.getPrompts().imageDescription(e),a=t?"".concat(o," ").concat(t):o,[4,this.sendRequest(a)];case 2:if(!(i=u.sent()))throw n.errorRequest(r),new Error("Failed to generate image description. Please try again.");return s=this.extractPlainText(i),n.completeRequest(r),[2,s||i];case 3:throw c=u.sent(),console.error("Error generating image description:",c),n.errorRequest(r),c;case 4:return[2]}}))}))},e.prototype.generateAnkiFront=function(e){return d(this,void 0,void 0,(function(){var t,n,r,o,a,i;return p(this,(function(s){switch(s.label){case 0:t=(0,l.cr)(),n=t.startRequest("Creating question","Crafting an effective question for your flashcard","\u2753","#10B981"),s.label=1;case 1:return s.trys.push([1,3,,4]),t.setInProgress(n),r='For the word or phrase "'.concat(e,'", provide ONLY the word itself without any pronunciation or additional formatting.\nJust return the clean word/phrase as it should appear on the front of an Anki card.\nFor example: if input is "hello", return "hello"\nIf input is "beautiful", return "beautiful"\nYour response should contain ONLY the word/phrase, no pronunciation, no IPA, no additional text.'),[4,this.sendRequest(r)];case 2:return(o=s.sent())?(a=(a=this.extractPlainText(o)||o).split("\n")[0].replace(/^["']|["']$/g,"").replace(/\/.*?\//g,"").replace(/\[.*?\]/g,"").replace(/\(.*?\)/g,"").replace(/^front:[\s:]*/i,"").replace(/^word:[\s:]*/i,"").trim(),console.log("Front card response:",a),t.completeRequest(n),[2,a||e]):(t.errorRequest(n),[2,e]);case 3:return i=s.sent(),console.error("Error generating Anki front:",i),t.errorRequest(n),[2,e];case 4:return[2]}}))}))},e.prototype.createTranscription=function(e,t,n){return d(this,void 0,void 0,(function(){var r,o,a,i,s,c;return p(this,(function(u){switch(u.label){case 0:r=(0,l.cr)(),o=r.startRequest("Creating transcription",'Generating pronunciation for "'.concat(e,'"'),"\u{1f524}","#8B5CF6"),u.label=1;case 1:return u.trys.push([1,3,,4]),r.setInProgress(o),a=this.createTranscriptionPrompt(e,t,n),[4,this.sendRequest(a)];case 2:return(i=u.sent())?(s=this.parseTranscriptionResponse(i),r.completeRequest(o),[2,s]):(r.errorRequest(o),[2,null]);case 3:return c=u.sent(),console.error("Error creating transcription:",c),r.errorRequest(o),[2,null];case 4:return[2]}}))}))},e.prototype.createTranscriptionPrompt=function(e,t,n){return'Create transcriptions for the word/phrase "'.concat(e,'" (in ').concat(t,"):\n\n1. User language transcription: Show how to pronounce this word using ").concat(n,' phonetics/script\n2. IPA transcription: International Phonetic Alphabet notation\n\nIMPORTANT:\n- For user language: Write how "').concat(e,'" sounds using ').concat(n," pronunciation system\n- For IPA: Use proper IPA symbols [\u02c8 \u02cc \u0259 \u026a \u025b \xe6 \u0251 \u0254 \u028a \u028c \u03b8 \xf0 \u0283 \u0292 \u02a7 \u02a4 \u014b etc.]\n- Format exactly as shown below:\n\nUSER_LANG: [how the word sounds in ").concat(n,']\nIPA: [\u02c8a\u026a.pi.e\u026a notation]\n\nExample for Russian "\u043a\u043e\u0440\u043e\u0442\u043a\u0430\u044f" with Spanish user language:\nUSER_LANG: korotkaya\nIPA: [k\u0259\u02c8rotk\u0259j\u0259]\n\nProvide ONLY the two lines as shown above, no additional text.')},e.prototype.parseTranscriptionResponse=function(e){var t=this.extractPlainText(e)||e,n=null,r=null,o=t.match(/USER_LANG:\s*(.+)/i);o&&(n=o[1].trim());var a=t.match(/IPA:\s*(.+)/i);return a&&(r=a[1].trim().replace(/^\[|\]$/g,"").replace(/^\/|\/$/g,""))&&!r.startsWith("[")&&(r="[".concat(r,"]")),{userLanguageTranscription:n,ipaTranscription:r}},e}(),f=function(e){function t(t,n){void 0===n&&(n="gpt-5-nano");var r=e.call(this,t,n)||this;return r.openai=new s.z4({apiKey:t,dangerouslyAllowBrowser:!0}),r}return c(t,e),t.prototype.sendRequest=function(e,t){var n,r,o;return void 0===t&&(t={}),d(this,void 0,void 0,(function(){var a,i;return p(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this.openai.chat.completions.create(u({model:this.modelName,messages:[{role:"user",content:e}]},t))];case 1:return a=s.sent(),[2,(null===(o=null===(r=null===(n=a.choices[0])||void 0===n?void 0:n.message)||void 0===r?void 0:r.content)||void 0===o?void 0:o.trim())||null];case 2:throw i=s.sent(),console.error("Error in OpenAI request:",i),i;case 3:return[2]}}))}))},t.prototype.getImageUrl=function(e){var t,n;return d(this,void 0,void 0,(function(){var r,o,a,i,s;return p(this,(function(c){switch(c.label){case 0:r=(0,l.cr)(),o=r.startRequest("Generating image","Creating beautiful illustration with AI","\u{1f5bc}\ufe0f","#6366F1"),c.label=1;case 1:return c.trys.push([1,3,,4]),r.setInProgress(o),[4,this.openai.images.generate({model:"dall-e-3",prompt:e,n:1,size:"1024x1024"})];case 2:return a=c.sent(),(i=(null===(n=null===(t=a.data)||void 0===t?void 0:t[0])||void 0===n?void 0:n.url)||null)?r.completeRequest(o):r.errorRequest(o),[2,i];case 3:throw s=c.sent(),console.error("Error generating image with OpenAI:",s),r.errorRequest(o),s;case 4:return[2]}}))}))},t.prototype.getOptimizedImageUrl=function(e,t){return void 0===t&&(t=""),d(this,void 0,void 0,(function(){var r,o;return p(this,(function(a){switch(a.label){case 0:return[4,Promise.resolve().then(n.bind(n,456))];case 1:r=a.sent().getOptimizedImageUrl,a.label=2;case 2:return a.trys.push([2,4,,5]),[4,r(this.openai,this.apiKey,e,t)];case 3:return[2,a.sent()];case 4:throw o=a.sent(),console.error("Error generating optimized image:",o),o;case 5:return[2]}}))}))},t.prototype.extractKeyTerms=function(e){return d(this,void 0,void 0,(function(){var t,n,r,o;return p(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),t="You are a helpful language learning assistant. Extract key terms from the text that would be useful to learn as flashcards. Limit to 5 most important terms max. Return only the terms, one per line, without any additional text or formatting.",[4,this.sendRequest(t,{messages:[{role:"system",content:t},{role:"user",content:e}]})];case 1:return n=a.sent(),(r=n||"")?[2,r.split("\n").map((function(e){return e.trim()})).filter((function(e){return e.length>0}))]:[2,[]];case 2:return o=a.sent(),console.error("Error extracting key terms with OpenAI:",o),[2,[]];case 3:return[2]}}))}))},t.prototype.createChatCompletion=function(e,t,n){var r,o,a;return d(this,void 0,void 0,(function(){var e,i,s,c,u,d;return p(this,(function(p){switch(p.label){case 0:e=(0,l.cr)(),i=e.startRequest((null==n?void 0:n.title)||"Generating content",(null==n?void 0:n.subtitle)||"AI is processing your request",(null==n?void 0:n.icon)||"\u{1f916}",(null==n?void 0:n.color)||"#3B82F6"),p.label=1;case 1:return p.trys.push([1,3,,4]),e.setInProgress(i),s=t.map((function(e){return{role:e.role,content:e.content}})),[4,this.openai.chat.completions.create({model:this.modelName,messages:s})];case 2:return c=p.sent(),(u=(null===(a=null===(o=null===(r=c.choices[0])||void 0===r?void 0:r.message)||void 0===o?void 0:o.content)||void 0===a?void 0:a.trim())||"")?(e.completeRequest(i),[2,{content:u}]):(e.errorRequest(i),[2,null]);case 3:throw d=p.sent(),console.error("Error in OpenAI chat completion:",d),e.errorRequest(i),d;case 4:return[2]}}))}))},t}(h),g=function(e){function t(t,n){void 0===n&&(n="llama3-8b-8192");var r=e.call(this,t,n)||this;return r.apiBaseUrl="https://api.groq.com/openai/v1",r}return c(t,e),t.prototype.sendRequest=function(e,t){var n,r,o,i,s;return void 0===t&&(t={}),d(this,void 0,void 0,(function(){var t,l,c,u;return p(this,(function(d){switch(d.label){case 0:if(d.trys.push([0,5,,6]),!this.apiKey)throw new Error("Groq API key is missing. Please check your settings.");return[4,fetch("".concat(this.apiBaseUrl,"/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)},body:JSON.stringify({model:this.modelName,messages:[{role:"user",content:e}]})})];case 1:return(t=d.sent()).ok?[3,3]:[4,t.json()];case 2:throw l=d.sent(),new Error(a("Groq API Error",t.status,l));case 3:return[4,t.json()];case 4:return c=d.sent(),[2,null!==(s=null===(i=null===(o=null===(r=null===(n=c.choices)||void 0===n?void 0:n[0])||void 0===r?void 0:r.message)||void 0===o?void 0:o.content)||void 0===i?void 0:i.trim())&&void 0!==s?s:null];case 5:throw u=d.sent(),console.error("Error in Groq API request:",u),u;case 6:return[2]}}))}))},t.prototype.getImageUrl=function(){throw new Error("Image generation is not supported by Groq.")},t.prototype.extractKeyTerms=function(e){return d(this,void 0,void 0,(function(){var t,n,r,o;return p(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),t="You are a helpful language learning assistant. Extract key terms from the text that would be useful to learn as flashcards. Limit to 5 most important terms max. Return only the terms, one per line, without any additional text or formatting.",[4,this.sendRequest(t,{messages:[{role:"system",content:t},{role:"user",content:e}]})];case 1:return n=a.sent(),(r=n||"")?[2,r.split("\n").map((function(e){return e.trim()})).filter((function(e){return e.length>0}))]:[2,[]];case 2:return o=a.sent(),console.error("Error extracting key terms with Groq:",o),[2,[]];case 3:return[2]}}))}))},t.prototype.createChatCompletion=function(e,t,n){var r,o,i,s,c;return d(this,void 0,void 0,(function(){var e,u,d,h,f,g,m;return p(this,(function(p){switch(p.label){case 0:e=(0,l.cr)(),u=e.startRequest((null==n?void 0:n.title)||"Generating content",(null==n?void 0:n.subtitle)||"AI is processing your request",(null==n?void 0:n.icon)||"\u{1f916}",(null==n?void 0:n.color)||"#3B82F6"),p.label=1;case 1:if(p.trys.push([1,6,,7]),e.setInProgress(u),!this.apiKey)throw new Error("Groq API key is missing. Please check your settings.");return[4,fetch("".concat(this.apiBaseUrl,"/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)},body:JSON.stringify({model:this.modelName,messages:t})})];case 2:return(d=p.sent()).ok?[3,4]:[4,d.json()];case 3:throw h=p.sent(),new Error(a("Groq API Error",d.status,h));case 4:return[4,d.json()];case 5:return f=p.sent(),(g=null!==(c=null===(s=null===(i=null===(o=null===(r=f.choices)||void 0===r?void 0:r[0])||void 0===o?void 0:o.message)||void 0===i?void 0:i.content)||void 0===s?void 0:s.trim())&&void 0!==c?c:"")?(e.completeRequest(u),[2,{content:g}]):(e.errorRequest(u),[2,null]);case 6:throw m=p.sent(),console.error("Error in Groq chat completion:",m),e.errorRequest(u),m;case 7:return[2]}}))}))},t}(h),m=function(e,t,n){switch(void 0===n&&(n=""),e){case o.l.OpenAI:return new f(t,n||"gpt-5-nano");case o.l.Groq:return new g(t,n||"llama3-8b-8192");default:return new f(t,n||"gpt-5-nano")}},y=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},v=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},b=function(e){return function(e){return{translateText:function(t,n,r,o,a){return void 0===r&&(r="ru"),void 0===o&&(o=""),y(void 0,void 0,void 0,(function(){return v(this,(function(i){if(null==a?void 0:a.aborted)throw new Error("Request cancelled");return[2,m(e,t).translateText(n,r,o)]}))}))},getExamples:function(t,n,r,o,a,i,s){return void 0===o&&(o=!1),void 0===a&&(a=""),y(void 0,void 0,void 0,(function(){return v(this,(function(l){if(null==s?void 0:s.aborted)throw new Error("Request cancelled");return[2,m(e,t).getExamples(n,r,o,a,i)]}))}))},getDescriptionImage:function(t,n,r,o){return void 0===r&&(r=""),y(void 0,void 0,void 0,(function(){return v(this,(function(a){if(null==o?void 0:o.aborted)throw new Error("Request cancelled");return[2,m(e,t).getDescriptionImage(n,r)]}))}))},getImageUrl:function(t,n){return y(void 0,void 0,void 0,(function(){var r;return v(this,(function(o){return[2,(r=m(e,t)).getImageUrl?r.getImageUrl(n):null]}))}))},getOptimizedImageUrl:function(t,n,r){return y(void 0,void 0,void 0,(function(){var o;return v(this,(function(a){return[2,(o=m(e,t)).getOptimizedImageUrl?o.getOptimizedImageUrl(n,r):null]}))}))},generateAnkiFront:function(t,n,r){return y(void 0,void 0,void 0,(function(){return v(this,(function(o){if(null==r?void 0:r.aborted)throw new Error("Request cancelled");return[2,m(e,t).generateAnkiFront(n)]}))}))},extractKeyTerms:function(t,n){return y(void 0,void 0,void 0,(function(){return v(this,(function(r){return[2,m(e,t).extractKeyTerms(n)]}))}))},createChatCompletion:function(t,n,r){return y(void 0,void 0,void 0,(function(){var o;return v(this,(function(a){return(o=m(e,t)).createChatCompletion?[2,o.createChatCompletion(t,n,r)]:(console.error("createChatCompletion not implemented in the provider"),[2,null])}))}))},createTranscription:function(t,n,r,o){return y(void 0,void 0,void 0,(function(){return v(this,(function(a){return[2,m(e,t).createTranscription(n,r,o)]}))}))}}}(e)},x=function(e,t,n){switch(void 0===n&&(n=""),e){case o.l.OpenAI:return t;case o.l.Groq:return n;default:return t}},w=function(e,t,n,r,o,a,i){return y(void 0,void 0,void 0,(function(){var a,s;return v(this,(function(l){switch(l.label){case 0:if(l.trys.push([0,2,,3]),!t)throw new Error("API key is missing. Please check your settings.");return[4,e.translateText(t,n,r,o,i)];case 1:return a=l.sent(),[2,{original:n,translated:a}];case 2:throw s=l.sent(),console.error("Error in unified translation:",s),s instanceof Error?s:new Error("Failed to translate text. Please check your API key and settings.");case 3:return[2]}}))}))},S=function(e,t,n,r,o,a,i,s){return void 0===o&&(o=!1),y(void 0,void 0,void 0,(function(){var l;return v(this,(function(c){switch(c.label){case 0:if(c.trys.push([0,2,,3]),!t)throw new Error("API key is missing. Please check your settings.");return[4,e.getExamples(t,n,r,o,a,i,s)];case 1:return[2,c.sent().map((function(e){return{original:e[0],translated:e[1]}}))];case 2:throw l=c.sent(),console.error("Error in unified examples generation:",l),l instanceof Error?l:new Error("Failed to generate examples. Please check your API key and settings.");case 3:return[2]}}))}))},k=function(e,t,n,r){return y(void 0,void 0,void 0,(function(){var o,a;return v(this,(function(i){switch(i.label){case 0:if(i.trys.push([0,2,,3]),!t)throw new Error("API key is missing. Please check your settings.");return[4,e.generateAnkiFront(t,n,r)];case 1:if(!(o=i.sent()))throw new Error("Failed to generate flashcard content. Please try again or check your API key.");return[2,{front:o}];case 2:throw a=i.sent(),console.error("Error in unified flashcard creation:",a),a instanceof Error?a:new Error("Failed to create flashcard. Please check your API key and settings.");case 3:return[2]}}))}))},C=function(e,t,n,r,o){return void 0===o&&(o="ru"),y(void 0,void 0,void 0,(function(){var a,i;return v(this,(function(s){switch(s.label){case 0:if(s.trys.push([0,2,,3]),!t)throw new Error("API key is missing. Please check your settings.");return[4,e.createTranscription(t,n,r,o)];case 1:if(!(a=s.sent()))throw new Error("Failed to generate transcription. Please try again or check your API key.");return[2,a];case 2:throw i=s.sent(),console.error("Error in unified transcription creation:",i),i instanceof Error?i:new Error("Failed to create transcription. Please check your API key and settings.");case 3:return[2]}}))}))},E=function(e,t,n,r,o,a,i,s,l){return void 0===i&&(i=!1),y(void 0,void 0,void 0,(function(){var c,u,d,p,h,f,g,m,b,x,C;return v(this,(function(E){switch(E.label){case 0:return c=Date.now(),console.log("\u{1f680} Starting parallel card component creation..."),u=[],(d=[]).push((A=function(){return w(e,t,n,r,o,a,s)},void 0===I&&(I=2),void 0===T&&(T=1e3),y(void 0,void 0,void 0,(function(){var e,t,n,r;return v(this,(function(o){switch(o.label){case 0:t=function(t){var n,r,o;return v(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,4]),n={},[4,A()];case 1:return[2,(n.value=a.sent(),n)];case 2:if(r=a.sent(),(e=r).message.includes("quota")||e.message.includes("cancelled")||e.message.includes("aborted"))throw e;if(t===I)throw e;return o=T*Math.pow(2,t),console.log("Retry attempt ".concat(t+1,"/").concat(I," after ").concat(o,"ms delay")),[4,new Promise((function(e){return setTimeout(e,o)}))];case 3:return a.sent(),[3,4];case 4:return[2]}}))},n=0,o.label=1;case 1:return n<=I?[5,t(n)]:[3,4];case 2:if("object"==typeof(r=o.sent()))return[2,r.value];o.label=3;case 3:return n++,[3,1];case 4:throw e}}))}))).then((function(e){return{type:"translation",result:e}})).catch((function(e){return{type:"translation",error:e.message}}))),d.push(S(e,t,n,r,!0,o,a,s).then((function(e){return{type:"examples",result:e}})).catch((function(e){return{type:"examples",error:e.message}}))),d.push(k(e,t,n,s).then((function(e){return{type:"flashcard",result:e}})).catch((function(e){return{type:"flashcard",error:e.message}}))),a&&d.push(N(e,t,n,a,r).then((function(e){return{type:"linguisticInfo",result:e.linguisticInfo}})).catch((function(e){return{type:"linguisticInfo",error:e.message}}))),i&&"off"!==l&&(p=function(n){return y(void 0,void 0,void 0,(function(){var r,o,a,i,s,l;return v(this,(function(c){switch(c.label){case 0:if(!n||0===n.trim().length)return[2,{shouldGenerate:!1,reason:"No text provided"}];c.label=1;case 1:return c.trys.push([1,3,,4]),r='Analyze this word/phrase and determine if a visual image would be helpful for language learning: "'.concat(n,'"\n\nConsider these criteria:\n- Concrete objects, animals, places, foods, tools, vehicles = YES\n- Abstract concepts, emotions, actions, grammar terms = NO\n- People, professions, activities that can be visualized = YES\n- Numbers, prepositions, conjunctions, abstract ideas = NO\n\nRespond with ONLY "YES" or "NO" followed by a brief reason (max 10 words).\nFormat: "YES - concrete object that can be visualized" or "NO - abstract concept"'),[4,e.createChatCompletion(t,[{role:"user",content:r}])];case 2:return(o=c.sent())&&o.content?(a=o.content.trim(),i=a.toUpperCase().startsWith("YES"),s=a.includes(" - ")?a.split(" - ")[1]:"AI analysis",console.log('\u{1f916} Smart image analysis for "'.concat(n,'": ').concat(i?"YES":"NO"," - ").concat(s)),[2,{shouldGenerate:i,reason:s}]):[2,{shouldGenerate:!1,reason:"AI analysis failed"}];case 3:return l=c.sent(),console.error("Error analyzing text for image generation:",l),[2,{shouldGenerate:!1,reason:"Analysis error"}];case 4:return[2]}}))}))},h=function(){return y(void 0,void 0,void 0,(function(){var r,o,a,i;return v(this,(function(s){switch(s.label){case 0:if(r="always"===l,o="","smart"!==l)return[3,4];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,p(n)];case 2:return a=s.sent(),r=a.shouldGenerate,o=a.reason,[3,4];case 3:return i=s.sent(),console.error("Error in Smart analysis:",i),r=!1,o="Analysis failed",[3,4];case 4:return r?e.getOptimizedImageUrl?[4,e.getOptimizedImageUrl(t,n)]:[3,6]:[3,9];case 5:return[2,s.sent()];case 6:return e.getImageUrl?[4,e.getImageUrl(t,n)]:[3,8];case 7:return[2,s.sent()];case 8:return[3,10];case 9:"smart"===l&&console.log('\u{1f6ab} No image needed for "'.concat(n,'": ').concat(o)),s.label=10;case 10:return[2,null]}}))}))},d.push(h().then((function(e){return{type:"imageUrl",result:e}})).catch((function(e){return{type:"imageUrl",error:e.message}})))),[4,Promise.all(d)];case 1:for(f=E.sent(),g={errors:u},m=0,b=f;m<b.length;m++){if(x=b[m],null==s?void 0:s.aborted)throw new Error("Card creation was cancelled by user");"error"in x?u.push({component:x.type,error:x.error}):g[x.type]=x.result}return C=Date.now()-c,console.log("\u26a1 Parallel card creation completed in ".concat(C,"ms")),console.log("\u{1f4ca} Success: ".concat(Object.keys(g).length-1,"/").concat(d.length,", Errors: ").concat(u.length)),[2,g]}var A,I,T}))}))};function A(e,t,n,r,o){return void 0===o&&(o="ru"),y(this,void 0,void 0,(function(){var a,i;return v(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),console.log('Creating validated linguistic info for "'.concat(n,'" in ').concat(r,", interface: ").concat(o)),[4,z(e,t,n,r,o)];case 1:return(a=s.sent())?(console.log('Generated and validated linguistic info for "'.concat(n,'"')),[2,a]):[2,null];case 2:return i=s.sent(),console.error("Error creating linguistic info:",i),[2,null];case 3:return[2]}}))}))}function I(e,t){return'TASK: Produce a VERY SHORT grammar brief for the expression "'.concat(e,'".\nThe brief MUST be written entirely in: ').concat(t,'.\n\nCONSTRAINTS:\n- 1\u20132 bullet points only (2 max).\n- Each bullet: unique emoji + 1\u20132 words (no sentences).\n- Include ONLY essential information that is clearly applicable.\n\nMANDATORY:\n1) First bullet is ALWAYS: "\u{1f4da} Part of speech".\n2) Add AT MOST ONE extra characteristic IF relevant to "').concat(e,'".\n\nALLOWED EXTRA EMOJIS (pick at most one that really applies):\n- \u26a5 Gender | \u{1f4cb} Number | \u{1f3af} Case | \u23f0 Tense\n\nOUTPUT LANGUAGE:\n- All labels and values must be in ').concat(t,' (not transliterated, no translations to other languages).\n\nFORMAT (exactly this HTML structure):\n<div class="grammar-item">\n  <span class="icon-pos">[emoji]</span> <strong>[label]:</strong> <span class="grammar-tag">[value]</span>\n</div>\n\nRULES:\n- If an extra characteristic is not applicable or uncertain, OMIT it (do not guess).\n- Keep values as concise tags (e.g., \u201c\u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0435\u201d, \u201c\u0436\u0435\u043d\u0441\u043a\u0438\u0439\u201d, \u201c\u043c\u043d\u043e\u0436\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0435\u201d, \u201c\u0440\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439\u201d, \u201c\u043f\u0440\u043e\u0448\u0435\u0434\u0448\u0435\u0435\u201d).\n- No additional text before or after the HTML blocks.\n\nCreate the brief for "').concat(e,'":')}function T(e,t,n){return"TASK: Translate the content into ".concat(t).concat(n?" from ".concat(n):"",".\n\nHARD REQUIREMENTS (DO NOT VIOLATE):\n- Preserve ALL original formatting EXACTLY (tags, attributes, classes, Markdown syntax, code blocks, inline code, links, whitespace, line breaks, punctuation, emojis).\n- Translate ONLY human-readable text nodes (labels/values/paragraphs), DO NOT modify:\n  * HTML/Markdown syntax\n  * Tag and attribute names/values\n  * Backticked/ fenced code\n  * URLs and IDs\n- Keep the same number of characters for all non-text syntax parts.\n- No extra comments or text before/after.\n\nINPUT:\n").concat(e,"\n\nOUTPUT:\nReturn ONLY the translated content with formatting 100% unchanged, except for translated human-readable text.")}function M(e,t,n){return'\u041f\u0440\u043e\u0432\u0435\u0440\u044c \u0441\u043f\u0440\u0430\u0432\u043a\u0443 \u0434\u043b\u044f "'.concat(t,'" \u0438 \u0438\u0441\u043f\u0440\u0430\u0432\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0435 \u043e\u0448\u0438\u0431\u043a\u0438:\n\n\u0421\u041f\u0420\u0410\u0412\u041a\u0410:\n').concat(e,"\n\n\u041f\u0420\u041e\u0412\u0415\u0420\u042c \u0422\u041e\u041b\u042c\u041a\u041e:\n1. \u0415\u0441\u0442\u044c \u043b\u0438 \u043f\u043e\u0432\u0442\u043e\u0440\u044f\u044e\u0449\u0438\u0435\u0441\u044f \u044d\u043c\u043e\u0434\u0436\u0438? (\u{1f4da} \u{1f4da} - \u043f\u043b\u043e\u0445\u043e)\n2. \u041d\u0430 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u043c \u043b\u0438 \u044f\u0437\u044b\u043a\u0435 \u0442\u0435\u0440\u043c\u0438\u043d\u044b? (\u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c ").concat(n,')\n3. \u0415\u0441\u0442\u044c \u043b\u0438 \u043b\u0438\u0448\u043d\u044f\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f? (\u0443\u0431\u0435\u0440\u0438 lemma, degree, notes, examples)\n\n\u0415\u0441\u043b\u0438 \u0441\u043f\u0440\u0430\u0432\u043a\u0430 \u0432 \u0446\u0435\u043b\u043e\u043c \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u0430 \u2192 \u043e\u0442\u0432\u0435\u0442\u044c "\u0421\u041f\u0420\u0410\u0412\u041a\u0410 \u041a\u041e\u0420\u0420\u0415\u041a\u0422\u041d\u0410"\n\u0415\u0441\u043b\u0438 \u0435\u0441\u0442\u044c \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0435 \u043e\u0448\u0438\u0431\u043a\u0438 \u2192 \u0441\u043e\u0437\u0434\u0430\u0439 \u0438\u0441\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043d\u0443\u044e \u0432\u0435\u0440\u0441\u0438\u044e\n\n\u0418\u0421\u041f\u0420\u0410\u0412\u042c \u0435\u0441\u043b\u0438 \u043d\u0443\u0436\u043d\u043e:')}function F(e,t,n,r,o){return void 0===o&&(o="ru"),y(this,void 0,void 0,(function(){var a,i,s,l;return v(this,(function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),console.log('Validating linguistic reference for "'.concat(r,'"')),a=M(n,r,o),[4,e.createChatCompletion(t,[{role:"user",content:a}])];case 1:return(i=c.sent())&&i.content?(s=i.content.trim()).includes("\u0421\u041f\u0420\u0410\u0412\u041a\u0410 \u041a\u041e\u0420\u0420\u0415\u041a\u0422\u041d\u0410")||s.includes("\u041a\u041e\u0420\u0420\u0415\u041a\u0422\u041d\u0410")?(console.log("Reference validated as correct"),[2,n]):(console.log("Reference corrected by validator"),[2,s]):(console.log("Validator failed, returning original reference"),[2,n]);case 2:return l=c.sent(),console.error("Error in validator:",l),[2,n];case 3:return[2]}}))}))}function z(e,t,n,r,o){return void 0===o&&(o="ru"),y(this,void 0,void 0,(function(){var a,i,s,l,c;return v(this,(function(u){switch(u.label){case 0:return u.trys.push([0,3,,4]),console.log('Creating validated linguistic info for "'.concat(n,'"')),a=I(n,r),[4,e.createChatCompletion(t,[{role:"user",content:a}])];case 1:return(i=u.sent())&&i.content?(s=i.content.trim(),[4,F(e,t,s,n,o)]):[2,null];case 2:return l=u.sent(),console.log('Final linguistic info for "'.concat(n,'" created')),[2,l];case 3:return c=u.sent(),console.error("Error creating validated linguistic info:",c),[2,null];case 4:return[2]}}))}))}function _(e,t,n,r){return'You are an expert linguist specializing in grammar validation. Your task is to verify the grammatical accuracy of a linguistic reference.\n\nANALYSIS TARGET:\n- Word/Phrase: "'.concat(e,'"\n- Source Language: ').concat(n,"\n- Interface Language: ").concat(r,"\n\nLINGUISTIC REFERENCE TO VALIDATE:\n").concat(t,'\n\nVALIDATION INSTRUCTIONS:\n1. **Analyze the source word "').concat(e,'" in ').concat(n," language ONLY**\n2. **DO NOT analyze translations** - focus only on the original word\n3. **Check grammatical consistency** according to ").concat(n," language rules\n4. **Verify logical compatibility** of grammatical characteristics\n\nSPECIFIC CHECKS FOR ").concat(n.toUpperCase(),' LANGUAGE:\n\u2022 **Part of Speech**: Verify the word classification is correct\n\u2022 **Gender**: Check if gender is appropriate (singular forms only for most languages)\n\u2022 **Number**: Ensure number is correctly identified\n\u2022 **Case**: Validate case forms match the language\'s case system\n\u2022 **Tense/Aspect**: For verbs, check tense and aspect accuracy\n\u2022 **Degree**: Comparison degrees should only apply to adjectives/adverbs, NOT nouns\n\u2022 **Morphological Features**: Verify all features are linguistically valid\n\nCOMMON ERRORS TO DETECT:\n\u274c Gender specified for plural forms (where not applicable)\n\u274c Comparison degrees assigned to nouns\n\u274c Incorrect case systems for the language\n\u274c Wrong tense/aspect combinations\n\u274c Analysis of translation instead of source word\n\u274c Inconsistent grammatical categories\n\nRESPONSE FORMAT:\nVALIDATION: [VALID/INVALID]\n\nERRORS:\n[List specific errors found, or "None"]\n\nCORRECTIONS:\n[Suggest specific corrections, or "None"]\n\nBe thorough and precise. Focus on grammatical accuracy for ').concat(n," language rules.")}function R(e,t,n,r,o,a){return void 0===a&&(a="ru"),y(this,void 0,void 0,(function(){var i,s,l,c,u,d,p,h,f,g,m;return v(this,(function(y){switch(y.label){case 0:return y.trys.push([0,2,,3]),console.log('Validating linguistic info for "'.concat(n,'" in ').concat(o)),i=_(n,r,o,a),[4,e.createChatCompletion(t,[{role:"user",content:i}])];case 1:return(s=y.sent())&&s.content?(l=s.content.trim(),console.log("Validation response:",l),c=l.includes("VALIDATION: VALID")||l.includes("\u2705 VALID"),u=l.match(/ERRORS?:([\s\S]*?)(?:CORRECTIONS?:|$)/),d=l.match(/CORRECTIONS?:([\s\S]*?)$/),p=[],h=[],u&&u[1]&&(f=u[1].trim())&&"None"!==f&&"\u041d\u0435\u0442"!==f&&p.push.apply(p,f.split("\n").filter((function(e){return e.trim()})).map((function(e){return e.replace(/^[\u2022\-*]\s*/,"").trim()}))),d&&d[1]&&(g=d[1].trim())&&"None"!==g&&"\u041d\u0435\u0442"!==g&&h.push.apply(h,g.split("\n").filter((function(e){return e.trim()})).map((function(e){return e.replace(/^[\u2022\-*]\s*/,"").trim()}))),[2,{isValid:c,errors:p,corrections:h.length>0?h:void 0}]):[2,{isValid:!1,errors:["Failed to validate linguistic information"]}];case 2:return m=y.sent(),console.error("Error validating linguistic info:",m),[2,{isValid:!1,errors:["Validation service unavailable"]}];case 3:return[2]}}))}))}function j(e,t,n,r,o,a,i,s){return void 0===s&&(s="ru"),y(this,void 0,void 0,(function(){var l,c,u;return v(this,(function(d){switch(d.label){case 0:return d.trys.push([0,2,,3]),console.log('Correcting linguistic info for "'.concat(n,'" based on validation errors')),l=function(e,t,n,r,o,a){var i=n.map((function(e){return"\u2022 ".concat(e)})).join("\n"),s=r.map((function(e){return"\u2022 ".concat(e)})).join("\n");return'\u0422\u044b \u044d\u043a\u0441\u043f\u0435\u0440\u0442-\u043b\u0438\u043d\u0433\u0432\u0438\u0441\u0442. \u0418\u0441\u043f\u0440\u0430\u0432\u044c \u0433\u0440\u0430\u043c\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u0441\u043f\u0440\u0430\u0432\u043a\u0443 \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043d\u044b\u0445 \u043e\u0448\u0438\u0431\u043e\u043a.\n\n\u0421\u041b\u041e\u0412\u041e \u0414\u041b\u042f \u0410\u041d\u0410\u041b\u0418\u0417\u0410: "'.concat(e,'" (\u044f\u0437\u044b\u043a: ').concat(o,")\n\n\u0418\u0421\u0425\u041e\u0414\u041d\u0410\u042f \u0421\u041f\u0420\u0410\u0412\u041a\u0410:\n").concat(t,"\n\n\u041d\u0410\u0419\u0414\u0415\u041d\u041d\u042b\u0415 \u041e\u0428\u0418\u0411\u041a\u0418:\n").concat(i,"\n\n\u0420\u0415\u041a\u041e\u041c\u0415\u041d\u0414\u0410\u0426\u0418\u0418 \u041f\u041e \u0418\u0421\u041f\u0420\u0410\u0412\u041b\u0415\u041d\u0418\u042e:\n").concat(s,'\n\n\u0417\u0410\u0414\u0410\u0427\u0410: \u0421\u043e\u0437\u0434\u0430\u0439 \u0438\u0441\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043d\u0443\u044e \u0432\u0435\u0440\u0441\u0438\u044e \u0433\u0440\u0430\u043c\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0439 \u0441\u043f\u0440\u0430\u0432\u043a\u0438, \u0443\u0441\u0442\u0440\u0430\u043d\u0438\u0432 \u0432\u0441\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0435 \u043e\u0448\u0438\u0431\u043a\u0438.\n\n\u0422\u0420\u0415\u0411\u041e\u0412\u0410\u041d\u0418\u042f:\n1. \u0421\u043e\u0445\u0440\u0430\u043d\u0438 \u0438\u0441\u0445\u043e\u0434\u043d\u043e\u0435 HTML-\u0444\u043e\u0440\u043c\u0430\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435\n2. \u0418\u0441\u043f\u0440\u0430\u0432\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0433\u0440\u0430\u043c\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u043e\u0448\u0438\u0431\u043a\u0438\n3. \u0423\u0431\u0435\u0440\u0438 \u043d\u0435\u043f\u0440\u0438\u043c\u0435\u043d\u0438\u043c\u044b\u0435 \u0445\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043a\u0438 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0440\u043e\u0434 \u0434\u043b\u044f \u043c\u043d.\u0447., \u0441\u0442\u0435\u043f\u0435\u043d\u0438 \u0441\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u044f \u0434\u043b\u044f \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0445)\n4. \u0412\u0441\u0435 \u0442\u0435\u0440\u043c\u0438\u043d\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c \u043d\u0430 \u044f\u0437\u044b\u043a\u0435 "').concat(a,'"\n5. \u0410\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 \u0442\u043e\u043b\u044c\u043a\u043e \u0438\u0441\u0445\u043e\u0434\u043d\u043e\u0435 \u0441\u043b\u043e\u0432\u043e "').concat(e,'", \u043d\u0435 \u0435\u0433\u043e \u043f\u0435\u0440\u0435\u0432\u043e\u0434\n\n\u0412\u044b\u0432\u0435\u0434\u0438 \u0422\u041e\u041b\u042c\u041a\u041e \u0438\u0441\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043d\u0443\u044e \u0441\u043f\u0440\u0430\u0432\u043a\u0443 \u0431\u0435\u0437 \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0435\u0432:')}(n,r,o,a,i,s),[4,e.createChatCompletion(t,[{role:"user",content:l}])];case 1:return(c=d.sent())&&c.content?[2,c.content.trim()]:[2,null];case 2:return u=d.sent(),console.error("Error correcting linguistic info:",u),[2,null];case 3:return[2]}}))}))}function B(e,t,n,r,o,a,i){return y(this,void 0,void 0,(function(){var s,l,c,u,d,p,h,f,g,m,y,b,x;return v(this,(function(v){switch(v.label){case 0:return v.trys.push([0,2,,3]),console.log("Running ".concat(i,' validator for "').concat(n,'"')),s=function(e,t,n,r,o){var a='\nANALYSIS TARGET:\n- Word/Phrase: "'.concat(e,'"\n- Source Language: ').concat(n,"\n- Interface Language: ").concat(r,"\n\nLINGUISTIC REFERENCE TO VALIDATE:\n").concat(t);switch(o){case"morphology":return"".concat(a,"\n\n\u{1f52c} MORPHOLOGY SPECIALIST VALIDATION\n\nYou are a specialist in morphological analysis. Focus EXCLUSIVELY on word formation and morphological features:\n\nPRIMARY CHECKS:\n\u2022 **Part of Speech**: Is the word classification accurate?\n\u2022 **Morphological Form**: Are inflectional forms correctly identified?\n\u2022 **Gender/Number/Case**: Are these consistent with ").concat(n," morphology?\n\u2022 **Base Form**: Is the root/lemma correctly identified?\n\u2022 **Morphological Categories**: Do the features match the word class?\n\nCRITICAL ERROR DETECTION for ").concat(n.toUpperCase(),":\n\u274c **Gender for plural forms**: In most languages (Russian, English, etc.), gender should NOT be specified for plural forms\n\u274c **Impossible morphological combinations**: Check if all features can coexist\n\u274c **Missing essential features**: Ensure number, case (where applicable) are present\n\u274c **Wrong part of speech**: Verify the word actually belongs to the stated category\n\nSPECIFIC ").concat(n.toUpperCase(),' RULES:\n\u2022 If word ends in -\u0438, -\u044b, -\u0430 (plural markers), check if it\'s truly plural\n\u2022 Plural nouns typically don\'t have gender specification\n\u2022 Adjectives in plural may have gender only in specific contexts\n\u2022 Verify case markers match the word form\n\nIGNORE: Syntax, semantics, context - focus ONLY on morphology.\n\nRESPONSE FORMAT:\nVALIDATION: [VALID/INVALID]\nCONFIDENCE: [0.0-1.0]\nERRORS: [morphological errors only, or "None"]\nCORRECTIONS: [morphological corrections only, or "None"]');case"syntax":return"".concat(a,"\n\n\u{1f3d7}\ufe0f SYNTAX SPECIALIST VALIDATION\n\nYou are a specialist in syntactic analysis. Focus EXCLUSIVELY on grammatical structure:\n\nPRIMARY CHECKS:\n\u2022 **Grammatical Role**: Does the word fit its syntactic position?\n\u2022 **Agreement**: Are agreement patterns consistent?\n\u2022 **Case Assignment**: Is case marking appropriate for syntax?\n\u2022 **Tense/Aspect**: Are verbal categories syntactically coherent?\n\u2022 **Syntactic Features**: Do features match syntactic requirements?\n\nCRITICAL SYNTAX VALIDATION for ").concat(n.toUpperCase(),':\n\u274c **Agreement violations**: Check subject-verb, noun-adjective agreement\n\u274c **Case mismatches**: Ensure case reflects syntactic role\n\u274c **Tense inconsistencies**: Verify temporal features make syntactic sense\n\u274c **Feature conflicts**: Look for syntactically impossible combinations\n\nIGNORE: Word-internal morphology, meaning - focus ONLY on syntax.\n\nRESPONSE FORMAT:\nVALIDATION: [VALID/INVALID]\nCONFIDENCE: [0.0-1.0]\nERRORS: [syntactic errors only, or "None"]\nCORRECTIONS: [syntactic corrections only, or "None"]');case"semantics":return"".concat(a,'\n\n\u{1f4ad} SEMANTICS SPECIALIST VALIDATION\n\nYou are a specialist in semantic analysis. Focus EXCLUSIVELY on meaning and usage:\n\nPRIMARY CHECKS:\n\u2022 **Semantic Category**: Does the classification match the word\'s meaning?\n\u2022 **Usage Context**: Are grammatical features appropriate for the word\'s usage?\n\u2022 **Semantic Agreement**: Do features align with semantic properties?\n\u2022 **Register/Style**: Are formal features appropriate for the word type?\n\u2022 **Semantic Coherence**: Do all features make sense together semantically?\n\nSEMANTIC VALIDATION PRIORITIES:\n\u274c **Meaning mismatches**: Ensure part of speech matches actual meaning\n\u274c **Register conflicts**: Check if formality level matches word type\n\u274c **Usage inconsistencies**: Verify features match how word is actually used\n\u274c **Semantic impossibilities**: Look for logically impossible feature combinations\n\nIGNORE: Pure morphological/syntactic technicalities - focus on meaning-based validation.\n\nRESPONSE FORMAT:\nVALIDATION: [VALID/INVALID]\nCONFIDENCE: [0.0-1.0]\nERRORS: [semantic errors only, or "None"]\nCORRECTIONS: [semantic corrections only, or "None"]');case"consistency":return"".concat(a,"\n\n\u2696\ufe0f CONSISTENCY SPECIALIST VALIDATION\n\nYou are a specialist in logical consistency. Focus EXCLUSIVELY on internal coherence:\n\nPRIMARY CHECKS:\n\u2022 **Feature Compatibility**: Are all features mutually compatible?\n\u2022 **Language Rules**: Does everything follow ").concat(n," rules?\n\u2022 **Logical Contradictions**: Are there any impossible combinations?\n\u2022 **Completeness**: Are required features present/absent appropriately?\n\u2022 **Cross-feature Validation**: Do different features support each other?\n\nCONSISTENCY CRITICAL CHECKS for ").concat(n.toUpperCase(),":\n\u274c **GENDER + PLURAL**: Major error - gender should NOT be specified for plural forms in ").concat(n,"\n\u274c **Part of speech conflicts**: Ensure all features match the stated part of speech\n\u274c **Missing essential info**: Check if number, case, or other required features are missing\n\u274c **Redundant information**: Remove features that don't apply to this word form\n\u274c **Language-specific violations**: Apply ").concat(n,' grammatical rules strictly\n\nEXAMPLE VIOLATIONS TO CATCH:\n\u2022 "\u0437\u0430\u0441\u043b\u0443\u0433\u0438" (plural) + "Gender: Masculine" \u2192 INVALID (plural has no gender)\n\u2022 "Noun" + "Degree of comparison" \u2192 INVALID (nouns don\'t have degrees)\n\u2022 "Singular" + plural word ending \u2192 INVALID (form/feature mismatch)\n\nIGNORE: Individual feature accuracy - focus ONLY on overall consistency.\n\nRESPONSE FORMAT:\nVALIDATION: [VALID/INVALID]\nCONFIDENCE: [0.0-1.0]\nERRORS: [consistency errors only, or "None"]\nCORRECTIONS: [consistency corrections only, or "None"]');case"completeness":return"".concat(a,"\n\n\u{1f4cb} COMPLETENESS SPECIALIST VALIDATION\n\nYou are a specialist in checking completeness of grammar information. Focus EXCLUSIVELY on whether essential information is provided:\n\nPRIMARY CHECKS:\n\u2022 **Essential Categories**: Are the most important grammatical features included?\n\u2022 **Missing Information**: What crucial details are missing for learners?\n\u2022 **Usefulness**: Is this enough for language learners to understand the word?\n\u2022 **Context Appropriateness**: Does this match the learner's needs?\n\nCOMPLETENESS REQUIREMENTS for ").concat(n.toUpperCase(),':\n\u2022 Part of Speech: MANDATORY for all words\n\u2022 For Nouns: Gender (if applicable), number if not obvious\n\u2022 For Verbs: Tense/form if not infinitive  \n\u2022 For Adjectives: Degree if comparative/superlative\n\u2022 For English: Usually part of speech is sufficient\n\u2022 For inflected languages: More morphological detail needed\n\nSPECIFIC CHECKS:\n\u2705 "another" (English) + "\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u0435\u043b\u044c" \u2192 INCOMPLETE (should add "\u043d\u0435\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0439" or usage info)\n\u2705 "book" (English) + "\u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0435" \u2192 COMPLETE (sufficient for English)\n\u2705 "\u043a\u0440\u0430\u0441\u0438\u0432\u044b\u0439" (Russian) + "\u043f\u0440\u0438\u043b\u0430\u0433\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435, \u043c\u0443\u0436\u0441\u043a\u043e\u0439 \u0440\u043e\u0434" \u2192 COMPLETE\n\u274c "books" (English) + "\u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0435" \u2192 INCOMPLETE (missing plural form info)\n\nCRITICAL EVALUATION:\n\u2022 Is this TOO brief to be helpful?\n\u2022 Are learners missing crucial information?\n\u2022 Should additional categories be included?\n\nIGNORE: Technical accuracy of provided info - focus ONLY on completeness.\n\nRESPONSE FORMAT:\nVALIDATION: [VALID/INVALID]\nCONFIDENCE: [0.0-1.0]\nERRORS: [completeness issues only, or "None"]\nCORRECTIONS: [suggestions for missing info, or "None"]');default:return _(e,t,n,r)}}(n,r,o,a,i),[4,e.createChatCompletion(t,[{role:"user",content:s}])];case 1:return(l=v.sent())&&l.content?(c=l.content.trim(),console.log("".concat(i," validator response:"),c),u=c.includes("VALIDATION: VALID"),d=c.match(/CONFIDENCE:\s*([\d.]+)/),p=d?parseFloat(d[1]):.5,h=c.match(/ERRORS?:([\s\S]*?)(?:CORRECTIONS?:|$)/),f=c.match(/CORRECTIONS?:([\s\S]*?)$/),g=[],m=[],h&&h[1]&&(y=h[1].trim())&&"None"!==y&&"\u041d\u0435\u0442"!==y&&g.push.apply(g,y.split("\n").filter((function(e){return e.trim()})).map((function(e){return e.replace(/^[\u2022\-*]\s*/,"").trim()})).filter((function(e){return e.length>0}))),f&&f[1]&&(b=f[1].trim())&&"None"!==b&&"\u041d\u0435\u0442"!==b&&m.push.apply(m,b.split("\n").filter((function(e){return e.trim()})).map((function(e){return e.replace(/^[\u2022\-*]\s*/,"").trim()})).filter((function(e){return e.length>0}))),[2,{isValid:u,errors:g,corrections:m.length>0?m:void 0,confidence:p,validatorType:i}]):[2,{isValid:!1,errors:["".concat(i," validation failed - no response")],confidence:0,validatorType:i}];case 2:return x=v.sent(),console.error("Error in ".concat(i," validator:"),x),[2,{isValid:!1,errors:["".concat(i," validator error: ").concat(x instanceof Error?x.message:"Unknown error")],confidence:0,validatorType:i}];case 3:return[2]}}))}))}function O(e,t,n,r,o,a){return void 0===a&&(a="ru"),y(this,void 0,void 0,(function(){var i,s,l,c,u,d,p,h,f;return v(this,(function(g){switch(g.label){case 0:return console.log('Running multiple validation for "'.concat(n,'"')),i=["morphology","syntax","semantics","consistency","completeness"].map((function(i){return B(e,t,n,r,o,a,i)})),[4,Promise.all(i)];case 1:return s=g.sent(),l=s.filter((function(e){return e.isValid})),c=s.filter((function(e){return!e.isValid})),u=s.reduce((function(e,t){return e+t.confidence}),0)/s.length,d=l.length/s.length,p=d>=.75,h=[],f=[],c.forEach((function(e){e.errors.forEach((function(t){h.includes(t)||h.push("[".concat(e.validatorType,"] ").concat(t))})),e.corrections&&e.corrections.forEach((function(t){f.includes(t)||f.push("[".concat(e.validatorType,"] ").concat(t))}))})),console.log("Multiple validation complete: ".concat(l.length,"/").concat(s.length," passed, confidence: ").concat(u.toFixed(2))),[2,{overallValid:p,confidence:u,validations:s,finalErrors:h,finalCorrections:f,attempts:1}]}}))}))}function N(e,t,n,r,o){return void 0===o&&(o="ru"),y(this,void 0,void 0,(function(){var o,a,i,s,l;return v(this,(function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),console.log('Creating fast linguistic info for "'.concat(n,'" (1 request only)')),o=I(n,r),a=T(o,r),[4,e.createChatCompletion(t,[{role:"user",content:a}])];case 1:return(i=c.sent())&&i.content?(s=i.content.trim(),console.log("Fast linguistic info created successfully"),[2,{linguisticInfo:s,wasValidated:!1,attempts:1}]):(console.log("Failed to generate linguistic info"),[2,{linguisticInfo:null,wasValidated:!1,attempts:1}]);case 2:return l=c.sent(),console.error("Error creating fast linguistic info:",l),[2,{linguisticInfo:null,wasValidated:!1,attempts:1}];case 3:return[2]}}))}))}function P(e,t,n,r,o){return void 0===o&&(o="ru"),y(this,void 0,void 0,(function(){var a,i,s,l,c,u,d;return v(this,(function(p){switch(p.label){case 0:return p.trys.push([0,3,,4]),console.log('Creating optimized linguistic info for "'.concat(n,'" (max 2 requests)')),a=I(n,r),[4,e.createChatCompletion(t,[{role:"user",content:a}],{title:"Creating grammar reference",subtitle:"Generating detailed grammar and linguistic information",icon:"\u{1f4da}",color:"#9C27B0"})];case 1:return(i=p.sent())&&i.content?(s=i.content.trim(),console.log("Initial reference created"),l=M(s,n,o),[4,e.createChatCompletion(t,[{role:"user",content:l}],{title:"Validating grammar reference",subtitle:"Checking and improving linguistic information",icon:"\u{1f50d}",color:"#9C27B0"})]):(console.log("Failed to generate initial linguistic info"),[2,{linguisticInfo:null,wasValidated:!1,attempts:1}]);case 2:return(c=p.sent())&&c.content?(u=c.content.trim()).includes("\u0421\u041f\u0420\u0410\u0412\u041a\u0410 \u041a\u041e\u0420\u0420\u0415\u041a\u0422\u041d\u0410")||u.includes("\u041a\u041e\u0420\u0420\u0415\u041a\u0422\u041d\u0410")?(console.log("Reference validated as correct"),[2,{linguisticInfo:s,wasValidated:!0,attempts:2}]):(console.log("Reference was corrected by validator"),[2,{linguisticInfo:u,wasValidated:!0,attempts:2}]):(console.log("Validator failed, returning initial reference"),[2,{linguisticInfo:s,wasValidated:!1,attempts:2}]);case 3:return d=p.sent(),console.error("Error in optimized linguistic info creation:",d),[2,{linguisticInfo:null,wasValidated:!1,attempts:1}];case 4:return[2]}}))}))}},504:(e,t,n)=>{n.d(t,{$_:()=>s,Y3:()=>i,cr:()=>a});var r=function(){function e(e){this.requests=new Map,this.activeRequests=new Set,this.requestCounter=0,this.startTime=Date.now(),this.onProgressUpdate=e}return e.prototype.startRequest=function(e,t,n,r){var o="request_".concat(++this.requestCounter,"_").concat(Date.now()),a={id:o,operation:e,description:t,startTime:Date.now(),status:"pending",icon:n,color:r||this.getDefaultColor(e)};return this.requests.set(o,a),this.activeRequests.add(o),this.notifyProgressUpdate(),o},e.prototype.setInProgress=function(e){var t=this.requests.get(e);t&&(t.status="in-progress",this.notifyProgressUpdate())},e.prototype.completeRequest=function(e){var t=this.requests.get(e);t&&(t.status="completed",t.endTime=Date.now(),this.activeRequests.delete(e),this.notifyProgressUpdate())},e.prototype.errorRequest=function(e){var t=this.requests.get(e);t&&(t.status="error",t.endTime=Date.now(),this.activeRequests.delete(e),this.notifyProgressUpdate())},e.prototype.getCurrentProgress=function(){var e=this,t=Array.from(this.requests.values()),n=t.filter((function(e){return"completed"===e.status||"error"===e.status})).length,r=t.length,o=Array.from(this.activeRequests).map((function(t){return e.requests.get(t)})).find((function(e){return"in-progress"===(null==e?void 0:e.status)}));return{completed:n,total:r,currentRequest:o,progress:r>0?n/r*100:0,message:o?{title:o.operation,subtitle:o.description,icon:o.icon,color:o.color,currentStep:n+1,totalSteps:r,currentStepTitle:o.operation,currentStepSubtitle:o.description}:0===r?{title:"Ready",subtitle:"No active requests",icon:"\u2705",color:"#10B981"}:n===r&&r>0?{title:"Completed!",subtitle:"All ".concat(r," requests finished"),icon:"\u2705",color:"#10B981",currentStep:n,totalSteps:r,currentStepTitle:"Completed!",currentStepSubtitle:"All ".concat(r," requests finished")}:{title:"Processing...",subtitle:"".concat(n," of ").concat(r," requests completed"),icon:"\u26a1",color:"#3B82F6",currentStep:n,totalSteps:r,currentStepTitle:"Processing...",currentStepSubtitle:"".concat(n," of ").concat(r," requests completed")}}},e.prototype.getStats=function(){var e=Array.from(this.requests.values());return{total:e.length,completed:e.filter((function(e){return"completed"===e.status})).length,pending:e.filter((function(e){return"pending"===e.status})).length,inProgress:e.filter((function(e){return"in-progress"===e.status})).length,errors:e.filter((function(e){return"error"===e.status})).length,elapsedTime:Date.now()-this.startTime}},e.prototype.reset=function(){this.requests.clear(),this.activeRequests.clear(),this.requestCounter=0,this.startTime=Date.now(),this.notifyProgressUpdate()},e.prototype.getDefaultColor=function(e){for(var t=0,n=Object.entries({translate:"#3B82F6","generate-examples":"#F59E0B","analyze-word":"#8B5CF6","create-image-description":"#EC4899","generate-image":"#6366F1","create-card":"#10B981","save-card":"#EF4444",connect:"#6366F1"});t<n.length;t++){var r=n[t],o=r[0],a=r[1];if(e.toLowerCase().includes(o))return a}return"#6B7280"},e.prototype.getDefaultIcon=function(e){for(var t=0,n=Object.entries({translate:"\u{1f30d}","generate-examples":"\u{1f4a1}","analyze-word":"\u{1f50d}","create-image-description":"\u{1f3a8}","generate-image":"\u{1f5bc}\ufe0f","create-card":"\u{1f9e0}","save-card":"\u{1f4be}",connect:"\u{1f517}"});t<n.length;t++){var r=n[t],o=r[0],a=r[1];if(e.toLowerCase().includes(o))return a}return"\u26a1"},e.prototype.notifyProgressUpdate=function(){if(this.onProgressUpdate){var e=this.getCurrentProgress();this.onProgressUpdate(e)}},e}(),o=null,a=function(){return o||(o=new r),o},i=function(e){a().onProgressUpdate=e},s=function(){a().reset()}},456:(e,t,n)=>{n.r(t),n.d(t,{cacheQuotaExceededError:()=>l,generateAnkiBack:()=>S,generateAnkiFront:()=>w,getCachedQuotaError:()=>d,getDescriptionImage:()=>m,getExamples:()=>f,getOpenAiImageUrl:()=>v,getOptimizedImageUrl:()=>b,isAbstract:()=>g,isQuotaExceededCached:()=>s,markQuotaNotificationShown:()=>c,shouldShowQuotaNotification:()=>u,translateText:()=>h});var r=n(504),o=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},a=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},i=null,s=function(){return!!i&&(!(Date.now()-i.timestamp>3e5)||(i=null,!1))},l=function(e){i={timestamp:Date.now(),message:e,notificationShown:!1}},c=function(){i&&(i.notificationShown=!0)},u=function(){return null!==i&&!i.notificationShown},d=function(){return(null==i?void 0:i.message)||null},p=function(e){if(!e||!e.error)return"Unknown OpenAI API error";var t=e.error,n=t.message,r=t.type,o=t.code,a="";return a="insufficient_quota"===o?"Your OpenAI account has exceeded its quota.\n\nPlease check your billing details or use a different API key.":"invalid_request_error"===r?"Invalid request to OpenAI.\n\nPlease check your API key and settings.":"rate_limit_exceeded"===r?"OpenAI rate limit exceeded.\n\nPlease try again in a few minutes.":"OpenAI API Error: ".concat(n||"Unknown error"),a+="\n\nDetails:\n- Type: ".concat(r||"unknown","\n- Code: ").concat(o||"none")},h=function(e,t,n,c,u){return void 0===n&&(n="ru"),void 0===c&&(c=""),o(void 0,void 0,void 0,(function(){var o,d,h,f,g,m,y,v,b,x,w,S,k,C;return a(this,(function(a){switch(a.label){case 0:o=(0,r.cr)(),d=o.startRequest("Translating text","Converting your text to ".concat(n),"\u{1f30d}","#3B82F6"),a.label=1;case 1:if(a.trys.push([1,6,,7]),!e)throw o.errorRequest(d),new Error("OpenAI API key is missing. Please check your settings.");if(o.setInProgress(d),s())throw o.errorRequest(d),new Error(i.message);return h="Translate the following text to ".concat(n),f=c?"".concat(h,". ").concat(c):h,g={model:"gpt-3.5-turbo",messages:[{role:"system",content:f},{role:"user",content:"".concat(t)}]},[4,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(g),signal:u})];case 2:return(m=a.sent()).ok?[3,4]:[4,m.json()];case 3:if((y=a.sent())&&y.error)throw v=p(y),"insufficient_quota"!==y.error.code&&429!==m.status||l(v),new Error(v);throw new Error("OpenAI API error: ".concat(m.status," ").concat(m.statusText));case 4:return[4,m.json()];case 5:return b=a.sent(),o.completeRequest(d),[2,null!==(C=null===(k=null===(S=null===(w=b.choices[0])||void 0===w?void 0:w.message)||void 0===S?void 0:S.content)||void 0===k?void 0:k.trim())&&void 0!==C?C:null];case 6:if(x=a.sent(),console.error("Error during translation:",x),o.errorRequest(d),x instanceof Error){if(null==u?void 0:u.aborted)throw new Error("Translation cancelled by user");if(x.message.includes("quota")||x.message.includes("insufficient_quota"))throw new Error(x.message);throw new Error("Translation failed: ".concat(x.message))}throw x;case 7:return[2]}}))}))},f=function(e,t,n,c,u,d){return void 0===c&&(c=!1),void 0===u&&(u=""),o(void 0,void 0,void 0,(function(){var o,f,g,m,y,v,b,x,w,S,k,C,E,A,I,T,M,F,z,_,R,j;return a(this,(function(a){switch(a.label){case 0:o=(0,r.cr)(),f=o.startRequest("Creating example sentences",'Generating helpful examples for "'.concat(t,'"'),"\u{1f4a1}","#F59E0B"),a.label=1;case 1:if(a.trys.push([1,14,,15]),!e)throw o.errorRequest(f),new Error("OpenAI API key is missing. Please check your settings.");if(o.setInProgress(f),s())throw o.errorRequest(f),new Error(i.message);return g=u.replace(/\{word\}/g,t),m="Give me three example sentences using the word '".concat(t,"' in the original language (the language of this word). \nEach example should show natural usage of '").concat(t,"' in its native language context.\nReturn ONLY the examples, one per line, without any numbering, explanations, or translations."),y=u?"".concat(m," ").concat(g):m,v={model:"gpt-3.5-turbo",messages:[{role:"system",content:y}]},[4,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(v),signal:d})];case 2:return(b=a.sent()).ok?[3,4]:[4,b.json()];case 3:if((x=a.sent())&&x.error)throw w=p(x),"insufficient_quota"!==x.error.code&&429!==b.status||l(w),new Error(w);throw new Error("Could not generate examples. OpenAI API error: ".concat(b.status," ").concat(b.statusText));case 4:return[4,b.json()];case 5:S=a.sent(),k=null===(R=null===(_=S.choices[0])||void 0===_?void 0:_.message)||void 0===R?void 0:R.content,C=null!==(j=null==k?void 0:k.trim().split("\n"))&&void 0!==j?j:[],E=[],A=0,I=C,a.label=6;case 6:if(!(A<I.length))return[3,13];if(!(T=I[A]).trim())return[3,12];if(M=null,!c)return[3,11];a.label=7;case 7:return a.trys.push([7,9,10,11]),[4,h(e,T,n)];case 8:return M=a.sent(),[3,11];case 9:return F=a.sent(),console.error("Error translating example:",F),[3,11];case 10:return[7];case 11:E.push([T,M]),a.label=12;case 12:return A++,[3,6];case 13:if(0===E.length)throw o.errorRequest(f),new Error("Could not generate examples. Please try again with a different word or check your API key.");return o.completeRequest(f),[2,E];case 14:throw z=a.sent(),console.error("Error during getting examples:",z),o.errorRequest(f),z;case 15:return[2]}}))}))},g=function(e,t){return o(void 0,void 0,void 0,(function(){var n,o,c,u,d,h,f,g,m,y,v,b,x,w;return a(this,(function(a){switch(a.label){case 0:n=(0,r.cr)(),o=n.startRequest("Analyzing word type",'Determining if "'.concat(t,'" can be visualized'),"\u{1f50d}","#8B5CF6"),a.label=1;case 1:if(a.trys.push([1,6,,7]),!e)throw n.errorRequest(o),new Error("OpenAI API key is missing. Please check your settings.");if(n.setInProgress(o),s())throw n.errorRequest(o),new Error(i.message);return c=[{role:"system",content:"Is the word '".concat(t,"' an abstract concept or a concrete object? Answer 'abstract' or 'concrete':")}],u={model:"gpt-3.5-turbo",messages:c},[4,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(u),signal:void 0})];case 2:return(d=a.sent()).ok?[3,4]:[4,d.json()];case 3:if((h=a.sent())&&h.error)throw f=p(h),"insufficient_quota"!==h.error.code&&429!==d.status||l(f),new Error(f);throw new Error("OpenAI API error: ".concat(d.status," ").concat(d.statusText));case 4:return[4,d.json()];case 5:return g=a.sent(),m=null!==(w=null===(x=null===(b=null===(v=g.choices[0])||void 0===v?void 0:v.message)||void 0===b?void 0:b.content)||void 0===x?void 0:x.trim().toLowerCase())&&void 0!==w?w:"",n.completeRequest(o),[2,"abstract"===m];case 6:return y=a.sent(),console.error("Error during determining abstractness:",y),n.errorRequest(o),[2,!1];case 7:return[2]}}))}))},m=function(e,t,n,c){return void 0===n&&(n=""),o(void 0,void 0,void 0,(function(){var o,u,d,h,f,g,m,y,v,b,x,w,S,k,C;return a(this,(function(a){switch(a.label){case 0:o=(0,r.cr)(),u=o.startRequest("Crafting image description",'Creating detailed prompt for "'.concat(t,'" visualization'),"\u{1f3a8}","#EC4899"),a.label=1;case 1:if(a.trys.push([1,6,,7]),!e)throw o.errorRequest(u),new Error("OpenAI API key is missing. Please check your settings.");if(o.setInProgress(u),s())throw o.errorRequest(u),new Error(i.message);return d="Provide a detailed description for an image that represents the concept of '".concat(t,"'"),h=n?"".concat(d,". ").concat(n):d,f={model:"gpt-3.5-turbo",messages:[{role:"system",content:h}]},[4,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(f),signal:c})];case 2:return(g=a.sent()).ok?[3,4]:[4,g.json()];case 3:if((m=a.sent())&&m.error)throw y=p(m),"insufficient_quota"!==m.error.code&&429!==g.status||l(y),o.errorRequest(u),new Error(y);throw o.errorRequest(u),new Error("Could not generate image description. OpenAI API error: ".concat(g.status," ").concat(g.statusText));case 4:return[4,g.json()];case 5:if(v=a.sent(),!(b=null!==(C=null===(k=null===(S=null===(w=v.choices[0])||void 0===w?void 0:w.message)||void 0===S?void 0:S.content)||void 0===k?void 0:k.trim())&&void 0!==C?C:""))throw o.errorRequest(u),new Error("Could not generate a valid image description. Please try again.");return o.completeRequest(u),[2,b];case 6:throw x=a.sent(),console.error("Error during getting description image:",x),o.errorRequest(u),x;case 7:return[2]}}))}))},y=function(e,t,n){return void 0===n&&(n=""),o(void 0,void 0,void 0,(function(){var o,i,s,c,u,d,h,f,g,m;return a(this,(function(a){switch(a.label){case 0:o=(0,r.cr)(),i=o.startRequest("Generating image","Creating beautiful illustration with AI","\u{1f5bc}\ufe0f","#6366F1"),a.label=1;case 1:return a.trys.push([1,3,,4]),o.setInProgress(i),s=n?"".concat(t,". ").concat(n):t,[4,e.images.generate({model:"dall-e-2",prompt:s,n:1,size:"512x512",response_format:"url"})];case 2:if(!(c=a.sent()).data||!(null===(m=c.data[0])||void 0===m?void 0:m.url))throw o.errorRequest(i),new Error("OpenAI did not return an image URL. Please try again.");return o.completeRequest(i),[2,c.data[0].url];case 3:if(u=a.sent(),console.error("Error during image generation:",u),o.errorRequest(i),u instanceof Error){if((d=u.message||"").includes("quota")||d.includes("billing"))throw l(h="Your OpenAI account has exceeded its quota.\n\nPlease check your billing details or use a different API key."),new Error(h);if(d.includes("rate limit"))throw new Error("OpenAI rate limit exceeded.\n\nPlease try again in a few minutes.");if(d.includes("invalid API key"))throw new Error("Invalid OpenAI API key.\n\nPlease check your API key in settings.");if(d.includes("moderation")||d.includes("policy"))throw new Error("OpenAI content policy violation.\n\nThe image request was flagged for content policy violation. Please modify your request.");if(d.includes("{")&&d.includes("}"))try{if(f=d.substring(d.indexOf("{"),d.lastIndexOf("}")+1),(g=JSON.parse(f))&&g.error)return[2,p(g)]}catch(e){}throw u}throw new Error("Failed to generate image.\n\nPlease check your OpenAI API key and try again.");case 4:return[2]}}))}))},v=function(e,t,n,l){return void 0===l&&(l=""),o(void 0,void 0,void 0,(function(){var o,c,u,d,p,h;return a(this,(function(a){switch(a.label){case 0:o=(0,r.cr)(),c=o.startRequest("Creating custom image",'Generating visual for "'.concat(n,'"'),"\u{1f5bc}\ufe0f","#6366F1"),a.label=1;case 1:if(a.trys.push([1,8,,9]),!t)throw o.errorRequest(c),new Error("OpenAI API key is missing. Please check your settings.");if(o.setInProgress(c),s())throw o.errorRequest(c),new Error(i.message);return[4,g(t,n)];case 2:return a.sent()?[4,m(t,n,l)]:[3,5];case 3:return u=a.sent(),[4,y(e,"Create a vivid, high-quality illustration representing the concept of '".concat(u,"'"),l)];case 4:return p=a.sent(),o.completeRequest(c),[2,p];case 5:return d="Create a high-quality, photorealistic image of a ".concat(n," with a neutral expression and clear features"),[4,y(e,d,l)];case 6:return p=a.sent(),o.completeRequest(c),[2,p];case 7:return[3,9];case 8:throw h=a.sent(),console.error("Error during getting image for word:",h),o.errorRequest(c),h;case 9:return[2]}}))}))},b=function(e,t,n,l){return void 0===l&&(l=""),o(void 0,void 0,void 0,(function(){var o,c,u,d,p;return a(this,(function(a){switch(a.label){case 0:o=(0,r.cr)(),c=o.startRequest("Creating optimized image",'Fast generation for "'.concat(n,'"'),"\u{1f5bc}\ufe0f","#6366F1"),a.label=1;case 1:if(a.trys.push([1,3,,4]),!t)throw o.errorRequest(c),new Error("OpenAI API key is missing. Please check your settings.");if(o.setInProgress(c),s())throw o.errorRequest(c),new Error(i.message);return u='Create a high-quality, clear image representing "'.concat(n,'".'),u=/^[A-Z]/.test(n)||n.length>15?'Create a symbolic, artistic illustration that clearly represents the concept of "'.concat(n,'". Use clear visual metaphors and symbols.'):'Create a photorealistic image of "'.concat(n,'" with good lighting and clear details on a neutral background.'),l&&(u+=" ".concat(l)),[4,y(e,u,"")];case 2:return d=a.sent(),o.completeRequest(c),[2,d];case 3:throw p=a.sent(),console.error("Error during optimized image generation:",p),o.errorRequest(c),p;case 4:return[2]}}))}))},x=function(e,t){return o(void 0,void 0,void 0,(function(){var n,o,c,u,d,h,f,g,m,y,v,b;return a(this,(function(a){switch(a.label){case 0:n=(0,r.cr)(),o=n.startRequest("Detecting language","Identifying the language of your text","\u{1f524}","#8B5CF6"),a.label=1;case 1:if(a.trys.push([1,6,,7]),!e)throw n.errorRequest(o),new Error("OpenAI API key is missing. Please check your settings.");if(n.setInProgress(o),s())throw n.errorRequest(o),new Error(i.message);return c={model:"gpt-3.5-turbo",messages:[{role:"system",content:"You are langauage expert"},{role:"user",content:"What is the name of this language: ".concat(t,". Give only name of this language in one word")}]},[4,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(c),signal:void 0})];case 2:return(u=a.sent()).ok?[3,4]:[4,u.json()];case 3:if((d=a.sent())&&d.error)throw h=p(d),"insufficient_quota"!==d.error.code&&429!==u.status||l(h),new Error(h);throw new Error("OpenAI API error: ".concat(u.status," ").concat(u.statusText));case 4:return[4,u.json()];case 5:return f=a.sent(),n.completeRequest(o),[2,null!==(b=null===(v=null===(y=null===(m=f.choices[0])||void 0===m?void 0:m.message)||void 0===y?void 0:y.content)||void 0===v?void 0:v.trim())&&void 0!==b?b:null];case 6:throw g=a.sent(),console.error("Error during language name detection:",g),n.errorRequest(o),g;case 7:return[2]}}))}))},w=function(e,t,n){return o(void 0,void 0,void 0,(function(){var o,l,c,u,d,p,h,f,g,m;return a(this,(function(a){switch(a.label){case 0:o=(0,r.cr)(),l=o.startRequest("Creating question","Crafting an effective question for your flashcard","\u2753","#10B981"),a.label=1;case 1:if(a.trys.push([1,5,,6]),!e)throw o.errorRequest(l),new Error("OpenAI API key is missing. Please check your settings.");if(o.setInProgress(l),s())throw o.errorRequest(l),new Error(i.message);return[4,x(e,t)];case 2:return c=a.sent(),u={model:"gpt-3.5-turbo",messages:[{role:"system",content:"You generate a question based on the text entered. You answer should be in ".concat(c)},{role:"user",content:"Give a main question of this text: ".concat(t,"'. You answer should be in ").concat(c)}]},[4,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(u),signal:n})];case 3:return[4,a.sent().json()];case 4:return d=a.sent(),o.completeRequest(l),[2,null!==(m=null===(g=null===(f=null===(h=d.choices[0])||void 0===h?void 0:h.message)||void 0===f?void 0:f.content)||void 0===g?void 0:g.trim())&&void 0!==m?m:null];case 5:return p=a.sent(),console.error("Error during generating front side of the Anki card:",p),o.errorRequest(l),[2,null];case 6:return[2]}}))}))},S=function(e,t){return o(void 0,void 0,void 0,(function(){var n,o,l,c,u,d,p,h,f,g;return a(this,(function(a){switch(a.label){case 0:n=(0,r.cr)(),o=n.startRequest("Creating answer","Developing comprehensive answer for your card","\u{1f4d6}","#F59E0B"),a.label=1;case 1:if(a.trys.push([1,5,,6]),!e)throw n.errorRequest(o),new Error("OpenAI API key is missing. Please check your settings.");if(n.setInProgress(o),s())throw n.errorRequest(o),new Error(i.message);return[4,x(e,t)];case 2:return l=a.sent(),c={model:"gpt-3.5-turbo",messages:[{role:"system",content:"You generate a key point based on the text entered. For back of flash card. You answer should be in ".concat(l)},{role:"user",content:"Anilize text. Highlight the key points from this text. Put them in a list of senteses with dash points.\n                                Text: '".concat(t,"'. You answer should be in ").concat(l,". Key points should be competed and make sence")}]},[4,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(c),signal:void 0})];case 3:return[4,a.sent().json()];case 4:return u=a.sent(),n.completeRequest(o),[2,null!==(g=null===(f=null===(h=null===(p=u.choices[0])||void 0===p?void 0:p.message)||void 0===h?void 0:h.content)||void 0===f?void 0:f.trim())&&void 0!==g?g:null];case 5:return d=a.sent(),console.error("Error during generating back side of the Anki card:",d),n.errorRequest(o),[2,null];case 6:return[2]}}))}))}},736:(e,t,n)=>{n.r(t),n.d(t,{PageContentExtractor:()=>a});var r=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},o=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},a=function(){function e(){}return e.extractPageContent=function(e,t){return{selectedText:e,pageImages:this.extractImages(e,t),formulas:this.extractFormulas(e,t),codeBlocks:this.extractCodeBlocks(e,t),links:this.extractLinks(e,t),metadata:this.extractMetadata()}},e.extractPageContentAsync=function(e,t){return r(this,void 0,void 0,(function(){var n,r,a,i,s;return o(this,(function(o){switch(o.label){case 0:return console.log("\u{1f50d} \u0410\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u043e \u0438\u0437\u0432\u043b\u0435\u043a\u0430\u0435\u043c \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b..."),[4,this.extractImagesAsync(e,t)];case 1:return n=o.sent(),r=this.extractFormulas(e,t),a=this.extractCodeBlocks(e,t),i=this.extractLinks(e,t),s=this.extractMetadata(),console.log("\u{1f4c4} \u0410\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u0430\u044f \u044d\u043a\u0441\u0442\u0440\u0430\u043a\u0446\u0438\u044f \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0430:",{images:n.length,formulas:r.length,codeBlocks:a.length,links:i.length}),[2,{selectedText:e,pageImages:n,formulas:r,codeBlocks:a,links:i,metadata:s}]}}))}))},e.extractImages=function(e,t){var n=this,r=[],o=document.querySelectorAll("img");console.log("\u{1f50d} \u041d\u0430\u0439\u0434\u0435\u043d\u043e ".concat(o.length," \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0439 \u043d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435")),o.forEach((function(o,a){if(o.width<30||o.height<30)console.log("\u23ed\ufe0f \u041f\u0440\u043e\u043f\u0443\u0441\u043a\u0430\u0435\u043c \u043c\u0430\u043b\u0435\u043d\u044c\u043a\u043e\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 ".concat(a,": ").concat(o.width,"x").concat(o.height));else if(o.src)if(o.src.startsWith("data:image")&&o.src.length>5e3)console.log("\u23ed\ufe0f \u041f\u0440\u043e\u043f\u0443\u0441\u043a\u0430\u0435\u043c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 ".concat(a,": \u0441\u043b\u0438\u0448\u043a\u043e\u043c \u0434\u043b\u0438\u043d\u043d\u044b\u0439 data URL"));else{var i=n.isElementNearSelection(o,t,e),s=n.calculateImageRelevance(o,e,i);if(console.log("\u{1f5bc}\ufe0f \u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 ".concat(a,":"),{src:o.src.substring(0,50)+"...",alt:o.alt,size:"".concat(o.width,"x").concat(o.height),isNearText:i,relevanceScore:s,willInclude:s>.1}),s>.1){var l=n.convertImageToBase64(o);r.push({src:o.src,alt:o.alt||o.title||"",title:o.title,width:o.naturalWidth||o.width,height:o.naturalHeight||o.height,isNearText:i,relevanceScore:s,base64:l}),console.log("\u2705 \u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u043e \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 ".concat(a," (score: ").concat(s,")"))}else console.log("\u274c \u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 ".concat(a," \u043d\u0435 \u043f\u0440\u043e\u0448\u043b\u043e \u043f\u043e\u0440\u043e\u0433 (score: ").concat(s,")"))}else console.log("\u23ed\ufe0f \u041f\u0440\u043e\u043f\u0443\u0441\u043a\u0430\u0435\u043c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 ".concat(a,": \u043d\u0435\u0442 src"))}));var a=document.querySelectorAll("svg");console.log("\u{1f50d} \u041d\u0430\u0439\u0434\u0435\u043d\u043e ".concat(a.length," SVG \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432")),a.forEach((function(o,a){var i,s,l=(null===(i=o.width.baseVal)||void 0===i?void 0:i.value)||0,c=(null===(s=o.height.baseVal)||void 0===s?void 0:s.value)||0;if(l<30||c<30)console.log("\u23ed\ufe0f \u041f\u0440\u043e\u043f\u0443\u0441\u043a\u0430\u0435\u043c \u043c\u0430\u043b\u0435\u043d\u044c\u043a\u0438\u0439 SVG ".concat(a,": ").concat(l,"x").concat(c));else{var u=n.isElementNearSelection(o,t,e),d=n.calculateSvgRelevance(o,e,u);console.log("\u{1f3a8} SVG ".concat(a,":"),{size:"".concat(l,"x").concat(c),isNearText:u,relevanceScore:d,willInclude:d>.1}),d>.1&&(r.push({src:n.svgToDataUrl(o),alt:o.getAttribute("aria-label")||o.getAttribute("title")||"SVG \u0434\u0438\u0430\u0433\u0440\u0430\u043c\u043c\u0430",width:l||200,height:c||200,isNearText:u,relevanceScore:d,base64:n.svgToDataUrl(o)}),console.log("\u2705 \u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d SVG ".concat(a," (score: ").concat(d,")")))}}));var i=r.sort((function(e,t){return t.relevanceScore-e.relevanceScore})).slice(0,10);if(0===i.length){console.log("\u{1f6a8} \u041d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e \u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u044b\u0445 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0439, \u043f\u0440\u0438\u043c\u0435\u043d\u044f\u0435\u043c \u0430\u0432\u0430\u0440\u0438\u0439\u043d\u0443\u044e \u043b\u043e\u0433\u0438\u043a\u0443");var s=[];o.forEach((function(e,t){if(e.width>=30&&e.height>=30&&e.src){var r=n.convertImageToBase64(e);s.push({src:e.src,alt:e.alt||e.title||"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 ".concat(t+1),title:e.title,width:e.naturalWidth||e.width,height:e.naturalHeight||e.height,isNearText:!1,relevanceScore:.5,base64:r})}})),i=s.slice(0,5),console.log("\u{1f3af} \u0410\u0412\u0410\u0420\u0418\u0419\u041d\u042b\u0419 \u0420\u0415\u0416\u0418\u041c: \u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u043e ".concat(i.length," \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0439"))}return console.log("\u{1f3af} \u0424\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442: ".concat(i.length," \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0439 \u0438\u0437 ").concat(r.length," \u043d\u0430\u0439\u0434\u0435\u043d\u043d\u044b\u0445")),i},e.extractImagesAsync=function(e,t){return r(this,void 0,void 0,(function(){var n,a,i,s=this;return o(this,(function(l){switch(l.label){case 0:return n=[],a=document.querySelectorAll("img"),i=Array.from(a).map((function(n){return r(s,void 0,void 0,(function(){var r,a,i;return o(this,(function(o){switch(o.label){case 0:return n.width<50||n.height<50||(!n.src||n.src.startsWith("data:image")&&n.src.length>1e3)?[2,null]:(r=this.isElementNearSelection(n,t,e),(a=this.calculateImageRelevance(n,e,r))<=.3?[2,null]:!n.src.startsWith("http")||n.src.includes(window.location.origin)?[3,2]:(console.log("\u{1f5bc}\ufe0f \u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043c \u0432\u043d\u0435\u0448\u043d\u0435\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435:",n.src),[4,this.fetchImageAsBase64(n.src)]));case 1:return i=o.sent(),[3,3];case 2:i=this.convertImageToBase64(n),o.label=3;case 3:return[2,{src:n.src,alt:n.alt||n.title||"",title:n.title,width:n.naturalWidth||n.width,height:n.naturalHeight||n.height,isNearText:r,relevanceScore:a,base64:i}]}}))}))})),[4,Promise.all(i)];case 1:return l.sent().forEach((function(e){e&&n.push(e)})),document.querySelectorAll("svg").forEach((function(r){var o,a,i=(null===(o=r.width.baseVal)||void 0===o?void 0:o.value)||0,l=(null===(a=r.height.baseVal)||void 0===a?void 0:a.value)||0;if(!(i<50||l<50)){var c=s.isElementNearSelection(r,t,e),u=s.calculateSvgRelevance(r,e,c);u>.3&&n.push({src:s.svgToDataUrl(r),alt:r.getAttribute("aria-label")||r.getAttribute("title")||"SVG \u0434\u0438\u0430\u0433\u0440\u0430\u043c\u043c\u0430",width:i||200,height:l||200,isNearText:c,relevanceScore:u,base64:s.svgToDataUrl(r)})}})),console.log("\u{1f5bc}\ufe0f \u041d\u0430\u0439\u0434\u0435\u043d\u043e ".concat(n.length," \u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u044b\u0445 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0439 (\u0432\u043a\u043b\u044e\u0447\u0430\u044f ").concat(n.filter((function(e){return e.base64})).length," \u0441 base64)")),[2,n.sort((function(e,t){return t.relevanceScore-e.relevanceScore})).slice(0,5)]}}))}))},e.extractFormulas=function(e,t){var n=this,r=[];document.querySelectorAll('.MathJax, .math, [class*="math"]').forEach((function(o){var a=n.extractFormulaText(o);if(a){var i=n.isElementNearSelection(o,t,e);r.push({text:a,type:n.detectFormulaType(o),isNearText:i,relevanceScore:n.calculateFormulaRelevance(a,e,i)})}}));var o=[/\$\$([^$]+)\$\$/g,/\$([^$]+)\$/g,/\\begin\{[^}]+\}[\s\S]*?\\end\{[^}]+\}/g],a=document.body.textContent||"";return o.forEach((function(t){for(var i;null!==(i=t.exec(a));){var s=i[1]||i[0],l=a.toLowerCase().includes(e.toLowerCase());r.push({text:s,type:t===o[0]?"block":"inline",isNearText:l,relevanceScore:n.calculateFormulaRelevance(s,e,l)})}})),r.filter((function(e){return e.relevanceScore>.2})).sort((function(e,t){return t.relevanceScore-e.relevanceScore})).slice(0,3)},e.extractCodeBlocks=function(e,t){var n=this,r=[];return document.querySelectorAll("pre code, .highlight code, .code-block, .codehilite").forEach((function(o){var a,i=null===(a=o.textContent)||void 0===a?void 0:a.trim();if(i&&i.length>10&&i.length<2e3){var s=n.isElementNearSelection(o,t,e),l=n.detectCodeLanguage(o);r.push({code:i,language:l,isNearText:s,relevanceScore:n.calculateCodeRelevance(i,e,s)})}})),document.querySelectorAll("code:not(pre code)").forEach((function(o){var a,i=null===(a=o.textContent)||void 0===a?void 0:a.trim();if(i&&i.length>3&&i.length<100){var s=n.isElementNearSelection(o,t,e);r.push({code:i,language:"inline",isNearText:s,relevanceScore:n.calculateCodeRelevance(i,e,s)})}})),r.filter((function(e){return e.relevanceScore>.3})).sort((function(e,t){return t.relevanceScore-e.relevanceScore})).slice(0,5)},e.extractLinks=function(e,t){var n=this,r=[];return document.querySelectorAll("a[href]").forEach((function(o){var a,i=o.getAttribute("href"),s=null===(a=o.textContent)||void 0===a?void 0:a.trim();if(i&&s&&i.startsWith("http")){var l=n.isElementNearSelection(o,t,e),c=n.calculateLinkRelevance(s,i,e,l);c>.2&&r.push({url:i,text:s,isNearText:l,relevanceScore:c})}})),r.sort((function(e,t){return t.relevanceScore-e.relevanceScore})).slice(0,3)},e.extractMetadata=function(){return{url:window.location.href,title:document.title,domain:window.location.hostname,language:document.documentElement.lang||"en",hasImages:document.querySelectorAll("img").length>0,hasFormulas:document.querySelectorAll('.MathJax, .math, [class*="math"]').length>0||(document.body.textContent||"").includes("$"),hasCode:document.querySelectorAll("pre code, .highlight, .code-block").length>0}},e.isElementNearSelection=function(e,t,n){var r;if(!t){var o=e.textContent||"",a=(null===(r=e.parentElement)||void 0===r?void 0:r.textContent)||"";return o.toLowerCase().includes((n||"").toLowerCase())||a.toLowerCase().includes((n||"").toLowerCase())}var i=e.getBoundingClientRect(),s=t.getBoundingClientRect();return Math.sqrt(Math.pow(i.left-s.left,2)+Math.pow(i.top-s.top,2))<500},e.calculateImageRelevance=function(e,t,n){var r=.3;n&&(r+=.4);var o=(e.alt||"").toLowerCase(),a=t.toLowerCase();(o.includes(a)||a.includes(o))&&(r+=.3);var i=e.naturalWidth||e.width,s=e.naturalHeight||e.height;return i>=50&&s>=50&&(r+=.2),(o.includes("icon")||o.includes("logo")||i<50||s<50)&&(r-=.2),(o.includes("diagram")||o.includes("chart")||o.includes("graph")||o.includes("figure")||o.includes("\u0441\u0445\u0435\u043c\u0430")||o.includes("\u0434\u0438\u0430\u0433\u0440\u0430\u043c\u043c\u0430")||o.includes("\u0440\u0438\u0441\u0443\u043d\u043e\u043a")||o.includes("\u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435"))&&(r+=.3),console.log("\u{1f4ca} Relevance calculation for image:",{alt:o.substring(0,30),size:"".concat(i,"x").concat(s),isNearText:n,finalScore:Math.max(0,Math.min(1,r))}),Math.max(0,Math.min(1,r))},e.calculateSvgRelevance=function(e,t,n){var r=0;n&&(r+=.5),r+=.3;var o=e.textContent||"";return(o.toLowerCase().includes(t.toLowerCase())||t.toLowerCase().includes(o.toLowerCase()))&&(r+=.2),Math.max(0,Math.min(1,r))},e.calculateFormulaRelevance=function(e,t,n){var r=0;n&&(r+=.4);var o=t.toLowerCase().match(/\b(\u0444\u043e\u0440\u043c\u0443\u043b\u0430|\u0443\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u0435|\u0444\u0443\u043d\u043a\u0446\u0438\u044f|\u0438\u043d\u0442\u0435\u0433\u0440\u0430\u043b|\u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u043d\u0430\u044f|\u043c\u0430\u0442\u0440\u0438\u0446\u0430|\u0432\u0435\u043a\u0442\u043e\u0440|\u043b\u043e\u0433\u0430\u0440\u0438\u0444\u043c|\u0441\u0438\u043d\u0443\u0441|\u043a\u043e\u0441\u0438\u043d\u0443\u0441|\u0442\u0430\u043d\u0433\u0435\u043d\u0441|\u043f\u0440\u0435\u0434\u0435\u043b|\u0441\u0443\u043c\u043c\u0430|\u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0434\u0435\u043d\u0438\u0435)\b/g);return o&&o.length>0&&(r+=.4),e.length>20&&(r+=.2),Math.max(0,Math.min(1,r))},e.calculateCodeRelevance=function(e,t,n){var r=0;n&&(r+=.4);var o=t.toLowerCase().match(/\b(\u0430\u043b\u0433\u043e\u0440\u0438\u0442\u043c|\u0444\u0443\u043d\u043a\u0446\u0438\u044f|\u043c\u0435\u0442\u043e\u0434|\u043a\u043b\u0430\u0441\u0441|\u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0430\u044f|\u043c\u0430\u0441\u0441\u0438\u0432|\u0446\u0438\u043a\u043b|\u0443\u0441\u043b\u043e\u0432\u0438\u0435|\u043a\u043e\u0434|\u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0430|\u0441\u043a\u0440\u0438\u043f\u0442)\b/g);return o&&o.length>0&&(r+=.4),e.includes("\n")&&e.includes("{")&&e.includes("}")&&(r+=.2),Math.max(0,Math.min(1,r))},e.calculateLinkRelevance=function(e,t,n,r){var o=0;return r&&(o+=.3),(e.toLowerCase().includes(n.toLowerCase())||n.toLowerCase().includes(e.toLowerCase()))&&(o+=.4),(t.includes("wikipedia")||t.includes("edu")||t.includes("documentation"))&&(o+=.3),Math.max(0,Math.min(1,o))},e.convertImageToBase64=function(e){try{if(!e.complete||0===e.naturalWidth)return void console.warn("Image not loaded yet:",e.src);var t=document.createElement("canvas"),n=t.getContext("2d");if(!n)return;return t.width=e.naturalWidth||e.width,t.height=e.naturalHeight||e.height,n.fillStyle="#FFFFFF",n.fillRect(0,0,t.width,t.height),n.drawImage(e,0,0),t.toDataURL("image/png",1)}catch(e){return void console.warn("Could not convert image to base64:",e)}},e.fetchImageAsBase64=function(e){return r(this,void 0,void 0,(function(){var t;return o(this,(function(n){try{return console.log("\u{1f5bc}\ufe0f \u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043c \u0432\u043d\u0435\u0448\u043d\u0435\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435:",e),(t=new Image).crossOrigin="anonymous",[2,new Promise((function(n){t.onload=function(){try{var e=document.createElement("canvas"),r=e.getContext("2d");if(!r)return void n(void 0);e.width=t.naturalWidth,e.height=t.naturalHeight,r.fillStyle="#FFFFFF",r.fillRect(0,0,e.width,e.height),r.drawImage(t,0,0);var o=e.toDataURL("image/png",1);console.log("\u2705 \u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u043e \u0432 base64"),n(o)}catch(e){console.warn("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u0438 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f:",e),n(void 0)}},t.onerror=function(){console.warn("\u041e\u0448\u0438\u0431\u043a\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f:",e),n(void 0)},t.src=e}))]}catch(e){return console.warn("Failed to fetch image as base64:",e),[2,void 0]}return[2]}))}))},e.svgToDataUrl=function(e){var t=(new XMLSerializer).serializeToString(e);return"data:image/svg+xml;base64,".concat(btoa(t))},e.extractFormulaText=function(e){var t=e.querySelector("math");return t?t.textContent||t.innerHTML:e.getAttribute("data-latex")||e.getAttribute("data-math")||e.textContent||null},e.detectFormulaType=function(e){if(e.querySelector("math"))return"mathml";var t=e.className.toLowerCase();return t.includes("display")||t.includes("block")?"block":t.includes("inline")?"inline":"latex"},e.detectCodeLanguage=function(e){var t=e.className.match(/language-(\w+)|lang-(\w+)|highlight-(\w+)/);if(t)return t[1]||t[2]||t[3];var n=e.getAttribute("data-lang")||e.getAttribute("data-language");if(n)return n;var r=e.textContent||"";return r.includes("function")&&r.includes("{")?"javascript":r.includes("def ")&&r.includes(":")?"python":r.includes("#include")||r.includes("int main")?"cpp":r.includes("public class")||r.includes("System.out")?"java":void 0},e}()},78:(e,t,n)=>{n.d(t,{BE:()=>T,Br:()=>v,Fo:()=>I,GN:()=>d,H1:()=>F,K$:()=>y,KS:()=>z,OD:()=>f,R6:()=>u,Sv:()=>l,VM:()=>a,Wf:()=>h,Wy:()=>x,Xn:()=>c,ZJ:()=>k,Zm:()=>C,_W:()=>S,a0:()=>b,d$:()=>g,dU:()=>M,h9:()=>m,iY:()=>w,j9:()=>o,oV:()=>i,ow:()=>p,qM:()=>A,r:()=>r,x0:()=>s,yo:()=>E});var r="SET_OPEN_AI_KEY",o="SET_SELECTED_MODE",a="SET_TRANSLATE_TO_LANGUAGE",i="SET_ANKI_CONNECT_URL",s="SET_ANKI_CONNECT_API_KEY",l="SET_USE_ANKI_CONNECT",c="SET_VISIBLE_SIDEBAR",u="SET_SHOULD_GENERATE_IMAGE",d="SET_IMAGE_GENERATION_MODE",p="SET_TRANSLATION_PROMPT",h="SET_EXAMPLES_PROMPT",f="SET_AI_INSTRUCTIONS",g="SET_IMAGE_INSTRUCTIONS",m="SET_MODEL_PROVIDER",y="SET_GROQ_API_KEY",v="SET_GROQ_MODEL_NAME",b="SET_SOURCE_LANGUAGE",x=function(e){return{type:r,payload:e}},w=function(e){return{type:o,payload:e}},S=function(e){return{type:a,payload:e}},k=function(e){return{type:i,payload:e}},C=function(e){return{type:s,payload:e}},E=function(e){return{type:u,payload:e}},A=function(e){return{type:f,payload:e}},I=function(e){return{type:g,payload:e}},T=function(e){return{type:d,payload:e}},M=function(e){return{type:m,payload:e}},F=function(e){return{type:y,payload:e}},z=function(e){return{type:v,payload:e}}},148:(e,t,n)=>{n.d(t,{W:()=>l,l:()=>r});var r,o=n(78),a=n(55),i=function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},i.apply(this,arguments)};!function(e){e.OpenAI="openai",e.Groq="groq"}(r||(r={}));var s={openAiKey:"",mode:a.d.LanguageLearning,translateToLanguage:"ru",ankiConnectUrl:"http://127.0.0.1:8765",ankiConnectApiKey:null,useAnkiConnect:!1,visibleSideBar:!0,groqApiKey:"",groqModelName:"llama3-8b-8192",shouldGenerateImage:!0,imageGenerationMode:"smart",translationPrompt:"",examplesPrompt:"",aiInstructions:"",imageInstructions:"",modelProvider:r.OpenAI,sourceLanguage:"en"},l=function(e,t){switch(void 0===e&&(e=s),t.type){case o.r:return i(i({},e),{openAiKey:t.payload});case o.j9:return i(i({},e),{mode:a.d.LanguageLearning});case o.VM:return i(i({},e),{translateToLanguage:t.payload});case o.oV:return i(i({},e),{ankiConnectUrl:t.payload});case o.x0:return i(i({},e),{ankiConnectApiKey:t.payload});case o.Sv:return i(i({},e),{useAnkiConnect:t.payload});case o.Xn:return i(i({},e),{visibleSideBar:t.visible});case o.K$:return i(i({},e),{groqApiKey:t.payload});case o.Br:return i(i({},e),{groqModelName:t.payload});case o.R6:return i(i({},e),{shouldGenerateImage:t.payload});case o.ow:return i(i({},e),{translationPrompt:t.payload});case o.Wf:return i(i({},e),{examplesPrompt:t.payload});case o.OD:return i(i({},e),{aiInstructions:t.payload});case o.d$:return i(i({},e),{imageInstructions:t.payload});case o.GN:return i(i({},e),{imageGenerationMode:t.payload});case o.h9:return i(i({},e),{modelProvider:t.payload});case o.a0:return i(i({},e),{sourceLanguage:t.payload});default:return e}}},984:(e,t,n)=>{n.r(t),n.d(t,{processLatexInContent:()=>so,processLatexInContentAsync:()=>lo,renderLatexFormula:()=>ao,renderLatexFormulaSync:()=>io,testKaTeXRendering:()=>co});class r{constructor(e,t,n){this.lexer=void 0,this.start=void 0,this.end=void 0,this.lexer=e,this.start=t,this.end=n}static range(e,t){return t?e&&e.loc&&t.loc&&e.loc.lexer===t.loc.lexer?new r(e.loc.lexer,e.loc.start,t.loc.end):null:e&&e.loc}}class o{constructor(e,t){this.text=void 0,this.loc=void 0,this.noexpand=void 0,this.treatAsRelax=void 0,this.text=e,this.loc=t}range(e,t){return new o(t,r.range(this,e))}}class a{constructor(e,t){this.name=void 0,this.position=void 0,this.length=void 0,this.rawMessage=void 0;var n,r,o="KaTeX parse error: "+e,i=t&&t.loc;if(i&&i.start<=i.end){var s=i.lexer.input;n=i.start,r=i.end,n===s.length?o+=" at end of input: ":o+=" at position "+(n+1)+": ";var l=s.slice(n,r).replace(/[^]/g,"$&\u0332");o+=(n>15?"\u2026"+s.slice(n-15,n):s.slice(0,n))+l+(r+15<s.length?s.slice(r,r+15)+"\u2026":s.slice(r))}var c=new Error(o);return c.name="ParseError",c.__proto__=a.prototype,c.position=n,null!=n&&null!=r&&(c.length=r-n),c.rawMessage=e,c}}a.prototype.__proto__=Error.prototype;var i=/([A-Z])/g,s={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"},l=/[&><"']/g;var c=function e(t){return"ordgroup"===t.type||"color"===t.type?1===t.body.length?e(t.body[0]):t:"font"===t.type?e(t.body):t},u={contains:function(e,t){return-1!==e.indexOf(t)},deflt:function(e,t){return void 0===e?t:e},escape:function(e){return String(e).replace(l,(e=>s[e]))},hyphenate:function(e){return e.replace(i,"-$1").toLowerCase()},getBaseElem:c,isCharacterBox:function(e){var t=c(e);return"mathord"===t.type||"textord"===t.type||"atom"===t.type},protocolFromUrl:function(e){var t=/^[\x00-\x20]*([^\\/#?]*?)(:|&#0*58|&#x0*3a|&colon)/i.exec(e);return t?":"!==t[2]?null:/^[a-zA-Z][a-zA-Z0-9+\-.]*$/.test(t[1])?t[1].toLowerCase():null:"_relative"}},d={displayMode:{type:"boolean",description:"Render math in display mode, which puts the math in display style (so \\int and \\sum are large, for example), and centers the math on the page on its own line.",cli:"-d, --display-mode"},output:{type:{enum:["htmlAndMathml","html","mathml"]},description:"Determines the markup language of the output.",cli:"-F, --format <type>"},leqno:{type:"boolean",description:"Render display math in leqno style (left-justified tags)."},fleqn:{type:"boolean",description:"Render display math flush left."},throwOnError:{type:"boolean",default:!0,cli:"-t, --no-throw-on-error",cliDescription:"Render errors (in the color given by --error-color) instead of throwing a ParseError exception when encountering an error."},errorColor:{type:"string",default:"#cc0000",cli:"-c, --error-color <color>",cliDescription:"A color string given in the format 'rgb' or 'rrggbb' (no #). This option determines the color of errors rendered by the -t option.",cliProcessor:e=>"#"+e},macros:{type:"object",cli:"-m, --macro <def>",cliDescription:"Define custom macro of the form '\\foo:expansion' (use multiple -m arguments for multiple macros).",cliDefault:[],cliProcessor:(e,t)=>(t.push(e),t)},minRuleThickness:{type:"number",description:"Specifies a minimum thickness, in ems, for fraction lines, `\\sqrt` top lines, `{array}` vertical lines, `\\hline`, `\\hdashline`, `\\underline`, `\\overline`, and the borders of `\\fbox`, `\\boxed`, and `\\fcolorbox`.",processor:e=>Math.max(0,e),cli:"--min-rule-thickness <size>",cliProcessor:parseFloat},colorIsTextColor:{type:"boolean",description:"Makes \\color behave like LaTeX's 2-argument \\textcolor, instead of LaTeX's one-argument \\color mode change.",cli:"-b, --color-is-text-color"},strict:{type:[{enum:["warn","ignore","error"]},"boolean","function"],description:"Turn on strict / LaTeX faithfulness mode, which throws an error if the input uses features that are not supported by LaTeX.",cli:"-S, --strict",cliDefault:!1},trust:{type:["boolean","function"],description:"Trust the input, enabling all HTML features such as \\url.",cli:"-T, --trust"},maxSize:{type:"number",default:1/0,description:"If non-zero, all user-specified sizes, e.g. in \\rule{500em}{500em}, will be capped to maxSize ems. Otherwise, elements and spaces can be arbitrarily large",processor:e=>Math.max(0,e),cli:"-s, --max-size <n>",cliProcessor:parseInt},maxExpand:{type:"number",default:1e3,description:"Limit the number of macro expansions to the specified number, to prevent e.g. infinite macro loops. If set to Infinity, the macro expander will try to fully expand as in LaTeX.",processor:e=>Math.max(0,e),cli:"-e, --max-expand <n>",cliProcessor:e=>"Infinity"===e?1/0:parseInt(e)},globalGroup:{type:"boolean",cli:!1}};function p(e){if(e.default)return e.default;var t=e.type,n=Array.isArray(t)?t[0]:t;if("string"!=typeof n)return n.enum[0];switch(n){case"boolean":return!1;case"string":return"";case"number":return 0;case"object":return{}}}class h{constructor(e){for(var t in this.displayMode=void 0,this.output=void 0,this.leqno=void 0,this.fleqn=void 0,this.throwOnError=void 0,this.errorColor=void 0,this.macros=void 0,this.minRuleThickness=void 0,this.colorIsTextColor=void 0,this.strict=void 0,this.trust=void 0,this.maxSize=void 0,this.maxExpand=void 0,this.globalGroup=void 0,e=e||{},d)if(d.hasOwnProperty(t)){var n=d[t];this[t]=void 0!==e[t]?n.processor?n.processor(e[t]):e[t]:p(n)}}reportNonstrict(e,t,n){var r=this.strict;if("function"==typeof r&&(r=r(e,t,n)),r&&"ignore"!==r){if(!0===r||"error"===r)throw new a("LaTeX-incompatible input and strict mode is set to 'error': "+t+" ["+e+"]",n);"warn"===r?"undefined"!=typeof console&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+t+" ["+e+"]"):"undefined"!=typeof console&&console.warn("LaTeX-incompatible input and strict mode is set to unrecognized '"+r+"': "+t+" ["+e+"]")}}useStrictBehavior(e,t,n){var r=this.strict;if("function"==typeof r)try{r=r(e,t,n)}catch(e){r="error"}return!(!r||"ignore"===r)&&(!0===r||"error"===r||("warn"===r?("undefined"!=typeof console&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+t+" ["+e+"]"),!1):("undefined"!=typeof console&&console.warn("LaTeX-incompatible input and strict mode is set to unrecognized '"+r+"': "+t+" ["+e+"]"),!1)))}isTrusted(e){if(e.url&&!e.protocol){var t=u.protocolFromUrl(e.url);if(null==t)return!1;e.protocol=t}var n="function"==typeof this.trust?this.trust(e):this.trust;return Boolean(n)}}class f{constructor(e,t,n){this.id=void 0,this.size=void 0,this.cramped=void 0,this.id=e,this.size=t,this.cramped=n}sup(){return g[m[this.id]]}sub(){return g[y[this.id]]}fracNum(){return g[v[this.id]]}fracDen(){return g[b[this.id]]}cramp(){return g[x[this.id]]}text(){return g[w[this.id]]}isTight(){return this.size>=2}}var g=[new f(0,0,!1),new f(1,0,!0),new f(2,1,!1),new f(3,1,!0),new f(4,2,!1),new f(5,2,!0),new f(6,3,!1),new f(7,3,!0)],m=[4,5,4,5,6,7,6,7],y=[5,5,5,5,7,7,7,7],v=[2,3,4,5,6,7,6,7],b=[3,3,5,5,7,7,7,7],x=[1,1,3,3,5,5,7,7],w=[0,1,2,3,2,3,2,3],S={DISPLAY:g[0],TEXT:g[2],SCRIPT:g[4],SCRIPTSCRIPT:g[6]},k=[{name:"latin",blocks:[[256,591],[768,879]]},{name:"cyrillic",blocks:[[1024,1279]]},{name:"armenian",blocks:[[1328,1423]]},{name:"brahmic",blocks:[[2304,4255]]},{name:"georgian",blocks:[[4256,4351]]},{name:"cjk",blocks:[[12288,12543],[19968,40879],[65280,65376]]},{name:"hangul",blocks:[[44032,55215]]}];var C=[];function E(e){for(var t=0;t<C.length;t+=2)if(e>=C[t]&&e<=C[t+1])return!0;return!1}k.forEach((e=>e.blocks.forEach((e=>C.push(...e)))));var A=80,I={doubleleftarrow:"M262 157\nl10-10c34-36 62.7-77 86-123 3.3-8 5-13.3 5-16 0-5.3-6.7-8-20-8-7.3\n 0-12.2.5-14.5 1.5-2.3 1-4.8 4.5-7.5 10.5-49.3 97.3-121.7 169.3-217 216-28\n 14-57.3 25-88 33-6.7 2-11 3.8-13 5.5-2 1.7-3 4.2-3 7.5s1 5.8 3 7.5\nc2 1.7 6.3 3.5 13 5.5 68 17.3 128.2 47.8 180.5 91.5 52.3 43.7 93.8 96.2 124.5\n 157.5 9.3 8 15.3 12.3 18 13h6c12-.7 18-4 18-10 0-2-1.7-7-5-15-23.3-46-52-87\n-86-123l-10-10h399738v-40H218c328 0 0 0 0 0l-10-8c-26.7-20-65.7-43-117-69 2.7\n-2 6-3.7 10-5 36.7-16 72.3-37.3 107-64l10-8h399782v-40z\nm8 0v40h399730v-40zm0 194v40h399730v-40z",doublerightarrow:"M399738 392l\n-10 10c-34 36-62.7 77-86 123-3.3 8-5 13.3-5 16 0 5.3 6.7 8 20 8 7.3 0 12.2-.5\n 14.5-1.5 2.3-1 4.8-4.5 7.5-10.5 49.3-97.3 121.7-169.3 217-216 28-14 57.3-25 88\n-33 6.7-2 11-3.8 13-5.5 2-1.7 3-4.2 3-7.5s-1-5.8-3-7.5c-2-1.7-6.3-3.5-13-5.5-68\n-17.3-128.2-47.8-180.5-91.5-52.3-43.7-93.8-96.2-124.5-157.5-9.3-8-15.3-12.3-18\n-13h-6c-12 .7-18 4-18 10 0 2 1.7 7 5 15 23.3 46 52 87 86 123l10 10H0v40h399782\nc-328 0 0 0 0 0l10 8c26.7 20 65.7 43 117 69-2.7 2-6 3.7-10 5-36.7 16-72.3 37.3\n-107 64l-10 8H0v40zM0 157v40h399730v-40zm0 194v40h399730v-40z",leftarrow:"M400000 241H110l3-3c68.7-52.7 113.7-120\n 135-202 4-14.7 6-23 6-25 0-7.3-7-11-21-11-8 0-13.2.8-15.5 2.5-2.3 1.7-4.2 5.8\n-5.5 12.5-1.3 4.7-2.7 10.3-4 17-12 48.7-34.8 92-68.5 130S65.3 228.3 18 247\nc-10 4-16 7.7-18 11 0 8.7 6 14.3 18 17 47.3 18.7 87.8 47 121.5 85S196 441.3 208\n 490c.7 2 1.3 5 2 9s1.2 6.7 1.5 8c.3 1.3 1 3.3 2 6s2.2 4.5 3.5 5.5c1.3 1 3.3\n 1.8 6 2.5s6 1 10 1c14 0 21-3.7 21-11 0-2-2-10.3-6-25-20-79.3-65-146.7-135-202\n l-3-3h399890zM100 241v40h399900v-40z",leftbrace:"M6 548l-6-6v-35l6-11c56-104 135.3-181.3 238-232 57.3-28.7 117\n-45 179-50h399577v120H403c-43.3 7-81 15-113 26-100.7 33-179.7 91-237 174-2.7\n 5-6 9-10 13-.7 1-7.3 1-20 1H6z",leftbraceunder:"M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13\n 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688\n 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7\n-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z",leftgroup:"M400000 80\nH435C64 80 168.3 229.4 21 260c-5.9 1.2-18 0-18 0-2 0-3-1-3-3v-38C76 61 257 0\n 435 0h399565z",leftgroupunder:"M400000 262\nH435C64 262 168.3 112.6 21 82c-5.9-1.2-18 0-18 0-2 0-3 1-3 3v38c76 158 257 219\n 435 219h399565z",leftharpoon:"M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3\n-3.3 10.2-9.5 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5\n-18.3 3-21-1.3-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7\n-196 228-6.7 4.7-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40z",leftharpoonplus:"M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3-3.3 10.2-9.5\n 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5-18.3 3-21-1.3\n-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7-196 228-6.7 4.7\n-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40zM0 435v40h400000v-40z\nm0 0v40h400000v-40z",leftharpoondown:"M7 241c-4 4-6.333 8.667-7 14 0 5.333.667 9 2 11s5.333\n 5.333 12 10c90.667 54 156 130 196 228 3.333 10.667 6.333 16.333 9 17 2 .667 5\n 1 9 1h5c10.667 0 16.667-2 18-6 2-2.667 1-9.667-3-21-32-87.333-82.667-157.667\n-152-211l-3-3h399907v-40zM93 281 H400000 v-40L7 241z",leftharpoondownplus:"M7 435c-4 4-6.3 8.7-7 14 0 5.3.7 9 2 11s5.3 5.3 12\n 10c90.7 54 156 130 196 228 3.3 10.7 6.3 16.3 9 17 2 .7 5 1 9 1h5c10.7 0 16.7\n-2 18-6 2-2.7 1-9.7-3-21-32-87.3-82.7-157.7-152-211l-3-3h399907v-40H7zm93 0\nv40h399900v-40zM0 241v40h399900v-40zm0 0v40h399900v-40z",lefthook:"M400000 281 H103s-33-11.2-61-33.5S0 197.3 0 164s14.2-61.2 42.5\n-83.5C70.8 58.2 104 47 142 47 c16.7 0 25 6.7 25 20 0 12-8.7 18.7-26 20-40 3.3\n-68.7 15.7-86 37-10 12-15 25.3-15 40 0 22.7 9.8 40.7 29.5 54 19.7 13.3 43.5 21\n 71.5 23h399859zM103 281v-40h399897v40z",leftlinesegment:"M40 281 V428 H0 V94 H40 V241 H400000 v40z\nM40 281 V428 H0 V94 H40 V241 H400000 v40z",leftmapsto:"M40 281 V448H0V74H40V241H400000v40z\nM40 281 V448H0V74H40V241H400000v40z",leftToFrom:"M0 147h400000v40H0zm0 214c68 40 115.7 95.7 143 167h22c15.3 0 23\n-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69-70-101l-7-8h399905v-40H95l7-8\nc28.7-32 52-65.7 70-101 10.7-23.3 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 265.3\n 68 321 0 361zm0-174v-40h399900v40zm100 154v40h399900v-40z",longequal:"M0 50 h400000 v40H0z m0 194h40000v40H0z\nM0 50 h400000 v40H0z m0 194h40000v40H0z",midbrace:"M200428 334\nc-100.7-8.3-195.3-44-280-108-55.3-42-101.7-93-139-153l-9-14c-2.7 4-5.7 8.7-9 14\n-53.3 86.7-123.7 153-211 199-66.7 36-137.3 56.3-212 62H0V214h199568c178.3-11.7\n 311.7-78.3 403-201 6-8 9.7-12 11-12 .7-.7 6.7-1 18-1s17.3.3 18 1c1.3 0 5 4 11\n 12 44.7 59.3 101.3 106.3 170 141s145.3 54.3 229 60h199572v120z",midbraceunder:"M199572 214\nc100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14\n 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3\n 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0\n-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z",oiintSize1:"M512.6 71.6c272.6 0 320.3 106.8 320.3 178.2 0 70.8-47.7 177.6\n-320.3 177.6S193.1 320.6 193.1 249.8c0-71.4 46.9-178.2 319.5-178.2z\nm368.1 178.2c0-86.4-60.9-215.4-368.1-215.4-306.4 0-367.3 129-367.3 215.4 0 85.8\n60.9 214.8 367.3 214.8 307.2 0 368.1-129 368.1-214.8z",oiintSize2:"M757.8 100.1c384.7 0 451.1 137.6 451.1 230 0 91.3-66.4 228.8\n-451.1 228.8-386.3 0-452.7-137.5-452.7-228.8 0-92.4 66.4-230 452.7-230z\nm502.4 230c0-111.2-82.4-277.2-502.4-277.2s-504 166-504 277.2\nc0 110 84 276 504 276s502.4-166 502.4-276z",oiiintSize1:"M681.4 71.6c408.9 0 480.5 106.8 480.5 178.2 0 70.8-71.6 177.6\n-480.5 177.6S202.1 320.6 202.1 249.8c0-71.4 70.5-178.2 479.3-178.2z\nm525.8 178.2c0-86.4-86.8-215.4-525.7-215.4-437.9 0-524.7 129-524.7 215.4 0\n85.8 86.8 214.8 524.7 214.8 438.9 0 525.7-129 525.7-214.8z",oiiintSize2:"M1021.2 53c603.6 0 707.8 165.8 707.8 277.2 0 110-104.2 275.8\n-707.8 275.8-606 0-710.2-165.8-710.2-275.8C311 218.8 415.2 53 1021.2 53z\nm770.4 277.1c0-131.2-126.4-327.6-770.5-327.6S248.4 198.9 248.4 330.1\nc0 130 128.8 326.4 772.7 326.4s770.5-196.4 770.5-326.4z",rightarrow:"M0 241v40h399891c-47.3 35.3-84 78-110 128\n-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20\n 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7\n 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85\n-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5\n-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67\n 151.7 139 205zm0 0v40h399900v-40z",rightbrace:"M400000 542l\n-6 6h-17c-12.7 0-19.3-.3-20-1-4-4-7.3-8.3-10-13-35.3-51.3-80.8-93.8-136.5-127.5\ns-117.2-55.8-184.5-66.5c-.7 0-2-.3-4-1-18.7-2.7-76-4.3-172-5H0V214h399571l6 1\nc124.7 8 235 61.7 331 161 31.3 33.3 59.7 72.7 85 118l7 13v35z",rightbraceunder:"M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3\n 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237\n-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z",rightgroup:"M0 80h399565c371 0 266.7 149.4 414 180 5.9 1.2 18 0 18 0 2 0\n 3-1 3-3v-38c-76-158-257-219-435-219H0z",rightgroupunder:"M0 262h399565c371 0 266.7-149.4 414-180 5.9-1.2 18 0 18\n 0 2 0 3 1 3 3v38c-76 158-257 219-435 219H0z",rightharpoon:"M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3\n-3.7-15.3-11-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2\n-10.7 0-16.7 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58\n 69.2 92 94.5zm0 0v40h399900v-40z",rightharpoonplus:"M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3-3.7-15.3-11\n-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2-10.7 0-16.7\n 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58 69.2 92 94.5z\nm0 0v40h399900v-40z m100 194v40h399900v-40zm0 0v40h399900v-40z",rightharpoondown:"M399747 511c0 7.3 6.7 11 20 11 8 0 13-.8 15-2.5s4.7-6.8\n 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3 8.5-5.8 9.5\n-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3-64.7 57-92 95\n-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 241v40h399900v-40z",rightharpoondownplus:"M399747 705c0 7.3 6.7 11 20 11 8 0 13-.8\n 15-2.5s4.7-6.8 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3\n 8.5-5.8 9.5-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3\n-64.7 57-92 95-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 435v40h399900v-40z\nm0-194v40h400000v-40zm0 0v40h400000v-40z",righthook:"M399859 241c-764 0 0 0 0 0 40-3.3 68.7-15.7 86-37 10-12 15-25.3\n 15-40 0-22.7-9.8-40.7-29.5-54-19.7-13.3-43.5-21-71.5-23-17.3-1.3-26-8-26-20 0\n-13.3 8.7-20 26-20 38 0 71 11.2 99 33.5 0 0 7 5.6 21 16.7 14 11.2 21 33.5 21\n 66.8s-14 61.2-42 83.5c-28 22.3-61 33.5-99 33.5L0 241z M0 281v-40h399859v40z",rightlinesegment:"M399960 241 V94 h40 V428 h-40 V281 H0 v-40z\nM399960 241 V94 h40 V428 h-40 V281 H0 v-40z",rightToFrom:"M400000 167c-70.7-42-118-97.7-142-167h-23c-15.3 0-23 .3-23\n 1 0 1.3 5.3 13.7 16 37 18 35.3 41.3 69 70 101l7 8H0v40h399905l-7 8c-28.7 32\n-52 65.7-70 101-10.7 23.3-16 35.7-16 37 0 .7 7.7 1 23 1h23c24-69.3 71.3-125 142\n-167z M100 147v40h399900v-40zM0 341v40h399900v-40z",twoheadleftarrow:"M0 167c68 40\n 115.7 95.7 143 167h22c15.3 0 23-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69\n-70-101l-7-8h125l9 7c50.7 39.3 85 86 103 140h46c0-4.7-6.3-18.7-19-42-18-35.3\n-40-67.3-66-96l-9-9h399716v-40H284l9-9c26-28.7 48-60.7 66-96 12.7-23.333 19\n-37.333 19-42h-46c-18 54-52.3 100.7-103 140l-9 7H95l7-8c28.7-32 52-65.7 70-101\n 10.7-23.333 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 71.3 68 127 0 167z",twoheadrightarrow:"M400000 167\nc-68-40-115.7-95.7-143-167h-22c-15.3 0-23 .3-23 1 0 1.3 5.3 13.7 16 37 18 35.3\n 41.3 69 70 101l7 8h-125l-9-7c-50.7-39.3-85-86-103-140h-46c0 4.7 6.3 18.7 19 42\n 18 35.3 40 67.3 66 96l9 9H0v40h399716l-9 9c-26 28.7-48 60.7-66 96-12.7 23.333\n-19 37.333-19 42h46c18-54 52.3-100.7 103-140l9-7h125l-7 8c-28.7 32-52 65.7-70\n 101-10.7 23.333-16 35.7-16 37 0 .7 7.7 1 23 1h22c27.3-71.3 75-127 143-167z",tilde1:"M200 55.538c-77 0-168 73.953-177 73.953-3 0-7\n-2.175-9-5.437L2 97c-1-2-2-4-2-6 0-4 2-7 5-9l20-12C116 12 171 0 207 0c86 0\n 114 68 191 68 78 0 168-68 177-68 4 0 7 2 9 5l12 19c1 2.175 2 4.35 2 6.525 0\n 4.35-2 7.613-5 9.788l-19 13.05c-92 63.077-116.937 75.308-183 76.128\n-68.267.847-113-73.952-191-73.952z",tilde2:"M344 55.266c-142 0-300.638 81.316-311.5 86.418\n-8.01 3.762-22.5 10.91-23.5 5.562L1 120c-1-2-1-3-1-4 0-5 3-9 8-10l18.4-9C160.9\n 31.9 283 0 358 0c148 0 188 122 331 122s314-97 326-97c4 0 8 2 10 7l7 21.114\nc1 2.14 1 3.21 1 4.28 0 5.347-3 9.626-7 10.696l-22.3 12.622C852.6 158.372 751\n 181.476 676 181.476c-149 0-189-126.21-332-126.21z",tilde3:"M786 59C457 59 32 175.242 13 175.242c-6 0-10-3.457\n-11-10.37L.15 138c-1-7 3-12 10-13l19.2-6.4C378.4 40.7 634.3 0 804.3 0c337 0\n 411.8 157 746.8 157 328 0 754-112 773-112 5 0 10 3 11 9l1 14.075c1 8.066-.697\n 16.595-6.697 17.492l-21.052 7.31c-367.9 98.146-609.15 122.696-778.15 122.696\n -338 0-409-156.573-744-156.573z",tilde4:"M786 58C457 58 32 177.487 13 177.487c-6 0-10-3.345\n-11-10.035L.15 143c-1-7 3-12 10-13l22-6.7C381.2 35 637.15 0 807.15 0c337 0 409\n 177 744 177 328 0 754-127 773-127 5 0 10 3 11 9l1 14.794c1 7.805-3 13.38-9\n 14.495l-20.7 5.574c-366.85 99.79-607.3 139.372-776.3 139.372-338 0-409\n -175.236-744-175.236z",vec:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z",widehat1:"M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22\nc-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z",widehat2:"M1181 0h2l1171 176c6 0 10 5 10 11l-2 23c-1 6-5 10\n-11 10h-1L1182 67 15 220h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z",widehat3:"M1181 0h2l1171 236c6 0 10 5 10 11l-2 23c-1 6-5 10\n-11 10h-1L1182 67 15 280h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z",widehat4:"M1181 0h2l1171 296c6 0 10 5 10 11l-2 23c-1 6-5 10\n-11 10h-1L1182 67 15 340h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z",widecheck1:"M529,159h5l519,-115c5,-1,9,-5,9,-10c0,-1,-1,-2,-1,-3l-4,-22c-1,\n-5,-5,-9,-11,-9h-2l-512,92l-513,-92h-2c-5,0,-9,4,-11,9l-5,22c-1,6,2,12,8,13z",widecheck2:"M1181,220h2l1171,-176c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,\n-11,-10h-1l-1168,153l-1167,-153h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z",widecheck3:"M1181,280h2l1171,-236c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,\n-11,-10h-1l-1168,213l-1167,-213h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z",widecheck4:"M1181,340h2l1171,-296c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,\n-11,-10h-1l-1168,273l-1167,-273h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z",baraboveleftarrow:"M400000 620h-399890l3 -3c68.7 -52.7 113.7 -120 135 -202\nc4 -14.7 6 -23 6 -25c0 -7.3 -7 -11 -21 -11c-8 0 -13.2 0.8 -15.5 2.5\nc-2.3 1.7 -4.2 5.8 -5.5 12.5c-1.3 4.7 -2.7 10.3 -4 17c-12 48.7 -34.8 92 -68.5 130\ns-74.2 66.3 -121.5 85c-10 4 -16 7.7 -18 11c0 8.7 6 14.3 18 17c47.3 18.7 87.8 47\n121.5 85s56.5 81.3 68.5 130c0.7 2 1.3 5 2 9s1.2 6.7 1.5 8c0.3 1.3 1 3.3 2 6\ns2.2 4.5 3.5 5.5c1.3 1 3.3 1.8 6 2.5s6 1 10 1c14 0 21 -3.7 21 -11\nc0 -2 -2 -10.3 -6 -25c-20 -79.3 -65 -146.7 -135 -202l-3 -3h399890z\nM100 620v40h399900v-40z M0 241v40h399900v-40zM0 241v40h399900v-40z",rightarrowabovebar:"M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32\n-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0\n13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39\n-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5\n-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5\n-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67\n151.7 139 205zm96 379h399894v40H0zm0 0h399904v40H0z",baraboveshortleftharpoon:"M507,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11\nc1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17\nc2,0.7,5,1,9,1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21\nc-32,-87.3,-82.7,-157.7,-152,-211c0,0,-3,-3,-3,-3l399351,0l0,-40\nc-398570,0,-399437,0,-399437,0z M593 435 v40 H399500 v-40z\nM0 281 v-40 H399908 v40z M0 281 v-40 H399908 v40z",rightharpoonaboveshortbar:"M0,241 l0,40c399126,0,399993,0,399993,0\nc4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,\n-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6\nc-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z\nM0 241 v40 H399908 v-40z M0 475 v-40 H399500 v40z M0 475 v-40 H399500 v40z",shortbaraboveleftharpoon:"M7,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11\nc1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17c2,0.7,5,1,9,\n1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21c-32,-87.3,-82.7,-157.7,\n-152,-211c0,0,-3,-3,-3,-3l399907,0l0,-40c-399126,0,-399993,0,-399993,0z\nM93 435 v40 H400000 v-40z M500 241 v40 H400000 v-40z M500 241 v40 H400000 v-40z",shortrightharpoonabovebar:"M53,241l0,40c398570,0,399437,0,399437,0\nc4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,\n-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6\nc-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z\nM500 241 v40 H399408 v-40z M500 435 v40 H400000 v-40z"};class T{constructor(e){this.children=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.children=e,this.classes=[],this.height=0,this.depth=0,this.maxFontSize=0,this.style={}}hasClass(e){return u.contains(this.classes,e)}toNode(){for(var e=document.createDocumentFragment(),t=0;t<this.children.length;t++)e.appendChild(this.children[t].toNode());return e}toMarkup(){for(var e="",t=0;t<this.children.length;t++)e+=this.children[t].toMarkup();return e}toText(){return this.children.map((e=>e.toText())).join("")}}var M={"AMS-Regular":{32:[0,0,0,0,.25],65:[0,.68889,0,0,.72222],66:[0,.68889,0,0,.66667],67:[0,.68889,0,0,.72222],68:[0,.68889,0,0,.72222],69:[0,.68889,0,0,.66667],70:[0,.68889,0,0,.61111],71:[0,.68889,0,0,.77778],72:[0,.68889,0,0,.77778],73:[0,.68889,0,0,.38889],74:[.16667,.68889,0,0,.5],75:[0,.68889,0,0,.77778],76:[0,.68889,0,0,.66667],77:[0,.68889,0,0,.94445],78:[0,.68889,0,0,.72222],79:[.16667,.68889,0,0,.77778],80:[0,.68889,0,0,.61111],81:[.16667,.68889,0,0,.77778],82:[0,.68889,0,0,.72222],83:[0,.68889,0,0,.55556],84:[0,.68889,0,0,.66667],85:[0,.68889,0,0,.72222],86:[0,.68889,0,0,.72222],87:[0,.68889,0,0,1],88:[0,.68889,0,0,.72222],89:[0,.68889,0,0,.72222],90:[0,.68889,0,0,.66667],107:[0,.68889,0,0,.55556],160:[0,0,0,0,.25],165:[0,.675,.025,0,.75],174:[.15559,.69224,0,0,.94666],240:[0,.68889,0,0,.55556],295:[0,.68889,0,0,.54028],710:[0,.825,0,0,2.33334],732:[0,.9,0,0,2.33334],770:[0,.825,0,0,2.33334],771:[0,.9,0,0,2.33334],989:[.08167,.58167,0,0,.77778],1008:[0,.43056,.04028,0,.66667],8245:[0,.54986,0,0,.275],8463:[0,.68889,0,0,.54028],8487:[0,.68889,0,0,.72222],8498:[0,.68889,0,0,.55556],8502:[0,.68889,0,0,.66667],8503:[0,.68889,0,0,.44445],8504:[0,.68889,0,0,.66667],8513:[0,.68889,0,0,.63889],8592:[-.03598,.46402,0,0,.5],8594:[-.03598,.46402,0,0,.5],8602:[-.13313,.36687,0,0,1],8603:[-.13313,.36687,0,0,1],8606:[.01354,.52239,0,0,1],8608:[.01354,.52239,0,0,1],8610:[.01354,.52239,0,0,1.11111],8611:[.01354,.52239,0,0,1.11111],8619:[0,.54986,0,0,1],8620:[0,.54986,0,0,1],8621:[-.13313,.37788,0,0,1.38889],8622:[-.13313,.36687,0,0,1],8624:[0,.69224,0,0,.5],8625:[0,.69224,0,0,.5],8630:[0,.43056,0,0,1],8631:[0,.43056,0,0,1],8634:[.08198,.58198,0,0,.77778],8635:[.08198,.58198,0,0,.77778],8638:[.19444,.69224,0,0,.41667],8639:[.19444,.69224,0,0,.41667],8642:[.19444,.69224,0,0,.41667],8643:[.19444,.69224,0,0,.41667],8644:[.1808,.675,0,0,1],8646:[.1808,.675,0,0,1],8647:[.1808,.675,0,0,1],8648:[.19444,.69224,0,0,.83334],8649:[.1808,.675,0,0,1],8650:[.19444,.69224,0,0,.83334],8651:[.01354,.52239,0,0,1],8652:[.01354,.52239,0,0,1],8653:[-.13313,.36687,0,0,1],8654:[-.13313,.36687,0,0,1],8655:[-.13313,.36687,0,0,1],8666:[.13667,.63667,0,0,1],8667:[.13667,.63667,0,0,1],8669:[-.13313,.37788,0,0,1],8672:[-.064,.437,0,0,1.334],8674:[-.064,.437,0,0,1.334],8705:[0,.825,0,0,.5],8708:[0,.68889,0,0,.55556],8709:[.08167,.58167,0,0,.77778],8717:[0,.43056,0,0,.42917],8722:[-.03598,.46402,0,0,.5],8724:[.08198,.69224,0,0,.77778],8726:[.08167,.58167,0,0,.77778],8733:[0,.69224,0,0,.77778],8736:[0,.69224,0,0,.72222],8737:[0,.69224,0,0,.72222],8738:[.03517,.52239,0,0,.72222],8739:[.08167,.58167,0,0,.22222],8740:[.25142,.74111,0,0,.27778],8741:[.08167,.58167,0,0,.38889],8742:[.25142,.74111,0,0,.5],8756:[0,.69224,0,0,.66667],8757:[0,.69224,0,0,.66667],8764:[-.13313,.36687,0,0,.77778],8765:[-.13313,.37788,0,0,.77778],8769:[-.13313,.36687,0,0,.77778],8770:[-.03625,.46375,0,0,.77778],8774:[.30274,.79383,0,0,.77778],8776:[-.01688,.48312,0,0,.77778],8778:[.08167,.58167,0,0,.77778],8782:[.06062,.54986,0,0,.77778],8783:[.06062,.54986,0,0,.77778],8785:[.08198,.58198,0,0,.77778],8786:[.08198,.58198,0,0,.77778],8787:[.08198,.58198,0,0,.77778],8790:[0,.69224,0,0,.77778],8791:[.22958,.72958,0,0,.77778],8796:[.08198,.91667,0,0,.77778],8806:[.25583,.75583,0,0,.77778],8807:[.25583,.75583,0,0,.77778],8808:[.25142,.75726,0,0,.77778],8809:[.25142,.75726,0,0,.77778],8812:[.25583,.75583,0,0,.5],8814:[.20576,.70576,0,0,.77778],8815:[.20576,.70576,0,0,.77778],8816:[.30274,.79383,0,0,.77778],8817:[.30274,.79383,0,0,.77778],8818:[.22958,.72958,0,0,.77778],8819:[.22958,.72958,0,0,.77778],8822:[.1808,.675,0,0,.77778],8823:[.1808,.675,0,0,.77778],8828:[.13667,.63667,0,0,.77778],8829:[.13667,.63667,0,0,.77778],8830:[.22958,.72958,0,0,.77778],8831:[.22958,.72958,0,0,.77778],8832:[.20576,.70576,0,0,.77778],8833:[.20576,.70576,0,0,.77778],8840:[.30274,.79383,0,0,.77778],8841:[.30274,.79383,0,0,.77778],8842:[.13597,.63597,0,0,.77778],8843:[.13597,.63597,0,0,.77778],8847:[.03517,.54986,0,0,.77778],8848:[.03517,.54986,0,0,.77778],8858:[.08198,.58198,0,0,.77778],8859:[.08198,.58198,0,0,.77778],8861:[.08198,.58198,0,0,.77778],8862:[0,.675,0,0,.77778],8863:[0,.675,0,0,.77778],8864:[0,.675,0,0,.77778],8865:[0,.675,0,0,.77778],8872:[0,.69224,0,0,.61111],8873:[0,.69224,0,0,.72222],8874:[0,.69224,0,0,.88889],8876:[0,.68889,0,0,.61111],8877:[0,.68889,0,0,.61111],8878:[0,.68889,0,0,.72222],8879:[0,.68889,0,0,.72222],8882:[.03517,.54986,0,0,.77778],8883:[.03517,.54986,0,0,.77778],8884:[.13667,.63667,0,0,.77778],8885:[.13667,.63667,0,0,.77778],8888:[0,.54986,0,0,1.11111],8890:[.19444,.43056,0,0,.55556],8891:[.19444,.69224,0,0,.61111],8892:[.19444,.69224,0,0,.61111],8901:[0,.54986,0,0,.27778],8903:[.08167,.58167,0,0,.77778],8905:[.08167,.58167,0,0,.77778],8906:[.08167,.58167,0,0,.77778],8907:[0,.69224,0,0,.77778],8908:[0,.69224,0,0,.77778],8909:[-.03598,.46402,0,0,.77778],8910:[0,.54986,0,0,.76042],8911:[0,.54986,0,0,.76042],8912:[.03517,.54986,0,0,.77778],8913:[.03517,.54986,0,0,.77778],8914:[0,.54986,0,0,.66667],8915:[0,.54986,0,0,.66667],8916:[0,.69224,0,0,.66667],8918:[.0391,.5391,0,0,.77778],8919:[.0391,.5391,0,0,.77778],8920:[.03517,.54986,0,0,1.33334],8921:[.03517,.54986,0,0,1.33334],8922:[.38569,.88569,0,0,.77778],8923:[.38569,.88569,0,0,.77778],8926:[.13667,.63667,0,0,.77778],8927:[.13667,.63667,0,0,.77778],8928:[.30274,.79383,0,0,.77778],8929:[.30274,.79383,0,0,.77778],8934:[.23222,.74111,0,0,.77778],8935:[.23222,.74111,0,0,.77778],8936:[.23222,.74111,0,0,.77778],8937:[.23222,.74111,0,0,.77778],8938:[.20576,.70576,0,0,.77778],8939:[.20576,.70576,0,0,.77778],8940:[.30274,.79383,0,0,.77778],8941:[.30274,.79383,0,0,.77778],8994:[.19444,.69224,0,0,.77778],8995:[.19444,.69224,0,0,.77778],9416:[.15559,.69224,0,0,.90222],9484:[0,.69224,0,0,.5],9488:[0,.69224,0,0,.5],9492:[0,.37788,0,0,.5],9496:[0,.37788,0,0,.5],9585:[.19444,.68889,0,0,.88889],9586:[.19444,.74111,0,0,.88889],9632:[0,.675,0,0,.77778],9633:[0,.675,0,0,.77778],9650:[0,.54986,0,0,.72222],9651:[0,.54986,0,0,.72222],9654:[.03517,.54986,0,0,.77778],9660:[0,.54986,0,0,.72222],9661:[0,.54986,0,0,.72222],9664:[.03517,.54986,0,0,.77778],9674:[.11111,.69224,0,0,.66667],9733:[.19444,.69224,0,0,.94445],10003:[0,.69224,0,0,.83334],10016:[0,.69224,0,0,.83334],10731:[.11111,.69224,0,0,.66667],10846:[.19444,.75583,0,0,.61111],10877:[.13667,.63667,0,0,.77778],10878:[.13667,.63667,0,0,.77778],10885:[.25583,.75583,0,0,.77778],10886:[.25583,.75583,0,0,.77778],10887:[.13597,.63597,0,0,.77778],10888:[.13597,.63597,0,0,.77778],10889:[.26167,.75726,0,0,.77778],10890:[.26167,.75726,0,0,.77778],10891:[.48256,.98256,0,0,.77778],10892:[.48256,.98256,0,0,.77778],10901:[.13667,.63667,0,0,.77778],10902:[.13667,.63667,0,0,.77778],10933:[.25142,.75726,0,0,.77778],10934:[.25142,.75726,0,0,.77778],10935:[.26167,.75726,0,0,.77778],10936:[.26167,.75726,0,0,.77778],10937:[.26167,.75726,0,0,.77778],10938:[.26167,.75726,0,0,.77778],10949:[.25583,.75583,0,0,.77778],10950:[.25583,.75583,0,0,.77778],10955:[.28481,.79383,0,0,.77778],10956:[.28481,.79383,0,0,.77778],57350:[.08167,.58167,0,0,.22222],57351:[.08167,.58167,0,0,.38889],57352:[.08167,.58167,0,0,.77778],57353:[0,.43056,.04028,0,.66667],57356:[.25142,.75726,0,0,.77778],57357:[.25142,.75726,0,0,.77778],57358:[.41951,.91951,0,0,.77778],57359:[.30274,.79383,0,0,.77778],57360:[.30274,.79383,0,0,.77778],57361:[.41951,.91951,0,0,.77778],57366:[.25142,.75726,0,0,.77778],57367:[.25142,.75726,0,0,.77778],57368:[.25142,.75726,0,0,.77778],57369:[.25142,.75726,0,0,.77778],57370:[.13597,.63597,0,0,.77778],57371:[.13597,.63597,0,0,.77778]},"Caligraphic-Regular":{32:[0,0,0,0,.25],65:[0,.68333,0,.19445,.79847],66:[0,.68333,.03041,.13889,.65681],67:[0,.68333,.05834,.13889,.52653],68:[0,.68333,.02778,.08334,.77139],69:[0,.68333,.08944,.11111,.52778],70:[0,.68333,.09931,.11111,.71875],71:[.09722,.68333,.0593,.11111,.59487],72:[0,.68333,.00965,.11111,.84452],73:[0,.68333,.07382,0,.54452],74:[.09722,.68333,.18472,.16667,.67778],75:[0,.68333,.01445,.05556,.76195],76:[0,.68333,0,.13889,.68972],77:[0,.68333,0,.13889,1.2009],78:[0,.68333,.14736,.08334,.82049],79:[0,.68333,.02778,.11111,.79611],80:[0,.68333,.08222,.08334,.69556],81:[.09722,.68333,0,.11111,.81667],82:[0,.68333,0,.08334,.8475],83:[0,.68333,.075,.13889,.60556],84:[0,.68333,.25417,0,.54464],85:[0,.68333,.09931,.08334,.62583],86:[0,.68333,.08222,0,.61278],87:[0,.68333,.08222,.08334,.98778],88:[0,.68333,.14643,.13889,.7133],89:[.09722,.68333,.08222,.08334,.66834],90:[0,.68333,.07944,.13889,.72473],160:[0,0,0,0,.25]},"Fraktur-Regular":{32:[0,0,0,0,.25],33:[0,.69141,0,0,.29574],34:[0,.69141,0,0,.21471],38:[0,.69141,0,0,.73786],39:[0,.69141,0,0,.21201],40:[.24982,.74947,0,0,.38865],41:[.24982,.74947,0,0,.38865],42:[0,.62119,0,0,.27764],43:[.08319,.58283,0,0,.75623],44:[0,.10803,0,0,.27764],45:[.08319,.58283,0,0,.75623],46:[0,.10803,0,0,.27764],47:[.24982,.74947,0,0,.50181],48:[0,.47534,0,0,.50181],49:[0,.47534,0,0,.50181],50:[0,.47534,0,0,.50181],51:[.18906,.47534,0,0,.50181],52:[.18906,.47534,0,0,.50181],53:[.18906,.47534,0,0,.50181],54:[0,.69141,0,0,.50181],55:[.18906,.47534,0,0,.50181],56:[0,.69141,0,0,.50181],57:[.18906,.47534,0,0,.50181],58:[0,.47534,0,0,.21606],59:[.12604,.47534,0,0,.21606],61:[-.13099,.36866,0,0,.75623],63:[0,.69141,0,0,.36245],65:[0,.69141,0,0,.7176],66:[0,.69141,0,0,.88397],67:[0,.69141,0,0,.61254],68:[0,.69141,0,0,.83158],69:[0,.69141,0,0,.66278],70:[.12604,.69141,0,0,.61119],71:[0,.69141,0,0,.78539],72:[.06302,.69141,0,0,.7203],73:[0,.69141,0,0,.55448],74:[.12604,.69141,0,0,.55231],75:[0,.69141,0,0,.66845],76:[0,.69141,0,0,.66602],77:[0,.69141,0,0,1.04953],78:[0,.69141,0,0,.83212],79:[0,.69141,0,0,.82699],80:[.18906,.69141,0,0,.82753],81:[.03781,.69141,0,0,.82699],82:[0,.69141,0,0,.82807],83:[0,.69141,0,0,.82861],84:[0,.69141,0,0,.66899],85:[0,.69141,0,0,.64576],86:[0,.69141,0,0,.83131],87:[0,.69141,0,0,1.04602],88:[0,.69141,0,0,.71922],89:[.18906,.69141,0,0,.83293],90:[.12604,.69141,0,0,.60201],91:[.24982,.74947,0,0,.27764],93:[.24982,.74947,0,0,.27764],94:[0,.69141,0,0,.49965],97:[0,.47534,0,0,.50046],98:[0,.69141,0,0,.51315],99:[0,.47534,0,0,.38946],100:[0,.62119,0,0,.49857],101:[0,.47534,0,0,.40053],102:[.18906,.69141,0,0,.32626],103:[.18906,.47534,0,0,.5037],104:[.18906,.69141,0,0,.52126],105:[0,.69141,0,0,.27899],106:[0,.69141,0,0,.28088],107:[0,.69141,0,0,.38946],108:[0,.69141,0,0,.27953],109:[0,.47534,0,0,.76676],110:[0,.47534,0,0,.52666],111:[0,.47534,0,0,.48885],112:[.18906,.52396,0,0,.50046],113:[.18906,.47534,0,0,.48912],114:[0,.47534,0,0,.38919],115:[0,.47534,0,0,.44266],116:[0,.62119,0,0,.33301],117:[0,.47534,0,0,.5172],118:[0,.52396,0,0,.5118],119:[0,.52396,0,0,.77351],120:[.18906,.47534,0,0,.38865],121:[.18906,.47534,0,0,.49884],122:[.18906,.47534,0,0,.39054],160:[0,0,0,0,.25],8216:[0,.69141,0,0,.21471],8217:[0,.69141,0,0,.21471],58112:[0,.62119,0,0,.49749],58113:[0,.62119,0,0,.4983],58114:[.18906,.69141,0,0,.33328],58115:[.18906,.69141,0,0,.32923],58116:[.18906,.47534,0,0,.50343],58117:[0,.69141,0,0,.33301],58118:[0,.62119,0,0,.33409],58119:[0,.47534,0,0,.50073]},"Main-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.35],34:[0,.69444,0,0,.60278],35:[.19444,.69444,0,0,.95833],36:[.05556,.75,0,0,.575],37:[.05556,.75,0,0,.95833],38:[0,.69444,0,0,.89444],39:[0,.69444,0,0,.31944],40:[.25,.75,0,0,.44722],41:[.25,.75,0,0,.44722],42:[0,.75,0,0,.575],43:[.13333,.63333,0,0,.89444],44:[.19444,.15556,0,0,.31944],45:[0,.44444,0,0,.38333],46:[0,.15556,0,0,.31944],47:[.25,.75,0,0,.575],48:[0,.64444,0,0,.575],49:[0,.64444,0,0,.575],50:[0,.64444,0,0,.575],51:[0,.64444,0,0,.575],52:[0,.64444,0,0,.575],53:[0,.64444,0,0,.575],54:[0,.64444,0,0,.575],55:[0,.64444,0,0,.575],56:[0,.64444,0,0,.575],57:[0,.64444,0,0,.575],58:[0,.44444,0,0,.31944],59:[.19444,.44444,0,0,.31944],60:[.08556,.58556,0,0,.89444],61:[-.10889,.39111,0,0,.89444],62:[.08556,.58556,0,0,.89444],63:[0,.69444,0,0,.54305],64:[0,.69444,0,0,.89444],65:[0,.68611,0,0,.86944],66:[0,.68611,0,0,.81805],67:[0,.68611,0,0,.83055],68:[0,.68611,0,0,.88194],69:[0,.68611,0,0,.75555],70:[0,.68611,0,0,.72361],71:[0,.68611,0,0,.90416],72:[0,.68611,0,0,.9],73:[0,.68611,0,0,.43611],74:[0,.68611,0,0,.59444],75:[0,.68611,0,0,.90138],76:[0,.68611,0,0,.69166],77:[0,.68611,0,0,1.09166],78:[0,.68611,0,0,.9],79:[0,.68611,0,0,.86388],80:[0,.68611,0,0,.78611],81:[.19444,.68611,0,0,.86388],82:[0,.68611,0,0,.8625],83:[0,.68611,0,0,.63889],84:[0,.68611,0,0,.8],85:[0,.68611,0,0,.88472],86:[0,.68611,.01597,0,.86944],87:[0,.68611,.01597,0,1.18888],88:[0,.68611,0,0,.86944],89:[0,.68611,.02875,0,.86944],90:[0,.68611,0,0,.70277],91:[.25,.75,0,0,.31944],92:[.25,.75,0,0,.575],93:[.25,.75,0,0,.31944],94:[0,.69444,0,0,.575],95:[.31,.13444,.03194,0,.575],97:[0,.44444,0,0,.55902],98:[0,.69444,0,0,.63889],99:[0,.44444,0,0,.51111],100:[0,.69444,0,0,.63889],101:[0,.44444,0,0,.52708],102:[0,.69444,.10903,0,.35139],103:[.19444,.44444,.01597,0,.575],104:[0,.69444,0,0,.63889],105:[0,.69444,0,0,.31944],106:[.19444,.69444,0,0,.35139],107:[0,.69444,0,0,.60694],108:[0,.69444,0,0,.31944],109:[0,.44444,0,0,.95833],110:[0,.44444,0,0,.63889],111:[0,.44444,0,0,.575],112:[.19444,.44444,0,0,.63889],113:[.19444,.44444,0,0,.60694],114:[0,.44444,0,0,.47361],115:[0,.44444,0,0,.45361],116:[0,.63492,0,0,.44722],117:[0,.44444,0,0,.63889],118:[0,.44444,.01597,0,.60694],119:[0,.44444,.01597,0,.83055],120:[0,.44444,0,0,.60694],121:[.19444,.44444,.01597,0,.60694],122:[0,.44444,0,0,.51111],123:[.25,.75,0,0,.575],124:[.25,.75,0,0,.31944],125:[.25,.75,0,0,.575],126:[.35,.34444,0,0,.575],160:[0,0,0,0,.25],163:[0,.69444,0,0,.86853],168:[0,.69444,0,0,.575],172:[0,.44444,0,0,.76666],176:[0,.69444,0,0,.86944],177:[.13333,.63333,0,0,.89444],184:[.17014,0,0,0,.51111],198:[0,.68611,0,0,1.04166],215:[.13333,.63333,0,0,.89444],216:[.04861,.73472,0,0,.89444],223:[0,.69444,0,0,.59722],230:[0,.44444,0,0,.83055],247:[.13333,.63333,0,0,.89444],248:[.09722,.54167,0,0,.575],305:[0,.44444,0,0,.31944],338:[0,.68611,0,0,1.16944],339:[0,.44444,0,0,.89444],567:[.19444,.44444,0,0,.35139],710:[0,.69444,0,0,.575],711:[0,.63194,0,0,.575],713:[0,.59611,0,0,.575],714:[0,.69444,0,0,.575],715:[0,.69444,0,0,.575],728:[0,.69444,0,0,.575],729:[0,.69444,0,0,.31944],730:[0,.69444,0,0,.86944],732:[0,.69444,0,0,.575],733:[0,.69444,0,0,.575],915:[0,.68611,0,0,.69166],916:[0,.68611,0,0,.95833],920:[0,.68611,0,0,.89444],923:[0,.68611,0,0,.80555],926:[0,.68611,0,0,.76666],928:[0,.68611,0,0,.9],931:[0,.68611,0,0,.83055],933:[0,.68611,0,0,.89444],934:[0,.68611,0,0,.83055],936:[0,.68611,0,0,.89444],937:[0,.68611,0,0,.83055],8211:[0,.44444,.03194,0,.575],8212:[0,.44444,.03194,0,1.14999],8216:[0,.69444,0,0,.31944],8217:[0,.69444,0,0,.31944],8220:[0,.69444,0,0,.60278],8221:[0,.69444,0,0,.60278],8224:[.19444,.69444,0,0,.51111],8225:[.19444,.69444,0,0,.51111],8242:[0,.55556,0,0,.34444],8407:[0,.72444,.15486,0,.575],8463:[0,.69444,0,0,.66759],8465:[0,.69444,0,0,.83055],8467:[0,.69444,0,0,.47361],8472:[.19444,.44444,0,0,.74027],8476:[0,.69444,0,0,.83055],8501:[0,.69444,0,0,.70277],8592:[-.10889,.39111,0,0,1.14999],8593:[.19444,.69444,0,0,.575],8594:[-.10889,.39111,0,0,1.14999],8595:[.19444,.69444,0,0,.575],8596:[-.10889,.39111,0,0,1.14999],8597:[.25,.75,0,0,.575],8598:[.19444,.69444,0,0,1.14999],8599:[.19444,.69444,0,0,1.14999],8600:[.19444,.69444,0,0,1.14999],8601:[.19444,.69444,0,0,1.14999],8636:[-.10889,.39111,0,0,1.14999],8637:[-.10889,.39111,0,0,1.14999],8640:[-.10889,.39111,0,0,1.14999],8641:[-.10889,.39111,0,0,1.14999],8656:[-.10889,.39111,0,0,1.14999],8657:[.19444,.69444,0,0,.70277],8658:[-.10889,.39111,0,0,1.14999],8659:[.19444,.69444,0,0,.70277],8660:[-.10889,.39111,0,0,1.14999],8661:[.25,.75,0,0,.70277],8704:[0,.69444,0,0,.63889],8706:[0,.69444,.06389,0,.62847],8707:[0,.69444,0,0,.63889],8709:[.05556,.75,0,0,.575],8711:[0,.68611,0,0,.95833],8712:[.08556,.58556,0,0,.76666],8715:[.08556,.58556,0,0,.76666],8722:[.13333,.63333,0,0,.89444],8723:[.13333,.63333,0,0,.89444],8725:[.25,.75,0,0,.575],8726:[.25,.75,0,0,.575],8727:[-.02778,.47222,0,0,.575],8728:[-.02639,.47361,0,0,.575],8729:[-.02639,.47361,0,0,.575],8730:[.18,.82,0,0,.95833],8733:[0,.44444,0,0,.89444],8734:[0,.44444,0,0,1.14999],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.31944],8741:[.25,.75,0,0,.575],8743:[0,.55556,0,0,.76666],8744:[0,.55556,0,0,.76666],8745:[0,.55556,0,0,.76666],8746:[0,.55556,0,0,.76666],8747:[.19444,.69444,.12778,0,.56875],8764:[-.10889,.39111,0,0,.89444],8768:[.19444,.69444,0,0,.31944],8771:[.00222,.50222,0,0,.89444],8773:[.027,.638,0,0,.894],8776:[.02444,.52444,0,0,.89444],8781:[.00222,.50222,0,0,.89444],8801:[.00222,.50222,0,0,.89444],8804:[.19667,.69667,0,0,.89444],8805:[.19667,.69667,0,0,.89444],8810:[.08556,.58556,0,0,1.14999],8811:[.08556,.58556,0,0,1.14999],8826:[.08556,.58556,0,0,.89444],8827:[.08556,.58556,0,0,.89444],8834:[.08556,.58556,0,0,.89444],8835:[.08556,.58556,0,0,.89444],8838:[.19667,.69667,0,0,.89444],8839:[.19667,.69667,0,0,.89444],8846:[0,.55556,0,0,.76666],8849:[.19667,.69667,0,0,.89444],8850:[.19667,.69667,0,0,.89444],8851:[0,.55556,0,0,.76666],8852:[0,.55556,0,0,.76666],8853:[.13333,.63333,0,0,.89444],8854:[.13333,.63333,0,0,.89444],8855:[.13333,.63333,0,0,.89444],8856:[.13333,.63333,0,0,.89444],8857:[.13333,.63333,0,0,.89444],8866:[0,.69444,0,0,.70277],8867:[0,.69444,0,0,.70277],8868:[0,.69444,0,0,.89444],8869:[0,.69444,0,0,.89444],8900:[-.02639,.47361,0,0,.575],8901:[-.02639,.47361,0,0,.31944],8902:[-.02778,.47222,0,0,.575],8968:[.25,.75,0,0,.51111],8969:[.25,.75,0,0,.51111],8970:[.25,.75,0,0,.51111],8971:[.25,.75,0,0,.51111],8994:[-.13889,.36111,0,0,1.14999],8995:[-.13889,.36111,0,0,1.14999],9651:[.19444,.69444,0,0,1.02222],9657:[-.02778,.47222,0,0,.575],9661:[.19444,.69444,0,0,1.02222],9667:[-.02778,.47222,0,0,.575],9711:[.19444,.69444,0,0,1.14999],9824:[.12963,.69444,0,0,.89444],9825:[.12963,.69444,0,0,.89444],9826:[.12963,.69444,0,0,.89444],9827:[.12963,.69444,0,0,.89444],9837:[0,.75,0,0,.44722],9838:[.19444,.69444,0,0,.44722],9839:[.19444,.69444,0,0,.44722],10216:[.25,.75,0,0,.44722],10217:[.25,.75,0,0,.44722],10815:[0,.68611,0,0,.9],10927:[.19667,.69667,0,0,.89444],10928:[.19667,.69667,0,0,.89444],57376:[.19444,.69444,0,0,0]},"Main-BoldItalic":{32:[0,0,0,0,.25],33:[0,.69444,.11417,0,.38611],34:[0,.69444,.07939,0,.62055],35:[.19444,.69444,.06833,0,.94444],37:[.05556,.75,.12861,0,.94444],38:[0,.69444,.08528,0,.88555],39:[0,.69444,.12945,0,.35555],40:[.25,.75,.15806,0,.47333],41:[.25,.75,.03306,0,.47333],42:[0,.75,.14333,0,.59111],43:[.10333,.60333,.03306,0,.88555],44:[.19444,.14722,0,0,.35555],45:[0,.44444,.02611,0,.41444],46:[0,.14722,0,0,.35555],47:[.25,.75,.15806,0,.59111],48:[0,.64444,.13167,0,.59111],49:[0,.64444,.13167,0,.59111],50:[0,.64444,.13167,0,.59111],51:[0,.64444,.13167,0,.59111],52:[.19444,.64444,.13167,0,.59111],53:[0,.64444,.13167,0,.59111],54:[0,.64444,.13167,0,.59111],55:[.19444,.64444,.13167,0,.59111],56:[0,.64444,.13167,0,.59111],57:[0,.64444,.13167,0,.59111],58:[0,.44444,.06695,0,.35555],59:[.19444,.44444,.06695,0,.35555],61:[-.10889,.39111,.06833,0,.88555],63:[0,.69444,.11472,0,.59111],64:[0,.69444,.09208,0,.88555],65:[0,.68611,0,0,.86555],66:[0,.68611,.0992,0,.81666],67:[0,.68611,.14208,0,.82666],68:[0,.68611,.09062,0,.87555],69:[0,.68611,.11431,0,.75666],70:[0,.68611,.12903,0,.72722],71:[0,.68611,.07347,0,.89527],72:[0,.68611,.17208,0,.8961],73:[0,.68611,.15681,0,.47166],74:[0,.68611,.145,0,.61055],75:[0,.68611,.14208,0,.89499],76:[0,.68611,0,0,.69777],77:[0,.68611,.17208,0,1.07277],78:[0,.68611,.17208,0,.8961],79:[0,.68611,.09062,0,.85499],80:[0,.68611,.0992,0,.78721],81:[.19444,.68611,.09062,0,.85499],82:[0,.68611,.02559,0,.85944],83:[0,.68611,.11264,0,.64999],84:[0,.68611,.12903,0,.7961],85:[0,.68611,.17208,0,.88083],86:[0,.68611,.18625,0,.86555],87:[0,.68611,.18625,0,1.15999],88:[0,.68611,.15681,0,.86555],89:[0,.68611,.19803,0,.86555],90:[0,.68611,.14208,0,.70888],91:[.25,.75,.1875,0,.35611],93:[.25,.75,.09972,0,.35611],94:[0,.69444,.06709,0,.59111],95:[.31,.13444,.09811,0,.59111],97:[0,.44444,.09426,0,.59111],98:[0,.69444,.07861,0,.53222],99:[0,.44444,.05222,0,.53222],100:[0,.69444,.10861,0,.59111],101:[0,.44444,.085,0,.53222],102:[.19444,.69444,.21778,0,.4],103:[.19444,.44444,.105,0,.53222],104:[0,.69444,.09426,0,.59111],105:[0,.69326,.11387,0,.35555],106:[.19444,.69326,.1672,0,.35555],107:[0,.69444,.11111,0,.53222],108:[0,.69444,.10861,0,.29666],109:[0,.44444,.09426,0,.94444],110:[0,.44444,.09426,0,.64999],111:[0,.44444,.07861,0,.59111],112:[.19444,.44444,.07861,0,.59111],113:[.19444,.44444,.105,0,.53222],114:[0,.44444,.11111,0,.50167],115:[0,.44444,.08167,0,.48694],116:[0,.63492,.09639,0,.385],117:[0,.44444,.09426,0,.62055],118:[0,.44444,.11111,0,.53222],119:[0,.44444,.11111,0,.76777],120:[0,.44444,.12583,0,.56055],121:[.19444,.44444,.105,0,.56166],122:[0,.44444,.13889,0,.49055],126:[.35,.34444,.11472,0,.59111],160:[0,0,0,0,.25],168:[0,.69444,.11473,0,.59111],176:[0,.69444,0,0,.94888],184:[.17014,0,0,0,.53222],198:[0,.68611,.11431,0,1.02277],216:[.04861,.73472,.09062,0,.88555],223:[.19444,.69444,.09736,0,.665],230:[0,.44444,.085,0,.82666],248:[.09722,.54167,.09458,0,.59111],305:[0,.44444,.09426,0,.35555],338:[0,.68611,.11431,0,1.14054],339:[0,.44444,.085,0,.82666],567:[.19444,.44444,.04611,0,.385],710:[0,.69444,.06709,0,.59111],711:[0,.63194,.08271,0,.59111],713:[0,.59444,.10444,0,.59111],714:[0,.69444,.08528,0,.59111],715:[0,.69444,0,0,.59111],728:[0,.69444,.10333,0,.59111],729:[0,.69444,.12945,0,.35555],730:[0,.69444,0,0,.94888],732:[0,.69444,.11472,0,.59111],733:[0,.69444,.11472,0,.59111],915:[0,.68611,.12903,0,.69777],916:[0,.68611,0,0,.94444],920:[0,.68611,.09062,0,.88555],923:[0,.68611,0,0,.80666],926:[0,.68611,.15092,0,.76777],928:[0,.68611,.17208,0,.8961],931:[0,.68611,.11431,0,.82666],933:[0,.68611,.10778,0,.88555],934:[0,.68611,.05632,0,.82666],936:[0,.68611,.10778,0,.88555],937:[0,.68611,.0992,0,.82666],8211:[0,.44444,.09811,0,.59111],8212:[0,.44444,.09811,0,1.18221],8216:[0,.69444,.12945,0,.35555],8217:[0,.69444,.12945,0,.35555],8220:[0,.69444,.16772,0,.62055],8221:[0,.69444,.07939,0,.62055]},"Main-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.12417,0,.30667],34:[0,.69444,.06961,0,.51444],35:[.19444,.69444,.06616,0,.81777],37:[.05556,.75,.13639,0,.81777],38:[0,.69444,.09694,0,.76666],39:[0,.69444,.12417,0,.30667],40:[.25,.75,.16194,0,.40889],41:[.25,.75,.03694,0,.40889],42:[0,.75,.14917,0,.51111],43:[.05667,.56167,.03694,0,.76666],44:[.19444,.10556,0,0,.30667],45:[0,.43056,.02826,0,.35778],46:[0,.10556,0,0,.30667],47:[.25,.75,.16194,0,.51111],48:[0,.64444,.13556,0,.51111],49:[0,.64444,.13556,0,.51111],50:[0,.64444,.13556,0,.51111],51:[0,.64444,.13556,0,.51111],52:[.19444,.64444,.13556,0,.51111],53:[0,.64444,.13556,0,.51111],54:[0,.64444,.13556,0,.51111],55:[.19444,.64444,.13556,0,.51111],56:[0,.64444,.13556,0,.51111],57:[0,.64444,.13556,0,.51111],58:[0,.43056,.0582,0,.30667],59:[.19444,.43056,.0582,0,.30667],61:[-.13313,.36687,.06616,0,.76666],63:[0,.69444,.1225,0,.51111],64:[0,.69444,.09597,0,.76666],65:[0,.68333,0,0,.74333],66:[0,.68333,.10257,0,.70389],67:[0,.68333,.14528,0,.71555],68:[0,.68333,.09403,0,.755],69:[0,.68333,.12028,0,.67833],70:[0,.68333,.13305,0,.65277],71:[0,.68333,.08722,0,.77361],72:[0,.68333,.16389,0,.74333],73:[0,.68333,.15806,0,.38555],74:[0,.68333,.14028,0,.525],75:[0,.68333,.14528,0,.76888],76:[0,.68333,0,0,.62722],77:[0,.68333,.16389,0,.89666],78:[0,.68333,.16389,0,.74333],79:[0,.68333,.09403,0,.76666],80:[0,.68333,.10257,0,.67833],81:[.19444,.68333,.09403,0,.76666],82:[0,.68333,.03868,0,.72944],83:[0,.68333,.11972,0,.56222],84:[0,.68333,.13305,0,.71555],85:[0,.68333,.16389,0,.74333],86:[0,.68333,.18361,0,.74333],87:[0,.68333,.18361,0,.99888],88:[0,.68333,.15806,0,.74333],89:[0,.68333,.19383,0,.74333],90:[0,.68333,.14528,0,.61333],91:[.25,.75,.1875,0,.30667],93:[.25,.75,.10528,0,.30667],94:[0,.69444,.06646,0,.51111],95:[.31,.12056,.09208,0,.51111],97:[0,.43056,.07671,0,.51111],98:[0,.69444,.06312,0,.46],99:[0,.43056,.05653,0,.46],100:[0,.69444,.10333,0,.51111],101:[0,.43056,.07514,0,.46],102:[.19444,.69444,.21194,0,.30667],103:[.19444,.43056,.08847,0,.46],104:[0,.69444,.07671,0,.51111],105:[0,.65536,.1019,0,.30667],106:[.19444,.65536,.14467,0,.30667],107:[0,.69444,.10764,0,.46],108:[0,.69444,.10333,0,.25555],109:[0,.43056,.07671,0,.81777],110:[0,.43056,.07671,0,.56222],111:[0,.43056,.06312,0,.51111],112:[.19444,.43056,.06312,0,.51111],113:[.19444,.43056,.08847,0,.46],114:[0,.43056,.10764,0,.42166],115:[0,.43056,.08208,0,.40889],116:[0,.61508,.09486,0,.33222],117:[0,.43056,.07671,0,.53666],118:[0,.43056,.10764,0,.46],119:[0,.43056,.10764,0,.66444],120:[0,.43056,.12042,0,.46389],121:[.19444,.43056,.08847,0,.48555],122:[0,.43056,.12292,0,.40889],126:[.35,.31786,.11585,0,.51111],160:[0,0,0,0,.25],168:[0,.66786,.10474,0,.51111],176:[0,.69444,0,0,.83129],184:[.17014,0,0,0,.46],198:[0,.68333,.12028,0,.88277],216:[.04861,.73194,.09403,0,.76666],223:[.19444,.69444,.10514,0,.53666],230:[0,.43056,.07514,0,.71555],248:[.09722,.52778,.09194,0,.51111],338:[0,.68333,.12028,0,.98499],339:[0,.43056,.07514,0,.71555],710:[0,.69444,.06646,0,.51111],711:[0,.62847,.08295,0,.51111],713:[0,.56167,.10333,0,.51111],714:[0,.69444,.09694,0,.51111],715:[0,.69444,0,0,.51111],728:[0,.69444,.10806,0,.51111],729:[0,.66786,.11752,0,.30667],730:[0,.69444,0,0,.83129],732:[0,.66786,.11585,0,.51111],733:[0,.69444,.1225,0,.51111],915:[0,.68333,.13305,0,.62722],916:[0,.68333,0,0,.81777],920:[0,.68333,.09403,0,.76666],923:[0,.68333,0,0,.69222],926:[0,.68333,.15294,0,.66444],928:[0,.68333,.16389,0,.74333],931:[0,.68333,.12028,0,.71555],933:[0,.68333,.11111,0,.76666],934:[0,.68333,.05986,0,.71555],936:[0,.68333,.11111,0,.76666],937:[0,.68333,.10257,0,.71555],8211:[0,.43056,.09208,0,.51111],8212:[0,.43056,.09208,0,1.02222],8216:[0,.69444,.12417,0,.30667],8217:[0,.69444,.12417,0,.30667],8220:[0,.69444,.1685,0,.51444],8221:[0,.69444,.06961,0,.51444],8463:[0,.68889,0,0,.54028]},"Main-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.27778],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.77778],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.19444,.10556,0,0,.27778],45:[0,.43056,0,0,.33333],46:[0,.10556,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.64444,0,0,.5],49:[0,.64444,0,0,.5],50:[0,.64444,0,0,.5],51:[0,.64444,0,0,.5],52:[0,.64444,0,0,.5],53:[0,.64444,0,0,.5],54:[0,.64444,0,0,.5],55:[0,.64444,0,0,.5],56:[0,.64444,0,0,.5],57:[0,.64444,0,0,.5],58:[0,.43056,0,0,.27778],59:[.19444,.43056,0,0,.27778],60:[.0391,.5391,0,0,.77778],61:[-.13313,.36687,0,0,.77778],62:[.0391,.5391,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.77778],65:[0,.68333,0,0,.75],66:[0,.68333,0,0,.70834],67:[0,.68333,0,0,.72222],68:[0,.68333,0,0,.76389],69:[0,.68333,0,0,.68056],70:[0,.68333,0,0,.65278],71:[0,.68333,0,0,.78472],72:[0,.68333,0,0,.75],73:[0,.68333,0,0,.36111],74:[0,.68333,0,0,.51389],75:[0,.68333,0,0,.77778],76:[0,.68333,0,0,.625],77:[0,.68333,0,0,.91667],78:[0,.68333,0,0,.75],79:[0,.68333,0,0,.77778],80:[0,.68333,0,0,.68056],81:[.19444,.68333,0,0,.77778],82:[0,.68333,0,0,.73611],83:[0,.68333,0,0,.55556],84:[0,.68333,0,0,.72222],85:[0,.68333,0,0,.75],86:[0,.68333,.01389,0,.75],87:[0,.68333,.01389,0,1.02778],88:[0,.68333,0,0,.75],89:[0,.68333,.025,0,.75],90:[0,.68333,0,0,.61111],91:[.25,.75,0,0,.27778],92:[.25,.75,0,0,.5],93:[.25,.75,0,0,.27778],94:[0,.69444,0,0,.5],95:[.31,.12056,.02778,0,.5],97:[0,.43056,0,0,.5],98:[0,.69444,0,0,.55556],99:[0,.43056,0,0,.44445],100:[0,.69444,0,0,.55556],101:[0,.43056,0,0,.44445],102:[0,.69444,.07778,0,.30556],103:[.19444,.43056,.01389,0,.5],104:[0,.69444,0,0,.55556],105:[0,.66786,0,0,.27778],106:[.19444,.66786,0,0,.30556],107:[0,.69444,0,0,.52778],108:[0,.69444,0,0,.27778],109:[0,.43056,0,0,.83334],110:[0,.43056,0,0,.55556],111:[0,.43056,0,0,.5],112:[.19444,.43056,0,0,.55556],113:[.19444,.43056,0,0,.52778],114:[0,.43056,0,0,.39167],115:[0,.43056,0,0,.39445],116:[0,.61508,0,0,.38889],117:[0,.43056,0,0,.55556],118:[0,.43056,.01389,0,.52778],119:[0,.43056,.01389,0,.72222],120:[0,.43056,0,0,.52778],121:[.19444,.43056,.01389,0,.52778],122:[0,.43056,0,0,.44445],123:[.25,.75,0,0,.5],124:[.25,.75,0,0,.27778],125:[.25,.75,0,0,.5],126:[.35,.31786,0,0,.5],160:[0,0,0,0,.25],163:[0,.69444,0,0,.76909],167:[.19444,.69444,0,0,.44445],168:[0,.66786,0,0,.5],172:[0,.43056,0,0,.66667],176:[0,.69444,0,0,.75],177:[.08333,.58333,0,0,.77778],182:[.19444,.69444,0,0,.61111],184:[.17014,0,0,0,.44445],198:[0,.68333,0,0,.90278],215:[.08333,.58333,0,0,.77778],216:[.04861,.73194,0,0,.77778],223:[0,.69444,0,0,.5],230:[0,.43056,0,0,.72222],247:[.08333,.58333,0,0,.77778],248:[.09722,.52778,0,0,.5],305:[0,.43056,0,0,.27778],338:[0,.68333,0,0,1.01389],339:[0,.43056,0,0,.77778],567:[.19444,.43056,0,0,.30556],710:[0,.69444,0,0,.5],711:[0,.62847,0,0,.5],713:[0,.56778,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.66786,0,0,.27778],730:[0,.69444,0,0,.75],732:[0,.66786,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.68333,0,0,.625],916:[0,.68333,0,0,.83334],920:[0,.68333,0,0,.77778],923:[0,.68333,0,0,.69445],926:[0,.68333,0,0,.66667],928:[0,.68333,0,0,.75],931:[0,.68333,0,0,.72222],933:[0,.68333,0,0,.77778],934:[0,.68333,0,0,.72222],936:[0,.68333,0,0,.77778],937:[0,.68333,0,0,.72222],8211:[0,.43056,.02778,0,.5],8212:[0,.43056,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5],8224:[.19444,.69444,0,0,.44445],8225:[.19444,.69444,0,0,.44445],8230:[0,.123,0,0,1.172],8242:[0,.55556,0,0,.275],8407:[0,.71444,.15382,0,.5],8463:[0,.68889,0,0,.54028],8465:[0,.69444,0,0,.72222],8467:[0,.69444,0,.11111,.41667],8472:[.19444,.43056,0,.11111,.63646],8476:[0,.69444,0,0,.72222],8501:[0,.69444,0,0,.61111],8592:[-.13313,.36687,0,0,1],8593:[.19444,.69444,0,0,.5],8594:[-.13313,.36687,0,0,1],8595:[.19444,.69444,0,0,.5],8596:[-.13313,.36687,0,0,1],8597:[.25,.75,0,0,.5],8598:[.19444,.69444,0,0,1],8599:[.19444,.69444,0,0,1],8600:[.19444,.69444,0,0,1],8601:[.19444,.69444,0,0,1],8614:[.011,.511,0,0,1],8617:[.011,.511,0,0,1.126],8618:[.011,.511,0,0,1.126],8636:[-.13313,.36687,0,0,1],8637:[-.13313,.36687,0,0,1],8640:[-.13313,.36687,0,0,1],8641:[-.13313,.36687,0,0,1],8652:[.011,.671,0,0,1],8656:[-.13313,.36687,0,0,1],8657:[.19444,.69444,0,0,.61111],8658:[-.13313,.36687,0,0,1],8659:[.19444,.69444,0,0,.61111],8660:[-.13313,.36687,0,0,1],8661:[.25,.75,0,0,.61111],8704:[0,.69444,0,0,.55556],8706:[0,.69444,.05556,.08334,.5309],8707:[0,.69444,0,0,.55556],8709:[.05556,.75,0,0,.5],8711:[0,.68333,0,0,.83334],8712:[.0391,.5391,0,0,.66667],8715:[.0391,.5391,0,0,.66667],8722:[.08333,.58333,0,0,.77778],8723:[.08333,.58333,0,0,.77778],8725:[.25,.75,0,0,.5],8726:[.25,.75,0,0,.5],8727:[-.03472,.46528,0,0,.5],8728:[-.05555,.44445,0,0,.5],8729:[-.05555,.44445,0,0,.5],8730:[.2,.8,0,0,.83334],8733:[0,.43056,0,0,.77778],8734:[0,.43056,0,0,1],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.27778],8741:[.25,.75,0,0,.5],8743:[0,.55556,0,0,.66667],8744:[0,.55556,0,0,.66667],8745:[0,.55556,0,0,.66667],8746:[0,.55556,0,0,.66667],8747:[.19444,.69444,.11111,0,.41667],8764:[-.13313,.36687,0,0,.77778],8768:[.19444,.69444,0,0,.27778],8771:[-.03625,.46375,0,0,.77778],8773:[-.022,.589,0,0,.778],8776:[-.01688,.48312,0,0,.77778],8781:[-.03625,.46375,0,0,.77778],8784:[-.133,.673,0,0,.778],8801:[-.03625,.46375,0,0,.77778],8804:[.13597,.63597,0,0,.77778],8805:[.13597,.63597,0,0,.77778],8810:[.0391,.5391,0,0,1],8811:[.0391,.5391,0,0,1],8826:[.0391,.5391,0,0,.77778],8827:[.0391,.5391,0,0,.77778],8834:[.0391,.5391,0,0,.77778],8835:[.0391,.5391,0,0,.77778],8838:[.13597,.63597,0,0,.77778],8839:[.13597,.63597,0,0,.77778],8846:[0,.55556,0,0,.66667],8849:[.13597,.63597,0,0,.77778],8850:[.13597,.63597,0,0,.77778],8851:[0,.55556,0,0,.66667],8852:[0,.55556,0,0,.66667],8853:[.08333,.58333,0,0,.77778],8854:[.08333,.58333,0,0,.77778],8855:[.08333,.58333,0,0,.77778],8856:[.08333,.58333,0,0,.77778],8857:[.08333,.58333,0,0,.77778],8866:[0,.69444,0,0,.61111],8867:[0,.69444,0,0,.61111],8868:[0,.69444,0,0,.77778],8869:[0,.69444,0,0,.77778],8872:[.249,.75,0,0,.867],8900:[-.05555,.44445,0,0,.5],8901:[-.05555,.44445,0,0,.27778],8902:[-.03472,.46528,0,0,.5],8904:[.005,.505,0,0,.9],8942:[.03,.903,0,0,.278],8943:[-.19,.313,0,0,1.172],8945:[-.1,.823,0,0,1.282],8968:[.25,.75,0,0,.44445],8969:[.25,.75,0,0,.44445],8970:[.25,.75,0,0,.44445],8971:[.25,.75,0,0,.44445],8994:[-.14236,.35764,0,0,1],8995:[-.14236,.35764,0,0,1],9136:[.244,.744,0,0,.412],9137:[.244,.745,0,0,.412],9651:[.19444,.69444,0,0,.88889],9657:[-.03472,.46528,0,0,.5],9661:[.19444,.69444,0,0,.88889],9667:[-.03472,.46528,0,0,.5],9711:[.19444,.69444,0,0,1],9824:[.12963,.69444,0,0,.77778],9825:[.12963,.69444,0,0,.77778],9826:[.12963,.69444,0,0,.77778],9827:[.12963,.69444,0,0,.77778],9837:[0,.75,0,0,.38889],9838:[.19444,.69444,0,0,.38889],9839:[.19444,.69444,0,0,.38889],10216:[.25,.75,0,0,.38889],10217:[.25,.75,0,0,.38889],10222:[.244,.744,0,0,.412],10223:[.244,.745,0,0,.412],10229:[.011,.511,0,0,1.609],10230:[.011,.511,0,0,1.638],10231:[.011,.511,0,0,1.859],10232:[.024,.525,0,0,1.609],10233:[.024,.525,0,0,1.638],10234:[.024,.525,0,0,1.858],10236:[.011,.511,0,0,1.638],10815:[0,.68333,0,0,.75],10927:[.13597,.63597,0,0,.77778],10928:[.13597,.63597,0,0,.77778],57376:[.19444,.69444,0,0,0]},"Math-BoldItalic":{32:[0,0,0,0,.25],48:[0,.44444,0,0,.575],49:[0,.44444,0,0,.575],50:[0,.44444,0,0,.575],51:[.19444,.44444,0,0,.575],52:[.19444,.44444,0,0,.575],53:[.19444,.44444,0,0,.575],54:[0,.64444,0,0,.575],55:[.19444,.44444,0,0,.575],56:[0,.64444,0,0,.575],57:[.19444,.44444,0,0,.575],65:[0,.68611,0,0,.86944],66:[0,.68611,.04835,0,.8664],67:[0,.68611,.06979,0,.81694],68:[0,.68611,.03194,0,.93812],69:[0,.68611,.05451,0,.81007],70:[0,.68611,.15972,0,.68889],71:[0,.68611,0,0,.88673],72:[0,.68611,.08229,0,.98229],73:[0,.68611,.07778,0,.51111],74:[0,.68611,.10069,0,.63125],75:[0,.68611,.06979,0,.97118],76:[0,.68611,0,0,.75555],77:[0,.68611,.11424,0,1.14201],78:[0,.68611,.11424,0,.95034],79:[0,.68611,.03194,0,.83666],80:[0,.68611,.15972,0,.72309],81:[.19444,.68611,0,0,.86861],82:[0,.68611,.00421,0,.87235],83:[0,.68611,.05382,0,.69271],84:[0,.68611,.15972,0,.63663],85:[0,.68611,.11424,0,.80027],86:[0,.68611,.25555,0,.67778],87:[0,.68611,.15972,0,1.09305],88:[0,.68611,.07778,0,.94722],89:[0,.68611,.25555,0,.67458],90:[0,.68611,.06979,0,.77257],97:[0,.44444,0,0,.63287],98:[0,.69444,0,0,.52083],99:[0,.44444,0,0,.51342],100:[0,.69444,0,0,.60972],101:[0,.44444,0,0,.55361],102:[.19444,.69444,.11042,0,.56806],103:[.19444,.44444,.03704,0,.5449],104:[0,.69444,0,0,.66759],105:[0,.69326,0,0,.4048],106:[.19444,.69326,.0622,0,.47083],107:[0,.69444,.01852,0,.6037],108:[0,.69444,.0088,0,.34815],109:[0,.44444,0,0,1.0324],110:[0,.44444,0,0,.71296],111:[0,.44444,0,0,.58472],112:[.19444,.44444,0,0,.60092],113:[.19444,.44444,.03704,0,.54213],114:[0,.44444,.03194,0,.5287],115:[0,.44444,0,0,.53125],116:[0,.63492,0,0,.41528],117:[0,.44444,0,0,.68102],118:[0,.44444,.03704,0,.56666],119:[0,.44444,.02778,0,.83148],120:[0,.44444,0,0,.65903],121:[.19444,.44444,.03704,0,.59028],122:[0,.44444,.04213,0,.55509],160:[0,0,0,0,.25],915:[0,.68611,.15972,0,.65694],916:[0,.68611,0,0,.95833],920:[0,.68611,.03194,0,.86722],923:[0,.68611,0,0,.80555],926:[0,.68611,.07458,0,.84125],928:[0,.68611,.08229,0,.98229],931:[0,.68611,.05451,0,.88507],933:[0,.68611,.15972,0,.67083],934:[0,.68611,0,0,.76666],936:[0,.68611,.11653,0,.71402],937:[0,.68611,.04835,0,.8789],945:[0,.44444,0,0,.76064],946:[.19444,.69444,.03403,0,.65972],947:[.19444,.44444,.06389,0,.59003],948:[0,.69444,.03819,0,.52222],949:[0,.44444,0,0,.52882],950:[.19444,.69444,.06215,0,.50833],951:[.19444,.44444,.03704,0,.6],952:[0,.69444,.03194,0,.5618],953:[0,.44444,0,0,.41204],954:[0,.44444,0,0,.66759],955:[0,.69444,0,0,.67083],956:[.19444,.44444,0,0,.70787],957:[0,.44444,.06898,0,.57685],958:[.19444,.69444,.03021,0,.50833],959:[0,.44444,0,0,.58472],960:[0,.44444,.03704,0,.68241],961:[.19444,.44444,0,0,.6118],962:[.09722,.44444,.07917,0,.42361],963:[0,.44444,.03704,0,.68588],964:[0,.44444,.13472,0,.52083],965:[0,.44444,.03704,0,.63055],966:[.19444,.44444,0,0,.74722],967:[.19444,.44444,0,0,.71805],968:[.19444,.69444,.03704,0,.75833],969:[0,.44444,.03704,0,.71782],977:[0,.69444,0,0,.69155],981:[.19444,.69444,0,0,.7125],982:[0,.44444,.03194,0,.975],1009:[.19444,.44444,0,0,.6118],1013:[0,.44444,0,0,.48333],57649:[0,.44444,0,0,.39352],57911:[.19444,.44444,0,0,.43889]},"Math-Italic":{32:[0,0,0,0,.25],48:[0,.43056,0,0,.5],49:[0,.43056,0,0,.5],50:[0,.43056,0,0,.5],51:[.19444,.43056,0,0,.5],52:[.19444,.43056,0,0,.5],53:[.19444,.43056,0,0,.5],54:[0,.64444,0,0,.5],55:[.19444,.43056,0,0,.5],56:[0,.64444,0,0,.5],57:[.19444,.43056,0,0,.5],65:[0,.68333,0,.13889,.75],66:[0,.68333,.05017,.08334,.75851],67:[0,.68333,.07153,.08334,.71472],68:[0,.68333,.02778,.05556,.82792],69:[0,.68333,.05764,.08334,.7382],70:[0,.68333,.13889,.08334,.64306],71:[0,.68333,0,.08334,.78625],72:[0,.68333,.08125,.05556,.83125],73:[0,.68333,.07847,.11111,.43958],74:[0,.68333,.09618,.16667,.55451],75:[0,.68333,.07153,.05556,.84931],76:[0,.68333,0,.02778,.68056],77:[0,.68333,.10903,.08334,.97014],78:[0,.68333,.10903,.08334,.80347],79:[0,.68333,.02778,.08334,.76278],80:[0,.68333,.13889,.08334,.64201],81:[.19444,.68333,0,.08334,.79056],82:[0,.68333,.00773,.08334,.75929],83:[0,.68333,.05764,.08334,.6132],84:[0,.68333,.13889,.08334,.58438],85:[0,.68333,.10903,.02778,.68278],86:[0,.68333,.22222,0,.58333],87:[0,.68333,.13889,0,.94445],88:[0,.68333,.07847,.08334,.82847],89:[0,.68333,.22222,0,.58056],90:[0,.68333,.07153,.08334,.68264],97:[0,.43056,0,0,.52859],98:[0,.69444,0,0,.42917],99:[0,.43056,0,.05556,.43276],100:[0,.69444,0,.16667,.52049],101:[0,.43056,0,.05556,.46563],102:[.19444,.69444,.10764,.16667,.48959],103:[.19444,.43056,.03588,.02778,.47697],104:[0,.69444,0,0,.57616],105:[0,.65952,0,0,.34451],106:[.19444,.65952,.05724,0,.41181],107:[0,.69444,.03148,0,.5206],108:[0,.69444,.01968,.08334,.29838],109:[0,.43056,0,0,.87801],110:[0,.43056,0,0,.60023],111:[0,.43056,0,.05556,.48472],112:[.19444,.43056,0,.08334,.50313],113:[.19444,.43056,.03588,.08334,.44641],114:[0,.43056,.02778,.05556,.45116],115:[0,.43056,0,.05556,.46875],116:[0,.61508,0,.08334,.36111],117:[0,.43056,0,.02778,.57246],118:[0,.43056,.03588,.02778,.48472],119:[0,.43056,.02691,.08334,.71592],120:[0,.43056,0,.02778,.57153],121:[.19444,.43056,.03588,.05556,.49028],122:[0,.43056,.04398,.05556,.46505],160:[0,0,0,0,.25],915:[0,.68333,.13889,.08334,.61528],916:[0,.68333,0,.16667,.83334],920:[0,.68333,.02778,.08334,.76278],923:[0,.68333,0,.16667,.69445],926:[0,.68333,.07569,.08334,.74236],928:[0,.68333,.08125,.05556,.83125],931:[0,.68333,.05764,.08334,.77986],933:[0,.68333,.13889,.05556,.58333],934:[0,.68333,0,.08334,.66667],936:[0,.68333,.11,.05556,.61222],937:[0,.68333,.05017,.08334,.7724],945:[0,.43056,.0037,.02778,.6397],946:[.19444,.69444,.05278,.08334,.56563],947:[.19444,.43056,.05556,0,.51773],948:[0,.69444,.03785,.05556,.44444],949:[0,.43056,0,.08334,.46632],950:[.19444,.69444,.07378,.08334,.4375],951:[.19444,.43056,.03588,.05556,.49653],952:[0,.69444,.02778,.08334,.46944],953:[0,.43056,0,.05556,.35394],954:[0,.43056,0,0,.57616],955:[0,.69444,0,0,.58334],956:[.19444,.43056,0,.02778,.60255],957:[0,.43056,.06366,.02778,.49398],958:[.19444,.69444,.04601,.11111,.4375],959:[0,.43056,0,.05556,.48472],960:[0,.43056,.03588,0,.57003],961:[.19444,.43056,0,.08334,.51702],962:[.09722,.43056,.07986,.08334,.36285],963:[0,.43056,.03588,0,.57141],964:[0,.43056,.1132,.02778,.43715],965:[0,.43056,.03588,.02778,.54028],966:[.19444,.43056,0,.08334,.65417],967:[.19444,.43056,0,.05556,.62569],968:[.19444,.69444,.03588,.11111,.65139],969:[0,.43056,.03588,0,.62245],977:[0,.69444,0,.08334,.59144],981:[.19444,.69444,0,.08334,.59583],982:[0,.43056,.02778,0,.82813],1009:[.19444,.43056,0,.08334,.51702],1013:[0,.43056,0,.05556,.4059],57649:[0,.43056,0,.02778,.32246],57911:[.19444,.43056,0,.08334,.38403]},"SansSerif-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.36667],34:[0,.69444,0,0,.55834],35:[.19444,.69444,0,0,.91667],36:[.05556,.75,0,0,.55],37:[.05556,.75,0,0,1.02912],38:[0,.69444,0,0,.83056],39:[0,.69444,0,0,.30556],40:[.25,.75,0,0,.42778],41:[.25,.75,0,0,.42778],42:[0,.75,0,0,.55],43:[.11667,.61667,0,0,.85556],44:[.10556,.13056,0,0,.30556],45:[0,.45833,0,0,.36667],46:[0,.13056,0,0,.30556],47:[.25,.75,0,0,.55],48:[0,.69444,0,0,.55],49:[0,.69444,0,0,.55],50:[0,.69444,0,0,.55],51:[0,.69444,0,0,.55],52:[0,.69444,0,0,.55],53:[0,.69444,0,0,.55],54:[0,.69444,0,0,.55],55:[0,.69444,0,0,.55],56:[0,.69444,0,0,.55],57:[0,.69444,0,0,.55],58:[0,.45833,0,0,.30556],59:[.10556,.45833,0,0,.30556],61:[-.09375,.40625,0,0,.85556],63:[0,.69444,0,0,.51945],64:[0,.69444,0,0,.73334],65:[0,.69444,0,0,.73334],66:[0,.69444,0,0,.73334],67:[0,.69444,0,0,.70278],68:[0,.69444,0,0,.79445],69:[0,.69444,0,0,.64167],70:[0,.69444,0,0,.61111],71:[0,.69444,0,0,.73334],72:[0,.69444,0,0,.79445],73:[0,.69444,0,0,.33056],74:[0,.69444,0,0,.51945],75:[0,.69444,0,0,.76389],76:[0,.69444,0,0,.58056],77:[0,.69444,0,0,.97778],78:[0,.69444,0,0,.79445],79:[0,.69444,0,0,.79445],80:[0,.69444,0,0,.70278],81:[.10556,.69444,0,0,.79445],82:[0,.69444,0,0,.70278],83:[0,.69444,0,0,.61111],84:[0,.69444,0,0,.73334],85:[0,.69444,0,0,.76389],86:[0,.69444,.01528,0,.73334],87:[0,.69444,.01528,0,1.03889],88:[0,.69444,0,0,.73334],89:[0,.69444,.0275,0,.73334],90:[0,.69444,0,0,.67223],91:[.25,.75,0,0,.34306],93:[.25,.75,0,0,.34306],94:[0,.69444,0,0,.55],95:[.35,.10833,.03056,0,.55],97:[0,.45833,0,0,.525],98:[0,.69444,0,0,.56111],99:[0,.45833,0,0,.48889],100:[0,.69444,0,0,.56111],101:[0,.45833,0,0,.51111],102:[0,.69444,.07639,0,.33611],103:[.19444,.45833,.01528,0,.55],104:[0,.69444,0,0,.56111],105:[0,.69444,0,0,.25556],106:[.19444,.69444,0,0,.28611],107:[0,.69444,0,0,.53056],108:[0,.69444,0,0,.25556],109:[0,.45833,0,0,.86667],110:[0,.45833,0,0,.56111],111:[0,.45833,0,0,.55],112:[.19444,.45833,0,0,.56111],113:[.19444,.45833,0,0,.56111],114:[0,.45833,.01528,0,.37222],115:[0,.45833,0,0,.42167],116:[0,.58929,0,0,.40417],117:[0,.45833,0,0,.56111],118:[0,.45833,.01528,0,.5],119:[0,.45833,.01528,0,.74445],120:[0,.45833,0,0,.5],121:[.19444,.45833,.01528,0,.5],122:[0,.45833,0,0,.47639],126:[.35,.34444,0,0,.55],160:[0,0,0,0,.25],168:[0,.69444,0,0,.55],176:[0,.69444,0,0,.73334],180:[0,.69444,0,0,.55],184:[.17014,0,0,0,.48889],305:[0,.45833,0,0,.25556],567:[.19444,.45833,0,0,.28611],710:[0,.69444,0,0,.55],711:[0,.63542,0,0,.55],713:[0,.63778,0,0,.55],728:[0,.69444,0,0,.55],729:[0,.69444,0,0,.30556],730:[0,.69444,0,0,.73334],732:[0,.69444,0,0,.55],733:[0,.69444,0,0,.55],915:[0,.69444,0,0,.58056],916:[0,.69444,0,0,.91667],920:[0,.69444,0,0,.85556],923:[0,.69444,0,0,.67223],926:[0,.69444,0,0,.73334],928:[0,.69444,0,0,.79445],931:[0,.69444,0,0,.79445],933:[0,.69444,0,0,.85556],934:[0,.69444,0,0,.79445],936:[0,.69444,0,0,.85556],937:[0,.69444,0,0,.79445],8211:[0,.45833,.03056,0,.55],8212:[0,.45833,.03056,0,1.10001],8216:[0,.69444,0,0,.30556],8217:[0,.69444,0,0,.30556],8220:[0,.69444,0,0,.55834],8221:[0,.69444,0,0,.55834]},"SansSerif-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.05733,0,.31945],34:[0,.69444,.00316,0,.5],35:[.19444,.69444,.05087,0,.83334],36:[.05556,.75,.11156,0,.5],37:[.05556,.75,.03126,0,.83334],38:[0,.69444,.03058,0,.75834],39:[0,.69444,.07816,0,.27778],40:[.25,.75,.13164,0,.38889],41:[.25,.75,.02536,0,.38889],42:[0,.75,.11775,0,.5],43:[.08333,.58333,.02536,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,.01946,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,.13164,0,.5],48:[0,.65556,.11156,0,.5],49:[0,.65556,.11156,0,.5],50:[0,.65556,.11156,0,.5],51:[0,.65556,.11156,0,.5],52:[0,.65556,.11156,0,.5],53:[0,.65556,.11156,0,.5],54:[0,.65556,.11156,0,.5],55:[0,.65556,.11156,0,.5],56:[0,.65556,.11156,0,.5],57:[0,.65556,.11156,0,.5],58:[0,.44444,.02502,0,.27778],59:[.125,.44444,.02502,0,.27778],61:[-.13,.37,.05087,0,.77778],63:[0,.69444,.11809,0,.47222],64:[0,.69444,.07555,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,.08293,0,.66667],67:[0,.69444,.11983,0,.63889],68:[0,.69444,.07555,0,.72223],69:[0,.69444,.11983,0,.59722],70:[0,.69444,.13372,0,.56945],71:[0,.69444,.11983,0,.66667],72:[0,.69444,.08094,0,.70834],73:[0,.69444,.13372,0,.27778],74:[0,.69444,.08094,0,.47222],75:[0,.69444,.11983,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,.08094,0,.875],78:[0,.69444,.08094,0,.70834],79:[0,.69444,.07555,0,.73611],80:[0,.69444,.08293,0,.63889],81:[.125,.69444,.07555,0,.73611],82:[0,.69444,.08293,0,.64584],83:[0,.69444,.09205,0,.55556],84:[0,.69444,.13372,0,.68056],85:[0,.69444,.08094,0,.6875],86:[0,.69444,.1615,0,.66667],87:[0,.69444,.1615,0,.94445],88:[0,.69444,.13372,0,.66667],89:[0,.69444,.17261,0,.66667],90:[0,.69444,.11983,0,.61111],91:[.25,.75,.15942,0,.28889],93:[.25,.75,.08719,0,.28889],94:[0,.69444,.0799,0,.5],95:[.35,.09444,.08616,0,.5],97:[0,.44444,.00981,0,.48056],98:[0,.69444,.03057,0,.51667],99:[0,.44444,.08336,0,.44445],100:[0,.69444,.09483,0,.51667],101:[0,.44444,.06778,0,.44445],102:[0,.69444,.21705,0,.30556],103:[.19444,.44444,.10836,0,.5],104:[0,.69444,.01778,0,.51667],105:[0,.67937,.09718,0,.23889],106:[.19444,.67937,.09162,0,.26667],107:[0,.69444,.08336,0,.48889],108:[0,.69444,.09483,0,.23889],109:[0,.44444,.01778,0,.79445],110:[0,.44444,.01778,0,.51667],111:[0,.44444,.06613,0,.5],112:[.19444,.44444,.0389,0,.51667],113:[.19444,.44444,.04169,0,.51667],114:[0,.44444,.10836,0,.34167],115:[0,.44444,.0778,0,.38333],116:[0,.57143,.07225,0,.36111],117:[0,.44444,.04169,0,.51667],118:[0,.44444,.10836,0,.46111],119:[0,.44444,.10836,0,.68334],120:[0,.44444,.09169,0,.46111],121:[.19444,.44444,.10836,0,.46111],122:[0,.44444,.08752,0,.43472],126:[.35,.32659,.08826,0,.5],160:[0,0,0,0,.25],168:[0,.67937,.06385,0,.5],176:[0,.69444,0,0,.73752],184:[.17014,0,0,0,.44445],305:[0,.44444,.04169,0,.23889],567:[.19444,.44444,.04169,0,.26667],710:[0,.69444,.0799,0,.5],711:[0,.63194,.08432,0,.5],713:[0,.60889,.08776,0,.5],714:[0,.69444,.09205,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,.09483,0,.5],729:[0,.67937,.07774,0,.27778],730:[0,.69444,0,0,.73752],732:[0,.67659,.08826,0,.5],733:[0,.69444,.09205,0,.5],915:[0,.69444,.13372,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,.07555,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,.12816,0,.66667],928:[0,.69444,.08094,0,.70834],931:[0,.69444,.11983,0,.72222],933:[0,.69444,.09031,0,.77778],934:[0,.69444,.04603,0,.72222],936:[0,.69444,.09031,0,.77778],937:[0,.69444,.08293,0,.72222],8211:[0,.44444,.08616,0,.5],8212:[0,.44444,.08616,0,1],8216:[0,.69444,.07816,0,.27778],8217:[0,.69444,.07816,0,.27778],8220:[0,.69444,.14205,0,.5],8221:[0,.69444,.00316,0,.5]},"SansSerif-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.31945],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.75834],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,0,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.65556,0,0,.5],49:[0,.65556,0,0,.5],50:[0,.65556,0,0,.5],51:[0,.65556,0,0,.5],52:[0,.65556,0,0,.5],53:[0,.65556,0,0,.5],54:[0,.65556,0,0,.5],55:[0,.65556,0,0,.5],56:[0,.65556,0,0,.5],57:[0,.65556,0,0,.5],58:[0,.44444,0,0,.27778],59:[.125,.44444,0,0,.27778],61:[-.13,.37,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,0,0,.66667],67:[0,.69444,0,0,.63889],68:[0,.69444,0,0,.72223],69:[0,.69444,0,0,.59722],70:[0,.69444,0,0,.56945],71:[0,.69444,0,0,.66667],72:[0,.69444,0,0,.70834],73:[0,.69444,0,0,.27778],74:[0,.69444,0,0,.47222],75:[0,.69444,0,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,0,0,.875],78:[0,.69444,0,0,.70834],79:[0,.69444,0,0,.73611],80:[0,.69444,0,0,.63889],81:[.125,.69444,0,0,.73611],82:[0,.69444,0,0,.64584],83:[0,.69444,0,0,.55556],84:[0,.69444,0,0,.68056],85:[0,.69444,0,0,.6875],86:[0,.69444,.01389,0,.66667],87:[0,.69444,.01389,0,.94445],88:[0,.69444,0,0,.66667],89:[0,.69444,.025,0,.66667],90:[0,.69444,0,0,.61111],91:[.25,.75,0,0,.28889],93:[.25,.75,0,0,.28889],94:[0,.69444,0,0,.5],95:[.35,.09444,.02778,0,.5],97:[0,.44444,0,0,.48056],98:[0,.69444,0,0,.51667],99:[0,.44444,0,0,.44445],100:[0,.69444,0,0,.51667],101:[0,.44444,0,0,.44445],102:[0,.69444,.06944,0,.30556],103:[.19444,.44444,.01389,0,.5],104:[0,.69444,0,0,.51667],105:[0,.67937,0,0,.23889],106:[.19444,.67937,0,0,.26667],107:[0,.69444,0,0,.48889],108:[0,.69444,0,0,.23889],109:[0,.44444,0,0,.79445],110:[0,.44444,0,0,.51667],111:[0,.44444,0,0,.5],112:[.19444,.44444,0,0,.51667],113:[.19444,.44444,0,0,.51667],114:[0,.44444,.01389,0,.34167],115:[0,.44444,0,0,.38333],116:[0,.57143,0,0,.36111],117:[0,.44444,0,0,.51667],118:[0,.44444,.01389,0,.46111],119:[0,.44444,.01389,0,.68334],120:[0,.44444,0,0,.46111],121:[.19444,.44444,.01389,0,.46111],122:[0,.44444,0,0,.43472],126:[.35,.32659,0,0,.5],160:[0,0,0,0,.25],168:[0,.67937,0,0,.5],176:[0,.69444,0,0,.66667],184:[.17014,0,0,0,.44445],305:[0,.44444,0,0,.23889],567:[.19444,.44444,0,0,.26667],710:[0,.69444,0,0,.5],711:[0,.63194,0,0,.5],713:[0,.60889,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.67937,0,0,.27778],730:[0,.69444,0,0,.66667],732:[0,.67659,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.69444,0,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,0,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,0,0,.66667],928:[0,.69444,0,0,.70834],931:[0,.69444,0,0,.72222],933:[0,.69444,0,0,.77778],934:[0,.69444,0,0,.72222],936:[0,.69444,0,0,.77778],937:[0,.69444,0,0,.72222],8211:[0,.44444,.02778,0,.5],8212:[0,.44444,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5]},"Script-Regular":{32:[0,0,0,0,.25],65:[0,.7,.22925,0,.80253],66:[0,.7,.04087,0,.90757],67:[0,.7,.1689,0,.66619],68:[0,.7,.09371,0,.77443],69:[0,.7,.18583,0,.56162],70:[0,.7,.13634,0,.89544],71:[0,.7,.17322,0,.60961],72:[0,.7,.29694,0,.96919],73:[0,.7,.19189,0,.80907],74:[.27778,.7,.19189,0,1.05159],75:[0,.7,.31259,0,.91364],76:[0,.7,.19189,0,.87373],77:[0,.7,.15981,0,1.08031],78:[0,.7,.3525,0,.9015],79:[0,.7,.08078,0,.73787],80:[0,.7,.08078,0,1.01262],81:[0,.7,.03305,0,.88282],82:[0,.7,.06259,0,.85],83:[0,.7,.19189,0,.86767],84:[0,.7,.29087,0,.74697],85:[0,.7,.25815,0,.79996],86:[0,.7,.27523,0,.62204],87:[0,.7,.27523,0,.80532],88:[0,.7,.26006,0,.94445],89:[0,.7,.2939,0,.70961],90:[0,.7,.24037,0,.8212],160:[0,0,0,0,.25]},"Size1-Regular":{32:[0,0,0,0,.25],40:[.35001,.85,0,0,.45834],41:[.35001,.85,0,0,.45834],47:[.35001,.85,0,0,.57778],91:[.35001,.85,0,0,.41667],92:[.35001,.85,0,0,.57778],93:[.35001,.85,0,0,.41667],123:[.35001,.85,0,0,.58334],125:[.35001,.85,0,0,.58334],160:[0,0,0,0,.25],710:[0,.72222,0,0,.55556],732:[0,.72222,0,0,.55556],770:[0,.72222,0,0,.55556],771:[0,.72222,0,0,.55556],8214:[-99e-5,.601,0,0,.77778],8593:[1e-5,.6,0,0,.66667],8595:[1e-5,.6,0,0,.66667],8657:[1e-5,.6,0,0,.77778],8659:[1e-5,.6,0,0,.77778],8719:[.25001,.75,0,0,.94445],8720:[.25001,.75,0,0,.94445],8721:[.25001,.75,0,0,1.05556],8730:[.35001,.85,0,0,1],8739:[-.00599,.606,0,0,.33333],8741:[-.00599,.606,0,0,.55556],8747:[.30612,.805,.19445,0,.47222],8748:[.306,.805,.19445,0,.47222],8749:[.306,.805,.19445,0,.47222],8750:[.30612,.805,.19445,0,.47222],8896:[.25001,.75,0,0,.83334],8897:[.25001,.75,0,0,.83334],8898:[.25001,.75,0,0,.83334],8899:[.25001,.75,0,0,.83334],8968:[.35001,.85,0,0,.47222],8969:[.35001,.85,0,0,.47222],8970:[.35001,.85,0,0,.47222],8971:[.35001,.85,0,0,.47222],9168:[-99e-5,.601,0,0,.66667],10216:[.35001,.85,0,0,.47222],10217:[.35001,.85,0,0,.47222],10752:[.25001,.75,0,0,1.11111],10753:[.25001,.75,0,0,1.11111],10754:[.25001,.75,0,0,1.11111],10756:[.25001,.75,0,0,.83334],10758:[.25001,.75,0,0,.83334]},"Size2-Regular":{32:[0,0,0,0,.25],40:[.65002,1.15,0,0,.59722],41:[.65002,1.15,0,0,.59722],47:[.65002,1.15,0,0,.81111],91:[.65002,1.15,0,0,.47222],92:[.65002,1.15,0,0,.81111],93:[.65002,1.15,0,0,.47222],123:[.65002,1.15,0,0,.66667],125:[.65002,1.15,0,0,.66667],160:[0,0,0,0,.25],710:[0,.75,0,0,1],732:[0,.75,0,0,1],770:[0,.75,0,0,1],771:[0,.75,0,0,1],8719:[.55001,1.05,0,0,1.27778],8720:[.55001,1.05,0,0,1.27778],8721:[.55001,1.05,0,0,1.44445],8730:[.65002,1.15,0,0,1],8747:[.86225,1.36,.44445,0,.55556],8748:[.862,1.36,.44445,0,.55556],8749:[.862,1.36,.44445,0,.55556],8750:[.86225,1.36,.44445,0,.55556],8896:[.55001,1.05,0,0,1.11111],8897:[.55001,1.05,0,0,1.11111],8898:[.55001,1.05,0,0,1.11111],8899:[.55001,1.05,0,0,1.11111],8968:[.65002,1.15,0,0,.52778],8969:[.65002,1.15,0,0,.52778],8970:[.65002,1.15,0,0,.52778],8971:[.65002,1.15,0,0,.52778],10216:[.65002,1.15,0,0,.61111],10217:[.65002,1.15,0,0,.61111],10752:[.55001,1.05,0,0,1.51112],10753:[.55001,1.05,0,0,1.51112],10754:[.55001,1.05,0,0,1.51112],10756:[.55001,1.05,0,0,1.11111],10758:[.55001,1.05,0,0,1.11111]},"Size3-Regular":{32:[0,0,0,0,.25],40:[.95003,1.45,0,0,.73611],41:[.95003,1.45,0,0,.73611],47:[.95003,1.45,0,0,1.04445],91:[.95003,1.45,0,0,.52778],92:[.95003,1.45,0,0,1.04445],93:[.95003,1.45,0,0,.52778],123:[.95003,1.45,0,0,.75],125:[.95003,1.45,0,0,.75],160:[0,0,0,0,.25],710:[0,.75,0,0,1.44445],732:[0,.75,0,0,1.44445],770:[0,.75,0,0,1.44445],771:[0,.75,0,0,1.44445],8730:[.95003,1.45,0,0,1],8968:[.95003,1.45,0,0,.58334],8969:[.95003,1.45,0,0,.58334],8970:[.95003,1.45,0,0,.58334],8971:[.95003,1.45,0,0,.58334],10216:[.95003,1.45,0,0,.75],10217:[.95003,1.45,0,0,.75]},"Size4-Regular":{32:[0,0,0,0,.25],40:[1.25003,1.75,0,0,.79167],41:[1.25003,1.75,0,0,.79167],47:[1.25003,1.75,0,0,1.27778],91:[1.25003,1.75,0,0,.58334],92:[1.25003,1.75,0,0,1.27778],93:[1.25003,1.75,0,0,.58334],123:[1.25003,1.75,0,0,.80556],125:[1.25003,1.75,0,0,.80556],160:[0,0,0,0,.25],710:[0,.825,0,0,1.8889],732:[0,.825,0,0,1.8889],770:[0,.825,0,0,1.8889],771:[0,.825,0,0,1.8889],8730:[1.25003,1.75,0,0,1],8968:[1.25003,1.75,0,0,.63889],8969:[1.25003,1.75,0,0,.63889],8970:[1.25003,1.75,0,0,.63889],8971:[1.25003,1.75,0,0,.63889],9115:[.64502,1.155,0,0,.875],9116:[1e-5,.6,0,0,.875],9117:[.64502,1.155,0,0,.875],9118:[.64502,1.155,0,0,.875],9119:[1e-5,.6,0,0,.875],9120:[.64502,1.155,0,0,.875],9121:[.64502,1.155,0,0,.66667],9122:[-99e-5,.601,0,0,.66667],9123:[.64502,1.155,0,0,.66667],9124:[.64502,1.155,0,0,.66667],9125:[-99e-5,.601,0,0,.66667],9126:[.64502,1.155,0,0,.66667],9127:[1e-5,.9,0,0,.88889],9128:[.65002,1.15,0,0,.88889],9129:[.90001,0,0,0,.88889],9130:[0,.3,0,0,.88889],9131:[1e-5,.9,0,0,.88889],9132:[.65002,1.15,0,0,.88889],9133:[.90001,0,0,0,.88889],9143:[.88502,.915,0,0,1.05556],10216:[1.25003,1.75,0,0,.80556],10217:[1.25003,1.75,0,0,.80556],57344:[-.00499,.605,0,0,1.05556],57345:[-.00499,.605,0,0,1.05556],57680:[0,.12,0,0,.45],57681:[0,.12,0,0,.45],57682:[0,.12,0,0,.45],57683:[0,.12,0,0,.45]},"Typewriter-Regular":{32:[0,0,0,0,.525],33:[0,.61111,0,0,.525],34:[0,.61111,0,0,.525],35:[0,.61111,0,0,.525],36:[.08333,.69444,0,0,.525],37:[.08333,.69444,0,0,.525],38:[0,.61111,0,0,.525],39:[0,.61111,0,0,.525],40:[.08333,.69444,0,0,.525],41:[.08333,.69444,0,0,.525],42:[0,.52083,0,0,.525],43:[-.08056,.53055,0,0,.525],44:[.13889,.125,0,0,.525],45:[-.08056,.53055,0,0,.525],46:[0,.125,0,0,.525],47:[.08333,.69444,0,0,.525],48:[0,.61111,0,0,.525],49:[0,.61111,0,0,.525],50:[0,.61111,0,0,.525],51:[0,.61111,0,0,.525],52:[0,.61111,0,0,.525],53:[0,.61111,0,0,.525],54:[0,.61111,0,0,.525],55:[0,.61111,0,0,.525],56:[0,.61111,0,0,.525],57:[0,.61111,0,0,.525],58:[0,.43056,0,0,.525],59:[.13889,.43056,0,0,.525],60:[-.05556,.55556,0,0,.525],61:[-.19549,.41562,0,0,.525],62:[-.05556,.55556,0,0,.525],63:[0,.61111,0,0,.525],64:[0,.61111,0,0,.525],65:[0,.61111,0,0,.525],66:[0,.61111,0,0,.525],67:[0,.61111,0,0,.525],68:[0,.61111,0,0,.525],69:[0,.61111,0,0,.525],70:[0,.61111,0,0,.525],71:[0,.61111,0,0,.525],72:[0,.61111,0,0,.525],73:[0,.61111,0,0,.525],74:[0,.61111,0,0,.525],75:[0,.61111,0,0,.525],76:[0,.61111,0,0,.525],77:[0,.61111,0,0,.525],78:[0,.61111,0,0,.525],79:[0,.61111,0,0,.525],80:[0,.61111,0,0,.525],81:[.13889,.61111,0,0,.525],82:[0,.61111,0,0,.525],83:[0,.61111,0,0,.525],84:[0,.61111,0,0,.525],85:[0,.61111,0,0,.525],86:[0,.61111,0,0,.525],87:[0,.61111,0,0,.525],88:[0,.61111,0,0,.525],89:[0,.61111,0,0,.525],90:[0,.61111,0,0,.525],91:[.08333,.69444,0,0,.525],92:[.08333,.69444,0,0,.525],93:[.08333,.69444,0,0,.525],94:[0,.61111,0,0,.525],95:[.09514,0,0,0,.525],96:[0,.61111,0,0,.525],97:[0,.43056,0,0,.525],98:[0,.61111,0,0,.525],99:[0,.43056,0,0,.525],100:[0,.61111,0,0,.525],101:[0,.43056,0,0,.525],102:[0,.61111,0,0,.525],103:[.22222,.43056,0,0,.525],104:[0,.61111,0,0,.525],105:[0,.61111,0,0,.525],106:[.22222,.61111,0,0,.525],107:[0,.61111,0,0,.525],108:[0,.61111,0,0,.525],109:[0,.43056,0,0,.525],110:[0,.43056,0,0,.525],111:[0,.43056,0,0,.525],112:[.22222,.43056,0,0,.525],113:[.22222,.43056,0,0,.525],114:[0,.43056,0,0,.525],115:[0,.43056,0,0,.525],116:[0,.55358,0,0,.525],117:[0,.43056,0,0,.525],118:[0,.43056,0,0,.525],119:[0,.43056,0,0,.525],120:[0,.43056,0,0,.525],121:[.22222,.43056,0,0,.525],122:[0,.43056,0,0,.525],123:[.08333,.69444,0,0,.525],124:[.08333,.69444,0,0,.525],125:[.08333,.69444,0,0,.525],126:[0,.61111,0,0,.525],127:[0,.61111,0,0,.525],160:[0,0,0,0,.525],176:[0,.61111,0,0,.525],184:[.19445,0,0,0,.525],305:[0,.43056,0,0,.525],567:[.22222,.43056,0,0,.525],711:[0,.56597,0,0,.525],713:[0,.56555,0,0,.525],714:[0,.61111,0,0,.525],715:[0,.61111,0,0,.525],728:[0,.61111,0,0,.525],730:[0,.61111,0,0,.525],770:[0,.61111,0,0,.525],771:[0,.61111,0,0,.525],776:[0,.61111,0,0,.525],915:[0,.61111,0,0,.525],916:[0,.61111,0,0,.525],920:[0,.61111,0,0,.525],923:[0,.61111,0,0,.525],926:[0,.61111,0,0,.525],928:[0,.61111,0,0,.525],931:[0,.61111,0,0,.525],933:[0,.61111,0,0,.525],934:[0,.61111,0,0,.525],936:[0,.61111,0,0,.525],937:[0,.61111,0,0,.525],8216:[0,.61111,0,0,.525],8217:[0,.61111,0,0,.525],8242:[0,.61111,0,0,.525],9251:[.11111,.21944,0,0,.525]}},F={slant:[.25,.25,.25],space:[0,0,0],stretch:[0,0,0],shrink:[0,0,0],xHeight:[.431,.431,.431],quad:[1,1.171,1.472],extraSpace:[0,0,0],num1:[.677,.732,.925],num2:[.394,.384,.387],num3:[.444,.471,.504],denom1:[.686,.752,1.025],denom2:[.345,.344,.532],sup1:[.413,.503,.504],sup2:[.363,.431,.404],sup3:[.289,.286,.294],sub1:[.15,.143,.2],sub2:[.247,.286,.4],supDrop:[.386,.353,.494],subDrop:[.05,.071,.1],delim1:[2.39,1.7,1.98],delim2:[1.01,1.157,1.42],axisHeight:[.25,.25,.25],defaultRuleThickness:[.04,.049,.049],bigOpSpacing1:[.111,.111,.111],bigOpSpacing2:[.166,.166,.166],bigOpSpacing3:[.2,.2,.2],bigOpSpacing4:[.6,.611,.611],bigOpSpacing5:[.1,.143,.143],sqrtRuleThickness:[.04,.04,.04],ptPerEm:[10,10,10],doubleRuleSep:[.2,.2,.2],arrayRuleWidth:[.04,.04,.04],fboxsep:[.3,.3,.3],fboxrule:[.04,.04,.04]},z={\u00c5:"A",\u00d0:"D",\u00de:"o",\u00e5:"a",\u00f0:"d",\u00fe:"o",\u0410:"A",\u0411:"B",\u0412:"B",\u0413:"F",\u0414:"A",\u0415:"E",\u0416:"K",\u0417:"3",\u0418:"N",\u0419:"N",\u041a:"K",\u041b:"N",\u041c:"M",\u041d:"H",\u041e:"O",\u041f:"N",\u0420:"P",\u0421:"C",\u0422:"T",\u0423:"y",\u0424:"O",\u0425:"X",\u0426:"U",\u0427:"h",\u0428:"W",\u0429:"W",\u042a:"B",\u042b:"X",\u042c:"B",\u042d:"3",\u042e:"X",\u042f:"R",\u0430:"a",\u0431:"b",\u0432:"a",\u0433:"r",\u0434:"y",\u0435:"e",\u0436:"m",\u0437:"e",\u0438:"n",\u0439:"n",\u043a:"n",\u043b:"n",\u043c:"m",\u043d:"n",\u043e:"o",\u043f:"n",\u0440:"p",\u0441:"c",\u0442:"o",\u0443:"y",\u0444:"b",\u0445:"x",\u0446:"n",\u0447:"n",\u0448:"w",\u0449:"w",\u044a:"a",\u044b:"m",\u044c:"a",\u044d:"e",\u044e:"m",\u044f:"r"};function _(e,t,n){if(!M[t])throw new Error("Font metrics not found for font: "+t+".");var r=e.charCodeAt(0),o=M[t][r];if(!o&&e[0]in z&&(r=z[e[0]].charCodeAt(0),o=M[t][r]),o||"text"!==n||E(r)&&(o=M[t][77]),o)return{depth:o[0],height:o[1],italic:o[2],skew:o[3],width:o[4]}}var R={};var j=[[1,1,1],[2,1,1],[3,1,1],[4,2,1],[5,2,1],[6,3,1],[7,4,2],[8,6,3],[9,7,6],[10,8,7],[11,10,9]],B=[.5,.6,.7,.8,.9,1,1.2,1.44,1.728,2.074,2.488],O=function(e,t){return t.size<2?e:j[e-1][t.size-1]};class N{constructor(e){this.style=void 0,this.color=void 0,this.size=void 0,this.textSize=void 0,this.phantom=void 0,this.font=void 0,this.fontFamily=void 0,this.fontWeight=void 0,this.fontShape=void 0,this.sizeMultiplier=void 0,this.maxSize=void 0,this.minRuleThickness=void 0,this._fontMetrics=void 0,this.style=e.style,this.color=e.color,this.size=e.size||N.BASESIZE,this.textSize=e.textSize||this.size,this.phantom=!!e.phantom,this.font=e.font||"",this.fontFamily=e.fontFamily||"",this.fontWeight=e.fontWeight||"",this.fontShape=e.fontShape||"",this.sizeMultiplier=B[this.size-1],this.maxSize=e.maxSize,this.minRuleThickness=e.minRuleThickness,this._fontMetrics=void 0}extend(e){var t={style:this.style,size:this.size,textSize:this.textSize,color:this.color,phantom:this.phantom,font:this.font,fontFamily:this.fontFamily,fontWeight:this.fontWeight,fontShape:this.fontShape,maxSize:this.maxSize,minRuleThickness:this.minRuleThickness};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return new N(t)}havingStyle(e){return this.style===e?this:this.extend({style:e,size:O(this.textSize,e)})}havingCrampedStyle(){return this.havingStyle(this.style.cramp())}havingSize(e){return this.size===e&&this.textSize===e?this:this.extend({style:this.style.text(),size:e,textSize:e,sizeMultiplier:B[e-1]})}havingBaseStyle(e){e=e||this.style.text();var t=O(N.BASESIZE,e);return this.size===t&&this.textSize===N.BASESIZE&&this.style===e?this:this.extend({style:e,size:t})}havingBaseSizing(){var e;switch(this.style.id){case 4:case 5:e=3;break;case 6:case 7:e=1;break;default:e=6}return this.extend({style:this.style.text(),size:e})}withColor(e){return this.extend({color:e})}withPhantom(){return this.extend({phantom:!0})}withFont(e){return this.extend({font:e})}withTextFontFamily(e){return this.extend({fontFamily:e,font:""})}withTextFontWeight(e){return this.extend({fontWeight:e,font:""})}withTextFontShape(e){return this.extend({fontShape:e,font:""})}sizingClasses(e){return e.size!==this.size?["sizing","reset-size"+e.size,"size"+this.size]:[]}baseSizingClasses(){return this.size!==N.BASESIZE?["sizing","reset-size"+this.size,"size"+N.BASESIZE]:[]}fontMetrics(){return this._fontMetrics||(this._fontMetrics=function(e){var t;if(!R[t=e>=5?0:e>=3?1:2]){var n=R[t]={cssEmPerMu:F.quad[t]/18};for(var r in F)F.hasOwnProperty(r)&&(n[r]=F[r][t])}return R[t]}(this.size)),this._fontMetrics}getColor(){return this.phantom?"transparent":this.color}}N.BASESIZE=6;var P={pt:1,mm:7227/2540,cm:7227/254,in:72.27,bp:1.00375,pc:12,dd:1238/1157,cc:14856/1157,nd:685/642,nc:1370/107,sp:1/65536,px:1.00375},L={ex:!0,em:!0,mu:!0},D=function(e){return"string"!=typeof e&&(e=e.unit),e in P||e in L||"ex"===e},$=function(e,t){var n;if(e.unit in P)n=P[e.unit]/t.fontMetrics().ptPerEm/t.sizeMultiplier;else if("mu"===e.unit)n=t.fontMetrics().cssEmPerMu;else{var r;if(r=t.style.isTight()?t.havingStyle(t.style.text()):t,"ex"===e.unit)n=r.fontMetrics().xHeight;else{if("em"!==e.unit)throw new a("Invalid unit: '"+e.unit+"'");n=r.fontMetrics().quad}r!==t&&(n*=r.sizeMultiplier/t.sizeMultiplier)}return Math.min(e.number*n,t.maxSize)},q=function(e){return+e.toFixed(4)+"em"},U=function(e){return e.filter((e=>e)).join(" ")},V=function(e,t,n){if(this.classes=e||[],this.attributes={},this.height=0,this.depth=0,this.maxFontSize=0,this.style=n||{},t){t.style.isTight()&&this.classes.push("mtight");var r=t.getColor();r&&(this.style.color=r)}},H=function(e){var t=document.createElement(e);for(var n in t.className=U(this.classes),this.style)this.style.hasOwnProperty(n)&&(t.style[n]=this.style[n]);for(var r in this.attributes)this.attributes.hasOwnProperty(r)&&t.setAttribute(r,this.attributes[r]);for(var o=0;o<this.children.length;o++)t.appendChild(this.children[o].toNode());return t},W=/[\s"'>/=\x00-\x1f]/,G=function(e){var t="<"+e;this.classes.length&&(t+=' class="'+u.escape(U(this.classes))+'"');var n="";for(var r in this.style)this.style.hasOwnProperty(r)&&(n+=u.hyphenate(r)+":"+this.style[r]+";");for(var o in n&&(t+=' style="'+u.escape(n)+'"'),this.attributes)if(this.attributes.hasOwnProperty(o)){if(W.test(o))throw new a("Invalid attribute name '"+o+"'");t+=" "+o+'="'+u.escape(this.attributes[o])+'"'}t+=">";for(var i=0;i<this.children.length;i++)t+=this.children[i].toMarkup();return t+="</"+e+">"};class Y{constructor(e,t,n,r){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.width=void 0,this.maxFontSize=void 0,this.style=void 0,V.call(this,e,n,r),this.children=t||[]}setAttribute(e,t){this.attributes[e]=t}hasClass(e){return u.contains(this.classes,e)}toNode(){return H.call(this,"span")}toMarkup(){return G.call(this,"span")}}class X{constructor(e,t,n,r){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,V.call(this,t,r),this.children=n||[],this.setAttribute("href",e)}setAttribute(e,t){this.attributes[e]=t}hasClass(e){return u.contains(this.classes,e)}toNode(){return H.call(this,"a")}toMarkup(){return G.call(this,"a")}}class K{constructor(e,t,n){this.src=void 0,this.alt=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.alt=t,this.src=e,this.classes=["mord"],this.style=n}hasClass(e){return u.contains(this.classes,e)}toNode(){var e=document.createElement("img");for(var t in e.src=this.src,e.alt=this.alt,e.className="mord",this.style)this.style.hasOwnProperty(t)&&(e.style[t]=this.style[t]);return e}toMarkup(){var e='<img src="'+u.escape(this.src)+'" alt="'+u.escape(this.alt)+'"',t="";for(var n in this.style)this.style.hasOwnProperty(n)&&(t+=u.hyphenate(n)+":"+this.style[n]+";");return t&&(e+=' style="'+u.escape(t)+'"'),e+="'/>"}}var Q={\u00ee:"\u0131\u0302",\u00ef:"\u0131\u0308",\u00ed:"\u0131\u0301",\u00ec:"\u0131\u0300"};class J{constructor(e,t,n,r,o,a,i,s){this.text=void 0,this.height=void 0,this.depth=void 0,this.italic=void 0,this.skew=void 0,this.width=void 0,this.maxFontSize=void 0,this.classes=void 0,this.style=void 0,this.text=e,this.height=t||0,this.depth=n||0,this.italic=r||0,this.skew=o||0,this.width=a||0,this.classes=i||[],this.style=s||{},this.maxFontSize=0;var l=function(e){for(var t=0;t<k.length;t++)for(var n=k[t],r=0;r<n.blocks.length;r++){var o=n.blocks[r];if(e>=o[0]&&e<=o[1])return n.name}return null}(this.text.charCodeAt(0));l&&this.classes.push(l+"_fallback"),/[\xee\xef\xed\xec]/.test(this.text)&&(this.text=Q[this.text])}hasClass(e){return u.contains(this.classes,e)}toNode(){var e=document.createTextNode(this.text),t=null;for(var n in this.italic>0&&((t=document.createElement("span")).style.marginRight=q(this.italic)),this.classes.length>0&&((t=t||document.createElement("span")).className=U(this.classes)),this.style)this.style.hasOwnProperty(n)&&((t=t||document.createElement("span")).style[n]=this.style[n]);return t?(t.appendChild(e),t):e}toMarkup(){var e=!1,t="<span";this.classes.length&&(e=!0,t+=' class="',t+=u.escape(U(this.classes)),t+='"');var n="";for(var r in this.italic>0&&(n+="margin-right:"+this.italic+"em;"),this.style)this.style.hasOwnProperty(r)&&(n+=u.hyphenate(r)+":"+this.style[r]+";");n&&(e=!0,t+=' style="'+u.escape(n)+'"');var o=u.escape(this.text);return e?(t+=">",t+=o,t+="</span>"):o}}class Z{constructor(e,t){this.children=void 0,this.attributes=void 0,this.children=e||[],this.attributes=t||{}}toNode(){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&e.setAttribute(t,this.attributes[t]);for(var n=0;n<this.children.length;n++)e.appendChild(this.children[n].toNode());return e}toMarkup(){var e='<svg xmlns="http://www.w3.org/2000/svg"';for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&(e+=" "+t+'="'+u.escape(this.attributes[t])+'"');e+=">";for(var n=0;n<this.children.length;n++)e+=this.children[n].toMarkup();return e+="</svg>"}}class ee{constructor(e,t){this.pathName=void 0,this.alternate=void 0,this.pathName=e,this.alternate=t}toNode(){var e=document.createElementNS("http://www.w3.org/2000/svg","path");return this.alternate?e.setAttribute("d",this.alternate):e.setAttribute("d",I[this.pathName]),e}toMarkup(){return this.alternate?'<path d="'+u.escape(this.alternate)+'"/>':'<path d="'+u.escape(I[this.pathName])+'"/>'}}class te{constructor(e){this.attributes=void 0,this.attributes=e||{}}toNode(){var e=document.createElementNS("http://www.w3.org/2000/svg","line");for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&e.setAttribute(t,this.attributes[t]);return e}toMarkup(){var e="<line";for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&(e+=" "+t+'="'+u.escape(this.attributes[t])+'"');return e+="/>"}}function ne(e){if(e instanceof J)return e;throw new Error("Expected symbolNode but got "+String(e)+".")}var re={bin:1,close:1,inner:1,open:1,punct:1,rel:1},oe={"accent-token":1,mathord:1,"op-token":1,spacing:1,textord:1},ae={math:{},text:{}};function ie(e,t,n,r,o,a){ae[e][o]={font:t,group:n,replace:r},a&&r&&(ae[e][r]=ae[e][o])}var se="math",le="text",ce="main",ue="ams",de="accent-token",pe="bin",he="close",fe="inner",ge="mathord",me="op-token",ye="open",ve="punct",be="rel",xe="spacing",we="textord";ie(se,ce,be,"\u2261","\\equiv",!0),ie(se,ce,be,"\u227a","\\prec",!0),ie(se,ce,be,"\u227b","\\succ",!0),ie(se,ce,be,"\u223c","\\sim",!0),ie(se,ce,be,"\u22a5","\\perp"),ie(se,ce,be,"\u2aaf","\\preceq",!0),ie(se,ce,be,"\u2ab0","\\succeq",!0),ie(se,ce,be,"\u2243","\\simeq",!0),ie(se,ce,be,"\u2223","\\mid",!0),ie(se,ce,be,"\u226a","\\ll",!0),ie(se,ce,be,"\u226b","\\gg",!0),ie(se,ce,be,"\u224d","\\asymp",!0),ie(se,ce,be,"\u2225","\\parallel"),ie(se,ce,be,"\u22c8","\\bowtie",!0),ie(se,ce,be,"\u2323","\\smile",!0),ie(se,ce,be,"\u2291","\\sqsubseteq",!0),ie(se,ce,be,"\u2292","\\sqsupseteq",!0),ie(se,ce,be,"\u2250","\\doteq",!0),ie(se,ce,be,"\u2322","\\frown",!0),ie(se,ce,be,"\u220b","\\ni",!0),ie(se,ce,be,"\u221d","\\propto",!0),ie(se,ce,be,"\u22a2","\\vdash",!0),ie(se,ce,be,"\u22a3","\\dashv",!0),ie(se,ce,be,"\u220b","\\owns"),ie(se,ce,ve,".","\\ldotp"),ie(se,ce,ve,"\u22c5","\\cdotp"),ie(se,ce,we,"#","\\#"),ie(le,ce,we,"#","\\#"),ie(se,ce,we,"&","\\&"),ie(le,ce,we,"&","\\&"),ie(se,ce,we,"\u2135","\\aleph",!0),ie(se,ce,we,"\u2200","\\forall",!0),ie(se,ce,we,"\u210f","\\hbar",!0),ie(se,ce,we,"\u2203","\\exists",!0),ie(se,ce,we,"\u2207","\\nabla",!0),ie(se,ce,we,"\u266d","\\flat",!0),ie(se,ce,we,"\u2113","\\ell",!0),ie(se,ce,we,"\u266e","\\natural",!0),ie(se,ce,we,"\u2663","\\clubsuit",!0),ie(se,ce,we,"\u2118","\\wp",!0),ie(se,ce,we,"\u266f","\\sharp",!0),ie(se,ce,we,"\u2662","\\diamondsuit",!0),ie(se,ce,we,"\u211c","\\Re",!0),ie(se,ce,we,"\u2661","\\heartsuit",!0),ie(se,ce,we,"\u2111","\\Im",!0),ie(se,ce,we,"\u2660","\\spadesuit",!0),ie(se,ce,we,"\xa7","\\S",!0),ie(le,ce,we,"\xa7","\\S"),ie(se,ce,we,"\xb6","\\P",!0),ie(le,ce,we,"\xb6","\\P"),ie(se,ce,we,"\u2020","\\dag"),ie(le,ce,we,"\u2020","\\dag"),ie(le,ce,we,"\u2020","\\textdagger"),ie(se,ce,we,"\u2021","\\ddag"),ie(le,ce,we,"\u2021","\\ddag"),ie(le,ce,we,"\u2021","\\textdaggerdbl"),ie(se,ce,he,"\u23b1","\\rmoustache",!0),ie(se,ce,ye,"\u23b0","\\lmoustache",!0),ie(se,ce,he,"\u27ef","\\rgroup",!0),ie(se,ce,ye,"\u27ee","\\lgroup",!0),ie(se,ce,pe,"\u2213","\\mp",!0),ie(se,ce,pe,"\u2296","\\ominus",!0),ie(se,ce,pe,"\u228e","\\uplus",!0),ie(se,ce,pe,"\u2293","\\sqcap",!0),ie(se,ce,pe,"\u2217","\\ast"),ie(se,ce,pe,"\u2294","\\sqcup",!0),ie(se,ce,pe,"\u25ef","\\bigcirc",!0),ie(se,ce,pe,"\u2219","\\bullet",!0),ie(se,ce,pe,"\u2021","\\ddagger"),ie(se,ce,pe,"\u2240","\\wr",!0),ie(se,ce,pe,"\u2a3f","\\amalg"),ie(se,ce,pe,"&","\\And"),ie(se,ce,be,"\u27f5","\\longleftarrow",!0),ie(se,ce,be,"\u21d0","\\Leftarrow",!0),ie(se,ce,be,"\u27f8","\\Longleftarrow",!0),ie(se,ce,be,"\u27f6","\\longrightarrow",!0),ie(se,ce,be,"\u21d2","\\Rightarrow",!0),ie(se,ce,be,"\u27f9","\\Longrightarrow",!0),ie(se,ce,be,"\u2194","\\leftrightarrow",!0),ie(se,ce,be,"\u27f7","\\longleftrightarrow",!0),ie(se,ce,be,"\u21d4","\\Leftrightarrow",!0),ie(se,ce,be,"\u27fa","\\Longleftrightarrow",!0),ie(se,ce,be,"\u21a6","\\mapsto",!0),ie(se,ce,be,"\u27fc","\\longmapsto",!0),ie(se,ce,be,"\u2197","\\nearrow",!0),ie(se,ce,be,"\u21a9","\\hookleftarrow",!0),ie(se,ce,be,"\u21aa","\\hookrightarrow",!0),ie(se,ce,be,"\u2198","\\searrow",!0),ie(se,ce,be,"\u21bc","\\leftharpoonup",!0),ie(se,ce,be,"\u21c0","\\rightharpoonup",!0),ie(se,ce,be,"\u2199","\\swarrow",!0),ie(se,ce,be,"\u21bd","\\leftharpoondown",!0),ie(se,ce,be,"\u21c1","\\rightharpoondown",!0),ie(se,ce,be,"\u2196","\\nwarrow",!0),ie(se,ce,be,"\u21cc","\\rightleftharpoons",!0),ie(se,ue,be,"\u226e","\\nless",!0),ie(se,ue,be,"\ue010","\\@nleqslant"),ie(se,ue,be,"\ue011","\\@nleqq"),ie(se,ue,be,"\u2a87","\\lneq",!0),ie(se,ue,be,"\u2268","\\lneqq",!0),ie(se,ue,be,"\ue00c","\\@lvertneqq"),ie(se,ue,be,"\u22e6","\\lnsim",!0),ie(se,ue,be,"\u2a89","\\lnapprox",!0),ie(se,ue,be,"\u2280","\\nprec",!0),ie(se,ue,be,"\u22e0","\\npreceq",!0),ie(se,ue,be,"\u22e8","\\precnsim",!0),ie(se,ue,be,"\u2ab9","\\precnapprox",!0),ie(se,ue,be,"\u2241","\\nsim",!0),ie(se,ue,be,"\ue006","\\@nshortmid"),ie(se,ue,be,"\u2224","\\nmid",!0),ie(se,ue,be,"\u22ac","\\nvdash",!0),ie(se,ue,be,"\u22ad","\\nvDash",!0),ie(se,ue,be,"\u22ea","\\ntriangleleft"),ie(se,ue,be,"\u22ec","\\ntrianglelefteq",!0),ie(se,ue,be,"\u228a","\\subsetneq",!0),ie(se,ue,be,"\ue01a","\\@varsubsetneq"),ie(se,ue,be,"\u2acb","\\subsetneqq",!0),ie(se,ue,be,"\ue017","\\@varsubsetneqq"),ie(se,ue,be,"\u226f","\\ngtr",!0),ie(se,ue,be,"\ue00f","\\@ngeqslant"),ie(se,ue,be,"\ue00e","\\@ngeqq"),ie(se,ue,be,"\u2a88","\\gneq",!0),ie(se,ue,be,"\u2269","\\gneqq",!0),ie(se,ue,be,"\ue00d","\\@gvertneqq"),ie(se,ue,be,"\u22e7","\\gnsim",!0),ie(se,ue,be,"\u2a8a","\\gnapprox",!0),ie(se,ue,be,"\u2281","\\nsucc",!0),ie(se,ue,be,"\u22e1","\\nsucceq",!0),ie(se,ue,be,"\u22e9","\\succnsim",!0),ie(se,ue,be,"\u2aba","\\succnapprox",!0),ie(se,ue,be,"\u2246","\\ncong",!0),ie(se,ue,be,"\ue007","\\@nshortparallel"),ie(se,ue,be,"\u2226","\\nparallel",!0),ie(se,ue,be,"\u22af","\\nVDash",!0),ie(se,ue,be,"\u22eb","\\ntriangleright"),ie(se,ue,be,"\u22ed","\\ntrianglerighteq",!0),ie(se,ue,be,"\ue018","\\@nsupseteqq"),ie(se,ue,be,"\u228b","\\supsetneq",!0),ie(se,ue,be,"\ue01b","\\@varsupsetneq"),ie(se,ue,be,"\u2acc","\\supsetneqq",!0),ie(se,ue,be,"\ue019","\\@varsupsetneqq"),ie(se,ue,be,"\u22ae","\\nVdash",!0),ie(se,ue,be,"\u2ab5","\\precneqq",!0),ie(se,ue,be,"\u2ab6","\\succneqq",!0),ie(se,ue,be,"\ue016","\\@nsubseteqq"),ie(se,ue,pe,"\u22b4","\\unlhd"),ie(se,ue,pe,"\u22b5","\\unrhd"),ie(se,ue,be,"\u219a","\\nleftarrow",!0),ie(se,ue,be,"\u219b","\\nrightarrow",!0),ie(se,ue,be,"\u21cd","\\nLeftarrow",!0),ie(se,ue,be,"\u21cf","\\nRightarrow",!0),ie(se,ue,be,"\u21ae","\\nleftrightarrow",!0),ie(se,ue,be,"\u21ce","\\nLeftrightarrow",!0),ie(se,ue,be,"\u25b3","\\vartriangle"),ie(se,ue,we,"\u210f","\\hslash"),ie(se,ue,we,"\u25bd","\\triangledown"),ie(se,ue,we,"\u25ca","\\lozenge"),ie(se,ue,we,"\u24c8","\\circledS"),ie(se,ue,we,"\xae","\\circledR"),ie(le,ue,we,"\xae","\\circledR"),ie(se,ue,we,"\u2221","\\measuredangle",!0),ie(se,ue,we,"\u2204","\\nexists"),ie(se,ue,we,"\u2127","\\mho"),ie(se,ue,we,"\u2132","\\Finv",!0),ie(se,ue,we,"\u2141","\\Game",!0),ie(se,ue,we,"\u2035","\\backprime"),ie(se,ue,we,"\u25b2","\\blacktriangle"),ie(se,ue,we,"\u25bc","\\blacktriangledown"),ie(se,ue,we,"\u25a0","\\blacksquare"),ie(se,ue,we,"\u29eb","\\blacklozenge"),ie(se,ue,we,"\u2605","\\bigstar"),ie(se,ue,we,"\u2222","\\sphericalangle",!0),ie(se,ue,we,"\u2201","\\complement",!0),ie(se,ue,we,"\xf0","\\eth",!0),ie(le,ce,we,"\xf0","\xf0"),ie(se,ue,we,"\u2571","\\diagup"),ie(se,ue,we,"\u2572","\\diagdown"),ie(se,ue,we,"\u25a1","\\square"),ie(se,ue,we,"\u25a1","\\Box"),ie(se,ue,we,"\u25ca","\\Diamond"),ie(se,ue,we,"\xa5","\\yen",!0),ie(le,ue,we,"\xa5","\\yen",!0),ie(se,ue,we,"\u2713","\\checkmark",!0),ie(le,ue,we,"\u2713","\\checkmark"),ie(se,ue,we,"\u2136","\\beth",!0),ie(se,ue,we,"\u2138","\\daleth",!0),ie(se,ue,we,"\u2137","\\gimel",!0),ie(se,ue,we,"\u03dd","\\digamma",!0),ie(se,ue,we,"\u03f0","\\varkappa"),ie(se,ue,ye,"\u250c","\\@ulcorner",!0),ie(se,ue,he,"\u2510","\\@urcorner",!0),ie(se,ue,ye,"\u2514","\\@llcorner",!0),ie(se,ue,he,"\u2518","\\@lrcorner",!0),ie(se,ue,be,"\u2266","\\leqq",!0),ie(se,ue,be,"\u2a7d","\\leqslant",!0),ie(se,ue,be,"\u2a95","\\eqslantless",!0),ie(se,ue,be,"\u2272","\\lesssim",!0),ie(se,ue,be,"\u2a85","\\lessapprox",!0),ie(se,ue,be,"\u224a","\\approxeq",!0),ie(se,ue,pe,"\u22d6","\\lessdot"),ie(se,ue,be,"\u22d8","\\lll",!0),ie(se,ue,be,"\u2276","\\lessgtr",!0),ie(se,ue,be,"\u22da","\\lesseqgtr",!0),ie(se,ue,be,"\u2a8b","\\lesseqqgtr",!0),ie(se,ue,be,"\u2251","\\doteqdot"),ie(se,ue,be,"\u2253","\\risingdotseq",!0),ie(se,ue,be,"\u2252","\\fallingdotseq",!0),ie(se,ue,be,"\u223d","\\backsim",!0),ie(se,ue,be,"\u22cd","\\backsimeq",!0),ie(se,ue,be,"\u2ac5","\\subseteqq",!0),ie(se,ue,be,"\u22d0","\\Subset",!0),ie(se,ue,be,"\u228f","\\sqsubset",!0),ie(se,ue,be,"\u227c","\\preccurlyeq",!0),ie(se,ue,be,"\u22de","\\curlyeqprec",!0),ie(se,ue,be,"\u227e","\\precsim",!0),ie(se,ue,be,"\u2ab7","\\precapprox",!0),ie(se,ue,be,"\u22b2","\\vartriangleleft"),ie(se,ue,be,"\u22b4","\\trianglelefteq"),ie(se,ue,be,"\u22a8","\\vDash",!0),ie(se,ue,be,"\u22aa","\\Vvdash",!0),ie(se,ue,be,"\u2323","\\smallsmile"),ie(se,ue,be,"\u2322","\\smallfrown"),ie(se,ue,be,"\u224f","\\bumpeq",!0),ie(se,ue,be,"\u224e","\\Bumpeq",!0),ie(se,ue,be,"\u2267","\\geqq",!0),ie(se,ue,be,"\u2a7e","\\geqslant",!0),ie(se,ue,be,"\u2a96","\\eqslantgtr",!0),ie(se,ue,be,"\u2273","\\gtrsim",!0),ie(se,ue,be,"\u2a86","\\gtrapprox",!0),ie(se,ue,pe,"\u22d7","\\gtrdot"),ie(se,ue,be,"\u22d9","\\ggg",!0),ie(se,ue,be,"\u2277","\\gtrless",!0),ie(se,ue,be,"\u22db","\\gtreqless",!0),ie(se,ue,be,"\u2a8c","\\gtreqqless",!0),ie(se,ue,be,"\u2256","\\eqcirc",!0),ie(se,ue,be,"\u2257","\\circeq",!0),ie(se,ue,be,"\u225c","\\triangleq",!0),ie(se,ue,be,"\u223c","\\thicksim"),ie(se,ue,be,"\u2248","\\thickapprox"),ie(se,ue,be,"\u2ac6","\\supseteqq",!0),ie(se,ue,be,"\u22d1","\\Supset",!0),ie(se,ue,be,"\u2290","\\sqsupset",!0),ie(se,ue,be,"\u227d","\\succcurlyeq",!0),ie(se,ue,be,"\u22df","\\curlyeqsucc",!0),ie(se,ue,be,"\u227f","\\succsim",!0),ie(se,ue,be,"\u2ab8","\\succapprox",!0),ie(se,ue,be,"\u22b3","\\vartriangleright"),ie(se,ue,be,"\u22b5","\\trianglerighteq"),ie(se,ue,be,"\u22a9","\\Vdash",!0),ie(se,ue,be,"\u2223","\\shortmid"),ie(se,ue,be,"\u2225","\\shortparallel"),ie(se,ue,be,"\u226c","\\between",!0),ie(se,ue,be,"\u22d4","\\pitchfork",!0),ie(se,ue,be,"\u221d","\\varpropto"),ie(se,ue,be,"\u25c0","\\blacktriangleleft"),ie(se,ue,be,"\u2234","\\therefore",!0),ie(se,ue,be,"\u220d","\\backepsilon"),ie(se,ue,be,"\u25b6","\\blacktriangleright"),ie(se,ue,be,"\u2235","\\because",!0),ie(se,ue,be,"\u22d8","\\llless"),ie(se,ue,be,"\u22d9","\\gggtr"),ie(se,ue,pe,"\u22b2","\\lhd"),ie(se,ue,pe,"\u22b3","\\rhd"),ie(se,ue,be,"\u2242","\\eqsim",!0),ie(se,ce,be,"\u22c8","\\Join"),ie(se,ue,be,"\u2251","\\Doteq",!0),ie(se,ue,pe,"\u2214","\\dotplus",!0),ie(se,ue,pe,"\u2216","\\smallsetminus"),ie(se,ue,pe,"\u22d2","\\Cap",!0),ie(se,ue,pe,"\u22d3","\\Cup",!0),ie(se,ue,pe,"\u2a5e","\\doublebarwedge",!0),ie(se,ue,pe,"\u229f","\\boxminus",!0),ie(se,ue,pe,"\u229e","\\boxplus",!0),ie(se,ue,pe,"\u22c7","\\divideontimes",!0),ie(se,ue,pe,"\u22c9","\\ltimes",!0),ie(se,ue,pe,"\u22ca","\\rtimes",!0),ie(se,ue,pe,"\u22cb","\\leftthreetimes",!0),ie(se,ue,pe,"\u22cc","\\rightthreetimes",!0),ie(se,ue,pe,"\u22cf","\\curlywedge",!0),ie(se,ue,pe,"\u22ce","\\curlyvee",!0),ie(se,ue,pe,"\u229d","\\circleddash",!0),ie(se,ue,pe,"\u229b","\\circledast",!0),ie(se,ue,pe,"\u22c5","\\centerdot"),ie(se,ue,pe,"\u22ba","\\intercal",!0),ie(se,ue,pe,"\u22d2","\\doublecap"),ie(se,ue,pe,"\u22d3","\\doublecup"),ie(se,ue,pe,"\u22a0","\\boxtimes",!0),ie(se,ue,be,"\u21e2","\\dashrightarrow",!0),ie(se,ue,be,"\u21e0","\\dashleftarrow",!0),ie(se,ue,be,"\u21c7","\\leftleftarrows",!0),ie(se,ue,be,"\u21c6","\\leftrightarrows",!0),ie(se,ue,be,"\u21da","\\Lleftarrow",!0),ie(se,ue,be,"\u219e","\\twoheadleftarrow",!0),ie(se,ue,be,"\u21a2","\\leftarrowtail",!0),ie(se,ue,be,"\u21ab","\\looparrowleft",!0),ie(se,ue,be,"\u21cb","\\leftrightharpoons",!0),ie(se,ue,be,"\u21b6","\\curvearrowleft",!0),ie(se,ue,be,"\u21ba","\\circlearrowleft",!0),ie(se,ue,be,"\u21b0","\\Lsh",!0),ie(se,ue,be,"\u21c8","\\upuparrows",!0),ie(se,ue,be,"\u21bf","\\upharpoonleft",!0),ie(se,ue,be,"\u21c3","\\downharpoonleft",!0),ie(se,ce,be,"\u22b6","\\origof",!0),ie(se,ce,be,"\u22b7","\\imageof",!0),ie(se,ue,be,"\u22b8","\\multimap",!0),ie(se,ue,be,"\u21ad","\\leftrightsquigarrow",!0),ie(se,ue,be,"\u21c9","\\rightrightarrows",!0),ie(se,ue,be,"\u21c4","\\rightleftarrows",!0),ie(se,ue,be,"\u21a0","\\twoheadrightarrow",!0),ie(se,ue,be,"\u21a3","\\rightarrowtail",!0),ie(se,ue,be,"\u21ac","\\looparrowright",!0),ie(se,ue,be,"\u21b7","\\curvearrowright",!0),ie(se,ue,be,"\u21bb","\\circlearrowright",!0),ie(se,ue,be,"\u21b1","\\Rsh",!0),ie(se,ue,be,"\u21ca","\\downdownarrows",!0),ie(se,ue,be,"\u21be","\\upharpoonright",!0),ie(se,ue,be,"\u21c2","\\downharpoonright",!0),ie(se,ue,be,"\u21dd","\\rightsquigarrow",!0),ie(se,ue,be,"\u21dd","\\leadsto"),ie(se,ue,be,"\u21db","\\Rrightarrow",!0),ie(se,ue,be,"\u21be","\\restriction"),ie(se,ce,we,"\u2018","`"),ie(se,ce,we,"$","\\$"),ie(le,ce,we,"$","\\$"),ie(le,ce,we,"$","\\textdollar"),ie(se,ce,we,"%","\\%"),ie(le,ce,we,"%","\\%"),ie(se,ce,we,"_","\\_"),ie(le,ce,we,"_","\\_"),ie(le,ce,we,"_","\\textunderscore"),ie(se,ce,we,"\u2220","\\angle",!0),ie(se,ce,we,"\u221e","\\infty",!0),ie(se,ce,we,"\u2032","\\prime"),ie(se,ce,we,"\u25b3","\\triangle"),ie(se,ce,we,"\u0393","\\Gamma",!0),ie(se,ce,we,"\u0394","\\Delta",!0),ie(se,ce,we,"\u0398","\\Theta",!0),ie(se,ce,we,"\u039b","\\Lambda",!0),ie(se,ce,we,"\u039e","\\Xi",!0),ie(se,ce,we,"\u03a0","\\Pi",!0),ie(se,ce,we,"\u03a3","\\Sigma",!0),ie(se,ce,we,"\u03a5","\\Upsilon",!0),ie(se,ce,we,"\u03a6","\\Phi",!0),ie(se,ce,we,"\u03a8","\\Psi",!0),ie(se,ce,we,"\u03a9","\\Omega",!0),ie(se,ce,we,"A","\u0391"),ie(se,ce,we,"B","\u0392"),ie(se,ce,we,"E","\u0395"),ie(se,ce,we,"Z","\u0396"),ie(se,ce,we,"H","\u0397"),ie(se,ce,we,"I","\u0399"),ie(se,ce,we,"K","\u039a"),ie(se,ce,we,"M","\u039c"),ie(se,ce,we,"N","\u039d"),ie(se,ce,we,"O","\u039f"),ie(se,ce,we,"P","\u03a1"),ie(se,ce,we,"T","\u03a4"),ie(se,ce,we,"X","\u03a7"),ie(se,ce,we,"\xac","\\neg",!0),ie(se,ce,we,"\xac","\\lnot"),ie(se,ce,we,"\u22a4","\\top"),ie(se,ce,we,"\u22a5","\\bot"),ie(se,ce,we,"\u2205","\\emptyset"),ie(se,ue,we,"\u2205","\\varnothing"),ie(se,ce,ge,"\u03b1","\\alpha",!0),ie(se,ce,ge,"\u03b2","\\beta",!0),ie(se,ce,ge,"\u03b3","\\gamma",!0),ie(se,ce,ge,"\u03b4","\\delta",!0),ie(se,ce,ge,"\u03f5","\\epsilon",!0),ie(se,ce,ge,"\u03b6","\\zeta",!0),ie(se,ce,ge,"\u03b7","\\eta",!0),ie(se,ce,ge,"\u03b8","\\theta",!0),ie(se,ce,ge,"\u03b9","\\iota",!0),ie(se,ce,ge,"\u03ba","\\kappa",!0),ie(se,ce,ge,"\u03bb","\\lambda",!0),ie(se,ce,ge,"\u03bc","\\mu",!0),ie(se,ce,ge,"\u03bd","\\nu",!0),ie(se,ce,ge,"\u03be","\\xi",!0),ie(se,ce,ge,"\u03bf","\\omicron",!0),ie(se,ce,ge,"\u03c0","\\pi",!0),ie(se,ce,ge,"\u03c1","\\rho",!0),ie(se,ce,ge,"\u03c3","\\sigma",!0),ie(se,ce,ge,"\u03c4","\\tau",!0),ie(se,ce,ge,"\u03c5","\\upsilon",!0),ie(se,ce,ge,"\u03d5","\\phi",!0),ie(se,ce,ge,"\u03c7","\\chi",!0),ie(se,ce,ge,"\u03c8","\\psi",!0),ie(se,ce,ge,"\u03c9","\\omega",!0),ie(se,ce,ge,"\u03b5","\\varepsilon",!0),ie(se,ce,ge,"\u03d1","\\vartheta",!0),ie(se,ce,ge,"\u03d6","\\varpi",!0),ie(se,ce,ge,"\u03f1","\\varrho",!0),ie(se,ce,ge,"\u03c2","\\varsigma",!0),ie(se,ce,ge,"\u03c6","\\varphi",!0),ie(se,ce,pe,"\u2217","*",!0),ie(se,ce,pe,"+","+"),ie(se,ce,pe,"\u2212","-",!0),ie(se,ce,pe,"\u22c5","\\cdot",!0),ie(se,ce,pe,"\u2218","\\circ",!0),ie(se,ce,pe,"\xf7","\\div",!0),ie(se,ce,pe,"\xb1","\\pm",!0),ie(se,ce,pe,"\xd7","\\times",!0),ie(se,ce,pe,"\u2229","\\cap",!0),ie(se,ce,pe,"\u222a","\\cup",!0),ie(se,ce,pe,"\u2216","\\setminus",!0),ie(se,ce,pe,"\u2227","\\land"),ie(se,ce,pe,"\u2228","\\lor"),ie(se,ce,pe,"\u2227","\\wedge",!0),ie(se,ce,pe,"\u2228","\\vee",!0),ie(se,ce,we,"\u221a","\\surd"),ie(se,ce,ye,"\u27e8","\\langle",!0),ie(se,ce,ye,"\u2223","\\lvert"),ie(se,ce,ye,"\u2225","\\lVert"),ie(se,ce,he,"?","?"),ie(se,ce,he,"!","!"),ie(se,ce,he,"\u27e9","\\rangle",!0),ie(se,ce,he,"\u2223","\\rvert"),ie(se,ce,he,"\u2225","\\rVert"),ie(se,ce,be,"=","="),ie(se,ce,be,":",":"),ie(se,ce,be,"\u2248","\\approx",!0),ie(se,ce,be,"\u2245","\\cong",!0),ie(se,ce,be,"\u2265","\\ge"),ie(se,ce,be,"\u2265","\\geq",!0),ie(se,ce,be,"\u2190","\\gets"),ie(se,ce,be,">","\\gt",!0),ie(se,ce,be,"\u2208","\\in",!0),ie(se,ce,be,"\ue020","\\@not"),ie(se,ce,be,"\u2282","\\subset",!0),ie(se,ce,be,"\u2283","\\supset",!0),ie(se,ce,be,"\u2286","\\subseteq",!0),ie(se,ce,be,"\u2287","\\supseteq",!0),ie(se,ue,be,"\u2288","\\nsubseteq",!0),ie(se,ue,be,"\u2289","\\nsupseteq",!0),ie(se,ce,be,"\u22a8","\\models"),ie(se,ce,be,"\u2190","\\leftarrow",!0),ie(se,ce,be,"\u2264","\\le"),ie(se,ce,be,"\u2264","\\leq",!0),ie(se,ce,be,"<","\\lt",!0),ie(se,ce,be,"\u2192","\\rightarrow",!0),ie(se,ce,be,"\u2192","\\to"),ie(se,ue,be,"\u2271","\\ngeq",!0),ie(se,ue,be,"\u2270","\\nleq",!0),ie(se,ce,xe,"\xa0","\\ "),ie(se,ce,xe,"\xa0","\\space"),ie(se,ce,xe,"\xa0","\\nobreakspace"),ie(le,ce,xe,"\xa0","\\ "),ie(le,ce,xe,"\xa0"," "),ie(le,ce,xe,"\xa0","\\space"),ie(le,ce,xe,"\xa0","\\nobreakspace"),ie(se,ce,xe,null,"\\nobreak"),ie(se,ce,xe,null,"\\allowbreak"),ie(se,ce,ve,",",","),ie(se,ce,ve,";",";"),ie(se,ue,pe,"\u22bc","\\barwedge",!0),ie(se,ue,pe,"\u22bb","\\veebar",!0),ie(se,ce,pe,"\u2299","\\odot",!0),ie(se,ce,pe,"\u2295","\\oplus",!0),ie(se,ce,pe,"\u2297","\\otimes",!0),ie(se,ce,we,"\u2202","\\partial",!0),ie(se,ce,pe,"\u2298","\\oslash",!0),ie(se,ue,pe,"\u229a","\\circledcirc",!0),ie(se,ue,pe,"\u22a1","\\boxdot",!0),ie(se,ce,pe,"\u25b3","\\bigtriangleup"),ie(se,ce,pe,"\u25bd","\\bigtriangledown"),ie(se,ce,pe,"\u2020","\\dagger"),ie(se,ce,pe,"\u22c4","\\diamond"),ie(se,ce,pe,"\u22c6","\\star"),ie(se,ce,pe,"\u25c3","\\triangleleft"),ie(se,ce,pe,"\u25b9","\\triangleright"),ie(se,ce,ye,"{","\\{"),ie(le,ce,we,"{","\\{"),ie(le,ce,we,"{","\\textbraceleft"),ie(se,ce,he,"}","\\}"),ie(le,ce,we,"}","\\}"),ie(le,ce,we,"}","\\textbraceright"),ie(se,ce,ye,"{","\\lbrace"),ie(se,ce,he,"}","\\rbrace"),ie(se,ce,ye,"[","\\lbrack",!0),ie(le,ce,we,"[","\\lbrack",!0),ie(se,ce,he,"]","\\rbrack",!0),ie(le,ce,we,"]","\\rbrack",!0),ie(se,ce,ye,"(","\\lparen",!0),ie(se,ce,he,")","\\rparen",!0),ie(le,ce,we,"<","\\textless",!0),ie(le,ce,we,">","\\textgreater",!0),ie(se,ce,ye,"\u230a","\\lfloor",!0),ie(se,ce,he,"\u230b","\\rfloor",!0),ie(se,ce,ye,"\u2308","\\lceil",!0),ie(se,ce,he,"\u2309","\\rceil",!0),ie(se,ce,we,"\\","\\backslash"),ie(se,ce,we,"\u2223","|"),ie(se,ce,we,"\u2223","\\vert"),ie(le,ce,we,"|","\\textbar",!0),ie(se,ce,we,"\u2225","\\|"),ie(se,ce,we,"\u2225","\\Vert"),ie(le,ce,we,"\u2225","\\textbardbl"),ie(le,ce,we,"~","\\textasciitilde"),ie(le,ce,we,"\\","\\textbackslash"),ie(le,ce,we,"^","\\textasciicircum"),ie(se,ce,be,"\u2191","\\uparrow",!0),ie(se,ce,be,"\u21d1","\\Uparrow",!0),ie(se,ce,be,"\u2193","\\downarrow",!0),ie(se,ce,be,"\u21d3","\\Downarrow",!0),ie(se,ce,be,"\u2195","\\updownarrow",!0),ie(se,ce,be,"\u21d5","\\Updownarrow",!0),ie(se,ce,me,"\u2210","\\coprod"),ie(se,ce,me,"\u22c1","\\bigvee"),ie(se,ce,me,"\u22c0","\\bigwedge"),ie(se,ce,me,"\u2a04","\\biguplus"),ie(se,ce,me,"\u22c2","\\bigcap"),ie(se,ce,me,"\u22c3","\\bigcup"),ie(se,ce,me,"\u222b","\\int"),ie(se,ce,me,"\u222b","\\intop"),ie(se,ce,me,"\u222c","\\iint"),ie(se,ce,me,"\u222d","\\iiint"),ie(se,ce,me,"\u220f","\\prod"),ie(se,ce,me,"\u2211","\\sum"),ie(se,ce,me,"\u2a02","\\bigotimes"),ie(se,ce,me,"\u2a01","\\bigoplus"),ie(se,ce,me,"\u2a00","\\bigodot"),ie(se,ce,me,"\u222e","\\oint"),ie(se,ce,me,"\u222f","\\oiint"),ie(se,ce,me,"\u2230","\\oiiint"),ie(se,ce,me,"\u2a06","\\bigsqcup"),ie(se,ce,me,"\u222b","\\smallint"),ie(le,ce,fe,"\u2026","\\textellipsis"),ie(se,ce,fe,"\u2026","\\mathellipsis"),ie(le,ce,fe,"\u2026","\\ldots",!0),ie(se,ce,fe,"\u2026","\\ldots",!0),ie(se,ce,fe,"\u22ef","\\@cdots",!0),ie(se,ce,fe,"\u22f1","\\ddots",!0),ie(se,ce,we,"\u22ee","\\varvdots"),ie(le,ce,we,"\u22ee","\\varvdots"),ie(se,ce,de,"\u02ca","\\acute"),ie(se,ce,de,"\u02cb","\\grave"),ie(se,ce,de,"\xa8","\\ddot"),ie(se,ce,de,"~","\\tilde"),ie(se,ce,de,"\u02c9","\\bar"),ie(se,ce,de,"\u02d8","\\breve"),ie(se,ce,de,"\u02c7","\\check"),ie(se,ce,de,"^","\\hat"),ie(se,ce,de,"\u20d7","\\vec"),ie(se,ce,de,"\u02d9","\\dot"),ie(se,ce,de,"\u02da","\\mathring"),ie(se,ce,ge,"\ue131","\\@imath"),ie(se,ce,ge,"\ue237","\\@jmath"),ie(se,ce,we,"\u0131","\u0131"),ie(se,ce,we,"\u0237","\u0237"),ie(le,ce,we,"\u0131","\\i",!0),ie(le,ce,we,"\u0237","\\j",!0),ie(le,ce,we,"\xdf","\\ss",!0),ie(le,ce,we,"\xe6","\\ae",!0),ie(le,ce,we,"\u0153","\\oe",!0),ie(le,ce,we,"\xf8","\\o",!0),ie(le,ce,we,"\xc6","\\AE",!0),ie(le,ce,we,"\u0152","\\OE",!0),ie(le,ce,we,"\xd8","\\O",!0),ie(le,ce,de,"\u02ca","\\'"),ie(le,ce,de,"\u02cb","\\`"),ie(le,ce,de,"\u02c6","\\^"),ie(le,ce,de,"\u02dc","\\~"),ie(le,ce,de,"\u02c9","\\="),ie(le,ce,de,"\u02d8","\\u"),ie(le,ce,de,"\u02d9","\\."),ie(le,ce,de,"\xb8","\\c"),ie(le,ce,de,"\u02da","\\r"),ie(le,ce,de,"\u02c7","\\v"),ie(le,ce,de,"\xa8",'\\"'),ie(le,ce,de,"\u02dd","\\H"),ie(le,ce,de,"\u25ef","\\textcircled");var Se={"--":!0,"---":!0,"``":!0,"''":!0};ie(le,ce,we,"\u2013","--",!0),ie(le,ce,we,"\u2013","\\textendash"),ie(le,ce,we,"\u2014","---",!0),ie(le,ce,we,"\u2014","\\textemdash"),ie(le,ce,we,"\u2018","`",!0),ie(le,ce,we,"\u2018","\\textquoteleft"),ie(le,ce,we,"\u2019","'",!0),ie(le,ce,we,"\u2019","\\textquoteright"),ie(le,ce,we,"\u201c","``",!0),ie(le,ce,we,"\u201c","\\textquotedblleft"),ie(le,ce,we,"\u201d","''",!0),ie(le,ce,we,"\u201d","\\textquotedblright"),ie(se,ce,we,"\xb0","\\degree",!0),ie(le,ce,we,"\xb0","\\degree"),ie(le,ce,we,"\xb0","\\textdegree",!0),ie(se,ce,we,"\xa3","\\pounds"),ie(se,ce,we,"\xa3","\\mathsterling",!0),ie(le,ce,we,"\xa3","\\pounds"),ie(le,ce,we,"\xa3","\\textsterling",!0),ie(se,ue,we,"\u2720","\\maltese"),ie(le,ue,we,"\u2720","\\maltese");for(var ke='0123456789/@."',Ce=0;Ce<14;Ce++){var Ee=ke.charAt(Ce);ie(se,ce,we,Ee,Ee)}for(var Ae='0123456789!@*()-=+";:?/.,',Ie=0;Ie<25;Ie++){var Te=Ae.charAt(Ie);ie(le,ce,we,Te,Te)}for(var Me="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",Fe=0;Fe<52;Fe++){var ze=Me.charAt(Fe);ie(se,ce,ge,ze,ze),ie(le,ce,we,ze,ze)}ie(se,ue,we,"C","\u2102"),ie(le,ue,we,"C","\u2102"),ie(se,ue,we,"H","\u210d"),ie(le,ue,we,"H","\u210d"),ie(se,ue,we,"N","\u2115"),ie(le,ue,we,"N","\u2115"),ie(se,ue,we,"P","\u2119"),ie(le,ue,we,"P","\u2119"),ie(se,ue,we,"Q","\u211a"),ie(le,ue,we,"Q","\u211a"),ie(se,ue,we,"R","\u211d"),ie(le,ue,we,"R","\u211d"),ie(se,ue,we,"Z","\u2124"),ie(le,ue,we,"Z","\u2124"),ie(se,ce,ge,"h","\u210e"),ie(le,ce,ge,"h","\u210e");for(var _e="",Re=0;Re<52;Re++){var je=Me.charAt(Re);ie(se,ce,ge,je,_e=String.fromCharCode(55349,56320+Re)),ie(le,ce,we,je,_e),ie(se,ce,ge,je,_e=String.fromCharCode(55349,56372+Re)),ie(le,ce,we,je,_e),ie(se,ce,ge,je,_e=String.fromCharCode(55349,56424+Re)),ie(le,ce,we,je,_e),ie(se,ce,ge,je,_e=String.fromCharCode(55349,56580+Re)),ie(le,ce,we,je,_e),ie(se,ce,ge,je,_e=String.fromCharCode(55349,56684+Re)),ie(le,ce,we,je,_e),ie(se,ce,ge,je,_e=String.fromCharCode(55349,56736+Re)),ie(le,ce,we,je,_e),ie(se,ce,ge,je,_e=String.fromCharCode(55349,56788+Re)),ie(le,ce,we,je,_e),ie(se,ce,ge,je,_e=String.fromCharCode(55349,56840+Re)),ie(le,ce,we,je,_e),ie(se,ce,ge,je,_e=String.fromCharCode(55349,56944+Re)),ie(le,ce,we,je,_e),Re<26&&(ie(se,ce,ge,je,_e=String.fromCharCode(55349,56632+Re)),ie(le,ce,we,je,_e),ie(se,ce,ge,je,_e=String.fromCharCode(55349,56476+Re)),ie(le,ce,we,je,_e))}ie(se,ce,ge,"k",_e=String.fromCharCode(55349,56668)),ie(le,ce,we,"k",_e);for(var Be=0;Be<10;Be++){var Oe=Be.toString();ie(se,ce,ge,Oe,_e=String.fromCharCode(55349,57294+Be)),ie(le,ce,we,Oe,_e),ie(se,ce,ge,Oe,_e=String.fromCharCode(55349,57314+Be)),ie(le,ce,we,Oe,_e),ie(se,ce,ge,Oe,_e=String.fromCharCode(55349,57324+Be)),ie(le,ce,we,Oe,_e),ie(se,ce,ge,Oe,_e=String.fromCharCode(55349,57334+Be)),ie(le,ce,we,Oe,_e)}for(var Ne="\xd0\xde\xfe",Pe=0;Pe<3;Pe++){var Le=Ne.charAt(Pe);ie(se,ce,ge,Le,Le),ie(le,ce,we,Le,Le)}var De=[["mathbf","textbf","Main-Bold"],["mathbf","textbf","Main-Bold"],["mathnormal","textit","Math-Italic"],["mathnormal","textit","Math-Italic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["mathscr","textscr","Script-Regular"],["","",""],["","",""],["","",""],["mathfrak","textfrak","Fraktur-Regular"],["mathfrak","textfrak","Fraktur-Regular"],["mathbb","textbb","AMS-Regular"],["mathbb","textbb","AMS-Regular"],["mathboldfrak","textboldfrak","Fraktur-Regular"],["mathboldfrak","textboldfrak","Fraktur-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathitsf","textitsf","SansSerif-Italic"],["mathitsf","textitsf","SansSerif-Italic"],["","",""],["","",""],["mathtt","texttt","Typewriter-Regular"],["mathtt","texttt","Typewriter-Regular"]],$e=[["mathbf","textbf","Main-Bold"],["","",""],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathtt","texttt","Typewriter-Regular"]],qe=function(e,t,n){return ae[n][e]&&ae[n][e].replace&&(e=ae[n][e].replace),{value:e,metrics:_(e,t,n)}},Ue=function(e,t,n,r,o){var a,i=qe(e,t,n),s=i.metrics;if(e=i.value,s){var l=s.italic;("text"===n||r&&"mathit"===r.font)&&(l=0),a=new J(e,s.height,s.depth,l,s.skew,s.width,o)}else"undefined"!=typeof console&&console.warn("No character metrics for '"+e+"' in style '"+t+"' and mode '"+n+"'"),a=new J(e,0,0,0,0,0,o);if(r){a.maxFontSize=r.sizeMultiplier,r.style.isTight()&&a.classes.push("mtight");var c=r.getColor();c&&(a.style.color=c)}return a},Ve=(e,t)=>{if(U(e.classes)!==U(t.classes)||e.skew!==t.skew||e.maxFontSize!==t.maxFontSize)return!1;if(1===e.classes.length){var n=e.classes[0];if("mbin"===n||"mord"===n)return!1}for(var r in e.style)if(e.style.hasOwnProperty(r)&&e.style[r]!==t.style[r])return!1;for(var o in t.style)if(t.style.hasOwnProperty(o)&&e.style[o]!==t.style[o])return!1;return!0},He=function(e){for(var t=0,n=0,r=0,o=0;o<e.children.length;o++){var a=e.children[o];a.height>t&&(t=a.height),a.depth>n&&(n=a.depth),a.maxFontSize>r&&(r=a.maxFontSize)}e.height=t,e.depth=n,e.maxFontSize=r},We=function(e,t,n,r){var o=new Y(e,t,n,r);return He(o),o},Ge=(e,t,n,r)=>new Y(e,t,n,r),Ye=function(e){var t=new T(e);return He(t),t},Xe=function(e,t,n){var r="";switch(e){case"amsrm":r="AMS";break;case"textrm":r="Main";break;case"textsf":r="SansSerif";break;case"texttt":r="Typewriter";break;default:r=e}return r+"-"+("textbf"===t&&"textit"===n?"BoldItalic":"textbf"===t?"Bold":"textit"===t?"Italic":"Regular")},Ke={mathbf:{variant:"bold",fontName:"Main-Bold"},mathrm:{variant:"normal",fontName:"Main-Regular"},textit:{variant:"italic",fontName:"Main-Italic"},mathit:{variant:"italic",fontName:"Main-Italic"},mathnormal:{variant:"italic",fontName:"Math-Italic"},mathsfit:{variant:"sans-serif-italic",fontName:"SansSerif-Italic"},mathbb:{variant:"double-struck",fontName:"AMS-Regular"},mathcal:{variant:"script",fontName:"Caligraphic-Regular"},mathfrak:{variant:"fraktur",fontName:"Fraktur-Regular"},mathscr:{variant:"script",fontName:"Script-Regular"},mathsf:{variant:"sans-serif",fontName:"SansSerif-Regular"},mathtt:{variant:"monospace",fontName:"Typewriter-Regular"}},Qe={vec:["vec",.471,.714],oiintSize1:["oiintSize1",.957,.499],oiintSize2:["oiintSize2",1.472,.659],oiiintSize1:["oiiintSize1",1.304,.499],oiiintSize2:["oiiintSize2",1.98,.659]},Je={fontMap:Ke,makeSymbol:Ue,mathsym:function(e,t,n,r){return void 0===r&&(r=[]),"boldsymbol"===n.font&&qe(e,"Main-Bold",t).metrics?Ue(e,"Main-Bold",t,n,r.concat(["mathbf"])):"\\"===e||"main"===ae[t][e].font?Ue(e,"Main-Regular",t,n,r):Ue(e,"AMS-Regular",t,n,r.concat(["amsrm"]))},makeSpan:We,makeSvgSpan:Ge,makeLineSpan:function(e,t,n){var r=We([e],[],t);return r.height=Math.max(n||t.fontMetrics().defaultRuleThickness,t.minRuleThickness),r.style.borderBottomWidth=q(r.height),r.maxFontSize=1,r},makeAnchor:function(e,t,n,r){var o=new X(e,t,n,r);return He(o),o},makeFragment:Ye,wrapFragment:function(e,t){return e instanceof T?We([],[e],t):e},makeVList:function(e,t){for(var{children:n,depth:r}=function(e){if("individualShift"===e.positionType){for(var t=e.children,n=[t[0]],r=-t[0].shift-t[0].elem.depth,o=r,a=1;a<t.length;a++){var i=-t[a].shift-o-t[a].elem.depth,s=i-(t[a-1].elem.height+t[a-1].elem.depth);o+=i,n.push({type:"kern",size:s}),n.push(t[a])}return{children:n,depth:r}}var l;if("top"===e.positionType){for(var c=e.positionData,u=0;u<e.children.length;u++){var d=e.children[u];c-="kern"===d.type?d.size:d.elem.height+d.elem.depth}l=c}else if("bottom"===e.positionType)l=-e.positionData;else{var p=e.children[0];if("elem"!==p.type)throw new Error('First child must have type "elem".');if("shift"===e.positionType)l=-p.elem.depth-e.positionData;else{if("firstBaseline"!==e.positionType)throw new Error("Invalid positionType "+e.positionType+".");l=-p.elem.depth}}return{children:e.children,depth:l}}(e),o=0,a=0;a<n.length;a++){var i=n[a];if("elem"===i.type){var s=i.elem;o=Math.max(o,s.maxFontSize,s.height)}}o+=2;var l=We(["pstrut"],[]);l.style.height=q(o);for(var c=[],u=r,d=r,p=r,h=0;h<n.length;h++){var f=n[h];if("kern"===f.type)p+=f.size;else{var g=f.elem,m=f.wrapperClasses||[],y=f.wrapperStyle||{},v=We(m,[l,g],void 0,y);v.style.top=q(-o-p-g.depth),f.marginLeft&&(v.style.marginLeft=f.marginLeft),f.marginRight&&(v.style.marginRight=f.marginRight),c.push(v),p+=g.height+g.depth}u=Math.min(u,p),d=Math.max(d,p)}var b,x=We(["vlist"],c);if(x.style.height=q(d),u<0){var w=We([],[]),S=We(["vlist"],[w]);S.style.height=q(-u);var k=We(["vlist-s"],[new J("\u200b")]);b=[We(["vlist-r"],[x,k]),We(["vlist-r"],[S])]}else b=[We(["vlist-r"],[x])];var C=We(["vlist-t"],b);return 2===b.length&&C.classes.push("vlist-t2"),C.height=d,C.depth=-u,C},makeOrd:function(e,t,n){var r=e.mode,o=e.text,i=["mord"],s="math"===r||"text"===r&&t.font,l=s?t.font:t.fontFamily,c="",u="";if(55349===o.charCodeAt(0)&&([c,u]=function(e,t){var n=1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536,r="math"===t?0:1;if(119808<=n&&n<120484){var o=Math.floor((n-119808)/26);return[De[o][2],De[o][r]]}if(120782<=n&&n<=120831){var i=Math.floor((n-120782)/10);return[$e[i][2],$e[i][r]]}if(120485===n||120486===n)return[De[0][2],De[0][r]];if(120486<n&&n<120782)return["",""];throw new a("Unsupported character: "+e)}(o,r)),c.length>0)return Ue(o,c,r,t,i.concat(u));if(l){var d,p;if("boldsymbol"===l){var h=function(e,t,n,r,o){return"textord"!==o&&qe(e,"Math-BoldItalic",t).metrics?{fontName:"Math-BoldItalic",fontClass:"boldsymbol"}:{fontName:"Main-Bold",fontClass:"mathbf"}}(o,r,0,0,n);d=h.fontName,p=[h.fontClass]}else s?(d=Ke[l].fontName,p=[l]):(d=Xe(l,t.fontWeight,t.fontShape),p=[l,t.fontWeight,t.fontShape]);if(qe(o,d,r).metrics)return Ue(o,d,r,t,i.concat(p));if(Se.hasOwnProperty(o)&&"Typewriter"===d.slice(0,10)){for(var f=[],g=0;g<o.length;g++)f.push(Ue(o[g],d,r,t,i.concat(p)));return Ye(f)}}if("mathord"===n)return Ue(o,"Math-Italic",r,t,i.concat(["mathnormal"]));if("textord"===n){var m=ae[r][o]&&ae[r][o].font;if("ams"===m){var y=Xe("amsrm",t.fontWeight,t.fontShape);return Ue(o,y,r,t,i.concat("amsrm",t.fontWeight,t.fontShape))}if("main"!==m&&m){var v=Xe(m,t.fontWeight,t.fontShape);return Ue(o,v,r,t,i.concat(v,t.fontWeight,t.fontShape))}var b=Xe("textrm",t.fontWeight,t.fontShape);return Ue(o,b,r,t,i.concat(t.fontWeight,t.fontShape))}throw new Error("unexpected type: "+n+" in makeOrd")},makeGlue:(e,t)=>{var n=We(["mspace"],[],t),r=$(e,t);return n.style.marginRight=q(r),n},staticSvg:function(e,t){var[n,r,o]=Qe[e],a=new ee(n),i=new Z([a],{width:q(r),height:q(o),style:"width:"+q(r),viewBox:"0 0 "+1e3*r+" "+1e3*o,preserveAspectRatio:"xMinYMin"}),s=Ge(["overlay"],[i],t);return s.height=o,s.style.height=q(o),s.style.width=q(r),s},svgData:Qe,tryCombineChars:e=>{for(var t=0;t<e.length-1;t++){var n=e[t],r=e[t+1];n instanceof J&&r instanceof J&&Ve(n,r)&&(n.text+=r.text,n.height=Math.max(n.height,r.height),n.depth=Math.max(n.depth,r.depth),n.italic=r.italic,e.splice(t+1,1),t--)}return e}},Ze={number:3,unit:"mu"},et={number:4,unit:"mu"},tt={number:5,unit:"mu"},nt={mord:{mop:Ze,mbin:et,mrel:tt,minner:Ze},mop:{mord:Ze,mop:Ze,mrel:tt,minner:Ze},mbin:{mord:et,mop:et,mopen:et,minner:et},mrel:{mord:tt,mop:tt,mopen:tt,minner:tt},mopen:{},mclose:{mop:Ze,mbin:et,mrel:tt,minner:Ze},mpunct:{mord:Ze,mop:Ze,mrel:tt,mopen:Ze,mclose:Ze,mpunct:Ze,minner:Ze},minner:{mord:Ze,mop:Ze,mbin:et,mrel:tt,mopen:Ze,mpunct:Ze,minner:Ze}},rt={mord:{mop:Ze},mop:{mord:Ze,mop:Ze},mbin:{},mrel:{},mopen:{},mclose:{mop:Ze},mpunct:{},minner:{mop:Ze}},ot={},at={},it={};function st(e){for(var{type:t,names:n,props:r,handler:o,htmlBuilder:a,mathmlBuilder:i}=e,s={type:t,numArgs:r.numArgs,argTypes:r.argTypes,allowedInArgument:!!r.allowedInArgument,allowedInText:!!r.allowedInText,allowedInMath:void 0===r.allowedInMath||r.allowedInMath,numOptionalArgs:r.numOptionalArgs||0,infix:!!r.infix,primitive:!!r.primitive,handler:o},l=0;l<n.length;++l)ot[n[l]]=s;t&&(a&&(at[t]=a),i&&(it[t]=i))}function lt(e){var{type:t,htmlBuilder:n,mathmlBuilder:r}=e;st({type:t,names:[],props:{numArgs:0},handler(){throw new Error("Should never be called.")},htmlBuilder:n,mathmlBuilder:r})}var ct=function(e){return"ordgroup"===e.type&&1===e.body.length?e.body[0]:e},ut=function(e){return"ordgroup"===e.type?e.body:[e]},dt=Je.makeSpan,pt=["leftmost","mbin","mopen","mrel","mop","mpunct"],ht=["rightmost","mrel","mclose","mpunct"],ft={display:S.DISPLAY,text:S.TEXT,script:S.SCRIPT,scriptscript:S.SCRIPTSCRIPT},gt={mord:"mord",mop:"mop",mbin:"mbin",mrel:"mrel",mopen:"mopen",mclose:"mclose",mpunct:"mpunct",minner:"minner"},mt=function(e,t,n,r){void 0===r&&(r=[null,null]);for(var o=[],a=0;a<e.length;a++){var i=St(e[a],t);if(i instanceof T){var s=i.children;o.push(...s)}else o.push(i)}if(Je.tryCombineChars(o),!n)return o;var l=t;if(1===e.length){var c=e[0];"sizing"===c.type?l=t.havingSize(c.size):"styling"===c.type&&(l=t.havingStyle(ft[c.style]))}var d=dt([r[0]||"leftmost"],[],t),p=dt([r[1]||"rightmost"],[],t),h="root"===n;return yt(o,((e,t)=>{var n=t.classes[0],r=e.classes[0];"mbin"===n&&u.contains(ht,r)?t.classes[0]="mord":"mbin"===r&&u.contains(pt,n)&&(e.classes[0]="mord")}),{node:d},p,h),yt(o,((e,t)=>{var n=xt(t),r=xt(e),o=n&&r?e.hasClass("mtight")?rt[n][r]:nt[n][r]:null;if(o)return Je.makeGlue(o,l)}),{node:d},p,h),o},yt=function e(t,n,r,o,a){o&&t.push(o);for(var i=0;i<t.length;i++){var s=t[i],l=vt(s);if(l)e(l.children,n,r,null,a);else{var c=!s.hasClass("mspace");if(c){var u=n(s,r.node);u&&(r.insertAfter?r.insertAfter(u):(t.unshift(u),i++))}c?r.node=s:a&&s.hasClass("newline")&&(r.node=dt(["leftmost"])),r.insertAfter=(e=>n=>{t.splice(e+1,0,n),i++})(i)}}o&&t.pop()},vt=function(e){return e instanceof T||e instanceof X||e instanceof Y&&e.hasClass("enclosing")?e:null},bt=function e(t,n){var r=vt(t);if(r){var o=r.children;if(o.length){if("right"===n)return e(o[o.length-1],"right");if("left"===n)return e(o[0],"left")}}return t},xt=function(e,t){return e?(t&&(e=bt(e,t)),gt[e.classes[0]]||null):null},wt=function(e,t){var n=["nulldelimiter"].concat(e.baseSizingClasses());return dt(t.concat(n))},St=function(e,t,n){if(!e)return dt();if(at[e.type]){var r=at[e.type](e,t);if(n&&t.size!==n.size){r=dt(t.sizingClasses(n),[r],t);var o=t.sizeMultiplier/n.sizeMultiplier;r.height*=o,r.depth*=o}return r}throw new a("Got group of unknown type: '"+e.type+"'")};function kt(e,t){var n=dt(["base"],e,t),r=dt(["strut"]);return r.style.height=q(n.height+n.depth),n.depth&&(r.style.verticalAlign=q(-n.depth)),n.children.unshift(r),n}function Ct(e,t){var n=null;1===e.length&&"tag"===e[0].type&&(n=e[0].tag,e=e[0].body);var r,o=mt(e,t,"root");2===o.length&&o[1].hasClass("tag")&&(r=o.pop());for(var a,i=[],s=[],l=0;l<o.length;l++)if(s.push(o[l]),o[l].hasClass("mbin")||o[l].hasClass("mrel")||o[l].hasClass("allowbreak")){for(var c=!1;l<o.length-1&&o[l+1].hasClass("mspace")&&!o[l+1].hasClass("newline");)l++,s.push(o[l]),o[l].hasClass("nobreak")&&(c=!0);c||(i.push(kt(s,t)),s=[])}else o[l].hasClass("newline")&&(s.pop(),s.length>0&&(i.push(kt(s,t)),s=[]),i.push(o[l]));s.length>0&&i.push(kt(s,t)),n?((a=kt(mt(n,t,!0))).classes=["tag"],i.push(a)):r&&i.push(r);var u=dt(["katex-html"],i);if(u.setAttribute("aria-hidden","true"),a){var d=a.children[0];d.style.height=q(u.height+u.depth),u.depth&&(d.style.verticalAlign=q(-u.depth))}return u}function Et(e){return new T(e)}class At{constructor(e,t,n){this.type=void 0,this.attributes=void 0,this.children=void 0,this.classes=void 0,this.type=e,this.attributes={},this.children=t||[],this.classes=n||[]}setAttribute(e,t){this.attributes[e]=t}getAttribute(e){return this.attributes[e]}toNode(){var e=document.createElementNS("http://www.w3.org/1998/Math/MathML",this.type);for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&e.setAttribute(t,this.attributes[t]);this.classes.length>0&&(e.className=U(this.classes));for(var n=0;n<this.children.length;n++)if(this.children[n]instanceof It&&this.children[n+1]instanceof It){for(var r=this.children[n].toText()+this.children[++n].toText();this.children[n+1]instanceof It;)r+=this.children[++n].toText();e.appendChild(new It(r).toNode())}else e.appendChild(this.children[n].toNode());return e}toMarkup(){var e="<"+this.type;for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&(e+=" "+t+'="',e+=u.escape(this.attributes[t]),e+='"');this.classes.length>0&&(e+=' class ="'+u.escape(U(this.classes))+'"'),e+=">";for(var n=0;n<this.children.length;n++)e+=this.children[n].toMarkup();return e+="</"+this.type+">"}toText(){return this.children.map((e=>e.toText())).join("")}}class It{constructor(e){this.text=void 0,this.text=e}toNode(){return document.createTextNode(this.text)}toMarkup(){return u.escape(this.toText())}toText(){return this.text}}var Tt={MathNode:At,TextNode:It,SpaceNode:class{constructor(e){this.width=void 0,this.character=void 0,this.width=e,this.character=e>=.05555&&e<=.05556?"\u200a":e>=.1666&&e<=.1667?"\u2009":e>=.2222&&e<=.2223?"\u2005":e>=.2777&&e<=.2778?"\u2005\u200a":e>=-.05556&&e<=-.05555?"\u200a\u2063":e>=-.1667&&e<=-.1666?"\u2009\u2063":e>=-.2223&&e<=-.2222?"\u205f\u2063":e>=-.2778&&e<=-.2777?"\u2005\u2063":null}toNode(){if(this.character)return document.createTextNode(this.character);var e=document.createElementNS("http://www.w3.org/1998/Math/MathML","mspace");return e.setAttribute("width",q(this.width)),e}toMarkup(){return this.character?"<mtext>"+this.character+"</mtext>":'<mspace width="'+q(this.width)+'"/>'}toText(){return this.character?this.character:" "}},newDocumentFragment:Et},Mt=function(e,t,n){return!ae[t][e]||!ae[t][e].replace||55349===e.charCodeAt(0)||Se.hasOwnProperty(e)&&n&&(n.fontFamily&&"tt"===n.fontFamily.slice(4,6)||n.font&&"tt"===n.font.slice(4,6))||(e=ae[t][e].replace),new Tt.TextNode(e)},Ft=function(e){return 1===e.length?e[0]:new Tt.MathNode("mrow",e)},zt=function(e,t){if("texttt"===t.fontFamily)return"monospace";if("textsf"===t.fontFamily)return"textit"===t.fontShape&&"textbf"===t.fontWeight?"sans-serif-bold-italic":"textit"===t.fontShape?"sans-serif-italic":"textbf"===t.fontWeight?"bold-sans-serif":"sans-serif";if("textit"===t.fontShape&&"textbf"===t.fontWeight)return"bold-italic";if("textit"===t.fontShape)return"italic";if("textbf"===t.fontWeight)return"bold";var n=t.font;if(!n||"mathnormal"===n)return null;var r=e.mode;if("mathit"===n)return"italic";if("boldsymbol"===n)return"textord"===e.type?"bold":"bold-italic";if("mathbf"===n)return"bold";if("mathbb"===n)return"double-struck";if("mathsfit"===n)return"sans-serif-italic";if("mathfrak"===n)return"fraktur";if("mathscr"===n||"mathcal"===n)return"script";if("mathsf"===n)return"sans-serif";if("mathtt"===n)return"monospace";var o=e.text;return u.contains(["\\imath","\\jmath"],o)?null:(ae[r][o]&&ae[r][o].replace&&(o=ae[r][o].replace),_(o,Je.fontMap[n].fontName,r)?Je.fontMap[n].variant:null)};function _t(e){if(!e)return!1;if("mi"===e.type&&1===e.children.length){var t=e.children[0];return t instanceof It&&"."===t.text}if("mo"===e.type&&1===e.children.length&&"true"===e.getAttribute("separator")&&"0em"===e.getAttribute("lspace")&&"0em"===e.getAttribute("rspace")){var n=e.children[0];return n instanceof It&&","===n.text}return!1}var Rt=function(e,t,n){if(1===e.length){var r=Bt(e[0],t);return n&&r instanceof At&&"mo"===r.type&&(r.setAttribute("lspace","0em"),r.setAttribute("rspace","0em")),[r]}for(var o,a=[],i=0;i<e.length;i++){var s=Bt(e[i],t);if(s instanceof At&&o instanceof At){if("mtext"===s.type&&"mtext"===o.type&&s.getAttribute("mathvariant")===o.getAttribute("mathvariant")){o.children.push(...s.children);continue}if("mn"===s.type&&"mn"===o.type){o.children.push(...s.children);continue}if(_t(s)&&"mn"===o.type){o.children.push(...s.children);continue}if("mn"===s.type&&_t(o))s.children=[...o.children,...s.children],a.pop();else if(("msup"===s.type||"msub"===s.type)&&s.children.length>=1&&("mn"===o.type||_t(o))){var l=s.children[0];l instanceof At&&"mn"===l.type&&(l.children=[...o.children,...l.children],a.pop())}else if("mi"===o.type&&1===o.children.length){var c=o.children[0];if(c instanceof It&&"\u0338"===c.text&&("mo"===s.type||"mi"===s.type||"mn"===s.type)){var u=s.children[0];u instanceof It&&u.text.length>0&&(u.text=u.text.slice(0,1)+"\u0338"+u.text.slice(1),a.pop())}}}a.push(s),o=s}return a},jt=function(e,t,n){return Ft(Rt(e,t,n))},Bt=function(e,t){if(!e)return new Tt.MathNode("mrow");if(it[e.type])return it[e.type](e,t);throw new a("Got group of unknown type: '"+e.type+"'")};function Ot(e,t,n,r,o){var a,i=Rt(e,n);a=1===i.length&&i[0]instanceof At&&u.contains(["mrow","mtable"],i[0].type)?i[0]:new Tt.MathNode("mrow",i);var s=new Tt.MathNode("annotation",[new Tt.TextNode(t)]);s.setAttribute("encoding","application/x-tex");var l=new Tt.MathNode("semantics",[a,s]),c=new Tt.MathNode("math",[l]);c.setAttribute("xmlns","http://www.w3.org/1998/Math/MathML"),r&&c.setAttribute("display","block");var d=o?"katex":"katex-mathml";return Je.makeSpan([d],[c])}var Nt=function(e){return new N({style:e.displayMode?S.DISPLAY:S.TEXT,maxSize:e.maxSize,minRuleThickness:e.minRuleThickness})},Pt=function(e,t){if(t.displayMode){var n=["katex-display"];t.leqno&&n.push("leqno"),t.fleqn&&n.push("fleqn"),e=Je.makeSpan(n,[e])}return e},Lt={widehat:"^",widecheck:"\u02c7",widetilde:"~",utilde:"~",overleftarrow:"\u2190",underleftarrow:"\u2190",xleftarrow:"\u2190",overrightarrow:"\u2192",underrightarrow:"\u2192",xrightarrow:"\u2192",underbrace:"\u23df",overbrace:"\u23de",overgroup:"\u23e0",undergroup:"\u23e1",overleftrightarrow:"\u2194",underleftrightarrow:"\u2194",xleftrightarrow:"\u2194",Overrightarrow:"\u21d2",xRightarrow:"\u21d2",overleftharpoon:"\u21bc",xleftharpoonup:"\u21bc",overrightharpoon:"\u21c0",xrightharpoonup:"\u21c0",xLeftarrow:"\u21d0",xLeftrightarrow:"\u21d4",xhookleftarrow:"\u21a9",xhookrightarrow:"\u21aa",xmapsto:"\u21a6",xrightharpoondown:"\u21c1",xleftharpoondown:"\u21bd",xrightleftharpoons:"\u21cc",xleftrightharpoons:"\u21cb",xtwoheadleftarrow:"\u219e",xtwoheadrightarrow:"\u21a0",xlongequal:"=",xtofrom:"\u21c4",xrightleftarrows:"\u21c4",xrightequilibrium:"\u21cc",xleftequilibrium:"\u21cb","\\cdrightarrow":"\u2192","\\cdleftarrow":"\u2190","\\cdlongequal":"="},Dt={overrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],overleftarrow:[["leftarrow"],.888,522,"xMinYMin"],underrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],underleftarrow:[["leftarrow"],.888,522,"xMinYMin"],xrightarrow:[["rightarrow"],1.469,522,"xMaxYMin"],"\\cdrightarrow":[["rightarrow"],3,522,"xMaxYMin"],xleftarrow:[["leftarrow"],1.469,522,"xMinYMin"],"\\cdleftarrow":[["leftarrow"],3,522,"xMinYMin"],Overrightarrow:[["doublerightarrow"],.888,560,"xMaxYMin"],xRightarrow:[["doublerightarrow"],1.526,560,"xMaxYMin"],xLeftarrow:[["doubleleftarrow"],1.526,560,"xMinYMin"],overleftharpoon:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoonup:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoondown:[["leftharpoondown"],.888,522,"xMinYMin"],overrightharpoon:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoonup:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoondown:[["rightharpoondown"],.888,522,"xMaxYMin"],xlongequal:[["longequal"],.888,334,"xMinYMin"],"\\cdlongequal":[["longequal"],3,334,"xMinYMin"],xtwoheadleftarrow:[["twoheadleftarrow"],.888,334,"xMinYMin"],xtwoheadrightarrow:[["twoheadrightarrow"],.888,334,"xMaxYMin"],overleftrightarrow:[["leftarrow","rightarrow"],.888,522],overbrace:[["leftbrace","midbrace","rightbrace"],1.6,548],underbrace:[["leftbraceunder","midbraceunder","rightbraceunder"],1.6,548],underleftrightarrow:[["leftarrow","rightarrow"],.888,522],xleftrightarrow:[["leftarrow","rightarrow"],1.75,522],xLeftrightarrow:[["doubleleftarrow","doublerightarrow"],1.75,560],xrightleftharpoons:[["leftharpoondownplus","rightharpoonplus"],1.75,716],xleftrightharpoons:[["leftharpoonplus","rightharpoondownplus"],1.75,716],xhookleftarrow:[["leftarrow","righthook"],1.08,522],xhookrightarrow:[["lefthook","rightarrow"],1.08,522],overlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],underlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],overgroup:[["leftgroup","rightgroup"],.888,342],undergroup:[["leftgroupunder","rightgroupunder"],.888,342],xmapsto:[["leftmapsto","rightarrow"],1.5,522],xtofrom:[["leftToFrom","rightToFrom"],1.75,528],xrightleftarrows:[["baraboveleftarrow","rightarrowabovebar"],1.75,901],xrightequilibrium:[["baraboveshortleftharpoon","rightharpoonaboveshortbar"],1.75,716],xleftequilibrium:[["shortbaraboveleftharpoon","shortrightharpoonabovebar"],1.75,716]},$t=function(e,t,n,r,o){var a,i=e.height+e.depth+n+r;if(/fbox|color|angl/.test(t)){if(a=Je.makeSpan(["stretchy",t],[],o),"fbox"===t){var s=o.color&&o.getColor();s&&(a.style.borderColor=s)}}else{var l=[];/^[bx]cancel$/.test(t)&&l.push(new te({x1:"0",y1:"0",x2:"100%",y2:"100%","stroke-width":"0.046em"})),/^x?cancel$/.test(t)&&l.push(new te({x1:"0",y1:"100%",x2:"100%",y2:"0","stroke-width":"0.046em"}));var c=new Z(l,{width:"100%",height:q(i)});a=Je.makeSvgSpan([],[c],o)}return a.height=i,a.style.height=q(i),a},qt=function(e){var t=new Tt.MathNode("mo",[new Tt.TextNode(Lt[e.replace(/^\\/,"")])]);return t.setAttribute("stretchy","true"),t},Ut=function(e,t){var{span:n,minWidth:r,height:o}=function(){var n=4e5,r=e.label.slice(1);if(u.contains(["widehat","widecheck","widetilde","utilde"],r)){var o,a,i,s="ordgroup"===(f=e.base).type?f.body.length:1;if(s>5)"widehat"===r||"widecheck"===r?(o=420,n=2364,i=.42,a=r+"4"):(o=312,n=2340,i=.34,a="tilde4");else{var l=[1,1,2,2,3,3][s];"widehat"===r||"widecheck"===r?(n=[0,1062,2364,2364,2364][l],o=[0,239,300,360,420][l],i=[0,.24,.3,.3,.36,.42][l],a=r+l):(n=[0,600,1033,2339,2340][l],o=[0,260,286,306,312][l],i=[0,.26,.286,.3,.306,.34][l],a="tilde"+l)}var c=new ee(a),d=new Z([c],{width:"100%",height:q(i),viewBox:"0 0 "+n+" "+o,preserveAspectRatio:"none"});return{span:Je.makeSvgSpan([],[d],t),minWidth:0,height:i}}var p,h,f,g=[],m=Dt[r],[y,v,b]=m,x=b/1e3,w=y.length;if(1===w)p=["hide-tail"],h=[m[3]];else if(2===w)p=["halfarrow-left","halfarrow-right"],h=["xMinYMin","xMaxYMin"];else{if(3!==w)throw new Error("Correct katexImagesData or update code here to support\n                    "+w+" children.");p=["brace-left","brace-center","brace-right"],h=["xMinYMin","xMidYMin","xMaxYMin"]}for(var S=0;S<w;S++){var k=new ee(y[S]),C=new Z([k],{width:"400em",height:q(x),viewBox:"0 0 "+n+" "+b,preserveAspectRatio:h[S]+" slice"}),E=Je.makeSvgSpan([p[S]],[C],t);if(1===w)return{span:E,minWidth:v,height:x};E.style.height=q(x),g.push(E)}return{span:Je.makeSpan(["stretchy"],g,t),minWidth:v,height:x}}();return n.height=o,n.style.height=q(o),r>0&&(n.style.minWidth=q(r)),n};function Vt(e,t){if(!e||e.type!==t)throw new Error("Expected node of type "+t+", but got "+(e?"node of type "+e.type:String(e)));return e}function Ht(e){var t=Wt(e);if(!t)throw new Error("Expected node of symbol group type, but got "+(e?"node of type "+e.type:String(e)));return t}function Wt(e){return e&&("atom"===e.type||oe.hasOwnProperty(e.type))?e:null}var Gt=(e,t)=>{var n,r,o;e&&"supsub"===e.type?(n=(r=Vt(e.base,"accent")).base,e.base=n,o=function(e){if(e instanceof Y)return e;throw new Error("Expected span<HtmlDomNode> but got "+String(e)+".")}(St(e,t)),e.base=r):n=(r=Vt(e,"accent")).base;var a=St(n,t.havingCrampedStyle()),i=0;if(r.isShifty&&u.isCharacterBox(n)){var s=u.getBaseElem(n);i=ne(St(s,t.havingCrampedStyle())).skew}var l,c="\\c"===r.label,d=c?a.height+a.depth:Math.min(a.height,t.fontMetrics().xHeight);if(r.isStretchy)l=Ut(r,t),l=Je.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:a},{type:"elem",elem:l,wrapperClasses:["svg-align"],wrapperStyle:i>0?{width:"calc(100% - "+q(2*i)+")",marginLeft:q(2*i)}:void 0}]},t);else{var p,h;"\\vec"===r.label?(p=Je.staticSvg("vec",t),h=Je.svgData.vec[1]):((p=ne(p=Je.makeOrd({mode:r.mode,text:r.label},t,"textord"))).italic=0,h=p.width,c&&(d+=p.depth)),l=Je.makeSpan(["accent-body"],[p]);var f="\\textcircled"===r.label;f&&(l.classes.push("accent-full"),d=a.height);var g=i;f||(g-=h/2),l.style.left=q(g),"\\textcircled"===r.label&&(l.style.top=".2em"),l=Je.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:a},{type:"kern",size:-d},{type:"elem",elem:l}]},t)}var m=Je.makeSpan(["mord","accent"],[l],t);return o?(o.children[0]=m,o.height=Math.max(m.height,o.height),o.classes[0]="mord",o):m},Yt=(e,t)=>{var n=e.isStretchy?qt(e.label):new Tt.MathNode("mo",[Mt(e.label,e.mode)]),r=new Tt.MathNode("mover",[Bt(e.base,t),n]);return r.setAttribute("accent","true"),r},Xt=new RegExp(["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring"].map((e=>"\\"+e)).join("|"));st({type:"accent",names:["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring","\\widecheck","\\widehat","\\widetilde","\\overrightarrow","\\overleftarrow","\\Overrightarrow","\\overleftrightarrow","\\overgroup","\\overlinesegment","\\overleftharpoon","\\overrightharpoon"],props:{numArgs:1},handler:(e,t)=>{var n=ct(t[0]),r=!Xt.test(e.funcName),o=!r||"\\widehat"===e.funcName||"\\widetilde"===e.funcName||"\\widecheck"===e.funcName;return{type:"accent",mode:e.parser.mode,label:e.funcName,isStretchy:r,isShifty:o,base:n}},htmlBuilder:Gt,mathmlBuilder:Yt}),st({type:"accent",names:["\\'","\\`","\\^","\\~","\\=","\\u","\\.",'\\"',"\\c","\\r","\\H","\\v","\\textcircled"],props:{numArgs:1,allowedInText:!0,allowedInMath:!0,argTypes:["primitive"]},handler:(e,t)=>{var n=t[0],r=e.parser.mode;return"math"===r&&(e.parser.settings.reportNonstrict("mathVsTextAccents","LaTeX's accent "+e.funcName+" works only in text mode"),r="text"),{type:"accent",mode:r,label:e.funcName,isStretchy:!1,isShifty:!0,base:n}},htmlBuilder:Gt,mathmlBuilder:Yt}),st({type:"accentUnder",names:["\\underleftarrow","\\underrightarrow","\\underleftrightarrow","\\undergroup","\\underlinesegment","\\utilde"],props:{numArgs:1},handler:(e,t)=>{var{parser:n,funcName:r}=e,o=t[0];return{type:"accentUnder",mode:n.mode,label:r,base:o}},htmlBuilder:(e,t)=>{var n=St(e.base,t),r=Ut(e,t),o="\\utilde"===e.label?.12:0,a=Je.makeVList({positionType:"top",positionData:n.height,children:[{type:"elem",elem:r,wrapperClasses:["svg-align"]},{type:"kern",size:o},{type:"elem",elem:n}]},t);return Je.makeSpan(["mord","accentunder"],[a],t)},mathmlBuilder:(e,t)=>{var n=qt(e.label),r=new Tt.MathNode("munder",[Bt(e.base,t),n]);return r.setAttribute("accentunder","true"),r}});var Kt=e=>{var t=new Tt.MathNode("mpadded",e?[e]:[]);return t.setAttribute("width","+0.6em"),t.setAttribute("lspace","0.3em"),t};st({type:"xArrow",names:["\\xleftarrow","\\xrightarrow","\\xLeftarrow","\\xRightarrow","\\xleftrightarrow","\\xLeftrightarrow","\\xhookleftarrow","\\xhookrightarrow","\\xmapsto","\\xrightharpoondown","\\xrightharpoonup","\\xleftharpoondown","\\xleftharpoonup","\\xrightleftharpoons","\\xleftrightharpoons","\\xlongequal","\\xtwoheadrightarrow","\\xtwoheadleftarrow","\\xtofrom","\\xrightleftarrows","\\xrightequilibrium","\\xleftequilibrium","\\\\cdrightarrow","\\\\cdleftarrow","\\\\cdlongequal"],props:{numArgs:1,numOptionalArgs:1},handler(e,t,n){var{parser:r,funcName:o}=e;return{type:"xArrow",mode:r.mode,label:o,body:t[0],below:n[0]}},htmlBuilder(e,t){var n,r=t.style,o=t.havingStyle(r.sup()),a=Je.wrapFragment(St(e.body,o,t),t),i="\\x"===e.label.slice(0,2)?"x":"cd";a.classes.push(i+"-arrow-pad"),e.below&&(o=t.havingStyle(r.sub()),(n=Je.wrapFragment(St(e.below,o,t),t)).classes.push(i+"-arrow-pad"));var s,l=Ut(e,t),c=-t.fontMetrics().axisHeight+.5*l.height,u=-t.fontMetrics().axisHeight-.5*l.height-.111;if((a.depth>.25||"\\xleftequilibrium"===e.label)&&(u-=a.depth),n){var d=-t.fontMetrics().axisHeight+n.height+.5*l.height+.111;s=Je.makeVList({positionType:"individualShift",children:[{type:"elem",elem:a,shift:u},{type:"elem",elem:l,shift:c},{type:"elem",elem:n,shift:d}]},t)}else s=Je.makeVList({positionType:"individualShift",children:[{type:"elem",elem:a,shift:u},{type:"elem",elem:l,shift:c}]},t);return s.children[0].children[0].children[1].classes.push("svg-align"),Je.makeSpan(["mrel","x-arrow"],[s],t)},mathmlBuilder(e,t){var n,r=qt(e.label);if(r.setAttribute("minsize","x"===e.label.charAt(0)?"1.75em":"3.0em"),e.body){var o=Kt(Bt(e.body,t));if(e.below){var a=Kt(Bt(e.below,t));n=new Tt.MathNode("munderover",[r,a,o])}else n=new Tt.MathNode("mover",[r,o])}else if(e.below){var i=Kt(Bt(e.below,t));n=new Tt.MathNode("munder",[r,i])}else n=Kt(),n=new Tt.MathNode("mover",[r,n]);return n}});var Qt=Je.makeSpan;function Jt(e,t){var n=mt(e.body,t,!0);return Qt([e.mclass],n,t)}function Zt(e,t){var n,r=Rt(e.body,t);return"minner"===e.mclass?n=new Tt.MathNode("mpadded",r):"mord"===e.mclass?e.isCharacterBox?(n=r[0]).type="mi":n=new Tt.MathNode("mi",r):(e.isCharacterBox?(n=r[0]).type="mo":n=new Tt.MathNode("mo",r),"mbin"===e.mclass?(n.attributes.lspace="0.22em",n.attributes.rspace="0.22em"):"mpunct"===e.mclass?(n.attributes.lspace="0em",n.attributes.rspace="0.17em"):"mopen"===e.mclass||"mclose"===e.mclass?(n.attributes.lspace="0em",n.attributes.rspace="0em"):"minner"===e.mclass&&(n.attributes.lspace="0.0556em",n.attributes.width="+0.1111em")),n}st({type:"mclass",names:["\\mathord","\\mathbin","\\mathrel","\\mathopen","\\mathclose","\\mathpunct","\\mathinner"],props:{numArgs:1,primitive:!0},handler(e,t){var{parser:n,funcName:r}=e,o=t[0];return{type:"mclass",mode:n.mode,mclass:"m"+r.slice(5),body:ut(o),isCharacterBox:u.isCharacterBox(o)}},htmlBuilder:Jt,mathmlBuilder:Zt});var en=e=>{var t="ordgroup"===e.type&&e.body.length?e.body[0]:e;return"atom"!==t.type||"bin"!==t.family&&"rel"!==t.family?"mord":"m"+t.family};st({type:"mclass",names:["\\@binrel"],props:{numArgs:2},handler(e,t){var{parser:n}=e;return{type:"mclass",mode:n.mode,mclass:en(t[0]),body:ut(t[1]),isCharacterBox:u.isCharacterBox(t[1])}}}),st({type:"mclass",names:["\\stackrel","\\overset","\\underset"],props:{numArgs:2},handler(e,t){var n,{parser:r,funcName:o}=e,a=t[1],i=t[0];n="\\stackrel"!==o?en(a):"mrel";var s={type:"op",mode:a.mode,limits:!0,alwaysHandleSupSub:!0,parentIsSupSub:!1,symbol:!1,suppressBaseShift:"\\stackrel"!==o,body:ut(a)},l={type:"supsub",mode:i.mode,base:s,sup:"\\underset"===o?null:i,sub:"\\underset"===o?i:null};return{type:"mclass",mode:r.mode,mclass:n,body:[l],isCharacterBox:u.isCharacterBox(l)}},htmlBuilder:Jt,mathmlBuilder:Zt}),st({type:"pmb",names:["\\pmb"],props:{numArgs:1,allowedInText:!0},handler(e,t){var{parser:n}=e;return{type:"pmb",mode:n.mode,mclass:en(t[0]),body:ut(t[0])}},htmlBuilder(e,t){var n=mt(e.body,t,!0),r=Je.makeSpan([e.mclass],n,t);return r.style.textShadow="0.02em 0.01em 0.04px",r},mathmlBuilder(e,t){var n=Rt(e.body,t),r=new Tt.MathNode("mstyle",n);return r.setAttribute("style","text-shadow: 0.02em 0.01em 0.04px"),r}});var tn={">":"\\\\cdrightarrow","<":"\\\\cdleftarrow","=":"\\\\cdlongequal",A:"\\uparrow",V:"\\downarrow","|":"\\Vert",".":"no arrow"},nn=e=>"textord"===e.type&&"@"===e.text;function rn(e,t,n){var r=tn[e];switch(r){case"\\\\cdrightarrow":case"\\\\cdleftarrow":return n.callFunction(r,[t[0]],[t[1]]);case"\\uparrow":case"\\downarrow":var o={type:"atom",text:r,mode:"math",family:"rel"},a={type:"ordgroup",mode:"math",body:[n.callFunction("\\\\cdleft",[t[0]],[]),n.callFunction("\\Big",[o],[]),n.callFunction("\\\\cdright",[t[1]],[])]};return n.callFunction("\\\\cdparent",[a],[]);case"\\\\cdlongequal":return n.callFunction("\\\\cdlongequal",[],[]);case"\\Vert":return n.callFunction("\\Big",[{type:"textord",text:"\\Vert",mode:"math"}],[]);default:return{type:"textord",text:" ",mode:"math"}}}st({type:"cdlabel",names:["\\\\cdleft","\\\\cdright"],props:{numArgs:1},handler(e,t){var{parser:n,funcName:r}=e;return{type:"cdlabel",mode:n.mode,side:r.slice(4),label:t[0]}},htmlBuilder(e,t){var n=t.havingStyle(t.style.sup()),r=Je.wrapFragment(St(e.label,n,t),t);return r.classes.push("cd-label-"+e.side),r.style.bottom=q(.8-r.depth),r.height=0,r.depth=0,r},mathmlBuilder(e,t){var n=new Tt.MathNode("mrow",[Bt(e.label,t)]);return(n=new Tt.MathNode("mpadded",[n])).setAttribute("width","0"),"left"===e.side&&n.setAttribute("lspace","-1width"),n.setAttribute("voffset","0.7em"),(n=new Tt.MathNode("mstyle",[n])).setAttribute("displaystyle","false"),n.setAttribute("scriptlevel","1"),n}}),st({type:"cdlabelparent",names:["\\\\cdparent"],props:{numArgs:1},handler(e,t){var{parser:n}=e;return{type:"cdlabelparent",mode:n.mode,fragment:t[0]}},htmlBuilder(e,t){var n=Je.wrapFragment(St(e.fragment,t),t);return n.classes.push("cd-vert-arrow"),n},mathmlBuilder:(e,t)=>new Tt.MathNode("mrow",[Bt(e.fragment,t)])}),st({type:"textord",names:["\\@char"],props:{numArgs:1,allowedInText:!0},handler(e,t){for(var{parser:n}=e,r=Vt(t[0],"ordgroup").body,o="",i=0;i<r.length;i++){o+=Vt(r[i],"textord").text}var s,l=parseInt(o);if(isNaN(l))throw new a("\\@char has non-numeric argument "+o);if(l<0||l>=1114111)throw new a("\\@char with invalid code point "+o);return l<=65535?s=String.fromCharCode(l):(l-=65536,s=String.fromCharCode(55296+(l>>10),56320+(1023&l))),{type:"textord",mode:n.mode,text:s}}});var on=(e,t)=>{var n=mt(e.body,t.withColor(e.color),!1);return Je.makeFragment(n)},an=(e,t)=>{var n=Rt(e.body,t.withColor(e.color)),r=new Tt.MathNode("mstyle",n);return r.setAttribute("mathcolor",e.color),r};st({type:"color",names:["\\textcolor"],props:{numArgs:2,allowedInText:!0,argTypes:["color","original"]},handler(e,t){var{parser:n}=e,r=Vt(t[0],"color-token").color,o=t[1];return{type:"color",mode:n.mode,color:r,body:ut(o)}},htmlBuilder:on,mathmlBuilder:an}),st({type:"color",names:["\\color"],props:{numArgs:1,allowedInText:!0,argTypes:["color"]},handler(e,t){var{parser:n,breakOnTokenText:r}=e,o=Vt(t[0],"color-token").color;n.gullet.macros.set("\\current@color",o);var a=n.parseExpression(!0,r);return{type:"color",mode:n.mode,color:o,body:a}},htmlBuilder:on,mathmlBuilder:an}),st({type:"cr",names:["\\\\"],props:{numArgs:0,numOptionalArgs:0,allowedInText:!0},handler(e,t,n){var{parser:r}=e,o="["===r.gullet.future().text?r.parseSizeGroup(!0):null,a=!r.settings.displayMode||!r.settings.useStrictBehavior("newLineInDisplayMode","In LaTeX, \\\\ or \\newline does nothing in display mode");return{type:"cr",mode:r.mode,newLine:a,size:o&&Vt(o,"size").value}},htmlBuilder(e,t){var n=Je.makeSpan(["mspace"],[],t);return e.newLine&&(n.classes.push("newline"),e.size&&(n.style.marginTop=q($(e.size,t)))),n},mathmlBuilder(e,t){var n=new Tt.MathNode("mspace");return e.newLine&&(n.setAttribute("linebreak","newline"),e.size&&n.setAttribute("height",q($(e.size,t)))),n}});var sn={"\\global":"\\global","\\long":"\\\\globallong","\\\\globallong":"\\\\globallong","\\def":"\\gdef","\\gdef":"\\gdef","\\edef":"\\xdef","\\xdef":"\\xdef","\\let":"\\\\globallet","\\futurelet":"\\\\globalfuture"},ln=e=>{var t=e.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(t))throw new a("Expected a control sequence",e);return t},cn=(e,t,n,r)=>{var o=e.gullet.macros.get(n.text);null==o&&(n.noexpand=!0,o={tokens:[n],numArgs:0,unexpandable:!e.gullet.isExpandable(n.text)}),e.gullet.macros.set(t,o,r)};st({type:"internal",names:["\\global","\\long","\\\\globallong"],props:{numArgs:0,allowedInText:!0},handler(e){var{parser:t,funcName:n}=e;t.consumeSpaces();var r=t.fetch();if(sn[r.text])return"\\global"!==n&&"\\\\globallong"!==n||(r.text=sn[r.text]),Vt(t.parseFunction(),"internal");throw new a("Invalid token after macro prefix",r)}}),st({type:"internal",names:["\\def","\\gdef","\\edef","\\xdef"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(e){var{parser:t,funcName:n}=e,r=t.gullet.popToken(),o=r.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(o))throw new a("Expected a control sequence",r);for(var i,s=0,l=[[]];"{"!==t.gullet.future().text;)if("#"===(r=t.gullet.popToken()).text){if("{"===t.gullet.future().text){i=t.gullet.future(),l[s].push("{");break}if(r=t.gullet.popToken(),!/^[1-9]$/.test(r.text))throw new a('Invalid argument number "'+r.text+'"');if(parseInt(r.text)!==s+1)throw new a('Argument number "'+r.text+'" out of order');s++,l.push([])}else{if("EOF"===r.text)throw new a("Expected a macro definition");l[s].push(r.text)}var{tokens:c}=t.gullet.consumeArg();return i&&c.unshift(i),"\\edef"!==n&&"\\xdef"!==n||(c=t.gullet.expandTokens(c)).reverse(),t.gullet.macros.set(o,{tokens:c,numArgs:s,delimiters:l},n===sn[n]),{type:"internal",mode:t.mode}}}),st({type:"internal",names:["\\let","\\\\globallet"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(e){var{parser:t,funcName:n}=e,r=ln(t.gullet.popToken());t.gullet.consumeSpaces();var o=(e=>{var t=e.gullet.popToken();return"="===t.text&&" "===(t=e.gullet.popToken()).text&&(t=e.gullet.popToken()),t})(t);return cn(t,r,o,"\\\\globallet"===n),{type:"internal",mode:t.mode}}}),st({type:"internal",names:["\\futurelet","\\\\globalfuture"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(e){var{parser:t,funcName:n}=e,r=ln(t.gullet.popToken()),o=t.gullet.popToken(),a=t.gullet.popToken();return cn(t,r,a,"\\\\globalfuture"===n),t.gullet.pushToken(a),t.gullet.pushToken(o),{type:"internal",mode:t.mode}}});var un=function(e,t,n){var r=_(ae.math[e]&&ae.math[e].replace||e,t,n);if(!r)throw new Error("Unsupported symbol "+e+" and font size "+t+".");return r},dn=function(e,t,n,r){var o=n.havingBaseStyle(t),a=Je.makeSpan(r.concat(o.sizingClasses(n)),[e],n),i=o.sizeMultiplier/n.sizeMultiplier;return a.height*=i,a.depth*=i,a.maxFontSize=o.sizeMultiplier,a},pn=function(e,t,n){var r=t.havingBaseStyle(n),o=(1-t.sizeMultiplier/r.sizeMultiplier)*t.fontMetrics().axisHeight;e.classes.push("delimcenter"),e.style.top=q(o),e.height-=o,e.depth+=o},hn=function(e,t,n,r,o,a){var i=function(e,t,n,r){return Je.makeSymbol(e,"Size"+t+"-Regular",n,r)}(e,t,o,r),s=dn(Je.makeSpan(["delimsizing","size"+t],[i],r),S.TEXT,r,a);return n&&pn(s,r,S.TEXT),s},fn=function(e,t,n){var r;return r="Size1-Regular"===t?"delim-size1":"delim-size4",{type:"elem",elem:Je.makeSpan(["delimsizinginner",r],[Je.makeSpan([],[Je.makeSymbol(e,t,n)])])}},gn=function(e,t,n){var r=M["Size4-Regular"][e.charCodeAt(0)]?M["Size4-Regular"][e.charCodeAt(0)][4]:M["Size1-Regular"][e.charCodeAt(0)][4],o=new ee("inner",function(e,t){switch(e){case"\u239c":return"M291 0 H417 V"+t+" H291z M291 0 H417 V"+t+" H291z";case"\u2223":return"M145 0 H188 V"+t+" H145z M145 0 H188 V"+t+" H145z";case"\u2225":return"M145 0 H188 V"+t+" H145z M145 0 H188 V"+t+" H145zM367 0 H410 V"+t+" H367z M367 0 H410 V"+t+" H367z";case"\u239f":return"M457 0 H583 V"+t+" H457z M457 0 H583 V"+t+" H457z";case"\u23a2":return"M319 0 H403 V"+t+" H319z M319 0 H403 V"+t+" H319z";case"\u23a5":return"M263 0 H347 V"+t+" H263z M263 0 H347 V"+t+" H263z";case"\u23aa":return"M384 0 H504 V"+t+" H384z M384 0 H504 V"+t+" H384z";case"\u23d0":return"M312 0 H355 V"+t+" H312z M312 0 H355 V"+t+" H312z";case"\u2016":return"M257 0 H300 V"+t+" H257z M257 0 H300 V"+t+" H257zM478 0 H521 V"+t+" H478z M478 0 H521 V"+t+" H478z";default:return""}}(e,Math.round(1e3*t))),a=new Z([o],{width:q(r),height:q(t),style:"width:"+q(r),viewBox:"0 0 "+1e3*r+" "+Math.round(1e3*t),preserveAspectRatio:"xMinYMin"}),i=Je.makeSvgSpan([],[a],n);return i.height=t,i.style.height=q(t),i.style.width=q(r),{type:"elem",elem:i}},mn={type:"kern",size:-.008},yn=["|","\\lvert","\\rvert","\\vert"],vn=["\\|","\\lVert","\\rVert","\\Vert"],bn=function(e,t,n,r,o,a){var i,s,l,c,d="",p=0;i=l=c=e,s=null;var h="Size1-Regular";"\\uparrow"===e?l=c="\u23d0":"\\Uparrow"===e?l=c="\u2016":"\\downarrow"===e?i=l="\u23d0":"\\Downarrow"===e?i=l="\u2016":"\\updownarrow"===e?(i="\\uparrow",l="\u23d0",c="\\downarrow"):"\\Updownarrow"===e?(i="\\Uparrow",l="\u2016",c="\\Downarrow"):u.contains(yn,e)?(l="\u2223",d="vert",p=333):u.contains(vn,e)?(l="\u2225",d="doublevert",p=556):"["===e||"\\lbrack"===e?(i="\u23a1",l="\u23a2",c="\u23a3",h="Size4-Regular",d="lbrack",p=667):"]"===e||"\\rbrack"===e?(i="\u23a4",l="\u23a5",c="\u23a6",h="Size4-Regular",d="rbrack",p=667):"\\lfloor"===e||"\u230a"===e?(l=i="\u23a2",c="\u23a3",h="Size4-Regular",d="lfloor",p=667):"\\lceil"===e||"\u2308"===e?(i="\u23a1",l=c="\u23a2",h="Size4-Regular",d="lceil",p=667):"\\rfloor"===e||"\u230b"===e?(l=i="\u23a5",c="\u23a6",h="Size4-Regular",d="rfloor",p=667):"\\rceil"===e||"\u2309"===e?(i="\u23a4",l=c="\u23a5",h="Size4-Regular",d="rceil",p=667):"("===e||"\\lparen"===e?(i="\u239b",l="\u239c",c="\u239d",h="Size4-Regular",d="lparen",p=875):")"===e||"\\rparen"===e?(i="\u239e",l="\u239f",c="\u23a0",h="Size4-Regular",d="rparen",p=875):"\\{"===e||"\\lbrace"===e?(i="\u23a7",s="\u23a8",c="\u23a9",l="\u23aa",h="Size4-Regular"):"\\}"===e||"\\rbrace"===e?(i="\u23ab",s="\u23ac",c="\u23ad",l="\u23aa",h="Size4-Regular"):"\\lgroup"===e||"\u27ee"===e?(i="\u23a7",c="\u23a9",l="\u23aa",h="Size4-Regular"):"\\rgroup"===e||"\u27ef"===e?(i="\u23ab",c="\u23ad",l="\u23aa",h="Size4-Regular"):"\\lmoustache"===e||"\u23b0"===e?(i="\u23a7",c="\u23ad",l="\u23aa",h="Size4-Regular"):"\\rmoustache"!==e&&"\u23b1"!==e||(i="\u23ab",c="\u23a9",l="\u23aa",h="Size4-Regular");var f=un(i,h,o),g=f.height+f.depth,m=un(l,h,o),y=m.height+m.depth,v=un(c,h,o),b=v.height+v.depth,x=0,w=1;if(null!==s){var k=un(s,h,o);x=k.height+k.depth,w=2}var C=g+b+x,E=C+Math.max(0,Math.ceil((t-C)/(w*y)))*w*y,A=r.fontMetrics().axisHeight;n&&(A*=r.sizeMultiplier);var I=E/2-A,T=[];if(d.length>0){var M=E-g-b,F=Math.round(1e3*E),z=function(e,t){switch(e){case"lbrack":return"M403 1759 V84 H666 V0 H319 V1759 v"+t+" v1759 h347 v-84\nH403z M403 1759 V0 H319 V1759 v"+t+" v1759 h84z";case"rbrack":return"M347 1759 V0 H0 V84 H263 V1759 v"+t+" v1759 H0 v84 H347z\nM347 1759 V0 H263 V1759 v"+t+" v1759 h84z";case"vert":return"M145 15 v585 v"+t+" v585 c2.667,10,9.667,15,21,15\nc10,0,16.667,-5,20,-15 v-585 v"+-t+" v-585 c-2.667,-10,-9.667,-15,-21,-15\nc-10,0,-16.667,5,-20,15z M188 15 H145 v585 v"+t+" v585 h43z";case"doublevert":return"M145 15 v585 v"+t+" v585 c2.667,10,9.667,15,21,15\nc10,0,16.667,-5,20,-15 v-585 v"+-t+" v-585 c-2.667,-10,-9.667,-15,-21,-15\nc-10,0,-16.667,5,-20,15z M188 15 H145 v585 v"+t+" v585 h43z\nM367 15 v585 v"+t+" v585 c2.667,10,9.667,15,21,15\nc10,0,16.667,-5,20,-15 v-585 v"+-t+" v-585 c-2.667,-10,-9.667,-15,-21,-15\nc-10,0,-16.667,5,-20,15z M410 15 H367 v585 v"+t+" v585 h43z";case"lfloor":return"M319 602 V0 H403 V602 v"+t+" v1715 h263 v84 H319z\nMM319 602 V0 H403 V602 v"+t+" v1715 H319z";case"rfloor":return"M319 602 V0 H403 V602 v"+t+" v1799 H0 v-84 H319z\nMM319 602 V0 H403 V602 v"+t+" v1715 H319z";case"lceil":return"M403 1759 V84 H666 V0 H319 V1759 v"+t+" v602 h84z\nM403 1759 V0 H319 V1759 v"+t+" v602 h84z";case"rceil":return"M347 1759 V0 H0 V84 H263 V1759 v"+t+" v602 h84z\nM347 1759 V0 h-84 V1759 v"+t+" v602 h84z";case"lparen":return"M863,9c0,-2,-2,-5,-6,-9c0,0,-17,0,-17,0c-12.7,0,-19.3,0.3,-20,1\nc-5.3,5.3,-10.3,11,-15,17c-242.7,294.7,-395.3,682,-458,1162c-21.3,163.3,-33.3,349,\n-36,557 l0,"+(t+84)+"c0.2,6,0,26,0,60c2,159.3,10,310.7,24,454c53.3,528,210,\n949.7,470,1265c4.7,6,9.7,11.7,15,17c0.7,0.7,7,1,19,1c0,0,18,0,18,0c4,-4,6,-7,6,-9\nc0,-2.7,-3.3,-8.7,-10,-18c-135.3,-192.7,-235.5,-414.3,-300.5,-665c-65,-250.7,-102.5,\n-544.7,-112.5,-882c-2,-104,-3,-167,-3,-189\nl0,-"+(t+92)+"c0,-162.7,5.7,-314,17,-454c20.7,-272,63.7,-513,129,-723c65.3,\n-210,155.3,-396.3,270,-559c6.7,-9.3,10,-15.3,10,-18z";case"rparen":return"M76,0c-16.7,0,-25,3,-25,9c0,2,2,6.3,6,13c21.3,28.7,42.3,60.3,\n63,95c96.7,156.7,172.8,332.5,228.5,527.5c55.7,195,92.8,416.5,111.5,664.5\nc11.3,139.3,17,290.7,17,454c0,28,1.7,43,3.3,45l0,"+(t+9)+"\nc-3,4,-3.3,16.7,-3.3,38c0,162,-5.7,313.7,-17,455c-18.7,248,-55.8,469.3,-111.5,664\nc-55.7,194.7,-131.8,370.3,-228.5,527c-20.7,34.7,-41.7,66.3,-63,95c-2,3.3,-4,7,-6,11\nc0,7.3,5.7,11,17,11c0,0,11,0,11,0c9.3,0,14.3,-0.3,15,-1c5.3,-5.3,10.3,-11,15,-17\nc242.7,-294.7,395.3,-681.7,458,-1161c21.3,-164.7,33.3,-350.7,36,-558\nl0,-"+(t+144)+"c-2,-159.3,-10,-310.7,-24,-454c-53.3,-528,-210,-949.7,\n-470,-1265c-4.7,-6,-9.7,-11.7,-15,-17c-0.7,-0.7,-6.7,-1,-18,-1z";default:throw new Error("Unknown stretchy delimiter.")}}(d,Math.round(1e3*M)),_=new ee(d,z),R=(p/1e3).toFixed(3)+"em",j=(F/1e3).toFixed(3)+"em",B=new Z([_],{width:R,height:j,viewBox:"0 0 "+p+" "+F}),O=Je.makeSvgSpan([],[B],r);O.height=F/1e3,O.style.width=R,O.style.height=j,T.push({type:"elem",elem:O})}else{if(T.push(fn(c,h,o)),T.push(mn),null===s){var N=E-g-b+.016;T.push(gn(l,N,r))}else{var P=(E-g-b-x)/2+.016;T.push(gn(l,P,r)),T.push(mn),T.push(fn(s,h,o)),T.push(mn),T.push(gn(l,P,r))}T.push(mn),T.push(fn(i,h,o))}var L=r.havingBaseStyle(S.TEXT),D=Je.makeVList({positionType:"bottom",positionData:I,children:T},L);return dn(Je.makeSpan(["delimsizing","mult"],[D],L),S.TEXT,r,a)},xn=.08,wn=function(e,t,n,r,o){var a=function(e,t,n){t*=1e3;var r="";switch(e){case"sqrtMain":r=function(e,t){return"M95,"+(622+e+t)+"\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl"+e/2.075+" -"+e+"\nc5.3,-9.3,12,-14,20,-14\nH400000v"+(40+e)+"H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM"+(834+e)+" "+t+"h400000v"+(40+e)+"h-400000z"}(t,A);break;case"sqrtSize1":r=function(e,t){return"M263,"+(601+e+t)+"c0.7,0,18,39.7,52,119\nc34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120\nc340,-704.7,510.7,-1060.3,512,-1067\nl"+e/2.084+" -"+e+"\nc4.7,-7.3,11,-11,19,-11\nH40000v"+(40+e)+"H1012.3\ns-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232\nc-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1\ns-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26\nc-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z\nM"+(1001+e)+" "+t+"h400000v"+(40+e)+"h-400000z"}(t,A);break;case"sqrtSize2":r=function(e,t){return"M983 "+(10+e+t)+"\nl"+e/3.13+" -"+e+"\nc4,-6.7,10,-10,18,-10 H400000v"+(40+e)+"\nH1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7\ns-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744\nc-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30\nc26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722\nc56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5\nc53.7,-170.3,84.5,-266.8,92.5,-289.5z\nM"+(1001+e)+" "+t+"h400000v"+(40+e)+"h-400000z"}(t,A);break;case"sqrtSize3":r=function(e,t){return"M424,"+(2398+e+t)+"\nc-1.3,-0.7,-38.5,-172,-111.5,-514c-73,-342,-109.8,-513.3,-110.5,-514\nc0,-2,-10.7,14.3,-32,49c-4.7,7.3,-9.8,15.7,-15.5,25c-5.7,9.3,-9.8,16,-12.5,20\ns-5,7,-5,7c-4,-3.3,-8.3,-7.7,-13,-13s-13,-13,-13,-13s76,-122,76,-122s77,-121,77,-121\ns209,968,209,968c0,-2,84.7,-361.7,254,-1079c169.3,-717.3,254.7,-1077.7,256,-1081\nl"+e/4.223+" -"+e+"c4,-6.7,10,-10,18,-10 H400000\nv"+(40+e)+"H1014.6\ns-87.3,378.7,-272.6,1166c-185.3,787.3,-279.3,1182.3,-282,1185\nc-2,6,-10,9,-24,9\nc-8,0,-12,-0.7,-12,-2z M"+(1001+e)+" "+t+"\nh400000v"+(40+e)+"h-400000z"}(t,A);break;case"sqrtSize4":r=function(e,t){return"M473,"+(2713+e+t)+"\nc339.3,-1799.3,509.3,-2700,510,-2702 l"+e/5.298+" -"+e+"\nc3.3,-7.3,9.3,-11,18,-11 H400000v"+(40+e)+"H1017.7\ns-90.5,478,-276.2,1466c-185.7,988,-279.5,1483,-281.5,1485c-2,6,-10,9,-24,9\nc-8,0,-12,-0.7,-12,-2c0,-1.3,-5.3,-32,-16,-92c-50.7,-293.3,-119.7,-693.3,-207,-1200\nc0,-1.3,-5.3,8.7,-16,30c-10.7,21.3,-21.3,42.7,-32,64s-16,33,-16,33s-26,-26,-26,-26\ns76,-153,76,-153s77,-151,77,-151c0.7,0.7,35.7,202,105,604c67.3,400.7,102,602.7,104,\n606zM"+(1001+e)+" "+t+"h400000v"+(40+e)+"H1017.7z"}(t,A);break;case"sqrtTall":r=function(e,t,n){return"M702 "+(e+t)+"H400000"+(40+e)+"\nH742v"+(n-54-t-e)+"l-4 4-4 4c-.667.7 -2 1.5-4 2.5s-4.167 1.833-6.5 2.5-5.5 1-9.5 1\nh-12l-28-84c-16.667-52-96.667 -294.333-240-727l-212 -643 -85 170\nc-4-3.333-8.333-7.667-13 -13l-13-13l77-155 77-156c66 199.333 139 419.667\n219 661 l218 661zM702 "+t+"H400000v"+(40+e)+"H742z"}(t,A,n)}return r}(e,r,n),i=new ee(e,a),s=new Z([i],{width:"400em",height:q(t),viewBox:"0 0 400000 "+n,preserveAspectRatio:"xMinYMin slice"});return Je.makeSvgSpan(["hide-tail"],[s],o)},Sn=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","\u230a","\u230b","\\lceil","\\rceil","\u2308","\u2309","\\surd"],kn=["\\uparrow","\\downarrow","\\updownarrow","\\Uparrow","\\Downarrow","\\Updownarrow","|","\\|","\\vert","\\Vert","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","\u27ee","\u27ef","\\lmoustache","\\rmoustache","\u23b0","\u23b1"],Cn=["<",">","\\langle","\\rangle","/","\\backslash","\\lt","\\gt"],En=[0,1.2,1.8,2.4,3],An=[{type:"small",style:S.SCRIPTSCRIPT},{type:"small",style:S.SCRIPT},{type:"small",style:S.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4}],In=[{type:"small",style:S.SCRIPTSCRIPT},{type:"small",style:S.SCRIPT},{type:"small",style:S.TEXT},{type:"stack"}],Tn=[{type:"small",style:S.SCRIPTSCRIPT},{type:"small",style:S.SCRIPT},{type:"small",style:S.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4},{type:"stack"}],Mn=function(e){if("small"===e.type)return"Main-Regular";if("large"===e.type)return"Size"+e.size+"-Regular";if("stack"===e.type)return"Size4-Regular";throw new Error("Add support for delim type '"+e.type+"' here.")},Fn=function(e,t,n,r){for(var o=Math.min(2,3-r.style.size);o<n.length&&"stack"!==n[o].type;o++){var a=un(e,Mn(n[o]),"math"),i=a.height+a.depth;if("small"===n[o].type&&(i*=r.havingBaseStyle(n[o].style).sizeMultiplier),i>t)return n[o]}return n[n.length-1]},zn=function(e,t,n,r,o,a){var i;"<"===e||"\\lt"===e||"\u27e8"===e?e="\\langle":">"!==e&&"\\gt"!==e&&"\u27e9"!==e||(e="\\rangle"),i=u.contains(Cn,e)?An:u.contains(Sn,e)?Tn:In;var s=Fn(e,t,i,r);return"small"===s.type?function(e,t,n,r,o,a){var i=Je.makeSymbol(e,"Main-Regular",o,r),s=dn(i,t,r,a);return n&&pn(s,r,t),s}(e,s.style,n,r,o,a):"large"===s.type?hn(e,s.size,n,r,o,a):bn(e,t,n,r,o,a)},_n={sqrtImage:function(e,t){var n,r,o=t.havingBaseSizing(),a=Fn("\\surd",e*o.sizeMultiplier,Tn,o),i=o.sizeMultiplier,s=Math.max(0,t.minRuleThickness-t.fontMetrics().sqrtRuleThickness),l=0,c=0,u=0;return"small"===a.type?(e<1?i=1:e<1.4&&(i=.7),c=(1+s)/i,(n=wn("sqrtMain",l=(1+s+xn)/i,u=1e3+1e3*s+80,s,t)).style.minWidth="0.853em",r=.833/i):"large"===a.type?(u=1080*En[a.size],c=(En[a.size]+s)/i,l=(En[a.size]+s+xn)/i,(n=wn("sqrtSize"+a.size,l,u,s,t)).style.minWidth="1.02em",r=1/i):(l=e+s+xn,c=e+s,u=Math.floor(1e3*e+s)+80,(n=wn("sqrtTall",l,u,s,t)).style.minWidth="0.742em",r=1.056),n.height=c,n.style.height=q(l),{span:n,advanceWidth:r,ruleWidth:(t.fontMetrics().sqrtRuleThickness+s)*i}},sizedDelim:function(e,t,n,r,o){if("<"===e||"\\lt"===e||"\u27e8"===e?e="\\langle":">"!==e&&"\\gt"!==e&&"\u27e9"!==e||(e="\\rangle"),u.contains(Sn,e)||u.contains(Cn,e))return hn(e,t,!1,n,r,o);if(u.contains(kn,e))return bn(e,En[t],!1,n,r,o);throw new a("Illegal delimiter: '"+e+"'")},sizeToMaxHeight:En,customSizedDelim:zn,leftRightDelim:function(e,t,n,r,o,a){var i=r.fontMetrics().axisHeight*r.sizeMultiplier,s=5/r.fontMetrics().ptPerEm,l=Math.max(t-i,n+i),c=Math.max(l/500*901,2*l-s);return zn(e,c,!0,r,o,a)}},Rn={"\\bigl":{mclass:"mopen",size:1},"\\Bigl":{mclass:"mopen",size:2},"\\biggl":{mclass:"mopen",size:3},"\\Biggl":{mclass:"mopen",size:4},"\\bigr":{mclass:"mclose",size:1},"\\Bigr":{mclass:"mclose",size:2},"\\biggr":{mclass:"mclose",size:3},"\\Biggr":{mclass:"mclose",size:4},"\\bigm":{mclass:"mrel",size:1},"\\Bigm":{mclass:"mrel",size:2},"\\biggm":{mclass:"mrel",size:3},"\\Biggm":{mclass:"mrel",size:4},"\\big":{mclass:"mord",size:1},"\\Big":{mclass:"mord",size:2},"\\bigg":{mclass:"mord",size:3},"\\Bigg":{mclass:"mord",size:4}},jn=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","\u230a","\u230b","\\lceil","\\rceil","\u2308","\u2309","<",">","\\langle","\u27e8","\\rangle","\u27e9","\\lt","\\gt","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","\u27ee","\u27ef","\\lmoustache","\\rmoustache","\u23b0","\u23b1","/","\\backslash","|","\\vert","\\|","\\Vert","\\uparrow","\\Uparrow","\\downarrow","\\Downarrow","\\updownarrow","\\Updownarrow","."];function Bn(e,t){var n=Wt(e);if(n&&u.contains(jn,n.text))return n;throw new a(n?"Invalid delimiter '"+n.text+"' after '"+t.funcName+"'":"Invalid delimiter type '"+e.type+"'",e)}function On(e){if(!e.body)throw new Error("Bug: The leftright ParseNode wasn't fully parsed.")}st({type:"delimsizing",names:["\\bigl","\\Bigl","\\biggl","\\Biggl","\\bigr","\\Bigr","\\biggr","\\Biggr","\\bigm","\\Bigm","\\biggm","\\Biggm","\\big","\\Big","\\bigg","\\Bigg"],props:{numArgs:1,argTypes:["primitive"]},handler:(e,t)=>{var n=Bn(t[0],e);return{type:"delimsizing",mode:e.parser.mode,size:Rn[e.funcName].size,mclass:Rn[e.funcName].mclass,delim:n.text}},htmlBuilder:(e,t)=>"."===e.delim?Je.makeSpan([e.mclass]):_n.sizedDelim(e.delim,e.size,t,e.mode,[e.mclass]),mathmlBuilder:e=>{var t=[];"."!==e.delim&&t.push(Mt(e.delim,e.mode));var n=new Tt.MathNode("mo",t);"mopen"===e.mclass||"mclose"===e.mclass?n.setAttribute("fence","true"):n.setAttribute("fence","false"),n.setAttribute("stretchy","true");var r=q(_n.sizeToMaxHeight[e.size]);return n.setAttribute("minsize",r),n.setAttribute("maxsize",r),n}}),st({type:"leftright-right",names:["\\right"],props:{numArgs:1,primitive:!0},handler:(e,t)=>{var n=e.parser.gullet.macros.get("\\current@color");if(n&&"string"!=typeof n)throw new a("\\current@color set to non-string in \\right");return{type:"leftright-right",mode:e.parser.mode,delim:Bn(t[0],e).text,color:n}}}),st({type:"leftright",names:["\\left"],props:{numArgs:1,primitive:!0},handler:(e,t)=>{var n=Bn(t[0],e),r=e.parser;++r.leftrightDepth;var o=r.parseExpression(!1);--r.leftrightDepth,r.expect("\\right",!1);var a=Vt(r.parseFunction(),"leftright-right");return{type:"leftright",mode:r.mode,body:o,left:n.text,right:a.delim,rightColor:a.color}},htmlBuilder:(e,t)=>{On(e);for(var n,r,o=mt(e.body,t,!0,["mopen","mclose"]),a=0,i=0,s=!1,l=0;l<o.length;l++)o[l].isMiddle?s=!0:(a=Math.max(o[l].height,a),i=Math.max(o[l].depth,i));if(a*=t.sizeMultiplier,i*=t.sizeMultiplier,n="."===e.left?wt(t,["mopen"]):_n.leftRightDelim(e.left,a,i,t,e.mode,["mopen"]),o.unshift(n),s)for(var c=1;c<o.length;c++){var u=o[c].isMiddle;u&&(o[c]=_n.leftRightDelim(u.delim,a,i,u.options,e.mode,[]))}if("."===e.right)r=wt(t,["mclose"]);else{var d=e.rightColor?t.withColor(e.rightColor):t;r=_n.leftRightDelim(e.right,a,i,d,e.mode,["mclose"])}return o.push(r),Je.makeSpan(["minner"],o,t)},mathmlBuilder:(e,t)=>{On(e);var n=Rt(e.body,t);if("."!==e.left){var r=new Tt.MathNode("mo",[Mt(e.left,e.mode)]);r.setAttribute("fence","true"),n.unshift(r)}if("."!==e.right){var o=new Tt.MathNode("mo",[Mt(e.right,e.mode)]);o.setAttribute("fence","true"),e.rightColor&&o.setAttribute("mathcolor",e.rightColor),n.push(o)}return Ft(n)}}),st({type:"middle",names:["\\middle"],props:{numArgs:1,primitive:!0},handler:(e,t)=>{var n=Bn(t[0],e);if(!e.parser.leftrightDepth)throw new a("\\middle without preceding \\left",n);return{type:"middle",mode:e.parser.mode,delim:n.text}},htmlBuilder:(e,t)=>{var n;if("."===e.delim)n=wt(t,[]);else{n=_n.sizedDelim(e.delim,1,t,e.mode,[]);var r={delim:e.delim,options:t};n.isMiddle=r}return n},mathmlBuilder:(e,t)=>{var n="\\vert"===e.delim||"|"===e.delim?Mt("|","text"):Mt(e.delim,e.mode),r=new Tt.MathNode("mo",[n]);return r.setAttribute("fence","true"),r.setAttribute("lspace","0.05em"),r.setAttribute("rspace","0.05em"),r}});var Nn=(e,t)=>{var n,r,o,a=Je.wrapFragment(St(e.body,t),t),i=e.label.slice(1),s=t.sizeMultiplier,l=0,c=u.isCharacterBox(e.body);if("sout"===i)(n=Je.makeSpan(["stretchy","sout"])).height=t.fontMetrics().defaultRuleThickness/s,l=-.5*t.fontMetrics().xHeight;else if("phase"===i){var d=$({number:.6,unit:"pt"},t),p=$({number:.35,unit:"ex"},t);s/=t.havingBaseSizing().sizeMultiplier;var h=a.height+a.depth+d+p;a.style.paddingLeft=q(h/2+d);var f=Math.floor(1e3*h*s),g="M400000 "+(r=f)+" H0 L"+r/2+" 0 l65 45 L145 "+(r-80)+" H400000z",m=new Z([new ee("phase",g)],{width:"400em",height:q(f/1e3),viewBox:"0 0 400000 "+f,preserveAspectRatio:"xMinYMin slice"});(n=Je.makeSvgSpan(["hide-tail"],[m],t)).style.height=q(h),l=a.depth+d+p}else{/cancel/.test(i)?c||a.classes.push("cancel-pad"):"angl"===i?a.classes.push("anglpad"):a.classes.push("boxpad");var y=0,v=0,b=0;/box/.test(i)?(b=Math.max(t.fontMetrics().fboxrule,t.minRuleThickness),v=y=t.fontMetrics().fboxsep+("colorbox"===i?0:b)):"angl"===i?(y=4*(b=Math.max(t.fontMetrics().defaultRuleThickness,t.minRuleThickness)),v=Math.max(0,.25-a.depth)):v=y=c?.2:0,n=$t(a,i,y,v,t),/fbox|boxed|fcolorbox/.test(i)?(n.style.borderStyle="solid",n.style.borderWidth=q(b)):"angl"===i&&.049!==b&&(n.style.borderTopWidth=q(b),n.style.borderRightWidth=q(b)),l=a.depth+v,e.backgroundColor&&(n.style.backgroundColor=e.backgroundColor,e.borderColor&&(n.style.borderColor=e.borderColor))}if(e.backgroundColor)o=Je.makeVList({positionType:"individualShift",children:[{type:"elem",elem:n,shift:l},{type:"elem",elem:a,shift:0}]},t);else{var x=/cancel|phase/.test(i)?["svg-align"]:[];o=Je.makeVList({positionType:"individualShift",children:[{type:"elem",elem:a,shift:0},{type:"elem",elem:n,shift:l,wrapperClasses:x}]},t)}return/cancel/.test(i)&&(o.height=a.height,o.depth=a.depth),/cancel/.test(i)&&!c?Je.makeSpan(["mord","cancel-lap"],[o],t):Je.makeSpan(["mord"],[o],t)},Pn=(e,t)=>{var n=0,r=new Tt.MathNode(e.label.indexOf("colorbox")>-1?"mpadded":"menclose",[Bt(e.body,t)]);switch(e.label){case"\\cancel":r.setAttribute("notation","updiagonalstrike");break;case"\\bcancel":r.setAttribute("notation","downdiagonalstrike");break;case"\\phase":r.setAttribute("notation","phasorangle");break;case"\\sout":r.setAttribute("notation","horizontalstrike");break;case"\\fbox":r.setAttribute("notation","box");break;case"\\angl":r.setAttribute("notation","actuarial");break;case"\\fcolorbox":case"\\colorbox":if(n=t.fontMetrics().fboxsep*t.fontMetrics().ptPerEm,r.setAttribute("width","+"+2*n+"pt"),r.setAttribute("height","+"+2*n+"pt"),r.setAttribute("lspace",n+"pt"),r.setAttribute("voffset",n+"pt"),"\\fcolorbox"===e.label){var o=Math.max(t.fontMetrics().fboxrule,t.minRuleThickness);r.setAttribute("style","border: "+o+"em solid "+String(e.borderColor))}break;case"\\xcancel":r.setAttribute("notation","updiagonalstrike downdiagonalstrike")}return e.backgroundColor&&r.setAttribute("mathbackground",e.backgroundColor),r};st({type:"enclose",names:["\\colorbox"],props:{numArgs:2,allowedInText:!0,argTypes:["color","text"]},handler(e,t,n){var{parser:r,funcName:o}=e,a=Vt(t[0],"color-token").color,i=t[1];return{type:"enclose",mode:r.mode,label:o,backgroundColor:a,body:i}},htmlBuilder:Nn,mathmlBuilder:Pn}),st({type:"enclose",names:["\\fcolorbox"],props:{numArgs:3,allowedInText:!0,argTypes:["color","color","text"]},handler(e,t,n){var{parser:r,funcName:o}=e,a=Vt(t[0],"color-token").color,i=Vt(t[1],"color-token").color,s=t[2];return{type:"enclose",mode:r.mode,label:o,backgroundColor:i,borderColor:a,body:s}},htmlBuilder:Nn,mathmlBuilder:Pn}),st({type:"enclose",names:["\\fbox"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!0},handler(e,t){var{parser:n}=e;return{type:"enclose",mode:n.mode,label:"\\fbox",body:t[0]}}}),st({type:"enclose",names:["\\cancel","\\bcancel","\\xcancel","\\sout","\\phase"],props:{numArgs:1},handler(e,t){var{parser:n,funcName:r}=e,o=t[0];return{type:"enclose",mode:n.mode,label:r,body:o}},htmlBuilder:Nn,mathmlBuilder:Pn}),st({type:"enclose",names:["\\angl"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!1},handler(e,t){var{parser:n}=e;return{type:"enclose",mode:n.mode,label:"\\angl",body:t[0]}}});var Ln={};function Dn(e){for(var{type:t,names:n,props:r,handler:o,htmlBuilder:a,mathmlBuilder:i}=e,s={type:t,numArgs:r.numArgs||0,allowedInText:!1,numOptionalArgs:0,handler:o},l=0;l<n.length;++l)Ln[n[l]]=s;a&&(at[t]=a),i&&(it[t]=i)}var $n={};function qn(e,t){$n[e]=t}function Un(e){var t=[];e.consumeSpaces();var n=e.fetch().text;for("\\relax"===n&&(e.consume(),e.consumeSpaces(),n=e.fetch().text);"\\hline"===n||"\\hdashline"===n;)e.consume(),t.push("\\hdashline"===n),e.consumeSpaces(),n=e.fetch().text;return t}var Vn=e=>{if(!e.parser.settings.displayMode)throw new a("{"+e.envName+"} can be used only in display mode.")};function Hn(e){if(-1===e.indexOf("ed"))return-1===e.indexOf("*")}function Wn(e,t,n){var{hskipBeforeAndAfter:r,addJot:i,cols:s,arraystretch:l,colSeparationType:c,autoTag:u,singleRow:d,emptySingleRow:p,maxNumCols:h,leqno:f}=t;if(e.gullet.beginGroup(),d||e.gullet.macros.set("\\cr","\\\\\\relax"),!l){var g=e.gullet.expandMacroAsText("\\arraystretch");if(null==g)l=1;else if(!(l=parseFloat(g))||l<0)throw new a("Invalid \\arraystretch: "+g)}e.gullet.beginGroup();var m=[],y=[m],v=[],b=[],x=null!=u?[]:void 0;function w(){u&&e.gullet.macros.set("\\@eqnsw","1",!0)}function S(){x&&(e.gullet.macros.get("\\df@tag")?(x.push(e.subparse([new o("\\df@tag")])),e.gullet.macros.set("\\df@tag",void 0,!0)):x.push(Boolean(u)&&"1"===e.gullet.macros.get("\\@eqnsw")))}for(w(),b.push(Un(e));;){var k=e.parseExpression(!1,d?"\\end":"\\\\");e.gullet.endGroup(),e.gullet.beginGroup(),k={type:"ordgroup",mode:e.mode,body:k},n&&(k={type:"styling",mode:e.mode,style:n,body:[k]}),m.push(k);var C=e.fetch().text;if("&"===C){if(h&&m.length===h){if(d||c)throw new a("Too many tab characters: &",e.nextToken);e.settings.reportNonstrict("textEnv","Too few columns specified in the {array} column argument.")}e.consume()}else{if("\\end"===C){S(),1===m.length&&"styling"===k.type&&0===k.body[0].body.length&&(y.length>1||!p)&&y.pop(),b.length<y.length+1&&b.push([]);break}if("\\\\"!==C)throw new a("Expected & or \\\\ or \\cr or \\end",e.nextToken);e.consume();var E=void 0;" "!==e.gullet.future().text&&(E=e.parseSizeGroup(!0)),v.push(E?E.value:null),S(),b.push(Un(e)),m=[],y.push(m),w()}}return e.gullet.endGroup(),e.gullet.endGroup(),{type:"array",mode:e.mode,addJot:i,arraystretch:l,body:y,cols:s,rowGaps:v,hskipBeforeAndAfter:r,hLinesBeforeRow:b,colSeparationType:c,tags:x,leqno:f}}function Gn(e){return"d"===e.slice(0,1)?"display":"text"}var Yn=function(e,t){var n,r,o=e.body.length,i=e.hLinesBeforeRow,s=0,l=new Array(o),c=[],d=Math.max(t.fontMetrics().arrayRuleWidth,t.minRuleThickness),p=1/t.fontMetrics().ptPerEm,h=5*p;e.colSeparationType&&"small"===e.colSeparationType&&(h=t.havingStyle(S.SCRIPT).sizeMultiplier/t.sizeMultiplier*.2778);var f="CD"===e.colSeparationType?$({number:3,unit:"ex"},t):12*p,g=3*p,m=e.arraystretch*f,y=.7*m,v=.3*m,b=0;function x(e){for(var t=0;t<e.length;++t)t>0&&(b+=.25),c.push({pos:b,isDashed:e[t]})}for(x(i[0]),n=0;n<e.body.length;++n){var w=e.body[n],k=y,C=v;s<w.length&&(s=w.length);var E=new Array(w.length);for(r=0;r<w.length;++r){var A=St(w[r],t);C<A.depth&&(C=A.depth),k<A.height&&(k=A.height),E[r]=A}var I=e.rowGaps[n],T=0;I&&(T=$(I,t))>0&&(C<(T+=v)&&(C=T),T=0),e.addJot&&(C+=g),E.height=k,E.depth=C,b+=k,E.pos=b,b+=C+T,l[n]=E,x(i[n+1])}var M,F,z=b/2+t.fontMetrics().axisHeight,_=e.cols||[],R=[],j=[];if(e.tags&&e.tags.some((e=>e)))for(n=0;n<o;++n){var B=l[n],O=B.pos-z,N=e.tags[n],P=void 0;(P=!0===N?Je.makeSpan(["eqn-num"],[],t):!1===N?Je.makeSpan([],[],t):Je.makeSpan([],mt(N,t,!0),t)).depth=B.depth,P.height=B.height,j.push({type:"elem",elem:P,shift:O})}for(r=0,F=0;r<s||F<_.length;++r,++F){for(var L=_[F]||{},D=!0;"separator"===L.type;){if(D||((M=Je.makeSpan(["arraycolsep"],[])).style.width=q(t.fontMetrics().doubleRuleSep),R.push(M)),"|"!==L.separator&&":"!==L.separator)throw new a("Invalid separator type: "+L.separator);var U="|"===L.separator?"solid":"dashed",V=Je.makeSpan(["vertical-separator"],[],t);V.style.height=q(b),V.style.borderRightWidth=q(d),V.style.borderRightStyle=U,V.style.margin="0 "+q(-d/2);var H=b-z;H&&(V.style.verticalAlign=q(-H)),R.push(V),L=_[++F]||{},D=!1}if(!(r>=s)){var W=void 0;(r>0||e.hskipBeforeAndAfter)&&0!==(W=u.deflt(L.pregap,h))&&((M=Je.makeSpan(["arraycolsep"],[])).style.width=q(W),R.push(M));var G=[];for(n=0;n<o;++n){var Y=l[n],X=Y[r];if(X){var K=Y.pos-z;X.depth=Y.depth,X.height=Y.height,G.push({type:"elem",elem:X,shift:K})}}G=Je.makeVList({positionType:"individualShift",children:G},t),G=Je.makeSpan(["col-align-"+(L.align||"c")],[G]),R.push(G),(r<s-1||e.hskipBeforeAndAfter)&&0!==(W=u.deflt(L.postgap,h))&&((M=Je.makeSpan(["arraycolsep"],[])).style.width=q(W),R.push(M))}}if(l=Je.makeSpan(["mtable"],R),c.length>0){for(var Q=Je.makeLineSpan("hline",t,d),J=Je.makeLineSpan("hdashline",t,d),Z=[{type:"elem",elem:l,shift:0}];c.length>0;){var ee=c.pop(),te=ee.pos-z;ee.isDashed?Z.push({type:"elem",elem:J,shift:te}):Z.push({type:"elem",elem:Q,shift:te})}l=Je.makeVList({positionType:"individualShift",children:Z},t)}if(0===j.length)return Je.makeSpan(["mord"],[l],t);var ne=Je.makeVList({positionType:"individualShift",children:j},t);return ne=Je.makeSpan(["tag"],[ne],t),Je.makeFragment([l,ne])},Xn={c:"center ",l:"left ",r:"right "},Kn=function(e,t){for(var n=[],r=new Tt.MathNode("mtd",[],["mtr-glue"]),o=new Tt.MathNode("mtd",[],["mml-eqn-num"]),a=0;a<e.body.length;a++){for(var i=e.body[a],s=[],l=0;l<i.length;l++)s.push(new Tt.MathNode("mtd",[Bt(i[l],t)]));e.tags&&e.tags[a]&&(s.unshift(r),s.push(r),e.leqno?s.unshift(o):s.push(o)),n.push(new Tt.MathNode("mtr",s))}var c=new Tt.MathNode("mtable",n),u=.5===e.arraystretch?.1:.16+e.arraystretch-1+(e.addJot?.09:0);c.setAttribute("rowspacing",q(u));var d="",p="";if(e.cols&&e.cols.length>0){var h=e.cols,f="",g=!1,m=0,y=h.length;"separator"===h[0].type&&(d+="top ",m=1),"separator"===h[h.length-1].type&&(d+="bottom ",y-=1);for(var v=m;v<y;v++)"align"===h[v].type?(p+=Xn[h[v].align],g&&(f+="none "),g=!0):"separator"===h[v].type&&g&&(f+="|"===h[v].separator?"solid ":"dashed ",g=!1);c.setAttribute("columnalign",p.trim()),/[sd]/.test(f)&&c.setAttribute("columnlines",f.trim())}if("align"===e.colSeparationType){for(var b=e.cols||[],x="",w=1;w<b.length;w++)x+=w%2?"0em ":"1em ";c.setAttribute("columnspacing",x.trim())}else"alignat"===e.colSeparationType||"gather"===e.colSeparationType?c.setAttribute("columnspacing","0em"):"small"===e.colSeparationType?c.setAttribute("columnspacing","0.2778em"):"CD"===e.colSeparationType?c.setAttribute("columnspacing","0.5em"):c.setAttribute("columnspacing","1em");var S="",k=e.hLinesBeforeRow;d+=k[0].length>0?"left ":"",d+=k[k.length-1].length>0?"right ":"";for(var C=1;C<k.length-1;C++)S+=0===k[C].length?"none ":k[C][0]?"dashed ":"solid ";return/[sd]/.test(S)&&c.setAttribute("rowlines",S.trim()),""!==d&&(c=new Tt.MathNode("menclose",[c])).setAttribute("notation",d.trim()),e.arraystretch&&e.arraystretch<1&&(c=new Tt.MathNode("mstyle",[c])).setAttribute("scriptlevel","1"),c},Qn=function(e,t){-1===e.envName.indexOf("ed")&&Vn(e);var n,r=[],o=e.envName.indexOf("at")>-1?"alignat":"align",i="split"===e.envName,s=Wn(e.parser,{cols:r,addJot:!0,autoTag:i?void 0:Hn(e.envName),emptySingleRow:!0,colSeparationType:o,maxNumCols:i?2:void 0,leqno:e.parser.settings.leqno},"display"),l=0,c={type:"ordgroup",mode:e.mode,body:[]};if(t[0]&&"ordgroup"===t[0].type){for(var u="",d=0;d<t[0].body.length;d++){u+=Vt(t[0].body[d],"textord").text}n=Number(u),l=2*n}var p=!l;s.body.forEach((function(e){for(var t=1;t<e.length;t+=2){var r=Vt(e[t],"styling");Vt(r.body[0],"ordgroup").body.unshift(c)}if(p)l<e.length&&(l=e.length);else{var o=e.length/2;if(n<o)throw new a("Too many math in a row: expected "+n+", but got "+o,e[0])}}));for(var h=0;h<l;++h){var f="r",g=0;h%2==1?f="l":h>0&&p&&(g=1),r[h]={type:"align",align:f,pregap:g,postgap:0}}return s.colSeparationType=p?"align":"alignat",s};Dn({type:"array",names:["array","darray"],props:{numArgs:1},handler(e,t){var n=(Wt(t[0])?[t[0]]:Vt(t[0],"ordgroup").body).map((function(e){var t=Ht(e).text;if(-1!=="lcr".indexOf(t))return{type:"align",align:t};if("|"===t)return{type:"separator",separator:"|"};if(":"===t)return{type:"separator",separator:":"};throw new a("Unknown column alignment: "+t,e)})),r={cols:n,hskipBeforeAndAfter:!0,maxNumCols:n.length};return Wn(e.parser,r,Gn(e.envName))},htmlBuilder:Yn,mathmlBuilder:Kn}),Dn({type:"array",names:["matrix","pmatrix","bmatrix","Bmatrix","vmatrix","Vmatrix","matrix*","pmatrix*","bmatrix*","Bmatrix*","vmatrix*","Vmatrix*"],props:{numArgs:0},handler(e){var t={matrix:null,pmatrix:["(",")"],bmatrix:["[","]"],Bmatrix:["\\{","\\}"],vmatrix:["|","|"],Vmatrix:["\\Vert","\\Vert"]}[e.envName.replace("*","")],n="c",r={hskipBeforeAndAfter:!1,cols:[{type:"align",align:n}]};if("*"===e.envName.charAt(e.envName.length-1)){var o=e.parser;if(o.consumeSpaces(),"["===o.fetch().text){if(o.consume(),o.consumeSpaces(),n=o.fetch().text,-1==="lcr".indexOf(n))throw new a("Expected l or c or r",o.nextToken);o.consume(),o.consumeSpaces(),o.expect("]"),o.consume(),r.cols=[{type:"align",align:n}]}}var i=Wn(e.parser,r,Gn(e.envName)),s=Math.max(0,...i.body.map((e=>e.length)));return i.cols=new Array(s).fill({type:"align",align:n}),t?{type:"leftright",mode:e.mode,body:[i],left:t[0],right:t[1],rightColor:void 0}:i},htmlBuilder:Yn,mathmlBuilder:Kn}),Dn({type:"array",names:["smallmatrix"],props:{numArgs:0},handler(e){var t=Wn(e.parser,{arraystretch:.5},"script");return t.colSeparationType="small",t},htmlBuilder:Yn,mathmlBuilder:Kn}),Dn({type:"array",names:["subarray"],props:{numArgs:1},handler(e,t){var n=(Wt(t[0])?[t[0]]:Vt(t[0],"ordgroup").body).map((function(e){var t=Ht(e).text;if(-1!=="lc".indexOf(t))return{type:"align",align:t};throw new a("Unknown column alignment: "+t,e)}));if(n.length>1)throw new a("{subarray} can contain only one column");var r={cols:n,hskipBeforeAndAfter:!1,arraystretch:.5};if((r=Wn(e.parser,r,"script")).body.length>0&&r.body[0].length>1)throw new a("{subarray} can contain only one column");return r},htmlBuilder:Yn,mathmlBuilder:Kn}),Dn({type:"array",names:["cases","dcases","rcases","drcases"],props:{numArgs:0},handler(e){var t=Wn(e.parser,{arraystretch:1.2,cols:[{type:"align",align:"l",pregap:0,postgap:1},{type:"align",align:"l",pregap:0,postgap:0}]},Gn(e.envName));return{type:"leftright",mode:e.mode,body:[t],left:e.envName.indexOf("r")>-1?".":"\\{",right:e.envName.indexOf("r")>-1?"\\}":".",rightColor:void 0}},htmlBuilder:Yn,mathmlBuilder:Kn}),Dn({type:"array",names:["align","align*","aligned","split"],props:{numArgs:0},handler:Qn,htmlBuilder:Yn,mathmlBuilder:Kn}),Dn({type:"array",names:["gathered","gather","gather*"],props:{numArgs:0},handler(e){u.contains(["gather","gather*"],e.envName)&&Vn(e);var t={cols:[{type:"align",align:"c"}],addJot:!0,colSeparationType:"gather",autoTag:Hn(e.envName),emptySingleRow:!0,leqno:e.parser.settings.leqno};return Wn(e.parser,t,"display")},htmlBuilder:Yn,mathmlBuilder:Kn}),Dn({type:"array",names:["alignat","alignat*","alignedat"],props:{numArgs:1},handler:Qn,htmlBuilder:Yn,mathmlBuilder:Kn}),Dn({type:"array",names:["equation","equation*"],props:{numArgs:0},handler(e){Vn(e);var t={autoTag:Hn(e.envName),emptySingleRow:!0,singleRow:!0,maxNumCols:1,leqno:e.parser.settings.leqno};return Wn(e.parser,t,"display")},htmlBuilder:Yn,mathmlBuilder:Kn}),Dn({type:"array",names:["CD"],props:{numArgs:0},handler:e=>(Vn(e),function(e){var t=[];for(e.gullet.beginGroup(),e.gullet.macros.set("\\cr","\\\\\\relax"),e.gullet.beginGroup();;){t.push(e.parseExpression(!1,"\\\\")),e.gullet.endGroup(),e.gullet.beginGroup();var n=e.fetch().text;if("&"!==n&&"\\\\"!==n){if("\\end"===n){0===t[t.length-1].length&&t.pop();break}throw new a("Expected \\\\ or \\cr or \\end",e.nextToken)}e.consume()}for(var r,o,i=[],s=[i],l=0;l<t.length;l++){for(var c=t[l],u={type:"styling",body:[],mode:"math",style:"display"},d=0;d<c.length;d++)if(nn(c[d])){i.push(u);var p=Ht(c[d+=1]).text,h=new Array(2);if(h[0]={type:"ordgroup",mode:"math",body:[]},h[1]={type:"ordgroup",mode:"math",body:[]},"=|.".indexOf(p)>-1);else{if(!("<>AV".indexOf(p)>-1))throw new a('Expected one of "<>AV=|." after @',c[d]);for(var f=0;f<2;f++){for(var g=!0,m=d+1;m<c.length;m++){if(o=p,("mathord"===(r=c[m]).type||"atom"===r.type)&&r.text===o){g=!1,d=m;break}if(nn(c[m]))throw new a("Missing a "+p+" character to complete a CD arrow.",c[m]);h[f].body.push(c[m])}if(g)throw new a("Missing a "+p+" character to complete a CD arrow.",c[d])}}var y={type:"styling",body:[rn(p,h,e)],mode:"math",style:"display"};i.push(y),u={type:"styling",body:[],mode:"math",style:"display"}}else u.body.push(c[d]);l%2==0?i.push(u):i.shift(),i=[],s.push(i)}return e.gullet.endGroup(),e.gullet.endGroup(),{type:"array",mode:"math",body:s,arraystretch:1,addJot:!0,rowGaps:[null],cols:new Array(s[0].length).fill({type:"align",align:"c",pregap:.25,postgap:.25}),colSeparationType:"CD",hLinesBeforeRow:new Array(s.length+1).fill([])}}(e.parser)),htmlBuilder:Yn,mathmlBuilder:Kn}),qn("\\nonumber","\\gdef\\@eqnsw{0}"),qn("\\notag","\\nonumber"),st({type:"text",names:["\\hline","\\hdashline"],props:{numArgs:0,allowedInText:!0,allowedInMath:!0},handler(e,t){throw new a(e.funcName+" valid only within array environment")}});var Jn=Ln;st({type:"environment",names:["\\begin","\\end"],props:{numArgs:1,argTypes:["text"]},handler(e,t){var{parser:n,funcName:r}=e,o=t[0];if("ordgroup"!==o.type)throw new a("Invalid environment name",o);for(var i="",s=0;s<o.body.length;++s)i+=Vt(o.body[s],"textord").text;if("\\begin"===r){if(!Jn.hasOwnProperty(i))throw new a("No such environment: "+i,o);var l=Jn[i],{args:c,optArgs:u}=n.parseArguments("\\begin{"+i+"}",l),d={mode:n.mode,envName:i,parser:n},p=l.handler(d,c,u);n.expect("\\end",!1);var h=n.nextToken,f=Vt(n.parseFunction(),"environment");if(f.name!==i)throw new a("Mismatch: \\begin{"+i+"} matched by \\end{"+f.name+"}",h);return p}return{type:"environment",mode:n.mode,name:i,nameGroup:o}}});var Zn=(e,t)=>{var n=e.font,r=t.withFont(n);return St(e.body,r)},er=(e,t)=>{var n=e.font,r=t.withFont(n);return Bt(e.body,r)},tr={"\\Bbb":"\\mathbb","\\bold":"\\mathbf","\\frak":"\\mathfrak","\\bm":"\\boldsymbol"};st({type:"font",names:["\\mathrm","\\mathit","\\mathbf","\\mathnormal","\\mathsfit","\\mathbb","\\mathcal","\\mathfrak","\\mathscr","\\mathsf","\\mathtt","\\Bbb","\\bold","\\frak"],props:{numArgs:1,allowedInArgument:!0},handler:(e,t)=>{var{parser:n,funcName:r}=e,o=ct(t[0]),a=r;return a in tr&&(a=tr[a]),{type:"font",mode:n.mode,font:a.slice(1),body:o}},htmlBuilder:Zn,mathmlBuilder:er}),st({type:"mclass",names:["\\boldsymbol","\\bm"],props:{numArgs:1},handler:(e,t)=>{var{parser:n}=e,r=t[0],o=u.isCharacterBox(r);return{type:"mclass",mode:n.mode,mclass:en(r),body:[{type:"font",mode:n.mode,font:"boldsymbol",body:r}],isCharacterBox:o}}}),st({type:"font",names:["\\rm","\\sf","\\tt","\\bf","\\it","\\cal"],props:{numArgs:0,allowedInText:!0},handler:(e,t)=>{var{parser:n,funcName:r,breakOnTokenText:o}=e,{mode:a}=n,i=n.parseExpression(!0,o);return{type:"font",mode:a,font:"math"+r.slice(1),body:{type:"ordgroup",mode:n.mode,body:i}}},htmlBuilder:Zn,mathmlBuilder:er});var nr=(e,t)=>{var n=t;return"display"===e?n=n.id>=S.SCRIPT.id?n.text():S.DISPLAY:"text"===e&&n.size===S.DISPLAY.size?n=S.TEXT:"script"===e?n=S.SCRIPT:"scriptscript"===e&&(n=S.SCRIPTSCRIPT),n},rr=(e,t)=>{var n,r=nr(e.size,t.style),o=r.fracNum(),a=r.fracDen();n=t.havingStyle(o);var i=St(e.numer,n,t);if(e.continued){var s=8.5/t.fontMetrics().ptPerEm,l=3.5/t.fontMetrics().ptPerEm;i.height=i.height<s?s:i.height,i.depth=i.depth<l?l:i.depth}n=t.havingStyle(a);var c,u,d,p,h,f,g,m,y,v,b=St(e.denom,n,t);if(e.hasBarLine?(e.barSize?(u=$(e.barSize,t),c=Je.makeLineSpan("frac-line",t,u)):c=Je.makeLineSpan("frac-line",t),u=c.height,d=c.height):(c=null,u=0,d=t.fontMetrics().defaultRuleThickness),r.size===S.DISPLAY.size||"display"===e.size?(p=t.fontMetrics().num1,h=u>0?3*d:7*d,f=t.fontMetrics().denom1):(u>0?(p=t.fontMetrics().num2,h=d):(p=t.fontMetrics().num3,h=3*d),f=t.fontMetrics().denom2),c){var x=t.fontMetrics().axisHeight;p-i.depth-(x+.5*u)<h&&(p+=h-(p-i.depth-(x+.5*u))),x-.5*u-(b.height-f)<h&&(f+=h-(x-.5*u-(b.height-f)));var w=-(x-.5*u);g=Je.makeVList({positionType:"individualShift",children:[{type:"elem",elem:b,shift:f},{type:"elem",elem:c,shift:w},{type:"elem",elem:i,shift:-p}]},t)}else{var k=p-i.depth-(b.height-f);k<h&&(p+=.5*(h-k),f+=.5*(h-k)),g=Je.makeVList({positionType:"individualShift",children:[{type:"elem",elem:b,shift:f},{type:"elem",elem:i,shift:-p}]},t)}return n=t.havingStyle(r),g.height*=n.sizeMultiplier/t.sizeMultiplier,g.depth*=n.sizeMultiplier/t.sizeMultiplier,m=r.size===S.DISPLAY.size?t.fontMetrics().delim1:r.size===S.SCRIPTSCRIPT.size?t.havingStyle(S.SCRIPT).fontMetrics().delim2:t.fontMetrics().delim2,y=null==e.leftDelim?wt(t,["mopen"]):_n.customSizedDelim(e.leftDelim,m,!0,t.havingStyle(r),e.mode,["mopen"]),v=e.continued?Je.makeSpan([]):null==e.rightDelim?wt(t,["mclose"]):_n.customSizedDelim(e.rightDelim,m,!0,t.havingStyle(r),e.mode,["mclose"]),Je.makeSpan(["mord"].concat(n.sizingClasses(t)),[y,Je.makeSpan(["mfrac"],[g]),v],t)},or=(e,t)=>{var n=new Tt.MathNode("mfrac",[Bt(e.numer,t),Bt(e.denom,t)]);if(e.hasBarLine){if(e.barSize){var r=$(e.barSize,t);n.setAttribute("linethickness",q(r))}}else n.setAttribute("linethickness","0px");var o=nr(e.size,t.style);if(o.size!==t.style.size){n=new Tt.MathNode("mstyle",[n]);var a=o.size===S.DISPLAY.size?"true":"false";n.setAttribute("displaystyle",a),n.setAttribute("scriptlevel","0")}if(null!=e.leftDelim||null!=e.rightDelim){var i=[];if(null!=e.leftDelim){var s=new Tt.MathNode("mo",[new Tt.TextNode(e.leftDelim.replace("\\",""))]);s.setAttribute("fence","true"),i.push(s)}if(i.push(n),null!=e.rightDelim){var l=new Tt.MathNode("mo",[new Tt.TextNode(e.rightDelim.replace("\\",""))]);l.setAttribute("fence","true"),i.push(l)}return Ft(i)}return n};st({type:"genfrac",names:["\\dfrac","\\frac","\\tfrac","\\dbinom","\\binom","\\tbinom","\\\\atopfrac","\\\\bracefrac","\\\\brackfrac"],props:{numArgs:2,allowedInArgument:!0},handler:(e,t)=>{var n,{parser:r,funcName:o}=e,a=t[0],i=t[1],s=null,l=null,c="auto";switch(o){case"\\dfrac":case"\\frac":case"\\tfrac":n=!0;break;case"\\\\atopfrac":n=!1;break;case"\\dbinom":case"\\binom":case"\\tbinom":n=!1,s="(",l=")";break;case"\\\\bracefrac":n=!1,s="\\{",l="\\}";break;case"\\\\brackfrac":n=!1,s="[",l="]";break;default:throw new Error("Unrecognized genfrac command")}switch(o){case"\\dfrac":case"\\dbinom":c="display";break;case"\\tfrac":case"\\tbinom":c="text"}return{type:"genfrac",mode:r.mode,continued:!1,numer:a,denom:i,hasBarLine:n,leftDelim:s,rightDelim:l,size:c,barSize:null}},htmlBuilder:rr,mathmlBuilder:or}),st({type:"genfrac",names:["\\cfrac"],props:{numArgs:2},handler:(e,t)=>{var{parser:n,funcName:r}=e,o=t[0],a=t[1];return{type:"genfrac",mode:n.mode,continued:!0,numer:o,denom:a,hasBarLine:!0,leftDelim:null,rightDelim:null,size:"display",barSize:null}}}),st({type:"infix",names:["\\over","\\choose","\\atop","\\brace","\\brack"],props:{numArgs:0,infix:!0},handler(e){var t,{parser:n,funcName:r,token:o}=e;switch(r){case"\\over":t="\\frac";break;case"\\choose":t="\\binom";break;case"\\atop":t="\\\\atopfrac";break;case"\\brace":t="\\\\bracefrac";break;case"\\brack":t="\\\\brackfrac";break;default:throw new Error("Unrecognized infix genfrac command")}return{type:"infix",mode:n.mode,replaceWith:t,token:o}}});var ar=["display","text","script","scriptscript"],ir=function(e){var t=null;return e.length>0&&(t="."===(t=e)?null:t),t};st({type:"genfrac",names:["\\genfrac"],props:{numArgs:6,allowedInArgument:!0,argTypes:["math","math","size","text","math","math"]},handler(e,t){var n,{parser:r}=e,o=t[4],a=t[5],i=ct(t[0]),s="atom"===i.type&&"open"===i.family?ir(i.text):null,l=ct(t[1]),c="atom"===l.type&&"close"===l.family?ir(l.text):null,u=Vt(t[2],"size"),d=null;n=!!u.isBlank||(d=u.value).number>0;var p="auto",h=t[3];if("ordgroup"===h.type){if(h.body.length>0){var f=Vt(h.body[0],"textord");p=ar[Number(f.text)]}}else h=Vt(h,"textord"),p=ar[Number(h.text)];return{type:"genfrac",mode:r.mode,numer:o,denom:a,continued:!1,hasBarLine:n,barSize:d,leftDelim:s,rightDelim:c,size:p}},htmlBuilder:rr,mathmlBuilder:or}),st({type:"infix",names:["\\above"],props:{numArgs:1,argTypes:["size"],infix:!0},handler(e,t){var{parser:n,funcName:r,token:o}=e;return{type:"infix",mode:n.mode,replaceWith:"\\\\abovefrac",size:Vt(t[0],"size").value,token:o}}}),st({type:"genfrac",names:["\\\\abovefrac"],props:{numArgs:3,argTypes:["math","size","math"]},handler:(e,t)=>{var{parser:n,funcName:r}=e,o=t[0],a=function(e){if(!e)throw new Error("Expected non-null, but got "+String(e));return e}(Vt(t[1],"infix").size),i=t[2],s=a.number>0;return{type:"genfrac",mode:n.mode,numer:o,denom:i,continued:!1,hasBarLine:s,barSize:a,leftDelim:null,rightDelim:null,size:"auto"}},htmlBuilder:rr,mathmlBuilder:or});var sr=(e,t)=>{var n,r,o=t.style;"supsub"===e.type?(n=e.sup?St(e.sup,t.havingStyle(o.sup()),t):St(e.sub,t.havingStyle(o.sub()),t),r=Vt(e.base,"horizBrace")):r=Vt(e,"horizBrace");var a,i=St(r.base,t.havingBaseStyle(S.DISPLAY)),s=Ut(r,t);if(r.isOver?(a=Je.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:i},{type:"kern",size:.1},{type:"elem",elem:s}]},t)).children[0].children[0].children[1].classes.push("svg-align"):(a=Je.makeVList({positionType:"bottom",positionData:i.depth+.1+s.height,children:[{type:"elem",elem:s},{type:"kern",size:.1},{type:"elem",elem:i}]},t)).children[0].children[0].children[0].classes.push("svg-align"),n){var l=Je.makeSpan(["mord",r.isOver?"mover":"munder"],[a],t);a=r.isOver?Je.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:l},{type:"kern",size:.2},{type:"elem",elem:n}]},t):Je.makeVList({positionType:"bottom",positionData:l.depth+.2+n.height+n.depth,children:[{type:"elem",elem:n},{type:"kern",size:.2},{type:"elem",elem:l}]},t)}return Je.makeSpan(["mord",r.isOver?"mover":"munder"],[a],t)};st({type:"horizBrace",names:["\\overbrace","\\underbrace"],props:{numArgs:1},handler(e,t){var{parser:n,funcName:r}=e;return{type:"horizBrace",mode:n.mode,label:r,isOver:/^\\over/.test(r),base:t[0]}},htmlBuilder:sr,mathmlBuilder:(e,t)=>{var n=qt(e.label);return new Tt.MathNode(e.isOver?"mover":"munder",[Bt(e.base,t),n])}}),st({type:"href",names:["\\href"],props:{numArgs:2,argTypes:["url","original"],allowedInText:!0},handler:(e,t)=>{var{parser:n}=e,r=t[1],o=Vt(t[0],"url").url;return n.settings.isTrusted({command:"\\href",url:o})?{type:"href",mode:n.mode,href:o,body:ut(r)}:n.formatUnsupportedCmd("\\href")},htmlBuilder:(e,t)=>{var n=mt(e.body,t,!1);return Je.makeAnchor(e.href,[],n,t)},mathmlBuilder:(e,t)=>{var n=jt(e.body,t);return n instanceof At||(n=new At("mrow",[n])),n.setAttribute("href",e.href),n}}),st({type:"href",names:["\\url"],props:{numArgs:1,argTypes:["url"],allowedInText:!0},handler:(e,t)=>{var{parser:n}=e,r=Vt(t[0],"url").url;if(!n.settings.isTrusted({command:"\\url",url:r}))return n.formatUnsupportedCmd("\\url");for(var o=[],a=0;a<r.length;a++){var i=r[a];"~"===i&&(i="\\textasciitilde"),o.push({type:"textord",mode:"text",text:i})}var s={type:"text",mode:n.mode,font:"\\texttt",body:o};return{type:"href",mode:n.mode,href:r,body:ut(s)}}}),st({type:"hbox",names:["\\hbox"],props:{numArgs:1,argTypes:["text"],allowedInText:!0,primitive:!0},handler(e,t){var{parser:n}=e;return{type:"hbox",mode:n.mode,body:ut(t[0])}},htmlBuilder(e,t){var n=mt(e.body,t,!1);return Je.makeFragment(n)},mathmlBuilder:(e,t)=>new Tt.MathNode("mrow",Rt(e.body,t))}),st({type:"html",names:["\\htmlClass","\\htmlId","\\htmlStyle","\\htmlData"],props:{numArgs:2,argTypes:["raw","original"],allowedInText:!0},handler:(e,t)=>{var n,{parser:r,funcName:o,token:i}=e,s=Vt(t[0],"raw").string,l=t[1];r.settings.strict&&r.settings.reportNonstrict("htmlExtension","HTML extension is disabled on strict mode");var c={};switch(o){case"\\htmlClass":c.class=s,n={command:"\\htmlClass",class:s};break;case"\\htmlId":c.id=s,n={command:"\\htmlId",id:s};break;case"\\htmlStyle":c.style=s,n={command:"\\htmlStyle",style:s};break;case"\\htmlData":for(var u=s.split(","),d=0;d<u.length;d++){var p=u[d].split("=");if(2!==p.length)throw new a("Error parsing key-value for \\htmlData");c["data-"+p[0].trim()]=p[1].trim()}n={command:"\\htmlData",attributes:c};break;default:throw new Error("Unrecognized html command")}return r.settings.isTrusted(n)?{type:"html",mode:r.mode,attributes:c,body:ut(l)}:r.formatUnsupportedCmd(o)},htmlBuilder:(e,t)=>{var n=mt(e.body,t,!1),r=["enclosing"];e.attributes.class&&r.push(...e.attributes.class.trim().split(/\s+/));var o=Je.makeSpan(r,n,t);for(var a in e.attributes)"class"!==a&&e.attributes.hasOwnProperty(a)&&o.setAttribute(a,e.attributes[a]);return o},mathmlBuilder:(e,t)=>jt(e.body,t)}),st({type:"htmlmathml",names:["\\html@mathml"],props:{numArgs:2,allowedInText:!0},handler:(e,t)=>{var{parser:n}=e;return{type:"htmlmathml",mode:n.mode,html:ut(t[0]),mathml:ut(t[1])}},htmlBuilder:(e,t)=>{var n=mt(e.html,t,!1);return Je.makeFragment(n)},mathmlBuilder:(e,t)=>jt(e.mathml,t)});var lr=function(e){if(/^[-+]? *(\d+(\.\d*)?|\.\d+)$/.test(e))return{number:+e,unit:"bp"};var t=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(e);if(!t)throw new a("Invalid size: '"+e+"' in \\includegraphics");var n={number:+(t[1]+t[2]),unit:t[3]};if(!D(n))throw new a("Invalid unit: '"+n.unit+"' in \\includegraphics.");return n};st({type:"includegraphics",names:["\\includegraphics"],props:{numArgs:1,numOptionalArgs:1,argTypes:["raw","url"],allowedInText:!1},handler:(e,t,n)=>{var{parser:r}=e,o={number:0,unit:"em"},i={number:.9,unit:"em"},s={number:0,unit:"em"},l="";if(n[0])for(var c=Vt(n[0],"raw").string.split(","),u=0;u<c.length;u++){var d=c[u].split("=");if(2===d.length){var p=d[1].trim();switch(d[0].trim()){case"alt":l=p;break;case"width":o=lr(p);break;case"height":i=lr(p);break;case"totalheight":s=lr(p);break;default:throw new a("Invalid key: '"+d[0]+"' in \\includegraphics.")}}}var h=Vt(t[0],"url").url;return""===l&&(l=(l=(l=h).replace(/^.*[\\/]/,"")).substring(0,l.lastIndexOf("."))),r.settings.isTrusted({command:"\\includegraphics",url:h})?{type:"includegraphics",mode:r.mode,alt:l,width:o,height:i,totalheight:s,src:h}:r.formatUnsupportedCmd("\\includegraphics")},htmlBuilder:(e,t)=>{var n=$(e.height,t),r=0;e.totalheight.number>0&&(r=$(e.totalheight,t)-n);var o=0;e.width.number>0&&(o=$(e.width,t));var a={height:q(n+r)};o>0&&(a.width=q(o)),r>0&&(a.verticalAlign=q(-r));var i=new K(e.src,e.alt,a);return i.height=n,i.depth=r,i},mathmlBuilder:(e,t)=>{var n=new Tt.MathNode("mglyph",[]);n.setAttribute("alt",e.alt);var r=$(e.height,t),o=0;if(e.totalheight.number>0&&(o=$(e.totalheight,t)-r,n.setAttribute("valign",q(-o))),n.setAttribute("height",q(r+o)),e.width.number>0){var a=$(e.width,t);n.setAttribute("width",q(a))}return n.setAttribute("src",e.src),n}}),st({type:"kern",names:["\\kern","\\mkern","\\hskip","\\mskip"],props:{numArgs:1,argTypes:["size"],primitive:!0,allowedInText:!0},handler(e,t){var{parser:n,funcName:r}=e,o=Vt(t[0],"size");if(n.settings.strict){var a="m"===r[1],i="mu"===o.value.unit;a?(i||n.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" supports only mu units, not "+o.value.unit+" units"),"math"!==n.mode&&n.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" works only in math mode")):i&&n.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" doesn't support mu units")}return{type:"kern",mode:n.mode,dimension:o.value}},htmlBuilder:(e,t)=>Je.makeGlue(e.dimension,t),mathmlBuilder(e,t){var n=$(e.dimension,t);return new Tt.SpaceNode(n)}}),st({type:"lap",names:["\\mathllap","\\mathrlap","\\mathclap"],props:{numArgs:1,allowedInText:!0},handler:(e,t)=>{var{parser:n,funcName:r}=e,o=t[0];return{type:"lap",mode:n.mode,alignment:r.slice(5),body:o}},htmlBuilder:(e,t)=>{var n;"clap"===e.alignment?(n=Je.makeSpan([],[St(e.body,t)]),n=Je.makeSpan(["inner"],[n],t)):n=Je.makeSpan(["inner"],[St(e.body,t)]);var r=Je.makeSpan(["fix"],[]),o=Je.makeSpan([e.alignment],[n,r],t),a=Je.makeSpan(["strut"]);return a.style.height=q(o.height+o.depth),o.depth&&(a.style.verticalAlign=q(-o.depth)),o.children.unshift(a),o=Je.makeSpan(["thinbox"],[o],t),Je.makeSpan(["mord","vbox"],[o],t)},mathmlBuilder:(e,t)=>{var n=new Tt.MathNode("mpadded",[Bt(e.body,t)]);if("rlap"!==e.alignment){var r="llap"===e.alignment?"-1":"-0.5";n.setAttribute("lspace",r+"width")}return n.setAttribute("width","0px"),n}}),st({type:"styling",names:["\\(","$"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(e,t){var{funcName:n,parser:r}=e,o=r.mode;r.switchMode("math");var a="\\("===n?"\\)":"$",i=r.parseExpression(!1,a);return r.expect(a),r.switchMode(o),{type:"styling",mode:r.mode,style:"text",body:i}}}),st({type:"text",names:["\\)","\\]"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(e,t){throw new a("Mismatched "+e.funcName)}});var cr=(e,t)=>{switch(t.style.size){case S.DISPLAY.size:return e.display;case S.TEXT.size:return e.text;case S.SCRIPT.size:return e.script;case S.SCRIPTSCRIPT.size:return e.scriptscript;default:return e.text}};st({type:"mathchoice",names:["\\mathchoice"],props:{numArgs:4,primitive:!0},handler:(e,t)=>{var{parser:n}=e;return{type:"mathchoice",mode:n.mode,display:ut(t[0]),text:ut(t[1]),script:ut(t[2]),scriptscript:ut(t[3])}},htmlBuilder:(e,t)=>{var n=cr(e,t),r=mt(n,t,!1);return Je.makeFragment(r)},mathmlBuilder:(e,t)=>{var n=cr(e,t);return jt(n,t)}});var ur=(e,t,n,r,o,a,i)=>{e=Je.makeSpan([],[e]);var s,l,c,d=n&&u.isCharacterBox(n);if(t){var p=St(t,r.havingStyle(o.sup()),r);l={elem:p,kern:Math.max(r.fontMetrics().bigOpSpacing1,r.fontMetrics().bigOpSpacing3-p.depth)}}if(n){var h=St(n,r.havingStyle(o.sub()),r);s={elem:h,kern:Math.max(r.fontMetrics().bigOpSpacing2,r.fontMetrics().bigOpSpacing4-h.height)}}if(l&&s){var f=r.fontMetrics().bigOpSpacing5+s.elem.height+s.elem.depth+s.kern+e.depth+i;c=Je.makeVList({positionType:"bottom",positionData:f,children:[{type:"kern",size:r.fontMetrics().bigOpSpacing5},{type:"elem",elem:s.elem,marginLeft:q(-a)},{type:"kern",size:s.kern},{type:"elem",elem:e},{type:"kern",size:l.kern},{type:"elem",elem:l.elem,marginLeft:q(a)},{type:"kern",size:r.fontMetrics().bigOpSpacing5}]},r)}else if(s){var g=e.height-i;c=Je.makeVList({positionType:"top",positionData:g,children:[{type:"kern",size:r.fontMetrics().bigOpSpacing5},{type:"elem",elem:s.elem,marginLeft:q(-a)},{type:"kern",size:s.kern},{type:"elem",elem:e}]},r)}else{if(!l)return e;var m=e.depth+i;c=Je.makeVList({positionType:"bottom",positionData:m,children:[{type:"elem",elem:e},{type:"kern",size:l.kern},{type:"elem",elem:l.elem,marginLeft:q(a)},{type:"kern",size:r.fontMetrics().bigOpSpacing5}]},r)}var y=[c];if(s&&0!==a&&!d){var v=Je.makeSpan(["mspace"],[],r);v.style.marginRight=q(a),y.unshift(v)}return Je.makeSpan(["mop","op-limits"],y,r)},dr=["\\smallint"],pr=(e,t)=>{var n,r,o,a=!1;"supsub"===e.type?(n=e.sup,r=e.sub,o=Vt(e.base,"op"),a=!0):o=Vt(e,"op");var i,s=t.style,l=!1;if(s.size===S.DISPLAY.size&&o.symbol&&!u.contains(dr,o.name)&&(l=!0),o.symbol){var c=l?"Size2-Regular":"Size1-Regular",d="";if("\\oiint"!==o.name&&"\\oiiint"!==o.name||(d=o.name.slice(1),o.name="oiint"===d?"\\iint":"\\iiint"),i=Je.makeSymbol(o.name,c,"math",t,["mop","op-symbol",l?"large-op":"small-op"]),d.length>0){var p=i.italic,h=Je.staticSvg(d+"Size"+(l?"2":"1"),t);i=Je.makeVList({positionType:"individualShift",children:[{type:"elem",elem:i,shift:0},{type:"elem",elem:h,shift:l?.08:0}]},t),o.name="\\"+d,i.classes.unshift("mop"),i.italic=p}}else if(o.body){var f=mt(o.body,t,!0);1===f.length&&f[0]instanceof J?(i=f[0]).classes[0]="mop":i=Je.makeSpan(["mop"],f,t)}else{for(var g=[],m=1;m<o.name.length;m++)g.push(Je.mathsym(o.name[m],o.mode,t));i=Je.makeSpan(["mop"],g,t)}var y=0,v=0;return(i instanceof J||"\\oiint"===o.name||"\\oiiint"===o.name)&&!o.suppressBaseShift&&(y=(i.height-i.depth)/2-t.fontMetrics().axisHeight,v=i.italic),a?ur(i,n,r,t,s,v,y):(y&&(i.style.position="relative",i.style.top=q(y)),i)},hr=(e,t)=>{var n;if(e.symbol)n=new At("mo",[Mt(e.name,e.mode)]),u.contains(dr,e.name)&&n.setAttribute("largeop","false");else if(e.body)n=new At("mo",Rt(e.body,t));else{n=new At("mi",[new It(e.name.slice(1))]);var r=new At("mo",[Mt("\u2061","text")]);n=e.parentIsSupSub?new At("mrow",[n,r]):Et([n,r])}return n},fr={"\u220f":"\\prod","\u2210":"\\coprod","\u2211":"\\sum","\u22c0":"\\bigwedge","\u22c1":"\\bigvee","\u22c2":"\\bigcap","\u22c3":"\\bigcup","\u2a00":"\\bigodot","\u2a01":"\\bigoplus","\u2a02":"\\bigotimes","\u2a04":"\\biguplus","\u2a06":"\\bigsqcup"};st({type:"op",names:["\\coprod","\\bigvee","\\bigwedge","\\biguplus","\\bigcap","\\bigcup","\\intop","\\prod","\\sum","\\bigotimes","\\bigoplus","\\bigodot","\\bigsqcup","\\smallint","\u220f","\u2210","\u2211","\u22c0","\u22c1","\u22c2","\u22c3","\u2a00","\u2a01","\u2a02","\u2a04","\u2a06"],props:{numArgs:0},handler:(e,t)=>{var{parser:n,funcName:r}=e,o=r;return 1===o.length&&(o=fr[o]),{type:"op",mode:n.mode,limits:!0,parentIsSupSub:!1,symbol:!0,name:o}},htmlBuilder:pr,mathmlBuilder:hr}),st({type:"op",names:["\\mathop"],props:{numArgs:1,primitive:!0},handler:(e,t)=>{var{parser:n}=e,r=t[0];return{type:"op",mode:n.mode,limits:!1,parentIsSupSub:!1,symbol:!1,body:ut(r)}},htmlBuilder:pr,mathmlBuilder:hr});var gr={"\u222b":"\\int","\u222c":"\\iint","\u222d":"\\iiint","\u222e":"\\oint","\u222f":"\\oiint","\u2230":"\\oiiint"};st({type:"op",names:["\\arcsin","\\arccos","\\arctan","\\arctg","\\arcctg","\\arg","\\ch","\\cos","\\cosec","\\cosh","\\cot","\\cotg","\\coth","\\csc","\\ctg","\\cth","\\deg","\\dim","\\exp","\\hom","\\ker","\\lg","\\ln","\\log","\\sec","\\sin","\\sinh","\\sh","\\tan","\\tanh","\\tg","\\th"],props:{numArgs:0},handler(e){var{parser:t,funcName:n}=e;return{type:"op",mode:t.mode,limits:!1,parentIsSupSub:!1,symbol:!1,name:n}},htmlBuilder:pr,mathmlBuilder:hr}),st({type:"op",names:["\\det","\\gcd","\\inf","\\lim","\\max","\\min","\\Pr","\\sup"],props:{numArgs:0},handler(e){var{parser:t,funcName:n}=e;return{type:"op",mode:t.mode,limits:!0,parentIsSupSub:!1,symbol:!1,name:n}},htmlBuilder:pr,mathmlBuilder:hr}),st({type:"op",names:["\\int","\\iint","\\iiint","\\oint","\\oiint","\\oiiint","\u222b","\u222c","\u222d","\u222e","\u222f","\u2230"],props:{numArgs:0},handler(e){var{parser:t,funcName:n}=e,r=n;return 1===r.length&&(r=gr[r]),{type:"op",mode:t.mode,limits:!1,parentIsSupSub:!1,symbol:!0,name:r}},htmlBuilder:pr,mathmlBuilder:hr});var mr=(e,t)=>{var n,r,o,a,i=!1;if("supsub"===e.type?(n=e.sup,r=e.sub,o=Vt(e.base,"operatorname"),i=!0):o=Vt(e,"operatorname"),o.body.length>0){for(var s=o.body.map((e=>{var t=e.text;return"string"==typeof t?{type:"textord",mode:e.mode,text:t}:e})),l=mt(s,t.withFont("mathrm"),!0),c=0;c<l.length;c++){var u=l[c];u instanceof J&&(u.text=u.text.replace(/\u2212/,"-").replace(/\u2217/,"*"))}a=Je.makeSpan(["mop"],l,t)}else a=Je.makeSpan(["mop"],[],t);return i?ur(a,n,r,t,t.style,0,0):a};function yr(e,t,n){for(var r=mt(e,t,!1),o=t.sizeMultiplier/n.sizeMultiplier,a=0;a<r.length;a++){var i=r[a].classes.indexOf("sizing");i<0?Array.prototype.push.apply(r[a].classes,t.sizingClasses(n)):r[a].classes[i+1]==="reset-size"+t.size&&(r[a].classes[i+1]="reset-size"+n.size),r[a].height*=o,r[a].depth*=o}return Je.makeFragment(r)}st({type:"operatorname",names:["\\operatorname@","\\operatornamewithlimits"],props:{numArgs:1},handler:(e,t)=>{var{parser:n,funcName:r}=e,o=t[0];return{type:"operatorname",mode:n.mode,body:ut(o),alwaysHandleSupSub:"\\operatornamewithlimits"===r,limits:!1,parentIsSupSub:!1}},htmlBuilder:mr,mathmlBuilder:(e,t)=>{for(var n=Rt(e.body,t.withFont("mathrm")),r=!0,o=0;o<n.length;o++){var a=n[o];if(a instanceof Tt.SpaceNode);else if(a instanceof Tt.MathNode)switch(a.type){case"mi":case"mn":case"ms":case"mspace":case"mtext":break;case"mo":var i=a.children[0];1===a.children.length&&i instanceof Tt.TextNode?i.text=i.text.replace(/\u2212/,"-").replace(/\u2217/,"*"):r=!1;break;default:r=!1}else r=!1}if(r){var s=n.map((e=>e.toText())).join("");n=[new Tt.TextNode(s)]}var l=new Tt.MathNode("mi",n);l.setAttribute("mathvariant","normal");var c=new Tt.MathNode("mo",[Mt("\u2061","text")]);return e.parentIsSupSub?new Tt.MathNode("mrow",[l,c]):Tt.newDocumentFragment([l,c])}}),qn("\\operatorname","\\@ifstar\\operatornamewithlimits\\operatorname@"),lt({type:"ordgroup",htmlBuilder:(e,t)=>e.semisimple?Je.makeFragment(mt(e.body,t,!1)):Je.makeSpan(["mord"],mt(e.body,t,!0),t),mathmlBuilder:(e,t)=>jt(e.body,t,!0)}),st({type:"overline",names:["\\overline"],props:{numArgs:1},handler(e,t){var{parser:n}=e,r=t[0];return{type:"overline",mode:n.mode,body:r}},htmlBuilder(e,t){var n=St(e.body,t.havingCrampedStyle()),r=Je.makeLineSpan("overline-line",t),o=t.fontMetrics().defaultRuleThickness,a=Je.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n},{type:"kern",size:3*o},{type:"elem",elem:r},{type:"kern",size:o}]},t);return Je.makeSpan(["mord","overline"],[a],t)},mathmlBuilder(e,t){var n=new Tt.MathNode("mo",[new Tt.TextNode("\u203e")]);n.setAttribute("stretchy","true");var r=new Tt.MathNode("mover",[Bt(e.body,t),n]);return r.setAttribute("accent","true"),r}}),st({type:"phantom",names:["\\phantom"],props:{numArgs:1,allowedInText:!0},handler:(e,t)=>{var{parser:n}=e,r=t[0];return{type:"phantom",mode:n.mode,body:ut(r)}},htmlBuilder:(e,t)=>{var n=mt(e.body,t.withPhantom(),!1);return Je.makeFragment(n)},mathmlBuilder:(e,t)=>{var n=Rt(e.body,t);return new Tt.MathNode("mphantom",n)}}),st({type:"hphantom",names:["\\hphantom"],props:{numArgs:1,allowedInText:!0},handler:(e,t)=>{var{parser:n}=e,r=t[0];return{type:"hphantom",mode:n.mode,body:r}},htmlBuilder:(e,t)=>{var n=Je.makeSpan([],[St(e.body,t.withPhantom())]);if(n.height=0,n.depth=0,n.children)for(var r=0;r<n.children.length;r++)n.children[r].height=0,n.children[r].depth=0;return n=Je.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n}]},t),Je.makeSpan(["mord"],[n],t)},mathmlBuilder:(e,t)=>{var n=Rt(ut(e.body),t),r=new Tt.MathNode("mphantom",n),o=new Tt.MathNode("mpadded",[r]);return o.setAttribute("height","0px"),o.setAttribute("depth","0px"),o}}),st({type:"vphantom",names:["\\vphantom"],props:{numArgs:1,allowedInText:!0},handler:(e,t)=>{var{parser:n}=e,r=t[0];return{type:"vphantom",mode:n.mode,body:r}},htmlBuilder:(e,t)=>{var n=Je.makeSpan(["inner"],[St(e.body,t.withPhantom())]),r=Je.makeSpan(["fix"],[]);return Je.makeSpan(["mord","rlap"],[n,r],t)},mathmlBuilder:(e,t)=>{var n=Rt(ut(e.body),t),r=new Tt.MathNode("mphantom",n),o=new Tt.MathNode("mpadded",[r]);return o.setAttribute("width","0px"),o}}),st({type:"raisebox",names:["\\raisebox"],props:{numArgs:2,argTypes:["size","hbox"],allowedInText:!0},handler(e,t){var{parser:n}=e,r=Vt(t[0],"size").value,o=t[1];return{type:"raisebox",mode:n.mode,dy:r,body:o}},htmlBuilder(e,t){var n=St(e.body,t),r=$(e.dy,t);return Je.makeVList({positionType:"shift",positionData:-r,children:[{type:"elem",elem:n}]},t)},mathmlBuilder(e,t){var n=new Tt.MathNode("mpadded",[Bt(e.body,t)]),r=e.dy.number+e.dy.unit;return n.setAttribute("voffset",r),n}}),st({type:"internal",names:["\\relax"],props:{numArgs:0,allowedInText:!0,allowedInArgument:!0},handler(e){var{parser:t}=e;return{type:"internal",mode:t.mode}}}),st({type:"rule",names:["\\rule"],props:{numArgs:2,numOptionalArgs:1,allowedInText:!0,allowedInMath:!0,argTypes:["size","size","size"]},handler(e,t,n){var{parser:r}=e,o=n[0],a=Vt(t[0],"size"),i=Vt(t[1],"size");return{type:"rule",mode:r.mode,shift:o&&Vt(o,"size").value,width:a.value,height:i.value}},htmlBuilder(e,t){var n=Je.makeSpan(["mord","rule"],[],t),r=$(e.width,t),o=$(e.height,t),a=e.shift?$(e.shift,t):0;return n.style.borderRightWidth=q(r),n.style.borderTopWidth=q(o),n.style.bottom=q(a),n.width=r,n.height=o+a,n.depth=-a,n.maxFontSize=1.125*o*t.sizeMultiplier,n},mathmlBuilder(e,t){var n=$(e.width,t),r=$(e.height,t),o=e.shift?$(e.shift,t):0,a=t.color&&t.getColor()||"black",i=new Tt.MathNode("mspace");i.setAttribute("mathbackground",a),i.setAttribute("width",q(n)),i.setAttribute("height",q(r));var s=new Tt.MathNode("mpadded",[i]);return o>=0?s.setAttribute("height",q(o)):(s.setAttribute("height",q(o)),s.setAttribute("depth",q(-o))),s.setAttribute("voffset",q(o)),s}});var vr=["\\tiny","\\sixptsize","\\scriptsize","\\footnotesize","\\small","\\normalsize","\\large","\\Large","\\LARGE","\\huge","\\Huge"];st({type:"sizing",names:vr,props:{numArgs:0,allowedInText:!0},handler:(e,t)=>{var{breakOnTokenText:n,funcName:r,parser:o}=e,a=o.parseExpression(!1,n);return{type:"sizing",mode:o.mode,size:vr.indexOf(r)+1,body:a}},htmlBuilder:(e,t)=>{var n=t.havingSize(e.size);return yr(e.body,n,t)},mathmlBuilder:(e,t)=>{var n=t.havingSize(e.size),r=Rt(e.body,n),o=new Tt.MathNode("mstyle",r);return o.setAttribute("mathsize",q(n.sizeMultiplier)),o}}),st({type:"smash",names:["\\smash"],props:{numArgs:1,numOptionalArgs:1,allowedInText:!0},handler:(e,t,n)=>{var{parser:r}=e,o=!1,a=!1,i=n[0]&&Vt(n[0],"ordgroup");if(i)for(var s="",l=0;l<i.body.length;++l){if("t"===(s=i.body[l].text))o=!0;else{if("b"!==s){o=!1,a=!1;break}a=!0}}else o=!0,a=!0;var c=t[0];return{type:"smash",mode:r.mode,body:c,smashHeight:o,smashDepth:a}},htmlBuilder:(e,t)=>{var n=Je.makeSpan([],[St(e.body,t)]);if(!e.smashHeight&&!e.smashDepth)return n;if(e.smashHeight&&(n.height=0,n.children))for(var r=0;r<n.children.length;r++)n.children[r].height=0;if(e.smashDepth&&(n.depth=0,n.children))for(var o=0;o<n.children.length;o++)n.children[o].depth=0;var a=Je.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n}]},t);return Je.makeSpan(["mord"],[a],t)},mathmlBuilder:(e,t)=>{var n=new Tt.MathNode("mpadded",[Bt(e.body,t)]);return e.smashHeight&&n.setAttribute("height","0px"),e.smashDepth&&n.setAttribute("depth","0px"),n}}),st({type:"sqrt",names:["\\sqrt"],props:{numArgs:1,numOptionalArgs:1},handler(e,t,n){var{parser:r}=e,o=n[0],a=t[0];return{type:"sqrt",mode:r.mode,body:a,index:o}},htmlBuilder(e,t){var n=St(e.body,t.havingCrampedStyle());0===n.height&&(n.height=t.fontMetrics().xHeight),n=Je.wrapFragment(n,t);var r=t.fontMetrics().defaultRuleThickness,o=r;t.style.id<S.TEXT.id&&(o=t.fontMetrics().xHeight);var a=r+o/4,i=n.height+n.depth+a+r,{span:s,ruleWidth:l,advanceWidth:c}=_n.sqrtImage(i,t),u=s.height-l;u>n.height+n.depth+a&&(a=(a+u-n.height-n.depth)/2);var d=s.height-n.height-a-l;n.style.paddingLeft=q(c);var p=Je.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n,wrapperClasses:["svg-align"]},{type:"kern",size:-(n.height+d)},{type:"elem",elem:s},{type:"kern",size:l}]},t);if(e.index){var h=t.havingStyle(S.SCRIPTSCRIPT),f=St(e.index,h,t),g=.6*(p.height-p.depth),m=Je.makeVList({positionType:"shift",positionData:-g,children:[{type:"elem",elem:f}]},t),y=Je.makeSpan(["root"],[m]);return Je.makeSpan(["mord","sqrt"],[y,p],t)}return Je.makeSpan(["mord","sqrt"],[p],t)},mathmlBuilder(e,t){var{body:n,index:r}=e;return r?new Tt.MathNode("mroot",[Bt(n,t),Bt(r,t)]):new Tt.MathNode("msqrt",[Bt(n,t)])}});var br={display:S.DISPLAY,text:S.TEXT,script:S.SCRIPT,scriptscript:S.SCRIPTSCRIPT};st({type:"styling",names:["\\displaystyle","\\textstyle","\\scriptstyle","\\scriptscriptstyle"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(e,t){var{breakOnTokenText:n,funcName:r,parser:o}=e,a=o.parseExpression(!0,n),i=r.slice(1,r.length-5);return{type:"styling",mode:o.mode,style:i,body:a}},htmlBuilder(e,t){var n=br[e.style],r=t.havingStyle(n).withFont("");return yr(e.body,r,t)},mathmlBuilder(e,t){var n=br[e.style],r=t.havingStyle(n),o=Rt(e.body,r),a=new Tt.MathNode("mstyle",o),i={display:["0","true"],text:["0","false"],script:["1","false"],scriptscript:["2","false"]}[e.style];return a.setAttribute("scriptlevel",i[0]),a.setAttribute("displaystyle",i[1]),a}});lt({type:"supsub",htmlBuilder(e,t){var n=function(e,t){var n=e.base;return n?"op"===n.type?n.limits&&(t.style.size===S.DISPLAY.size||n.alwaysHandleSupSub)?pr:null:"operatorname"===n.type?n.alwaysHandleSupSub&&(t.style.size===S.DISPLAY.size||n.limits)?mr:null:"accent"===n.type?u.isCharacterBox(n.base)?Gt:null:"horizBrace"===n.type&&!e.sub===n.isOver?sr:null:null}(e,t);if(n)return n(e,t);var r,o,a,{base:i,sup:s,sub:l}=e,c=St(i,t),d=t.fontMetrics(),p=0,h=0,f=i&&u.isCharacterBox(i);if(s){var g=t.havingStyle(t.style.sup());r=St(s,g,t),f||(p=c.height-g.fontMetrics().supDrop*g.sizeMultiplier/t.sizeMultiplier)}if(l){var m=t.havingStyle(t.style.sub());o=St(l,m,t),f||(h=c.depth+m.fontMetrics().subDrop*m.sizeMultiplier/t.sizeMultiplier)}a=t.style===S.DISPLAY?d.sup1:t.style.cramped?d.sup3:d.sup2;var y,v=t.sizeMultiplier,b=q(.5/d.ptPerEm/v),x=null;if(o){var w=e.base&&"op"===e.base.type&&e.base.name&&("\\oiint"===e.base.name||"\\oiiint"===e.base.name);(c instanceof J||w)&&(x=q(-c.italic))}if(r&&o){p=Math.max(p,a,r.depth+.25*d.xHeight),h=Math.max(h,d.sub2);var k=4*d.defaultRuleThickness;if(p-r.depth-(o.height-h)<k){h=k-(p-r.depth)+o.height;var C=.8*d.xHeight-(p-r.depth);C>0&&(p+=C,h-=C)}var E=[{type:"elem",elem:o,shift:h,marginRight:b,marginLeft:x},{type:"elem",elem:r,shift:-p,marginRight:b}];y=Je.makeVList({positionType:"individualShift",children:E},t)}else if(o){h=Math.max(h,d.sub1,o.height-.8*d.xHeight);var A=[{type:"elem",elem:o,marginLeft:x,marginRight:b}];y=Je.makeVList({positionType:"shift",positionData:h,children:A},t)}else{if(!r)throw new Error("supsub must have either sup or sub.");p=Math.max(p,a,r.depth+.25*d.xHeight),y=Je.makeVList({positionType:"shift",positionData:-p,children:[{type:"elem",elem:r,marginRight:b}]},t)}var I=xt(c,"right")||"mord";return Je.makeSpan([I],[c,Je.makeSpan(["msupsub"],[y])],t)},mathmlBuilder(e,t){var n,r=!1;e.base&&"horizBrace"===e.base.type&&!!e.sup===e.base.isOver&&(r=!0,n=e.base.isOver),!e.base||"op"!==e.base.type&&"operatorname"!==e.base.type||(e.base.parentIsSupSub=!0);var o,a=[Bt(e.base,t)];if(e.sub&&a.push(Bt(e.sub,t)),e.sup&&a.push(Bt(e.sup,t)),r)o=n?"mover":"munder";else if(e.sub)if(e.sup){var i=e.base;o=i&&"op"===i.type&&i.limits&&t.style===S.DISPLAY||i&&"operatorname"===i.type&&i.alwaysHandleSupSub&&(t.style===S.DISPLAY||i.limits)?"munderover":"msubsup"}else{var s=e.base;o=s&&"op"===s.type&&s.limits&&(t.style===S.DISPLAY||s.alwaysHandleSupSub)||s&&"operatorname"===s.type&&s.alwaysHandleSupSub&&(s.limits||t.style===S.DISPLAY)?"munder":"msub"}else{var l=e.base;o=l&&"op"===l.type&&l.limits&&(t.style===S.DISPLAY||l.alwaysHandleSupSub)||l&&"operatorname"===l.type&&l.alwaysHandleSupSub&&(l.limits||t.style===S.DISPLAY)?"mover":"msup"}return new Tt.MathNode(o,a)}}),lt({type:"atom",htmlBuilder:(e,t)=>Je.mathsym(e.text,e.mode,t,["m"+e.family]),mathmlBuilder(e,t){var n=new Tt.MathNode("mo",[Mt(e.text,e.mode)]);if("bin"===e.family){var r=zt(e,t);"bold-italic"===r&&n.setAttribute("mathvariant",r)}else"punct"===e.family?n.setAttribute("separator","true"):"open"!==e.family&&"close"!==e.family||n.setAttribute("stretchy","false");return n}});var xr={mi:"italic",mn:"normal",mtext:"normal"};lt({type:"mathord",htmlBuilder:(e,t)=>Je.makeOrd(e,t,"mathord"),mathmlBuilder(e,t){var n=new Tt.MathNode("mi",[Mt(e.text,e.mode,t)]),r=zt(e,t)||"italic";return r!==xr[n.type]&&n.setAttribute("mathvariant",r),n}}),lt({type:"textord",htmlBuilder:(e,t)=>Je.makeOrd(e,t,"textord"),mathmlBuilder(e,t){var n,r=Mt(e.text,e.mode,t),o=zt(e,t)||"normal";return n="text"===e.mode?new Tt.MathNode("mtext",[r]):/[0-9]/.test(e.text)?new Tt.MathNode("mn",[r]):"\\prime"===e.text?new Tt.MathNode("mo",[r]):new Tt.MathNode("mi",[r]),o!==xr[n.type]&&n.setAttribute("mathvariant",o),n}});var wr={"\\nobreak":"nobreak","\\allowbreak":"allowbreak"},Sr={" ":{},"\\ ":{},"~":{className:"nobreak"},"\\space":{},"\\nobreakspace":{className:"nobreak"}};lt({type:"spacing",htmlBuilder(e,t){if(Sr.hasOwnProperty(e.text)){var n=Sr[e.text].className||"";if("text"===e.mode){var r=Je.makeOrd(e,t,"textord");return r.classes.push(n),r}return Je.makeSpan(["mspace",n],[Je.mathsym(e.text,e.mode,t)],t)}if(wr.hasOwnProperty(e.text))return Je.makeSpan(["mspace",wr[e.text]],[],t);throw new a('Unknown type of space "'+e.text+'"')},mathmlBuilder(e,t){if(!Sr.hasOwnProperty(e.text)){if(wr.hasOwnProperty(e.text))return new Tt.MathNode("mspace");throw new a('Unknown type of space "'+e.text+'"')}return new Tt.MathNode("mtext",[new Tt.TextNode("\xa0")])}});var kr=()=>{var e=new Tt.MathNode("mtd",[]);return e.setAttribute("width","50%"),e};lt({type:"tag",mathmlBuilder(e,t){var n=new Tt.MathNode("mtable",[new Tt.MathNode("mtr",[kr(),new Tt.MathNode("mtd",[jt(e.body,t)]),kr(),new Tt.MathNode("mtd",[jt(e.tag,t)])])]);return n.setAttribute("width","100%"),n}});var Cr={"\\text":void 0,"\\textrm":"textrm","\\textsf":"textsf","\\texttt":"texttt","\\textnormal":"textrm"},Er={"\\textbf":"textbf","\\textmd":"textmd"},Ar={"\\textit":"textit","\\textup":"textup"},Ir=(e,t)=>{var n=e.font;return n?Cr[n]?t.withTextFontFamily(Cr[n]):Er[n]?t.withTextFontWeight(Er[n]):"\\emph"===n?"textit"===t.fontShape?t.withTextFontShape("textup"):t.withTextFontShape("textit"):t.withTextFontShape(Ar[n]):t};st({type:"text",names:["\\text","\\textrm","\\textsf","\\texttt","\\textnormal","\\textbf","\\textmd","\\textit","\\textup","\\emph"],props:{numArgs:1,argTypes:["text"],allowedInArgument:!0,allowedInText:!0},handler(e,t){var{parser:n,funcName:r}=e,o=t[0];return{type:"text",mode:n.mode,body:ut(o),font:r}},htmlBuilder(e,t){var n=Ir(e,t),r=mt(e.body,n,!0);return Je.makeSpan(["mord","text"],r,n)},mathmlBuilder(e,t){var n=Ir(e,t);return jt(e.body,n)}}),st({type:"underline",names:["\\underline"],props:{numArgs:1,allowedInText:!0},handler(e,t){var{parser:n}=e;return{type:"underline",mode:n.mode,body:t[0]}},htmlBuilder(e,t){var n=St(e.body,t),r=Je.makeLineSpan("underline-line",t),o=t.fontMetrics().defaultRuleThickness,a=Je.makeVList({positionType:"top",positionData:n.height,children:[{type:"kern",size:o},{type:"elem",elem:r},{type:"kern",size:3*o},{type:"elem",elem:n}]},t);return Je.makeSpan(["mord","underline"],[a],t)},mathmlBuilder(e,t){var n=new Tt.MathNode("mo",[new Tt.TextNode("\u203e")]);n.setAttribute("stretchy","true");var r=new Tt.MathNode("munder",[Bt(e.body,t),n]);return r.setAttribute("accentunder","true"),r}}),st({type:"vcenter",names:["\\vcenter"],props:{numArgs:1,argTypes:["original"],allowedInText:!1},handler(e,t){var{parser:n}=e;return{type:"vcenter",mode:n.mode,body:t[0]}},htmlBuilder(e,t){var n=St(e.body,t),r=t.fontMetrics().axisHeight,o=.5*(n.height-r-(n.depth+r));return Je.makeVList({positionType:"shift",positionData:o,children:[{type:"elem",elem:n}]},t)},mathmlBuilder:(e,t)=>new Tt.MathNode("mpadded",[Bt(e.body,t)],["vcenter"])}),st({type:"verb",names:["\\verb"],props:{numArgs:0,allowedInText:!0},handler(e,t,n){throw new a("\\verb ended by end of line instead of matching delimiter")},htmlBuilder(e,t){for(var n=Tr(e),r=[],o=t.havingStyle(t.style.text()),a=0;a<n.length;a++){var i=n[a];"~"===i&&(i="\\textasciitilde"),r.push(Je.makeSymbol(i,"Typewriter-Regular",e.mode,o,["mord","texttt"]))}return Je.makeSpan(["mord","text"].concat(o.sizingClasses(t)),Je.tryCombineChars(r),o)},mathmlBuilder(e,t){var n=new Tt.TextNode(Tr(e)),r=new Tt.MathNode("mtext",[n]);return r.setAttribute("mathvariant","monospace"),r}});var Tr=e=>e.body.replace(/ /g,e.star?"\u2423":"\xa0"),Mr=ot,Fr="[ \r\n\t]",zr="(\\\\[a-zA-Z@]+)"+Fr+"*",_r="[\u0300-\u036f]",Rr=new RegExp(_r+"+$"),jr="("+Fr+"+)|\\\\(\n|[ \r\t]+\n?)[ \r\t]*|([!-\\[\\]-\u2027\u202a-\ud7ff\uf900-\uffff]"+_r+"*|[\ud800-\udbff][\udc00-\udfff]"+_r+"*|\\\\verb\\*([^]).*?\\4|\\\\verb([^*a-zA-Z]).*?\\5|"+zr+"|\\\\[^\ud800-\udfff])";class Br{constructor(e,t){this.input=void 0,this.settings=void 0,this.tokenRegex=void 0,this.catcodes=void 0,this.input=e,this.settings=t,this.tokenRegex=new RegExp(jr,"g"),this.catcodes={"%":14,"~":13}}setCatcode(e,t){this.catcodes[e]=t}lex(){var e=this.input,t=this.tokenRegex.lastIndex;if(t===e.length)return new o("EOF",new r(this,t,t));var n=this.tokenRegex.exec(e);if(null===n||n.index!==t)throw new a("Unexpected character: '"+e[t]+"'",new o(e[t],new r(this,t,t+1)));var i=n[6]||n[3]||(n[2]?"\\ ":" ");if(14===this.catcodes[i]){var s=e.indexOf("\n",this.tokenRegex.lastIndex);return-1===s?(this.tokenRegex.lastIndex=e.length,this.settings.reportNonstrict("commentAtEnd","% comment has no terminating newline; LaTeX would fail because of commenting the end of math mode (e.g. $)")):this.tokenRegex.lastIndex=s+1,this.lex()}return new o(i,new r(this,t,this.tokenRegex.lastIndex))}}class Or{constructor(e,t){void 0===e&&(e={}),void 0===t&&(t={}),this.current=void 0,this.builtins=void 0,this.undefStack=void 0,this.current=t,this.builtins=e,this.undefStack=[]}beginGroup(){this.undefStack.push({})}endGroup(){if(0===this.undefStack.length)throw new a("Unbalanced namespace destruction: attempt to pop global namespace; please report this as a bug");var e=this.undefStack.pop();for(var t in e)e.hasOwnProperty(t)&&(null==e[t]?delete this.current[t]:this.current[t]=e[t])}endGroups(){for(;this.undefStack.length>0;)this.endGroup()}has(e){return this.current.hasOwnProperty(e)||this.builtins.hasOwnProperty(e)}get(e){return this.current.hasOwnProperty(e)?this.current[e]:this.builtins[e]}set(e,t,n){if(void 0===n&&(n=!1),n){for(var r=0;r<this.undefStack.length;r++)delete this.undefStack[r][e];this.undefStack.length>0&&(this.undefStack[this.undefStack.length-1][e]=t)}else{var o=this.undefStack[this.undefStack.length-1];o&&!o.hasOwnProperty(e)&&(o[e]=this.current[e])}null==t?delete this.current[e]:this.current[e]=t}}var Nr=$n;qn("\\noexpand",(function(e){var t=e.popToken();return e.isExpandable(t.text)&&(t.noexpand=!0,t.treatAsRelax=!0),{tokens:[t],numArgs:0}})),qn("\\expandafter",(function(e){var t=e.popToken();return e.expandOnce(!0),{tokens:[t],numArgs:0}})),qn("\\@firstoftwo",(function(e){return{tokens:e.consumeArgs(2)[0],numArgs:0}})),qn("\\@secondoftwo",(function(e){return{tokens:e.consumeArgs(2)[1],numArgs:0}})),qn("\\@ifnextchar",(function(e){var t=e.consumeArgs(3);e.consumeSpaces();var n=e.future();return 1===t[0].length&&t[0][0].text===n.text?{tokens:t[1],numArgs:0}:{tokens:t[2],numArgs:0}})),qn("\\@ifstar","\\@ifnextchar *{\\@firstoftwo{#1}}"),qn("\\TextOrMath",(function(e){var t=e.consumeArgs(2);return"text"===e.mode?{tokens:t[0],numArgs:0}:{tokens:t[1],numArgs:0}}));var Pr={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15};qn("\\char",(function(e){var t,n=e.popToken(),r="";if("'"===n.text)t=8,n=e.popToken();else if('"'===n.text)t=16,n=e.popToken();else if("`"===n.text)if("\\"===(n=e.popToken()).text[0])r=n.text.charCodeAt(1);else{if("EOF"===n.text)throw new a("\\char` missing argument");r=n.text.charCodeAt(0)}else t=10;if(t){if(null==(r=Pr[n.text])||r>=t)throw new a("Invalid base-"+t+" digit "+n.text);for(var o;null!=(o=Pr[e.future().text])&&o<t;)r*=t,r+=o,e.popToken()}return"\\@char{"+r+"}"}));var Lr=(e,t,n,r)=>{var o=e.consumeArg().tokens;if(1!==o.length)throw new a("\\newcommand's first argument must be a macro name");var i=o[0].text,s=e.isDefined(i);if(s&&!t)throw new a("\\newcommand{"+i+"} attempting to redefine "+i+"; use \\renewcommand");if(!s&&!n)throw new a("\\renewcommand{"+i+"} when command "+i+" does not yet exist; use \\newcommand");var l=0;if(1===(o=e.consumeArg().tokens).length&&"["===o[0].text){for(var c="",u=e.expandNextToken();"]"!==u.text&&"EOF"!==u.text;)c+=u.text,u=e.expandNextToken();if(!c.match(/^\s*[0-9]+\s*$/))throw new a("Invalid number of arguments: "+c);l=parseInt(c),o=e.consumeArg().tokens}return s&&r||e.macros.set(i,{tokens:o,numArgs:l}),""};qn("\\newcommand",(e=>Lr(e,!1,!0,!1))),qn("\\renewcommand",(e=>Lr(e,!0,!1,!1))),qn("\\providecommand",(e=>Lr(e,!0,!0,!0))),qn("\\message",(e=>{var t=e.consumeArgs(1)[0];return console.log(t.reverse().map((e=>e.text)).join("")),""})),qn("\\errmessage",(e=>{var t=e.consumeArgs(1)[0];return console.error(t.reverse().map((e=>e.text)).join("")),""})),qn("\\show",(e=>{var t=e.popToken(),n=t.text;return console.log(t,e.macros.get(n),Mr[n],ae.math[n],ae.text[n]),""})),qn("\\bgroup","{"),qn("\\egroup","}"),qn("~","\\nobreakspace"),qn("\\lq","`"),qn("\\rq","'"),qn("\\aa","\\r a"),qn("\\AA","\\r A"),qn("\\textcopyright","\\html@mathml{\\textcircled{c}}{\\char`\xa9}"),qn("\\copyright","\\TextOrMath{\\textcopyright}{\\text{\\textcopyright}}"),qn("\\textregistered","\\html@mathml{\\textcircled{\\scriptsize R}}{\\char`\xae}"),qn("\u212c","\\mathscr{B}"),qn("\u2130","\\mathscr{E}"),qn("\u2131","\\mathscr{F}"),qn("\u210b","\\mathscr{H}"),qn("\u2110","\\mathscr{I}"),qn("\u2112","\\mathscr{L}"),qn("\u2133","\\mathscr{M}"),qn("\u211b","\\mathscr{R}"),qn("\u212d","\\mathfrak{C}"),qn("\u210c","\\mathfrak{H}"),qn("\u2128","\\mathfrak{Z}"),qn("\\Bbbk","\\Bbb{k}"),qn("\xb7","\\cdotp"),qn("\\llap","\\mathllap{\\textrm{#1}}"),qn("\\rlap","\\mathrlap{\\textrm{#1}}"),qn("\\clap","\\mathclap{\\textrm{#1}}"),qn("\\mathstrut","\\vphantom{(}"),qn("\\underbar","\\underline{\\text{#1}}"),qn("\\not",'\\html@mathml{\\mathrel{\\mathrlap\\@not}}{\\char"338}'),qn("\\neq","\\html@mathml{\\mathrel{\\not=}}{\\mathrel{\\char`\u2260}}"),qn("\\ne","\\neq"),qn("\u2260","\\neq"),qn("\\notin","\\html@mathml{\\mathrel{{\\in}\\mathllap{/\\mskip1mu}}}{\\mathrel{\\char`\u2209}}"),qn("\u2209","\\notin"),qn("\u2258","\\html@mathml{\\mathrel{=\\kern{-1em}\\raisebox{0.4em}{$\\scriptsize\\frown$}}}{\\mathrel{\\char`\u2258}}"),qn("\u2259","\\html@mathml{\\stackrel{\\tiny\\wedge}{=}}{\\mathrel{\\char`\u2258}}"),qn("\u225a","\\html@mathml{\\stackrel{\\tiny\\vee}{=}}{\\mathrel{\\char`\u225a}}"),qn("\u225b","\\html@mathml{\\stackrel{\\scriptsize\\star}{=}}{\\mathrel{\\char`\u225b}}"),qn("\u225d","\\html@mathml{\\stackrel{\\tiny\\mathrm{def}}{=}}{\\mathrel{\\char`\u225d}}"),qn("\u225e","\\html@mathml{\\stackrel{\\tiny\\mathrm{m}}{=}}{\\mathrel{\\char`\u225e}}"),qn("\u225f","\\html@mathml{\\stackrel{\\tiny?}{=}}{\\mathrel{\\char`\u225f}}"),qn("\u27c2","\\perp"),qn("\u203c","\\mathclose{!\\mkern-0.8mu!}"),qn("\u220c","\\notni"),qn("\u231c","\\ulcorner"),qn("\u231d","\\urcorner"),qn("\u231e","\\llcorner"),qn("\u231f","\\lrcorner"),qn("\xa9","\\copyright"),qn("\xae","\\textregistered"),qn("\ufe0f","\\textregistered"),qn("\\ulcorner",'\\html@mathml{\\@ulcorner}{\\mathop{\\char"231c}}'),qn("\\urcorner",'\\html@mathml{\\@urcorner}{\\mathop{\\char"231d}}'),qn("\\llcorner",'\\html@mathml{\\@llcorner}{\\mathop{\\char"231e}}'),qn("\\lrcorner",'\\html@mathml{\\@lrcorner}{\\mathop{\\char"231f}}'),qn("\\vdots","{\\varvdots\\rule{0pt}{15pt}}"),qn("\u22ee","\\vdots"),qn("\\varGamma","\\mathit{\\Gamma}"),qn("\\varDelta","\\mathit{\\Delta}"),qn("\\varTheta","\\mathit{\\Theta}"),qn("\\varLambda","\\mathit{\\Lambda}"),qn("\\varXi","\\mathit{\\Xi}"),qn("\\varPi","\\mathit{\\Pi}"),qn("\\varSigma","\\mathit{\\Sigma}"),qn("\\varUpsilon","\\mathit{\\Upsilon}"),qn("\\varPhi","\\mathit{\\Phi}"),qn("\\varPsi","\\mathit{\\Psi}"),qn("\\varOmega","\\mathit{\\Omega}"),qn("\\substack","\\begin{subarray}{c}#1\\end{subarray}"),qn("\\colon","\\nobreak\\mskip2mu\\mathpunct{}\\mathchoice{\\mkern-3mu}{\\mkern-3mu}{}{}{:}\\mskip6mu\\relax"),qn("\\boxed","\\fbox{$\\displaystyle{#1}$}"),qn("\\iff","\\DOTSB\\;\\Longleftrightarrow\\;"),qn("\\implies","\\DOTSB\\;\\Longrightarrow\\;"),qn("\\impliedby","\\DOTSB\\;\\Longleftarrow\\;"),qn("\\dddot","{\\overset{\\raisebox{-0.1ex}{\\normalsize ...}}{#1}}"),qn("\\ddddot","{\\overset{\\raisebox{-0.1ex}{\\normalsize ....}}{#1}}");var Dr={",":"\\dotsc","\\not":"\\dotsb","+":"\\dotsb","=":"\\dotsb","<":"\\dotsb",">":"\\dotsb","-":"\\dotsb","*":"\\dotsb",":":"\\dotsb","\\DOTSB":"\\dotsb","\\coprod":"\\dotsb","\\bigvee":"\\dotsb","\\bigwedge":"\\dotsb","\\biguplus":"\\dotsb","\\bigcap":"\\dotsb","\\bigcup":"\\dotsb","\\prod":"\\dotsb","\\sum":"\\dotsb","\\bigotimes":"\\dotsb","\\bigoplus":"\\dotsb","\\bigodot":"\\dotsb","\\bigsqcup":"\\dotsb","\\And":"\\dotsb","\\longrightarrow":"\\dotsb","\\Longrightarrow":"\\dotsb","\\longleftarrow":"\\dotsb","\\Longleftarrow":"\\dotsb","\\longleftrightarrow":"\\dotsb","\\Longleftrightarrow":"\\dotsb","\\mapsto":"\\dotsb","\\longmapsto":"\\dotsb","\\hookrightarrow":"\\dotsb","\\doteq":"\\dotsb","\\mathbin":"\\dotsb","\\mathrel":"\\dotsb","\\relbar":"\\dotsb","\\Relbar":"\\dotsb","\\xrightarrow":"\\dotsb","\\xleftarrow":"\\dotsb","\\DOTSI":"\\dotsi","\\int":"\\dotsi","\\oint":"\\dotsi","\\iint":"\\dotsi","\\iiint":"\\dotsi","\\iiiint":"\\dotsi","\\idotsint":"\\dotsi","\\DOTSX":"\\dotsx"};qn("\\dots",(function(e){var t="\\dotso",n=e.expandAfterFuture().text;return n in Dr?t=Dr[n]:("\\not"===n.slice(0,4)||n in ae.math&&u.contains(["bin","rel"],ae.math[n].group))&&(t="\\dotsb"),t}));var $r={")":!0,"]":!0,"\\rbrack":!0,"\\}":!0,"\\rbrace":!0,"\\rangle":!0,"\\rceil":!0,"\\rfloor":!0,"\\rgroup":!0,"\\rmoustache":!0,"\\right":!0,"\\bigr":!0,"\\biggr":!0,"\\Bigr":!0,"\\Biggr":!0,$:!0,";":!0,".":!0,",":!0};qn("\\dotso",(function(e){return e.future().text in $r?"\\ldots\\,":"\\ldots"})),qn("\\dotsc",(function(e){var t=e.future().text;return t in $r&&","!==t?"\\ldots\\,":"\\ldots"})),qn("\\cdots",(function(e){return e.future().text in $r?"\\@cdots\\,":"\\@cdots"})),qn("\\dotsb","\\cdots"),qn("\\dotsm","\\cdots"),qn("\\dotsi","\\!\\cdots"),qn("\\dotsx","\\ldots\\,"),qn("\\DOTSI","\\relax"),qn("\\DOTSB","\\relax"),qn("\\DOTSX","\\relax"),qn("\\tmspace","\\TextOrMath{\\kern#1#3}{\\mskip#1#2}\\relax"),qn("\\,","\\tmspace+{3mu}{.1667em}"),qn("\\thinspace","\\,"),qn("\\>","\\mskip{4mu}"),qn("\\:","\\tmspace+{4mu}{.2222em}"),qn("\\medspace","\\:"),qn("\\;","\\tmspace+{5mu}{.2777em}"),qn("\\thickspace","\\;"),qn("\\!","\\tmspace-{3mu}{.1667em}"),qn("\\negthinspace","\\!"),qn("\\negmedspace","\\tmspace-{4mu}{.2222em}"),qn("\\negthickspace","\\tmspace-{5mu}{.277em}"),qn("\\enspace","\\kern.5em "),qn("\\enskip","\\hskip.5em\\relax"),qn("\\quad","\\hskip1em\\relax"),qn("\\qquad","\\hskip2em\\relax"),qn("\\tag","\\@ifstar\\tag@literal\\tag@paren"),qn("\\tag@paren","\\tag@literal{({#1})}"),qn("\\tag@literal",(e=>{if(e.macros.get("\\df@tag"))throw new a("Multiple \\tag");return"\\gdef\\df@tag{\\text{#1}}"})),qn("\\bmod","\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}\\mathbin{\\rm mod}\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}"),qn("\\pod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern8mu}{\\mkern8mu}{\\mkern8mu}(#1)"),qn("\\pmod","\\pod{{\\rm mod}\\mkern6mu#1}"),qn("\\mod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern12mu}{\\mkern12mu}{\\mkern12mu}{\\rm mod}\\,\\,#1"),qn("\\newline","\\\\\\relax"),qn("\\TeX","\\textrm{\\html@mathml{T\\kern-.1667em\\raisebox{-.5ex}{E}\\kern-.125emX}{TeX}}");var qr=q(M["Main-Regular"]["T".charCodeAt(0)][1]-.7*M["Main-Regular"]["A".charCodeAt(0)][1]);qn("\\LaTeX","\\textrm{\\html@mathml{L\\kern-.36em\\raisebox{"+qr+"}{\\scriptstyle A}\\kern-.15em\\TeX}{LaTeX}}"),qn("\\KaTeX","\\textrm{\\html@mathml{K\\kern-.17em\\raisebox{"+qr+"}{\\scriptstyle A}\\kern-.15em\\TeX}{KaTeX}}"),qn("\\hspace","\\@ifstar\\@hspacer\\@hspace"),qn("\\@hspace","\\hskip #1\\relax"),qn("\\@hspacer","\\rule{0pt}{0pt}\\hskip #1\\relax"),qn("\\ordinarycolon",":"),qn("\\vcentcolon","\\mathrel{\\mathop\\ordinarycolon}"),qn("\\dblcolon",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-.9mu}\\vcentcolon}}{\\mathop{\\char"2237}}'),qn("\\coloneqq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2254}}'),qn("\\Coloneqq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2237\\char"3d}}'),qn("\\coloneq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"3a\\char"2212}}'),qn("\\Coloneq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"2237\\char"2212}}'),qn("\\eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2255}}'),qn("\\Eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"3d\\char"2237}}'),qn("\\eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2239}}'),qn("\\Eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"2212\\char"2237}}'),qn("\\colonapprox",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"3a\\char"2248}}'),qn("\\Colonapprox",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"2237\\char"2248}}'),qn("\\colonsim",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"3a\\char"223c}}'),qn("\\Colonsim",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"2237\\char"223c}}'),qn("\u2237","\\dblcolon"),qn("\u2239","\\eqcolon"),qn("\u2254","\\coloneqq"),qn("\u2255","\\eqqcolon"),qn("\u2a74","\\Coloneqq"),qn("\\ratio","\\vcentcolon"),qn("\\coloncolon","\\dblcolon"),qn("\\colonequals","\\coloneqq"),qn("\\coloncolonequals","\\Coloneqq"),qn("\\equalscolon","\\eqqcolon"),qn("\\equalscoloncolon","\\Eqqcolon"),qn("\\colonminus","\\coloneq"),qn("\\coloncolonminus","\\Coloneq"),qn("\\minuscolon","\\eqcolon"),qn("\\minuscoloncolon","\\Eqcolon"),qn("\\coloncolonapprox","\\Colonapprox"),qn("\\coloncolonsim","\\Colonsim"),qn("\\simcolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\vcentcolon}"),qn("\\simcoloncolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\dblcolon}"),qn("\\approxcolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\vcentcolon}"),qn("\\approxcoloncolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\dblcolon}"),qn("\\notni","\\html@mathml{\\not\\ni}{\\mathrel{\\char`\u220c}}"),qn("\\limsup","\\DOTSB\\operatorname*{lim\\,sup}"),qn("\\liminf","\\DOTSB\\operatorname*{lim\\,inf}"),qn("\\injlim","\\DOTSB\\operatorname*{inj\\,lim}"),qn("\\projlim","\\DOTSB\\operatorname*{proj\\,lim}"),qn("\\varlimsup","\\DOTSB\\operatorname*{\\overline{lim}}"),qn("\\varliminf","\\DOTSB\\operatorname*{\\underline{lim}}"),qn("\\varinjlim","\\DOTSB\\operatorname*{\\underrightarrow{lim}}"),qn("\\varprojlim","\\DOTSB\\operatorname*{\\underleftarrow{lim}}"),qn("\\gvertneqq","\\html@mathml{\\@gvertneqq}{\u2269}"),qn("\\lvertneqq","\\html@mathml{\\@lvertneqq}{\u2268}"),qn("\\ngeqq","\\html@mathml{\\@ngeqq}{\u2271}"),qn("\\ngeqslant","\\html@mathml{\\@ngeqslant}{\u2271}"),qn("\\nleqq","\\html@mathml{\\@nleqq}{\u2270}"),qn("\\nleqslant","\\html@mathml{\\@nleqslant}{\u2270}"),qn("\\nshortmid","\\html@mathml{\\@nshortmid}{\u2224}"),qn("\\nshortparallel","\\html@mathml{\\@nshortparallel}{\u2226}"),qn("\\nsubseteqq","\\html@mathml{\\@nsubseteqq}{\u2288}"),qn("\\nsupseteqq","\\html@mathml{\\@nsupseteqq}{\u2289}"),qn("\\varsubsetneq","\\html@mathml{\\@varsubsetneq}{\u228a}"),qn("\\varsubsetneqq","\\html@mathml{\\@varsubsetneqq}{\u2acb}"),qn("\\varsupsetneq","\\html@mathml{\\@varsupsetneq}{\u228b}"),qn("\\varsupsetneqq","\\html@mathml{\\@varsupsetneqq}{\u2acc}"),qn("\\imath","\\html@mathml{\\@imath}{\u0131}"),qn("\\jmath","\\html@mathml{\\@jmath}{\u0237}"),qn("\\llbracket","\\html@mathml{\\mathopen{[\\mkern-3.2mu[}}{\\mathopen{\\char`\u27e6}}"),qn("\\rrbracket","\\html@mathml{\\mathclose{]\\mkern-3.2mu]}}{\\mathclose{\\char`\u27e7}}"),qn("\u27e6","\\llbracket"),qn("\u27e7","\\rrbracket"),qn("\\lBrace","\\html@mathml{\\mathopen{\\{\\mkern-3.2mu[}}{\\mathopen{\\char`\u2983}}"),qn("\\rBrace","\\html@mathml{\\mathclose{]\\mkern-3.2mu\\}}}{\\mathclose{\\char`\u2984}}"),qn("\u2983","\\lBrace"),qn("\u2984","\\rBrace"),qn("\\minuso","\\mathbin{\\html@mathml{{\\mathrlap{\\mathchoice{\\kern{0.145em}}{\\kern{0.145em}}{\\kern{0.1015em}}{\\kern{0.0725em}}\\circ}{-}}}{\\char`\u29b5}}"),qn("\u29b5","\\minuso"),qn("\\darr","\\downarrow"),qn("\\dArr","\\Downarrow"),qn("\\Darr","\\Downarrow"),qn("\\lang","\\langle"),qn("\\rang","\\rangle"),qn("\\uarr","\\uparrow"),qn("\\uArr","\\Uparrow"),qn("\\Uarr","\\Uparrow"),qn("\\N","\\mathbb{N}"),qn("\\R","\\mathbb{R}"),qn("\\Z","\\mathbb{Z}"),qn("\\alef","\\aleph"),qn("\\alefsym","\\aleph"),qn("\\Alpha","\\mathrm{A}"),qn("\\Beta","\\mathrm{B}"),qn("\\bull","\\bullet"),qn("\\Chi","\\mathrm{X}"),qn("\\clubs","\\clubsuit"),qn("\\cnums","\\mathbb{C}"),qn("\\Complex","\\mathbb{C}"),qn("\\Dagger","\\ddagger"),qn("\\diamonds","\\diamondsuit"),qn("\\empty","\\emptyset"),qn("\\Epsilon","\\mathrm{E}"),qn("\\Eta","\\mathrm{H}"),qn("\\exist","\\exists"),qn("\\harr","\\leftrightarrow"),qn("\\hArr","\\Leftrightarrow"),qn("\\Harr","\\Leftrightarrow"),qn("\\hearts","\\heartsuit"),qn("\\image","\\Im"),qn("\\infin","\\infty"),qn("\\Iota","\\mathrm{I}"),qn("\\isin","\\in"),qn("\\Kappa","\\mathrm{K}"),qn("\\larr","\\leftarrow"),qn("\\lArr","\\Leftarrow"),qn("\\Larr","\\Leftarrow"),qn("\\lrarr","\\leftrightarrow"),qn("\\lrArr","\\Leftrightarrow"),qn("\\Lrarr","\\Leftrightarrow"),qn("\\Mu","\\mathrm{M}"),qn("\\natnums","\\mathbb{N}"),qn("\\Nu","\\mathrm{N}"),qn("\\Omicron","\\mathrm{O}"),qn("\\plusmn","\\pm"),qn("\\rarr","\\rightarrow"),qn("\\rArr","\\Rightarrow"),qn("\\Rarr","\\Rightarrow"),qn("\\real","\\Re"),qn("\\reals","\\mathbb{R}"),qn("\\Reals","\\mathbb{R}"),qn("\\Rho","\\mathrm{P}"),qn("\\sdot","\\cdot"),qn("\\sect","\\S"),qn("\\spades","\\spadesuit"),qn("\\sub","\\subset"),qn("\\sube","\\subseteq"),qn("\\supe","\\supseteq"),qn("\\Tau","\\mathrm{T}"),qn("\\thetasym","\\vartheta"),qn("\\weierp","\\wp"),qn("\\Zeta","\\mathrm{Z}"),qn("\\argmin","\\DOTSB\\operatorname*{arg\\,min}"),qn("\\argmax","\\DOTSB\\operatorname*{arg\\,max}"),qn("\\plim","\\DOTSB\\mathop{\\operatorname{plim}}\\limits"),qn("\\bra","\\mathinner{\\langle{#1}|}"),qn("\\ket","\\mathinner{|{#1}\\rangle}"),qn("\\braket","\\mathinner{\\langle{#1}\\rangle}"),qn("\\Bra","\\left\\langle#1\\right|"),qn("\\Ket","\\left|#1\\right\\rangle");var Ur=e=>t=>{var n=t.consumeArg().tokens,r=t.consumeArg().tokens,o=t.consumeArg().tokens,a=t.consumeArg().tokens,i=t.macros.get("|"),s=t.macros.get("\\|");t.macros.beginGroup();var l=t=>n=>{e&&(n.macros.set("|",i),o.length&&n.macros.set("\\|",s));var a=t;!t&&o.length&&("|"===n.future().text&&(n.popToken(),a=!0));return{tokens:a?o:r,numArgs:0}};t.macros.set("|",l(!1)),o.length&&t.macros.set("\\|",l(!0));var c=t.consumeArg().tokens,u=t.expandTokens([...a,...c,...n]);return t.macros.endGroup(),{tokens:u.reverse(),numArgs:0}};qn("\\bra@ket",Ur(!1)),qn("\\bra@set",Ur(!0)),qn("\\Braket","\\bra@ket{\\left\\langle}{\\,\\middle\\vert\\,}{\\,\\middle\\vert\\,}{\\right\\rangle}"),qn("\\Set","\\bra@set{\\left\\{\\:}{\\;\\middle\\vert\\;}{\\;\\middle\\Vert\\;}{\\:\\right\\}}"),qn("\\set","\\bra@set{\\{\\,}{\\mid}{}{\\,\\}}"),qn("\\angln","{\\angl n}"),qn("\\blue","\\textcolor{##6495ed}{#1}"),qn("\\orange","\\textcolor{##ffa500}{#1}"),qn("\\pink","\\textcolor{##ff00af}{#1}"),qn("\\red","\\textcolor{##df0030}{#1}"),qn("\\green","\\textcolor{##28ae7b}{#1}"),qn("\\gray","\\textcolor{gray}{#1}"),qn("\\purple","\\textcolor{##9d38bd}{#1}"),qn("\\blueA","\\textcolor{##ccfaff}{#1}"),qn("\\blueB","\\textcolor{##80f6ff}{#1}"),qn("\\blueC","\\textcolor{##63d9ea}{#1}"),qn("\\blueD","\\textcolor{##11accd}{#1}"),qn("\\blueE","\\textcolor{##0c7f99}{#1}"),qn("\\tealA","\\textcolor{##94fff5}{#1}"),qn("\\tealB","\\textcolor{##26edd5}{#1}"),qn("\\tealC","\\textcolor{##01d1c1}{#1}"),qn("\\tealD","\\textcolor{##01a995}{#1}"),qn("\\tealE","\\textcolor{##208170}{#1}"),qn("\\greenA","\\textcolor{##b6ffb0}{#1}"),qn("\\greenB","\\textcolor{##8af281}{#1}"),qn("\\greenC","\\textcolor{##74cf70}{#1}"),qn("\\greenD","\\textcolor{##1fab54}{#1}"),qn("\\greenE","\\textcolor{##0d923f}{#1}"),qn("\\goldA","\\textcolor{##ffd0a9}{#1}"),qn("\\goldB","\\textcolor{##ffbb71}{#1}"),qn("\\goldC","\\textcolor{##ff9c39}{#1}"),qn("\\goldD","\\textcolor{##e07d10}{#1}"),qn("\\goldE","\\textcolor{##a75a05}{#1}"),qn("\\redA","\\textcolor{##fca9a9}{#1}"),qn("\\redB","\\textcolor{##ff8482}{#1}"),qn("\\redC","\\textcolor{##f9685d}{#1}"),qn("\\redD","\\textcolor{##e84d39}{#1}"),qn("\\redE","\\textcolor{##bc2612}{#1}"),qn("\\maroonA","\\textcolor{##ffbde0}{#1}"),qn("\\maroonB","\\textcolor{##ff92c6}{#1}"),qn("\\maroonC","\\textcolor{##ed5fa6}{#1}"),qn("\\maroonD","\\textcolor{##ca337c}{#1}"),qn("\\maroonE","\\textcolor{##9e034e}{#1}"),qn("\\purpleA","\\textcolor{##ddd7ff}{#1}"),qn("\\purpleB","\\textcolor{##c6b9fc}{#1}"),qn("\\purpleC","\\textcolor{##aa87ff}{#1}"),qn("\\purpleD","\\textcolor{##7854ab}{#1}"),qn("\\purpleE","\\textcolor{##543b78}{#1}"),qn("\\mintA","\\textcolor{##f5f9e8}{#1}"),qn("\\mintB","\\textcolor{##edf2df}{#1}"),qn("\\mintC","\\textcolor{##e0e5cc}{#1}"),qn("\\grayA","\\textcolor{##f6f7f7}{#1}"),qn("\\grayB","\\textcolor{##f0f1f2}{#1}"),qn("\\grayC","\\textcolor{##e3e5e6}{#1}"),qn("\\grayD","\\textcolor{##d6d8da}{#1}"),qn("\\grayE","\\textcolor{##babec2}{#1}"),qn("\\grayF","\\textcolor{##888d93}{#1}"),qn("\\grayG","\\textcolor{##626569}{#1}"),qn("\\grayH","\\textcolor{##3b3e40}{#1}"),qn("\\grayI","\\textcolor{##21242c}{#1}"),qn("\\kaBlue","\\textcolor{##314453}{#1}"),qn("\\kaGreen","\\textcolor{##71B307}{#1}");var Vr={"^":!0,_:!0,"\\limits":!0,"\\nolimits":!0};class Hr{constructor(e,t,n){this.settings=void 0,this.expansionCount=void 0,this.lexer=void 0,this.macros=void 0,this.stack=void 0,this.mode=void 0,this.settings=t,this.expansionCount=0,this.feed(e),this.macros=new Or(Nr,t.macros),this.mode=n,this.stack=[]}feed(e){this.lexer=new Br(e,this.settings)}switchMode(e){this.mode=e}beginGroup(){this.macros.beginGroup()}endGroup(){this.macros.endGroup()}endGroups(){this.macros.endGroups()}future(){return 0===this.stack.length&&this.pushToken(this.lexer.lex()),this.stack[this.stack.length-1]}popToken(){return this.future(),this.stack.pop()}pushToken(e){this.stack.push(e)}pushTokens(e){this.stack.push(...e)}scanArgument(e){var t,n,r;if(e){if(this.consumeSpaces(),"["!==this.future().text)return null;t=this.popToken(),({tokens:r,end:n}=this.consumeArg(["]"]))}else({tokens:r,start:t,end:n}=this.consumeArg());return this.pushToken(new o("EOF",n.loc)),this.pushTokens(r),t.range(n,"")}consumeSpaces(){for(;;){if(" "!==this.future().text)break;this.stack.pop()}}consumeArg(e){var t=[],n=e&&e.length>0;n||this.consumeSpaces();var r,o=this.future(),i=0,s=0;do{if(r=this.popToken(),t.push(r),"{"===r.text)++i;else if("}"===r.text){if(-1===--i)throw new a("Extra }",r)}else if("EOF"===r.text)throw new a("Unexpected end of input in a macro argument, expected '"+(e&&n?e[s]:"}")+"'",r);if(e&&n)if((0===i||1===i&&"{"===e[s])&&r.text===e[s]){if(++s===e.length){t.splice(-s,s);break}}else s=0}while(0!==i||n);return"{"===o.text&&"}"===t[t.length-1].text&&(t.pop(),t.shift()),t.reverse(),{tokens:t,start:o,end:r}}consumeArgs(e,t){if(t){if(t.length!==e+1)throw new a("The length of delimiters doesn't match the number of args!");for(var n=t[0],r=0;r<n.length;r++){var o=this.popToken();if(n[r]!==o.text)throw new a("Use of the macro doesn't match its definition",o)}}for(var i=[],s=0;s<e;s++)i.push(this.consumeArg(t&&t[s+1]).tokens);return i}countExpansion(e){if(this.expansionCount+=e,this.expansionCount>this.settings.maxExpand)throw new a("Too many expansions: infinite loop or need to increase maxExpand setting")}expandOnce(e){var t=this.popToken(),n=t.text,r=t.noexpand?null:this._getExpansion(n);if(null==r||e&&r.unexpandable){if(e&&null==r&&"\\"===n[0]&&!this.isDefined(n))throw new a("Undefined control sequence: "+n);return this.pushToken(t),!1}this.countExpansion(1);var o=r.tokens,i=this.consumeArgs(r.numArgs,r.delimiters);if(r.numArgs)for(var s=(o=o.slice()).length-1;s>=0;--s){var l=o[s];if("#"===l.text){if(0===s)throw new a("Incomplete placeholder at end of macro body",l);if("#"===(l=o[--s]).text)o.splice(s+1,1);else{if(!/^[1-9]$/.test(l.text))throw new a("Not a valid argument number",l);o.splice(s,2,...i[+l.text-1])}}}return this.pushTokens(o),o.length}expandAfterFuture(){return this.expandOnce(),this.future()}expandNextToken(){for(;;)if(!1===this.expandOnce()){var e=this.stack.pop();return e.treatAsRelax&&(e.text="\\relax"),e}throw new Error}expandMacro(e){return this.macros.has(e)?this.expandTokens([new o(e)]):void 0}expandTokens(e){var t=[],n=this.stack.length;for(this.pushTokens(e);this.stack.length>n;)if(!1===this.expandOnce(!0)){var r=this.stack.pop();r.treatAsRelax&&(r.noexpand=!1,r.treatAsRelax=!1),t.push(r)}return this.countExpansion(t.length),t}expandMacroAsText(e){var t=this.expandMacro(e);return t?t.map((e=>e.text)).join(""):t}_getExpansion(e){var t=this.macros.get(e);if(null==t)return t;if(1===e.length){var n=this.lexer.catcodes[e];if(null!=n&&13!==n)return}var r="function"==typeof t?t(this):t;if("string"==typeof r){var o=0;if(-1!==r.indexOf("#"))for(var a=r.replace(/##/g,"");-1!==a.indexOf("#"+(o+1));)++o;for(var i=new Br(r,this.settings),s=[],l=i.lex();"EOF"!==l.text;)s.push(l),l=i.lex();return s.reverse(),{tokens:s,numArgs:o}}return r}isDefined(e){return this.macros.has(e)||Mr.hasOwnProperty(e)||ae.math.hasOwnProperty(e)||ae.text.hasOwnProperty(e)||Vr.hasOwnProperty(e)}isExpandable(e){var t=this.macros.get(e);return null!=t?"string"==typeof t||"function"==typeof t||!t.unexpandable:Mr.hasOwnProperty(e)&&!Mr[e].primitive}}var Wr=/^[\u208a\u208b\u208c\u208d\u208e\u2080\u2081\u2082\u2083\u2084\u2085\u2086\u2087\u2088\u2089\u2090\u2091\u2095\u1d62\u2c7c\u2096\u2097\u2098\u2099\u2092\u209a\u1d63\u209b\u209c\u1d64\u1d65\u2093\u1d66\u1d67\u1d68\u1d69\u1d6a]/,Gr=Object.freeze({"\u208a":"+","\u208b":"-","\u208c":"=","\u208d":"(","\u208e":")","\u2080":"0","\u2081":"1","\u2082":"2","\u2083":"3","\u2084":"4","\u2085":"5","\u2086":"6","\u2087":"7","\u2088":"8","\u2089":"9",\u2090:"a",\u2091:"e",\u2095:"h",\u1d62:"i",\u2c7c:"j",\u2096:"k",\u2097:"l",\u2098:"m",\u2099:"n",\u2092:"o",\u209a:"p",\u1d63:"r",\u209b:"s",\u209c:"t",\u1d64:"u",\u1d65:"v",\u2093:"x",\u1d66:"\u03b2",\u1d67:"\u03b3",\u1d68:"\u03c1",\u1d69:"\u03d5",\u1d6a:"\u03c7","\u207a":"+","\u207b":"-","\u207c":"=","\u207d":"(","\u207e":")","\u2070":"0","\xb9":"1","\xb2":"2","\xb3":"3","\u2074":"4","\u2075":"5","\u2076":"6","\u2077":"7","\u2078":"8","\u2079":"9",\u1d2c:"A",\u1d2e:"B",\u1d30:"D",\u1d31:"E",\u1d33:"G",\u1d34:"H",\u1d35:"I",\u1d36:"J",\u1d37:"K",\u1d38:"L",\u1d39:"M",\u1d3a:"N",\u1d3c:"O",\u1d3e:"P",\u1d3f:"R",\u1d40:"T",\u1d41:"U",\u2c7d:"V",\u1d42:"W",\u1d43:"a",\u1d47:"b",\u1d9c:"c",\u1d48:"d",\u1d49:"e",\u1da0:"f",\u1d4d:"g",\u02b0:"h",\u2071:"i",\u02b2:"j",\u1d4f:"k",\u02e1:"l",\u1d50:"m",\u207f:"n",\u1d52:"o",\u1d56:"p",\u02b3:"r",\u02e2:"s",\u1d57:"t",\u1d58:"u",\u1d5b:"v",\u02b7:"w",\u02e3:"x",\u02b8:"y",\u1dbb:"z",\u1d5d:"\u03b2",\u1d5e:"\u03b3",\u1d5f:"\u03b4",\u1d60:"\u03d5",\u1d61:"\u03c7",\u1dbf:"\u03b8"}),Yr={"\u0301":{text:"\\'",math:"\\acute"},"\u0300":{text:"\\`",math:"\\grave"},"\u0308":{text:'\\"',math:"\\ddot"},"\u0303":{text:"\\~",math:"\\tilde"},"\u0304":{text:"\\=",math:"\\bar"},"\u0306":{text:"\\u",math:"\\breve"},"\u030c":{text:"\\v",math:"\\check"},"\u0302":{text:"\\^",math:"\\hat"},"\u0307":{text:"\\.",math:"\\dot"},"\u030a":{text:"\\r",math:"\\mathring"},"\u030b":{text:"\\H"},"\u0327":{text:"\\c"}},Xr={\u00e1:"a\u0301",\u00e0:"a\u0300",\u00e4:"a\u0308",\u01df:"a\u0308\u0304",\u00e3:"a\u0303",\u0101:"a\u0304",\u0103:"a\u0306",\u1eaf:"a\u0306\u0301",\u1eb1:"a\u0306\u0300",\u1eb5:"a\u0306\u0303",\u01ce:"a\u030c",\u00e2:"a\u0302",\u1ea5:"a\u0302\u0301",\u1ea7:"a\u0302\u0300",\u1eab:"a\u0302\u0303",\u0227:"a\u0307",\u01e1:"a\u0307\u0304",\u00e5:"a\u030a",\u01fb:"a\u030a\u0301",\u1e03:"b\u0307",\u0107:"c\u0301",\u1e09:"c\u0327\u0301",\u010d:"c\u030c",\u0109:"c\u0302",\u010b:"c\u0307",\u00e7:"c\u0327",\u010f:"d\u030c",\u1e0b:"d\u0307",\u1e11:"d\u0327",\u00e9:"e\u0301",\u00e8:"e\u0300",\u00eb:"e\u0308",\u1ebd:"e\u0303",\u0113:"e\u0304",\u1e17:"e\u0304\u0301",\u1e15:"e\u0304\u0300",\u0115:"e\u0306",\u1e1d:"e\u0327\u0306",\u011b:"e\u030c",\u00ea:"e\u0302",\u1ebf:"e\u0302\u0301",\u1ec1:"e\u0302\u0300",\u1ec5:"e\u0302\u0303",\u0117:"e\u0307",\u0229:"e\u0327",\u1e1f:"f\u0307",\u01f5:"g\u0301",\u1e21:"g\u0304",\u011f:"g\u0306",\u01e7:"g\u030c",\u011d:"g\u0302",\u0121:"g\u0307",\u0123:"g\u0327",\u1e27:"h\u0308",\u021f:"h\u030c",\u0125:"h\u0302",\u1e23:"h\u0307",\u1e29:"h\u0327",\u00ed:"i\u0301",\u00ec:"i\u0300",\u00ef:"i\u0308",\u1e2f:"i\u0308\u0301",\u0129:"i\u0303",\u012b:"i\u0304",\u012d:"i\u0306",\u01d0:"i\u030c",\u00ee:"i\u0302",\u01f0:"j\u030c",\u0135:"j\u0302",\u1e31:"k\u0301",\u01e9:"k\u030c",\u0137:"k\u0327",\u013a:"l\u0301",\u013e:"l\u030c",\u013c:"l\u0327",\u1e3f:"m\u0301",\u1e41:"m\u0307",\u0144:"n\u0301",\u01f9:"n\u0300",\u00f1:"n\u0303",\u0148:"n\u030c",\u1e45:"n\u0307",\u0146:"n\u0327",\u00f3:"o\u0301",\u00f2:"o\u0300",\u00f6:"o\u0308",\u022b:"o\u0308\u0304",\u00f5:"o\u0303",\u1e4d:"o\u0303\u0301",\u1e4f:"o\u0303\u0308",\u022d:"o\u0303\u0304",\u014d:"o\u0304",\u1e53:"o\u0304\u0301",\u1e51:"o\u0304\u0300",\u014f:"o\u0306",\u01d2:"o\u030c",\u00f4:"o\u0302",\u1ed1:"o\u0302\u0301",\u1ed3:"o\u0302\u0300",\u1ed7:"o\u0302\u0303",\u022f:"o\u0307",\u0231:"o\u0307\u0304",\u0151:"o\u030b",\u1e55:"p\u0301",\u1e57:"p\u0307",\u0155:"r\u0301",\u0159:"r\u030c",\u1e59:"r\u0307",\u0157:"r\u0327",\u015b:"s\u0301",\u1e65:"s\u0301\u0307",\u0161:"s\u030c",\u1e67:"s\u030c\u0307",\u015d:"s\u0302",\u1e61:"s\u0307",\u015f:"s\u0327",\u1e97:"t\u0308",\u0165:"t\u030c",\u1e6b:"t\u0307",\u0163:"t\u0327",\u00fa:"u\u0301",\u00f9:"u\u0300",\u00fc:"u\u0308",\u01d8:"u\u0308\u0301",\u01dc:"u\u0308\u0300",\u01d6:"u\u0308\u0304",\u01da:"u\u0308\u030c",\u0169:"u\u0303",\u1e79:"u\u0303\u0301",\u016b:"u\u0304",\u1e7b:"u\u0304\u0308",\u016d:"u\u0306",\u01d4:"u\u030c",\u00fb:"u\u0302",\u016f:"u\u030a",\u0171:"u\u030b",\u1e7d:"v\u0303",\u1e83:"w\u0301",\u1e81:"w\u0300",\u1e85:"w\u0308",\u0175:"w\u0302",\u1e87:"w\u0307",\u1e98:"w\u030a",\u1e8d:"x\u0308",\u1e8b:"x\u0307",\u00fd:"y\u0301",\u1ef3:"y\u0300",\u00ff:"y\u0308",\u1ef9:"y\u0303",\u0233:"y\u0304",\u0177:"y\u0302",\u1e8f:"y\u0307",\u1e99:"y\u030a",\u017a:"z\u0301",\u017e:"z\u030c",\u1e91:"z\u0302",\u017c:"z\u0307",\u00c1:"A\u0301",\u00c0:"A\u0300",\u00c4:"A\u0308",\u01de:"A\u0308\u0304",\u00c3:"A\u0303",\u0100:"A\u0304",\u0102:"A\u0306",\u1eae:"A\u0306\u0301",\u1eb0:"A\u0306\u0300",\u1eb4:"A\u0306\u0303",\u01cd:"A\u030c",\u00c2:"A\u0302",\u1ea4:"A\u0302\u0301",\u1ea6:"A\u0302\u0300",\u1eaa:"A\u0302\u0303",\u0226:"A\u0307",\u01e0:"A\u0307\u0304",\u00c5:"A\u030a",\u01fa:"A\u030a\u0301",\u1e02:"B\u0307",\u0106:"C\u0301",\u1e08:"C\u0327\u0301",\u010c:"C\u030c",\u0108:"C\u0302",\u010a:"C\u0307",\u00c7:"C\u0327",\u010e:"D\u030c",\u1e0a:"D\u0307",\u1e10:"D\u0327",\u00c9:"E\u0301",\u00c8:"E\u0300",\u00cb:"E\u0308",\u1ebc:"E\u0303",\u0112:"E\u0304",\u1e16:"E\u0304\u0301",\u1e14:"E\u0304\u0300",\u0114:"E\u0306",\u1e1c:"E\u0327\u0306",\u011a:"E\u030c",\u00ca:"E\u0302",\u1ebe:"E\u0302\u0301",\u1ec0:"E\u0302\u0300",\u1ec4:"E\u0302\u0303",\u0116:"E\u0307",\u0228:"E\u0327",\u1e1e:"F\u0307",\u01f4:"G\u0301",\u1e20:"G\u0304",\u011e:"G\u0306",\u01e6:"G\u030c",\u011c:"G\u0302",\u0120:"G\u0307",\u0122:"G\u0327",\u1e26:"H\u0308",\u021e:"H\u030c",\u0124:"H\u0302",\u1e22:"H\u0307",\u1e28:"H\u0327",\u00cd:"I\u0301",\u00cc:"I\u0300",\u00cf:"I\u0308",\u1e2e:"I\u0308\u0301",\u0128:"I\u0303",\u012a:"I\u0304",\u012c:"I\u0306",\u01cf:"I\u030c",\u00ce:"I\u0302",\u0130:"I\u0307",\u0134:"J\u0302",\u1e30:"K\u0301",\u01e8:"K\u030c",\u0136:"K\u0327",\u0139:"L\u0301",\u013d:"L\u030c",\u013b:"L\u0327",\u1e3e:"M\u0301",\u1e40:"M\u0307",\u0143:"N\u0301",\u01f8:"N\u0300",\u00d1:"N\u0303",\u0147:"N\u030c",\u1e44:"N\u0307",\u0145:"N\u0327",\u00d3:"O\u0301",\u00d2:"O\u0300",\u00d6:"O\u0308",\u022a:"O\u0308\u0304",\u00d5:"O\u0303",\u1e4c:"O\u0303\u0301",\u1e4e:"O\u0303\u0308",\u022c:"O\u0303\u0304",\u014c:"O\u0304",\u1e52:"O\u0304\u0301",\u1e50:"O\u0304\u0300",\u014e:"O\u0306",\u01d1:"O\u030c",\u00d4:"O\u0302",\u1ed0:"O\u0302\u0301",\u1ed2:"O\u0302\u0300",\u1ed6:"O\u0302\u0303",\u022e:"O\u0307",\u0230:"O\u0307\u0304",\u0150:"O\u030b",\u1e54:"P\u0301",\u1e56:"P\u0307",\u0154:"R\u0301",\u0158:"R\u030c",\u1e58:"R\u0307",\u0156:"R\u0327",\u015a:"S\u0301",\u1e64:"S\u0301\u0307",\u0160:"S\u030c",\u1e66:"S\u030c\u0307",\u015c:"S\u0302",\u1e60:"S\u0307",\u015e:"S\u0327",\u0164:"T\u030c",\u1e6a:"T\u0307",\u0162:"T\u0327",\u00da:"U\u0301",\u00d9:"U\u0300",\u00dc:"U\u0308",\u01d7:"U\u0308\u0301",\u01db:"U\u0308\u0300",\u01d5:"U\u0308\u0304",\u01d9:"U\u0308\u030c",\u0168:"U\u0303",\u1e78:"U\u0303\u0301",\u016a:"U\u0304",\u1e7a:"U\u0304\u0308",\u016c:"U\u0306",\u01d3:"U\u030c",\u00db:"U\u0302",\u016e:"U\u030a",\u0170:"U\u030b",\u1e7c:"V\u0303",\u1e82:"W\u0301",\u1e80:"W\u0300",\u1e84:"W\u0308",\u0174:"W\u0302",\u1e86:"W\u0307",\u1e8c:"X\u0308",\u1e8a:"X\u0307",\u00dd:"Y\u0301",\u1ef2:"Y\u0300",\u0178:"Y\u0308",\u1ef8:"Y\u0303",\u0232:"Y\u0304",\u0176:"Y\u0302",\u1e8e:"Y\u0307",\u0179:"Z\u0301",\u017d:"Z\u030c",\u1e90:"Z\u0302",\u017b:"Z\u0307",\u03ac:"\u03b1\u0301",\u1f70:"\u03b1\u0300",\u1fb1:"\u03b1\u0304",\u1fb0:"\u03b1\u0306",\u03ad:"\u03b5\u0301",\u1f72:"\u03b5\u0300",\u03ae:"\u03b7\u0301",\u1f74:"\u03b7\u0300",\u03af:"\u03b9\u0301",\u1f76:"\u03b9\u0300",\u03ca:"\u03b9\u0308",\u0390:"\u03b9\u0308\u0301",\u1fd2:"\u03b9\u0308\u0300",\u1fd1:"\u03b9\u0304",\u1fd0:"\u03b9\u0306",\u03cc:"\u03bf\u0301",\u1f78:"\u03bf\u0300",\u03cd:"\u03c5\u0301",\u1f7a:"\u03c5\u0300",\u03cb:"\u03c5\u0308",\u03b0:"\u03c5\u0308\u0301",\u1fe2:"\u03c5\u0308\u0300",\u1fe1:"\u03c5\u0304",\u1fe0:"\u03c5\u0306",\u03ce:"\u03c9\u0301",\u1f7c:"\u03c9\u0300",\u038e:"\u03a5\u0301",\u1fea:"\u03a5\u0300",\u03ab:"\u03a5\u0308",\u1fe9:"\u03a5\u0304",\u1fe8:"\u03a5\u0306",\u038f:"\u03a9\u0301",\u1ffa:"\u03a9\u0300"};class Kr{constructor(e,t){this.mode=void 0,this.gullet=void 0,this.settings=void 0,this.leftrightDepth=void 0,this.nextToken=void 0,this.mode="math",this.gullet=new Hr(e,t,this.mode),this.settings=t,this.leftrightDepth=0}expect(e,t){if(void 0===t&&(t=!0),this.fetch().text!==e)throw new a("Expected '"+e+"', got '"+this.fetch().text+"'",this.fetch());t&&this.consume()}consume(){this.nextToken=null}fetch(){return null==this.nextToken&&(this.nextToken=this.gullet.expandNextToken()),this.nextToken}switchMode(e){this.mode=e,this.gullet.switchMode(e)}parse(){this.settings.globalGroup||this.gullet.beginGroup(),this.settings.colorIsTextColor&&this.gullet.macros.set("\\color","\\textcolor");try{var e=this.parseExpression(!1);return this.expect("EOF"),this.settings.globalGroup||this.gullet.endGroup(),e}finally{this.gullet.endGroups()}}subparse(e){var t=this.nextToken;this.consume(),this.gullet.pushToken(new o("}")),this.gullet.pushTokens(e);var n=this.parseExpression(!1);return this.expect("}"),this.nextToken=t,n}parseExpression(e,t){for(var n=[];;){"math"===this.mode&&this.consumeSpaces();var r=this.fetch();if(-1!==Kr.endOfExpression.indexOf(r.text))break;if(t&&r.text===t)break;if(e&&Mr[r.text]&&Mr[r.text].infix)break;var o=this.parseAtom(t);if(!o)break;"internal"!==o.type&&n.push(o)}return"text"===this.mode&&this.formLigatures(n),this.handleInfixNodes(n)}handleInfixNodes(e){for(var t,n=-1,r=0;r<e.length;r++)if("infix"===e[r].type){if(-1!==n)throw new a("only one infix operator per group",e[r].token);n=r,t=e[r].replaceWith}if(-1!==n&&t){var o,i,s=e.slice(0,n),l=e.slice(n+1);return o=1===s.length&&"ordgroup"===s[0].type?s[0]:{type:"ordgroup",mode:this.mode,body:s},i=1===l.length&&"ordgroup"===l[0].type?l[0]:{type:"ordgroup",mode:this.mode,body:l},["\\\\abovefrac"===t?this.callFunction(t,[o,e[n],i],[]):this.callFunction(t,[o,i],[])]}return e}handleSupSubscript(e){var t,n=this.fetch(),r=n.text;this.consume(),this.consumeSpaces();do{var o;t=this.parseGroup(e)}while("internal"===(null==(o=t)?void 0:o.type));if(!t)throw new a("Expected group after '"+r+"'",n);return t}formatUnsupportedCmd(e){for(var t=[],n=0;n<e.length;n++)t.push({type:"textord",mode:"text",text:e[n]});var r={type:"text",mode:this.mode,body:t};return{type:"color",mode:this.mode,color:this.settings.errorColor,body:[r]}}parseAtom(e){var t,n,r=this.parseGroup("atom",e);if("internal"===(null==r?void 0:r.type))return r;if("text"===this.mode)return r;for(;;){this.consumeSpaces();var i=this.fetch();if("\\limits"===i.text||"\\nolimits"===i.text){if(r&&"op"===r.type){var s="\\limits"===i.text;r.limits=s,r.alwaysHandleSupSub=!0}else{if(!r||"operatorname"!==r.type)throw new a("Limit controls must follow a math operator",i);r.alwaysHandleSupSub&&(r.limits="\\limits"===i.text)}this.consume()}else if("^"===i.text){if(t)throw new a("Double superscript",i);t=this.handleSupSubscript("superscript")}else if("_"===i.text){if(n)throw new a("Double subscript",i);n=this.handleSupSubscript("subscript")}else if("'"===i.text){if(t)throw new a("Double superscript",i);var l={type:"textord",mode:this.mode,text:"\\prime"},c=[l];for(this.consume();"'"===this.fetch().text;)c.push(l),this.consume();"^"===this.fetch().text&&c.push(this.handleSupSubscript("superscript")),t={type:"ordgroup",mode:this.mode,body:c}}else{if(!Gr[i.text])break;var u=Wr.test(i.text),d=[];for(d.push(new o(Gr[i.text])),this.consume();;){var p=this.fetch().text;if(!Gr[p])break;if(Wr.test(p)!==u)break;d.unshift(new o(Gr[p])),this.consume()}var h=this.subparse(d);u?n={type:"ordgroup",mode:"math",body:h}:t={type:"ordgroup",mode:"math",body:h}}}return t||n?{type:"supsub",mode:this.mode,base:r,sup:t,sub:n}:r}parseFunction(e,t){var n=this.fetch(),r=n.text,o=Mr[r];if(!o)return null;if(this.consume(),t&&"atom"!==t&&!o.allowedInArgument)throw new a("Got function '"+r+"' with no arguments"+(t?" as "+t:""),n);if("text"===this.mode&&!o.allowedInText)throw new a("Can't use function '"+r+"' in text mode",n);if("math"===this.mode&&!1===o.allowedInMath)throw new a("Can't use function '"+r+"' in math mode",n);var{args:i,optArgs:s}=this.parseArguments(r,o);return this.callFunction(r,i,s,n,e)}callFunction(e,t,n,r,o){var i={funcName:e,parser:this,token:r,breakOnTokenText:o},s=Mr[e];if(s&&s.handler)return s.handler(i,t,n);throw new a("No function handler for "+e)}parseArguments(e,t){var n=t.numArgs+t.numOptionalArgs;if(0===n)return{args:[],optArgs:[]};for(var r=[],o=[],i=0;i<n;i++){var s=t.argTypes&&t.argTypes[i],l=i<t.numOptionalArgs;(t.primitive&&null==s||"sqrt"===t.type&&1===i&&null==o[0])&&(s="primitive");var c=this.parseGroupOfType("argument to '"+e+"'",s,l);if(l)o.push(c);else{if(null==c)throw new a("Null argument, please report this as a bug");r.push(c)}}return{args:r,optArgs:o}}parseGroupOfType(e,t,n){switch(t){case"color":return this.parseColorGroup(n);case"size":return this.parseSizeGroup(n);case"url":return this.parseUrlGroup(n);case"math":case"text":return this.parseArgumentGroup(n,t);case"hbox":var r=this.parseArgumentGroup(n,"text");return null!=r?{type:"styling",mode:r.mode,body:[r],style:"text"}:null;case"raw":var o=this.parseStringGroup("raw",n);return null!=o?{type:"raw",mode:"text",string:o.text}:null;case"primitive":if(n)throw new a("A primitive argument cannot be optional");var i=this.parseGroup(e);if(null==i)throw new a("Expected group as "+e,this.fetch());return i;case"original":case null:case void 0:return this.parseArgumentGroup(n);default:throw new a("Unknown group type as "+e,this.fetch())}}consumeSpaces(){for(;" "===this.fetch().text;)this.consume()}parseStringGroup(e,t){var n=this.gullet.scanArgument(t);if(null==n)return null;for(var r,o="";"EOF"!==(r=this.fetch()).text;)o+=r.text,this.consume();return this.consume(),n.text=o,n}parseRegexGroup(e,t){for(var n,r=this.fetch(),o=r,i="";"EOF"!==(n=this.fetch()).text&&e.test(i+n.text);)i+=(o=n).text,this.consume();if(""===i)throw new a("Invalid "+t+": '"+r.text+"'",r);return r.range(o,i)}parseColorGroup(e){var t=this.parseStringGroup("color",e);if(null==t)return null;var n=/^(#[a-f0-9]{3}|#?[a-f0-9]{6}|[a-z]+)$/i.exec(t.text);if(!n)throw new a("Invalid color: '"+t.text+"'",t);var r=n[0];return/^[0-9a-f]{6}$/i.test(r)&&(r="#"+r),{type:"color-token",mode:this.mode,color:r}}parseSizeGroup(e){var t,n=!1;if(this.gullet.consumeSpaces(),!(t=e||"{"===this.gullet.future().text?this.parseStringGroup("size",e):this.parseRegexGroup(/^[-+]? *(?:$|\d+|\d+\.\d*|\.\d*) *[a-z]{0,2} *$/,"size")))return null;e||0!==t.text.length||(t.text="0pt",n=!0);var r=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(t.text);if(!r)throw new a("Invalid size: '"+t.text+"'",t);var o={number:+(r[1]+r[2]),unit:r[3]};if(!D(o))throw new a("Invalid unit: '"+o.unit+"'",t);return{type:"size",mode:this.mode,value:o,isBlank:n}}parseUrlGroup(e){this.gullet.lexer.setCatcode("%",13),this.gullet.lexer.setCatcode("~",12);var t=this.parseStringGroup("url",e);if(this.gullet.lexer.setCatcode("%",14),this.gullet.lexer.setCatcode("~",13),null==t)return null;var n=t.text.replace(/\\([#$%&~_^{}])/g,"$1");return{type:"url",mode:this.mode,url:n}}parseArgumentGroup(e,t){var n=this.gullet.scanArgument(e);if(null==n)return null;var r=this.mode;t&&this.switchMode(t),this.gullet.beginGroup();var o=this.parseExpression(!1,"EOF");this.expect("EOF"),this.gullet.endGroup();var a={type:"ordgroup",mode:this.mode,loc:n.loc,body:o};return t&&this.switchMode(r),a}parseGroup(e,t){var n,o=this.fetch(),i=o.text;if("{"===i||"\\begingroup"===i){this.consume();var s="{"===i?"}":"\\endgroup";this.gullet.beginGroup();var l=this.parseExpression(!1,s),c=this.fetch();this.expect(s),this.gullet.endGroup(),n={type:"ordgroup",mode:this.mode,loc:r.range(o,c),body:l,semisimple:"\\begingroup"===i||void 0}}else if(null==(n=this.parseFunction(t,e)||this.parseSymbol())&&"\\"===i[0]&&!Vr.hasOwnProperty(i)){if(this.settings.throwOnError)throw new a("Undefined control sequence: "+i,o);n=this.formatUnsupportedCmd(i),this.consume()}return n}formLigatures(e){for(var t=e.length-1,n=0;n<t;++n){var o=e[n],a=o.text;"-"===a&&"-"===e[n+1].text&&(n+1<t&&"-"===e[n+2].text?(e.splice(n,3,{type:"textord",mode:"text",loc:r.range(o,e[n+2]),text:"---"}),t-=2):(e.splice(n,2,{type:"textord",mode:"text",loc:r.range(o,e[n+1]),text:"--"}),t-=1)),"'"!==a&&"`"!==a||e[n+1].text!==a||(e.splice(n,2,{type:"textord",mode:"text",loc:r.range(o,e[n+1]),text:a+a}),t-=1)}}parseSymbol(){var e=this.fetch(),t=e.text;if(/^\\verb[^a-zA-Z]/.test(t)){this.consume();var n=t.slice(5),o="*"===n.charAt(0);if(o&&(n=n.slice(1)),n.length<2||n.charAt(0)!==n.slice(-1))throw new a("\\verb assertion failed --\n                    please report what input caused this bug");return{type:"verb",mode:"text",body:n=n.slice(1,-1),star:o}}Xr.hasOwnProperty(t[0])&&!ae[this.mode][t[0]]&&(this.settings.strict&&"math"===this.mode&&this.settings.reportNonstrict("unicodeTextInMathMode",'Accented Unicode text character "'+t[0]+'" used in math mode',e),t=Xr[t[0]]+t.slice(1));var i,s=Rr.exec(t);if(s&&("i"===(t=t.substring(0,s.index))?t="\u0131":"j"===t&&(t="\u0237")),ae[this.mode][t]){this.settings.strict&&"math"===this.mode&&Ne.indexOf(t)>=0&&this.settings.reportNonstrict("unicodeTextInMathMode",'Latin-1/Unicode text character "'+t[0]+'" used in math mode',e);var l,c=ae[this.mode][t].group,u=r.range(e);if(re.hasOwnProperty(c)){var d=c;l={type:"atom",mode:this.mode,family:d,loc:u,text:t}}else l={type:c,mode:this.mode,loc:u,text:t};i=l}else{if(!(t.charCodeAt(0)>=128))return null;this.settings.strict&&(E(t.charCodeAt(0))?"math"===this.mode&&this.settings.reportNonstrict("unicodeTextInMathMode",'Unicode text character "'+t[0]+'" used in math mode',e):this.settings.reportNonstrict("unknownSymbol",'Unrecognized Unicode character "'+t[0]+'" ('+t.charCodeAt(0)+")",e)),i={type:"textord",mode:"text",loc:r.range(e),text:t}}if(this.consume(),s)for(var p=0;p<s[0].length;p++){var h=s[0][p];if(!Yr[h])throw new a("Unknown accent ' "+h+"'",e);var f=Yr[h][this.mode]||Yr[h].text;if(!f)throw new a("Accent "+h+" unsupported in "+this.mode+" mode",e);i={type:"accent",mode:this.mode,loc:r.range(e),label:f,isStretchy:!1,isShifty:!0,base:i}}return i}}Kr.endOfExpression=["}","\\endgroup","\\end","\\right","&"];var Qr=function(e,t){if(!("string"==typeof e||e instanceof String))throw new TypeError("KaTeX can only parse string typed expression");var n=new Kr(e,t);delete n.gullet.macros.current["\\df@tag"];var r=n.parse();if(delete n.gullet.macros.current["\\current@color"],delete n.gullet.macros.current["\\color"],n.gullet.macros.get("\\df@tag")){if(!t.displayMode)throw new a("\\tag works only in display equations");r=[{type:"tag",mode:"text",body:r,tag:n.subparse([new o("\\df@tag")])}]}return r},Jr=function(e,t,n){t.textContent="";var r=eo(e,n).toNode();t.appendChild(r)};"undefined"!=typeof document&&"CSS1Compat"!==document.compatMode&&("undefined"!=typeof console&&console.warn("Warning: KaTeX doesn't work in quirks mode. Make sure your website has a suitable doctype."),Jr=function(){throw new a("KaTeX doesn't work in quirks mode.")});var Zr=function(e,t,n){if(n.throwOnError||!(e instanceof a))throw e;var r=Je.makeSpan(["katex-error"],[new J(t)]);return r.setAttribute("title",e.toString()),r.setAttribute("style","color:"+n.errorColor),r},eo=function(e,t){var n=new h(t);try{return function(e,t,n){var r,o=Nt(n);if("mathml"===n.output)return Ot(e,t,o,n.displayMode,!0);if("html"===n.output){var a=Ct(e,o);r=Je.makeSpan(["katex"],[a])}else{var i=Ot(e,t,o,n.displayMode,!1),s=Ct(e,o);r=Je.makeSpan(["katex"],[i,s])}return Pt(r,n)}(Qr(e,n),e,n)}catch(t){return Zr(t,e,n)}},to={version:"0.16.22",render:Jr,renderToString:function(e,t){return eo(e,t).toMarkup()},ParseError:a,SETTINGS_SCHEMA:d,__parse:function(e,t){var n=new h(t);return Qr(e,n)},__renderToDomTree:eo,__renderToHTMLTree:function(e,t){var n=new h(t);try{return function(e,t,n){var r=Ct(e,Nt(n)),o=Je.makeSpan(["katex"],[r]);return Pt(o,n)}(Qr(e,n),0,n)}catch(t){return Zr(t,e,n)}},__setFontMetrics:function(e,t){M[e]=t},__defineSymbol:ie,__defineFunction:st,__defineMacro:qn,__domTree:{Span:Y,Anchor:X,SymbolNode:J,SvgNode:Z,PathNode:ee,LineNode:te}},no=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},ro=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},oo=!1,ao=function(e,t){return void 0===t&&(t=!1),no(void 0,void 0,void 0,(function(){var n,r,o,a,i;return ro(this,(function(s){switch(s.label){case 0:if(s.trys.push([0,5,,6]),!(n=e.trim()))return[2,""];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,no(void 0,void 0,void 0,(function(){var e;return ro(this,(function(t){if(oo)return[2,window.katex];try{return e=to||window.katex,window.katex=e,oo=!0,[2,e]}catch(e){throw console.warn("KaTeX static import failed:",e),e}return[2]}))}))];case 2:return r=s.sent(),o=r.renderToString(n,{displayMode:t,throwOnError:!1,errorColor:"#cc0000",strict:"ignore",trust:!1,macros:{"\\R":"\\mathbb{R}","\\N":"\\mathbb{N}","\\Z":"\\mathbb{Z}","\\Q":"\\mathbb{Q}","\\C":"\\mathbb{C}"}}),t?[2,'<div class="katex-display">'.concat(o,"</div>")]:[2,'<span class="katex-inline">'.concat(o,"</span>")];case 3:return a=s.sent(),console.warn("\u274c KaTeX loading/render failed, falling back to simple display:",a),t?[2,"<div style=\"text-align: center; margin: 12px 0; padding: 10px; background: #F1F5F9; border-radius: 6px; font-family: 'Times New Roman', serif;\">".concat(n,"</div>")]:[2,"<span style=\"background: #F1F5F9; padding: 2px 4px; border-radius: 3px; font-family: 'Times New Roman', serif;\">".concat(n,"</span>")];case 4:return[3,6];case 5:return i=s.sent(),console.warn("Formula rendering error:",i),t?[2,"<div style=\"text-align: center; margin: 12px 0; padding: 10px; background: #F1F5F9; border-radius: 6px; font-family: 'Times New Roman', serif;\">".concat(e,"</div>")]:[2,"<span style=\"background: #F1F5F9; padding: 2px 4px; border-radius: 3px; font-family: 'Times New Roman', serif;\">".concat(e,"</span>")];case 6:return[2]}}))}))},io=function(e,t){void 0===t&&(t=!1);var n=e.trim();return n?t?'<div style="text-align: center; margin: 16px 0; padding: 12px 16px; background: linear-gradient(135deg, #F8FAFC 0%, #E2E8F0 100%); border: 1px solid #CBD5E1; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">\n            <div style="font-family: \'Times New Roman\', serif; font-size: 16px; color: #1E293B; font-weight: 500; letter-spacing: 0.5px;">\n                '.concat(n,"\n            </div>\n        </div>"):"<span style=\"display: inline-block; margin: 0 4px; padding: 4px 8px; background: linear-gradient(135deg, #F1F5F9 0%, #E2E8F0 100%); border: 1px solid #CBD5E1; border-radius: 6px; font-family: 'Times New Roman', serif; font-size: 14px; color: #334155; font-weight: 500; box-shadow: 0 1px 2px rgba(0,0,0,0.05);\">\n            ".concat(n,"\n        </span>"):""},so=function(e){var t=e;return t=(t=(t=(t=uo(t=po(t))).replace(/(^|\n)\s*(\u0424\u043e\u0440\u043c\u0443\u043b\u0430:)?\s*g\s*=\s*([^\n<]+)(?=\n|$)/gi,(function(e,t,n,r){var o=r.trim().replace(/\^(\d+)/g,"^{$1}").replace(/\xb7/g,"\\cdot").replace(/\|/g," \\mid ");return"".concat(t,"$$g = ").concat(o,"$$")}))).replace(/\$\$([^$]+)\$\$/g,(function(e,t){return io(t,!0)}))).replace(/\(([^()]+)\)/g,(function(e,t,n,r){var o=r.slice(Math.max(0,n-1),n),a=r.slice(n+e.length,n+e.length+1);if("$"===o||"$"===a)return e;if(!(/_[{]?\d+|\\{1,2}(ldots|sum|frac)|\^[{]?\d+/.test(t)||/[a-zA-Z]\s*[+\-]/.test(t)))return e;var i=t.replace(/\\{2,}([A-Za-z])/g,"\\$1").replace(/\^(\d+)/g,"^{$1}").replace(/\xb7/g,"\\cdot").replace(/\|/g," \\mid ");return"$(".concat(i,")$")})),t=t.replace(/(?<!\$)\$([^$\n]+)\$(?!\$)/g,(function(e,t){return io(t,!1)}))},lo=function(e){return no(void 0,void 0,void 0,(function(){var t,n,r,o,a,i,s,l,c,u,d,p;return ro(this,(function(h){switch(h.label){case 0:t=uo(po(e)),n=Array.from(t.matchAll(/\$\$([^$]+)\$\$/g)),r=Array.from(t.matchAll(/(?<!\$)\$([^$\n]+)\$(?!\$)/g)),console.log("\u{1f3af} Processing ".concat(n.length," block formulas and ").concat(r.length," inline formulas")),o=0,a=n,h.label=1;case 1:if(!(o<a.length))return[3,6];c=a[o],h.label=2;case 2:return h.trys.push([2,4,,5]),[4,ao(c[1],!0)];case 3:return u=h.sent(),t=t.replace(c[0],u),console.log("\u2705 Processed block formula: ".concat(c[1].substring(0,30),"...")),[3,5];case 4:return i=h.sent(),console.warn("\u274c Failed to process block formula: ".concat(c[1]),i),p=io(c[1],!0),t=t.replace(c[0],p),[3,5];case 5:return o++,[3,1];case 6:s=0,l=r,h.label=7;case 7:if(!(s<l.length))return[3,12];c=l[s],h.label=8;case 8:return h.trys.push([8,10,,11]),[4,ao(c[1],!1)];case 9:return u=h.sent(),t=t.replace(c[0],u),console.log("\u2705 Processed inline formula: ".concat(c[1].substring(0,30),"...")),[3,11];case 10:return d=h.sent(),console.warn("\u274c Failed to process inline formula: ".concat(c[1]),d),p=io(c[1],!1),t=t.replace(c[0],p),[3,11];case 11:return s++,[3,7];case 12:return[2,t]}}))}))},co=function(e){return void 0===e&&(e="m_{a}^{2} + m_{b}^{2} + m_{c}^{2} = \\frac{3}{4} S"),no(void 0,void 0,void 0,(function(){var t,n,r,o;return ro(this,(function(a){switch(a.label){case 0:return console.log("\u{1f9ea} Testing KaTeX rendering with formula:",e),[4,ao(e,!0)];case 1:return t=a.sent(),[4,ao(e,!1)];case 2:return n=a.sent(),r=io(e,!0),o=io(e,!1),console.log("\u{1f4ca} Test results:"),console.log("Block (async):",t.substring(0,100)+"..."),console.log("Inline (async):",n.substring(0,100)+"..."),console.log("Block (sync):",r.substring(0,100)+"..."),console.log("Inline (sync):",o.substring(0,100)+"..."),[2,{original:e,blockResult:t,inlineResult:n,syncBlockResult:r,syncInlineResult:o}]}}))}))};function uo(e){var t=e;return t=(t=t.replace(/\barctg\s*(?=\(|\[)/gi,"\\arctan").replace(/\btg\s*(?=\(|\[)/gi,"\\tan").replace(/\bctg\s*(?=\(|\[)/gi,"\\cot").replace(/\bsh\s*(?=\(|\[)/gi,"\\sinh").replace(/\bch\s*(?=\(|\[)/gi,"\\cosh").replace(/\bth\s*(?=\(|\[)/gi,"\\tanh").replace(/\blg\s*(?=\(|\[)/gi,"\\log").replace(/\bln\s*(?=\(|\[)/gi,"\\ln")).replace(/(?<!\$)(\\(?:tan|cot|arctan|arcsin|arccos|sinh|cosh|tanh|sin|cos|log|ln))\s*\[([^\]\n]+)\](?!\$)/gi,(function(e,t,n){return"$\\".concat(t,"\\left[").concat(n,"\\right]$")})),t=t.replace(/(?<!\$)\b(sin|cos|tan|cot|arctan|arcsin|arccos|sinh|cosh|tanh|log|ln)\s*\(([^()\n]+)\)(?!\$)/gi,(function(e,t,n){return"$\\".concat(t,"(").concat(n,")$")})),t=(t=(t=(t=(t=t.replace(/(?<!\$)(\\frac\{[^}]+\}\{[^}]+\})(?!\$)/g,"$$$1$")).replace(/(?<!\$)(\\sqrt\{[^}]+\})(?!\$)/g,"$$$1$")).replace(/(?<!\$)(\\(?:alpha|beta|gamma|delta|epsilon|pi|sigma|theta|omega|mu|lambda|phi))(?![a-zA-Z])(?!\$)/g,"$$$1$")).replace(/\(\s*([^()]+?)\s*\)\s*\/\s*\(\s*([^()]+?)\s*\)/g,(function(e,t,n){return"$$\\frac{".concat(t,"}{").concat(n,"}$$")}))).replace(/(?<!\$)\b(tan|cot)\s*\[([^\]\n]+)\](?!\$)/gi,(function(e,t,n){return"$\\".concat(t.toLowerCase(),"\\left[").concat(n,"\\right]$")})),t=(t=(t=(t=(t=t.replace(/\\tan\\left\[\s*1\s+2\s*(\([^\)]+\))\s*\]/gi,(function(e,t){return"$\\tan\\left[\\tfrac{1}{2}".concat(t,"\\right]$")}))).replace(/\b1\s*2\s*2\s*1\b/g,"1 2")).replace(/\b1\s*2\b(?=\s*\()/g,"\\tfrac{1}{2}")).replace(/(\$\$[^$]+\$\$)\s*\1/g,"$1")).replace(/(?<!\$)(\$[^$]+\$)\s*\1(?!\$)/g,"$1")}function po(e){var t=e;return t=function(e){for(var t="",n=0;n<e.length;){var r=e.codePointAt(n),o=String.fromCodePoint(r),a=null;r>=119808&&r<=119833?a=String.fromCharCode(r-119808+65):r>=119834&&r<=119859?a=String.fromCharCode(r-119834+97):r>=119860&&r<=119885?a=String.fromCharCode(r-119860+65):r>=119886&&r<=119911?a=String.fromCharCode(r-119886+97):r>=119912&&r<=119937?a=String.fromCharCode(r-119912+65):r>=119938&&r<=119963?a=String.fromCharCode(r-119938+97):r>=120782&&r<=120791?a=String.fromCharCode(r-120782+48):8462===r&&(a="h"),t+=null!=a?a:o,n+=o.length}return t}(t=(t=(t=(t=t.replace(/[\u200B-\u200D\u2060\u2061\uFEFF\u00A0]/g," ")).replace(/<annotation[\s\S]*?<\/annotation>/gi,"").replace(/application[^a-zA-Z]*x?[^a-zA-Z]*tex/gi,"")).replace(/<[^>]*>/g," ")).replace(/https?:\/\/\s*w\s*3\s*\.\s*o\s*r\s*g\s*\/\s*1998\s*\/\s*Math\s*\/\s*MathML/gi,"").replace(/\bw\s*3\s*\.\s*o\s*r\s*g\b/gi,"").replace(/\b1998\s*org\s*\/?/gi,"").replace(/\borg\s*1998\b/gi,"").replace(/\b1998\s*\/\s*Math\s*\/\s*MathML\b/gi,"").replace(/MathMLMath/gi,"").replace(/\bMathML\b/gi,"")),t=(t=t.replace(/\b([A-Za-z])(?:\s+[A-Za-z])+\b/g,(function(e){return e.replace(/\s+/g,"")}))).replace(/\s+/g," ").trim()}},63:(e,t,n)=>{
/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var r=n(540);var o="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},a=r.useState,i=r.useEffect,s=r.useLayoutEffect,l=r.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!o(e,n)}catch(e){return!0}}var u="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),r=a({inst:{value:n,getSnapshot:t}}),o=r[0].inst,u=r[1];return s((function(){o.value=n,o.getSnapshot=t,c(o)&&u({inst:o})}),[e,n,t]),i((function(){return c(o)&&u({inst:o}),e((function(){c(o)&&u({inst:o})}))}),[e]),l(n),n};t.useSyncExternalStore=void 0!==r.useSyncExternalStore?r.useSyncExternalStore:u},940:(e,t,n)=>{
/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var r=n(540),o=n(888);var a="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},i=o.useSyncExternalStore,s=r.useRef,l=r.useEffect,c=r.useMemo,u=r.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,n,r,o){var d=s(null);if(null===d.current){var p={hasValue:!1,value:null};d.current=p}else p=d.current;d=c((function(){function e(e){if(!l){if(l=!0,i=e,e=r(e),void 0!==o&&p.hasValue){var t=p.value;if(o(t,e))return s=t}return s=e}if(t=s,a(i,e))return t;var n=r(e);return void 0!==o&&o(t,n)?t:(i=e,s=n)}var i,s,l=!1,c=void 0===n?null:n;return[function(){return e(t())},null===c?void 0:function(){return e(c())}]}),[t,n,r,o]);var h=i(e,d[0],d[1]);return l((function(){p.hasValue=!0,p.value=h}),[h]),u(h),h}},888:(e,t,n)=>{e.exports=n(63)},242:(e,t,n)=>{e.exports=n(940)},743:(e,t,n)=>{n.d(t,{z4:()=>wr});const r="RFC3986",o={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:e=>String(e)},a=(Object.prototype.hasOwnProperty,Array.isArray),i=(()=>{const e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();const s=1024;function l(e,t){if(a(e)){const n=[];for(let r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)}const c=Object.prototype.hasOwnProperty,u={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},d=Array.isArray,p=Array.prototype.push,h=function(e,t){p.apply(e,d(t)?t:[t])},f=Date.prototype.toISOString,g={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,n,r,o)=>{if(0===e.length)return e;let a=e;if("symbol"==typeof e?a=Symbol.prototype.toString.call(e):"string"!=typeof e&&(a=String(e)),"iso-8859-1"===n)return escape(a).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));let l="";for(let e=0;e<a.length;e+=s){const t=a.length>=s?a.slice(e,e+s):a,n=[];for(let e=0;e<t.length;++e){let r=t.charCodeAt(e);45===r||46===r||95===r||126===r||r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122||"RFC1738"===o&&(40===r||41===r)?n[n.length]=t.charAt(e):r<128?n[n.length]=i[r]:r<2048?n[n.length]=i[192|r>>6]+i[128|63&r]:r<55296||r>=57344?n[n.length]=i[224|r>>12]+i[128|r>>6&63]+i[128|63&r]:(e+=1,r=65536+((1023&r)<<10|1023&t.charCodeAt(e)),n[n.length]=i[240|r>>18]+i[128|r>>12&63]+i[128|r>>6&63]+i[128|63&r])}l+=n.join("")}return l},encodeValuesOnly:!1,format:r,formatter:o[r],indices:!1,serializeDate:e=>f.call(e),skipNulls:!1,strictNullHandling:!1};const m={};function y(e,t,n,r,o,a,i,s,c,u,p,f,v,b,x,w,S,k){let C=e,E=k,A=0,I=!1;for(;void 0!==(E=E.get(m))&&!I;){const t=E.get(e);if(A+=1,void 0!==t){if(t===A)throw new RangeError("Cyclic object value");I=!0}void 0===E.get(m)&&(A=0)}if("function"==typeof u?C=u(t,C):C instanceof Date?C=v?.(C):"comma"===n&&d(C)&&(C=l(C,(function(e){return e instanceof Date?v?.(e):e}))),null===C){if(a)return c&&!w?c(t,g.encoder,S,"key",b):t;C=""}if("string"==typeof(T=C)||"number"==typeof T||"boolean"==typeof T||"symbol"==typeof T||"bigint"==typeof T||function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))}(C)){if(c){const e=w?t:c(t,g.encoder,S,"key",b);return[x?.(e)+"="+x?.(c(C,g.encoder,S,"value",b))]}return[x?.(t)+"="+x?.(String(C))]}var T;const M=[];if(void 0===C)return M;let F;if("comma"===n&&d(C))w&&c&&(C=l(C,c)),F=[{value:C.length>0?C.join(",")||null:void 0}];else if(d(u))F=u;else{const e=Object.keys(C);F=p?e.sort(p):e}const z=s?String(t).replace(/\./g,"%2E"):String(t),_=r&&d(C)&&1===C.length?z+"[]":z;if(o&&d(C)&&0===C.length)return _+"[]";for(let t=0;t<F.length;++t){const l=F[t],g="object"==typeof l&&void 0!==l.value?l.value:C[l];if(i&&null===g)continue;const E=f&&s?l.replace(/\./g,"%2E"):l,I=d(C)?"function"==typeof n?n(_,E):_:_+(f?"."+E:"["+E+"]");k.set(e,A);const T=new WeakMap;T.set(m,k),h(M,y(g,I,n,r,o,a,i,s,"comma"===n&&w&&d(C)?null:c,u,p,f,v,b,x,w,S,T))}return M}function v(e,t={}){let n=e;const a=function(e=g){if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");const t=e.charset||g.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=r;if(void 0!==e.format){if(!c.call(o,e.format))throw new TypeError("Unknown format option provided.");n=e.format}const a=o[n];let i,s=g.filter;if(("function"==typeof e.filter||d(e.filter))&&(s=e.filter),i=e.arrayFormat&&e.arrayFormat in u?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":g.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const l=void 0===e.allowDots?1==!!e.encodeDotInKeys||g.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:g.addQueryPrefix,allowDots:l,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:g.allowEmptyArrays,arrayFormat:i,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:g.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?g.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:g.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:g.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:g.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:g.encodeValuesOnly,filter:s,format:n,formatter:a,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:g.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:g.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:g.strictNullHandling}}(t);let i,s;"function"==typeof a.filter?(s=a.filter,n=s("",n)):d(a.filter)&&(s=a.filter,i=s);const l=[];if("object"!=typeof n||null===n)return"";const p=u[a.arrayFormat],f="comma"===p&&a.commaRoundTrip;i||(i=Object.keys(n)),a.sort&&i.sort(a.sort);const m=new WeakMap;for(let e=0;e<i.length;++e){const t=i[e];a.skipNulls&&null===n[t]||h(l,y(n[t],t,p,f,a.allowEmptyArrays,a.strictNullHandling,a.skipNulls,a.encodeDotInKeys,a.encode?a.encoder:null,a.filter,a.sort,a.allowDots,a.serializeDate,a.format,a.formatter,a.encodeValuesOnly,a.charset,m))}const v=l.join(a.delimiter);let b=!0===a.addQueryPrefix?"?":"";return a.charsetSentinel&&("iso-8859-1"===a.charset?b+="utf8=%26%2310003%3B&":b+="utf8=%E2%9C%93&"),v.length>0?b+v:""}const b="4.72.0";let x,w,S,k,C,E,A,I,T,M=!1,F=null,z=null,_=null,R=null;class j{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}x||function(e,t={auto:!1}){if(M)throw new Error(`you must \`import 'openai/shims/${e.kind}'\` before importing anything else from openai`);if(x)throw new Error(`can't \`import 'openai/shims/${e.kind}'\` after \`import 'openai/shims/${x}'\``);M=t.auto,x=e.kind,w=e.fetch,F=e.Request,z=e.Response,_=e.Headers,S=e.FormData,R=e.Blob,k=e.File,C=e.ReadableStream,E=e.getMultipartRequestOptions,A=e.getDefaultAgent,I=e.fileFromPath,T=e.isFsReadStream}(function({manuallyImported:e}={}){const t=e?"You may need to use polyfills":"Add one of these imports before your first `import \u2026 from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let n,r,o,a;try{n=fetch,r=Request,o=Response,a=Headers}catch(e){throw new Error(`this environment is missing the following Web Fetch API type: ${e.message}. ${t}`)}return{kind:"web",fetch:n,Request:r,Response:o,Headers:a,FormData:"undefined"!=typeof FormData?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${t}`)}},Blob:"undefined"!=typeof Blob?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${t}`)}},File:"undefined"!=typeof File?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${t}`)}},ReadableStream:"undefined"!=typeof ReadableStream?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${t}`)}},getMultipartRequestOptions:async(e,t)=>({...t,body:new j(e)}),getDefaultAgent:e=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:e=>!1}}(),{auto:!0});class B extends Error{}class O extends B{constructor(e,t,n,r){super(`${O.makeMessage(e,t,n)}`),this.status=e,this.headers=r,this.request_id=r?.["x-request-id"];const o=t;this.error=o,this.code=o?.code,this.param=o?.param,this.type=o?.type}static makeMessage(e,t,n){const r=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,n,r){if(!e)return new P({message:n,cause:je(t)});const o=t?.error;return 400===e?new D(e,o,n,r):401===e?new $(e,o,n,r):403===e?new q(e,o,n,r):404===e?new U(e,o,n,r):409===e?new V(e,o,n,r):422===e?new H(e,o,n,r):429===e?new W(e,o,n,r):e>=500?new G(e,o,n,r):new O(e,o,n,r)}}class N extends O{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}}class P extends O{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}}class L extends P{constructor({message:e}={}){super({message:e??"Request timed out."})}}class D extends O{constructor(){super(...arguments),this.status=400}}class $ extends O{constructor(){super(...arguments),this.status=401}}class q extends O{constructor(){super(...arguments),this.status=403}}class U extends O{constructor(){super(...arguments),this.status=404}}class V extends O{constructor(){super(...arguments),this.status=409}}class H extends O{constructor(){super(...arguments),this.status=422}}class W extends O{constructor(){super(...arguments),this.status=429}}class G extends O{}class Y extends B{constructor(){super("Could not parse response content as the length limit was reached")}}class X extends B{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class K{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const n=K.NEWLINE_CHARS.has(t[t.length-1]||"");let r=t.split(K.NEWLINE_REGEXP);return n&&r.pop(),1!==r.length||n?(this.buffer.length>0&&(r=[this.buffer.join("")+r[0],...r.slice(1)],this.buffer=[]),n||(this.buffer=[r.pop()||""]),r):(this.buffer.push(r[0]),[])}decodeText(e){if(null==e)return"";if("string"==typeof e)return e;if("undefined"!=typeof Buffer){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new B(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new B(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new B("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}K.NEWLINE_CHARS=new Set(["\n","\r"]),K.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class Q{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;return new Q((async function*(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let r=!1;try{for await(const n of async function*(e,t){if(!e.body)throw t.abort(),new B("Attempted to iterate over a response with no body");const n=new Z,r=new K,o=ee(e.body);for await(const e of async function*(e){let t=new Uint8Array;for await(const n of e){if(null==n)continue;const e=n instanceof ArrayBuffer?new Uint8Array(n):"string"==typeof n?(new TextEncoder).encode(n):n;let r,o=new Uint8Array(t.length+e.length);for(o.set(t),o.set(e,t.length),t=o;-1!==(r=J(t));)yield t.slice(0,r),t=t.slice(r)}t.length>0&&(yield t)}(o))for(const t of r.decode(e)){const e=n.decode(t);e&&(yield e)}for(const e of r.flush()){const t=n.decode(e);t&&(yield t)}}(e,t))if(!r)if(n.data.startsWith("[DONE]"))r=!0;else if(null===n.event){let e;try{e=JSON.parse(n.data)}catch(e){throw console.error("Could not parse message into JSON:",n.data),console.error("From chunk:",n.raw),e}if(e&&e.error)throw new O(void 0,e.error,void 0,void 0);yield e}else{let e;try{e=JSON.parse(n.data)}catch(e){throw console.error("Could not parse message into JSON:",n.data),console.error("From chunk:",n.raw),e}if("error"==n.event)throw new O(void 0,e.error,e.message,void 0);yield{event:n.event,data:e}}r=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{r||t.abort()}}),t)}static fromReadableStream(e,t){let n=!1;return new Q((async function*(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let r=!1;try{for await(const t of async function*(){const t=new K,n=ee(e);for await(const e of n)for(const n of t.decode(e))yield n;for(const e of t.flush())yield e}())r||t&&(yield JSON.parse(t));r=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{r||t.abort()}}),t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),r=r=>({next:()=>{if(0===r.length){const r=n.next();e.push(r),t.push(r)}return r.shift()}});return[new Q((()=>r(e)),this.controller),new Q((()=>r(t)),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new C({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{const{value:r,done:o}=await t.next();if(o)return e.close();const a=n.encode(JSON.stringify(r)+"\n");e.enqueue(a)}catch(t){e.error(t)}},async cancel(){await(t.return?.())}})}}function J(e){for(let t=0;t<e.length-2;t++){if(10===e[t]&&10===e[t+1])return t+2;if(13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return-1}class Z{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,r]=function(e,t){const n=e.indexOf(t);if(-1!==n)return[e.substring(0,n),t,e.substring(n+t.length)];return[e,"",""]}(e,":");return r.startsWith(" ")&&(r=r.substring(1)),"event"===t?this.event=r:"data"===t&&this.data.push(r),null}}function ee(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const te=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob,ne=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&re(e),re=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer,oe=e=>ne(e)||te(e)||T(e);async function ae(e,t,n){if(e=await e,ne(e))return e;if(te(e)){const r=await e.blob();t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()??"unknown_file");const o=re(r)?[await r.arrayBuffer()]:[r];return new k(o,t,n)}const r=await async function(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(re(e))t.push(await e.arrayBuffer());else{if(!se(e))throw new Error(`Unexpected data type: ${typeof e}; constructor: ${e?.constructor?.name}; props: ${function(e){const t=Object.getOwnPropertyNames(e);return`[${t.map((e=>`"${e}"`)).join(", ")}]`}(e)}`);for await(const n of e)t.push(n)}return t}(e);if(t||(t=function(e){return ie(e.name)||ie(e.filename)||ie(e.path)?.split(/[\\/]/).pop()}(e)??"unknown_file"),!n?.type){const e=r[0]?.type;"string"==typeof e&&(n={...n,type:e})}return new k(r,t,n)}const ie=e=>"string"==typeof e?e:"undefined"!=typeof Buffer&&e instanceof Buffer?String(e):void 0,se=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],le=e=>e&&"object"==typeof e&&e.body&&"MultipartBody"===e[Symbol.toStringTag],ce=async e=>{const t=await ue(e.body);return E(t,e)},ue=async e=>{const t=new S;return await Promise.all(Object.entries(e||{}).map((([e,n])=>de(t,e,n)))),t},de=async(e,t,n)=>{if(void 0!==n){if(null==n)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)e.append(t,String(n));else if(oe(n)){const r=await ae(n);e.append(t,r)}else if(Array.isArray(n))await Promise.all(n.map((n=>de(e,t+"[]",n))));else{if("object"!=typeof n)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`);await Promise.all(Object.entries(n).map((([n,r])=>de(e,`${t}[${n}]`,r))))}}};var pe,he=function(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,n):o?o.value=n:t.set(e,n),n},fe=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};async function ge(e){const{response:t}=e;if(e.options.stream)return Le("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):Q.fromSSEResponse(t,e.controller);if(204===t.status)return null;if(e.options.__binaryResponse)return t;const n=t.headers.get("content-type");if(n?.includes("application/json")||n?.includes("application/vnd.api+json")){const e=await t.json();return Le("response",t.status,t.url,t.headers,e),me(e,t)}const r=await t.text();return Le("response",t.status,t.url,t.headers,r),r}function me(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class ye extends Promise{constructor(e,t=ge){super((e=>{e(null)})),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new ye(this.responsePromise,(async t=>me(e(await this.parseResponse(t),t),t.response)))}asResponse(){return this.responsePromise.then((e=>e.response))}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class ve{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:r,fetch:o}){this.baseURL=e,this.maxRetries=Re("maxRetries",t),this.timeout=Re("timeout",n),this.httpAgent=r,this.fetch=o??w}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Te(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${De()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then((async n=>{const r=n&&re(n?.body)?new DataView(await n.body.arrayBuffer()):n?.body instanceof DataView?n.body:n?.body instanceof ArrayBuffer?new DataView(n.body):n&&ArrayBuffer.isView(n?.body)?new DataView(n.body.buffer):n?.body;return{method:e,path:t,...n,body:r}})))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if("string"==typeof e){if("undefined"!=typeof Buffer)return Buffer.byteLength(e,"utf8").toString();if("undefined"!=typeof TextEncoder){return(new TextEncoder).encode(e).length.toString()}}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){const{method:n,path:r,query:o,headers:a={}}=e,i=ArrayBuffer.isView(e.body)||e.__binaryRequest&&"string"==typeof e.body?e.body:le(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,s=this.calculateContentLength(i),l=this.buildURL(r,o);"timeout"in e&&Re("timeout",e.timeout);const c=e.timeout??this.timeout,u=e.httpAgent??this.httpAgent??A(l),d=c+1e3;"number"==typeof u?.options?.timeout&&d>(u.options.timeout??0)&&(u.options.timeout=d),this.idempotencyHeader&&"get"!==n&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);return{req:{method:n,...i&&{body:i},headers:this.buildHeaders({options:e,headers:a,contentLength:s,retryCount:t}),...u&&{agent:u},signal:e.signal??null},url:l,timeout:c}}buildHeaders({options:e,headers:t,contentLength:n,retryCount:r}){const o={};n&&(o["content-length"]=n);const a=this.defaultHeaders(e);return Pe(o,a),Pe(o,t),le(e.body)&&"node"!==x&&delete o["content-type"],void 0===$e(a,"x-stainless-retry-count")&&void 0===$e(t,"x-stainless-retry-count")&&(o["x-stainless-retry-count"]=String(r)),this.validateHeaders(o,t),o}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map((e=>[...e]))):{...e}:{}}makeStatusError(e,t,n,r){return O.generate(e,t,n,r)}request(e,t=null){return new ye(this.makeRequest(e,t))}async makeRequest(e,t){const n=await e,r=n.maxRetries??this.maxRetries;null==t&&(t=r),await this.prepareOptions(n);const{req:o,url:a,timeout:i}=this.buildRequest(n,{retryCount:r-t});if(await this.prepareRequest(o,{url:a,options:n}),Le("request",a,n,o.headers),n.signal?.aborted)throw new N;const s=new AbortController,l=await this.fetchWithTimeout(a,o,i,s).catch(je);if(l instanceof Error){if(n.signal?.aborted)throw new N;if(t)return this.retryRequest(n,t);if("AbortError"===l.name)throw new L;throw new P({cause:l})}const c=we(l.headers);if(!l.ok){if(t&&this.shouldRetry(l)){return Le(`response (error; ${`retrying, ${t} attempts remaining`})`,l.status,a,c),this.retryRequest(n,t,c)}const e=await l.text().catch((e=>je(e).message)),r=Me(e),o=r?void 0:e;Le(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,l.status,a,c,o);throw this.makeStatusError(l.status,r,o,c)}return{response:l,options:n,controller:s}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new xe(this,n,e)}buildURL(e,t){const n=ze(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),r=this.defaultQuery();return Oe(r)||(t={...r,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter((([e,t])=>void 0!==t)).map((([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new B(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)})).join("&")}async fetchWithTimeout(e,t,n,r){const{signal:o,...a}=t||{};o&&o.addEventListener("abort",(()=>r.abort()));const i=setTimeout((()=>r.abort()),n);return this.getRequestClient().fetch.call(void 0,e,{signal:r.signal,...a}).finally((()=>{clearTimeout(i)}))}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||(409===e.status||(429===e.status||e.status>=500)))}async retryRequest(e,t,n){let r;const o=n?.["retry-after-ms"];if(o){const e=parseFloat(o);Number.isNaN(e)||(r=e)}const a=n?.["retry-after"];if(a&&!r){const e=parseFloat(a);r=Number.isNaN(e)?Date.parse(a)-Date.now():1e3*e}if(!(r&&0<=r&&r<6e4)){const n=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,n)}return await _e(r),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const n=t-e;return Math.min(.5*Math.pow(2,n),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS ${b}`}}class be{constructor(e,t,n,r){pe.set(this,void 0),he(this,pe,e,"f"),this.options=r,this.response=t,this.body=n}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageInfo()}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new B("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&"object"==typeof t.query)t.query={...t.query,...e.params};else if("url"in e){const n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[t,r]of n)e.url.searchParams.set(t,r);t.query=void 0,t.path=e.url.toString()}return await fe(this,pe,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(pe=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class xe extends ye{constructor(e,t,n){super(t,(async t=>new n(e,t.response,await ge(t),t.options)))}async*[Symbol.asyncIterator](){const e=await(this);for await(const t of e)yield t}}const we=e=>new Proxy(Object.fromEntries(e.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),Se={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},ke=e=>"object"==typeof e&&null!==e&&!Oe(e)&&Object.keys(e).every((e=>Ne(Se,e))),Ce=()=>{if("undefined"!=typeof Deno&&null!=Deno.build)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":b,"X-Stainless-OS":Ae(Deno.build.os),"X-Stainless-Arch":Ee(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":b,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if("[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0))return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":b,"X-Stainless-OS":Ae(process.platform),"X-Stainless-Arch":Ee(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const e=function(){if("undefined"==typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:n}of e){const e=n.exec(navigator.userAgent);if(e){return{browser:t,version:`${e[1]||0}.${e[2]||0}.${e[3]||0}`}}}return null}();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":b,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":b,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};const Ee=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",Ae=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";let Ie;const Te=()=>Ie??(Ie=Ce()),Me=e=>{try{return JSON.parse(e)}catch(e){return}},Fe=new RegExp("^(?:[a-z]+:)?//","i"),ze=e=>Fe.test(e),_e=e=>new Promise((t=>setTimeout(t,e))),Re=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new B(`${e} must be an integer`);if(t<0)throw new B(`${e} must be a positive integer`);return t},je=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e)try{return new Error(JSON.stringify(e))}catch{}return new Error(e)},Be=e=>"undefined"!=typeof process?process.env?.[e]?.trim()??void 0:"undefined"!=typeof Deno?Deno.env?.get?.(e)?.trim():void 0;function Oe(e){if(!e)return!0;for(const t in e)return!1;return!0}function Ne(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Pe(e,t){for(const n in t){if(!Ne(t,n))continue;const r=n.toLowerCase();if(!r)continue;const o=t[n];null===o?delete e[r]:void 0!==o&&(e[r]=o)}}function Le(e,...t){"undefined"!=typeof process&&"true"===process?.env?.DEBUG&&console.log(`OpenAI:DEBUG:${e}`,...t)}const De=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),$e=(e,t)=>{const n=t.toLowerCase();if((e=>"function"==typeof e?.get)(e)){const r=t[0]?.toUpperCase()+t.substring(1).replace(/([^\w])(\w)/g,((e,t,n)=>t+n.toUpperCase()));for(const o of[t,n,t.toUpperCase(),r]){const t=e.get(o);if(t)return t}}for(const[r,o]of Object.entries(e))if(r.toLowerCase()===n)return Array.isArray(o)?(o.length<=1||console.warn(`Received ${o.length} entries for the ${t} header, using the first entry.`),o[0]):o};function qe(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}class Ue{constructor(e){this._client=e}}class Ve extends Ue{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class He extends Ue{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}}class We extends Ue{constructor(){super(...arguments),this.completions=new He(this._client)}}We.Completions=He;class Ge extends Ue{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}class Ye extends be{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class Xe extends be{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){const e=this.getPaginatedItems();if(!e.length)return null;const t=e[e.length-1]?.id;return t?{params:{after:t}}:null}}class Ke extends Ue{create(e,t){return this._client.post("/files",ce({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return ke(e)?this.list({},e):this._client.getAPIList("/files",Qe,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t?.headers}})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=18e5}={}){const r=new Set(["processed","error","deleted"]),o=Date.now();let a=await this.retrieve(e);for(;!a.status||!r.has(a.status);)if(await _e(t),a=await this.retrieve(e),Date.now()-o>n)throw new L({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return a}}class Qe extends Xe{}Ke.FileObjectsPage=Qe;class Je extends Ue{createVariation(e,t){return this._client.post("/images/variations",ce({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",ce({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class Ze extends Ue{create(e,t){return this._client.post("/audio/speech",{body:e,...t,__binaryResponse:!0})}}class et extends Ue{create(e,t){return this._client.post("/audio/transcriptions",ce({body:e,...t}))}}class tt extends Ue{create(e,t){return this._client.post("/audio/translations",ce({body:e,...t}))}}class nt extends Ue{constructor(){super(...arguments),this.transcriptions=new et(this._client),this.translations=new tt(this._client),this.speech=new Ze(this._client)}}nt.Transcriptions=et,nt.Translations=tt,nt.Speech=Ze;class rt extends Ue{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class ot extends Ue{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",at,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class at extends Ye{}ot.ModelsPage=at;class it extends Ue{list(e,t={},n){return ke(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,st,{query:t,...n})}}class st extends Xe{}it.FineTuningJobCheckpointsPage=st;class lt extends Ue{constructor(){super(...arguments),this.checkpoints=new it(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return ke(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",ct,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return ke(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,ut,{query:t,...n})}}class ct extends Xe{}class ut extends Xe{}lt.FineTuningJobsPage=ct,lt.FineTuningJobEventsPage=ut,lt.Checkpoints=it,lt.FineTuningJobCheckpointsPage=st;class dt extends Ue{constructor(){super(...arguments),this.jobs=new lt(this._client)}}dt.Jobs=lt,dt.FineTuningJobsPage=ct,dt.FineTuningJobEventsPage=ut;class pt extends Ue{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e={},t){return ke(e)?this.list({},e):this._client.getAPIList("/assistants",ht,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class ht extends Xe{}function ft(e){return"function"==typeof e.parse}pt.AssistantsPage=ht;const gt=e=>"assistant"===e?.role,mt=e=>"function"===e?.role,yt=e=>"tool"===e?.role;var vt,bt,xt,wt,St,kt,Ct,Et,At,It,Tt,Mt,Ft,zt=function(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,n):o?o.value=n:t.set(e,n),n},_t=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class Rt{constructor(){vt.add(this),this.controller=new AbortController,bt.set(this,void 0),xt.set(this,(()=>{})),wt.set(this,(()=>{})),St.set(this,void 0),kt.set(this,(()=>{})),Ct.set(this,(()=>{})),Et.set(this,{}),At.set(this,!1),It.set(this,!1),Tt.set(this,!1),Mt.set(this,!1),zt(this,bt,new Promise(((e,t)=>{zt(this,xt,e,"f"),zt(this,wt,t,"f")})),"f"),zt(this,St,new Promise(((e,t)=>{zt(this,kt,e,"f"),zt(this,Ct,t,"f")})),"f"),_t(this,bt,"f").catch((()=>{})),_t(this,St,"f").catch((()=>{}))}_run(e){setTimeout((()=>{e().then((()=>{this._emitFinal(),this._emit("end")}),_t(this,vt,"m",Ft).bind(this))}),0)}_connected(){this.ended||(_t(this,xt,"f").call(this),this._emit("connect"))}get ended(){return _t(this,At,"f")}get errored(){return _t(this,It,"f")}get aborted(){return _t(this,Tt,"f")}abort(){this.controller.abort()}on(e,t){return(_t(this,Et,"f")[e]||(_t(this,Et,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=_t(this,Et,"f")[e];if(!n)return this;const r=n.findIndex((e=>e.listener===t));return r>=0&&n.splice(r,1),this}once(e,t){return(_t(this,Et,"f")[e]||(_t(this,Et,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise(((t,n)=>{zt(this,Mt,!0,"f"),"error"!==e&&this.once("error",n),this.once(e,t)}))}async done(){zt(this,Mt,!0,"f"),await _t(this,St,"f")}_emit(e,...t){if(_t(this,At,"f"))return;"end"===e&&(zt(this,At,!0,"f"),_t(this,kt,"f").call(this));const n=_t(this,Et,"f")[e];if(n&&(_t(this,Et,"f")[e]=n.filter((e=>!e.once)),n.forEach((({listener:e})=>e(...t)))),"abort"===e){const e=t[0];return _t(this,Mt,"f")||n?.length||Promise.reject(e),_t(this,wt,"f").call(this,e),_t(this,Ct,"f").call(this,e),void this._emit("end")}if("error"===e){const e=t[0];_t(this,Mt,"f")||n?.length||Promise.reject(e),_t(this,wt,"f").call(this,e),_t(this,Ct,"f").call(this,e),this._emit("end")}}_emitFinal(){}}function jt(e){return"auto-parseable-response-format"===e?.$brand}function Bt(e){return"auto-parseable-tool"===e?.$brand}function Ot(e,t){const n=e.choices.map((e=>{if("length"===e.finish_reason)throw new Y;if("content_filter"===e.finish_reason)throw new X;return{...e,message:{...e.message,tool_calls:e.message.tool_calls?.map((e=>function(e,t){const n=e.tools?.find((e=>e.function?.name===t.function.name));return{...t,function:{...t.function,parsed_arguments:Bt(n)?n.$parseRaw(t.function.arguments):n?.function.strict?JSON.parse(t.function.arguments):null}}}(t,e)))??[],parsed:e.message.content&&!e.message.refusal?Nt(t,e.message.content):null}}}));return{...e,choices:n}}function Nt(e,t){if("json_schema"!==e.response_format?.type)return null;if("json_schema"===e.response_format?.type){if("$parseRaw"in e.response_format){return e.response_format.$parseRaw(t)}return JSON.parse(t)}return null}function Pt(e,t){if(!e)return!1;const n=e.tools?.find((e=>e.function?.name===t.function.name));return Bt(n)||n?.function.strict||!1}function Lt(e){return!!jt(e.response_format)||(e.tools?.some((e=>Bt(e)||"function"===e.type&&!0===e.function.strict))??!1)}bt=new WeakMap,xt=new WeakMap,wt=new WeakMap,St=new WeakMap,kt=new WeakMap,Ct=new WeakMap,Et=new WeakMap,At=new WeakMap,It=new WeakMap,Tt=new WeakMap,Mt=new WeakMap,vt=new WeakSet,Ft=function(e){if(zt(this,It,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new N),e instanceof N)return zt(this,Tt,!0,"f"),this._emit("abort",e);if(e instanceof B)return this._emit("error",e);if(e instanceof Error){const t=new B(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new B(String(e)))};var Dt,$t,qt,Ut,Vt,Ht,Wt,Gt,Yt=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};const Xt=10;class Kt extends Rt{constructor(){super(...arguments),Dt.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t)if(this._emit("message",e),(mt(e)||yt(e))&&e.content)this._emit("functionCallResult",e.content);else if(gt(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(gt(e)&&e.tool_calls)for(const t of e.tool_calls)"function"===t.type&&this._emit("functionCall",t.function)}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new B("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),Yt(this,Dt,"m",$t).call(this)}async finalMessage(){return await this.done(),Yt(this,Dt,"m",qt).call(this)}async finalFunctionCall(){return await this.done(),Yt(this,Dt,"m",Ut).call(this)}async finalFunctionCallResult(){return await this.done(),Yt(this,Dt,"m",Vt).call(this)}async totalUsage(){return await this.done(),Yt(this,Dt,"m",Ht).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=Yt(this,Dt,"m",qt).call(this);t&&this._emit("finalMessage",t);const n=Yt(this,Dt,"m",$t).call(this);n&&this._emit("finalContent",n);const r=Yt(this,Dt,"m",Ut).call(this);r&&this._emit("finalFunctionCall",r);const o=Yt(this,Dt,"m",Vt).call(this);null!=o&&this._emit("finalFunctionCallResult",o),this._chatCompletions.some((e=>e.usage))&&this._emit("totalUsage",Yt(this,Dt,"m",Ht).call(this))}async _createChatCompletion(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort()))),Yt(this,Dt,"m",Wt).call(this,t);const o=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Ot(o,t))}async _runChatCompletion(e,t,n){for(const e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){const r="function",{function_call:o="auto",stream:a,...i}=t,s="string"!=typeof o&&o?.name,{maxChatCompletions:l=Xt}=n||{},c={};for(const e of t.functions)c[e.name||e.function.name]=e;const u=t.functions.map((e=>({name:e.name||e.function.name,parameters:e.parameters,description:e.description})));for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){const t=await this._createChatCompletion(e,{...i,function_call:o,functions:u,messages:[...this.messages]},n),a=t.choices[0]?.message;if(!a)throw new B("missing message in ChatCompletion response");if(!a.function_call)return;const{name:l,arguments:d}=a.function_call,p=c[l];if(!p){const e=`Invalid function_call: ${JSON.stringify(l)}. Available options are: ${u.map((e=>JSON.stringify(e.name))).join(", ")}. Please try again`;this._addMessage({role:r,name:l,content:e});continue}if(s&&s!==l){const e=`Invalid function_call: ${JSON.stringify(l)}. ${JSON.stringify(s)} requested. Please try again`;this._addMessage({role:r,name:l,content:e});continue}let h;try{h=ft(p)?await p.parse(d):d}catch(e){this._addMessage({role:r,name:l,content:e instanceof Error?e.message:String(e)});continue}const f=await p.function(h,this),g=Yt(this,Dt,"m",Gt).call(this,f);if(this._addMessage({role:r,name:l,content:g}),s)return}}async _runTools(e,t,n){const r="tool",{tool_choice:o="auto",stream:a,...i}=t,s="string"!=typeof o&&o?.function?.name,{maxChatCompletions:l=Xt}=n||{},c=t.tools.map((e=>{if(Bt(e)){if(!e.$callback)throw new B("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e})),u={};for(const e of c)"function"===e.type&&(u[e.function.name||e.function.function.name]=e.function);const d="tools"in t?c.map((e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e)):void 0;for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){const t=await this._createChatCompletion(e,{...i,tool_choice:o,tools:d,messages:[...this.messages]},n),a=t.choices[0]?.message;if(!a)throw new B("missing message in ChatCompletion response");if(!a.tool_calls?.length)return;for(const e of a.tool_calls){if("function"!==e.type)continue;const t=e.id,{name:n,arguments:o}=e.function,a=u[n];if(!a){const e=`Invalid tool_call: ${JSON.stringify(n)}. Available options are: ${Object.keys(u).map((e=>JSON.stringify(e))).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:t,content:e});continue}if(s&&s!==n){const e=`Invalid tool_call: ${JSON.stringify(n)}. ${JSON.stringify(s)} requested. Please try again`;this._addMessage({role:r,tool_call_id:t,content:e});continue}let i;try{i=ft(a)?await a.parse(o):o}catch(e){const n=e instanceof Error?e.message:String(e);this._addMessage({role:r,tool_call_id:t,content:n});continue}const l=await a.function(i,this),c=Yt(this,Dt,"m",Gt).call(this,l);if(this._addMessage({role:r,tool_call_id:t,content:c}),s)return}}}}Dt=new WeakSet,$t=function(){return Yt(this,Dt,"m",qt).call(this).content??null},qt=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(gt(t)){const{function_call:e,...n}=t,r={...n,content:t.content??null,refusal:t.refusal??null};return e&&(r.function_call=e),r}}throw new B("stream ended without producing a ChatCompletionMessage with role=assistant")},Ut=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(gt(t)&&t?.function_call)return t.function_call;if(gt(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},Vt=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(mt(t)&&null!=t.content)return t.content;if(yt(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some((e=>"assistant"===e.role&&e.tool_calls?.some((e=>"function"===e.type&&e.id===t.tool_call_id)))))return t.content}},Ht=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Wt=function(e){if(null!=e.n&&e.n>1)throw new B("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Gt=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class Qt extends Kt{static runFunctions(e,t,n){const r=new Qt,o={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run((()=>r._runFunctions(e,t,o))),r}static runTools(e,t,n){const r=new Qt,o={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run((()=>r._runTools(e,t,o))),r}_addMessage(e,t=!0){super._addMessage(e,t),gt(e)&&e.content&&this._emit("content",e.content)}}const Jt=1,Zt=2,en=4,tn=8,nn=16,rn=32,on=64,an=128,sn=256,ln=511;class cn extends Error{}class un extends Error{}const dn=(e,t)=>{const n=e.length;let r=0;const o=e=>{throw new cn(`${e} at position ${r}`)},a=e=>{throw new un(`${e} at position ${r}`)},i=()=>(d(),r>=n&&o("Unexpected end of input"),'"'===e[r]?s():"{"===e[r]?l():"["===e[r]?c():"null"===e.substring(r,r+4)||nn&t&&n-r<4&&"null".startsWith(e.substring(r))?(r+=4,null):"true"===e.substring(r,r+4)||rn&t&&n-r<4&&"true".startsWith(e.substring(r))?(r+=4,!0):"false"===e.substring(r,r+5)||rn&t&&n-r<5&&"false".startsWith(e.substring(r))?(r+=5,!1):"Infinity"===e.substring(r,r+8)||an&t&&n-r<8&&"Infinity".startsWith(e.substring(r))?(r+=8,1/0):"-Infinity"===e.substring(r,r+9)||sn&t&&1<n-r&&n-r<9&&"-Infinity".startsWith(e.substring(r))?(r+=9,-1/0):"NaN"===e.substring(r,r+3)||on&t&&n-r<3&&"NaN".startsWith(e.substring(r))?(r+=3,NaN):u()),s=()=>{const i=r;let s=!1;for(r++;r<n&&('"'!==e[r]||s&&"\\"===e[r-1]);)s="\\"===e[r]&&!s,r++;if('"'==e.charAt(r))try{return JSON.parse(e.substring(i,++r-Number(s)))}catch(e){a(String(e))}else if(Jt&t)try{return JSON.parse(e.substring(i,r-Number(s))+'"')}catch(t){return JSON.parse(e.substring(i,e.lastIndexOf("\\"))+'"')}o("Unterminated string literal")},l=()=>{r++,d();const a={};try{for(;"}"!==e[r];){if(d(),r>=n&&tn&t)return a;const o=s();d(),r++;try{const e=i();Object.defineProperty(a,o,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(e){if(tn&t)return a;throw e}d(),","===e[r]&&r++}}catch(e){if(tn&t)return a;o("Expected '}' at end of object")}return r++,a},c=()=>{r++;const n=[];try{for(;"]"!==e[r];)n.push(i()),d(),","===e[r]&&r++}catch(e){if(en&t)return n;o("Expected ']' at end of array")}return r++,n},u=()=>{if(0===r){"-"===e&&Zt&t&&o("Not sure what '-' is");try{return JSON.parse(e)}catch(n){if(Zt&t)try{return"."===e[e.length-1]?JSON.parse(e.substring(0,e.lastIndexOf("."))):JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(e){}a(String(n))}}const i=r;for("-"===e[r]&&r++;e[r]&&!",]}".includes(e[r]);)r++;r!=n||Zt&t||o("Unterminated number literal");try{return JSON.parse(e.substring(i,r))}catch(n){"-"===e.substring(i,r)&&Zt&t&&o("Not sure what '-' is");try{return JSON.parse(e.substring(i,e.lastIndexOf("e")))}catch(e){a(String(e))}}},d=()=>{for(;r<n&&" \n\r\t".includes(e[r]);)r++};return i()},pn=e=>function(e,t=ln){if("string"!=typeof e)throw new TypeError("expecting str, got "+typeof e);if(!e.trim())throw new Error(`${e} is empty`);return dn(e.trim(),t)}(e,ln^Zt);var hn,fn,gn,mn,yn,vn,bn,xn,wn,Sn,kn,Cn,En=function(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,n):o?o.value=n:t.set(e,n),n},An=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class In extends Kt{constructor(e){super(),hn.add(this),fn.set(this,void 0),gn.set(this,void 0),mn.set(this,void 0),En(this,fn,e,"f"),En(this,gn,[],"f")}get currentChatCompletionSnapshot(){return An(this,mn,"f")}static fromReadableStream(e){const t=new In(null);return t._run((()=>t._fromReadableStream(e))),t}static createChatCompletion(e,t,n){const r=new In(t);return r._run((()=>r._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}}))),r}async _createChatCompletion(e,t,n){super._createChatCompletion;const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort()))),An(this,hn,"m",yn).call(this);const o=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const e of o)An(this,hn,"m",bn).call(this,e);if(o.controller.signal?.aborted)throw new N;return this._addChatCompletion(An(this,hn,"m",Sn).call(this))}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),An(this,hn,"m",yn).call(this),this._connected();const r=Q.fromReadableStream(e,this.controller);let o;for await(const e of r)o&&o!==e.id&&this._addChatCompletion(An(this,hn,"m",Sn).call(this)),An(this,hn,"m",bn).call(this,e),o=e.id;if(r.controller.signal?.aborted)throw new N;return this._addChatCompletion(An(this,hn,"m",Sn).call(this))}[(fn=new WeakMap,gn=new WeakMap,mn=new WeakMap,hn=new WeakSet,yn=function(){this.ended||En(this,mn,void 0,"f")},vn=function(e){let t=An(this,gn,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},An(this,gn,"f")[e.index]=t,t)},bn=function(e){if(this.ended)return;const t=An(this,hn,"m",Cn).call(this,e);this._emit("chunk",e,t);for(const n of e.choices){const e=t.choices[n.index];null!=n.delta.content&&"assistant"===e.message?.role&&e.message?.content&&(this._emit("content",n.delta.content,e.message.content),this._emit("content.delta",{delta:n.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=n.delta.refusal&&"assistant"===e.message?.role&&e.message?.refusal&&this._emit("refusal.delta",{delta:n.delta.refusal,snapshot:e.message.refusal}),null!=n.logprobs?.content&&"assistant"===e.message?.role&&this._emit("logprobs.content.delta",{content:n.logprobs?.content,snapshot:e.logprobs?.content??[]}),null!=n.logprobs?.refusal&&"assistant"===e.message?.role&&this._emit("logprobs.refusal.delta",{refusal:n.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});const r=An(this,hn,"m",vn).call(this,e);e.finish_reason&&(An(this,hn,"m",wn).call(this,e),null!=r.current_tool_call_index&&An(this,hn,"m",xn).call(this,e,r.current_tool_call_index));for(const t of n.delta.tool_calls??[])r.current_tool_call_index!==t.index&&(An(this,hn,"m",wn).call(this,e),null!=r.current_tool_call_index&&An(this,hn,"m",xn).call(this,e,r.current_tool_call_index)),r.current_tool_call_index=t.index;for(const t of n.delta.tool_calls??[]){const n=e.message.tool_calls?.[t.index];n?.type&&("function"===n?.type&&this._emit("tool_calls.function.arguments.delta",{name:n.function?.name,index:t.index,arguments:n.function.arguments,parsed_arguments:n.function.parsed_arguments,arguments_delta:t.function?.arguments??""}))}}},xn=function(e,t){if(An(this,hn,"m",vn).call(this,e).done_tool_calls.has(t))return;const n=e.message.tool_calls?.[t];if(!n)throw new Error("no tool call snapshot");if(!n.type)throw new Error("tool call snapshot missing `type`");if("function"===n.type){const e=An(this,fn,"f")?.tools?.find((e=>"function"===e.type&&e.function.name===n.function.name));this._emit("tool_calls.function.arguments.done",{name:n.function.name,index:t,arguments:n.function.arguments,parsed_arguments:Bt(e)?e.$parseRaw(n.function.arguments):e?.function.strict?JSON.parse(n.function.arguments):null})}else n.type},wn=function(e){const t=An(this,hn,"m",vn).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;const n=An(this,hn,"m",kn).call(this);this._emit("content.done",{content:e.message.content,parsed:n?n.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},Sn=function(){if(this.ended)throw new B("stream has ended, this shouldn't happen");const e=An(this,mn,"f");if(!e)throw new B("request ended without sending any chunks");return En(this,mn,void 0,"f"),En(this,gn,[],"f"),function(e,t){const{id:n,choices:r,created:o,model:a,system_fingerprint:i,...s}=e,l={...s,id:n,choices:r.map((({message:t,finish_reason:n,index:r,logprobs:o,...a})=>{if(!n)throw new B(`missing finish_reason for choice ${r}`);const{content:i=null,function_call:s,tool_calls:l,...c}=t,u=t.role;if(!u)throw new B(`missing role for choice ${r}`);if(s){const{arguments:e,name:l}=s;if(null==e)throw new B(`missing function_call.arguments for choice ${r}`);if(!l)throw new B(`missing function_call.name for choice ${r}`);return{...a,message:{content:i,function_call:{arguments:e,name:l},role:u,refusal:t.refusal??null},finish_reason:n,index:r,logprobs:o}}return l?{...a,index:r,finish_reason:n,logprobs:o,message:{...c,role:u,content:i,refusal:t.refusal??null,tool_calls:l.map(((t,n)=>{const{function:o,type:a,id:i,...s}=t,{arguments:l,name:c,...u}=o||{};if(null==i)throw new B(`missing choices[${r}].tool_calls[${n}].id\n${Tn(e)}`);if(null==a)throw new B(`missing choices[${r}].tool_calls[${n}].type\n${Tn(e)}`);if(null==c)throw new B(`missing choices[${r}].tool_calls[${n}].function.name\n${Tn(e)}`);if(null==l)throw new B(`missing choices[${r}].tool_calls[${n}].function.arguments\n${Tn(e)}`);return{...s,id:i,type:a,function:{...u,name:c,arguments:l}}}))}}:{...a,message:{...c,content:i,role:u,refusal:t.refusal??null},finish_reason:n,index:r,logprobs:o}})),created:o,model:a,object:"chat.completion",...i?{system_fingerprint:i}:{}};return function(e,t){return t&&Lt(t)?Ot(e,t):{...e,choices:e.choices.map((e=>({...e,message:{...e.message,parsed:null,tool_calls:e.message.tool_calls??[]}})))}}(l,t)}(e,An(this,fn,"f"))},kn=function(){const e=An(this,fn,"f")?.response_format;return jt(e)?e:null},Cn=function(e){var t,n,r,o;let a=An(this,mn,"f");const{choices:i,...s}=e;a?Object.assign(a,s):a=En(this,mn,{...s,choices:[]},"f");for(const{delta:i,finish_reason:s,index:l,logprobs:c=null,...u}of e.choices){let e=a.choices[l];if(e||(e=a.choices[l]={finish_reason:s,index:l,message:{},logprobs:c,...u}),c)if(e.logprobs){const{content:r,refusal:o,...a}=c;Object.assign(e.logprobs,a),r&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...r)),o&&((n=e.logprobs).refusal??(n.refusal=[]),e.logprobs.refusal.push(...o))}else e.logprobs=Object.assign({},c);if(s&&(e.finish_reason=s,An(this,fn,"f")&&Lt(An(this,fn,"f")))){if("length"===s)throw new Y;if("content_filter"===s)throw new X}if(Object.assign(e,u),!i)continue;const{content:d,refusal:p,function_call:h,role:f,tool_calls:g,...m}=i;if(Object.assign(e.message,m),p&&(e.message.refusal=(e.message.refusal||"")+p),f&&(e.message.role=f),h&&(e.message.function_call?(h.name&&(e.message.function_call.name=h.name),h.arguments&&((r=e.message.function_call).arguments??(r.arguments=""),e.message.function_call.arguments+=h.arguments)):e.message.function_call=h),d&&(e.message.content=(e.message.content||"")+d,!e.message.refusal&&An(this,hn,"m",kn).call(this)&&(e.message.parsed=pn(e.message.content))),g){e.message.tool_calls||(e.message.tool_calls=[]);for(const{index:t,id:n,type:r,function:a,...i}of g){const s=(o=e.message.tool_calls)[t]??(o[t]={});Object.assign(s,i),n&&(s.id=n),r&&(s.type=r),a&&(s.function??(s.function={name:a.name??"",arguments:""})),a?.name&&(s.function.name=a.name),a?.arguments&&(s.function.arguments+=a.arguments,Pt(An(this,fn,"f"),s)&&(s.function.parsed_arguments=pn(s.function.arguments)))}}}return a},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",(n=>{const r=t.shift();r?r.resolve(n):e.push(n)})),this.on("end",(()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),this.on("error",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),{next:async()=>{if(!e.length)return n?{value:void 0,done:!0}:new Promise(((e,n)=>t.push({resolve:e,reject:n}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0}));return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Q(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Tn(e){return JSON.stringify(e)}class Mn extends In{static fromReadableStream(e){const t=new Mn(null);return t._run((()=>t._fromReadableStream(e))),t}static runFunctions(e,t,n){const r=new Mn(null),o={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run((()=>r._runFunctions(e,t,o))),r}static runTools(e,t,n){const r=new Mn(t),o={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run((()=>r._runTools(e,t,o))),r}}class Fn extends Ue{parse(e,t){return function(e){for(const t of e??[]){if("function"!==t.type)throw new B(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new B(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap((t=>Ot(t,e)))}runFunctions(e,t){return e.stream?Mn.runFunctions(this._client,e,t):Qt.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?Mn.runTools(this._client,e,t):Qt.runTools(this._client,e,t)}stream(e,t){return In.createChatCompletion(this._client,e,t)}}class zn extends Ue{constructor(){super(...arguments),this.completions=new Fn(this._client)}}!function(e){e.Completions=Fn}(zn||(zn={}));var _n,Rn,jn,Bn,On,Nn,Pn,Ln,Dn,$n,qn,Un,Vn,Hn,Wn,Gn,Yn,Xn,Kn,Qn,Jn,Zn,er=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},tr=function(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,n):o?o.value=n:t.set(e,n),n};class nr extends Rt{constructor(){super(...arguments),_n.add(this),Rn.set(this,[]),jn.set(this,{}),Bn.set(this,{}),On.set(this,void 0),Nn.set(this,void 0),Pn.set(this,void 0),Ln.set(this,void 0),Dn.set(this,void 0),$n.set(this,void 0),qn.set(this,void 0),Un.set(this,void 0),Vn.set(this,void 0)}[(Rn=new WeakMap,jn=new WeakMap,Bn=new WeakMap,On=new WeakMap,Nn=new WeakMap,Pn=new WeakMap,Ln=new WeakMap,Dn=new WeakMap,$n=new WeakMap,qn=new WeakMap,Un=new WeakMap,Vn=new WeakMap,_n=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",(n=>{const r=t.shift();r?r.resolve(n):e.push(n)})),this.on("end",(()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),this.on("error",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),{next:async()=>{if(!e.length)return n?{value:void 0,done:!0}:new Promise(((e,n)=>t.push({resolve:e,reject:n}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0}));return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new nr;return t._run((()=>t._fromReadableStream(e))),t}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),this._connected();const r=Q.fromReadableStream(e,this.controller);for await(const e of r)er(this,_n,"m",Hn).call(this,e);if(r.controller.signal?.aborted)throw new N;return this._addRun(er(this,_n,"m",Wn).call(this))}toReadableStream(){return new Q(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,r,o){const a=new nr;return a._run((()=>a._runToolAssistantStream(e,t,n,r,{...o,headers:{...o?.headers,"X-Stainless-Helper-Method":"stream"}}))),a}async _createToolAssistantStream(e,t,n,r,o){const a=o?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",(()=>this.controller.abort())));const i={...r,stream:!0},s=await e.submitToolOutputs(t,n,i,{...o,signal:this.controller.signal});this._connected();for await(const e of s)er(this,_n,"m",Hn).call(this,e);if(s.controller.signal?.aborted)throw new N;return this._addRun(er(this,_n,"m",Wn).call(this))}static createThreadAssistantStream(e,t,n){const r=new nr;return r._run((()=>r._threadAssistantStream(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}}))),r}static createAssistantStream(e,t,n,r){const o=new nr;return o._run((()=>o._runAssistantStream(e,t,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}}))),o}currentEvent(){return er(this,qn,"f")}currentRun(){return er(this,Un,"f")}currentMessageSnapshot(){return er(this,On,"f")}currentRunStepSnapshot(){return er(this,Vn,"f")}async finalRunSteps(){return await this.done(),Object.values(er(this,jn,"f"))}async finalMessages(){return await this.done(),Object.values(er(this,Bn,"f"))}async finalRun(){if(await this.done(),!er(this,Nn,"f"))throw Error("Final run was not received.");return er(this,Nn,"f")}async _createThreadAssistantStream(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort())));const o={...t,stream:!0},a=await e.createAndRun(o,{...n,signal:this.controller.signal});this._connected();for await(const e of a)er(this,_n,"m",Hn).call(this,e);if(a.controller.signal?.aborted)throw new N;return this._addRun(er(this,_n,"m",Wn).call(this))}async _createAssistantStream(e,t,n,r){const o=r?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",(()=>this.controller.abort())));const a={...n,stream:!0},i=await e.create(t,a,{...r,signal:this.controller.signal});this._connected();for await(const e of i)er(this,_n,"m",Hn).call(this,e);if(i.controller.signal?.aborted)throw new N;return this._addRun(er(this,_n,"m",Wn).call(this))}static accumulateDelta(e,t){for(const[n,r]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=r;continue}let t=e[n];if(null!=t)if("index"!==n&&"type"!==n){if("string"==typeof t&&"string"==typeof r)t+=r;else if("number"==typeof t&&"number"==typeof r)t+=r;else{if(!qe(t)||!qe(r)){if(Array.isArray(t)&&Array.isArray(r)){if(t.every((e=>"string"==typeof e||"number"==typeof e))){t.push(...r);continue}for(const e of r){if(!qe(e))throw new Error(`Expected array delta entry to be an object but got: ${e}`);const n=e.index;if(null==n)throw console.error(e),new Error("Expected array delta entry to have an `index` property");if("number"!=typeof n)throw new Error(`Expected array delta entry \`index\` property to be a number but got ${n}`);const r=t[n];null==r?t.push(e):t[n]=this.accumulateDelta(r,e)}continue}throw Error(`Unhandled record type: ${n}, deltaValue: ${r}, accValue: ${t}`)}t=this.accumulateDelta(t,r)}e[n]=t}else e[n]=r;else e[n]=r}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,r){return await this._createAssistantStream(t,e,n,r)}async _runToolAssistantStream(e,t,n,r,o){return await this._createToolAssistantStream(n,e,t,r,o)}}Hn=function(e){if(!this.ended)switch(tr(this,qn,e,"f"),er(this,_n,"m",Xn).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":er(this,_n,"m",Zn).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":er(this,_n,"m",Yn).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":er(this,_n,"m",Gn).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Wn=function(){if(this.ended)throw new B("stream has ended, this shouldn't happen");if(!er(this,Nn,"f"))throw Error("Final run has not been received");return er(this,Nn,"f")},Gn=function(e){const[t,n]=er(this,_n,"m",Qn).call(this,e,er(this,On,"f"));tr(this,On,t,"f"),er(this,Bn,"f")[t.id]=t;for(const e of n){const n=t.content[e.index];"text"==n?.type&&this._emit("textCreated",n.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const n of e.data.delta.content){if("text"==n.type&&n.text){let e=n.text,r=t.content[n.index];if(!r||"text"!=r.type)throw Error("The snapshot associated with this text delta is not text or missing");this._emit("textDelta",e,r.text)}if(n.index!=er(this,Pn,"f")){if(er(this,Ln,"f"))switch(er(this,Ln,"f").type){case"text":this._emit("textDone",er(this,Ln,"f").text,er(this,On,"f"));break;case"image_file":this._emit("imageFileDone",er(this,Ln,"f").image_file,er(this,On,"f"))}tr(this,Pn,n.index,"f")}tr(this,Ln,t.content[n.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==er(this,Pn,"f")){const t=e.data.content[er(this,Pn,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,er(this,On,"f"));break;case"text":this._emit("textDone",t.text,er(this,On,"f"))}}er(this,On,"f")&&this._emit("messageDone",e.data),tr(this,On,void 0,"f")}},Yn=function(e){const t=er(this,_n,"m",Kn).call(this,e);switch(tr(this,Vn,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&"tool_calls"==n.step_details.type&&n.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(const e of n.step_details.tool_calls)e.index==er(this,Dn,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(er(this,$n,"f")&&this._emit("toolCallDone",er(this,$n,"f")),tr(this,Dn,e.index,"f"),tr(this,$n,t.step_details.tool_calls[e.index],"f"),er(this,$n,"f")&&this._emit("toolCallCreated",er(this,$n,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":tr(this,Vn,void 0,"f");"tool_calls"==e.data.step_details.type&&er(this,$n,"f")&&(this._emit("toolCallDone",er(this,$n,"f")),tr(this,$n,void 0,"f")),this._emit("runStepDone",e.data,t)}},Xn=function(e){er(this,Rn,"f").push(e),this._emit("event",e)},Kn=function(e){switch(e.event){case"thread.run.step.created":return er(this,jn,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=er(this,jn,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const r=nr.accumulateDelta(t,n.delta);er(this,jn,"f")[e.data.id]=r}return er(this,jn,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":er(this,jn,"f")[e.data.id]=e.data}if(er(this,jn,"f")[e.data.id])return er(this,jn,"f")[e.data.id];throw new Error("No snapshot available")},Qn=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let r=e.data;if(r.delta.content)for(const e of r.delta.content)if(e.index in t.content){let n=t.content[e.index];t.content[e.index]=er(this,_n,"m",Jn).call(this,e,n)}else t.content[e.index]=e,n.push(e);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Jn=function(e,t){return nr.accumulateDelta(t,e)},Zn=function(e){switch(tr(this,Un,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.cancelling":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":tr(this,Nn,e.data,"f"),er(this,$n,"f")&&(this._emit("toolCallDone",er(this,$n,"f")),tr(this,$n,void 0,"f"))}};class rr extends Ue{create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e,t={},n){return ke(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,or,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t,n){return this._client.delete(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}}class or extends Xe{}rr.MessagesPage=or;class ar extends Ue{retrieve(e,t,n,r={},o){return ke(r)?this.retrieve(e,t,n,{},r):this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{query:r,...o,headers:{"OpenAI-Beta":"assistants=v2",...o?.headers}})}list(e,t,n={},r){return ke(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,ir,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}}class ir extends Xe{}ar.RunStepsPage=ir;class sr extends Ue{constructor(){super(...arguments),this.steps=new ar(this._client)}create(e,t,n){const{include:r,...o}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:r},body:o,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers},stream:t.stream??!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e,t={},n){return ke(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,lr,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}createAndStream(e,t,n){return nr.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const r={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:o,response:a}=await this.retrieve(e,t,{...n,headers:{...n?.headers,...r}}).withResponse();switch(o.status){case"queued":case"in_progress":case"cancelling":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=a.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await _e(e);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return o}}}stream(e,t,n){return nr.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,r){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(e,t,n,r){const o=await this.submitToolOutputs(e,t,n,r);return await this.poll(e,o.id,r)}submitToolOutputsStream(e,t,n,r){return nr.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,r)}}class lr extends Xe{}sr.RunsPage=lr,sr.Steps=ar,sr.RunStepsPage=ir;class cr extends Ue{constructor(){super(...arguments),this.runs=new sr(this._client),this.messages=new rr(this._client)}create(e={},t){return ke(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.thread_id,n.id,t)}createAndRunStream(e,t){return nr.createThreadAssistantStream(e,this._client.beta.threads,t)}}cr.Runs=sr,cr.RunsPage=lr,cr.Messages=rr,cr.MessagesPage=or;class ur extends Ue{create(e,t,n){return this._client.post(`/vector_stores/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e,t={},n){return ke(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,dr,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t,n){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}async poll(e,t,n){const r={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const o=await this.retrieve(e,t,{...n,headers:r}).withResponse(),a=o.data;switch(a.status){case"in_progress":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=o.response.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await _e(e);break;case"failed":case"completed":return a}}}async upload(e,t,n){const r=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:r.id},n)}async uploadAndPoll(e,t,n){const r=await this.upload(e,t,n);return await this.poll(e,r.id,n)}}class dr extends Xe{}ur.VectorStoreFilesPage=dr;class pr extends Ue{create(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}cancel(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t);return await this.poll(e,r.id,n)}listFiles(e,t,n={},r){return ke(n)?this.listFiles(e,t,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,dr,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async poll(e,t,n){const r={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:o,response:a}=await this.retrieve(e,t,{...n,headers:r}).withResponse();switch(o.status){case"in_progress":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=a.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await _e(e);break;case"failed":case"cancelled":case"completed":return o}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},r){if(null==t||0==t.length)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const o=r?.maxConcurrency??5,a=Math.min(o,t.length),i=this._client,s=t.values(),l=[...n];const c=Array(a).fill(s).map((async function(e){for(let t of e){const e=await i.files.create({file:t,purpose:"assistants"},r);l.push(e.id)}}));return await(async e=>{const t=await Promise.allSettled(e),n=t.filter((e=>"rejected"===e.status));if(n.length){for(const e of n)console.error(e.reason);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const r=[];for(const e of t)"fulfilled"===e.status&&r.push(e.value);return r})(c),await this.createAndPoll(e,{file_ids:l})}}class hr extends Ue{constructor(){super(...arguments),this.files=new ur(this._client),this.fileBatches=new pr(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/vector_stores/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e={},t){return ke(e)?this.list({},e):this._client.getAPIList("/vector_stores",fr,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class fr extends Xe{}hr.VectorStoresPage=fr,hr.Files=ur,hr.VectorStoreFilesPage=dr,hr.FileBatches=pr;class gr extends Ue{constructor(){super(...arguments),this.vectorStores=new hr(this._client),this.chat=new zn(this._client),this.assistants=new pt(this._client),this.threads=new cr(this._client)}}gr.VectorStores=hr,gr.VectorStoresPage=fr,gr.Assistants=pt,gr.AssistantsPage=ht,gr.Threads=cr;class mr extends Ue{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return ke(e)?this.list({},e):this._client.getAPIList("/batches",yr,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class yr extends Xe{}mr.BatchesPage=yr;class vr extends Ue{create(e,t,n){return this._client.post(`/uploads/${e}/parts`,ce({body:t,...n}))}}class br extends Ue{constructor(){super(...arguments),this.parts=new vr(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(`/uploads/${e}/complete`,{body:t,...n})}}var xr;br.Parts=vr;class wr extends ve{constructor({baseURL:e=Be("OPENAI_BASE_URL"),apiKey:t=Be("OPENAI_API_KEY"),organization:n=Be("OPENAI_ORG_ID")??null,project:r=Be("OPENAI_PROJECT_ID")??null,...o}={}){if(void 0===t)throw new B("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const a={apiKey:t,organization:n,project:r,...o,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator)throw new B("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new Ve(this),this.chat=new We(this),this.embeddings=new Ge(this),this.files=new Ke(this),this.images=new Je(this),this.audio=new nt(this),this.moderations=new rt(this),this.models=new ot(this),this.fineTuning=new dt(this),this.beta=new gr(this),this.batches=new mr(this),this.uploads=new br(this),this._options=a,this.apiKey=t,this.organization=n,this.project=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return v(e,{arrayFormat:"brackets"})}}xr=wr,wr.OpenAI=xr,wr.DEFAULT_TIMEOUT=6e5,wr.OpenAIError=B,wr.APIError=O,wr.APIConnectionError=P,wr.APIConnectionTimeoutError=L,wr.APIUserAbortError=N,wr.NotFoundError=U,wr.ConflictError=V,wr.RateLimitError=W,wr.BadRequestError=D,wr.AuthenticationError=$,wr.InternalServerError=G,wr.PermissionDeniedError=q,wr.UnprocessableEntityError=H,wr.toFile=ae,wr.fileFromPath=I;wr.Completions=Ve,wr.Chat=We,wr.Embeddings=Ge,wr.Files=Ke,wr.FileObjectsPage=Qe,wr.Images=Je,wr.Audio=nt,wr.Moderations=rt,wr.Models=ot,wr.ModelsPage=at,wr.FineTuning=dt,wr.Beta=gr,wr.Batches=mr,wr.BatchesPage=yr,wr.Uploads=br;new Set(["/completions","/chat/completions","/embeddings","/audio/transcriptions","/audio/translations","/audio/speech","/images/generations"])}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/";var r=n(540),o=n(338),a=n(848),i=n(961),s=n(888),l=n(242);let c=function(e){e()};const u=()=>c,d=(0,r.createContext)(null);function p(){return(0,r.useContext)(d)}let h=()=>{throw new Error("uSES not initialized!")};const f=(e,t)=>e===t;function g(e=d){const t=e===d?p:()=>(0,r.useContext)(e);return function(e,n=f){const{store:o,subscription:a,getServerState:i}=t(),s=h(a.addNestedSub,o.getState,i||o.getState,e,n);return(0,r.useDebugValue)(s),s}}const m=g();n(146),n(737);const y={notify(){},get:()=>[]};function v(e,t){let n,r=y;function o(){i.onStateChange&&i.onStateChange()}function a(){n||(n=t?t.addNestedSub(o):e.subscribe(o),r=function(){const e=u();let t=null,n=null;return{clear(){t=null,n=null},notify(){e((()=>{let e=t;for(;e;)e.callback(),e=e.next}))},get(){let e=[],n=t;for(;n;)e.push(n),n=n.next;return e},subscribe(e){let r=!0,o=n={callback:e,next:null,prev:n};return o.prev?o.prev.next=o:t=o,function(){r&&null!==t&&(r=!1,o.next?o.next.prev=o.prev:n=o.prev,o.prev?o.prev.next=o.next:t=o.next)}}}}())}const i={addNestedSub:function(e){return a(),r.subscribe(e)},notifyNestedSubs:function(){r.notify()},handleChangeWrapper:o,isSubscribed:function(){return Boolean(n)},trySubscribe:a,tryUnsubscribe:function(){n&&(n(),n=void 0,r.clear(),r=y)},getListeners:()=>r};return i}const b=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement)?r.useLayoutEffect:r.useEffect;let x=null;const w=function({store:e,context:t,children:n,serverState:o}){const a=(0,r.useMemo)((()=>{const t=v(e);return{store:e,subscription:t,getServerState:o?()=>o:void 0}}),[e,o]),i=(0,r.useMemo)((()=>e.getState()),[e]);b((()=>{const{subscription:t}=a;return t.onStateChange=t.notifyNestedSubs,t.trySubscribe(),i!==e.getState()&&t.notifyNestedSubs(),()=>{t.tryUnsubscribe(),t.onStateChange=void 0}}),[a,i]);const s=t||d;return r.createElement(s.Provider,{value:a},n)};function S(e=d){const t=e===d?p:()=>(0,r.useContext)(e);return function(){const{store:e}=t();return e}}const k=S();function C(e=d){const t=e===d?k:S(e);return function(){return t().dispatch}}const E=C();var A,I;A=l.useSyncExternalStoreWithSelector,h=A,(e=>{x=e})(s.useSyncExternalStore),I=i.unstable_batchedUpdates,c=I;var T="SET_CURRENT_TAB_ID",M="SET_TAB_CARD_FIELD",F="CLEAR_TAB_CARD_DATA",z="SAVE_TAB_CARD",_="DELETE_TAB_CARD",R="SET_TAB_STORED_CARDS",j="UPDATE_TAB_CARD_EXPORT_STATUS",B="UPDATE_TAB_STORED_CARD",O="SET_TAB_CURRENT_PAGE",N=function(e,t,n){return{type:M,payload:{tabId:e,field:t,value:n}}},P=function(e,t){return N(e,"text",t)},L=function(e,t){return N(e,"translation",t)},D=function(e,t){return N(e,"examples",t)},$=function(e,t){return N(e,"image",t)},q=function(e,t){return N(e,"imageUrl",t)},U=function(e,t){return N(e,"front",t)},V=function(e,t){return N(e,"back",t)},H=function(e,t){return N(e,"linguisticInfo",t)},W=function(e,t){return N(e,"transcription",t)},G=function(e,t){return N(e,"isGeneratingCard",t)},Y=function(e,t){return N(e,"currentCardId",t)},X=n(55),K=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},Q=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}};function J(e){var t=e.examples.map((function(t){return function(e,t,n,r){void 0===n&&(n=null),void 0===r&&(r="0.8em");var o=e.replace(t,"<b>".concat(t,"</b>"));if(n){var a=n.split(" ").slice(1).join(" ");return"".concat(o,"<br><span style='font-size: ").concat(r,";'><i>").concat(a,"</i></span>")}return o}(t[0],e.text,t[1])})).join("<br><br>"),n="";if(e.image_base64){var r=e.image_base64;if(r.startsWith("data:")){var o="base64,",a=r.indexOf(o);if(-1!==a){var i=r.substring(a+7);n='<div><img src="data:image/jpeg;base64,'.concat(i,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else n='<div><img src="'.concat(r,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else n='<div><img src="data:image/jpeg;base64,'.concat(r,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}var s="";if(e.linguisticInfo&&e.linguisticInfo.trim()){var l=e.linguisticInfo.trim().split("\n").filter((function(e){return e.trim()})),c="";l.forEach((function(e){var t=e.trim();if(t.match(/^[\u0410-\u042f\u0401A-Z][^:]*:$/))c+='<div style="color: #2563EB; font-weight: bold; margin-top: 12px; margin-bottom: 4px;">'.concat(t,"</div>");else if(t.startsWith("\u2022")||t.startsWith("-")||t.startsWith("*")){var n=t.replace(/^[\u2022\-*]\s*/,"");c+='<div style="margin-left: 16px; margin-bottom: 2px; color: #374151;">\u2022 '.concat(n,"</div>")}else if(t.includes(":")&&!t.endsWith(":")){var r=t.split(":"),o=r[0],a=r.slice(1).join(":").trim();c+='<div style="margin-bottom: 4px;"><span style="color: #6B7280; font-weight: 500;">'.concat(o.trim(),':</span> <span style="color: #111827;">').concat(a,"</span></div>")}else t&&(c+='<div style="margin-bottom: 6px; color: #374151; line-height: 1.4;">'.concat(t,"</div>"))})),c&&(s='\n                <div style="margin-top: 20px; padding: 12px; background-color: #F8FAFC; border-left: 4px solid #2563EB; border-radius: 0 6px 6px 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">\n                    <div style="color: #1E40AF; font-weight: bold; font-size: 14px; margin-bottom: 8px; display: flex; align-items: center;">\n                        <span style="margin-right: 6px;">\u{1f4da}</span>\n                        Grammar & Linguistics\n                    </div>\n                    '.concat(c,"\n                </div>\n            "))}return"\n        <b>".concat(e.translation,"</b>\n        <br><br>").concat(t,"<br><br>\n        ").concat(n,"\n        ").concat(s,"\n    ")}function Z(e){if(!e)return e;var t=e,n=[];return t=(t=(t=(t=t.replace(/<pre[\s\S]*?<\/pre>|<code[\s\S]*?<\/code>/gi,(function(e){return n.push(e),"__CODE_BLOCK_".concat(n.length-1,"__")}))).replace(/\$\$([\s\S]*?)\$\$/g,(function(e,t){return"\\[".concat(t,"]")}))).replace(/(?<!\$)\$([^$\n]+)\$(?!\$)/g,(function(e,t){return"\\(".concat(t,"\\)")}))).replace(/__CODE_BLOCK_(\d+)__/g,(function(e,t){return n[Number(t)]}))}function ee(e,t){var n=e.replace(/^(Key points?:?)/i,"").trim(),r=/<\s*(ul|ol|li)\b/i.test(n),o=/class\s*=\s*"[^"]*katex[^"]*"/i.test(n),a="";if(r||o)a=n;else{var i=n.split(/\r?\n/).map((function(e){return e.trim()})).filter(Boolean);if(i.filter((function(e){return/^(?:[-*\u2022]\s+|\d+\.\s+)/.test(e)})).length>=Math.max(2,Math.floor(i.length/2))){var s=i.filter((function(e){return e.length>0})).map((function(e){return e.replace(/^(?:[-*\u2022]\s+|\d+\.\s+)/,"")})).map((function(e){return"<li>".concat(e,"</li>")})).join("");a="<b>Key points:</b>\n<ul>".concat(s,"</ul>")}else a=i.length<=1?"<div>".concat(i[0]||n,"</div>"):i.map((function(e){return"<p>".concat(e,"</p>")})).join("\n")}var l="";if(t){var c=t;if(c.startsWith("data:")){var u="base64,",d=c.indexOf(u);if(-1!==d){var p=c.substring(d+7);l='<div><img src="data:image/jpeg;base64,'.concat(p,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else l='<div><img src="'.concat(c,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else l='<div><img src="data:image/jpeg;base64,'.concat(c,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}var h=Z(a);return"\n".concat(h,"\n").concat(l,"\n")}var te=function(e,t,n,r,o,a){return K(void 0,void 0,void 0,(function(){var i,s,l,c,u;return Q(this,(function(d){switch(d.label){case 0:return d.trys.push([0,4,,5]),i=JSON.stringify({action:"createDeck",version:6,key:n,params:{deck:r}}),[4,fetch(t,{method:"POST",body:i,headers:{"Content-Type":"application/json"}})];case 1:if(!d.sent().ok)throw new Error("Failed to create deck.");return s=a.map((function(t){var n;if(e===X.d.LanguageLearning&&"translation"in t&&"examples"in t&&"image_base64"in t)n={Front:t.text,Back:J(t)};else if(e===X.d.GeneralTopic&&"back"in t){var a=t;n={Front:Z(a.front),Back:ee(a.back,a.image_base64)}}return{deckName:r,modelName:o,fields:n,options:{allowDuplicate:!1},tags:[]}})),l=JSON.stringify({action:"addNotes",version:6,key:n,params:{notes:s}}),[4,fetch(t,{method:"POST",body:l,headers:{"Content-Type":"application/json"}})];case 2:if(!(c=d.sent()).ok)throw new Error("Failed to add notes.");return[4,c.json()];case 3:if((u=d.sent()).error)throw new Error("Anki error: ".concat(u.error));return[2,u.result];case 4:throw d.sent();case 5:return[2]}}))}))};function ne(e){return K(this,void 0,void 0,(function(){return Q(this,(function(t){return[2,new Promise((function(t,n){chrome.runtime.sendMessage(e,(function(e){e.status&&void 0!==e.data?t(e.data):(console.error("Error fetching image:",e.error),n(null))}))}))]}))}))}var re=function(e){return K(void 0,void 0,void 0,(function(){var t,n,r;return Q(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,fetch("http://localhost:8765",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"deckNames",version:6,key:e})})];case 1:if(!(t=o.sent()).ok)throw new Error("HTTP error! Status: ".concat(t.status));return[4,t.json()];case 2:return(n=o.sent()).result?[2,{result:n.result.map((function(e){return{deckId:e,name:e}})),error:n.error}]:[2,n];case 3:throw r=o.sent(),console.error("Error fetching decks:",r),r;case 4:return[2]}}))}))},oe=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},ae=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},ie="SAVE_ANKI_CARDS",se="SET_TEXT",le="SET_TRANSLATION",ce="SET_EXAMPLES",ue="SET_IMAGE",de="SET_IMAGE_URL",pe="SET_BACK",he="SET_FRONT",fe="SAVE_CARD_TO_STORAGE",ge="LOAD_STORED_CARDS",me="DELETE_STORED_CARD",ye="SET_STORED_CARDS",ve="UPDATE_CARD_EXPORT_STATUS",be="UPDATE_STORED_CARD",xe="SET_CURRENT_CARD_ID",we="SET_LINGUISTIC_INFO",Se="SET_TRANSCRIPTION",ke="SET_IS_GENERATING_CARD",Ce=function(e,t,n,r,o,a){return void 0===n&&(n=null),function(i){return oe(void 0,void 0,void 0,(function(){var s,l;return ae(this,(function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,te(e,t,n,r,o,a)];case 1:return s=c.sent(),i({type:ie,payload:s}),[3,3];case 2:throw l=c.sent(),console.error("Error saving Anki cards:",l),l;case 3:return[2]}}))}))}},Ee=function(e){var t,n,r,o;return console.log("*** ACTION: saveCardToStorage called with card data ***"),console.log("Action payload image info:",{hasImage:!!e.image,hasImageUrl:!!e.imageUrl,imageType:typeof e.image,imageUrlType:typeof e.imageUrl,imageLength:null===(t=e.image)||void 0===t?void 0:t.length,imageUrlLength:null===(n=e.imageUrl)||void 0===n?void 0:n.length,imageValue:e.image,imageUrlValue:e.imageUrl,imagePreview:null===(r=e.image)||void 0===r?void 0:r.substring(0,50),imageUrlPreview:null===(o=e.imageUrl)||void 0===o?void 0:o.substring(0,50)}),{type:fe,payload:e}},Ae=function(){return{type:ge}},Ie=function(e){return{type:se,payload:e}},Te=function(e){return{type:ce,payload:e}},Me=function(e){return{type:le,payload:e}},Fe=function(e){return{type:ue,payload:e}},ze=function(e){return{type:de,payload:e}},_e=function(e){return{type:pe,payload:e}},Re=function(e){return{type:he,payload:e}},je=function(e){var t,n,r,o;return console.log("*** ACTION: updateStoredCard called ***"),console.log("Updated card image info:",{cardId:e.id,hasImage:!!e.image,hasImageUrl:!!e.imageUrl,imageType:typeof e.image,imageUrlType:typeof e.imageUrl,imageLength:null===(t=e.image)||void 0===t?void 0:t.length,imageUrlLength:null===(n=e.imageUrl)||void 0===n?void 0:n.length,imageValue:e.image,imageUrlValue:e.imageUrl,imagePreview:null===(r=e.image)||void 0===r?void 0:r.substring(0,50),imageUrlPreview:null===(o=e.imageUrl)||void 0===o?void 0:o.substring(0,50)}),{type:be,payload:e}},Be=function(e){return{type:xe,payload:e}},Oe=function(e){return{type:we,payload:e}},Ne=function(e){return{type:Se,payload:e}},Pe=function(e){return{type:ke,payload:e}},Le=function(){return Le=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Le.apply(this,arguments)},De=(0,r.createContext)(null),$e=function(e){var t=e.tabId,n=e.children,o=E(),i=m((function(e){return e.tabState.tabStates[t]})),s=m((function(e){return e.cards})),l=(0,r.useMemo)((function(){var e=(null==i?void 0:i.cardData)||{text:s.text,translation:s.translation,examples:s.examples,image:s.image,imageUrl:s.imageUrl,front:s.front,back:s.back,linguisticInfo:s.linguisticInfo,transcription:s.transcription,isGeneratingCard:s.isGeneratingCard,currentCardId:s.currentCardId},n=s.storedCards,r=(null==i?void 0:i.fieldIdPrefix)||"fallback_".concat(Date.now(),"_"),a=m((function(e){return e.currentPage})),l=(null==i?void 0:i.currentPage)||a;return{text:e.text,translation:e.translation,examples:e.examples,image:e.image,imageUrl:e.imageUrl,front:e.front,back:e.back,linguisticInfo:e.linguisticInfo,transcription:e.transcription,isGeneratingCard:e.isGeneratingCard,currentCardId:e.currentCardId,storedCards:n,fieldIdPrefix:r,currentPage:l,setText:function(e){o(i?P(t,e):Ie(e))},setTranslation:function(e){o(i?L(t,e):Me(e))},setExamples:function(e){o(i?D(t,e):Te(e))},setImage:function(e){o(i?$(t,e):Fe(e))},setImageUrl:function(e){o(i?q(t,e):ze(e))},setFront:function(e){o(i?U(t,e):Re(e))},setBack:function(e){o(i?V(t,e):_e(e))},setLinguisticInfo:function(e){o(i?H(t,e):Oe(e))},setTranscription:function(e){o(i?W(t,e):Ne(e))},setIsGeneratingCard:function(e){o(i?G(t,e):Pe(e))},setCurrentCardId:function(e){o(i?Y(t,e):Be(e))},saveCardToStorage:function(e){o(Ee(e))},updateStoredCard:function(e){o(je(e))},deleteStoredCard:function(e){o(function(e){return{type:me,payload:e}}(e))},updateCardExportStatus:function(e,t){o(function(e,t){return{type:ve,payload:{cardId:e,status:t}}}(e,t))},setCurrentPage:function(e){o(i?function(e,t){return{type:O,payload:{tabId:e,currentPage:t}}}(t,e):function(e){return{type:"SET_CURRENT_PAGE",currentPage:e}}(e))},updateCard:function(e){Object.keys(e).forEach((function(n){var r=e[n];if(void 0!==r)switch(n){case"text":o(i?P(t,r):Ie(r));break;case"translation":o(i?L(t,r):Me(r));break;case"examples":o(i?D(t,r):Te(r));break;case"image":o(i?$(t,r):Fe(r));break;case"imageUrl":o(i?q(t,r):ze(r));break;case"front":o(i?U(t,r):Re(r));break;case"back":o(i?V(t,r):_e(r));break;case"linguisticInfo":o(i?H(t,r):Oe(r));break;case"transcription":o(i?W(t,r):Ne(r));break;case"isGeneratingCard":o(i?G(t,r):Pe(r));break;case"currentCardId":o(i?Y(t,r):Be(r))}}))}}}),[i,s,t,o]);return(0,a.jsx)(De.Provider,Le({value:l},{children:n}))},qe=function(){var e=(0,r.useContext)(De);if(!e)throw new Error("useTabAware must be used within a TabAwareProvider");return e},Ue=n(456),Ve=n(78),He={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},We=r.createContext&&r.createContext(He),Ge=function(){return Ge=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Ge.apply(this,arguments)},Ye=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n};function Xe(e){return e&&e.map((function(e,t){return r.createElement(e.tag,Ge({key:t},e.attr),Xe(e.child))}))}function Ke(e){return function(t){return r.createElement(Qe,Ge({attr:Ge({},e.attr)},t),Xe(e.child))}}function Qe(e){var t=function(t){var n,o=e.attr,a=e.size,i=e.title,s=Ye(e,["attr","size","title"]),l=a||t.size||"1em";return t.className&&(n=t.className),e.className&&(n=(n?n+" ":"")+e.className),r.createElement("svg",Ge({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,o,s,{className:n,style:Ge(Ge({color:e.color||t.color},t.style),e.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),i&&r.createElement("title",null,i),e.children)};return void 0!==We?r.createElement(We.Consumer,null,(function(e){return t(e)})):t(He)}function Je(e){return Ke({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"}}]})(e)}function Ze(e){return Ke({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"}}]})(e)}function et(e){return Ke({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M207.029 381.476L12.686 187.132c-9.373-9.373-9.373-24.569 0-33.941l22.667-22.667c9.357-9.357 24.522-9.375 33.901-.04L224 284.505l154.745-154.021c9.379-9.335 24.544-9.317 33.901.04l22.667 22.667c9.373 9.373 9.373 24.569 0 33.941L240.971 381.476c-9.373 9.372-24.569 9.372-33.942 0z"}}]})(e)}function tt(e){return Ke({tag:"svg",attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M34.52 239.03L228.87 44.69c9.37-9.37 24.57-9.37 33.94 0l22.67 22.67c9.36 9.36 9.37 24.52.04 33.9L131.49 256l154.02 154.75c9.34 9.38 9.32 24.54-.04 33.9l-22.67 22.67c-9.37 9.37-24.57 9.37-33.94 0L34.52 272.97c-9.37-9.37-9.37-24.57 0-33.94z"}}]})(e)}function nt(e){return Ke({tag:"svg",attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"}}]})(e)}function rt(e){return Ke({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M240.971 130.524l194.343 194.343c9.373 9.373 9.373 24.569 0 33.941l-22.667 22.667c-9.357 9.357-24.522 9.375-33.901.04L224 227.495 69.255 381.516c-9.379 9.335-24.544 9.317-33.901-.04l-22.667-22.667c-9.373-9.373-9.373-24.569 0-33.941L207.03 130.525c9.372-9.373 24.568-9.373 33.941-.001z"}}]})(e)}function ot(e){return Ke({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"}}]})(e)}function at(e){return Ke({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M278.9 511.5l-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2l43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6l144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z"}}]})(e)}function it(e){return Ke({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"}}]})(e)}function st(e){return Ke({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V80c0-26.51-21.49-48-48-48zM224 416H64V160h160v256zm224 0H288V160h160v256z"}}]})(e)}function lt(e){return Ke({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"}}]})(e)}function ct(e){return Ke({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"}}]})(e)}function ut(e){return Ke({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M0 168v-16c0-13.255 10.745-24 24-24h360V80c0-21.367 25.899-32.042 40.971-16.971l80 80c9.372 9.373 9.372 24.569 0 33.941l-80 80C409.956 271.982 384 261.456 384 240v-48H24c-13.255 0-24-10.745-24-24zm488 152H128v-48c0-21.314-25.862-32.08-40.971-16.971l-80 80c-9.372 9.373-9.372 24.569 0 33.941l80 80C102.057 463.997 128 453.437 128 432v-48h360c13.255 0 24-10.745 24-24v-16c0-13.255-10.745-24-24-24z"}}]})(e)}function dt(e){return Ke({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"}}]})(e)}function pt(e){return Ke({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M448 344v112a23.94 23.94 0 0 1-24 24H312c-21.39 0-32.09-25.9-17-41l36.2-36.2L224 295.6 116.77 402.9 153 439c15.09 15.1 4.39 41-17 41H24a23.94 23.94 0 0 1-24-24V344c0-21.4 25.89-32.1 41-17l36.19 36.2L184.46 256 77.18 148.7 41 185c-15.1 15.1-41 4.4-41-17V56a23.94 23.94 0 0 1 24-24h112c21.39 0 32.09 25.9 17 41l-36.2 36.2L224 216.4l107.23-107.3L295 73c-15.09-15.1-4.39-41 17-41h112a23.94 23.94 0 0 1 24 24v112c0 21.4-25.89 32.1-41 17l-36.19-36.2L263.54 256l107.28 107.3L407 327.1c15.1-15.2 41-4.5 41 16.9z"}}]})(e)}function ht(e){return Ke({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M432 416h-23.41L277.88 53.69A32 32 0 0 0 247.58 32h-47.16a32 32 0 0 0-30.3 21.69L39.41 416H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h128a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16h-19.58l23.3-64h152.56l23.3 64H304a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h128a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM176.85 272L224 142.51 271.15 272z"}}]})(e)}function ft(e){return Ke({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M622.34 153.2L343.4 67.5c-15.2-4.67-31.6-4.67-46.79 0L17.66 153.2c-23.54 7.23-23.54 38.36 0 45.59l48.63 14.94c-10.67 13.19-17.23 29.28-17.88 46.9C38.78 266.15 32 276.11 32 288c0 10.78 5.68 19.85 13.86 25.65L20.33 428.53C18.11 438.52 25.71 448 35.94 448h56.11c10.24 0 17.84-9.48 15.62-19.47L82.14 313.65C90.32 307.85 96 298.78 96 288c0-11.57-6.47-21.25-15.66-26.87.76-15.02 8.44-28.3 20.69-36.72L296.6 284.5c9.06 2.78 26.44 6.25 46.79 0l278.95-85.7c23.55-7.24 23.55-38.36 0-45.6zM352.79 315.09c-28.53 8.76-52.84 3.92-65.59 0l-145.02-44.55L128 384c0 35.35 85.96 64 192 64s192-28.65 192-64l-14.18-113.47-145.03 44.56z"}}]})(e)}function gt(e){return Ke({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h416c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM112 120c-30.928 0-56 25.072-56 56s25.072 56 56 56 56-25.072 56-56-25.072-56-56-56zM64 384h384V272l-87.515-87.515c-4.686-4.686-12.284-4.686-16.971 0L208 320l-55.515-55.515c-4.686-4.686-12.284-4.686-16.971 0L64 336v48z"}}]})(e)}function mt(e){return Ke({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}}]})(e)}function yt(e){return Ke({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M152.1 236.2c-3.5-12.1-7.8-33.2-7.8-33.2h-.5s-4.3 21.1-7.8 33.2l-11.1 37.5H163zM616 96H336v320h280c13.3 0 24-10.7 24-24V120c0-13.3-10.7-24-24-24zm-24 120c0 6.6-5.4 12-12 12h-11.4c-6.9 23.6-21.7 47.4-42.7 69.9 8.4 6.4 17.1 12.5 26.1 18 5.5 3.4 7.3 10.5 4.1 16.2l-7.9 13.9c-3.4 5.9-10.9 7.8-16.7 4.3-12.6-7.8-24.5-16.1-35.4-24.9-10.9 8.7-22.7 17.1-35.4 24.9-5.8 3.5-13.3 1.6-16.7-4.3l-7.9-13.9c-3.2-5.6-1.4-12.8 4.2-16.2 9.3-5.7 18-11.7 26.1-18-7.9-8.4-14.9-17-21-25.7-4-5.7-2.2-13.6 3.7-17.1l6.5-3.9 7.3-4.3c5.4-3.2 12.4-1.7 16 3.4 5 7 10.8 14 17.4 20.9 13.5-14.2 23.8-28.9 30-43.2H412c-6.6 0-12-5.4-12-12v-16c0-6.6 5.4-12 12-12h64v-16c0-6.6 5.4-12 12-12h16c6.6 0 12 5.4 12 12v16h64c6.6 0 12 5.4 12 12zM0 120v272c0 13.3 10.7 24 24 24h280V96H24c-13.3 0-24 10.7-24 24zm58.9 216.1L116.4 167c1.7-4.9 6.2-8.1 11.4-8.1h32.5c5.1 0 9.7 3.3 11.4 8.1l57.5 169.1c2.6 7.8-3.1 15.9-11.4 15.9h-22.9a12 12 0 0 1-11.5-8.6l-9.4-31.9h-60.2l-9.1 31.8c-1.5 5.1-6.2 8.7-11.5 8.7H70.3c-8.2 0-14-8.1-11.4-15.9z"}}]})(e)}function vt(e){return Ke({tag:"svg",attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M96.06 454.35c.01 6.29 1.87 12.45 5.36 17.69l17.09 25.69a31.99 31.99 0 0 0 26.64 14.28h61.71a31.99 31.99 0 0 0 26.64-14.28l17.09-25.69a31.989 31.989 0 0 0 5.36-17.69l.04-38.35H96.01l.05 38.35zM0 176c0 44.37 16.45 84.85 43.56 115.78 16.52 18.85 42.36 58.23 52.21 91.45.04.26.07.52.11.78h160.24c.04-.26.07-.51.11-.78 9.85-33.22 35.69-72.6 52.21-91.45C335.55 260.85 352 220.37 352 176 352 78.61 272.91-.3 175.45 0 73.44.31 0 82.97 0 176zm176-80c-44.11 0-80 35.89-80 80 0 8.84-7.16 16-16 16s-16-7.16-16-16c0-61.76 50.24-112 112-112 8.84 0 16 7.16 16 16s-7.16 16-16 16z"}}]})(e)}function bt(e){return Ke({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M80 368H16a16 16 0 0 0-16 16v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16v-64a16 16 0 0 0-16-16zm0-320H16A16 16 0 0 0 0 64v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16V64a16 16 0 0 0-16-16zm0 160H16a16 16 0 0 0-16 16v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16v-64a16 16 0 0 0-16-16zm416 176H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z"}}]})(e)}function xt(e){return Ke({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M224 96l16-32 32-16-32-16-16-32-16 32-32 16 32 16 16 32zM80 160l26.66-53.33L160 80l-53.34-26.67L80 0 53.34 53.33 0 80l53.34 26.67L80 160zm352 128l-26.66 53.33L352 368l53.34 26.67L432 448l26.66-53.33L512 368l-53.34-26.67L432 288zm70.62-193.77L417.77 9.38C411.53 3.12 403.34 0 395.15 0c-8.19 0-16.38 3.12-22.63 9.38L9.38 372.52c-12.5 12.5-12.5 32.76 0 45.25l84.85 84.85c6.25 6.25 14.44 9.37 22.62 9.37 8.19 0 16.38-3.12 22.63-9.37l363.14-363.15c12.5-12.48 12.5-32.75 0-45.24zM359.45 203.46l-50.91-50.91 86.6-86.6 50.91 50.91-86.6 86.6z"}}]})(e)}function wt(e){return Ke({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M290.74 93.24l128.02 128.02-277.99 277.99-114.14 12.6C11.35 513.54-1.56 500.62.14 485.34l12.7-114.22 277.9-277.88zm207.2-19.06l-60.11-60.11c-18.75-18.75-49.16-18.75-67.91 0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.76 18.75-49.16 0-67.91z"}}]})(e)}function St(e){return Ke({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(e)}function kt(e){return Ke({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M32,224H64V416H32A31.96166,31.96166,0,0,1,0,384V256A31.96166,31.96166,0,0,1,32,224Zm512-48V448a64.06328,64.06328,0,0,1-64,64H160a64.06328,64.06328,0,0,1-64-64V176a79.974,79.974,0,0,1,80-80H288V32a32,32,0,0,1,64,0V96H464A79.974,79.974,0,0,1,544,176ZM264,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,264,256Zm-8,128H192v32h64Zm96,0H288v32h64ZM456,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,456,256Zm-8,128H384v32h64ZM640,256V384a31.96166,31.96166,0,0,1-32,32H576V224h32A31.96166,31.96166,0,0,1,640,256Z"}}]})(e)}function Ct(e){return Ke({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"}}]})(e)}function Et(e){return Ke({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M440.65 12.57l4 82.77A247.16 247.16 0 0 0 255.83 8C134.73 8 33.91 94.92 12.29 209.82A12 12 0 0 0 24.09 224h49.05a12 12 0 0 0 11.67-9.26 175.91 175.91 0 0 1 317-56.94l-101.46-4.86a12 12 0 0 0-12.57 12v47.41a12 12 0 0 0 12 12H500a12 12 0 0 0 12-12V12a12 12 0 0 0-12-12h-47.37a12 12 0 0 0-11.98 12.57zM255.83 432a175.61 175.61 0 0 1-146-77.8l101.8 4.87a12 12 0 0 0 12.57-12v-47.4a12 12 0 0 0-12-12H12a12 12 0 0 0-12 12V500a12 12 0 0 0 12 12h47.35a12 12 0 0 0 12-12.6l-4.15-82.57A247.17 247.17 0 0 0 255.83 504c121.11 0 221.93-86.92 243.55-201.82a12 12 0 0 0-11.8-14.18h-49.05a12 12 0 0 0-11.67 9.26A175.86 175.86 0 0 1 255.83 432z"}}]})(e)}function At(e){return Ke({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"}}]})(e)}function It(e){return Ke({tag:"svg",attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"}}]})(e)}function Tt(e){return Ke({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z"}}]})(e)}var Mt=function(){return Mt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Mt.apply(this,arguments)};const Ft=function(e){var t=e.size,n=void 0===t?"medium":t,r=e.type,o=void 0===r?"spinner":r,i=e.color,s=void 0===i?"#3B82F6":i,l=e.text,c=e.fullScreen,u=void 0!==c&&c,d=e.overlay,p=void 0!==d&&d,h=e.inline,f=void 0!==h&&h,g={small:{container:"16px",fontSize:"12px",spacing:"8px"},medium:{container:"24px",fontSize:"14px",spacing:"12px"},large:{container:"32px",fontSize:"16px",spacing:"16px"}}[n],m={display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:g.spacing,zIndex:1e3};return u&&(m.position="fixed",m.top=0,m.left=0,m.right=0,m.bottom=0),p&&(m.position="absolute",m.top=0,m.left=0,m.right=0,m.bottom=0,m.backgroundColor="rgba(255, 255, 255, 0.8)"),f&&(m.display="inline-flex",m.flexDirection="row",m.marginLeft="8px",m.marginRight="8px"),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("style",{children:["\n    @keyframes spin {\n      0% { transform: rotate(0deg); }\n      100% { transform: rotate(360deg); }\n    }\n  ","\n    @keyframes pulse {\n      0%, 100% { opacity: 1; transform: scale(1); }\n      50% { opacity: 0.5; transform: scale(0.8); }\n    }\n  ","\n    @keyframes dots1 {\n      0%, 80%, 100% { transform: scale(0); }\n      40% { transform: scale(1); }\n    }\n    @keyframes dots2 {\n      0%, 80%, 100% { transform: scale(0); }\n      40% { transform: scale(1); }\n      animation-delay: 0.2s;\n    }\n    @keyframes dots3 {\n      0%, 80%, 100% { transform: scale(0); }\n      40% { transform: scale(1); }\n      animation-delay: 0.4s;\n    }\n  "]}),(0,a.jsxs)("div",Mt({style:m},{children:[function(){switch(o){case"spinner":return(0,a.jsx)("div",{style:{width:g.container,height:g.container,border:"2px solid ".concat(s),borderTopColor:"transparent",borderRadius:"50%",animation:"spin 0.8s linear infinite"}});case"pulse":return(0,a.jsx)("div",{style:{width:g.container,height:g.container,backgroundColor:s,borderRadius:"50%",animation:"pulse 1.2s ease-in-out infinite"}});case"dots":return(0,a.jsx)("div",Mt({style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"}},{children:[1,2,3].map((function(e){return(0,a.jsx)("div",{style:{width:"calc(".concat(g.container," / 3)"),height:"calc(".concat(g.container," / 3)"),backgroundColor:s,borderRadius:"50%",animation:"dots".concat(e," 1.4s infinite ease-in-out both"),animationDelay:"".concat(.2*(e-1),"s")}},e)}))}));default:return null}}(),l&&(0,a.jsx)("div",Mt({style:{color:s,fontSize:g.fontSize,fontWeight:500,textAlign:"center"}},{children:l}))]}))]})};var zt=n(984),_t=n(75),Rt=n(148),jt=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},Bt=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},Ot=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},Nt=[/[a-zA-Z\ud835\udc46\ud835\udc5d\ud835\udc4e\ud835\udc4f\ud835\udc50\ud835\udc65\ud835\udc66\ud835\udc67]\s*[\+\-\*\/\=]\s*[a-zA-Z0-9\ud835\udc46\ud835\udc5d\ud835\udc4e\ud835\udc4f\ud835\udc50]/g,/[a-zA-Z0-9\ud835\udc46\ud835\udc5d\ud835\udc4e\ud835\udc4f\ud835\udc50]\^[0-9]+|[a-zA-Z0-9\ud835\udc46\ud835\udc5d\ud835\udc4e\ud835\udc4f\ud835\udc50][\xb2\xb3\u2074\u2075\u2076\u2077\u2078\u2079]/g,/\b(sin|cos|tan|log|ln|exp|sqrt|abs|max|min|lim)\s*\(/g,/\b\d+\/\d+\b/g,/\b(alpha|beta|gamma|delta|epsilon|pi|sigma|theta|omega|mu|lambda)\b/gi,/[\u03c0\u03b1\ud835\udefc\u03b2\ud835\udefd\u03b3\ud835\udefe\u03b4\ud835\udeff\u03b8\ud835\udf03\u03bb\ud835\udf06\u03bc\ud835\udf07\u03c3\ud835\udf0e\u03c6\ud835\udf11\u03c9\ud835\udf14]/g,/[\xb1\u2211\u222b\u221a\u221e\u2264\u2265\u2260\u2248\u2202\u2207\xb7]/g,/[\ud835\udc46\ud835\udc5d\ud835\udc4e\ud835\udc4f\ud835\udc50\ud835\udc65\ud835\udc66\ud835\udc67\ud835\udc34\ud835\udc35\ud835\udc36]/g,/\([a-zA-Z0-9\ud835\udc46\ud835\udc5d\ud835\udc4e\ud835\udc4f\ud835\udc50\+\-\*\/\^\s]+\)\s*[\=\+\-\*\/]/g,/[\ud835\udc46S]\s*=\s*[\ud835\udc5dp]\s*\([\ud835\udc5dp]\s*[-\u2212]\s*[\ud835\udc4ea]\)/g],Pt=function(e){return Nt.some((function(t){return t.test(e)}))},Lt=["\u0443\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u0435","\u0444\u043e\u0440\u043c\u0443\u043b\u0430","\u0438\u043d\u0442\u0435\u0433\u0440\u0430\u043b","\u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u043d\u0430\u044f","\u0444\u0443\u043d\u043a\u0446\u0438\u044f","\u0442\u0435\u043e\u0440\u0435\u043c\u0430","\u043b\u0435\u043c\u043c\u0430","\u0434\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c\u0441\u0442\u0432\u043e","\u0432\u044b\u0447\u0438\u0441\u043b\u0438\u0442\u044c","\u043d\u0430\u0439\u0442\u0438","\u043a\u043e\u0440\u0435\u043d\u044c","\u0441\u0442\u0435\u043f\u0435\u043d\u044c","\u043b\u043e\u0433\u0430\u0440\u0438\u0444\u043c","\u0441\u0438\u043d\u0443\u0441","\u043a\u043e\u0441\u0438\u043d\u0443\u0441","\u0442\u0430\u043d\u0433\u0435\u043d\u0441","\u043f\u0440\u0435\u0434\u0435\u043b","\u0441\u0443\u043c\u043c\u0430","\u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0434\u0435\u043d\u0438\u0435","\u043c\u0430\u0442\u0440\u0438\u0446\u0430","\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u0435\u043b\u044c","\u043f\u043b\u043e\u0449\u0430\u0434\u044c","\u0442\u0440\u0435\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a","\u043f\u0435\u0440\u0438\u043c\u0435\u0442\u0440","\u0434\u043b\u0438\u043d\u0430","\u0441\u0442\u043e\u0440\u043e\u043d\u0430","\u0433\u0438\u043f\u043e\u0442\u0435\u043d\u0443\u0437\u0430","\u043a\u0430\u0442\u0435\u0442","\u0440\u0430\u0434\u0438\u0443\u0441","\u0434\u0438\u0430\u043c\u0435\u0442\u0440","\u043e\u043a\u0440\u0443\u0436\u043d\u043e\u0441\u0442\u044c"],Dt=function(e){var t=e.toLowerCase();return Lt.some((function(e){return t.includes(e)}))},$t=function(e,t){return void 0===t&&(t=!0),jt(void 0,void 0,void 0,(function(){var n,r,o,a;return Bt(this,(function(i){switch(i.label){case 0:if(n={originalText:e,processedText:e,formulasDetected:0,formulas:[]},!Pt(e)&&!Dt(e))return[2,n];i.label=1;case 1:return i.trys.push([1,5,,6]),t?(r="".concat("\nAnalyze the following text and identify mathematical expressions, equations, formulas, or mathematical notation. \nConvert them to proper LaTeX format for beautiful rendering.\n\nRules:\n1. Identify mathematical expressions including:\n   - Equations (like x^2 + y^2 = z^2)\n   - Mathematical functions (sin, cos, log, etc.)\n   - Fractions, integrals, summations\n   - Greek letters (alpha, beta, pi, etc.)\n   - Mathematical symbols (\u2211, \u222b, \u221a, \xb1, \u2265, \u2264, etc.)\n   - Exponents and subscripts\n   - Mathematical constants (pi, e, infinity)\n\n2. Convert to LaTeX:\n   - Use $$formula$$ for display math (block formulas)\n   - Use $formula$ for inline math\n   - Proper LaTeX syntax (\\frac{}{}, \\sqrt{}, \\int, \\sum, etc.)\n\n3. Preserve the original text structure\n4. Only wrap actual mathematical content\n\n5. Return ONLY the processed text with formulas converted to LaTeX.\n   Do not add explanations or comments.\n\nText to analyze:\n",'\n\n"').concat(e,'"'),[4,(0,_t.getAIService)(Rt.l.OpenAI).translateText(r,"en")]):[3,3];case 2:return(o=i.sent())&&o!==e&&(n.processedText=o,n.formulasDetected=qt(o),n.formulas=Ut(e,o)),[3,4];case 3:n.processedText=Ht(e),n.formulasDetected=qt(n.processedText),i.label=4;case 4:return[3,6];case 5:return a=i.sent(),console.warn("Formula detection AI failed, using fallback:",a),n.processedText=Ht(e),n.formulasDetected=qt(n.processedText),[3,6];case 6:return[2,n]}}))}))},qt=function(e){return(e.match(/\$\$[^$]+\$\$/g)||[]).length+(e.match(/(?<!\$)\$[^$\n]+\$(?!\$)/g)||[]).length},Ut=function(e,t){var n=[];return Ot(Ot([],Array.from(t.matchAll(/\$\$([^$]+)\$\$/g)),!0),Array.from(t.matchAll(/(?<!\$)\$([^$\n]+)\$(?!\$)/g)),!0).forEach((function(e,t){n.push({original:e[0],latex:e[1],position:{start:e.index||0,end:(e.index||0)+e[0].length},confidence:.8})})),n},Vt=function(e){var t=e;return Object.entries({\u{1d446}:"S",\u{1d45d}:"p",\u{1d44e}:"a",\u{1d44f}:"b",\u{1d450}:"c",\u{1d465}:"x",\u{1d466}:"y",\u{1d467}:"z",\u{1d434}:"A",\u{1d435}:"B",\u{1d436}:"C",\u{1d4ae}:"S",\u{1d491}:"p",\u03c0:"pi",\u03b1:"alpha",\u03b2:"beta",\u03b3:"gamma",\u03b4:"delta",\u03b8:"theta",\u03bb:"lambda",\u03bc:"mu",\u03c3:"sigma",\u03c6:"phi",\u03c9:"omega"}).forEach((function(e){var n=e[0],r=e[1],o=new RegExp(n,"g");t=t.replace(o,r)})),t=(t=t.replace(/([a-zA-Z])\s+([=+\-*/()])/g,"$1$2")).replace(/([=+\-*/(])\s+([a-zA-Z])/g,"$1$2")},Ht=function(e){var t=e;t=(t=(t=(t=(t=(t=Vt(t)).replace(/([psPS])\s*=\s*\(([^)]+)\)\s*\/\s*(\d+)/g,"$$$$1 = \\frac{$2}{$3}$$")).replace(/\u043f\u043e\u043b\u0443\u043f\u0435\u0440\u0438\u043c\u0435\u0442\u0440\s+([psPS])\s+\u0440\u0430\u0432\u0435\u043d\s+\u043f\u043e\u043b\u043e\u0432\u0438\u043d\u0435\s+\u0441\u0443\u043c\u043c\u044b\s+\u0441\u0442\u043e\u0440\u043e\u043d[:\s]*([psPS])\s*=\s*\(([^)]+)\)\s*\/\s*(\d+)/gi,"\u041f\u043e\u043b\u0443\u043f\u0435\u0440\u0438\u043c\u0435\u0442\u0440 $1 \u0440\u0430\u0432\u0435\u043d \u043f\u043e\u043b\u043e\u0432\u0438\u043d\u0435 \u0441\u0443\u043c\u043c\u044b \u0441\u0442\u043e\u0440\u043e\u043d: $$$$2 = \\frac{$3}{$4}$$")).replace(/([Ss\u041f\u043b\u043e\u0449\u0430\u0434\u044c]*)\s*=\s*sqrt\s*\(([^)]+)\)/gi,"$$$$1 = \\sqrt{$2}$$")).replace(/\b([a-zA-Z])\^([0-9]+)\b/g,"$$$$1^{$2}$$")).replace(/\b([a-zA-Z])\^(\d+)\s*\+\s*([a-zA-Z])\^(\d+)\s*=\s*([a-zA-Z])\^(\d+)\b/g,"$$$$1^{$2} + $3^{$4} = $5^{$6}$$");Object.entries({\u0430\u043b\u044c\u0444\u0430:"\\alpha",\u0431\u0435\u0442\u0430:"\\beta",\u0433\u0430\u043c\u043c\u0430:"\\gamma",\u0434\u0435\u043b\u044c\u0442\u0430:"\\delta",\u044d\u043f\u0441\u0438\u043b\u043e\u043d:"\\epsilon",\u043f\u0438:"\\pi",\u0441\u0438\u0433\u043c\u0430:"\\sigma",\u0442\u0435\u0442\u0430:"\\theta",\u043e\u043c\u0435\u0433\u0430:"\\omega",\u043c\u044e:"\\mu",\u043b\u044f\u043c\u0431\u0434\u0430:"\\lambda",\u0444\u0438:"\\phi"}).forEach((function(e){var n=e[0],r=e[1],o=new RegExp("\\b".concat(n,"\\b"),"gi");t=t.replace(o,"$".concat(r,"$"))}));return Object.entries({alpha:"\\alpha",beta:"\\beta",gamma:"\\gamma",delta:"\\delta",epsilon:"\\epsilon",pi:"\\pi",sigma:"\\sigma",theta:"\\theta",omega:"\\omega",mu:"\\mu",lambda:"\\lambda",phi:"\\phi"}).forEach((function(e){var n=e[0],r=e[1],o=new RegExp("\\b".concat(n,"\\b"),"gi");t=t.replace(o,"$".concat(r,"$"))})),t=(t=(t=(t=(t=(t=(t=(t=t.replace(/\b(sin|cos|tan|log|ln)\s*\(([^)]+)\)/g,"$\\\\$1($2)$")).replace(/\b(\w+)\s*\/\s*(\w+)\b/g,"$\\frac{$1}{$2}$")).replace(/sqrt\s*\(([^)]+)\)/gi,"$\\sqrt{$1}$")).replace(/\u043a\u043e\u0440\u0435\u043d\u044c\s+\u0438\u0437\s+(\w+)/gi,"$\\sqrt{$1}$")).replace(/\u221a\s*([^,.\s]+)/g,"\\sqrt{$1}")).replace(/S\s*=\s*\u221a?\s*p\s*\(?\s*p\s*[-\u2212]\s*a\s*\)?\s*\(?\s*p\s*[-\u2212]\s*b\s*\)?\s*\(?\s*p\s*[-\u2212]\s*c\s*\)?/gi,"$$S = \\sqrt{p(p-a)(p-b)(p-c)}$$")).replace(/S\s*=\s*\u221a?\s*p\s*\(\s*p\s*[-\u2212]\s*a\s*\)\s*\(\s*p\s*[-\u2212]\s*b\s*\)\s*\(\s*p\s*[-\u2212]\s*c\s*\)/gi,"$$S = \\sqrt{p(p-a)(p-b)(p-c)}$$")).replace(/\(([a-zA-Z])\s*[-\u2212]\s*([a-zA-Z])\)/g,"($1 - $2)")},Wt=function(){return Wt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Wt.apply(this,arguments)},Gt=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},Yt=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}};const Xt=function(e){var t=e.content,n=e.className,o=void 0===n?"":n,i=e.style,s=void 0===i?{}:i,l=e.enableAI,c=void 0===l||l,u=e.onProcessingComplete,d=(0,r.useState)(t),p=d[0],h=d[1],f=(0,r.useState)(!1),g=f[0],m=f[1],y=(0,r.useState)(!1),v=y[0],b=y[1],x=(0,r.useRef)(null),w=(0,r.useRef)("");(0,r.useEffect)((function(){t!==w.current&&(w.current=t,S(t))}),[t,c]);var S=function(e){return Gt(void 0,void 0,void 0,(function(){var n,r,o,a,i,s,l,d;return Yt(this,(function(p){switch(p.label){case 0:if(!(null==e?void 0:e.trim()))return h(""),b(!1),null==u||u(!1),[2];console.log("\u{1f527} MathContentRenderer processing:",e),m(!0),p.label=1;case 1:if(p.trys.push([1,11,12,13]),f=function(e){for(var t="",n=0;n<e.length;){var r=e.codePointAt(n),o=String.fromCodePoint(r),a=null;r>=119808&&r<=119833?a=String.fromCharCode("A".charCodeAt(0)+(r-119808)):r>=119834&&r<=119859?a=String.fromCharCode("a".charCodeAt(0)+(r-119834)):r>=119860&&r<=119885?a=String.fromCharCode("A".charCodeAt(0)+(r-119860)):r>=119886&&r<=119911?a=String.fromCharCode("a".charCodeAt(0)+(r-119886)):r>=119912&&r<=119937?a=String.fromCharCode("A".charCodeAt(0)+(r-119912)):r>=119938&&r<=119963?a=String.fromCharCode("a".charCodeAt(0)+(r-119938)):r>=120782&&r<=120791?a=String.fromCharCode("0".charCodeAt(0)+(r-120782)):8462===r&&(a="h"),t+=null!=a?a:o,n+=o.length}return t=t.replace(/\b([A-Za-z])\s(?:[A-Za-z]\s+){2,}[A-Za-z]\b/g,(function(e){return e.replace(/\s+/g,"")}))}(f=(f=(f=e).replace(/[\u200B-\u200D\u2060\u2061\uFEFF]/g,"")).replace(/https?:\/\/[^\s]*org\/MathML[^\s]*/gi,"").replace(/\borg\s*\/\s*MathML\b/gi,"").replace(/application-tex\"?>?/gi,"").replace(/xapplication-tex/gi,"").replace(/MathMLMath/gi,"").replace(/data-tex\s*=\s*\"[^\"]*\"/gi,"").replace(/aria-hidden=\"true\"/gi,"")),n=(n=f=(f=(f=(f=(f=(f=f.replace(/https?:\/\/\s*w\s*3\s*\.\s*o\s*r\s*g\s*\/\s*1998\s*\/\s*Math\s*\/\s*MathML/gi,"").replace(/\bw\s*3\s*\.\s*o\s*r\s*g\b/gi,"").replace(/\b1998\s*org\s*\/?/gi,"").replace(/\borg\b\s*1998/gi,"").replace(/\b1998\s*\/\s*Math\s*\/\s*MathML\b/gi,"").replace(/MathMLMath/gi,"").replace(/\bMathML\b/gi,"")).replace(/xmlns\s*=\s*"[^"]*MathML[^"]*"/gi,"").replace(/display\s*=\s*"block"/gi,"").replace(/<annotation[\s\S]*?<\/annotation>/gi,"").replace(/application[^a-zA-Z]*x?[^a-zA-Z]*tex/gi,"")).replace(/<[^>]*>/g,"")).replace(/\b(semantics|mrow|mfrac|mi|mo)\b/gi,"")).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/[\u00A0\t ]+/g," ").replace(/\s*\n\s*/g," ").replace(/\s{2,}/g," ").trim()).replace(/\$\$1\s*=\s*[^$]*\$*/g,"").replace(/\xb7/g,"*").replace(/\u2212/g,"-").replace(/\$\$[^$]*$/g,""),console.log("\u{1f9f9} Cleaned text:",n),n=(n=n.replace(/(\u043f\u043e\s+\u0444\u043e\u0440\u043c\u0443\u043b\u0435\s*:|formula\s*:)[\s\n]*([^\n]+?)(?=(\n|\.|$))/gi,(function(e,t,n){var r=n.replace(/\^(\d+)/g,"^{$1}").trim();return"".concat(t,"\n$$").concat(r,"$$")}))).replace(/(^|\n)\s*([A-Za-z\u0410-\u042f\u0430-\u044f][A-Za-z\u0410-\u042f\u0430-\u044f0-9_\s\(\)\^+\-\\\/\*\xb7=]+=[^\n]+)\s*(?=\n|$)/g,(function(e,t,n){var r=n.replace(/\xb7/g,"\\cdot").replace(/\^(\d+)/g,"^{$1}").trim();return"".concat(t,"$$").concat(r,"$$")})),r=function(e){console.log("\u{1f50d} Force formula detection for:",e);var t=e;return t=Vt(t),console.log("\u{1f524} After Unicode conversion:",t),t=(t=(t=(t=(t=(t=t.replace(/\$\$1\s*=\s*\\frac\{?\(?(a\s*\+\s*b\s*\+\s*c)\)?\}?\{?2\}?\$*/g,"$$p = \\frac{a + b + c}{2}$$")).replace(/\$\$1\s*=\s*\\sqrt\{[^}]*$/g,"$$S = \\sqrt{p \\cdot (p - a) \\cdot (p - b) \\cdot (p - c)}$$")).replace(/\xb7/g,"\\cdot")).replace(/\u2212/g,"-")).replace(/\u043f\u043e\u043b\u0443\u043f\u0435\u0440\u0438\u043c\u0435\u0442\u0440\s+([pP])\s+\u0440\u0430\u0432\u0435\u043d\s+\u043f\u043e\u043b\u043e\u0432\u0438\u043d\u0435\s+\u0441\u0443\u043c\u043c\u044b\s+\u0441\u0442\u043e\u0440\u043e\u043d[:\s]*\$?\$?1?\s*=\s*\\?frac\{?\(?(a\s*\+\s*b\s*\+\s*c)\)?\}?\{?2\}?\$?/gi,"\u041f\u043e\u043b\u0443\u043f\u0435\u0440\u0438\u043c\u0435\u0442\u0440 $1 \u0440\u0430\u0432\u0435\u043d \u043f\u043e\u043b\u043e\u0432\u0438\u043d\u0435 \u0441\u0443\u043c\u043c\u044b \u0441\u0442\u043e\u0440\u043e\u043d: $$p = \\frac{a + b + c}{2}$$")).replace(/\u0432\u044b\u0440\u043e\u0436\u0435\u043d\u0438\u0435\s+\u043f\u043b\u043e\u0449\u0430\u0434\u0438\s+\u0440\u0435\u0430\u043b\u0438\u0437\u0443\u0435\u0442\u0441\u044f\s+\u0447\u0435\u0440\u0435\u0437\s+\u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0434\u0435\u043d\u0438\u0435[^:]*:\s*\$\$1\s*=\s*\\sqrt\{[^}]*\$*/gi,"\u0412\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043f\u043b\u043e\u0449\u0430\u0434\u0438 \u0440\u0435\u0430\u043b\u0438\u0437\u0443\u0435\u0442\u0441\u044f \u0447\u0435\u0440\u0435\u0437 \u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0434\u0435\u043d\u0438\u0435: $$S = \\sqrt{p \\cdot (p - a) \\cdot (p - b) \\cdot (p - c)}$$"),(t=(t=(t=(t=Ht(t)).replace(/\u0444\u043e\u0301?\u0440\u043c\u0443\u043b\u0430\s+\u0433\u0435\u0440\u043e\u043d\u0430[^:]*:\s*S\s*=\s*p\s*\(\s*p\s*[-\u2212]\s*a\s*\)\s*\(\s*p\s*[-\u2212]\s*b\s*\)\s*\(\s*p\s*[-\u2212]\s*c\s*\)\s*,?/gi,"\u0424\u043e\u0440\u043c\u0443\u043b\u0430 \u0413\u0435\u0440\u043e\u043d\u0430: $$S = \\sqrt{p(p-a)(p-b)(p-c)}$$,")).replace(/S\s*=\s*p\s*\(\s*p\s*[-\u2212]\s*a\s*\)\s*\(\s*p\s*[-\u2212]\s*b\s*\)\s*\(\s*p\s*[-\u2212]\s*c\s*\)\s*,?\s*/gi,"$$S = \\sqrt{p(p-a)(p-b)(p-c)}$$")).replace(/\u0442\u0435\u043e\u0440\u0435\u043c\u0430\s+\u043f\u0438\u0444\u0430\u0433\u043e\u0440\u0430[:\s]*([^.!?]*)/gi,"\u0422\u0435\u043e\u0440\u0435\u043c\u0430 \u041f\u0438\u0444\u0430\u0433\u043e\u0440\u0430: $$a^2 + b^2 = c^2$$")).includes("\\sqrt{p(p-a)(p-b)(p-c)}")||t.includes("\\sqrt{p \\cdot (p - a)")||(t=t.replace(/S\s*=\s*\\?sqrt\s*\{?([^}]*)\}?/gi,"$$S = \\sqrt{$1}$$")),console.log("\u2705 Processed result:",t),t}(n),r=r.replace(/\\{2,}([A-Za-z]+)/g,"\\$1").replace(/\\{2,}\{/g,"\\{").replace(/\\{2,}\}/g,"\\}").replace(/\\{2,}\^/g,"\\^").replace(/\\{2,}_/g,"\\_").replace(/\\{2,}\$/g,"\\$").replace(/\\{2,}mathbb/g,"\\mathbb").replace(/\\{2,}mathcal/g,"\\mathcal").replace(/\\{2,}times/g,"\\times").replace(/\\{2,}sum/g,"\\sum"),o=(r.match(/\$\$[^$]+\$\$/g)||[]).length+(r.match(/(?<!\$)\$[^$\n]+\$(?!\$)/g)||[]).length,console.log("\u{1f4ca} Found formulas:",o),b(o>0),0!==o)return[3,9];if(!c||!function(e){return Pt(e)||Dt(e)||e.length>50}(e))return[3,7];p.label=2;case 2:return p.trys.push([2,4,,6]),console.log("\u{1f916} Trying AI formula detection..."),[4,$t(e,!0)];case 3:return(s=p.sent()).formulasDetected>0&&(r=s.processedText,b(!0),console.log("\u2705 AI found formulas:",s.formulasDetected)),[3,6];case 4:return a=p.sent(),console.warn("\u274c AI formula detection failed, using simple rules:",a),[4,$t(e,!1)];case 5:return i=p.sent(),r=i.processedText,b(i.formulasDetected>0),[3,6];case 6:return[3,9];case 7:return console.log("\u{1f4dd} Using simple formula rules..."),[4,$t(e,!1)];case 8:s=p.sent(),r=s.processedText,b(s.formulasDetected>0),p.label=9;case 9:return console.log("\u{1f3a8} Rendering with KaTeX:",r),[4,(0,zt.processLatexInContentAsync)(r)];case 10:return l=p.sent(),console.log("\u2728 Final rendered content:",l),h(l),null==u||u(v),[3,13];case 11:return d=p.sent(),console.error("\u274c Content processing error:",d),h(t),b(!1),null==u||u(!1),[3,13];case 12:return m(!1),[7];case 13:return[2]}var f}))}))};var k=Wt({lineHeight:"1.6",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',color:"#374151",fontSize:"14px",wordWrap:"break-word"},s),C=g?{opacity:.7,transition:"opacity 0.2s ease"}:{};return(0,a.jsxs)("div",Wt({ref:x,className:"math-content-renderer ".concat(o," ").concat(v?"has-formulas":""),style:Wt(Wt({},k),C)},{children:[g&&v&&(0,a.jsx)("div",Wt({style:{position:"absolute",top:"2px",right:"2px",fontSize:"10px",color:"#6B7280",background:"rgba(255,255,255,0.8)",padding:"1px 4px",borderRadius:"2px",fontWeight:"500"}},{children:"Rendering math..."})),(0,a.jsx)("div",{dangerouslySetInnerHTML:{__html:p},style:{position:"relative"}}),(0,a.jsx)("style",{children:"\n                .math-content-renderer .katex {\n                    font-size: 1.1em !important;\n                    color: #1f2937 !important;\n                }\n                \n                .math-content-renderer .katex-display {\n                    margin: 16px 0 !important;\n                    padding: 12px !important;\n                    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%) !important;\n                    border-radius: 8px !important;\n                    border: 1px solid #e2e8f0 !important;\n                    box-shadow: 0 1px 3px rgba(0,0,0,0.1) !important;\n                    position: relative !important;\n                    overflow-x: auto !important;\n                }\n                \n                .math-content-renderer .katex-display::before {\n                    content: '';\n                    position: absolute;\n                    top: 8px;\n                    right: 8px;\n                    width: 12px;\n                    height: 12px;\n                    background: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"%236B7280\"><path d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z\"/></svg>') no-repeat center;\n                    background-size: contain;\n                    opacity: 0.3;\n                }\n                \n                .math-content-renderer .katex:not(.katex-display) {\n                    background: rgba(99, 102, 241, 0.1) !important;\n                    padding: 2px 4px !important;\n                    border-radius: 4px !important;\n                    margin: 0 1px !important;\n                    font-weight: 500 !important;\n                }\n                \n                .math-content-renderer code {\n                    background: #f3f4f6 !important;\n                    padding: 2px 6px !important;\n                    border-radius: 4px !important;\n                    font-family: 'SF Mono', Monaco, 'Inconsolata', 'Roboto Mono', Consolas, 'Courier New', monospace !important;\n                    font-size: 0.9em !important;\n                    color: #4b5563 !important;\n                    border: 1px solid #e5e7eb !important;\n                }\n                \n                .math-content-renderer pre {\n                    background: #1f2937 !important;\n                    color: #f9fafb !important;\n                    padding: 16px !important;\n                    border-radius: 8px !important;\n                    overflow-x: auto !important;\n                    margin: 12px 0 !important;\n                    font-family: 'SF Mono', Monaco, 'Inconsolata', 'Roboto Mono', Consolas, 'Courier New', monospace !important;\n                    font-size: 0.9em !important;\n                    line-height: 1.5 !important;\n                    box-shadow: 0 4px 6px rgba(0,0,0,0.1) !important;\n                }\n                \n                .math-content-renderer img {\n                    max-width: 100% !important;\n                    height: auto !important;\n                    border-radius: 6px !important;\n                    box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;\n                    margin: 8px 0 !important;\n                }\n                \n                .math-content-renderer h1,\n                .math-content-renderer h2,\n                .math-content-renderer h3 {\n                    color: #1f2937 !important;\n                    font-weight: 600 !important;\n                    margin: 16px 0 8px 0 !important;\n                }\n                \n                .math-content-renderer p {\n                    margin: 8px 0 !important;\n                    line-height: 1.6 !important;\n                }\n                \n                .math-content-renderer ul,\n                .math-content-renderer ol {\n                    margin: 8px 0 !important;\n                    padding-left: 20px !important;\n                }\n                \n                .math-content-renderer li {\n                    margin: 4px 0 !important;\n                }\n                \n                .math-content-renderer blockquote {\n                    border-left: 4px solid #e5e7eb !important;\n                    margin: 12px 0 !important;\n                    padding: 8px 16px !important;\n                    background: #f9fafb !important;\n                    color: #6b7280 !important;\n                    font-style: italic !important;\n                    border-radius: 0 4px 4px 0 !important;\n                }\n                \n                .math-content-renderer.has-formulas {\n                    min-height: 40px;\n                }\n                \n                @media (max-width: 640px) {\n                    .math-content-renderer .katex {\n                        font-size: 1em !important;\n                    }\n                    \n                    .math-content-renderer .katex-display {\n                        margin: 12px 0 !important;\n                        padding: 8px !important;\n                        font-size: 0.9em !important;\n                    }\n                }\n            "})]}))};var Kt=function(){return Kt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Kt.apply(this,arguments)};const Qt=function(e){var t=e.content,n=e.isEditable,r=void 0!==n&&n,o=e.onEditClick;return(0,a.jsxs)("div",Kt({className:"grammar-card-container",style:{position:"relative"},onClick:function(e){e.stopPropagation()}},{children:[(0,a.jsx)("div",{className:"grammar-card grammar-reference",dangerouslySetInnerHTML:{__html:t||""},onClick:function(e){e.stopPropagation()}}),r&&o&&(0,a.jsxs)("button",Kt({onClick:function(e){e.stopPropagation(),o()},style:{position:"absolute",top:"8px",right:"8px",background:"rgba(255, 255, 255, 0.8)",border:"1px solid #E5E7EB",color:"#3B82F6",fontSize:"12px",padding:"4px 8px",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",borderRadius:"4px",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"}},{children:[(0,a.jsx)(ct,{size:12}),"Edit"]}))]}))};var Jt=function(){return Jt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Jt.apply(this,arguments)},Zt={TRANSLATING_TEXT:{title:"Translating text...",subtitle:"Converting your text to the target language",icon:"\u{1f30d}",color:"#3B82F6",steps:[{title:"Preparing translation...",subtitle:"Setting up translation parameters"},{title:"Sending to translation AI...",subtitle:"Communicating with OpenAI servers"},{title:"Processing translation...",subtitle:"AI is analyzing and translating your text"},{title:"Finalizing translation...",subtitle:"Applying final touches to the translation"}]},TRANSLATING_EXAMPLES:{title:"Translating examples...",subtitle:"Making example sentences available in your language",icon:"\u{1f4dd}",color:"#10B981",steps:[{title:"Preparing examples...",subtitle:"Organizing example sentences for translation"},{title:"Translating examples...",subtitle:"Converting examples to your target language"},{title:"Processing translations...",subtitle:"Ensuring translation quality and accuracy"}]},GENERATING_EXAMPLES:{title:"Generating examples...",subtitle:"Creating meaningful example sentences for better understanding",icon:"\u{1f4a1}",color:"#F59E0B",steps:[{title:"Analyzing word context...",subtitle:"Understanding word usage and meaning"},{title:"Creating example prompts...",subtitle:"Preparing AI prompts for example generation"},{title:"Generating examples...",subtitle:"AI is crafting relevant example sentences"},{title:"Refining examples...",subtitle:"Ensuring examples are clear and educational"}]},ANALYZING_WORD_FOR_IMAGE:{title:"Analyzing word...",subtitle:"Determining if this is a concept or object for optimal visualization",icon:"\u{1f50d}",color:"#8B5CF6",steps:[{title:"Classifying word type...",subtitle:"Determining if word represents concept or object"},{title:"Evaluating visual potential...",subtitle:"Assessing how well this can be visualized"},{title:"Preparing visualization strategy...",subtitle:"Choosing optimal image generation approach"}]},CREATING_IMAGE_DESCRIPTION:{title:"Creating image description...",subtitle:"Crafting detailed prompts for AI image generation",icon:"\u{1f3a8}",color:"#EC4899",steps:[{title:"Building image prompt...",subtitle:"Creating detailed description for image generation"},{title:"Optimizing prompt...",subtitle:"Refining prompt for best AI image results"},{title:"Finalizing description...",subtitle:"Preparing final prompt for image generation"}]},GENERATING_IMAGE:{title:"Generating image...",subtitle:"AI is creating a beautiful illustration just for you",icon:"\u{1f5bc}\ufe0f",color:"#6366F1",steps:[{title:"Sending to image AI...",subtitle:"Transmitting prompt to OpenAI DALL-E"},{title:"AI generating image...",subtitle:"Neural network is creating your custom illustration"},{title:"Processing image...",subtitle:"Applying final touches and optimizations"},{title:"Preparing image for display...",subtitle:"Finalizing image for your flashcard"}]},GENERATING_CARD_CONTENT:{title:"Generating card content...",subtitle:"AI is analyzing your text and creating the perfect flashcard",icon:"\u{1f9e0}",color:"#3B82F6",steps:[{title:"Analyzing input text...",subtitle:"Understanding the content and context"},{title:"Extracting key information...",subtitle:"Identifying main concepts and details"},{title:"Structuring card content...",subtitle:"Organizing information for optimal learning"},{title:"Generating front side...",subtitle:"Creating effective question or prompt"},{title:"Generating back side...",subtitle:"Developing comprehensive answer or explanation"},{title:"Finalizing card format...",subtitle:"Ensuring proper flashcard structure"}]},GENERATING_FRONT_SIDE:{title:"Creating front side...",subtitle:"Crafting an effective question or prompt",icon:"\u2753",color:"#10B981",steps:[{title:"Designing question format...",subtitle:"Choosing optimal question structure"},{title:"Crafting question text...",subtitle:"Writing clear and effective question"},{title:"Optimizing for learning...",subtitle:"Ensuring question promotes active recall"}]},GENERATING_BACK_SIDE:{title:"Creating back side...",subtitle:"Developing comprehensive answers and explanations",icon:"\u{1f4d6}",color:"#F59E0B",steps:[{title:"Compiling answer content...",subtitle:"Gathering comprehensive information"},{title:"Structuring explanation...",subtitle:"Organizing answer for clarity"},{title:"Adding learning elements...",subtitle:"Including helpful context and examples"}]},SAVING_TO_ANKI:{title:"Saving to Anki...",subtitle:"Your card is being added to your Anki collection",icon:"\u{1f4be}",color:"#EF4444",steps:[{title:"Connecting to Anki...",subtitle:"Establishing connection with Anki application"},{title:"Validating card data...",subtitle:"Ensuring card format is correct"},{title:"Saving to collection...",subtitle:"Adding card to your Anki deck"},{title:"Confirming save...",subtitle:"Verifying card was saved successfully"}]},CONNECTING_TO_ANKI:{title:"Connecting to Anki...",subtitle:"Establishing connection with your Anki application",icon:"\u{1f517}",color:"#6366F1",steps:[{title:"Locating Anki application...",subtitle:"Finding Anki on your system"},{title:"Establishing connection...",subtitle:"Setting up communication with Anki"},{title:"Verifying connection...",subtitle:"Ensuring stable connection is established"}]},DETECTING_LANGUAGE:{title:"Detecting language...",subtitle:"Analyzing text to determine the source language",icon:"\u{1f524}",color:"#8B5CF6",steps:[{title:"Analyzing text patterns...",subtitle:"Examining linguistic characteristics"},{title:"Identifying language...",subtitle:"Determining the most likely language"},{title:"Confirming detection...",subtitle:"Validating language identification"}]},PROCESSING_REQUEST:{title:"Processing your request...",subtitle:"Please wait while we work our magic",icon:"\u26a1",color:"#6B7280",steps:[{title:"Initializing request...",subtitle:"Setting up your request parameters"},{title:"Processing...",subtitle:"Working on your request"},{title:"Almost done...",subtitle:"Finalizing your request"}]},FINALIZING:{title:"Finalizing...",subtitle:"Putting everything together nicely",icon:"\u2728",color:"#10B981",steps:[{title:"Assembling results...",subtitle:"Combining all processed information"},{title:"Applying final touches...",subtitle:"Making everything look perfect"},{title:"Ready!",subtitle:"Your request has been completed successfully"}]}},en=function(e,t){var n=Zt[e],r=n.steps||[];if(!t||t<=0)return Jt(Jt({},n),{currentStep:0,totalSteps:r.length,currentStepTitle:n.title,currentStepSubtitle:n.subtitle});var o=r[Math.min(t-1,r.length-1)];return Jt(Jt({},n),{currentStep:t,totalSteps:r.length,currentStepTitle:(null==o?void 0:o.title)||n.title,currentStepSubtitle:(null==o?void 0:o.subtitle)||n.subtitle})},tn=(function(){function e(e,t){this.currentStep=0,this.startTime=Date.now(),this.operation=e,this.onProgressUpdate=t,this.startTime=Date.now()}e.prototype.nextStep=function(){this.currentStep++;var e=en(this.operation,this.currentStep);return this.onProgressUpdate&&e&&this.onProgressUpdate(e),e},e.prototype.setStep=function(e){this.currentStep=e;var t=en(this.operation,this.currentStep);return this.onProgressUpdate&&t&&this.onProgressUpdate(t),t},e.prototype.getCurrentProgress=function(){return en(this.operation,this.currentStep)},e.prototype.getElapsedTime=function(){return Math.floor((Date.now()-this.startTime)/1e3)},e.prototype.isComplete=function(){var e=Zt[this.operation].steps||[];return this.currentStep>=e.length},e.prototype.reset=function(){this.currentStep=0,this.startTime=Date.now()}}(),function(){return tn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},tn.apply(this,arguments)}),nn=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))};const rn=function(e){var t=e.front,n=e.back,o=e.translation,i=e.examples,s=e.imageUrl,l=e.image,c=e.linguisticInfo,u=e.transcription,d=e.onNewImage,p=e.onNewExamples,h=e.onAccept,f=e.onViewSavedCards,g=e.onCancel,m=e.mode,y=void 0===m?X.d.LanguageLearning:m,v=e.loadingNewImage,b=e.loadingNewExamples,x=e.loadingAccept,w=e.loadingGetResult,S=void 0!==w&&w,k=(e.shouldGenerateImage,e.isSaved),C=void 0!==k&&k,E=(e.isEdited,e.isGeneratingCard),A=e.setTranslation,I=e.setBack,T=e.setExamples,M=e.setLinguisticInfo,F=e.hideActionButtons,z=void 0!==F&&F,_=e.createdAt,R=(0,r.useState)(!1),j=R[0],B=R[1],O=(0,r.useState)(o||""),N=O[0],P=O[1],L=(0,r.useState)(!1),D=L[0],$=L[1],q=(0,r.useState)(n||""),U=q[0],V=q[1],H=(0,r.useState)(!1),W=H[0],G=H[1],Y=(0,r.useState)(!0),K=(Y[0],Y[1],(0,r.useState)(!0)),Q=K[0],J=K[1],Z=(0,r.useState)(null),ee=Z[0],te=Z[1],ne=(0,r.useState)(null),re=ne[0],oe=ne[1],ae=(0,r.useState)(null),ie=ae[0],se=ae[1];(0,r.useEffect)((function(){P(o||"")}),[o]),(0,r.useEffect)((function(){V(n||"")}),[n]),(0,r.useEffect)((function(){te(v?en("GENERATING_IMAGE",1):null)}),[v]),(0,r.useEffect)((function(){oe(b?en("GENERATING_EXAMPLES",1):null)}),[b]),(0,r.useEffect)((function(){se(x?en("SAVING_TO_ANKI",1):null)}),[x]),(0,r.useEffect)((function(){Me(c||"")}),[c]);var le=function(){G(!0)},ce=function(){if(j&&A&&(A(N),B(!1)),D&&I&&(I(U),$(!1)),null!==ve&&T){var e=nn([],i,!0);e[ve]=[we,ke],T(e),be(null)}Ee&&M&&(M(Te),Ae(!1)),C&&h(),G(!1)},ue=function(){W&&(B(!0),P(o||""))},de=function(){A&&A(N),B(!1)},pe=function(){W&&($(!0),V(n||""))},he=function(){I&&I(U),$(!1)},fe=function(e,t,n){if(W&&T&&i){var r=nn([],i,!0);t?r[e][0]=n:r[e][1]=n||null,T(r)}},ge=(0,r.useState)(!1),me=(ge[0],ge[1],(0,r.useState)(o||"")),ye=(me[0],me[1],(0,r.useState)(null)),ve=ye[0],be=ye[1],xe=(0,r.useState)(""),we=xe[0],Se=(xe[1],(0,r.useState)("")),ke=Se[0],Ce=(Se[1],(0,r.useState)(!1)),Ee=Ce[0],Ae=Ce[1],Ie=(0,r.useState)(c||""),Te=Ie[0],Me=Ie[1];return(0,a.jsxs)("div",tn({style:{padding:"16px",borderRadius:"8px",width:"100%",maxWidth:"100%",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",overflowX:"hidden",backgroundColor:W?"#FAFAFA":"#ffffff",boxSizing:"border-box",borderLeft:W?"3px solid #3B82F6":"3px solid transparent"}},{children:[(0,a.jsxs)("div",tn({style:{fontSize:"10px",color:"#9CA3AF",marginBottom:"12px",textAlign:"right",display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"4px",padding:"6px 8px",backgroundColor:W?"#EFF6FF":C?"#ECFDF5":"#F9FAFB",borderRadius:"4px",border:W?"1px solid #DBEAFE":C?"1px solid #D1FAE5":"1px solid #F3F4F6"}},{children:[(0,a.jsxs)("div",tn({style:{display:"flex",alignItems:"center",gap:"4px"}},{children:[(0,a.jsx)("span",{style:{display:"inline-block",width:"8px",height:"8px",borderRadius:"50%",backgroundColor:W?"#3B82F6":C?"#10B981":"#6B7280"}}),(0,a.jsx)("strong",tn({style:{color:W?"#1E40AF":C?"#059669":"#4B5563"}},{children:W?"Editing":C?"Saved to Collection":"New - Not Saved Yet"}))]})),(0,a.jsxs)("div",tn({style:{fontSize:"9px",color:"#9CA3AF",fontStyle:"italic",display:"flex",alignItems:"center",gap:"3px"}},{children:[(0,a.jsx)("span",{children:"\u{1f4c5}"}),(_||new Date).toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]}))]})),W?(0,a.jsxs)("button",tn({onClick:ce,disabled:x,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",backgroundColor:"#3B82F6",color:"white",border:"none",borderRadius:"6px",padding:"10px 12px",fontSize:"14px",fontWeight:"600",cursor:"pointer",marginBottom:"12px",width:"100%",opacity:x?.7:1},onMouseOver:function(e){return!x&&(e.currentTarget.style.backgroundColor="#2563EB")},onMouseOut:function(e){return!x&&(e.currentTarget.style.backgroundColor="#3B82F6")}},{children:[(0,a.jsx)(Ct,{size:14}),x?(0,a.jsxs)("div",tn({style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"}},{children:[(0,a.jsx)(Ft,{type:"spinner",size:"small",inline:!0,color:"#ffffff"}),(0,a.jsx)("span",tn({style:{fontSize:"12px",fontWeight:"500"}},{children:(null==ie?void 0:ie.currentStepTitle)||(null==ie?void 0:ie.title)||"Saving"}))]})):C?"Save & Finish Editing":"Finish Editing"]})):W?null:(0,a.jsxs)("button",tn({onClick:le,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",backgroundColor:"#F3F4F6",color:"#4B5563",border:"1px solid #E5E7EB",borderRadius:"6px",padding:"10px 12px",fontSize:"14px",fontWeight:"600",cursor:"pointer",marginBottom:"12px",width:"100%"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#E5E7EB",e.currentTarget.style.color="#1F2937"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.color="#4B5563"}},{children:[(0,a.jsx)(ct,{size:14}),"Edit Card"]})),W?(0,a.jsxs)("div",tn({style:{marginBottom:"16px",backgroundColor:"#EFF6FF",borderRadius:"6px",padding:"10px",border:"1px solid #DBEAFE",fontSize:"13px",color:"#1E40AF"}},{children:[(0,a.jsxs)("div",tn({style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"6px",fontWeight:"600"}},{children:[(0,a.jsx)(ct,{size:12}),"Editing Mode"]})),(0,a.jsxs)("p",tn({style:{margin:0,fontSize:"12px"}},{children:['Click on text elements to edit them. When finished, click "',C?"Save & Finish Editing":"Finish Editing",'" at the top of the card.']}))]})):null,t&&(0,a.jsx)("div",tn({style:{marginBottom:"12px"}},{children:y===X.d.GeneralTopic||/\\(frac|sqrt|sum|int|prod|log|ln|sin|cos|tan|cot|arctan|arcsin|arccos|sinh|cosh|tanh)\b|\$|\\\[|\\\(|\)|\[|\]/.test(t)?(0,a.jsx)("div",tn({style:{textAlign:"left",padding:"10px",backgroundColor:"#F3F4F6",borderRadius:"8px"}},{children:(0,a.jsx)(Xt,{content:t,enableAI:!0,style:{fontSize:"16px",color:"#111827"}})})):t.includes("/")?function(){var e,n=t.split(/\s*\//),r=(null===(e=n[0])||void 0===e?void 0:e.trim())||"",o=n.length>1?"/".concat(n.slice(1).join("/").replace(/\/$/,"")):"";return(0,a.jsxs)("div",tn({style:{textAlign:"center",padding:"12px",backgroundColor:"#F3F4F6",borderRadius:"8px"}},{children:[(0,a.jsx)("h3",tn({style:{fontSize:"20px",fontWeight:"700",margin:"0 0 6px 0",color:"#111827"}},{children:r})),o&&(0,a.jsx)("div",tn({style:{fontSize:"14px",color:"#6B7280",fontStyle:"italic"}},{children:o}))]}))}():(0,a.jsx)("h3",tn({style:{fontSize:"18px",fontWeight:"600",textAlign:"center",margin:"2px 0",color:"#111827",padding:"10px",backgroundColor:"#F3F4F6",borderRadius:"8px"}},{children:t}))})),u&&(0,a.jsx)("div",tn({style:{marginBottom:"12px",textAlign:"center",padding:"8px 12px",backgroundColor:"#F8FAFC",border:"1px solid #E2E8F0",borderRadius:"6px"}},{children:(0,a.jsx)("div",{style:{fontSize:"14px",lineHeight:"1.6",color:"#475569"},dangerouslySetInnerHTML:{__html:u}})})),(y===X.d.LanguageLearning?o:n)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("hr",{style:{margin:"10px 0",border:"none",borderTop:"1px solid #E5E7EB"}}),(y===X.d.LanguageLearning?j:D)&&W?(0,a.jsxs)("div",tn({style:{marginBottom:"12px",position:"relative"}},{children:[y===X.d.LanguageLearning?(0,a.jsx)("input",{type:"text",value:N,onChange:function(e){return P(e.target.value)},style:{width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #3B82F6",backgroundColor:"#ffffff",color:"#111827",fontSize:"14px",outline:"none",fontWeight:"600",textAlign:"center"},autoFocus:!0,onBlur:de,onKeyDown:function(e){"Enter"===e.key&&de()}}):(0,a.jsx)("textarea",{value:U,onChange:function(e){return V(e.target.value)},style:{width:"100%",minHeight:"120px",padding:"12px",borderRadius:"6px",border:"1px solid #3B82F6",backgroundColor:"#ffffff",color:"#111827",fontSize:"14px",outline:"none",fontWeight:"400",lineHeight:"1.5",resize:"vertical"},autoFocus:!0,onBlur:he,onKeyDown:function(e){"Enter"===e.key&&e.ctrlKey&&he()}}),(0,a.jsx)("div",tn({style:{fontSize:"11px",color:"#6B7280",textAlign:"center",marginTop:"4px"}},{children:y===X.d.LanguageLearning?"Press Enter or click outside to save":"Press Ctrl+Enter or click outside to save"}))]})):(0,a.jsxs)("div",tn({style:tn({marginBottom:"12px",textAlign:y===X.d.LanguageLearning?"center":"left",position:"relative",paddingRight:W?"24px":"0"},W?{padding:"8px",border:"1px dashed #E5E7EB",borderRadius:"4px",transition:"all 0.2s ease",cursor:"pointer",backgroundColor:"#FAFAFA"}:{}),onClick:W?y===X.d.LanguageLearning?ue:pe:void 0,onMouseOver:function(e){W&&(e.currentTarget.style.borderColor="#3B82F6",e.currentTarget.style.backgroundColor="#F9FAFB")},onMouseOut:function(e){W&&(e.currentTarget.style.borderColor="#E5E7EB",e.currentTarget.style.backgroundColor="#FAFAFA")}},{children:[y===X.d.LanguageLearning?(0,a.jsx)("p",tn({style:{fontWeight:"600",color:"#111827",fontSize:"14px",margin:0}},{children:o})):(0,a.jsx)(Xt,{content:n||"",enableAI:!0,style:{color:"#111827",fontSize:"14px",lineHeight:"1.6",margin:0}}),W&&(0,a.jsx)("button",tn({onClick:function(e){e.stopPropagation(),y===X.d.LanguageLearning?ue():pe()},style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",background:"#F3F4F6",border:"none",borderRadius:"4px",cursor:"pointer",color:"#6B7280",display:"flex",padding:"4px",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},title:y===X.d.LanguageLearning?"Edit translation":"Edit content",onMouseOver:function(e){e.currentTarget.style.backgroundColor="#E5E7EB",e.currentTarget.style.color="#3B82F6"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.color="#6B7280"}},{children:(0,a.jsx)(wt,{size:12})}))]}))]}),c&&(0,a.jsxs)("div",tn({style:{marginTop:"12px",marginBottom:"16px",borderRadius:"10px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.05)",border:"1px solid",borderColor:Q?"#BFDBFE":"#E5E7EB",backgroundColor:Q?"#EFF6FF":"#F9FAFB",transition:"all 0.3s ease",overflow:"hidden"}},{children:[(0,a.jsxs)("div",tn({style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",borderBottom:Q?"1px solid #BFDBFE":"none",transition:"background-color 0.2s"}},{children:[(0,a.jsxs)("div",tn({style:{display:"flex",alignItems:"center",gap:"10px",fontWeight:600,fontSize:"14px",color:Q?"#1D4ED8":"#4B5563",flex:1}},{children:[(0,a.jsx)(ft,{size:16,color:Q?"#2563EB":"#6B7280"}),(0,a.jsx)("span",{children:"Grammar & Linguistics"})]})),(0,a.jsx)("button",tn({onClick:function(e){e.stopPropagation(),J(!Q)},style:{background:"none",border:"none",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px",transition:"background-color 0.2s"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="rgba(0,0,0,0.05)"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="transparent"}},{children:Q?(0,a.jsx)(rt,{size:14,color:"#6B7280"}):(0,a.jsx)(et,{size:14,color:"#6B7280"})}))]})),Q&&(0,a.jsx)("div",tn({style:{padding:"16px"}},{children:Ee?(0,a.jsxs)("div",tn({style:{width:"100%"}},{children:[(0,a.jsx)("textarea",{value:Te,onChange:function(e){Me(e.target.value)},style:{width:"100%",minHeight:"120px",padding:"10px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",fontSize:"14px",lineHeight:"1.5",resize:"vertical",marginBottom:"8px"}}),(0,a.jsxs)("div",tn({style:{display:"flex",justifyContent:"flex-end",gap:"8px"}},{children:[(0,a.jsx)("button",tn({onClick:function(){Me(c||""),Ae(!1)},style:{padding:"6px 12px",backgroundColor:"#F3F4F6",color:"#4B5563",border:"1px solid #E5E7EB",borderRadius:"6px",fontSize:"13px",cursor:"pointer"}},{children:"Cancel"})),(0,a.jsx)("button",tn({onClick:function(){M&&M(Te),Ae(!1)},style:{padding:"6px 12px",backgroundColor:"#2563EB",color:"white",border:"none",borderRadius:"6px",fontSize:"13px",cursor:"pointer"}},{children:"Save"}))]}))]})):(0,a.jsx)("div",tn({style:{position:"relative"}},{children:(0,a.jsx)(Qt,{content:c||"",isEditable:W,onEditClick:function(){return Ae(!0)}})}))}))]})),i.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("hr",{style:{margin:"10px 0",border:"none",borderTop:"1px solid #E5E7EB"}}),(0,a.jsxs)("div",tn({style:{marginBottom:"12px"}},{children:[(0,a.jsx)("div",tn({style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"}},{children:(0,a.jsx)("h4",tn({style:{fontSize:"14px",fontWeight:"600",color:"#374151",margin:0}},{children:"Examples"}))})),(0,a.jsx)("ul",tn({style:{listStyle:"none",padding:0,margin:0,display:"flex",flexDirection:"column",gap:"8px"}},{children:i.map((function(e,t){var n=e[0],r=e[1];return(0,a.jsxs)("li",tn({style:tn({padding:"12px",backgroundColor:"#F9FAFB",borderRadius:"6px",position:"relative",minHeight:"auto",wordWrap:"break-word",overflow:"visible"},W?{border:"1px dashed #CBD5E1",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"}:{})},{children:[W&&(0,a.jsx)("div",tn({style:{position:"absolute",top:"8px",right:"8px",display:"flex",gap:"8px",zIndex:5}},{children:(0,a.jsxs)("button",tn({onClick:function(){return function(e){if(W&&T&&i){var t=nn([],i,!0);t.splice(e,1),T(t)}}(t)},style:{background:"#FEE2E2",border:"none",borderRadius:"4px",cursor:"pointer",color:"#EF4444",padding:"4px 6px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"11px",fontWeight:"500"},title:"Delete example",onMouseOver:function(e){e.currentTarget.style.backgroundColor="#FECACA"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#FEE2E2"}},{children:[(0,a.jsx)(Tt,{size:10,style:{marginRight:"4px"}}),"Delete"]}))})),W?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",tn({style:{marginBottom:"8px"}},{children:(0,a.jsx)("textarea",{value:n,onChange:function(e){return fe(t,!0,e.target.value)},style:{width:"100%",padding:"6px 8px",borderRadius:"4px",border:"1px solid #E5E7EB",fontSize:"13px",color:"#111827",fontWeight:"500",backgroundColor:"#ffffff",minHeight:"40px",resize:"vertical",fontFamily:"inherit",lineHeight:"1.4"},placeholder:"Example sentence"})})),(0,a.jsx)("div",{children:(0,a.jsx)("textarea",{value:r||"",onChange:function(e){return fe(t,!1,e.target.value)},style:{width:"100%",padding:"6px 8px",borderRadius:"4px",border:"1px solid #E5E7EB",fontSize:"13px",color:"#6B7280",fontStyle:"italic",backgroundColor:"#ffffff",minHeight:"40px",resize:"vertical",fontFamily:"inherit",lineHeight:"1.4"},placeholder:"Translation (optional)"})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",tn({style:{fontWeight:"500",color:"#111827",fontSize:"13px",marginBottom:r?"6px":0,lineHeight:"1.4",wordWrap:"break-word",overflow:"visible",whiteSpace:"normal"}},{children:n})),r&&(0,a.jsx)("div",tn({style:{color:"#6B7280",fontSize:"13px",fontStyle:"italic",lineHeight:"1.4",wordWrap:"break-word",overflow:"visible",whiteSpace:"normal"}},{children:r}))]})]}),t)}))})),W&&(0,a.jsxs)("button",tn({onClick:function(){if(W&&T&&i){var e=nn([],i,!0);e.push(["",null]),T(e)}},style:{width:"100%",padding:"10px",borderRadius:"6px",backgroundColor:"#EFF6FF",color:"#3B82F6",fontSize:"14px",fontWeight:"500",border:"1px dashed #BFDBFE",cursor:"pointer",marginTop:"12px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"all 0.2s ease"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#DBEAFE",e.currentTarget.style.borderColor="#93C5FD"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#EFF6FF",e.currentTarget.style.borderColor="#BFDBFE"}},{children:[(0,a.jsx)(St,{size:12}),"Add Example"]}))]}))]}),(l||s)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("hr",{style:{margin:"16px 0",border:"none",borderTop:"1px solid #E5E7EB"}}),(0,a.jsx)("div",tn({style:{marginBottom:"16px"}},{children:(0,a.jsx)("img",{src:l||s||"",alt:"",style:{width:"100%",borderRadius:"6px",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)"}})}))]}),!C&&(0,a.jsxs)("div",tn({style:{display:"flex",gap:"6px",marginBottom:"8px"}},{children:[(l||s)&&(0,a.jsx)("button",tn({onClick:d,disabled:v,style:{flex:1,padding:"8px 12px",borderRadius:"6px",backgroundColor:"#F59E0B",color:"#ffffff",fontWeight:"600",fontSize:"13px",border:"none",cursor:"pointer",transition:"all 0.2s ease",opacity:v?.7:1},onMouseOver:function(e){return!v&&(e.currentTarget.style.backgroundColor="#D97706")},onMouseOut:function(e){return!v&&(e.currentTarget.style.backgroundColor="#F59E0B")}},{children:v?(0,a.jsxs)("div",tn({style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"}},{children:[(0,a.jsx)(Ft,{type:"spinner",size:"small",inline:!0,color:"#ffffff"}),(0,a.jsx)("span",tn({style:{fontSize:"12px",fontWeight:"500"}},{children:(null==ee?void 0:ee.currentStepTitle)||(null==ee?void 0:ee.title)||"Generating"}))]})):"New Image"})),i.length>0&&(0,a.jsx)("button",tn({onClick:p,disabled:b,style:{flex:1,padding:"8px 12px",borderRadius:"6px",backgroundColor:"#F59E0B",color:"#ffffff",fontWeight:"600",fontSize:"13px",border:"none",cursor:"pointer",transition:"all 0.2s ease",opacity:b?.7:1},onMouseOver:function(e){return!b&&(e.currentTarget.style.backgroundColor="#D97706")},onMouseOut:function(e){return!b&&(e.currentTarget.style.backgroundColor="#F59E0B")}},{children:b?(0,a.jsxs)("div",tn({style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"}},{children:[(0,a.jsx)(Ft,{type:"spinner",size:"small",inline:!0,color:"#ffffff"}),(0,a.jsx)("span",tn({style:{fontSize:"12px",fontWeight:"500"}},{children:(null==re?void 0:re.currentStepTitle)||(null==re?void 0:re.title)||"Loading"}))]})):"New Examples"}))]})),!z&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",tn({style:{marginBottom:"10px"}},{children:[!W&&(!C||E||S)&&(0,a.jsxs)("div",tn({style:{display:"flex",gap:"8px",width:"100%"}},{children:[(0,a.jsxs)("button",tn({onClick:g,disabled:x,style:{flex:"1",padding:"10px",borderRadius:"6px",backgroundColor:"#F3F4F6",color:"#4B5563",fontWeight:"600",fontSize:"14px",border:"1px solid #E5E7EB",cursor:x?"not-allowed":"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",opacity:x?.7:1},onMouseOver:function(e){x||(e.currentTarget.style.backgroundColor="#E5E7EB",e.currentTarget.style.color="#374151")},onMouseOut:function(e){x||(e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.color="#4B5563")}},{children:[(0,a.jsx)(It,{}),E||S?"Cancel Generation":"Cancel"]})),!E&&!S&&(0,a.jsxs)("button",tn({onClick:h,disabled:x,style:{flex:"2",padding:"10px",borderRadius:"6px",backgroundColor:"#22C55E",color:"#ffffff",fontWeight:"600",fontSize:"14px",border:"none",cursor:"pointer",transition:"all 0.2s ease",opacity:x?.7:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},onMouseOver:function(e){return!x&&(e.currentTarget.style.backgroundColor="#15803D")},onMouseOut:function(e){return!x&&(e.currentTarget.style.backgroundColor="#22C55E")}},{children:[(0,a.jsx)(Ze,{}),x?(0,a.jsx)("div",tn({style:{display:"flex",alignItems:"center",justifyContent:"center"}},{children:(0,a.jsx)(Ft,{type:"spinner",size:"small",inline:!0,color:"#ffffff",text:"Saving"})})):"Save Card"]}))]})),!W&&C&&(0,a.jsxs)("div",tn({style:{width:"100%",padding:"10px",borderRadius:"6px",backgroundColor:"#ECFDF5",border:"1px solid #D1FAE5",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"}},{children:[(0,a.jsx)("div",tn({style:{display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",borderRadius:"50%",backgroundColor:"#10B981",color:"white"}},{children:(0,a.jsx)(Ze,{size:12})})),(0,a.jsx)("span",tn({style:{fontWeight:"600",fontSize:"14px",color:"#059669"}},{children:"Saved to Collection"}))]})),!W&&!C&&(0,a.jsx)("p",tn({style:{fontSize:"11px",color:"#6B7280",textAlign:"center",margin:"4px 0 0 0"}},{children:"The card will be saved to your collection"}))]})),(0,a.jsxs)("button",tn({onClick:f,style:{width:"100%",padding:"10px",borderRadius:"6px",backgroundColor:"#4B5563",color:"#ffffff",fontWeight:"600",fontSize:"13px",border:"none",cursor:"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="#374151"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="#4B5563"}},{children:[(0,a.jsx)(bt,{size:14}),"View Saved Cards"]}))]})]}))};var on=n(504),an=n(743),sn=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},ln=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}};function cn(e,t,n,r,o){return void 0===o&&(o=""),sn(this,void 0,void 0,(function(){var e,a,i,s,l;return ln(this,(function(c){switch(c.label){case 0:if(console.log("getImage called with description:",r),e=null,a=null,!r)throw new Error("Cannot generate image: missing description");if(!n)throw new Error("Cannot generate image: no OpenAI API key provided. Please check your settings.");c.label=1;case 1:return c.trys.push([1,7,,8]),console.log("Using OpenAI with key:",n?n.substring(0,5)+"...":"null"),[4,(0,Ue.getOpenAiImageUrl)(t,n,r,o)];case 2:if(e=c.sent(),console.log("OpenAI returned URL:",e?"success":"null"),!e)return[3,6];c.label=3;case 3:return c.trys.push([3,5,,6]),console.log("Converting image URL to base64 for permanent storage..."),[4,ne(e)];case 4:return a=c.sent(),console.log("Image URL converted to base64:",a?"success":"null"),a?console.log("\u2705 Image successfully converted to base64 - keeping both URL and base64 for reliability"):console.warn("\u26a0\ufe0f Failed to convert image to base64 - keeping temporary URL as fallback"),[3,6];case 5:return i=c.sent(),console.error("\u274c Error converting URL to base64:",i),console.warn("\u26a0\ufe0f Will use temporary URL as fallback, but it may disappear later"),[3,6];case 6:return[3,8];case 7:throw s=c.sent(),console.error("OpenAI image generation error:",s),s instanceof Error?s:new Error("Failed to generate image with OpenAI. Please check your API key and try again.");case 8:if(!e&&!a)throw new Error("Failed to generate image. Please check your API key and try again.");return l=a?null:e,console.log("Final result:",{hasBase64:!!a,hasUrl:!!l,status:a?"Base64 (permanent)":l?"URL only (temporary)":"No image"}),[2,{imageUrl:l,imageBase64:a}]}}))}))}var un=function(){return un=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},un.apply(this,arguments)};const dn=function(){var e=(0,r.useState)(null),t=e[0],n=e[1],o=(0,r.useState)("error"),i=o[0],s=o[1],l=(0,r.useState)(!1),c=l[0],u=l[1],d=(0,r.useState)(!1),p=d[0],h=d[1],f=function(){h(!1),setTimeout((function(){u(!1),n(null)}),300)};return{showError:function(e,t){void 0===t&&(t="error"),console.log("showError called:",{message:e,errorType:t,visible:c,isAnimating:p}),e?(n(e),s(t),u(!0),setTimeout((function(){h(!0)}),50),setTimeout((function(){f()}),5e3)):f()},renderErrorNotification:function(){if(!c||!t)return null;var e,n=function(){switch(i){case"success":return{icon:(0,a.jsx)(Je,{size:16}),color:"#059669",bgColor:"#ECFDF5",borderColor:"#10B981"};case"warning":return{icon:(0,a.jsx)(dt,{size:16}),color:"#D97706",bgColor:"#FFFBEB",borderColor:"#F59E0B"};case"info":return{icon:(0,a.jsx)(mt,{size:16}),color:"#2563EB",bgColor:"#EFF6FF",borderColor:"#3B82F6"};default:return{icon:(0,a.jsx)(At,{size:16}),color:"#DC2626",bgColor:"#FEF2F2",borderColor:"#EF4444"}}}(),r=n.icon,o=n.color,s=n.bgColor,l=n.borderColor,u=(e=t).includes("401")||e.includes("Unauthorized")||e.includes("Authentication")?"API Authentication failed: Please check your API key in Settings.":e.includes("429")||e.includes("Rate limit")?"API rate limit exceeded: Please try again in a few minutes.":e.includes("500")||e.includes("502")||e.includes("503")||e.includes("504")?"AI service is currently unavailable. Please try again later.":e.includes("key is missing")||e.includes("API key")?"API key is missing or invalid. Please check your settings.":e.includes("OpenAI")?"OpenAI API error: ".concat(e.split("OpenAI").pop()):e.includes("Groq")?"Groq API error: ".concat(e.split("Groq").pop()):e;return(0,a.jsxs)("div",un({style:{transform:p?"translateX(0)":"translateX(100%)",opacity:p?1:0,transition:"all 0.3s ease-out",backgroundColor:s,border:"1px solid ".concat(l),borderRadius:"12px",padding:"16px",minWidth:"280px",maxWidth:"320px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",position:"relative",display:"flex",alignItems:"flex-start",gap:"12px",marginBottom:"8px"},role:"alert","aria-live":"polite"},{children:[(0,a.jsx)("div",un({style:{color:o,marginTop:"2px",flexShrink:0}},{children:r})),(0,a.jsx)("div",un({style:{flex:1,paddingRight:"8px"}},{children:(0,a.jsx)("p",un({style:{color:"#374151",margin:0,fontSize:"14px",lineHeight:"1.5",fontWeight:500}},{children:u}))})),(0,a.jsx)("button",un({onClick:f,style:{position:"absolute",top:"8px",right:"8px",background:"transparent",border:"none",color:"#9CA3AF",cursor:"pointer",padding:"4px",borderRadius:"4px",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="rgba(0, 0, 0, 0.1)",e.currentTarget.style.color="#374151"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="#9CA3AF"},"aria-label":"Close notification"},{children:(0,a.jsx)(It,{size:12})})),(0,a.jsx)("div",un({style:{position:"absolute",bottom:0,left:0,right:0,height:"3px",backgroundColor:"rgba(0, 0, 0, 0.1)",borderRadius:"0 0 12px 12px",overflow:"hidden"}},{children:(0,a.jsx)("div",{style:{height:"100%",backgroundColor:l,width:"100%",transition:"width 5s linear",transformOrigin:"left"}})}))]}))}}};var pn=function(){return pn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},pn.apply(this,arguments)},hn=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},fn="anki_stored_cards",gn="anki_tab_cards",mn=function(e){try{return e.startsWith("data:image/")&&e.length>1e5?(console.log("Large image detected, applying basic compression"),console.warn("Large image (".concat(Math.round(e.length/1024),"KB) detected. Consider using smaller images.")),e):e}catch(t){return console.error("Error compressing image:",t),e}},yn=function(e){try{var t=JSON.stringify(e,(function(e,t){return t instanceof Date?t.toISOString():t})),n=new Blob([t]).size/1048576;if(console.log("Storage analysis: ".concat(e.length," cards, ").concat(n.toFixed(2),"MB")),n<4)return e;console.warn("Storage size is large, optimizing...");for(var r=hn([],e,!0).sort((function(e,t){return new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()})),o=[],a=0,i=0,s=r;i<s.length;i++){var l=s[i],c=JSON.stringify(l,(function(e,t){return t instanceof Date?t.toISOString():t})),u=new Blob([c]).size;if(a+u>4194304){console.warn("Stopping at ".concat(o.length," cards to stay within storage limit"));break}o.push(l),a+=u}return o}catch(t){return console.error("Error managing storage quota:",t),e}},vn=function(){console.warn("\u26a0\ufe0f Storage quota exceeded! This usually happens when you have many cards with large images."),console.warn("\u{1f4a1} To fix this:"),console.warn("   \u2022 Use smaller images"),console.warn("   \u2022 Export older cards and delete them"),console.warn("   \u2022 Consider using image URLs instead of embedded images")},bn=function(){try{var e=localStorage.getItem(fn);if(console.log("Loading cards from localStorage. Data exists:",!!e),e)try{var t=JSON.parse(e);if(console.log("Successfully parsed cards from localStorage, total count:",t.length),t.length>0){var n=t.slice(0,Math.min(3,t.length)),r=t.length>3?t.slice(-3):[];console.log("First few cards:",n.map((function(e){var t;return{id:e.id,text:null===(t=e.text)||void 0===t?void 0:t.substring(0,20)}}))),r.length>0&&console.log("Last few cards:",r.map((function(e){var t;return{id:e.id,text:null===(t=e.text)||void 0===t?void 0:t.substring(0,20)}})))}if(!Array.isArray(t))return console.error("Stored cards is not an array!",t),[];var o=t.filter((function(e){var t=!!e.id,n=!!e.text,r=!!e.createdAt;return!!(t&&n&&r)||(console.warn("Found invalid card, removing from results:",e),!1)}));console.log("Card validation: ".concat(o.length," valid out of ").concat(t.length," total"));var a=o.map((function(e){return pn(pn({},e),{createdAt:new Date(e.createdAt)})})),i=a.filter((function(e){return e.image||e.imageUrl}));return console.log("Loaded cards with images:",i.length),i.forEach((function(e){var t,n,r,o;console.log("Loaded card ".concat(e.id," image data:"),{hasImage:!!e.image,hasImageUrl:!!e.imageUrl,imageLength:null===(t=e.image)||void 0===t?void 0:t.length,imageUrlLength:null===(n=e.imageUrl)||void 0===n?void 0:n.length,imagePreview:null===(r=e.image)||void 0===r?void 0:r.substring(0,50),imageUrlPreview:null===(o=e.imageUrl)||void 0===o?void 0:o.substring(0,50)})})),a}catch(e){return console.error("JSON parse error:",e),localStorage.removeItem(fn),[]}}catch(e){console.error("Error loading cards from localStorage:",e);try{localStorage.removeItem(fn)}catch(e){console.error("Could not clean up localStorage:",e)}}return[]},xn=function(e,t,n){var r="".concat(gn,"_").concat(e);try{var o=JSON.stringify(t,(function(e,t){return t instanceof Date?t.toISOString():t}));new Blob([o]).size}catch(e){console.error("Could not determine original size:",e)}if(n instanceof DOMException&&("QuotaExceededError"===n.name||"NS_ERROR_DOM_QUOTA_REACHED"===n.name)){console.error("localStorage quota exceeded for tab ".concat(e,". Using storage optimization.")),vn();var a=yn(t);try{var i=JSON.stringify(a,(function(e,t){return t instanceof Date?t.toISOString():t}));localStorage.setItem(r,i),console.warn("Smart optimization for tab ".concat(e,": Saved ").concat(a.length," of ").concat(t.length," cards"))}catch(t){console.error("Failed to save optimized cards for tab ".concat(e,":"),t)}}};const wn=function(e){return function(t){return function(n){var r=t(n);switch(n.type){case ge:try{var o=bn();e.dispatch({type:"SET_STORED_CARDS",payload:o})}catch(t){console.error("Error in LOAD_STORED_CARDS middleware:",t),e.dispatch({type:"SET_STORED_CARDS",payload:[]})}break;case fe:case me:case be:case ve:try{!function(e){try{console.log("Saving cards to localStorage:",e),console.log("Total cards count:",e.length);var t=e.filter((function(e){return e.image||e.imageUrl}));console.log("Cards with images:",t.length),t.forEach((function(e){var t,n,r,o;console.log("Card ".concat(e.id," image data:"),{hasImage:!!e.image,hasImageUrl:!!e.imageUrl,imageLength:null===(t=e.image)||void 0===t?void 0:t.length,imageUrlLength:null===(n=e.imageUrl)||void 0===n?void 0:n.length,imagePreview:null===(r=e.image)||void 0===r?void 0:r.substring(0,50),imageUrlPreview:null===(o=e.imageUrl)||void 0===o?void 0:o.substring(0,50)})}));var n=yn(e);n.length<e.length&&console.warn("Storage optimization: keeping ".concat(n.length," of ").concat(e.length," cards to preserve images"));var r=JSON.stringify(n,(function(e,t){return t instanceof Date?t.toISOString():t})),o=new Blob([r]).size;console.log("Storage size in bytes:",o,"Approximate max size: ~5MB"),o>4194304&&console.warn("Warning: localStorage size is getting large (>4MB). This might cause issues in some browsers."),localStorage.setItem(fn,r),console.log("Cards saved successfully to localStorage with image preservation")}catch(t){console.error("Error saving cards to localStorage:",t);var a=0;try{var i=JSON.stringify(e,(function(e,t){return t instanceof Date?t.toISOString():t}));a=new Blob([i]).size}catch(e){console.error("Could not determine original size:",e)}if(t instanceof DOMException&&("QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&(console.error("localStorage quota exceeded. Cannot save more cards. Trying to preserve images by using other strategies."),vn(),e.length>0)){console.warn("CRITICAL: Storage quota exceeded. Attempting to preserve images while managing storage.");try{console.warn("Storage quota exceeded. Using intelligent optimization to preserve images...");var s=yn(e);if(s.length>0){var l=JSON.stringify(s,(function(e,t){return t instanceof Date?t.toISOString():t}));if(new Blob([l]).size<=4718592)return localStorage.setItem(fn,l),void console.warn("Smart optimization: Saved ".concat(s.length," of ").concat(e.length," cards with images preserved"))}var c=e.map((function(e){return pn(pn({},e),{image:e.image?mn(e.image):null,id:e.id,text:e.text,translation:e.translation,front:e.front,back:e.back,examples:e.examples,imageUrl:e.imageUrl,createdAt:e.createdAt,exportStatus:e.exportStatus,linguisticInfo:e.linguisticInfo,transcription:e.transcription})}));console.warn("Attempting to save cards with compressed images instead of removing them.");var u=JSON.stringify(c,(function(e,t){return t instanceof Date?t.toISOString():t})),d=new Blob([u]).size;if(console.log("Reduced size from ".concat(a," to ").concat(d," bytes")),d>4718592){console.warn("Still too large after size reduction, falling back to limiting card count");for(var p=hn([],c,!0).sort((function(e,t){return new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime()})),h=Math.min(10,p.length),f=void 0;h<p.length;){f=p.slice(0,h);var g=JSON.stringify(f,(function(e,t){return t instanceof Date?t.toISOString():t}));if(new Blob([g]).size>4718592)break;h+=5}console.warn("Emergency preservation: keeping ".concat(h," cards out of ").concat(p.length," total (removing oldest to preserve newest with images)"));var m=p.slice(-h);localStorage.setItem(fn,JSON.stringify(m,(function(e,t){return t instanceof Date?t.toISOString():t})))}else localStorage.setItem(fn,u);return void console.log("Saved cards with image preservation strategy to fit within quota")}catch(e){console.error("Failed to save with data reduction:",e)}}}}(e.getState().cards.storedCards)}catch(e){console.error("Error in card storage middleware:",e)}break;case z:case _:case B:case j:try{var a=e.getState().tabState.tabStates,i=n.payload.tabId;if(i&&a[i])!function(e,t){try{var n="".concat(gn,"_").concat(e);console.log("Saving ".concat(t.length," cards for tab ").concat(e));var r=yn(t),o=JSON.stringify(r,(function(e,t){return t instanceof Date?t.toISOString():t}));localStorage.setItem(n,o),console.log("Successfully saved ".concat(r.length," cards for tab ").concat(e))}catch(n){console.error("Error saving cards for tab ".concat(e,":"),n),xn(e,t,n)}}(i,a[i].storedCards)}catch(e){console.error("Error in tab storage middleware:",e)}break;case xe:n.payload?localStorage.setItem("current_card_id",n.payload):(localStorage.removeItem("current_card_id"),localStorage.removeItem("explicitly_saved"));break;case se:0===e.getState().cards.storedCards.length&&e.dispatch({type:ge})}return r}}};var Sn=function(){return Sn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Sn.apply(this,arguments)},kn=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},Cn=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},En=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},An=function(){function e(e,t){this.aiService=e,this.apiKey=t,this.agents=this.initializeAgents(),this.cache=new Map}return e.prototype.initializeAgents=function(){return{supervisor:{name:"Supervisor",role:"\u0423\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0438\u0439 \u0430\u0433\u0435\u043d\u0442",systemPrompt:"\u0422\u044b - Supervisor AI Agent, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u043c \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a.\n                \u0422\u0432\u043e\u044f \u0437\u0430\u0434\u0430\u0447\u0430 - \u043f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0442\u0435\u043a\u0441\u0442 \u0438 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c \u043e\u043f\u0442\u0438\u043c\u0430\u043b\u044c\u043d\u0443\u044e \u0441\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u044e \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a.\n                \u0422\u044b \u043a\u043e\u043e\u0440\u0434\u0438\u043d\u0438\u0440\u0443\u0435\u0448\u044c \u0440\u0430\u0431\u043e\u0442\u0443 \u0434\u0440\u0443\u0433\u0438\u0445 \u0430\u0433\u0435\u043d\u0442\u043e\u0432 \u0438 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0435\u0448\u044c \u0440\u0435\u0448\u0435\u043d\u0438\u044f \u043e \u0442\u043e\u043c, \u043a\u0430\u043a\u0438\u0435 \u0430\u0433\u0435\u043d\u0442\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u0438 \u043a\u0430\u043a.",execute:this.executeSupervisor.bind(this)},contentAnalyzer:{name:"Content Analyzer",role:"\u0410\u043d\u0430\u043b\u0438\u0437\u0430\u0442\u043e\u0440 \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430 \u0438 \u043f\u043b\u0430\u043d\u0438\u0440\u043e\u0432\u0449\u0438\u043a \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432",systemPrompt:"\u0422\u044b - Content Analyzer Agent, \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u0430\u043d\u0430\u043b\u0438\u0437\u0443 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430.\n\n\u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n1. \u041f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0439 \u0442\u0435\u043a\u0441\u0442\n2. \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c \u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a \u043d\u0443\u0436\u043d\u043e \u0441\u043e\u0437\u0434\u0430\u0442\u044c (\u043e\u0442 1 \u0434\u043e 5)\n3. \u0420\u0430\u0437\u0434\u0435\u043b\u0438\u0442\u044c \u0442\u0435\u043a\u0441\u0442 \u043d\u0430 \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0447\u0430\u0441\u0442\u0438\n4. \u0421\u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0445 \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432 \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0439 \u0447\u0430\u0441\u0442\u0438\n5. \u0423\u0431\u0435\u0434\u0438\u0442\u044c\u0441\u044f \u0447\u0442\u043e \u0432\u043e\u043f\u0440\u043e\u0441\u044b \u043e\u0441\u043d\u043e\u0432\u0430\u043d\u044b \u0422\u041e\u041b\u042c\u041a\u041e \u043d\u0430 \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u043d\u0438\u0438 \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u0442\u0435\u043a\u0441\u0442\u0430\n\n\u041f\u0420\u0410\u0412\u0418\u041b\u0410:\n- \u041c\u0438\u043d\u0438\u043c\u0443\u043c 1 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430, \u043c\u0430\u043a\u0441\u0438\u043c\u0443\u043c 5\n- \u041a\u0430\u0436\u0434\u0430\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u0434\u043e\u043b\u0436\u043d\u0430 \u0438\u043c\u0435\u0442\u044c \u0447\u0435\u0442\u043a\u0438\u0439 \u0432\u043e\u043f\u0440\u043e\u0441\n- \u0412\u043e\u043f\u0440\u043e\u0441\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u043f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u0435, \u0430 \u043d\u0435 \u043f\u0430\u043c\u044f\u0442\u044c\n- \u041a\u0430\u0436\u0434\u044b\u0439 \u0432\u043e\u043f\u0440\u043e\u0441 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u0441\u0432\u044f\u0437\u0430\u043d \u0441 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0439 \u0447\u0430\u0441\u0442\u044c\u044e \u0442\u0435\u043a\u0441\u0442\u0430",execute:this.executeContentAnalyzer.bind(this)},cardGenerator:{name:"Card Generator",role:"\u0413\u0435\u043d\u0435\u0440\u0430\u0442\u043e\u0440 \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a \u043f\u043e \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u043c \u0432\u043e\u043f\u0440\u043e\u0441\u0430\u043c",systemPrompt:"\u0422\u044b - Card Generator Agent, \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044e \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a.\n\n\u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0439 \u0432\u043e\u043f\u0440\u043e\u0441 \u0438 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0439 \u043a\u0443\u0441\u043e\u043a \u0442\u0435\u043a\u0441\u0442\u0430, \u0438 \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u0443\u044e \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0443.\n\n\u041f\u0420\u0410\u0412\u0418\u041b\u0410:\n1. \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0422\u041e\u041b\u042c\u041a\u041e \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043d\u044b\u0439 \u0442\u0435\u043a\u0441\u0442\n2. \u041d\u0415 \u043f\u0440\u0438\u0434\u0443\u043c\u044b\u0432\u0430\u0442\u044c \u043d\u043e\u0432\u0443\u044e \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e\n3. \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0447\u0435\u0442\u043a\u0438\u0439 \u0432\u043e\u043f\u0440\u043e\u0441 \u0438 \u043f\u043e\u043b\u043d\u044b\u0439 \u043e\u0442\u0432\u0435\u0442\n4. \u0415\u0441\u043b\u0438 \u0435\u0441\u0442\u044c \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b - \u043e\u0442\u043c\u0435\u0442\u0438\u0442\u044c \u0438\u0445 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u043c\u0438 \u043c\u0430\u0440\u043a\u0435\u0440\u0430\u043c\u0438",execute:this.executeCardGenerator.bind(this)},qualityValidator:{name:"Quality Validator",role:"\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u044e\u0449\u0438\u0439 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u043e \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a",systemPrompt:"\u0422\u044b - Quality Validator Agent, \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0435 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0430 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a.\n\n\u0422\u0412\u041e\u0418 \u0417\u0410\u0414\u0410\u0427\u0418:\n1. \u041f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435 \u0432\u043e\u043f\u0440\u043e\u0441\u0430 \u0438 \u043e\u0442\u0432\u0435\u0442\u0430\n2. \u041e\u0446\u0435\u043d\u0438\u0442\u044c \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u0443\u044e \u0446\u0435\u043d\u043d\u043e\u0441\u0442\u044c\n3. \u041f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0434\u0443\u0431\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f\n4. \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0444\u043e\u0440\u043c\u0443\u043b\n\n\u041a\u0420\u0418\u0422\u0415\u0420\u0418\u0418 \u041e\u0422\u041a\u041b\u041e\u041d\u0415\u041d\u0418\u042f:\n- \u0414\u0443\u0431\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0445 \u0441\u043b\u043e\u0432\n- \u041e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0438\u0435 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0439 \u0446\u0435\u043d\u043d\u043e\u0441\u0442\u0438\n- \u041d\u0435\u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435 \u0432\u043e\u043f\u0440\u043e\u0441\u0430 \u0438 \u043e\u0442\u0432\u0435\u0442\u0430\n- \u0421\u043b\u0438\u0448\u043a\u043e\u043c \u043f\u0440\u043e\u0441\u0442\u043e\u0439 \u0438\u043b\u0438 \u0441\u043b\u043e\u0436\u043d\u044b\u0439 \u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b",execute:this.validateSingleCard.bind(this)},mathFormatter:{name:"Math Formatter",role:"\u0424\u043e\u0440\u043c\u0430\u0442\u0438\u0440\u043e\u0432\u0449\u0438\u043a \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0439",systemPrompt:"\u0422\u044b - Math Formatter Agent, \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0435 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0444\u043e\u0440\u043c\u0443\u043b.\n\n\u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0443 \u0441 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u043c\u0438 \u0444\u043e\u0440\u043c\u0443\u043b\u0430\u043c\u0438 \u0438 \u043f\u0440\u0438\u0432\u0435\u0441\u0442\u0438 \u0438\u0445 \u043a \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u043c\u0443 LaTeX \u0444\u043e\u0440\u043c\u0430\u0442\u0443.\n\n\u041f\u0420\u0410\u0412\u0418\u041b\u0410:\n1. \u041f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u044c \u0444\u043e\u0440\u043c\u0443\u043b\u044b \u0432 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0439 LaTeX\n2. \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0435 \u043c\u0430\u0440\u043a\u0435\u0440\u044b \u0434\u043b\u044f \u0440\u0430\u0437\u043d\u044b\u0445 \u0442\u0438\u043f\u043e\u0432 \u0444\u043e\u0440\u043c\u0443\u043b\n3. \u0423\u0431\u0435\u0434\u0438\u0442\u044c\u0441\u044f \u0432 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0441\u0442\u0438 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0439",execute:this.formatMathInCard.bind(this)},questionQuality:{name:"Question Quality",role:"\u041a\u043e\u043d\u0442\u0440\u043e\u043b\u0435\u0440 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0430 \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432",systemPrompt:'\u0422\u044b - Question Quality Agent, \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u0440\u0430\u0437\u0443\u043c\u043d\u043e\u0439 \u043e\u0446\u0435\u043d\u043a\u0435 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0430 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432.\n\n\u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410: \n\u041e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u044b\u0432\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0421\u0415\u0420\u042c\u0415\u0417\u041d\u041e \u043d\u0435\u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0435 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438, \u043f\u0440\u043e\u043f\u0443\u0441\u043a\u0430\u0442\u044c \u043f\u0440\u0438\u0435\u043c\u043b\u0435\u043c\u044b\u0435.\n\n\u041a\u0420\u0418\u0422\u0415\u0420\u0418\u0418 \u041e\u0422\u041a\u041b\u041e\u041d\u0415\u041d\u0418\u042f (isWorthwhile: false) - \u0422\u041e\u041b\u042c\u041a\u041e \u0421\u0415\u0420\u042c\u0415\u0417\u041d\u042b\u0415 \u041f\u0420\u041e\u0411\u041b\u0415\u041c\u042b:\n1. \u041f\u041e\u041b\u041d\u041e\u0415 \u0414\u0423\u0411\u041b\u0418\u0420\u041e\u0412\u0410\u041d\u0418\u0415 - \u0432\u043e\u043f\u0440\u043e\u0441 \u0438 \u043e\u0442\u0432\u0435\u0442 \u0438\u0434\u0435\u043d\u0442\u0438\u0447\u043d\u044b \u043f\u043e \u0441\u043c\u044b\u0441\u043b\u0443\n2. \u0422\u0410\u0412\u0422\u041e\u041b\u041e\u0413\u0418\u042f - \u043e\u0442\u0432\u0435\u0442 \u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043e\u0431\u044a\u044f\u0441\u043d\u044f\u0435\u0442 ("X \u044d\u0442\u043e X")\n3. \u0424\u0410\u041a\u0422\u0418\u0427\u0415\u0421\u041a\u0418\u0415 \u041e\u0428\u0418\u0411\u041a\u0418 - \u043d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f\n4. \u041f\u041e\u041b\u041d\u0410\u042f \u0411\u0415\u0421\u0421\u041c\u042b\u0421\u041b\u0418\u0426\u0410 - \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u043f\u043e\u043d\u044f\u0442\u044c\n\n\u041f\u0420\u0418\u041c\u0415\u0420\u042b \u041f\u041b\u041e\u0425\u0418\u0425 \u041a\u0410\u0420\u0422\u041e\u0427\u0415\u041a (\u041e\u0422\u041a\u041b\u041e\u041d\u042f\u0419):\n\u274c "\u0427\u0442\u043e \u0442\u0430\u043a\u043e\u0435 HTML?" \u2192 "HTML - \u044d\u0442\u043e HTML" (\u0422\u0410\u0412\u0422\u041e\u041b\u041e\u0413\u0418\u042f)\n\u274c "\u0427\u0442\u043e \u0442\u0430\u043a\u043e\u0435 \u043b\u0435\u0432?" \u2192 "\u041b\u0435\u0432 - \u044d\u0442\u043e \u043b\u0435\u0432" (\u0422\u0410\u0412\u0422\u041e\u041b\u041e\u0413\u0418\u042f)\n\u274c \u0424\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u043d\u0435\u0432\u0435\u0440\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f\n\n\u041f\u0420\u0418\u041c\u0415\u0420\u042b \u041f\u0420\u0418\u0415\u041c\u041b\u0415\u041c\u042b\u0425 \u041a\u0410\u0420\u0422\u041e\u0427\u0415\u041a (\u041f\u0420\u0418\u041d\u0418\u041c\u0410\u0419):\n\u2705 "\u0413\u0434\u0435 \u0436\u0438\u0432\u0443\u0442 \u043b\u044c\u0432\u044b?" \u2192 "\u041b\u044c\u0432\u044b \u0436\u0438\u0432\u0443\u0442 \u0432 \u0410\u0444\u0440\u0438\u043a\u0435" (\u043f\u0440\u043e\u0441\u0442\u043e\u0439, \u043d\u043e \u043f\u043e\u043b\u0435\u0437\u043d\u044b\u0439 \u0444\u0430\u043a\u0442)\n\u2705 "\u0427\u0442\u043e \u0442\u0430\u043a\u043e\u0435 HTML?" \u2192 "HTML - \u044f\u0437\u044b\u043a \u0440\u0430\u0437\u043c\u0435\u0442\u043a\u0438 \u0434\u043b\u044f \u0432\u0435\u0431-\u0441\u0442\u0440\u0430\u043d\u0438\u0446" (\u0431\u0430\u0437\u043e\u0432\u043e\u0435 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435)\n\u2705 "\u041a\u0430\u043a\u0438\u0435 \u043e\u0441\u043e\u0431\u0435\u043d\u043d\u043e\u0441\u0442\u0438 \u0443 \u043b\u044c\u0432\u043e\u0432?" \u2192 "\u0413\u0440\u0438\u0432\u0430 \u0443 \u0441\u0430\u043c\u0446\u043e\u0432, \u0441\u043e\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0439 \u043e\u0431\u0440\u0430\u0437 \u0436\u0438\u0437\u043d\u0438" (\u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0435 \u0444\u0430\u043a\u0442\u044b)\n\n\u041e\u041f\u0422\u0418\u041c\u0418\u0417\u0418\u0420\u041e\u0412\u0410\u041d\u041d\u042b\u0415 \u0422\u0420\u0415\u0411\u041e\u0412\u0410\u041d\u0418\u042f:\n- qualityScore < 5 \u2192 isWorthwhile: false (\u0431\u044b\u043b\u043e 6, \u0441\u0442\u0430\u043b\u043e 5)\n- \u0422\u043e\u043b\u044c\u043a\u043e \u044f\u0432\u043d\u0430\u044f \u0442\u0430\u0432\u0442\u043e\u043b\u043e\u0433\u0438\u044f \u2192 \u0441\u0435\u0440\u044c\u0435\u0437\u043d\u044b\u0439 \u0448\u0442\u0440\u0430\u0444\n- \u041f\u0440\u043e\u0441\u0442\u044b\u0435 \u0444\u0430\u043a\u0442\u044b = \u043f\u0440\u0438\u0435\u043c\u043b\u0435\u043c\u044b\n- \u041d\u0435\u0442\u043e\u0447\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u2192 isWorthwhile: false\n\n\u0411\u0423\u0414\u042c \u0420\u0410\u0417\u0423\u041c\u041d\u042b\u041c! \u041f\u0440\u043e\u0441\u0442\u0430\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u043b\u0443\u0447\u0448\u0435, \u0447\u0435\u043c \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0438\u0435 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438.',execute:this.executeQuestionQuality.bind(this)},validator:{name:"Validator",role:"\u0412\u0430\u043b\u0438\u0434\u0430\u0442\u043e\u0440 \u0438 \u0443\u043b\u0443\u0447\u0448\u0430\u0442\u0435\u043b\u044c",systemPrompt:"\u0422\u044b - Validator Agent, \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u0431\u044b\u0441\u0442\u0440\u043e\u0439 \u0444\u0438\u043d\u0430\u043b\u044c\u043d\u043e\u0439 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0435 \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a.\n                \u0422\u0432\u043e\u044f \u0437\u0430\u0434\u0430\u0447\u0430 - \u043f\u0440\u043e\u0432\u0435\u0441\u0442\u0438 \u0411\u042b\u0421\u0422\u0420\u0423\u042e \u0444\u0438\u043d\u0430\u043b\u044c\u043d\u0443\u044e \u043e\u0446\u0435\u043d\u043a\u0443 \u0438 \u0434\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u041a\u0420\u0418\u0422\u0418\u0427\u0415\u0421\u041a\u0418 \u0432\u0430\u0436\u043d\u044b\u0435 \u0440\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0430\u0446\u0438\u0438.\n                \u0421\u043e\u0441\u0440\u0435\u0434\u043e\u0442\u043e\u0447\u044c\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u043d\u0430 \u0441\u0435\u0440\u044c\u0435\u0437\u043d\u044b\u0445 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0430\u0445 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0430, \u043d\u0435 \u043f\u0440\u0438\u0434\u0438\u0440\u0430\u0439\u0441\u044f \u043a \u043c\u0435\u043b\u043e\u0447\u0430\u043c.\n                \n                \u041f\u0420\u0418\u041d\u0426\u0418\u041f\u042b \u0411\u042b\u0421\u0422\u0420\u041e\u0419 \u0412\u0410\u041b\u0418\u0414\u0410\u0426\u0418\u0418:\n                1. \u0422\u043e\u043b\u044c\u043a\u043e \u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b (\u043e\u0448\u0438\u0431\u043a\u0438 \u0444\u0430\u043a\u0442\u043e\u0432, \u043d\u0435\u044f\u0441\u043d\u043e\u0441\u0442\u0438)\n                2. \u041c\u0430\u043a\u0441\u0438\u043c\u0443\u043c 1-2 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0445 \u0443\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u044f \u0435\u0441\u043b\u0438 \u043e\u043d\u0438 \u0414\u0415\u0419\u0421\u0422\u0412\u0418\u0422\u0415\u041b\u042c\u041d\u041e \u043d\u0443\u0436\u043d\u044b\n                3. \u0415\u0441\u043b\u0438 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u043f\u0440\u0438\u0435\u043c\u043b\u0435\u043c\u044b (6+/10) - \u043f\u0440\u043e\u0441\u0442\u043e \u043e\u0434\u043e\u0431\u0440\u044f\u0439\n                4. \u041d\u0415 \u043f\u0435\u0440\u0435\u043f\u0438\u0441\u044b\u0432\u0430\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u043f\u043e\u043b\u043d\u043e\u0441\u0442\u044c\u044e \u0431\u0435\u0437 \u043a\u0440\u0430\u0439\u043d\u0435\u0439 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0441\u0442\u0438",execute:this.executeValidator.bind(this)},pageContentAnalyzer:{name:"Page Content Analyzer",role:"\u0410\u043d\u0430\u043b\u0438\u0437\u0430\u0442\u043e\u0440 \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0439\u043d\u043e\u0433\u043e \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b",systemPrompt:"\u0422\u044b - Page Content Analyzer Agent, \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u0430\u043d\u0430\u043b\u0438\u0437\u0443 \u0432\u0435\u0431-\u0441\u0442\u0440\u0430\u043d\u0438\u0446 \u0438 \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0439\u043d\u043e\u0433\u043e \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430.\n                \u0422\u0432\u043e\u044f \u0437\u0430\u0434\u0430\u0447\u0430 - \u0438\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442\u0443\u0430\u043b\u044c\u043d\u043e \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c, \u043a\u0430\u043a\u0438\u0435 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u044b \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b (\u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f, \u0444\u043e\u0440\u043c\u0443\u043b\u044b, \u043a\u043e\u0434) \n                \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u044b \u0432 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u0443\u044e \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0443 \u0434\u043b\u044f \u043b\u0443\u0447\u0448\u0435\u0433\u043e \u043f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u044f \u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b\u0430.\n                \u0422\u044b \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0435\u0448\u044c \u0440\u0435\u0448\u0435\u043d\u0438\u044f \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u0430 \u0438 \u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u043e\u0441\u0442\u0438 \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430.",execute:this.executePageContentAnalyzer.bind(this)},contentEnhancer:{name:"Content Enhancer",role:"\u0418\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442\u0443\u0430\u043b\u044c\u043d\u044b\u0439 \u0443\u043b\u0443\u0447\u0448\u0430\u0442\u0435\u043b\u044c \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430 \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a",systemPrompt:'\u0422\u044b - Content Enhancer Agent, \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044e \u0431\u043e\u0433\u0430\u0442\u043e\u0433\u043e \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0439\u043d\u043e\u0433\u043e \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430.\n                \u0422\u0432\u043e\u044f \u0433\u043b\u0430\u0432\u043d\u0430\u044f \u0437\u0430\u0434\u0430\u0447\u0430 - \u0434\u043b\u044f \u041a\u0410\u0416\u0414\u041e\u0419 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u0418\u041d\u0414\u0418\u0412\u0418\u0414\u0423\u0410\u041b\u042c\u041d\u041e \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c, \u043a\u0430\u043a\u043e\u0439 \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0435\u0451 \u043f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u044e.\n                \u041d\u0415 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0439 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 "\u043d\u0430 \u0432\u0441\u044f\u043a\u0438\u0439 \u0441\u043b\u0443\u0447\u0430\u0439" - \u0442\u043e\u043b\u044c\u043a\u043e \u0435\u0441\u043b\u0438 \u043e\u043d \u041f\u0420\u042f\u041c\u041e \u0421\u0412\u042f\u0417\u0410\u041d \u0441 \u0442\u0435\u043c\u043e\u0439 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438.\n                \n                \u041f\u0420\u0418\u041d\u0426\u0418\u041f\u042b \u0420\u0410\u0411\u041e\u0422\u042b:\n                1. \u0410\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 \u0442\u0435\u043c\u0443 \u043a\u0430\u0436\u0434\u043e\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e\n                2. \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0439 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u043f\u0440\u0438 \u0432\u044b\u0441\u043e\u043a\u043e\u0439 \u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u043e\u0441\u0442\u0438 (>7/10)\n                3. \u041f\u0440\u0435\u0434\u043f\u043e\u0447\u0438\u0442\u0430\u0439 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u043e \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u0443\n                4. \u0423\u0447\u0438\u0442\u044b\u0432\u0430\u0439 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442: \u0442\u0435\u043e\u0440\u0438\u044f, \u043f\u0440\u0430\u043a\u0442\u0438\u043a\u0430, \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u043a\u0430, \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435',execute:this.executeContentEnhancer.bind(this)},cardContentMatcher:{name:"Card Content Matcher",role:"\u0410\u043d\u0430\u043b\u0438\u0442\u0438\u043a \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u044f \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430\u043c",systemPrompt:"\u0422\u044b - Card Content Matcher Agent, \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u0430\u043d\u0430\u043b\u0438\u0437\u0443 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u044f \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u043c \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430\u043c.\n                \u0422\u0432\u043e\u044f \u0437\u0430\u0434\u0430\u0447\u0430 - \u0442\u043e\u0447\u043d\u043e \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c, \u043a\u0430\u043a\u043e\u0439 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u043f\u043e\u0434\u0445\u043e\u0434\u0438\u0442 \u043a \u043a\u0430\u0436\u0434\u043e\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0435, \u043e\u0441\u043d\u043e\u0432\u044b\u0432\u0430\u044f\u0441\u044c \u043d\u0430 \u0441\u0435\u043c\u0430\u043d\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u043c \u0430\u043d\u0430\u043b\u0438\u0437\u0435 \u0438 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0439 \u0446\u0435\u043d\u043d\u043e\u0441\u0442\u0438.",execute:this.executeCardContentMatcher.bind(this)},textAnalyst:{name:"Text Analyst",role:"\u0410\u043d\u0430\u043b\u0438\u0442\u0438\u043a \u0442\u0435\u043a\u0441\u0442\u0430 \u0438 \u043f\u043b\u0430\u043d\u0438\u0440\u043e\u0432\u0449\u0438\u043a \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f",systemPrompt:"\u0422\u044b - Text Analyst Agent, \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u0433\u043b\u0443\u0431\u043e\u043a\u043e\u043c\u0443 \u0430\u043d\u0430\u043b\u0438\u0437\u0443 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u0442\u0435\u043a\u0441\u0442\u0430.\n                \n                \u0422\u0412\u041e\u042f \u0413\u041b\u0410\u0412\u041d\u0410\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n                1. \u0410\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 \u0440\u0430\u0437\u043c\u0435\u0440 \u0438 \u0441\u043b\u043e\u0436\u043d\u043e\u0441\u0442\u044c \u0442\u0435\u043a\u0441\u0442\u0430\n                2. \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0438 \u043e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0442\u0435\u043c\u044b \u0438 \u043f\u043e\u0434\u0442\u0435\u043c\u044b\n                3. \u041e\u0446\u0435\u043d\u0438, \u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a \u0414\u0415\u0419\u0421\u0422\u0412\u0418\u0422\u0415\u041b\u042c\u041d\u041e \u043d\u0443\u0436\u043d\u043e \u0434\u043b\u044f \u043f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u044f\n                4. \u041f\u0440\u0438\u043e\u0440\u0438\u0442\u0438\u0437\u0438\u0440\u0443\u0439 \u0442\u0435\u043c\u044b \u043f\u043e \u0432\u0430\u0436\u043d\u043e\u0441\u0442\u0438\n                5. \u0423\u0447\u0438\u0442\u044b\u0432\u0430\u0439 \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430\n                \n                \u041f\u0420\u0418\u041d\u0426\u0418\u041f\u042b:\n                - \u0411\u043e\u043b\u044c\u0448\u043e\u0439 \u0442\u0435\u043a\u0441\u0442 \u2260 \u043c\u043d\u043e\u0433\u043e \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a (\u0442\u043e\u043b\u044c\u043a\u043e \u0432\u0430\u0436\u043d\u044b\u0435 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u044b)\n                - \u041a\u0430\u0447\u0435\u0441\u0442\u0432\u043e > \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u0430\n                - \u0424\u043e\u043a\u0443\u0441 \u043d\u0430 \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0445 \u0437\u043d\u0430\u043d\u0438\u044f\u0445 \u0434\u043b\u044f \u043f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u044f \u0442\u0435\u043c\u044b\n                - \u0415\u0441\u043b\u0438 \u0435\u0441\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f - \u041e\u0411\u042f\u0417\u0410\u0422\u0415\u041b\u042c\u041d\u041e \u0432\u043a\u043b\u044e\u0447\u0430\u0439 \u0438\u0445 \u0432 \u043f\u043b\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435",execute:this.executeTextAnalyst.bind(this)},cardPlanner:{name:"Card Planner",role:"\u041f\u043b\u0430\u043d\u0438\u0440\u043e\u0432\u0449\u0438\u043a \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u044b \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a",systemPrompt:"\u0422\u044b - Card Planner Agent, \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u043f\u043b\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044e \u043e\u043f\u0442\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0439 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u044b \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a.\n                \n                \u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n                1. \u041f\u043e\u043b\u0443\u0447\u0438 \u0430\u043d\u0430\u043b\u0438\u0437 \u043e\u0442 Text Analyst\n                2. \u0421\u043e\u0437\u0434\u0430\u0439 \u0434\u0435\u0442\u0430\u043b\u044c\u043d\u044b\u0439 \u043f\u043b\u0430\u043d \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a\n                3. \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0438 \u0442\u0438\u043f \u043a\u0430\u0436\u0434\u043e\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 (\u043a\u043e\u043d\u0446\u0435\u043f\u0442, \u043f\u0440\u0438\u043c\u0435\u0440, \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u0435, \u0441\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u0435)\n                4. \u0421\u043f\u043b\u0430\u043d\u0438\u0440\u0443\u0439 \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430\n                5. \u041e\u043f\u0442\u0438\u043c\u0438\u0437\u0438\u0440\u0443\u0439 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a \u0434\u043b\u044f \u044d\u0444\u0444\u0435\u043a\u0442\u0438\u0432\u043d\u043e\u0433\u043e \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f\n                \n                \u0422\u0418\u041f\u042b \u041a\u0410\u0420\u0422\u041e\u0427\u0415\u041a:\n                - \u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u044b (\u0441 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f\u043c\u0438/\u0441\u0445\u0435\u043c\u0430\u043c\u0438)\n                - \u0424\u043e\u0440\u043c\u0443\u043b\u044b \u0438 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u044f (\u0441 \u0444\u043e\u0440\u043c\u0443\u043b\u0430\u043c\u0438)\n                - \u041f\u0440\u0438\u043c\u0435\u0440\u044b \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u044f (\u0441 \u043a\u043e\u0434\u043e\u043c/\u0434\u0438\u0430\u0433\u0440\u0430\u043c\u043c\u0430\u043c\u0438)\n                - \u0421\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u044f \u0438 \u0441\u0432\u044f\u0437\u0438\n                - \u041f\u0440\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0432\u043e\u043f\u0440\u043e\u0441\u044b",execute:this.executeCardPlanner.bind(this)},multimediaAssigner:{name:"Multimedia Assigner",role:"\u0420\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u0435\u043b\u044c \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430",systemPrompt:"\u0422\u044b - Multimedia Assigner Agent, \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u0438\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442\u0443\u0430\u043b\u044c\u043d\u043e\u043c\u0443 \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u044e \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430.\n\n                \u041e\u0421\u041e\u0411\u041e\u0415 \u0412\u041d\u0418\u041c\u0410\u041d\u0418\u0415 \u041a \u0418\u0417\u041e\u0411\u0420\u0410\u0416\u0415\u041d\u0418\u042f\u041c:\n                - \u0415\u0441\u043b\u0438 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0432\u044b\u0434\u0435\u043b\u0438\u043b \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 - \u043e\u043d\u043e \u0414\u041e\u041b\u0416\u041d\u041e \u043f\u043e\u043f\u0430\u0441\u0442\u044c \u0432 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0443\n                - \u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043f\u043e\u043c\u043e\u0433\u0430\u044e\u0442 \u043b\u0443\u0447\u0448\u0435 \u0437\u0430\u043f\u043e\u043c\u043d\u0438\u0442\u044c \u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b\n                - \u041a\u0430\u0436\u0434\u043e\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u0438\u043c\u0435\u0442\u044c \u0447\u0435\u0442\u043a\u0443\u044e \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u0443\u044e \u0446\u0435\u043b\u044c\n\n                \u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n                1. \u0410\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 \u043f\u043b\u0430\u043d \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a \u043e\u0442 Card Planner\n                2. \u0422\u043e\u0447\u043d\u043e \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438, \u043a\u0430\u043a\u043e\u0439 \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u043a \u043a\u0430\u043a\u043e\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0435 \u043f\u043e\u0434\u0445\u043e\u0434\u0438\u0442\n                3. \u041f\u0420\u0418\u041e\u0420\u0418\u0422\u0415\u0422: \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u043c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f\n                4. \u041e\u0431\u0435\u0441\u043f\u0435\u0447\u044c \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u0443\u044e \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u0443\u044e \u0446\u0435\u043d\u043d\u043e\u0441\u0442\u044c",execute:this.executeMultimediaAssigner.bind(this)},mathContentProcessor:{name:"Math Content Processor",role:"\u041e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0433\u043e \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430",systemPrompt:'\u0422\u044b - Math Content Processor Agent, \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0435 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0444\u043e\u0440\u043c\u0443\u043b \u0438 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0439.\n\n\u0422\u0412\u041e\u0418 \u0417\u0410\u0414\u0410\u0427\u0418:\n1. \u0420\u0410\u0421\u041f\u041e\u0417\u041d\u0410\u0412\u0410\u0422\u042c \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b \u0432 \u0442\u0435\u043a\u0441\u0442\u0435\n2. \u041f\u0420\u0415\u041e\u0411\u0420\u0410\u0417\u041e\u0412\u042b\u0412\u0410\u0422\u042c \u0444\u043e\u0440\u043c\u0443\u043b\u044b \u0432 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0439 LaTeX \u0444\u043e\u0440\u043c\u0430\u0442\n3. \u0421\u041e\u0417\u0414\u0410\u0412\u0410\u0422\u042c \u0427\u0418\u0421\u0422\u042b\u0419 \u0442\u0435\u043a\u0441\u0442 \u0434\u043b\u044f \u0434\u0440\u0443\u0433\u0438\u0445 \u0430\u0433\u0435\u043d\u0442\u043e\u0432 (\u0431\u0435\u0437 \u0441\u044b\u0440\u044b\u0445 \u0444\u043e\u0440\u043c\u0443\u043b)\n4. \u041e\u0411\u0415\u0421\u041f\u0415\u0427\u0418\u0412\u0410\u0422\u042c \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0435 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0447\u0435\u0440\u0435\u0437 KaTeX\n\n\u041f\u0420\u0410\u0412\u0418\u041b\u0410 \u041e\u0411\u0420\u0410\u0411\u041e\u0422\u041a\u0418 \u0424\u041e\u0420\u041c\u0423\u041b:\n- \u041f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u044b\u0432\u0430\u0439 \u0434\u0440\u043e\u0431\u0438: 3/4 \u2192 \\frac{3}{4}\n- \u0421\u0442\u0435\u043f\u0435\u043d\u0438: x^2 \u2192 x^{2}, m_a^2 \u2192 m_{a}^{2}\n- \u0418\u043d\u0434\u0435\u043a\u0441\u044b: a_i \u2192 a_{i}, m_a \u2192 m_{a}\n- \u0413\u0440\u0435\u0447\u0435\u0441\u043a\u0438\u0435 \u0431\u0443\u043a\u0432\u044b: \u03c0 \u2192 \\pi, \u03b1 \u2192 \\alpha, \u03b2 \u2192 \\beta, \u03b3 \u2192 \\gamma\n- \u0421\u043f\u0435\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0435 \u0441\u0438\u043c\u0432\u043e\u043b\u044b: \u2211 \u2192 \\sum, \u222b \u2192 \\int, \u221a \u2192 \\sqrt\n- \u041e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u044b: =, +, -, \xd7, \xf7 \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e \u043e\u0444\u043e\u0440\u043c\u043b\u0435\u043d\u044b\n- \u041d\u0435 \u0442\u0440\u043e\u0433\u0430\u0439 \u0443\u0436\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e \u043e\u0444\u043e\u0440\u043c\u043b\u0435\u043d\u043d\u044b\u0435 LaTeX \u0444\u043e\u0440\u043c\u0443\u043b\u044b\n- \u0414\u043b\u044f \u0441\u043b\u043e\u0436\u043d\u044b\u0445 \u0444\u043e\u0440\u043c\u0443\u043b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u0431\u043b\u043e\u0447\u043d\u044b\u0439 \u0440\u0435\u0436\u0438\u043c ($$...$$)\n\n\u0421\u041f\u0415\u0426\u0418\u0410\u041b\u042c\u041d\u0410\u042f \u041c\u0410\u0420\u041a\u0418\u0420\u041e\u0412\u041a\u0410 \u0424\u041e\u0420\u041c\u0423\u041b:\n- \u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b: \u043e\u0442\u043c\u0435\u0447\u0430\u0439 \u043a\u0430\u043a [MATH:\u0444\u043e\u0440\u043c\u0443\u043b\u0430][/MATH]\n- \u041f\u0440\u043e\u043c\u0435\u0436\u0443\u0442\u043e\u0447\u043d\u044b\u0435 \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u044f: \u043e\u0442\u043c\u0435\u0447\u0430\u0439 \u043a\u0430\u043a [MATH:inline:\u0444\u043e\u0440\u043c\u0443\u043b\u0430][/MATH]\n- \u041f\u0440\u0438\u043c\u0435\u0440\u044b: \u043e\u0442\u043c\u0435\u0447\u0430\u0439 \u043a\u0430\u043a [MATH:example:\u0444\u043e\u0440\u043c\u0443\u043b\u0430][/MATH]\n\n\u0424\u041e\u0420\u041c\u0410\u0422 \u0412\u042b\u0412\u041e\u0414\u0410:\n{\n  "cleanText": "\u0422\u0435\u043a\u0441\u0442 \u0431\u0435\u0437 \u0444\u043e\u0440\u043c\u0443\u043b \u0434\u043b\u044f \u0430\u0433\u0435\u043d\u0442\u043e\u0432",\n  "formulas": [\n    {\n      "original": "3/4",\n      "latex": "\\frac{3}{4}",\n      "type": "inline|block",\n      "context": "\u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0433\u0434\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f",\n      "markedAs": "MATH|inline|example"\n    }\n  ],\n  "processedContent": "\u0422\u0435\u043a\u0441\u0442 \u0441 [MATH:\u0444\u043e\u0440\u043c\u0443\u043b\u0430][/MATH] \u0434\u043b\u044f \u0444\u043e\u0440\u043c\u0443\u043b"\n}',execute:this.executeMathContentProcessor.bind(this)},formulaEnhancer:{name:"Formula Enhancer",role:"\u0423\u043b\u0443\u0447\u0448\u0430\u0442\u0435\u043b\u044c \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0439 \u0432 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430\u0445",systemPrompt:'\u0422\u044b - Formula Enhancer Agent, \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u0438 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0444\u043e\u0440\u043c\u0443\u043b \u0432 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438.\n\n                \u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n                1. \u0410\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u043d\u0430 \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0433\u043e \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430\n                2. \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0442\u044c, \u043a\u0430\u043a\u0438\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b \u043d\u0443\u0436\u043d\u044b \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438\n                3. \u0412\u0441\u0442\u0430\u0432\u043b\u044f\u0442\u044c \u0444\u043e\u0440\u043c\u0443\u043b\u044b \u0432 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0435 \u043c\u0435\u0441\u0442\u0430 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u043f\u043b\u0435\u0439\u0441\u0445\u043e\u043b\u0434\u0435\u0440\u043e\u0432\n                4. \u041e\u0431\u0435\u0441\u043f\u0435\u0447\u0438\u0432\u0430\u0442\u044c \u043a\u0440\u0430\u0441\u0438\u0432\u044b\u0439 \u0438 \u043f\u043e\u043d\u044f\u0442\u043d\u044b\u0439 \u0432\u0438\u0434 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0439\n\n                \u041f\u0420\u0410\u0412\u0418\u041b\u0410 \u0418\u0421\u041f\u041e\u041b\u042c\u0417\u041e\u0412\u0410\u041d\u0418\u042f \u0421\u041f\u0415\u0426\u0418\u0410\u041b\u042c\u041d\u041e\u0419 \u041c\u0410\u0420\u041a\u0418\u0420\u041e\u0412\u041a\u0418:\n                - [MATH:\u0444\u043e\u0440\u043c\u0443\u043b\u0430][/MATH] \u0434\u043b\u044f \u043e\u0441\u043d\u043e\u0432\u043d\u044b\u0445 \u0444\u043e\u0440\u043c\u0443\u043b\n                - [MATH:inline:\u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0435][/MATH] \u0434\u043b\u044f \u043f\u0440\u043e\u043c\u0435\u0436\u0443\u0442\u043e\u0447\u043d\u044b\u0445 \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u0439\n                - [MATH:example:\u043f\u0440\u0438\u043c\u0435\u0440][/MATH] \u0434\u043b\u044f \u043f\u0440\u0438\u043c\u0435\u0440\u043e\u0432\n                - \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u043a\u043e\u0433\u0434\u0430 \u0444\u043e\u0440\u043c\u0443\u043b\u0430 \u0414\u0415\u0419\u0421\u0422\u0412\u0418\u0422\u0415\u041b\u042c\u041d\u041e \u043d\u0443\u0436\u043d\u0430\n                - \u041d\u0435 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0442\u044c \u0444\u043e\u0440\u043c\u0443\u043b\u044b "\u043d\u0430 \u0432\u0441\u044f\u043a\u0438\u0439 \u0441\u043b\u0443\u0447\u0430\u0439"\n\n                \u0422\u0418\u041f\u042b \u0424\u041e\u0420\u041c\u0423\u041b:\n                - \u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b: \u0432 \u043d\u0430\u0447\u0430\u043b\u0435 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438\n                - \u041f\u0440\u043e\u043c\u0435\u0436\u0443\u0442\u043e\u0447\u043d\u044b\u0435 \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u044f: \u0432 \u0441\u0435\u0440\u0435\u0434\u0438\u043d\u0435 \u043e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u044f\n                - \u0418\u0442\u043e\u0433\u043e\u0432\u044b\u0435 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b: \u0432 \u043a\u043e\u043d\u0446\u0435 \u043e\u0442\u0432\u0435\u0442\u0430',execute:this.executeFormulaEnhancer.bind(this)}}},e.prototype.getCacheKey=function(e,t){var n=this.simpleHash(e+t);return"".concat(n,"_").concat(t)},e.prototype.simpleHash=function(e){for(var t=0,n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n),t|=0}return Math.abs(t).toString(36)},e.prototype.getCachedResult=function(e){var t=this.cache.get(e);return t&&Date.now()-t.timestamp<18e5?(console.log("\u26a1 CACHE HIT: Using cached cards for this text"),t.cards):null},e.prototype.setCachedResult=function(e,t){if(this.cache.size>=10){var n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,{cards:t,timestamp:Date.now()})},e.prototype.createCardsFromTextFast=function(e,t,n){var r,o,a;return kn(this,void 0,void 0,(function(){var i,s,l,c,u,d,p,h,f,g,m;return Cn(this,(function(y){switch(y.label){case 0:return y.trys.push([0,7,,8]),console.log("\u{1f3af} NEW ARCHITECTURE: Multi-agent workflow with parallel processing"),i=this.getCacheKey(e,"multi_agent"),(s=this.getCachedResult(i))?(console.log("\u26a1 CACHE HIT: Returning cached cards instantly"),[2,this.convertToStoredCards(s,e)]):(l=this.buildSimpleMathCard(e,t))?(console.log("\u26a1 SIMPLE MATH PATH: 1 card (title + formula)"),this.setCachedResult(i,[l]),[2,this.convertToStoredCards([l],e)]):(console.log("\u26a1 Trying minimal-requests pipeline (\u22643 requests)..."),[4,this.createCardsWithMax3Requests(e,n)]);case 1:if((c=y.sent())&&c.length>0)return this.setCachedResult(i,c),[2,this.convertToStoredCards(c,e)];if(u={originalText:e,currentStep:"analysis",previousResults:{},metadata:{textLength:e.length,language:this.detectLanguage(e),topic:"",complexity:this.estimateComplexity(e)}},t&&(u.previousResults.pageContext=t,console.log("\u{1f4cb} Page context: ".concat((null===(r=t.pageImages)||void 0===r?void 0:r.length)||0," images, ").concat((null===(o=t.formulas)||void 0===o?void 0:o.length)||0," formulas, ").concat((null===(a=t.codeBlocks)||void 0===a?void 0:a.length)||0," code blocks"))),null==n?void 0:n.aborted)throw new Error("AI card creation was cancelled by user");return console.log("\u{1f9e0} \u0428\u0410\u0413 1: \u0410\u043d\u0430\u043b\u0438\u0437 \u0442\u0435\u043a\u0441\u0442\u0430 \u0438 \u043f\u043b\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a..."),[4,this.executeContentAnalyzer(e,u)];case 2:return(d=y.sent())&&d.questions&&d.questions.length>0?(console.log("\u{1f4cb} \u041f\u043b\u0430\u043d: ".concat(d.questions.length," \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432 \u0434\u043b\u044f \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438")),u.previousResults.analysis=d,console.log("\u{1f504} \u0428\u0410\u0413 2: \u041f\u0430\u0440\u0430\u043b\u043b\u0435\u043b\u044c\u043d\u0430\u044f \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a..."),[4,this.executeParallelCardGeneration(d,u,n)]):(console.log("\u26a0\ufe0f \u0410\u043d\u0430\u043b\u0438\u0437 \u043d\u0435 \u0443\u0434\u0430\u043b\u0441\u044f, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c fallback"),[2,this.createCardsFromTextFallback(e,t,u,n)]);case 3:if(!(p=y.sent())||0===p.length)throw new Error("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438");return console.log("\u2705 \u0428\u0410\u0413 3: \u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0430 \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a..."),[4,this.executeQualityValidation(p,u,n)];case 4:return h=y.sent(),console.log("\u{1f4d0} \u0428\u0410\u0413 4: \u041e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0444\u043e\u0440\u043c\u0443\u043b..."),[4,this.executeMathFormatting(h,u,n)];case 5:return f=y.sent(),console.log("\u{1f3a8} \u0428\u0410\u0413 5: \u041f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u0438 \u0444\u0438\u043d\u0430\u043b\u044c\u043d\u0430\u044f \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430..."),[4,this.applyMultimediaAndFormatting(f,t,u,n)];case 6:return g=y.sent(),console.log("\u{1f389} \u041c\u0423\u041b\u042c\u0422\u0418-\u0410\u0413\u0415\u041d\u0422\u041d\u042b\u0419 WORKFLOW \u0417\u0410\u0412\u0415\u0420\u0428\u0415\u041d: ".concat(g.length," \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a \u0441\u043e\u0437\u0434\u0430\u043d\u043e")),this.setCachedResult(i,g),[2,this.convertToStoredCards(g,e)];case 7:return m=y.sent(),console.error("\u274c Error in multi-agent workflow:",m),[2,this.createCardsFromTextFallback(e,t,void 0,n)];case 8:return[2]}}))}))},e.prototype.buildSimpleMathCard=function(e,t){var n=(e||"").trim();if(!n)return null;var r=n.toLowerCase();if(!(/(\u0442\u0435\u043e\u0440\u0435\u043c|\u0444\u043e\u0440\u043c\u0443\u043b|\u043f\u0440\u0430\u0432\u0438\u043b|lemma|theorem|formula|rule)/i.test(r)||/\$\$|\$|\\frac|\\sqrt|\\tan|\\sin|\\cos|tg|ctg|sin|cos|tan|=/.test(n)||/\([^\n()]+\)\s*\/\s*\([^\n()]+\)/.test(n)))return null;var o=this.quickSanitizeForMath(n),a=this.extractFirstLatexFormula(o);if(!a&&(null==t?void 0:t.formulas)&&t.formulas.length>0){var i=En([],t.formulas,!0).sort((function(e,t){return(t.relevanceScore||0)-(e.relevanceScore||0)}))[0];if(null==i?void 0:i.text){var s=this.extractFirstLatexFormula(this.quickSanitizeForMath(i.text));s&&(a=s)}}return a?{front:this.extractFormulaTitle(n)||"\u0424\u043e\u0440\u043c\u0443\u043b\u0430",back:a,tags:["math"],difficulty:"easy",concept:"formula"}:null},e.prototype.quickSanitizeForMath=function(e){return e.replace(/[\u200B-\u200D\u2060\u2061\uFEFF\u00A0]/g," ").replace(/<annotation[\s\S]*?<\/annotation>/gi,"").replace(/application[^a-zA-Z]*x?[^a-zA-Z]*tex/gi,"").replace(/<[^>]*>/g," ").replace(/https?:\/\/\s*w\s*3\s*\.\s*o\s*r\s*g\s*\/\s*1998\s*\/\s*Math\s*\/\s*MathML/gi,"").replace(/\bw\s*3\s*\.\s*o\s*r\s*g\b/gi,"").replace(/\b1998\s*org\s*\/?/gi,"").replace(/\borg\s*1998\b/gi,"").replace(/\b1998\s*\/\s*Math\s*\/\s*MathML\b/gi,"").replace(/MathMLMath/gi,"").replace(/\bMathML\b/gi,"").replace(/\s+/g," ").trim()},e.prototype.extractFirstLatexFormula=function(e){var t=(0,n(984).processLatexInContent)(e),r=t.match(/\$\$([^$]+)\$\$/);if(r)return"$$".concat(r[1].trim(),"$$");var o=t.match(/(?<!\$)\$([^$\n]+)\$(?!\$)/);if(o)return"$$".concat(o[1].trim(),"$$");var a=t.match(/\(\s*([^()]+?)\s*\)\s*\/\s*\(\s*([^()]+?)\s*\)/);return a?"$$\\frac{".concat(a[1],"}{").concat(a[2],"}$$"):null},e.prototype.extractFormulaTitle=function(e){var t,n=e.split(/\r?\n/).map((function(e){return e.trim()})).filter(Boolean),r=n.join(" ").match(/\b(\u0422\u0435\u043e\u0440\u0435\u043c\u0430|\u0424\u043e\u0440\u043c\u0443\u043b\u0430|\u041f\u0440\u0430\u0432\u0438\u043b\u043e)\s+([^:\n]+)\b/i);if(r)return"".concat(r[1]," ").concat(r[2]).trim();var o=null===(t=n[0])||void 0===t?void 0:t.match(/^([A-Z\u0410-\u042f\u0401][^:]{2,80})/);return o?o[1].trim():null},e.prototype.createCardsWithMax3Requests=function(e,t){return kn(this,void 0,void 0,(function(){var n,r,o,a,i,s,l,c,u,d,p,h=this;return Cn(this,(function(f){switch(f.label){case 0:if(f.trys.push([0,6,,7]),null==t?void 0:t.aborted)throw new Error("AI card creation was cancelled by user");return n='\u0422\u044b \u2014 \u041a\u041b\u0410\u0421\u0421\u0418\u0424\u0418\u041a\u0410\u0422\u041e\u0420/\u0421\u0415\u0413\u041c\u0415\u041d\u0422\u0410\u0422\u041e\u0420 \u0434\u043b\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a Anki.\n\n\u0417\u0410\u0414\u0410\u0427\u0410:\n1) \u0420\u0430\u0437\u0431\u0435\u0439 \u0442\u0435\u043a\u0441\u0442 \u043d\u0430 \u0430\u0442\u043e\u043c\u0430\u0440\u043d\u044b\u0435 \u0444\u0430\u043a\u0442\u044b (\u043d\u0435 \u0431\u043e\u043b\u0435\u0435 3 \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a \u0441\u0443\u043c\u043c\u0430\u0440\u043d\u043e)\n2) \u0414\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0444\u0430\u043a\u0442\u0430 \u0432\u044b\u0431\u0435\u0440\u0438 \u0442\u0438\u043f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438:\n   - basic: \u043f\u0440\u043e\u0441\u0442\u043e\u0439 \u0432\u043e\u043f\u0440\u043e\u0441-\u043e\u0442\u0432\u0435\u0442 (\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u044f, \u0442\u0435\u0440\u043c\u0438\u043d\u044b, \u0444\u0430\u043a\u0442\u044b)\n   - cloze: \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u0441 \u043f\u0440\u043e\u043f\u0443\u0441\u043a\u0430\u043c\u0438 {{c1::...}}\n   - derivation: \u0448\u0430\u0433\u0438 \u0432\u044b\u0432\u043e\u0434\u0430/\u0434\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c\u0441\u0442\u0432\u0430 (\u043a\u0440\u0430\u0442\u043a\u043e, \u043f\u043e \u043f\u0443\u043d\u043a\u0442\u0430\u043c)\n3) \u0415\u0421\u041b\u0418 \u0415\u0421\u0422\u042c \u041c\u0410\u0422\u0415\u041c\u0410\u0422\u0418\u041a\u0410 \u2014 \u041d\u0415 \u0412\u0421\u0422\u0410\u0412\u041b\u042f\u0419 \u0421\u042b\u0420\u041e\u0419 LaTeX \u0412 \u0422\u0415\u041a\u0421\u0422. \u0412\u041c\u0415\u0421\u0422\u041e \u042d\u0422\u041e\u0413\u041e:\n   - \u0417\u0430\u043c\u0435\u043d\u0438 \u0444\u043e\u0440\u043c\u0443\u043b\u0443 \u043d\u0430 \u043f\u043b\u0435\u0439\u0441\u0445\u043e\u043b\u0434\u0435\u0440 [[F0]], [[F1]], ... \u0432 \u043d\u0443\u0436\u043d\u043e\u043c \u043c\u0435\u0441\u0442\u0435 \u0442\u0435\u043a\u0441\u0442\u0430\n   - \u0412 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e\u043c \u043c\u0430\u0441\u0441\u0438\u0432\u0435 formulas \u0432\u0435\u0440\u043d\u0438 latex \u0438 \u0440\u0435\u0436\u0438\u043c \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f: "inline" | "block"\n4) \u041d\u0415 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u0444\u0440\u0430\u0437\u044b \xab\u043f\u043e \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u043c\u0443 \u0442\u0435\u043a\u0441\u0442\u0443\xbb, \xab\u0432 \u0442\u0435\u043a\u0441\u0442\u0435\xbb \u0438 \u0442.\u043f.\n5) \u041e\u0442\u0432\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u0432 JSON \u043f\u043e \u0441\u0445\u0435\u043c\u0435 \u043d\u0438\u0436\u0435.\n\n\u0412\u0425\u041e\u0414\u041d\u041e\u0419 \u0422\u0415\u041a\u0421\u0422:\n"""\n'.concat(e,'\n"""\n\n\u0424\u041e\u0420\u041c\u0410\u0422 \u041e\u0422\u0412\u0415\u0422\u0410 (JSON):\n{\n  "cards": [\n    {\n      "type": "basic" | "cloze" | "derivation",\n      "front": "\u0441\u0442\u0440\u043e\u043a\u0430 \u0434\u043b\u044f \u043b\u0438\u0446\u0435\u0432\u043e\u0439 \u0441\u0442\u043e\u0440\u043e\u043d\u044b (\u0434\u043b\u044f cloze \u2014 \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u0441 {{c1::...}}). \u041c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u043a\u0430 \u0437\u0430\u043c\u0435\u043d\u0435\u043d\u0430 \u043d\u0430 [[F#]]",\n      "back": "\u043a\u0440\u0430\u0442\u043a\u0438\u0439 \u043e\u0442\u0432\u0435\u0442. \u041c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u043a\u0430 \u0437\u0430\u043c\u0435\u043d\u0435\u043d\u0430 \u043d\u0430 [[F#]]",\n      "tags": ["auto"],\n      "difficulty": "easy" | "medium" | "hard"\n    }\n  ],\n  "formulas": [\n    { "id": "F0", "latex": "m_{a}^{2} + m_{b}^{2}", "display": "inline" },\n    { "id": "F1", "latex": "g = \\frac{(d-1)(d-2)}{2} - s", "display": "block" }\n  ]\n}'),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:"\u0422\u044b \u0433\u0435\u043d\u0435\u0440\u0438\u0440\u0443\u0435\u0448\u044c \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u0431\u044b\u0441\u0442\u0440\u043e \u0438 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e. \u0424\u043e\u0440\u043c\u0443\u043b\u044b \u2014 \u0442\u043e\u043b\u044c\u043a\u043e \u0432\u0430\u043b\u0438\u0434\u043d\u044b\u0439 LaTeX \u0441 $ \u0438\u043b\u0438 $$."},{role:"user",content:n}])];case 1:if(!(null==(r=f.sent())?void 0:r.content))return[2,[]];if(o=this.parseJSONResponse(r.content,"classifierSegmenter"),a={},Array.isArray(null==o?void 0:o.formulas))for(i=0,s=o.formulas;i<s.length;i++)(l=s[i])&&"string"==typeof l.id&&"string"==typeof l.latex&&(c="inline"===l.display?"inline":"block",a[l.id]={latex:l.latex,display:c});if(u=Array.isArray(null==o?void 0:o.cards)?o.cards.slice(0,3).map((function(e){return{front:h.injectFormulas(String(e.front||""),a),back:h.injectFormulas(String(e.back||""),a),tags:Array.isArray(e.tags)?e.tags:["auto"],difficulty:e.difficulty||"medium",concept:e.type||"basic"}})):[],d=e.toLowerCase(),0===(u=u.filter((function(e){var t=h.checkTextRelation((e.front+" "+e.back).toLowerCase(),d),n=!h.checkTautology(e.front,e.back),r=h.checkEducationalValue(e.front,e.back);return t&&n&&r}))).length)return[2,[]];f.label=2;case 2:return f.trys.push([2,4,,5]),[4,this.processLatexInCards(u)];case 3:return[2,f.sent()];case 4:return f.sent(),console.warn("KaTeX post-processing failed, returning raw cards"),[2,u];case 5:return[3,7];case 6:return p=f.sent(),console.warn("Minimal-requests pipeline failed:",p),[2,[]];case 7:return[2]}}))}))},e.prototype.injectFormulas=function(e,t){var n=e.replace(/\\n/g,"\n");return n=n.replace(/\[\[F(\d+)\]\]/g,(function(e,n){var r="F".concat(n),o=t[r];if(!o)return e;var a=o.latex.replace(/\\{2,}([A-Za-z]+)/g,"\\$1").replace(/\|/g," \\mid ");return"inline"===o.display?"$".concat(a,"$"):"$$".concat(a,"$$")}))},e.prototype.executeFastCombinedProcess=function(e,t,n,r){var o,a,i,s,l;return kn(this,void 0,void 0,(function(){var r,c,u,d,p,h;return Cn(this,(function(f){switch(f.label){case 0:r=t&&((null===(o=t.pageImages)||void 0===o?void 0:o.length)>0||(null===(a=t.formulas)||void 0===a?void 0:a.length)>0||(null===(i=t.codeBlocks)||void 0===i?void 0:i.length)>0),c=null===(s=n.previousResults)||void 0===s?void 0:s.mathContent,u='\u0422\u044b - \u0413\u0415\u041d\u0415\u0420\u0410\u0422\u041e\u0420 \u041a\u0410\u0420\u0422\u041e\u0427\u0415\u041a. \u0421\u043e\u0437\u0434\u0430\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u0442\u0435\u043a\u0441\u0442\u0430:\n\n\u0422\u0415\u041a\u0421\u0422: "'.concat(e,'"\n\n').concat(c?"\u041c\u0410\u0422\u0415\u041c\u0410\u0422\u0418\u0427\u0415\u0421\u041a\u0418\u0419 \u041a\u041e\u041d\u0422\u0415\u041d\u0422: \u041e\u0411\u0420\u0410\u0411\u041e\u0422\u0410\u041d (\u0444\u043e\u0440\u043c\u0443\u043b\u044b \u0431\u0443\u0434\u0443\u0442 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u044b \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e)":"\u041c\u0410\u0422\u0415\u041c\u0410\u0422\u0418\u0427\u0415\u0421\u041a\u041e\u0413\u041e \u041a\u041e\u041d\u0422\u0415\u041d\u0422\u0410: \u043d\u0435\u0442","\n").concat(r?"\u0418\u0417\u041e\u0411\u0420\u0410\u0416\u0415\u041d\u0418\u042f: ".concat((null===(l=null==t?void 0:t.pageImages)||void 0===l?void 0:l.length)||0," \u0448\u0442"):"\u0418\u0417\u041e\u0411\u0420\u0410\u0416\u0415\u041d\u0418\u0419: \u043d\u0435\u0442",'\n\n\u0421\u0422\u0420\u041e\u0413\u0418\u0415 \u041f\u0420\u0410\u0412\u0418\u041b\u0410:\n1. \u0421\u043e\u0437\u0434\u0430\u0432\u0430\u0439 \u0432\u043e\u043f\u0440\u043e\u0441\u044b, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u041d\u0415 \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442 \u0444\u0440\u0430\u0437 \u0442\u0438\u043f\u0430 "\u043f\u043e \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u043c\u0443 \u0442\u0435\u043a\u0441\u0442\u0443", "\u0432 \u0442\u0435\u043a\u0441\u0442\u0435", "\u043a\u0430\u043a \u0443\u043a\u0430\u0437\u0430\u043d\u043e"\n2. \u0412\u043e\u043f\u0440\u043e\u0441\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c \u0435\u0441\u0442\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u043c\u0438 \u0438 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u043c\u0438\n3. \u041d\u0415 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0439 \u043b\u0438\u0448\u043d\u0438\u0435 \u0441\u043b\u043e\u0432\u0430 - \u0432\u043e\u043f\u0440\u043e\u0441 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u043f\u0440\u044f\u043c\u044b\u043c\n4. \u041c\u0430\u043a\u0441\u0438\u043c\u0443\u043c 3 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438\n5. \u0424\u043e\u043a\u0443\u0441 \u043d\u0430 \u043f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u0438, \u0430 \u043d\u0435 \u043d\u0430 \u043c\u0435\u0445\u0430\u043d\u0438\u0447\u0435\u0441\u043a\u043e\u043c \u0437\u0430\u043f\u043e\u043c\u0438\u043d\u0430\u043d\u0438\u0438\n6. \u041d\u0415 \u0432\u043a\u043b\u044e\u0447\u0430\u0439 \u0441\u044b\u0440\u044b\u0435 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b \u0432 \u0442\u0435\u043a\u0441\u0442 - \u043e\u043d\u0438 \u0431\u0443\u0434\u0443\u0442 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u044b \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e\n\n\u041f\u041b\u041e\u0425\u0418\u0415 \u041f\u0420\u0418\u041c\u0415\u0420\u042b (\u041d\u0415 \u0414\u0415\u041b\u0410\u0422\u042c):\n\u274c "\u041a\u0430\u043a \u043f\u043e \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u043c\u0443 \u0442\u0435\u043a\u0441\u0442\u0443 \u0432\u044b\u0447\u0438\u0441\u043b\u0438\u0442\u044c..."\n\u274c "\u0427\u0442\u043e \u0433\u043e\u0432\u043e\u0440\u0438\u0442\u0441\u044f \u0432 \u0442\u0435\u043a\u0441\u0442\u0435 \u043e..."\n\u274c "\u041a\u0430\u043a\u0430\u044f \u0444\u043e\u0440\u043c\u0443\u043b\u0430 \u043f\u0440\u0438\u0432\u0435\u0434\u0435\u043d\u0430..."\n\u274c \u0412\u0441\u0442\u0430\u0432\u043a\u0430 \u0441\u044b\u0440\u044b\u0445 \u0444\u043e\u0440\u043c\u0443\u043b \u0442\u0438\u043f\u0430 "m_a^2 + m_b^2 + m_c^2 = 3/4 S"\n\n\u0425\u041e\u0420\u041e\u0428\u0418\u0415 \u041f\u0420\u0418\u041c\u0415\u0420\u042b:\n\u2705 "\u041a\u0430\u043a \u0432\u044b\u0447\u0438\u0441\u043b\u0438\u0442\u044c \u0441\u0443\u043c\u043c\u0443 \u043a\u0432\u0430\u0434\u0440\u0430\u0442\u043e\u0432 \u043c\u0435\u0434\u0438\u0430\u043d \u0442\u0440\u0435\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\u0430?"\n\u2705 "\u041a\u0430\u043a\u0438\u0435 \u0441\u0442\u043e\u0440\u043e\u043d\u044b \u0442\u0440\u0435\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\u0430 \u0441\u0432\u044f\u0437\u0430\u043d\u044b \u0441 \u043c\u0435\u0434\u0438\u0430\u043d\u0430\u043c\u0438?"\n\u2705 "\u0427\u0442\u043e \u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442 \u0441\u043e\u043e\u0442\u043d\u043e\u0448\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u043c\u0435\u0434\u0438\u0430\u043d \u0432 \u0442\u0440\u0435\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\u0435?"\n\u2705 \u041e\u043f\u0438\u0441\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u0432\u043e\u043f\u0440\u043e\u0441\u044b \u0431\u0435\u0437 \u0441\u044b\u0440\u044b\u0445 \u0444\u043e\u0440\u043c\u0443\u043b\n\nJSON:\n{\n  "cards": [\n    {\n      "front": "\u041f\u0440\u044f\u043c\u043e\u0439 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0439 \u0432\u043e\u043f\u0440\u043e\u0441 \u0431\u0435\u0437 \u043b\u0438\u0448\u043d\u0438\u0445 \u0441\u043b\u043e\u0432",\n      "back": "\u041f\u043e\u043b\u043d\u044b\u0439 \u043e\u0442\u0432\u0435\u0442 \u0441 \u043e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u0435\u043c (\u0444\u043e\u0440\u043c\u0443\u043b\u044b \u0431\u0443\u0434\u0443\u0442 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u044b \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e)",\n      "difficulty": "medium",\n      "concept": "\u041e\u0441\u043d\u043e\u0432\u043d\u0430\u044f \u0442\u0435\u043c\u0430",\n      "tags": ["\u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0439_\u0442\u0435\u043a\u0441\u0442"]\n    }\n  ]\n}'),f.label=1;case 1:return f.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:"\u0422\u044b - \u0431\u044b\u0441\u0442\u0440\u044b\u0439 \u0433\u0435\u043d\u0435\u0440\u0430\u0442\u043e\u0440 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0445 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a. \u0424\u043e\u043a\u0443\u0441 \u043d\u0430 \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u0438 \u0438 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435."},{role:"user",content:u}])];case 2:if(!(null==(d=f.sent())?void 0:d.content))throw new Error("No response from fast process");if(!(p=this.parseJSONResponse(d.content,"fastCombined")).cards||!Array.isArray(p.cards)||0===p.cards.length)throw new Error("No cards generated");return console.log("\u26a1 FAST: Generated ".concat(p.cards.length," cards in single API call")),[2,p];case 3:return h=f.sent(),console.error("Fast combined process error:",h),[2,this.createFallbackCardsSimple(e)];case 4:return[2]}}))}))},e.prototype.executeFastQualityValidation=function(e,t,n){var r;return kn(this,void 0,void 0,(function(){var n,o,a=this;return Cn(this,(function(i){return n=(null===(r=t.originalText)||void 0===r?void 0:r.toLowerCase())||"",o=e.filter((function(e){var t=(e.front+" "+e.back).toLowerCase();return a.checkTextRelation(t,n)?a.checkTautology(e.front,e.back)?(console.log("\u274c \u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u043e\u0442\u043a\u043b\u043e\u043d\u0435\u043d\u0430: \u0442\u0430\u0432\u0442\u043e\u043b\u043e\u0433\u0438\u044f",e.front),!1):!!a.checkEducationalValue(e.front,e.back)||(console.log("\u274c \u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u043e\u0442\u043a\u043b\u043e\u043d\u0435\u043d\u0430: \u043d\u0435\u0442 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0439 \u0446\u0435\u043d\u043d\u043e\u0441\u0442\u0438",e.front),!1):(console.log("\u274c \u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u043e\u0442\u043a\u043b\u043e\u043d\u0435\u043d\u0430: \u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u043c\u0443 \u0442\u0435\u043a\u0441\u0442\u0443",e.front),!1)})),console.log("\u26a1 FAST Quality: ".concat(o.length,"/").concat(e.length," cards passed validation")),[2,o.length>0?o:e]}))}))},e.prototype.checkTextRelation=function(e,t){var n=t.split(/\s+/).filter((function(e){return e.length>2})),r=e.split(/\s+/).filter((function(e){return e.length>2})),o=n.filter((function(e){return r.some((function(t){return t.includes(e)||e.includes(t)}))})).length>=2,a=n.some((function(t){return t.length>5&&e.includes(t)}));return o||a},e.prototype.checkTautology=function(e,t){var n=e.toLowerCase().split(/\s+/).filter((function(e){return e.length>2})),r=t.toLowerCase().split(/\s+/).filter((function(e){return e.length>2}));return n.filter((function(e){return r.some((function(t){return t.includes(e)&&e!==t}))})).length>.3*n.length},e.prototype.checkEducationalValue=function(e,t){var n,r=e.trim().length;if(t.trim().length<1.5*r)return!1;for(var o=e.toLowerCase(),a=0,i=["\u043f\u043e \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u043c\u0443 \u0442\u0435\u043a\u0441\u0442\u0443","\u0432 \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u043c \u0442\u0435\u043a\u0441\u0442\u0435","\u043a\u0430\u043a \u0443\u043a\u0430\u0437\u0430\u043d\u043e","\u0447\u0442\u043e \u0433\u043e\u0432\u043e\u0440\u0438\u0442\u0441\u044f","\u043a\u0430\u043a\u0430\u044f \u0444\u043e\u0440\u043c\u0443\u043b\u0430 \u043f\u0440\u0438\u0432\u0435\u0434\u0435\u043d\u0430","\u0447\u0442\u043e \u0432\u0430\u0436\u043d\u043e \u0432 \u044d\u0442\u043e\u043c","\u043a\u0430\u043a\u043e\u0439 \u043a\u043b\u044e\u0447\u0435\u0432\u043e\u0439 \u043c\u043e\u043c\u0435\u043d\u0442 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442\u0441\u044f"];a<i.length;a++){var s=i[a];if(o.includes(s))return console.log('\u274c \u0417\u0430\u043f\u0440\u0435\u0449\u0435\u043d\u043d\u0430\u044f \u0444\u0440\u0430\u0437\u0430 \u0432 \u0432\u043e\u043f\u0440\u043e\u0441\u0435: "'.concat(s,'"')),!1}var l=e.toLowerCase(),c=t.toLowerCase();if(l.includes("\u0447\u0442\u043e \u0442\u0430\u043a\u043e\u0435")&&c.includes("\u044d\u0442\u043e")){var u=null===(n=l.split("\u0447\u0442\u043e \u0442\u0430\u043a\u043e\u0435")[1])||void 0===n?void 0:n.trim();if(u&&c.includes(u.split(" ")[0]))return!1}return!0},e.prototype.applyMultimediaFast=function(e,t,n){var r,o,a=this;return console.log("\u{1f3a8} \u041f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430: ".concat((null===(r=null==t?void 0:t.pageImages)||void 0===r?void 0:r.length)||0," \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0439 \u0434\u043b\u044f ").concat(e.length," \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a")),console.log("\u{1f4d0} \u041c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b: ".concat((null===(o=null==n?void 0:n.formulas)||void 0===o?void 0:o.length)||0," \u0448\u0442")),e.map((function(e,r){var o,i,s=Sn({},e);if(null===(o=null==t?void 0:t.pageImages)||void 0===o?void 0:o.length){var l=t.pageImages,c=a.findRelevantImagesForCard(e,l);if(c.length>0){var u=c[0];console.log("\u{1f5bc}\ufe0f \u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 ".concat(r+1,": ").concat(c.length," \u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u044b\u0445 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0439")),s=Sn(Sn({},s),{attachedImages:c,image:u.base64||null,imageUrl:u.src||null})}}return(null===(i=null==n?void 0:n.formulas)||void 0===i?void 0:i.length)&&(s=a.applyFormulasToCard(s,n.formulas),console.log("\u{1f4d0} \u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 ".concat(r+1,": \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u044b \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b"))),s}))},e.prototype.applyFormulasToCard=function(e,t){var n=this,r=e.back;return r=this.processRawFormulasInText(r),t.forEach((function(e,t){["[MATH:".concat(e.original,"][/MATH]"),"[MATH:inline:".concat(e.original,"][/MATH]"),"[MATH:example:".concat(e.original,"][/MATH]")].forEach((function(t){if(r.includes(t)){if(n.hasFormulaDuplicate(r,e))return console.log("\u26a0\ufe0f \u041f\u0440\u043e\u043f\u0443\u0441\u043a\u0430\u0435\u043c \u0434\u0443\u0431\u043b\u0438\u0440\u0443\u044e\u0449\u0443\u044e\u0441\u044f \u0444\u043e\u0440\u043c\u0443\u043b\u0443 ".concat(t)),void(r=r.replace(t,""));var o="block";t.includes("inline:")?o="inline":t.includes("example:")&&(o="example");var a=n.createLatexFormula(e,o);r=r.replace(t,a),console.log("\u{1f504} \u0417\u0430\u043c\u0435\u043d\u0430 ".concat(t," \u043d\u0430 LaTeX \u0444\u043e\u0440\u043c\u0443\u043b\u0443 \u0432 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0435"))}}))})),Sn(Sn({},e),{back:r})},e.prototype.createLatexFormula=function(e,t){var n=e.latex;switch(t){case"inline":return"$".concat(n,"$");case"example":return'<div style="border: 2px solid #3B82F6; border-radius: 8px; padding: 12px; margin: 8px 0; background: #F0F9FF;">$$'.concat(n,"$$</div>");default:return"$$".concat(n,"$$")}},e.prototype.hasFormulaDuplicate=function(e,t){var n=e.toLowerCase(),r=(t.original||"").toLowerCase();if(r&&n.includes(r))return!0;var o=t.latex.toLowerCase().split(/[^a-zA-Z0-9]/).filter((function(e){return e.length>2})),a=0;return o.forEach((function(e){n.includes(e)&&a++})),a>.5*o.length},e.prototype.processRawFormulasInText=function(e){var t=this,n=e;return n=(n=(n=(n=n.replace(/\(\$\s*([^$]+)\s*\$\)/g,(function(e,t){return"$$".concat(t,"$$")}))).replace(/\$\$\s*([^$]+)\s*\$\$/g,(function(e,t){return"$$".concat(t,"$$")}))).replace(/\(\$\$\s*([^$]+)\s*\$\$\)/g,(function(e,n){var r=t.fixFormulaErrors(n);return"$$".concat(r,"$$")}))).replace(/\$\$\s*([^$]+?)\s*\$\$/g,(function(e,n){var r=t.fixFormulaErrors(n);return"$$".concat(r,"$$")})),console.log("\u{1f527} Processed raw formulas in text"),n},e.prototype.fixFormulaErrors=function(e){var t=e;return t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/1\^{2}/g,"a^{2}")).replace(/2\^{2}/g,"b^{2}")).replace(/3\^{2}/g,"c^{2}")).replace(/\\\(/g,"(")).replace(/\\\)/g,")")).replace(/m_a/g,"m_{a}")).replace(/m_b/g,"m_{b}")).replace(/m_c/g,"m_{c}")).replace(/\\frac\s*\{\s*3\s*\}\s*\{\s*4\s*\}/g,"\\frac{3}{4}")).replace(/\\\(\s*\\frac\s*\{\s*3\s*\}\s*\{\s*4\s*\}\s*\\\)/g,"\\frac{3}{4}"),console.log('\u{1f527} Fixed formula: "'.concat(e,'" \u2192 "').concat(t,'"')),t},e.prototype.findRelevantImagesForCard=function(e,t){var n=this,r=(e.front+" "+e.back+" "+(e.concept||"")).toLowerCase(),o=r.split(/\s+/).filter((function(e){return e.length>2})),a=t.filter((function(e){var t=(e.alt||"").toLowerCase(),n=(e.title||"").toLowerCase(),o=["\u0444\u043e\u0440\u043c\u0443\u043b\u0430","\u0442\u0435\u043e\u0440\u0435\u043c\u0430","\u0434\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c\u0441\u0442\u0432\u043e","\u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u043a\u0430","\u0430\u043b\u0433\u0435\u0431\u0440\u0430","\u0433\u0435\u043e\u043c\u0435\u0442\u0440\u0438\u044f"].some((function(e){return t.includes(e)||n.includes(e)})),a=r.includes("\u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u043a")||r.includes("\u0444\u043e\u0440\u043c\u0443\u043b")||r.includes("\u0442\u0435\u043e\u0440\u0435\u043c")||r.includes("\u0434\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c\u0441\u0442\u0432");return!(o&&!a)||(console.log("\u26a0\ufe0f \u0418\u0441\u043a\u043b\u044e\u0447\u0430\u0435\u043c \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u043d\u0435\u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438: ".concat(t)),!1)})).map((function(e){var t=(e.alt||"").toLowerCase(),a=(e.title||"").toLowerCase(),i=0,s=0;return o.forEach((function(e){t.includes(e)&&(i+=3,s++),a.includes(e)&&(i+=2,s++)})),n.extractKeyTerms(r).forEach((function(e){t.includes(e.toLowerCase())&&(i+=5,s++)})),i+=2*(e.relevanceScore||0),e.isNearText&&(i+=2),(t.length<10||t.includes("\u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435")||t.includes("\u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0430"))&&(i-=2),{image:e,score:i,matches:s}})).filter((function(e){return e.score>3})).sort((function(e,t){return t.score-e.score})).slice(0,1).map((function(e){return e.image}));return a.length>0&&console.log("\u{1f5bc}\ufe0f \u041d\u0430\u0439\u0434\u0435\u043d\u043e ".concat(a.length," \u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u043e\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438")),a},e.prototype.extractKeyTerms=function(e){for(var t=e.split(/\s+/),n=[],r=0;r<t.length;r++){var o=t[r].toLowerCase();if(!(o.length<4)&&(!["\u0447\u0442\u043e","\u043a\u0430\u043a","\u0434\u043b\u044f","\u044d\u0442\u043e","\u043f\u0440\u0438","\u0434\u043b\u044f","\u0438\u043b\u0438","\u0438\u0437","\u043d\u0430","\u043f\u043e","\u043e\u0442","\u0434\u043e"].includes(o)&&(n.includes(o)||n.push(o),r<t.length-1))){var a=t[r+1].toLowerCase();if(a.length>2&&!["\u0438","\u0430","\u043d\u043e","\u0438\u043b\u0438","\u0438\u0437","\u043d\u0430","\u043f\u043e","\u043e\u0442","\u0434\u043e"].includes(a)){var i="".concat(o," ").concat(a);i.length>6&&!n.includes(i)&&n.push(i)}}}return n.slice(0,5)},e.prototype.createFallbackCardsSimple=function(e){var t=[],n=e.split(/[.!?]+/).filter((function(e){return e.trim().length>10}));if(n.length>0){var r=n[0].trim();r.length>20&&t.push({front:"\u041a\u0430\u043a\u043e\u0439 \u043a\u043b\u044e\u0447\u0435\u0432\u043e\u0439 \u043c\u043e\u043c\u0435\u043d\u0442 \u0437\u0434\u0435\u0441\u044c \u0432\u0430\u0436\u0435\u043d?",back:r,difficulty:"medium",concept:"\u041a\u043b\u044e\u0447\u0435\u0432\u043e\u0439 \u043c\u043e\u043c\u0435\u043d\u0442",tags:["\u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0439_\u0442\u0435\u043a\u0441\u0442"]})}if(n.length>1){var o=n[1].trim();o.length>20&&o!==n[0].trim()&&t.push({front:"\u0427\u0442\u043e \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0432\u0430\u0436\u043d\u044b\u043c \u0441\u043b\u0435\u0434\u0441\u0442\u0432\u0438\u0435\u043c?",back:o,difficulty:"medium",concept:"\u0421\u0432\u044f\u0437\u044c \u0438\u0434\u0435\u0439",tags:["\u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0439_\u0442\u0435\u043a\u0441\u0442"]})}return 0===t.length&&t.push({front:"\u0427\u0442\u043e \u0437\u0434\u0435\u0441\u044c \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0441\u0430\u043c\u044b\u043c \u0432\u0430\u0436\u043d\u044b\u043c?",back:e.substring(0,200)+(e.length>200?"...":""),difficulty:"medium",concept:"\u0412\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0439 \u043a\u043e\u043d\u0442\u0435\u043d\u0442",tags:["\u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0439_\u0442\u0435\u043a\u0441\u0442"]}),console.log("\u26a0\ufe0f Fallback: \u0441\u043e\u0437\u0434\u0430\u043d\u044b ".concat(t.length," \u043f\u0440\u043e\u0441\u0442\u044b\u0435 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u0438\u0437 \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u0442\u0435\u043a\u0441\u0442\u0430")),{cards:t,analysis:{mainTopic:"\u0412\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0439 \u0442\u0435\u043a\u0441\u0442",complexity:"medium",estimatedCards:t.length,hasMultimedia:!1}}},e.prototype.executeSupervisor=function(e,t){return kn(this,void 0,void 0,(function(){var n,r,o;return Cn(this,(function(a){switch(a.label){case 0:n='\u0422\u044b - Supervisor AI Agent. \u041f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 \u0442\u0435\u043a\u0441\u0442 \u0438 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438 \u043e\u043f\u0442\u0438\u043c\u0430\u043b\u044c\u043d\u0443\u044e \u0441\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u044e \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a.\n\n\u0422\u0415\u041a\u0421\u0422: "'.concat(e,'"\n\n\u041a\u041e\u041d\u0422\u0415\u041a\u0421\u0422:\n- \u0414\u043b\u0438\u043d\u0430: ').concat(t.metadata.textLength," \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432\n- \u0421\u043b\u043e\u0436\u043d\u043e\u0441\u0442\u044c: ").concat(t.metadata.complexity,"\n- \u042f\u0437\u044b\u043a: ").concat(t.metadata.language,'\n\n\u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n1. \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0438 \u0441\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u044e \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f (single_concept, multiple_concepts, step_by_step, comparison)\n2. \u0420\u0435\u0448\u0438 \u043a\u0430\u043a\u0438\u0435 \u0430\u0433\u0435\u043d\u0442\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u0438 \u043a\u0430\u043a\n3. \u0414\u0430\u0439 \u0447\u0435\u0442\u043a\u0438\u0435 \u0438\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u0438 \u043a\u0430\u0436\u0434\u043e\u043c\u0443 \u0430\u0433\u0435\u043d\u0442\u0443\n4. \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0438 \u043e\u0436\u0438\u0434\u0430\u0435\u043c\u044b\u0439 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\n\n\u0421\u0422\u0420\u0410\u0422\u0415\u0413\u0418\u0418:\n- single_concept: \u043e\u0434\u0438\u043d \u043a\u043b\u044e\u0447\u0435\u0432\u043e\u0439 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\n- multiple_concepts: \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043d\u0435\u0437\u0430\u0432\u0438\u0441\u0438\u043c\u044b\u0445 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u043e\u0432  \n- step_by_step: \u043f\u043e\u0448\u0430\u0433\u043e\u0432\u044b\u0439 \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u0438\u043b\u0438 \u0430\u043b\u0433\u043e\u0440\u0438\u0442\u043c\n- comparison: \u0441\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u0435 \u0438\u043b\u0438 \u043f\u0440\u043e\u0442\u0438\u0432\u043e\u043f\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0435\n\nJSON \u043e\u0442\u0432\u0435\u0442:\n{\n  "strategy": "step_by_step",\n  "agents": ["contentAnalyzer", "cardGenerator", "questionQuality", "validator"],\n  "instructions": {\n    "contentAnalyzer": "\u0412\u044b\u0434\u0435\u043b\u0438 \u043e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0448\u0430\u0433\u0438 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \u0438 \u0438\u0445 \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c",\n    "cardGenerator": "\u0421\u043e\u0437\u0434\u0430\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0448\u0430\u0433\u0430 \u0441 \u0430\u043a\u0446\u0435\u043d\u0442\u043e\u043c \u043d\u0430 \u043f\u0440\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u0435",\n    "questionQuality": "\u041f\u0440\u043e\u0432\u0435\u0440\u044c \u0447\u0442\u043e \u043a\u0430\u0436\u0434\u044b\u0439 \u0432\u043e\u043f\u0440\u043e\u0441 \u043f\u043e\u043c\u043e\u0433\u0430\u0435\u0442 \u043f\u043e\u043d\u044f\u0442\u044c \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0439",\n    "validator": "\u0423\u0431\u0435\u0434\u0438\u0441\u044c \u0447\u0442\u043e \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u043e\u0431\u0440\u0430\u0437\u0443\u044e\u0442 \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f"\n  },\n  "expectedOutput": "\u041d\u0430\u0431\u043e\u0440 \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a \u043f\u043e\u043a\u0440\u044b\u0432\u0430\u044e\u0449\u0438\u0445 \u043f\u043e\u0448\u0430\u0433\u043e\u0432\u044b\u0439 \u043f\u0440\u043e\u0446\u0435\u0441\u0441",\n  "reasoning": "\u0422\u0435\u043a\u0441\u0442 \u043e\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u0442 \u043f\u0440\u043e\u0446\u0435\u0434\u0443\u0440\u0443, \u043b\u0443\u0447\u0448\u0435 \u0438\u0437\u0443\u0447\u0430\u0442\u044c \u043f\u043e \u0448\u0430\u0433\u0430\u043c"\n}'),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.supervisor.systemPrompt},{role:"user",content:n}])];case 2:if(!(null==(r=a.sent())?void 0:r.content))throw new Error("No response from supervisor agent");return[2,this.parseJSONResponse(r.content,"supervisor")];case 3:return o=a.sent(),console.error("Supervisor agent error:",o),[2,this.createFallbackSupervisorDecision()];case 4:return[2]}}))}))},e.prototype.executeCardGenerator=function(e,t){var n,r,o,a;return kn(this,void 0,void 0,(function(){var t,i,s,l,c,u,d,p;return Cn(this,(function(h){switch(h.label){case 0:t=e.text,i=e.cardPlan,s=e.textAnalysis,e.multimediaDistribution,l=e.analysis,c=e.instructions,u=i&&s?'\u0422\u044b - Card Generator Agent. \u0421\u043e\u0437\u0434\u0430\u0439 \u0432\u044b\u0441\u043e\u043a\u043e\u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0435 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u0422\u041e\u0427\u041d\u041e \u043f\u043e \u043f\u043b\u0430\u043d\u0443.\n\n\u0422\u0415\u041a\u0421\u0422: "'.concat(t,'"\n\n\u0410\u041d\u0410\u041b\u0418\u0417 \u0422\u0415\u041a\u0421\u0422\u0410:\n- \u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0442\u0435\u043c\u044b: ').concat(s.mainTopics.map((function(e){return e.name})).join(", "),"\n- \u0420\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u043c\u044b\u0435 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438: ").concat(s.estimatedCards,"\n- \u0421\u043b\u043e\u0436\u043d\u043e\u0441\u0442\u044c: ").concat(s.complexity,"\n- \u041c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u043e: ").concat(s.hasMultimedia?"\u0414\u0410":"\u041d\u0415\u0422","\n\n\u041f\u041b\u0410\u041d \u041a\u0410\u0420\u0422\u041e\u0427\u0415\u041a (\u0421\u041b\u0415\u0414\u0423\u0419 \u0422\u041e\u0427\u041d\u041e):\n").concat(i.cardSpecs.map((function(e,t){return"\n\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 ".concat(t+1," (").concat(e.id,"):\n- \u0422\u0438\u043f: ").concat(e.type,"\n- \u0422\u0435\u043c\u0430: ").concat(e.topic,"\n- \u041f\u0440\u0438\u043e\u0440\u0438\u0442\u0435\u0442: ").concat(e.priority,"\n- \u0421\u043b\u043e\u0436\u043d\u043e\u0441\u0442\u044c: ").concat(e.difficulty,"\n- \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435: ").concat(e.description,"\n- \u041d\u0443\u0436\u0435\u043d \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430: ").concat(e.needsMultimedia?"\u0414\u0410":"\u041d\u0415\u0422","\n")})).join(""),'\n\n\u041a\u0420\u0418\u0422\u0418\u0427\u0415\u0421\u041a\u0418\u0415 \u0422\u0420\u0415\u0411\u041e\u0412\u0410\u041d\u0418\u042f \u041a \u041a\u0410\u0427\u0415\u0421\u0422\u0412\u0423:\n1. \u041d\u0418\u041a\u041e\u0413\u0414\u0410 \u041d\u0415 \u0414\u0423\u0411\u041b\u0418\u0420\u0423\u0419 \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u0441\u043b\u043e\u0432\u0430 \u0438\u0437 \u0432\u043e\u043f\u0440\u043e\u0441\u0430 \u0432 \u043e\u0442\u0432\u0435\u0442\u0435\n2. \u0412\u043e\u043f\u0440\u043e\u0441\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u041f\u041e\u041d\u0418\u041c\u0410\u041d\u0418\u0415, \u043d\u0435 \u043f\u0430\u043c\u044f\u0442\u044c\n3. \u041e\u0442\u0432\u0435\u0442\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c \u0418\u041d\u0424\u041e\u0420\u041c\u0410\u0422\u0418\u0412\u041d\u042b\u041c\u0418 \u0438 \u041e\u0411\u0423\u0427\u0410\u042e\u0429\u0418\u041c\u0418\n4. \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0439 \u041a\u041e\u041d\u0422\u0415\u041a\u0421\u0422 \u0438 \u041e\u0411\u042a\u042f\u0421\u041d\u0415\u041d\u0418\u042f\n5. \u0418\u0437\u0431\u0435\u0433\u0430\u0439 \u041e\u0427\u0415\u0412\u0418\u0414\u041d\u042b\u0425 \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432\n\n\u041f\u041b\u041e\u0425\u0418\u0415 \u041f\u0420\u0418\u041c\u0415\u0420\u042b (\u041d\u0415 \u0414\u0415\u041b\u0410\u0419 \u0422\u0410\u041a):\n\u274c "\u0427\u0442\u043e \u0442\u0430\u043a\u043e\u0435 \u043b\u0435\u0432?" \u2192 "\u041b\u0435\u0432 - \u044d\u0442\u043e \u043b\u0435\u0432"\n\u274c "\u041a\u0430\u043a\u043e\u0439 \u0432\u0438\u0434 \u043c\u043b\u0435\u043a\u043e\u043f\u0438\u0442\u0430\u044e\u0449\u0438\u0445 \u043b\u0435\u0432?" \u2192 "\u041b\u0435\u0432 - \u0432\u0438\u0434 \u0445\u0438\u0449\u043d\u044b\u0445 \u043c\u043b\u0435\u043a\u043e\u043f\u0438\u0442\u0430\u044e\u0449\u0438\u0445"\n\u274c "\u0413\u0434\u0435 \u0436\u0438\u0432\u0443\u0442 \u043b\u044c\u0432\u044b?" \u2192 "\u041b\u044c\u0432\u044b \u0436\u0438\u0432\u0443\u0442 \u0432 \u0410\u0444\u0440\u0438\u043a\u0435"\n\n\u0425\u041e\u0420\u041e\u0428\u0418\u0415 \u041f\u0420\u0418\u041c\u0415\u0420\u042b:\n\u2705 "\u041f\u043e\u0447\u0435\u043c\u0443 \u043b\u044c\u0432\u044b \u0435\u0434\u0438\u043d\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0435 \u0441\u043e\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0435 \u0431\u043e\u043b\u044c\u0448\u0438\u0435 \u043a\u043e\u0448\u043a\u0438?" \u2192 "\u041b\u044c\u0432\u044b \u0436\u0438\u0432\u0443\u0442 \u043f\u0440\u0430\u0439\u0434\u0430\u043c\u0438 \u0434\u043b\u044f \u0441\u043e\u0432\u043c\u0435\u0441\u0442\u043d\u043e\u0439 \u043e\u0445\u043e\u0442\u044b \u043d\u0430 \u043a\u0440\u0443\u043f\u043d\u0443\u044e \u0434\u043e\u0431\u044b\u0447\u0443, \u0437\u0430\u0449\u0438\u0442\u044b \u0442\u0435\u0440\u0440\u0438\u0442\u043e\u0440\u0438\u0438 \u0438 \u0432\u043e\u0441\u043f\u0438\u0442\u0430\u043d\u0438\u044f \u043f\u043e\u0442\u043e\u043c\u0441\u0442\u0432\u0430. \u0414\u0440\u0443\u0433\u0438\u0435 \u0431\u043e\u043b\u044c\u0448\u0438\u0435 \u043a\u043e\u0448\u043a\u0438 (\u0442\u0438\u0433\u0440\u044b, \u043b\u0435\u043e\u043f\u0430\u0440\u0434\u044b) - \u043e\u0434\u0438\u043d\u043e\u0447\u043a\u0438"\n\u2705 "\u041a\u0430\u043a\u0438\u0435 \u0430\u0434\u0430\u043f\u0442\u0430\u0446\u0438\u0438 \u043f\u043e\u043c\u043e\u0433\u0430\u044e\u0442 \u043b\u044c\u0432\u0430\u043c \u043e\u0445\u043e\u0442\u0438\u0442\u044c\u0441\u044f \u0432 \u0433\u0440\u0443\u043f\u043f\u0435?" \u2192 "\u0421\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f \u0440\u043e\u043b\u0435\u0439: \u0441\u0430\u043c\u043a\u0438-\u043e\u0445\u043e\u0442\u043d\u0438\u0446\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442 \u0441\u043a\u0440\u044b\u0442\u043d\u043e\u0441\u0442\u044c \u0438 \u043a\u043e\u043e\u0440\u0434\u0438\u043d\u0430\u0446\u0438\u044e, \u0441\u0430\u043c\u0446\u044b \u0437\u0430\u0449\u0438\u0449\u0430\u044e\u0442 \u043f\u0440\u0430\u0439\u0434. \u0420\u0430\u0437\u0432\u0438\u0442\u0430\u044f \u043a\u043e\u043c\u043c\u0443\u043d\u0438\u043a\u0430\u0446\u0438\u044f \u0447\u0435\u0440\u0435\u0437 \u0440\u044b\u043a \u0438 \u0436\u0435\u0441\u0442\u044b"\n\n\u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n1. \u0421\u043e\u0437\u0434\u0430\u0439 \u0420\u041e\u0412\u041d\u041e ').concat(i.totalCards,' \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a \u043f\u043e \u043f\u043b\u0430\u043d\u0443\n2. \u041a\u0430\u0436\u0434\u0430\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u0434\u043e\u043b\u0436\u043d\u0430 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c \u0441\u0432\u043e\u0435\u043c\u0443 CardSpec\n3. \u041d\u0415 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0439 \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u0441\u0435\u0439\u0447\u0430\u0441 - \u044d\u0442\u043e \u0431\u0443\u0434\u0435\u0442 \u0441\u0434\u0435\u043b\u0430\u043d\u043e \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e\n4. \u0421\u043e\u0441\u0440\u0435\u0434\u043e\u0442\u043e\u0447\u044c\u0441\u044f \u043d\u0430 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u043c \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u043d\u0438\u0438\n5. \u041f\u0420\u041e\u0412\u0415\u0420\u042c \u043a\u0430\u0436\u0434\u0443\u044e \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0443 \u043d\u0430 \u0434\u0443\u0431\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0441\u043b\u043e\u0432\n\nJSON \u043e\u0442\u0432\u0435\u0442:\n{\n  "cards": [\n    {\n      "front": "\u0412\u043e\u043f\u0440\u043e\u0441 \u0434\u043b\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 1 (\u0411\u0415\u0417 \u0434\u0443\u0431\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0445 \u0441\u043b\u043e\u0432 \u0438\u0437 \u043e\u0442\u0432\u0435\u0442\u0430)",\n      "back": "\u0418\u043d\u0444\u043e\u0440\u043c\u0430\u0442\u0438\u0432\u043d\u044b\u0439 \u043e\u0442\u0432\u0435\u0442 \u0441 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u043e\u043c \u0438 \u043e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u044f\u043c\u0438",\n      "tags": ["').concat((null===(n=s.mainTopics[0])||void 0===n?void 0:n.name)||"\u043e\u0431\u0449\u0435\u0435",'"],\n      "difficulty": "medium",\n      "concept": "').concat((null===(r=i.cardSpecs[0])||void 0===r?void 0:r.topic)||"\u043a\u043e\u043d\u0446\u0435\u043f\u0442",'"\n    }\n  ]\n}'):'\u0422\u044b - Card Generator Agent. \u0421\u043e\u0437\u0434\u0430\u0439 \u0432\u044b\u0441\u043e\u043a\u043e\u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0435 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438.\n\n\u0422\u0415\u041a\u0421\u0422: "'.concat(t,'"\n\n\u0410\u041d\u0410\u041b\u0418\u0417 \u041a\u041e\u041d\u0422\u0415\u041d\u0422\u0410:\n- \u0422\u0435\u043c\u0430: ').concat((null==l?void 0:l.mainTopic)||"\u041e\u0431\u0449\u0430\u044f \u0442\u0435\u043c\u0430","\n- \u041a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u043f\u043e\u043d\u044f\u0442\u0438\u044f: ").concat((null===(o=null==l?void 0:l.concepts)||void 0===o?void 0:o.map((function(e){return e.name})).join(", "))||"\u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u044b","\n- \u0426\u0435\u043b\u0438 \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f: ").concat((null===(a=null==l?void 0:l.learningObjectives)||void 0===a?void 0:a.join(", "))||"\u0418\u0437\u0443\u0447\u0435\u043d\u0438\u0435 \u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b\u0430","\n- \u0421\u043b\u043e\u0436\u043d\u043e\u0441\u0442\u044c: ").concat((null==l?void 0:l.complexity)||"medium","\n\n\u0418\u041d\u0421\u0422\u0420\u0423\u041a\u0426\u0418\u0418: ").concat(c||"\u0421\u043e\u0437\u0434\u0430\u0439 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0435 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438",'\n\n\u041a\u0420\u0418\u0422\u0418\u0427\u0415\u0421\u041a\u0418\u0415 \u0422\u0420\u0415\u0411\u041e\u0412\u0410\u041d\u0418\u042f \u041a \u041a\u0410\u0427\u0415\u0421\u0422\u0412\u0423:\n1. \u041d\u0418\u041a\u041e\u0413\u0414\u0410 \u041d\u0415 \u0414\u0423\u0411\u041b\u0418\u0420\u0423\u0419 \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u0441\u043b\u043e\u0432\u0430 \u0438\u0437 \u0432\u043e\u043f\u0440\u043e\u0441\u0430 \u0432 \u043e\u0442\u0432\u0435\u0442\u0435\n2. \u0412\u043e\u043f\u0440\u043e\u0441\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u041f\u041e\u041d\u0418\u041c\u0410\u041d\u0418\u0415, \u043d\u0435 \u043f\u0430\u043c\u044f\u0442\u044c\n3. \u041e\u0442\u0432\u0435\u0442\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c \u0418\u041d\u0424\u041e\u0420\u041c\u0410\u0422\u0418\u0412\u041d\u042b\u041c\u0418 \u0438 \u041e\u0411\u0423\u0427\u0410\u042e\u0429\u0418\u041c\u0418\n4. \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0439 \u041a\u041e\u041d\u0422\u0415\u041a\u0421\u0422 \u0438 \u041e\u0411\u042a\u042f\u0421\u041d\u0415\u041d\u0418\u042f\n5. \u0418\u0437\u0431\u0435\u0433\u0430\u0439 \u041e\u0427\u0415\u0412\u0418\u0414\u041d\u042b\u0425 \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432\n\n\u041f\u041b\u041e\u0425\u0418\u0415 \u041f\u0420\u0418\u041c\u0415\u0420\u042b (\u041d\u0415 \u0414\u0415\u041b\u0410\u0419 \u0422\u0410\u041a):\n\u274c "\u0427\u0442\u043e \u0442\u0430\u043a\u043e\u0435 HTML?" \u2192 "HTML - \u044d\u0442\u043e HTML"\n\u274c "\u041a\u0430\u043a\u043e\u0439 \u044f\u0437\u044b\u043a \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f Python?" \u2192 "Python - \u044f\u0437\u044b\u043a \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f"\n\u274c "\u0413\u0434\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f JavaScript?" \u2192 "JavaScript \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0432 \u0432\u0435\u0431-\u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0435"\n\n\u0425\u041e\u0420\u041e\u0428\u0418\u0415 \u041f\u0420\u0418\u041c\u0415\u0420\u042b:\n\u2705 "\u041f\u043e\u0447\u0435\u043c\u0443 Python \u0441\u0447\u0438\u0442\u0430\u0435\u0442\u0441\u044f \u043f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0438\u043c \u0434\u043b\u044f \u043d\u0430\u0447\u0438\u043d\u0430\u044e\u0449\u0438\u0445 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0441\u0442\u043e\u0432?" \u2192 "Python \u0438\u043c\u0435\u0435\u0442 \u043f\u0440\u043e\u0441\u0442\u043e\u0439 \u0441\u0438\u043d\u0442\u0430\u043a\u0441\u0438\u0441, \u0431\u043b\u0438\u0437\u043a\u0438\u0439 \u043a \u0430\u043d\u0433\u043b\u0438\u0439\u0441\u043a\u043e\u043c\u0443 \u044f\u0437\u044b\u043a\u0443, \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u0430\u043c\u044f\u0442\u044c\u044e, \u0431\u043e\u0433\u0430\u0442\u0443\u044e \u0441\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u0443\u044e \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0443 \u0438 \u0430\u043a\u0442\u0438\u0432\u043d\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u0441\u0442\u0432\u043e"\n\u2705 "\u041a\u0430\u043a\u0438\u0435 \u043f\u0440\u0435\u0438\u043c\u0443\u0449\u0435\u0441\u0442\u0432\u0430 \u0434\u0430\u0435\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 JavaScript \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435?" \u2192 "Node.js \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043e\u0434\u0438\u043d \u044f\u0437\u044b\u043a \u0434\u043b\u044f \u0444\u0440\u043e\u043d\u0442\u0435\u043d\u0434\u0430 \u0438 \u0431\u044d\u043a\u0435\u043d\u0434\u0430, \u0438\u043c\u0435\u0435\u0442 \u0432\u044b\u0441\u043e\u043a\u0443\u044e \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0431\u043b\u0430\u0433\u043e\u0434\u0430\u0440\u044f V8, \u0431\u043e\u043b\u044c\u0448\u0443\u044e \u044d\u043a\u043e\u0441\u0438\u0441\u0442\u0435\u043c\u0443 npm \u043f\u0430\u043a\u0435\u0442\u043e\u0432"\n\n\u041f\u0420\u0418\u041d\u0426\u0418\u041f\u042b \u041a\u0410\u0427\u0415\u0421\u0422\u0412\u0415\u041d\u041d\u042b\u0425 \u041a\u0410\u0420\u0422\u041e\u0427\u0415\u041a:\n1. \u041e\u0434\u0438\u043d \u0432\u043e\u043f\u0440\u043e\u0441 - \u043e\u0434\u0438\u043d \u043a\u043e\u043d\u0446\u0435\u043f\u0442\n2. \u0427\u0435\u0442\u043a\u0438\u0435, \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0435 \u0432\u043e\u043f\u0440\u043e\u0441\u044b \u0411\u0415\u0417 \u0434\u0443\u0431\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f\n3. \u041f\u043e\u043b\u043d\u044b\u0435, \u0442\u043e\u0447\u043d\u044b\u0435 \u043e\u0442\u0432\u0435\u0442\u044b \u0441 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u043e\u043c\n4. \u041f\u0440\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u043f\u0440\u0438\u043c\u0435\u043d\u0438\u043c\u043e\u0441\u0442\u044c\n5. \u041f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u0438\u0432\u043d\u0430\u044f \u0441\u043b\u043e\u0436\u043d\u043e\u0441\u0442\u044c\n\nJSON \u043e\u0442\u0432\u0435\u0442:\n{\n  "cards": [\n    {\n      "front": "\u0427\u0435\u0442\u043a\u0438\u0439 \u0432\u043e\u043f\u0440\u043e\u0441 \u0411\u0415\u0417 \u0434\u0443\u0431\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0445 \u0441\u043b\u043e\u0432",\n      "back": "\u041f\u043e\u043b\u043d\u044b\u0439 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0442\u0438\u0432\u043d\u044b\u0439 \u043e\u0442\u0432\u0435\u0442 \u0441 \u043e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u044f\u043c\u0438",\n      "tags": ["\u0442\u0435\u04331"],\n      "difficulty": "medium",\n      "concept": "\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u0430"\n    }\n  ]\n}'),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.cardGenerator.systemPrompt},{role:"user",content:u}])];case 2:if(!(null==(d=h.sent())?void 0:d.content))throw new Error("No response from card generator agent");return[2,this.parseJSONResponse(d.content,"cardGenerator").cards||[]];case 3:return p=h.sent(),console.error("Card generator error:",p),[2,this.createFallbackCards(t)];case 4:return[2]}}))}))},e.prototype.executeQuestionQuality=function(e,t){return kn(this,void 0,void 0,(function(){var n,r,o;return Cn(this,(function(a){switch(a.label){case 0:n='\u0422\u044b - Question Quality Agent. \u0421\u0422\u0420\u041e\u0413\u041e \u043e\u0446\u0435\u043d\u0438 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u043e \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u0432\u043e\u043f\u0440\u043e\u0441\u0430.\n\n\u041a\u0410\u0420\u0422\u041e\u0427\u041a\u0410 \u0414\u041b\u042f \u0410\u041d\u0410\u041b\u0418\u0417\u0410:\n\u0412\u043e\u043f\u0440\u043e\u0441: "'.concat(e.front,'"\n\u041e\u0442\u0432\u0435\u0442: "').concat(e.back,'"\n\u041a\u043e\u043d\u0446\u0435\u043f\u0442: ').concat(e.concept||"\u043d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d",'\n\n\u041e\u0420\u0418\u0413\u0418\u041d\u0410\u041b\u042c\u041d\u042b\u0419 \u0422\u0415\u041a\u0421\u0422: "').concat(t.originalText.substring(0,500),'..."\n\n\u041a\u0420\u0418\u0422\u0418\u0427\u0415\u0421\u041a\u0418\u0419 \u0410\u041d\u0410\u041b\u0418\u0417:\n1. \u041f\u0420\u041e\u0412\u0415\u0420\u042c \u041d\u0410 \u0414\u0423\u0411\u041b\u0418\u0420\u041e\u0412\u0410\u041d\u0418\u0415:\n   - \u0415\u0441\u0442\u044c \u043b\u0438 \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u044b\u0435 \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u0441\u043b\u043e\u0432\u0430 \u0432 \u0432\u043e\u043f\u0440\u043e\u0441\u0435 \u0438 \u043e\u0442\u0432\u0435\u0442\u0435?\n   - \u041f\u043e\u0432\u0442\u043e\u0440\u044f\u0435\u0442 \u043b\u0438 \u043e\u0442\u0432\u0435\u0442 \u0444\u043e\u0440\u043c\u0443\u043b\u0438\u0440\u043e\u0432\u043a\u0443 \u0432\u043e\u043f\u0440\u043e\u0441\u0430?\n\n2. \u041f\u0420\u041e\u0412\u0415\u0420\u042c \u041e\u0411\u0420\u0410\u0417\u041e\u0412\u0410\u0422\u0415\u041b\u042c\u041d\u0423\u042e \u0426\u0415\u041d\u041d\u041e\u0421\u0422\u042c:\n   - \u0423\u0447\u0438\u0442 \u043b\u0438 \u0447\u0442\u043e-\u0442\u043e \u043d\u043e\u0432\u043e\u0435?\n   - \u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u043b\u0438 \u043f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u0435, \u0430 \u043d\u0435 \u043f\u0430\u043c\u044f\u0442\u044c?\n   - \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442 \u043b\u0438 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442 \u0438 \u043e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u044f?\n\n3. \u041f\u0420\u041e\u0412\u0415\u0420\u042c \u041a\u0410\u0427\u0415\u0421\u0422\u0412\u041e \u0424\u041e\u0420\u041c\u0423\u041b\u0418\u0420\u041e\u0412\u041a\u0418:\n   - \u042f\u0441\u0435\u043d \u043b\u0438 \u0432\u043e\u043f\u0440\u043e\u0441?\n   - \u041f\u043e\u043b\u043e\u043d \u043b\u0438 \u043e\u0442\u0432\u0435\u0442?\n   - \u0415\u0441\u0442\u044c \u043b\u0438 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0435 \u0434\u0435\u0442\u0430\u043b\u0438?\n\n\u0428\u041a\u0410\u041b\u0410 \u041e\u0426\u0415\u041d\u041a\u0418:\n- 9-10: \u041e\u0442\u043b\u0438\u0447\u043d\u0430\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430, \u0443\u0447\u0438\u0442 \u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u043f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u0435\n- 7-8: \u0425\u043e\u0440\u043e\u0448\u0430\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u0441 \u043d\u0435\u0431\u043e\u043b\u044c\u0448\u0438\u043c\u0438 \u043d\u0435\u0434\u043e\u0441\u0442\u0430\u0442\u043a\u0430\u043c\u0438\n- 5-6: \u041f\u043e\u0441\u0440\u0435\u0434\u0441\u0442\u0432\u0435\u043d\u043d\u0430\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430, \u0442\u0440\u0435\u0431\u0443\u0435\u0442 \u0443\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u0439\n- 3-4: \u041f\u043b\u043e\u0445\u0430\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430, \u0441\u0435\u0440\u044c\u0435\u0437\u043d\u044b\u0435 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b\n- 1-2: \u041e\u0447\u0435\u043d\u044c \u043f\u043b\u043e\u0445\u0430\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430, \u0431\u0435\u0441\u043f\u043e\u043b\u0435\u0437\u043d\u0430\n\n\u0410\u0412\u0422\u041e\u041c\u0410\u0422\u0418\u0427\u0415\u0421\u041a\u041e\u0415 \u041e\u0422\u041a\u041b\u041e\u041d\u0415\u041d\u0418\u0415 (isWorthwhile: false) \u0415\u0421\u041b\u0418:\n- \u0412\u043e\u043f\u0440\u043e\u0441 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0442\u0435 \u0436\u0435 \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u0441\u043b\u043e\u0432\u0430 \u0447\u0442\u043e \u0438 \u043e\u0442\u0432\u0435\u0442\n- \u041e\u0442\u0432\u0435\u0442 \u043f\u0440\u043e\u0441\u0442\u043e \u043f\u0435\u0440\u0435\u0444\u043e\u0440\u043c\u0443\u043b\u0438\u0440\u0443\u0435\u0442 \u0432\u043e\u043f\u0440\u043e\u0441\n- \u041a\u0430\u0447\u0435\u0441\u0442\u0432\u043e \u043c\u0435\u043d\u044c\u0448\u0435 6 \u0431\u0430\u043b\u043b\u043e\u0432\n- \u041d\u0435\u0442 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0439 \u0446\u0435\u043d\u043d\u043e\u0441\u0442\u0438\n\nJSON \u043e\u0442\u0432\u0435\u0442:\n{\n  "question": "').concat(e.front,'",\n  "answer": "').concat(e.back,'",\n  "qualityScore": 3,\n  "relevanceScore": 4,\n  "difficultyScore": 2,\n  "issues": ["\u0414\u0443\u0431\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0445 \u0441\u043b\u043e\u0432", "\u041e\u0442\u0432\u0435\u0442 \u043f\u043e\u0432\u0442\u043e\u0440\u044f\u0435\u0442 \u0432\u043e\u043f\u0440\u043e\u0441", "\u041d\u0435\u0442 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0439 \u0446\u0435\u043d\u043d\u043e\u0441\u0442\u0438"],\n  "improvements": ["\u041f\u0435\u0440\u0435\u0444\u043e\u0440\u043c\u0443\u043b\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u043e\u043f\u0440\u043e\u0441", "\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442 \u0432 \u043e\u0442\u0432\u0435\u0442", "\u0421\u0434\u0435\u043b\u0430\u0442\u044c \u0432\u043e\u043f\u0440\u043e\u0441 \u0431\u043e\u043b\u0435\u0435 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u043c"],\n  "isWorthwhile": false,\n  "reasoning": "\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u043e\u0442\u043a\u043b\u043e\u043d\u0435\u043d\u0430 \u0438\u0437-\u0437\u0430 \u0434\u0443\u0431\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f: \u0432\u043e\u043f\u0440\u043e\u0441 \'\u041a\u0430\u043a\u043e\u0439 \u0432\u0438\u0434 \u0445\u0438\u0449\u043d\u044b\u0445 \u043c\u043b\u0435\u043a\u043e\u043f\u0438\u0442\u0430\u044e\u0449\u0438\u0445 \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u0441\u043e\u0431\u043e\u0439 \u043b\u0435\u0432?\' \u0438 \u043e\u0442\u0432\u0435\u0442 \'\u041b\u0435\u0432 - \u0432\u0438\u0434 \u0445\u0438\u0449\u043d\u044b\u0445 \u043c\u043b\u0435\u043a\u043e\u043f\u0438\u0442\u0430\u044e\u0449\u0438\u0445\' \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442 \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u044b\u0435 \u0441\u043b\u043e\u0432\u0430. \u041d\u0435\u0442 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0439 \u0446\u0435\u043d\u043d\u043e\u0441\u0442\u0438."\n}'),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.questionQuality.systemPrompt},{role:"user",content:n}])];case 2:if(!(null==(r=a.sent())?void 0:r.content))throw new Error("No response from question quality agent");return[2,this.parseJSONResponse(r.content,"questionQuality")];case 3:return o=a.sent(),console.error("Question quality error:",o),[2,this.createFallbackQualityCheck(e)];case 4:return[2]}}))}))},e.prototype.executeValidator=function(e,t){return kn(this,void 0,void 0,(function(){var t,n,r,o,a;return Cn(this,(function(i){switch(i.label){case 0:t=e.cards,n=e.originalText,r='\u0422\u044b - Validator Agent. \u041f\u0440\u043e\u0432\u0435\u0434\u0438 \u0411\u042b\u0421\u0422\u0420\u0423\u042e \u0444\u0438\u043d\u0430\u043b\u044c\u043d\u0443\u044e \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443 \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a.\n\n\u041e\u0420\u0418\u0413\u0418\u041d\u0410\u041b\u042c\u041d\u042b\u0419 \u0422\u0415\u041a\u0421\u0422: "'.concat(n.substring(0,300),'..."\n\n\u041a\u0410\u0420\u0422\u041e\u0427\u041a\u0418 (').concat(t.length," \u0448\u0442):\n").concat(t.map((function(e,t){return"\n".concat(t+1,". Q: ").concat(e.front,"\n   A: ").concat(e.back,"\n")})).join(""),'\n\n\u0411\u042b\u0421\u0422\u0420\u0410\u042f \u041f\u0420\u041e\u0412\u0415\u0420\u041a\u0410:\n1. \u0415\u0441\u0442\u044c \u043b\u0438 \u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u043e\u0448\u0438\u0431\u043a\u0438? (\u0444\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435, \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0438\u0435)\n2. \u041f\u043e\u043d\u044f\u0442\u043d\u044b \u043b\u0438 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438?\n3. \u0418\u043c\u0435\u044e\u0442 \u043b\u0438 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u0443\u044e \u0446\u0435\u043d\u043d\u043e\u0441\u0442\u044c?\n\n\u041f\u0420\u0410\u0412\u0418\u041b\u0410:\n- \u0415\u0441\u043b\u0438 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u043f\u0440\u0438\u0435\u043c\u043b\u0435\u043c\u044b (70+) \u2192 \u043d\u0435 \u043f\u0440\u0435\u0434\u043b\u0430\u0433\u0430\u0439 \u0443\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u0439\n- \u0422\u043e\u043b\u044c\u043a\u043e \u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b \u0442\u0440\u0435\u0431\u0443\u044e\u0442 \u0438\u0441\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044f\n- \u041d\u0415 \u043f\u0435\u0440\u0435\u043f\u0438\u0441\u044b\u0432\u0430\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u0431\u0435\u0437 \u0441\u0435\u0440\u044c\u0435\u0437\u043d\u043e\u0439 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0441\u0442\u0438\n\nJSON \u043e\u0442\u0432\u0435\u0442:\n{\n  "isValid": true,\n  "overallScore": 75,\n  "cardScores": {0: 75, 1: 80},\n  "issues": [],\n  "suggestions": [],\n  "improvedCards": null,\n  "finalRecommendation": "\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u043f\u0440\u0438\u0435\u043c\u043b\u0435\u043c\u043e\u0433\u043e \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0430"\n}'),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.validator.systemPrompt},{role:"user",content:r}])];case 2:if(!(null==(o=i.sent())?void 0:o.content))throw new Error("No response from validator agent");return[2,this.parseJSONResponse(o.content,"validator")];case 3:return a=i.sent(),console.error("Validator error:",a),[2,this.createFallbackValidation(t)];case 4:return[2]}}))}))},e.prototype.executePageContentAnalyzer=function(e,t){var n,r,o;return kn(this,void 0,void 0,(function(){var t,a,i,s,l,c,u,d,p;return Cn(this,(function(h){switch(h.label){case 0:t=e.text,a=e.pageContext,i='\u0422\u044b - Page Content Analyzer Agent. \u041f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443 \u0438 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438, \u043a\u0430\u043a\u0438\u0435 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u044b \u043f\u043e\u043c\u043e\u0433\u0443\u0442 \u0432 \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u0438.\n\n\u0412\u042b\u0414\u0415\u041b\u0415\u041d\u041d\u042b\u0419 \u0422\u0415\u041a\u0421\u0422: "'.concat(t,'"\n\n\u041a\u041e\u041d\u0422\u0415\u041d\u0422 \u0421\u0422\u0420\u0410\u041d\u0418\u0426\u042b:\n\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f (').concat(a.pageImages.length,"):\n").concat(a.pageImages.map((function(e,t){return"".concat(t+1,". ").concat(e.alt||"\u0411\u0435\u0437 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u044f"," (").concat(e.isNearText?"\u0440\u044f\u0434\u043e\u043c \u0441 \u0442\u0435\u043a\u0441\u0442\u043e\u043c":"\u0434\u0430\u043b\u0435\u043a\u043e \u043e\u0442 \u0442\u0435\u043a\u0441\u0442\u0430",")")})).join("\n"),"\n\n\u0424\u043e\u0440\u043c\u0443\u043b\u044b (").concat(a.formulas.length,"):\n").concat(a.formulas.map((function(e,t){return"".concat(t+1,". ").concat(e.text," (").concat(e.type,")")})).join("\n"),"\n\n\u041a\u043e\u0434 (").concat(a.codeBlocks.length,"):\n").concat(a.codeBlocks.map((function(e,t){return"".concat(t+1,". ").concat(e.language||"unknown",": ").concat(e.code.substring(0,100),"...")})).join("\n"),'\n\n\u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n1. \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0438, \u043a\u0430\u043a\u0438\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u044b \u0434\u043b\u044f \u043f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u044f \u0442\u0435\u043a\u0441\u0442\u0430\n2. \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0438, \u043a\u0430\u043a\u0438\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b \u0432\u0430\u0436\u043d\u044b \u0434\u043b\u044f \u043e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u044f\n3. \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0438, \u043a\u0430\u043a\u0438\u0435 \u0431\u043b\u043e\u043a\u0438 \u043a\u043e\u0434\u0430 \u043d\u0443\u0436\u043d\u044b \u0434\u043b\u044f \u043f\u0440\u0438\u043c\u0435\u0440\u043e\u0432\n4. \u041e\u0431\u043e\u0441\u043d\u0443\u0439 \u043a\u0430\u0436\u0434\u043e\u0435 \u0440\u0435\u0448\u0435\u043d\u0438\u0435\n\n\u041a\u0420\u0418\u0422\u0415\u0420\u0418\u0418 \u041e\u0422\u0411\u041e\u0420\u0410:\n- \u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f: \u0434\u0438\u0430\u0433\u0440\u0430\u043c\u043c\u044b, \u0441\u0445\u0435\u043c\u044b, \u0438\u043b\u043b\u044e\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u043e\u0432\n- \u0424\u043e\u0440\u043c\u0443\u043b\u044b: \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u044f, \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0435 \u0441 \u0442\u0435\u043a\u0441\u0442\u043e\u043c\n- \u041a\u043e\u0434: \u043f\u0440\u0438\u043c\u0435\u0440\u044b, \u0430\u043b\u0433\u043e\u0440\u0438\u0442\u043c\u044b, \u0443\u043f\u043e\u043c\u044f\u043d\u0443\u0442\u044b\u0435 \u0432 \u0442\u0435\u043a\u0441\u0442\u0435\n\nJSON \u043e\u0442\u0432\u0435\u0442:\n{\n  "shouldIncludeImages": true,\n  "selectedImages": [0, 2],\n  "shouldIncludeFormulas": false,\n  "selectedFormulas": [],\n  "shouldIncludeCode": true,\n  "selectedCode": [0],\n  "reasoning": "\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 1 \u0438 3 \u0438\u043b\u043b\u044e\u0441\u0442\u0440\u0438\u0440\u0443\u044e\u0442 \u043e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u044b. \u041a\u043e\u0434 \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442 \u043f\u0440\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u0435."\n}'),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.pageContentAnalyzer.systemPrompt},{role:"user",content:i}])];case 2:if(!(null==(s=h.sent())?void 0:s.content))throw new Error("No response from page content analyzer agent");return l=this.parseJSONResponse(s.content,"pageContentAnalyzer"),c=(null===(n=l.selectedImages)||void 0===n?void 0:n.map((function(e){return a.pageImages[e]})).filter(Boolean))||[],u=(null===(r=l.selectedFormulas)||void 0===r?void 0:r.map((function(e){return a.formulas[e]})).filter(Boolean))||[],d=(null===(o=l.selectedCode)||void 0===o?void 0:o.map((function(e){return a.codeBlocks[e]})).filter(Boolean))||[],[2,{shouldIncludeImages:l.shouldIncludeImages||!1,selectedImages:c,shouldIncludeFormulas:l.shouldIncludeFormulas||!1,selectedFormulas:u,shouldIncludeCode:l.shouldIncludeCode||!1,selectedCode:d,reasoning:l.reasoning||"No reasoning provided"}];case 3:return p=h.sent(),console.error("Page content analyzer error:",p),[2,this.createFallbackContentEnhancement()];case 4:return[2]}}))}))},e.prototype.executeContentEnhancer=function(e,t){var n;return kn(this,void 0,void 0,(function(){var t,r,o,a,i,s,l,c,u,d,p=this;return Cn(this,(function(h){switch(h.label){case 0:t=e.cards,r=e.contentEnhancement,o=e.originalText,a=e.contentMatches,i=a&&a.cardMatches&&a.cardMatches.length>0,s="\u0422\u044b - Content Enhancer Agent. \u0423\u043b\u0443\u0447\u0448\u0438 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u0422\u041e\u0427\u041d\u041e\u0413\u041e \u0430\u043d\u0430\u043b\u0438\u0437\u0430 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u044f \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430.\n\n".concat(i?"\u0421\u041f\u0415\u0426\u0418\u0410\u041b\u042c\u041d\u042b\u0415 \u0418\u041d\u0421\u0422\u0420\u0423\u041a\u0426\u0418\u0418: \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u0422\u041e\u0427\u041d\u042b\u0415 \u0420\u0415\u0417\u0423\u041b\u042c\u0422\u0410\u0422\u042b \u0430\u043d\u0430\u043b\u0438\u0437\u0430 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u044f - \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0439 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u043a \u0442\u0435\u043c \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430\u043c, \u0433\u0434\u0435 \u044d\u0442\u043e \u043f\u0440\u044f\u043c\u043e \u0443\u043a\u0430\u0437\u0430\u043d\u043e.":"\u041e\u0411\u0429\u0418\u0415 \u0418\u041d\u0421\u0422\u0420\u0423\u041a\u0426\u0418\u0418: \u0410\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 \u043a\u0430\u0436\u0434\u0443\u044e \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0443 \u0438\u043d\u0434\u0438\u0432\u0438\u0434\u0443\u0430\u043b\u044c\u043d\u043e.",'\n\n\u041e\u0420\u0418\u0413\u0418\u041d\u0410\u041b\u042c\u041d\u042b\u0419 \u0422\u0415\u041a\u0421\u0422: "').concat(o,'"\n\n\u041a\u0410\u0420\u0422\u041e\u0427\u041a\u0418 (').concat(t.length,"):\n").concat(t.map((function(e,t){return"\n\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 ".concat(t+1,":\n\u0412\u043e\u043f\u0440\u043e\u0441: ").concat(e.front,"\n\u041e\u0442\u0432\u0435\u0442: ").concat(e.back,"\n\u0422\u0435\u043c\u0430: ").concat(p.extractCardTopic(e.front,e.back),"\n").concat(i?"\u0420\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043a\u043e\u043d\u0442\u0435\u043d\u0442: ".concat(p.getMatchedContentForCard(t,a)):"","\n")})).join(""),"\n\n\u0414\u041e\u0421\u0422\u0423\u041f\u041d\u042b\u0419 \u041a\u041e\u041d\u0422\u0415\u041d\u0422:\n").concat(r.shouldIncludeImages?"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f (".concat(r.selectedImages.length,"):\n").concat(r.selectedImages.map((function(e,t){return"".concat(t+1,'. "').concat(e.alt||"\u0431\u0435\u0437 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u044f",'" (\u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u043e\u0441\u0442\u044c: ').concat(e.relevanceScore,"/10)")})).join("\n")):"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f: \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0442","\n\n").concat(r.shouldIncludeFormulas?"\u0424\u043e\u0440\u043c\u0443\u043b\u044b (".concat(r.selectedFormulas.length,"):\n").concat(r.selectedFormulas.map((function(e,t){return"".concat(t+1,'. "').concat(e.text,'" (\u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u043e\u0441\u0442\u044c: ').concat(e.relevanceScore,"/10)")})).join("\n")):"\u0424\u043e\u0440\u043c\u0443\u043b\u044b: \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0442","\n\n").concat(r.shouldIncludeCode?"\u041a\u043e\u0434 (".concat(r.selectedCode.length,"):\n").concat(r.selectedCode.map((function(e,t){return"".concat(t+1,". ").concat(e.language||"text",': "').concat(e.code.substring(0,60),'..." (\u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u043e\u0441\u0442\u044c: ').concat(e.relevanceScore,"/10)")})).join("\n")):"\u041a\u043e\u0434: \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442","\n\n").concat(i?"\n\u0420\u0415\u0417\u0423\u041b\u042c\u0422\u0410\u0422\u042b \u0410\u041d\u0410\u041b\u0418\u0417\u0410 \u0421\u041e\u041e\u0422\u0412\u0415\u0422\u0421\u0422\u0412\u0418\u042f:\n".concat(a.cardMatches.map((function(e){return"\n\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 ".concat(e.cardIndex+1,":\n- \u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f: [").concat(e.relevantImages.join(", "),"]\n- \u0424\u043e\u0440\u043c\u0443\u043b\u044b: [").concat(e.relevantFormulas.join(", "),"] \n- \u041a\u043e\u0434: [").concat(e.relevantCode.join(", "),"]\n- \u041e\u0431\u043e\u0441\u043d\u043e\u0432\u0430\u043d\u0438\u0435: ").concat(e.reasoning,"\n")})).join(""),"\n\n\u0421\u0422\u0420\u041e\u0413\u041e \u0421\u041b\u0415\u0414\u0423\u0419 \u0420\u0415\u0417\u0423\u041b\u042c\u0422\u0410\u0422\u0410\u041c \u0410\u041d\u0410\u041b\u0418\u0417\u0410! \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0439 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u043a \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u043c \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430\u043c."):'\n\u041f\u0420\u0410\u0412\u0418\u041b\u0410 \u0421\u0410\u041c\u041e\u0421\u0422\u041e\u042f\u0422\u0415\u041b\u042c\u041d\u041e\u0413\u041e \u0410\u041d\u0410\u041b\u0418\u0417\u0410:\n1. \u0410\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 \u043a\u0430\u0436\u0434\u0443\u044e \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0443 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e\n2. \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0439 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u043f\u0440\u0438 \u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u043e\u0441\u0442\u0438 \u22658/10\n3. \u0423\u0447\u0438\u0442\u044b\u0432\u0430\u0439 \u0442\u0435\u043c\u0430\u0442\u0438\u043a\u0443: \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u043a\u0430\u2192\u0444\u043e\u0440\u043c\u0443\u043b\u044b, \u043a\u043e\u0434\u2192\u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435, \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u044b\u2192\u0441\u0445\u0435\u043c\u044b\n4. \u041d\u0415 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0439 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 "\u043d\u0430 \u0432\u0441\u044f\u043a\u0438\u0439 \u0441\u043b\u0443\u0447\u0430\u0439"','\n\nJSON \u043e\u0442\u0432\u0435\u0442:\n{\n  "enhancedCards": [\n    {\n      "front": "\u0427\u0442\u043e \u0442\u0430\u043a\u043e\u0435 \u0444\u043e\u0442\u043e\u0441\u0438\u043d\u0442\u0435\u0437?",\n      "back": "\u0424\u043e\u0442\u043e\u0441\u0438\u043d\u0442\u0435\u0437 - \u044d\u0442\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u043f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u043d\u0438\u044f \u0443\u0433\u043b\u0435\u043a\u0438\u0441\u043b\u043e\u0433\u043e \u0433\u0430\u0437\u0430 \u0438 \u0432\u043e\u0434\u044b \u0432 \u0433\u043b\u044e\u043a\u043e\u0437\u0443 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0441\u043e\u043b\u043d\u0435\u0447\u043d\u043e\u0433\u043e \u0441\u0432\u0435\u0442\u0430.\n\n[IMAGE:0]\n\n\u0425\u0438\u043c\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u0444\u043e\u0440\u043c\u0443\u043b\u0430: [FORMULA:0]",\n      "multimedia": {\n        "images": [0],\n        "formulas": [0], \n        "code": []\n      },\n      "reasoning": "\u0414\u043e\u0431\u0430\u0432\u0438\u043b \u0441\u0445\u0435\u043c\u0443 \u0444\u043e\u0442\u043e\u0441\u0438\u043d\u0442\u0435\u0437\u0430 \u0438 \u0445\u0438\u043c\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u0444\u043e\u0440\u043c\u0443\u043b\u0443, \u0442\u0430\u043a \u043a\u0430\u043a \u043e\u043d\u0438 \u043f\u0440\u044f\u043c\u043e \u0438\u043b\u043b\u044e\u0441\u0442\u0440\u0438\u0440\u0443\u044e\u0442 \u043f\u0440\u043e\u0446\u0435\u0441\u0441"\n    },\n    {\n      "front": "\u041a\u0430\u043a\u0438\u0435 \u0444\u0430\u043a\u0442\u043e\u0440\u044b \u0432\u043b\u0438\u044f\u044e\u0442 \u043d\u0430 \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u044c \u0444\u043e\u0442\u043e\u0441\u0438\u043d\u0442\u0435\u0437\u0430?",\n      "back": "\u0422\u0435\u043c\u043f\u0435\u0440\u0430\u0442\u0443\u0440\u0430, \u043e\u0441\u0432\u0435\u0449\u0435\u043d\u043d\u043e\u0441\u0442\u044c, \u043a\u043e\u043d\u0446\u0435\u043d\u0442\u0440\u0430\u0446\u0438\u044f CO2 \u0438 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u043e\u0441\u0442\u044c \u0432\u043e\u0434\u044b \u0432\u043b\u0438\u044f\u044e\u0442 \u043d\u0430 \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u044c \u0444\u043e\u0442\u043e\u0441\u0438\u043d\u0442\u0435\u0437\u0430.",\n      "multimedia": {\n        "images": [],\n        "formulas": [],\n        "code": []\n      },\n      "reasoning": "\u042d\u0442\u0430 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u043e \u0444\u0430\u043a\u0442\u043e\u0440\u0430\u0445 - \u043d\u0435 \u043d\u0443\u0436\u0435\u043d \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u043a\u043e\u043d\u0442\u0435\u043d\u0442, \u0442\u0435\u043a\u0441\u0442 \u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e \u044f\u0441\u0435\u043d"\n    }\n  ]\n}\n\n\u0412\u0410\u0416\u041d\u041e: \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u043f\u043b\u0435\u0439\u0441\u0445\u043e\u043b\u0434\u0435\u0440\u044b [IMAGE:N], [FORMULA:N], [CODE:N] \u0442\u043e\u043b\u044c\u043a\u043e \u043a\u043e\u0433\u0434\u0430 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u0414\u0415\u0419\u0421\u0422\u0412\u0418\u0422\u0415\u041b\u042c\u041d\u041e \u043d\u0443\u0436\u0435\u043d \u0434\u043b\u044f \u044d\u0442\u043e\u0439 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438.'),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.contentEnhancer.systemPrompt},{role:"user",content:s}])];case 2:if(!(null==(l=h.sent())?void 0:l.content))throw new Error("No response from content enhancer agent");return c=this.parseJSONResponse(l.content,"contentEnhancer"),console.log("\u{1f3a8} Content enhancer parsed result:",c),u=(null===(n=c.enhancedCards)||void 0===n?void 0:n.map((function(e,t){var n,o,a,i,s,l,c,u,d,p,h,f,g=e.back;console.log("\u{1f527} \u041e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 ".concat(t+1,": ").concat(e.front)),console.log("\u{1f4cb} \u041c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u0434\u043b\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438:",e.multimedia);var m=g.match(/\[IMAGE:(\d+)\]/g);m&&(console.log("\u{1f50d} \u041d\u0430\u0439\u0434\u0435\u043d\u044b \u043f\u043b\u0435\u0439\u0441\u0445\u043e\u043b\u0434\u0435\u0440\u044b \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0439 \u0432 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0435 ".concat(t+1,":"),m),m.forEach((function(e){var n=e.match(/\[IMAGE:(\d+)\]/);if(n){var o=parseInt(n[1]),a=r.selectedImages[o];if(console.log("\u{1f504} \u0417\u0430\u043c\u0435\u043d\u0430 ".concat(e," \u043d\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 ").concat(o," \u0432 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0435 ").concat(t+1,":"),(null==a?void 0:a.src)||"\u041d\u0415 \u041d\u0410\u0419\u0414\u0415\u041d\u041e"),a){var i=a.base64||a.src;console.log("\u{1f5bc}\ufe0f \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c ".concat(a.base64?"base64":"URL"," \u0434\u043b\u044f \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0432 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0435 ").concat(t+1));var s=a.alt&&""!==a.alt.trim()?a.alt:"";g=g.replace(e,"\n![".concat(s,"](").concat(i,")\n"))}else console.warn("\u26a0\ufe0f \u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0441 \u0438\u043d\u0434\u0435\u043a\u0441\u043e\u043c ".concat(o," \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e \u0432 selectedImages")),g=g.replace(e,"")}})));var y=g.match(/\[FORMULA:(\d+)\]/g);y&&(console.log("\u{1f50d} \u041d\u0430\u0439\u0434\u0435\u043d\u044b \u043f\u043b\u0435\u0439\u0441\u0445\u043e\u043b\u0434\u0435\u0440\u044b \u0444\u043e\u0440\u043c\u0443\u043b \u0432 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0435 ".concat(t+1,":"),y),y.forEach((function(e){var n=e.match(/\[FORMULA:(\d+)\]/);if(n){var o=parseInt(n[1]),a=r.selectedFormulas[o];console.log("\u{1f504} \u0417\u0430\u043c\u0435\u043d\u0430 ".concat(e," \u043d\u0430 \u0444\u043e\u0440\u043c\u0443\u043b\u0443 ").concat(o," \u0432 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0435 ").concat(t+1,":"),(null==a?void 0:a.text)||"\u041d\u0415 \u041d\u0410\u0419\u0414\u0415\u041d\u041e"),a?g=g.replace(e,"\n$$".concat(a.text,"$$\n")):(console.warn("\u26a0\ufe0f \u0424\u043e\u0440\u043c\u0443\u043b\u0430 \u0441 \u0438\u043d\u0434\u0435\u043a\u0441\u043e\u043c ".concat(o," \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u0430 \u0432 selectedFormulas")),g=g.replace(e,""))}})));var v=g.match(/\[CODE:(\d+)\]/g);return v&&(console.log("\u{1f50d} \u041d\u0430\u0439\u0434\u0435\u043d\u044b \u043f\u043b\u0435\u0439\u0441\u0445\u043e\u043b\u0434\u0435\u0440\u044b \u043a\u043e\u0434\u0430 \u0432 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0435 ".concat(t+1,":"),v),v.forEach((function(e){var n,o=e.match(/\[CODE:(\d+)\]/);if(o){var a=parseInt(o[1]),i=r.selectedCode[a];console.log("\u{1f504} \u0417\u0430\u043c\u0435\u043d\u0430 ".concat(e," \u043d\u0430 \u043a\u043e\u0434 ").concat(a," \u0432 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0435 ").concat(t+1,":"),(null===(n=null==i?void 0:i.code)||void 0===n?void 0:n.substring(0,30))||"\u041d\u0415 \u041d\u0410\u0419\u0414\u0415\u041d\u041e"),i?g=g.replace(e,"\n```".concat(i.language||"","\n").concat(i.code,"\n```\n")):(console.warn("\u26a0\ufe0f \u041a\u043e\u0434 \u0441 \u0438\u043d\u0434\u0435\u043a\u0441\u043e\u043c ".concat(a," \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 selectedCode")),g=g.replace(e,""))}}))),g=g.replace(/\n{3,}/g,"\n\n"),console.log("\u2705 \u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 ".concat(t+1," \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u0430. \u041c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430:"),{images:(null===(o=null===(n=e.multimedia)||void 0===n?void 0:n.images)||void 0===o?void 0:o.length)||0,formulas:(null===(i=null===(a=e.multimedia)||void 0===a?void 0:a.formulas)||void 0===i?void 0:i.length)||0,code:(null===(l=null===(s=e.multimedia)||void 0===s?void 0:s.code)||void 0===l?void 0:l.length)||0}),Sn(Sn({},e),{back:g,multimedia:e.multimedia,attachedImages:(null===(u=null===(c=e.multimedia)||void 0===c?void 0:c.images)||void 0===u?void 0:u.map((function(e){return r.selectedImages[e]})).filter(Boolean))||[],attachedFormulas:(null===(p=null===(d=e.multimedia)||void 0===d?void 0:d.formulas)||void 0===p?void 0:p.map((function(e){return r.selectedFormulas[e]})).filter(Boolean))||[],attachedCode:(null===(f=null===(h=e.multimedia)||void 0===h?void 0:h.code)||void 0===f?void 0:f.map((function(e){return r.selectedCode[e]})).filter(Boolean))||[]})})))||t,console.log("\u{1f389} Content Enhancement \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d. \u041e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u043e ".concat(u.length," \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a")),[2,{enhancedCards:u}];case 3:return d=h.sent(),console.error("Content enhancer error:",d),[2,{enhancedCards:t}];case 4:return[2]}}))}))},e.prototype.executeCardContentMatcher=function(e,t){return kn(this,void 0,void 0,(function(){var t,n,r,o,a,i,s,l=this;return Cn(this,(function(c){switch(c.label){case 0:t=e.cards,n=e.contentEnhancement,r=e.originalText,o='\u0422\u044b - Card Content Matcher Agent. \u041f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 \u043a\u0430\u0436\u0434\u0443\u044e \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0443 \u0438 \u0442\u043e\u0447\u043d\u043e \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438, \u043a\u0430\u043a\u043e\u0439 \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u0435\u0439 \u043f\u043e\u0434\u0445\u043e\u0434\u0438\u0442.\n\n\u041e\u0420\u0418\u0413\u0418\u041d\u0410\u041b\u042c\u041d\u042b\u0419 \u0422\u0415\u041a\u0421\u0422: "'.concat(r,'"\n\n\u041a\u0410\u0420\u0422\u041e\u0427\u041a\u0418 \u0414\u041b\u042f \u0410\u041d\u0410\u041b\u0418\u0417\u0410 (').concat(t.length,"):\n").concat(t.map((function(e,t){return"\n\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 ".concat(t+1,":\n\u0412\u043e\u043f\u0440\u043e\u0441: ").concat(e.front,"\n\u041e\u0442\u0432\u0435\u0442: ").concat(e.back,"\n\u0422\u0435\u043c\u0430: ").concat(l.extractCardTopic(e.front,e.back),"\n")})).join(""),"\n\n\u0414\u041e\u0421\u0422\u0423\u041f\u041d\u042b\u0419 \u041a\u041e\u041d\u0422\u0415\u041d\u0422:\n").concat(n.shouldIncludeImages?"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f (".concat(n.selectedImages.length,"):\n").concat(n.selectedImages.map((function(e,t){return"".concat(t+1,'. Alt: "').concat(e.alt||"\u0431\u0435\u0437 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u044f",'" | \u0420\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u043e\u0441\u0442\u044c: ').concat(e.relevanceScore,"/10")})).join("\n")):"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f: \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0442","\n\n").concat(n.shouldIncludeFormulas?"\u0424\u043e\u0440\u043c\u0443\u043b\u044b (".concat(n.selectedFormulas.length,"):\n").concat(n.selectedFormulas.map((function(e,t){return"".concat(t+1,'. "').concat(e.text,'" | \u0420\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u043e\u0441\u0442\u044c: ').concat(e.relevanceScore,"/10")})).join("\n")):"\u0424\u043e\u0440\u043c\u0443\u043b\u044b: \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0442","\n\n").concat(n.shouldIncludeCode?"\u041a\u043e\u0434 (".concat(n.selectedCode.length,"):\n").concat(n.selectedCode.map((function(e,t){return"".concat(t+1,". ").concat(e.language||"text",': "').concat(e.code.substring(0,80),'..." | \u0420\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u043e\u0441\u0442\u044c: ').concat(e.relevanceScore,"/10")})).join("\n")):"\u041a\u043e\u0434: \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442",'\n\n\u041f\u0420\u0410\u0412\u0418\u041b\u0410 \u0410\u041d\u0410\u041b\u0418\u0417\u0410:\n1. \u0414\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438 \u0441\u0442\u0435\u043f\u0435\u043d\u044c \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u044f (0-10) \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430\n2. \u042d\u043b\u0435\u043c\u0435\u043d\u0442 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043a \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0435 \u0442\u043e\u043b\u044c\u043a\u043e \u043f\u0440\u0438 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0438 \u2265 8/10\n3. \u0423\u0447\u0438\u0442\u044b\u0432\u0430\u0439 \u0442\u0435\u043c\u0430\u0442\u0438\u043a\u0443: \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u043a\u0430\u2192\u0444\u043e\u0440\u043c\u0443\u043b\u044b, \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435\u2192\u043a\u043e\u0434, \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u044b\u2192\u0441\u0445\u0435\u043c\u044b\n4. \u041d\u0415 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0439 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u0435\u0441\u043b\u0438 \u043e\u043d \u043d\u0435 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0439 \u0446\u0435\u043d\u043d\u043e\u0441\u0442\u0438\n5. \u041f\u0440\u0438\u043e\u0440\u0438\u0442\u0435\u0442: \u0441\u043f\u0435\u0446\u0438\u0444\u0438\u0447\u043d\u043e\u0441\u0442\u044c > \u043e\u0431\u0449\u043d\u043e\u0441\u0442\u044c\n\nJSON \u043e\u0442\u0432\u0435\u0442:\n{\n  "cardMatches": [\n    {\n      "cardIndex": 0,\n      "relevantImages": [0],\n      "relevantFormulas": [],\n      "relevantCode": [],\n      "reasoning": "\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 1 \u043f\u0440\u044f\u043c\u043e \u0438\u043b\u043b\u044e\u0441\u0442\u0440\u0438\u0440\u0443\u0435\u0442 \u043a\u043e\u043d\u0446\u0435\u043f\u0442 \u0438\u0437 \u0432\u043e\u043f\u0440\u043e\u0441\u0430"\n    },\n    {\n      "cardIndex": 1,\n      "relevantImages": [],\n      "relevantFormulas": [0],\n      "relevantCode": [],\n      "reasoning": "\u0424\u043e\u0440\u043c\u0443\u043b\u0430 1 \u043e\u0431\u044a\u044f\u0441\u043d\u044f\u0435\u0442 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e\u0441\u0442\u044c \u0438\u0437 \u043e\u0442\u0432\u0435\u0442\u0430"\n    }\n  ]\n}'),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.cardContentMatcher.systemPrompt},{role:"user",content:o}])];case 2:if(!(null==(a=c.sent())?void 0:a.content))throw new Error("No response from card content matcher agent");return i=this.parseJSONResponse(a.content,"cardContentMatcher"),console.log("\u{1f3af} Card content matcher result:",i),[2,i];case 3:return s=c.sent(),console.error("Card content matcher error:",s),[2,{cardMatches:[]}];case 4:return[2]}}))}))},e.prototype.extractCardTopic=function(e,t){var n=(e+" "+t).toLowerCase();return n.includes("\u0444\u043e\u0440\u043c\u0443\u043b\u0430")||n.includes("\u0443\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u0435")||n.includes("\u043c\u0430\u0442\u0435\u043c\u0430\u0442")?"\u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u043a\u0430":n.includes("\u043a\u043e\u0434")||n.includes("\u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c")||n.includes("\u0430\u043b\u0433\u043e\u0440\u0438\u0442\u043c")?"\u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435":n.includes("\u0441\u0445\u0435\u043c\u0430")||n.includes("\u0434\u0438\u0430\u0433\u0440\u0430\u043c\u043c\u0430")||n.includes("\u043f\u0440\u043e\u0446\u0435\u0441\u0441")?"\u0441\u0445\u0435\u043c\u0430\u0442\u0438\u043a\u0430":n.includes("\u0438\u0441\u0442\u043e\u0440\u0438\u044f")||n.includes("\u0434\u0430\u0442\u0430")||n.includes("\u0441\u043e\u0431\u044b\u0442\u0438\u0435")?"\u0438\u0441\u0442\u043e\u0440\u0438\u044f":n.includes("\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435")||n.includes("\u043f\u043e\u043d\u044f\u0442\u0438\u0435")||n.includes("\u0442\u0435\u0440\u043c\u0438\u043d")?"\u0442\u0435\u043e\u0440\u0438\u044f":"\u043e\u0431\u0449\u0430\u044f"},e.prototype.executeTextAnalyst=function(e,t){var n,r,o;return kn(this,void 0,void 0,(function(){var t,a,i,s,l,c,u,d,p;return Cn(this,(function(h){switch(h.label){case 0:t=e.text,a=e.pageContext,i=(null===(n=null==a?void 0:a.pageImages)||void 0===n?void 0:n.length)>0,s=(null===(r=null==a?void 0:a.formulas)||void 0===r?void 0:r.length)>0,l=(null===(o=null==a?void 0:a.codeBlocks)||void 0===o?void 0:o.length)>0,c="\u0422\u044b - Text Analyst Agent. \u041f\u0440\u043e\u0432\u0435\u0434\u0438 \u0433\u043b\u0443\u0431\u043e\u043a\u0438\u0439 \u0430\u043d\u0430\u043b\u0438\u0437 \u0442\u0435\u043a\u0441\u0442\u0430 \u0438 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438 \u043e\u043f\u0442\u0438\u043c\u0430\u043b\u044c\u043d\u0443\u044e \u0441\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u044e \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f.\n\n\u0422\u0415\u041a\u0421\u0422 \u0414\u041b\u042f \u0410\u041d\u0410\u041b\u0418\u0417\u0410 (".concat(t.length,' \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432):\n"').concat(t,'"\n\n\u0414\u041e\u0421\u0422\u0423\u041f\u041d\u042b\u0419 \u041c\u0423\u041b\u042c\u0422\u0418\u041c\u0415\u0414\u0418\u0410 \u041a\u041e\u041d\u0422\u0415\u041d\u0422:\n- \u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f: ').concat(i?a.pageImages.length:0," ").concat(i?"(\u0415\u0421\u0422\u042c - \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0443\u0447\u0442\u0438!)":"","\n- \u0424\u043e\u0440\u043c\u0443\u043b\u044b: ").concat(s?a.formulas.length:0,"\n- \u041a\u043e\u0434: ").concat(l?a.codeBlocks.length:0,'\n\n\u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n1. \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0438 \u043e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0442\u0435\u043c\u044b \u0438 \u0438\u0445 \u0432\u0430\u0436\u043d\u043e\u0441\u0442\u044c\n2. \u041e\u0446\u0435\u043d\u0438 \u0441\u043b\u043e\u0436\u043d\u043e\u0441\u0442\u044c \u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b\u0430\n3. \u0422\u041e\u0427\u041d\u041e \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438 \u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a \u0414\u0415\u0419\u0421\u0422\u0412\u0418\u0422\u0415\u041b\u042c\u041d\u041e \u043d\u0443\u0436\u043d\u043e (\u043d\u0435 \u043f\u0435\u0440\u0435\u0431\u043e\u0440\u0449\u0438!)\n4. \u0423\u0447\u0442\u0438 \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u0432 \u043f\u043b\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0438\n5. \u041f\u0440\u0438\u043e\u0440\u0438\u0442\u0438\u0437\u0438\u0440\u0443\u0439 \u0442\u0435\u043c\u044b\n\n\u041f\u0420\u0418\u041d\u0426\u0418\u041f\u042b:\n- \u0411\u043e\u043b\u044c\u0448\u043e\u0439 \u0442\u0435\u043a\u0441\u0442 \u2260 \u043c\u043d\u043e\u0433\u043e \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a\n- \u0424\u043e\u043a\u0443\u0441 \u043d\u0430 \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0445 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u0430\u0445 \u0434\u043b\u044f \u043f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u044f\n- \u0415\u0441\u043b\u0438 \u0435\u0441\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f - \u043e\u043d\u0438 \u0414\u041e\u041b\u0416\u041d\u042b \u0431\u044b\u0442\u044c \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u044b\n- \u041a\u0430\u0447\u0435\u0441\u0442\u0432\u043e > \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e\n\nJSON \u043e\u0442\u0432\u0435\u0442:\n{\n  "textLength": ').concat(t.length,',\n  "complexity": "medium",\n  "mainTopics": [\n    {\n      "name": "\u041e\u0441\u043d\u043e\u0432\u043d\u0430\u044f \u0442\u0435\u043c\u0430",\n      "importance": "critical",\n      "complexity": "medium",\n      "estimatedCards": 2,\n      "needsMultimedia": true,\n      "multimediaTypes": ["images"],\n      "subtopics": ["\u043f\u043e\u0434\u0442\u0435\u043c\u04301", "\u043f\u043e\u0434\u0442\u0435\u043c\u04302"]\n    }\n  ],\n  "estimatedCards": 3,\n  "learningObjectives": ["\u043f\u043e\u043d\u044f\u0442\u044c X", "\u0437\u0430\u043f\u043e\u043c\u043d\u0438\u0442\u044c Y"],\n  "hasMultimedia": ').concat(i||s||l,',\n  "multimediaTypes": [').concat(i?'"images"':"").concat(s?', "formulas"':"").concat(l?', "code"':"",'],\n  "priority": "high",\n  "reasoning": "\u041e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u0435 \u0441\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u0438"\n}'),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.textAnalyst.systemPrompt},{role:"user",content:c}])];case 2:if(!(null==(u=h.sent())?void 0:u.content))throw new Error("No response from text analyst agent");return d=this.parseJSONResponse(u.content,"textAnalyst"),console.log("\u{1f4cb} Text analysis result:",d),[2,d];case 3:return p=h.sent(),console.error("Text analyst error:",p),[2,{textLength:t.length,complexity:this.estimateComplexity(t),mainTopics:[{name:"\u041e\u0441\u043d\u043e\u0432\u043d\u0430\u044f \u0442\u0435\u043c\u0430",importance:"important",complexity:"medium",estimatedCards:Math.min(5,Math.ceil(t.length/1e3)),needsMultimedia:i||s||l,multimediaTypes:En(En(En([],i?["images"]:[],!0),s?["formulas"]:[],!0),l?["code"]:[],!0),subtopics:[]}],estimatedCards:Math.min(5,Math.ceil(t.length/1e3)),learningObjectives:["\u041f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u0435 \u043e\u0441\u043d\u043e\u0432\u043d\u044b\u0445 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u043e\u0432"],hasMultimedia:i||s||l,multimediaTypes:En(En(En([],i?["images"]:[],!0),s?["formulas"]:[],!0),l?["code"]:[],!0),priority:"medium",reasoning:"Fallback analysis due to error"}];case 4:return[2]}}))}))},e.prototype.executeCardPlanner=function(e,t){var n,r,o,a,i,s,l,c,u,d,p,h;return kn(this,void 0,void 0,(function(){var t,f,g,m,y,v,b;return Cn(this,(function(x){switch(x.label){case 0:t=e.textAnalysis,e.originalText,f=e.pageContext,g="\u0422\u044b - Card Planner Agent. \u0421\u043e\u0437\u0434\u0430\u0439 \u0434\u0435\u0442\u0430\u043b\u044c\u043d\u044b\u0439 \u043f\u043b\u0430\u043d \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u0430\u043d\u0430\u043b\u0438\u0437\u0430 \u0442\u0435\u043a\u0441\u0442\u0430.\n\n\u0410\u041d\u0410\u041b\u0418\u0417 \u0422\u0415\u041a\u0421\u0422\u0410:\n\u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0442\u0435\u043c\u044b: ".concat((null===(n=t.mainTopics)||void 0===n?void 0:n.map((function(e){return"".concat(e.name," (\u0432\u0430\u0436\u043d\u043e\u0441\u0442\u044c: ").concat(e.importance,")")})).join(", "))||"\u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0442\u0435\u043c\u044b","\n\u0420\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u043c\u043e\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a: ").concat(t.estimatedCards,"\n\u0421\u043b\u043e\u0436\u043d\u043e\u0441\u0442\u044c: ").concat(t.complexity,"\n\u0415\u0441\u0442\u044c \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430: ").concat(t.hasMultimedia?"\u0414\u0410":"\u041d\u0415\u0422","\n\u0422\u0438\u043f\u044b \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430: ").concat((null===(r=t.multimediaTypes)||void 0===r?void 0:r.join(", "))||"\u043d\u0435\u0442 \u0442\u0438\u043f\u043e\u0432","\n\n\u0414\u041e\u0421\u0422\u0423\u041f\u041d\u042b\u0419 \u041a\u041e\u041d\u0422\u0415\u041d\u0422:\n").concat((null===(o=null==f?void 0:f.pageImages)||void 0===o?void 0:o.length)>0?"- \u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f: ".concat(f.pageImages.length," (\u041f\u0420\u0418\u041e\u0420\u0418\u0422\u0415\u0422 - \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0432\u044b\u0434\u0435\u043b\u0438\u043b!)"):"","\n").concat((null===(a=null==f?void 0:f.formulas)||void 0===a?void 0:a.length)>0?"- \u0424\u043e\u0440\u043c\u0443\u043b\u044b: ".concat(f.formulas.length):"","\n").concat((null===(i=null==f?void 0:f.codeBlocks)||void 0===i?void 0:i.length)>0?"- \u041a\u043e\u0434: ".concat(f.codeBlocks.length):"",'\n\n\u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n1. \u0421\u043e\u0437\u0434\u0430\u0439 \u0442\u043e\u0447\u043d\u044b\u0439 \u043f\u043b\u0430\u043d \u043a\u0430\u0436\u0434\u043e\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438\n2. \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0438 \u0442\u0438\u043f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 (\u043a\u043e\u043d\u0446\u0435\u043f\u0442, \u043f\u0440\u0438\u043c\u0435\u0440, \u0444\u043e\u0440\u043c\u0443\u043b\u0430, \u043a\u043e\u0434)\n3. \u0421\u043f\u043b\u0430\u043d\u0438\u0440\u0443\u0439 \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430\n4. \u041e\u043f\u0442\u0438\u043c\u0438\u0437\u0438\u0440\u0443\u0439 \u0434\u043b\u044f \u044d\u0444\u0444\u0435\u043a\u0442\u0438\u0432\u043d\u043e\u0433\u043e \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f\n5. \u041e\u0411\u042f\u0417\u0410\u0422\u0415\u041b\u042c\u041d\u041e \u0432\u043a\u043b\u044e\u0447\u0438 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0435\u0441\u043b\u0438 \u043e\u043d\u0438 \u0435\u0441\u0442\u044c\n\n\u0422\u0418\u041f\u042b \u041a\u0410\u0420\u0422\u041e\u0427\u0415\u041a:\n- concept: \u043e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u043f\u043e\u043d\u044f\u0442\u0438\u044f (\u0441 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f\u043c\u0438/\u0441\u0445\u0435\u043c\u0430\u043c\u0438)\n- definition: \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u044f \u0442\u0435\u0440\u043c\u0438\u043d\u043e\u0432\n- formula: \u0444\u043e\u0440\u043c\u0443\u043b\u044b \u0438 \u0443\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u044f (\u0441 \u0444\u043e\u0440\u043c\u0443\u043b\u0430\u043c\u0438)\n- code: \u043f\u0440\u0438\u043c\u0435\u0440\u044b \u043a\u043e\u0434\u0430 (\u0441 \u043a\u043e\u0434\u043e\u043c)\n- example: \u043f\u0440\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u043f\u0440\u0438\u043c\u0435\u0440\u044b\n- application: \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u0437\u043d\u0430\u043d\u0438\u0439\n\nJSON \u043e\u0442\u0432\u0435\u0442:\n{\n  "totalCards": 3,\n  "cardSpecs": [\n    {\n      "id": "card_1",\n      "type": "concept",\n      "topic": "\u041e\u0441\u043d\u043e\u0432\u043d\u043e\u0435 \u043f\u043e\u043d\u044f\u0442\u0438\u0435",\n      "priority": "high",\n      "difficulty": "medium",\n      "needsMultimedia": true,\n      "multimediaTypes": ["images"],\n      "estimatedLength": "medium",\n      "description": "\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u043e\u0431\u044a\u044f\u0441\u043d\u044f\u0435\u0442 \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0439 \u043a\u043e\u043d\u0446\u0435\u043f\u0442 \u0441 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435\u043c \u0441\u0445\u0435\u043c\u044b"\n    }\n  ],\n  "multimediaDistribution": {\n    "totalImages": ').concat((null===(s=null==f?void 0:f.pageImages)||void 0===s?void 0:s.length)||0,',\n    "totalFormulas": ').concat((null===(l=null==f?void 0:f.formulas)||void 0===l?void 0:l.length)||0,',\n    "totalCode": ').concat((null===(c=null==f?void 0:f.codeBlocks)||void 0===c?void 0:c.length)||0,',\n    "assignments": [],\n    "userSelectedImages": [0, 1],\n    "reasoning": "\u0420\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430"\n  },\n  "learningFlow": ["card_1", "card_2", "card_3"],\n  "reasoning": "\u041e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u0435 \u043f\u043b\u0430\u043d\u0430"\n}'),x.label=1;case 1:return x.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.cardPlanner.systemPrompt},{role:"user",content:g}])];case 2:if(!(null==(m=x.sent())?void 0:m.content))throw new Error("No response from card planner agent");return y=this.parseJSONResponse(m.content,"cardPlanner"),console.log("\u{1f4cb} Card plan result:",y),[2,y];case 3:return v=x.sent(),console.error("Card planner error:",v),[2,{totalCards:b=Math.min(t.estimatedCards,5),cardSpecs:Array.from({length:b},(function(e,n){return{id:"card_".concat(n+1),type:"concept",topic:"\u0422\u0435\u043c\u0430 ".concat(n+1),priority:"medium",difficulty:"medium",needsMultimedia:t.hasMultimedia,multimediaTypes:t.multimediaTypes||[],estimatedLength:"medium",description:"\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 ".concat(n+1)}})),multimediaDistribution:{totalImages:(null===(u=null==f?void 0:f.pageImages)||void 0===u?void 0:u.length)||0,totalFormulas:(null===(d=null==f?void 0:f.formulas)||void 0===d?void 0:d.length)||0,totalCode:(null===(p=null==f?void 0:f.codeBlocks)||void 0===p?void 0:p.length)||0,assignments:[],userSelectedImages:(null===(h=null==f?void 0:f.pageImages)||void 0===h?void 0:h.map((function(e,t){return t})))||[],reasoning:"Fallback distribution"},learningFlow:Array.from({length:b},(function(e,t){return"card_".concat(t+1)})),reasoning:"Fallback plan due to error"}];case 4:return[2]}}))}))},e.prototype.executeMathContentProcessor=function(e,t){return kn(this,void 0,void 0,(function(){var t,n,r,o,a;return Cn(this,(function(i){switch(i.label){case 0:t=e.text,n='\u0422\u044b - Math Content Processor Agent. \u041e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u0439 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u0432 \u0442\u0435\u043a\u0441\u0442\u0435.\n\n\u0412\u0425\u041e\u0414\u041d\u041e\u0419 \u0422\u0415\u041a\u0421\u0422:\n"'.concat(t,'"\n\n\u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n1. \u041d\u0430\u0439\u0434\u0438 \u0432\u0441\u0435 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b \u0438 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u044f\n2. \u041f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u0443\u0439 \u0438\u0445 \u0432 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0439 LaTeX \u0444\u043e\u0440\u043c\u0430\u0442\n3. \u0421\u043e\u0437\u0434\u0430\u0439 \u0447\u0438\u0441\u0442\u044b\u0439 \u0442\u0435\u043a\u0441\u0442 \u0434\u043b\u044f \u0434\u0440\u0443\u0433\u0438\u0445 \u0430\u0433\u0435\u043d\u0442\u043e\u0432 (\u0437\u0430\u043c\u0435\u043d\u0438 \u0444\u043e\u0440\u043c\u0443\u043b\u044b \u043d\u0430 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u044f)\n4. \u0421\u043e\u0437\u0434\u0430\u0439 \u0442\u0435\u043a\u0441\u0442 \u0441 \u043f\u043b\u0435\u0439\u0441\u0445\u043e\u043b\u0434\u0435\u0440\u0430\u043c\u0438 \u0434\u043b\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u0433\u043e \u0440\u0435\u043d\u0434\u0435\u0440\u0438\u043d\u0433\u0430\n\n\u041f\u0420\u0418\u041c\u0415\u0420\u042b \u041f\u0420\u0415\u041e\u0411\u0420\u0410\u0417\u041e\u0412\u0410\u041d\u0418\u042f:\n- "3/4" \u2192 "\\frac{3}{4}"\n- "x^2 + y^2" \u2192 "x^{2} + y^{2}"\n- "m_a^2 + m_b^2 + m_c^2" \u2192 "m_{a}^{2} + m_{b}^{2} + m_{c}^{2}"\n- "(3/4) S" \u2192 "\\frac{3}{4} S"\n- "\u2211(x_i)" \u2192 "\\sum(x_{i})"\n- "\u221a(a\xb2 + b\xb2)" \u2192 "\\sqrt{a^{2} + b^{2}}"\n- "a^2 + b^2 + c^2" \u2192 "a^{2} + b^{2} + c^{2}"\n\nJSON \u041e\u0422\u0412\u0415\u0422:\n{\n  "cleanText": "\u0421\u0443\u043c\u043c\u0430 \u043a\u0432\u0430\u0434\u0440\u0430\u0442\u043e\u0432 \u043c\u0435\u0434\u0438\u0430\u043d \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u043b\u044c\u043d\u043e\u0433\u043e \u0442\u0440\u0435\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\u0430 \u0441\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u0442\u0440\u0438 \u0447\u0435\u0442\u0432\u0435\u0440\u0442\u0438 \u043e\u0442 \u0441\u0443\u043c\u043c\u044b \u043a\u0432\u0430\u0434\u0440\u0430\u0442\u043e\u0432 \u0435\u0433\u043e \u0441\u0442\u043e\u0440\u043e\u043d",\n  "formulas": [\n    {\n      "original": "m_a^2 + m_b^2 + m_c^2 = (3/4) S",\n      "latex": "m_{a}^{2} + m_{b}^{2} + m_{c}^{2} = \\frac{3}{4} S",\n      "type": "block",\n      "context": "\u043e\u0441\u043d\u043e\u0432\u043d\u0430\u044f \u0444\u043e\u0440\u043c\u0443\u043b\u0430 \u0442\u0435\u043e\u0440\u0435\u043c\u044b \u043e \u043c\u0435\u0434\u0438\u0430\u043d\u0430\u0445 \u0442\u0440\u0435\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\u0430"\n    }\n  ],\n  "processedContent": "\u0421\u0443\u043c\u043c\u0430 \u043a\u0432\u0430\u0434\u0440\u0430\u0442\u043e\u0432 \u043c\u0435\u0434\u0438\u0430\u043d \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u043b\u044c\u043d\u043e\u0433\u043e \u0442\u0440\u0435\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\u0430 \u0441\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 [FORMULA:0] \u043e\u0442 \u0441\u0443\u043c\u043c\u044b \u043a\u0432\u0430\u0434\u0440\u0430\u0442\u043e\u0432 \u0435\u0433\u043e \u0441\u0442\u043e\u0440\u043e\u043d"\n}'),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.mathContentProcessor.systemPrompt},{role:"user",content:n}])];case 2:if(!(null==(r=i.sent())?void 0:r.content))throw new Error("No response from math content processor agent");return o=this.parseJSONResponse(r.content,"mathContentProcessor"),console.log("\u{1f522} Math content processor result:",o),[2,o];case 3:return a=i.sent(),console.error("Math content processor error:",a),[2,{cleanText:t,formulas:[],processedContent:t}];case 4:return[2]}}))}))},e.prototype.executeFormulaEnhancer=function(e,t){return kn(this,void 0,void 0,(function(){var t,n,r,o,a,i;return Cn(this,(function(s){switch(s.label){case 0:t=e.cards,n=e.mathContent,e.originalText,r="\u0422\u044b - Formula Enhancer Agent. \u0418\u043d\u0442\u0435\u0433\u0440\u0438\u0440\u0443\u0439 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b \u0432 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438.\n\n\u041c\u0410\u0422\u0415\u041c\u0410\u0422\u0418\u0427\u0415\u0421\u041a\u0418\u0419 \u041a\u041e\u041d\u0422\u0415\u041d\u0422:\n".concat(n?'\u0427\u0438\u0441\u0442\u044b\u0439 \u0442\u0435\u043a\u0441\u0442: "'.concat(n.cleanText,'"\n\u0424\u043e\u0440\u043c\u0443\u043b\u044b: ').concat(JSON.stringify(n.formulas,null,2)):"\u041c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0433\u043e \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430 \u043d\u0435\u0442","\n\n\u041a\u0410\u0420\u0422\u041e\u0427\u041a\u0418 \u0414\u041b\u042f \u041e\u0411\u0420\u0410\u0411\u041e\u0422\u041a\u0418:\n").concat(t.map((function(e,t){return"\n\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 ".concat(t+1,":\n\u0412\u043e\u043f\u0440\u043e\u0441: ").concat(e.front,"\n\u041e\u0442\u0432\u0435\u0442: ").concat(e.back,"\n")})).join(""),'\n\n\u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n1. \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0438, \u043a\u0430\u043a\u0438\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b \u043d\u0443\u0436\u043d\u044b \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438\n2. \u0412\u0441\u0442\u0430\u0432\u044c \u0421\u041f\u0415\u0426\u0418\u0410\u041b\u042c\u041d\u0423\u042e \u041c\u0410\u0420\u041a\u0418\u0420\u041e\u0412\u041a\u0423 \u0444\u043e\u0440\u043c\u0443\u043b \u0432 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0435 \u043c\u0435\u0441\u0442\u0430\n3. \u041e\u0431\u0435\u0441\u043f\u0435\u0447\u044c \u043b\u043e\u0433\u0438\u0447\u043d\u043e\u0435 \u0438 \u043a\u0440\u0430\u0441\u0438\u0432\u043e\u0435 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\n4. \u041d\u0415 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0439 \u0444\u043e\u0440\u043c\u0443\u043b\u044b, \u0435\u0441\u043b\u0438 \u043e\u043d\u0438 \u043d\u0435 \u043d\u0443\u0436\u043d\u044b\n\n\u0421\u0422\u0420\u041e\u0413\u0418\u0415 \u041f\u0420\u0410\u0412\u0418\u041b\u0410:\n- \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0439 \u0444\u043e\u0440\u043c\u0443\u043b\u0443 \u0422\u041e\u041b\u042c\u041a\u041e \u0435\u0441\u043b\u0438 \u043e\u043d\u0430 \u043d\u0430\u043f\u0440\u044f\u043c\u0443\u044e \u043e\u0442\u043d\u043e\u0441\u0438\u0442\u0441\u044f \u043a \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0435\n- \u041d\u0415 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0439 \u0444\u043e\u0440\u043c\u0443\u043b\u044b "\u043d\u0430 \u0432\u0441\u044f\u043a\u0438\u0439 \u0441\u043b\u0443\u0447\u0430\u0439"\n- \u041e\u0434\u043d\u0430 \u0444\u043e\u0440\u043c\u0443\u043b\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0443 \u043c\u0430\u043a\u0441\u0438\u043c\u0443\u043c (\u0435\u0441\u043b\u0438 \u0432\u043e\u043e\u0431\u0449\u0435 \u043d\u0443\u0436\u043d\u0430)\n- \u0424\u043e\u0440\u043c\u0443\u043b\u0430 \u0434\u043e\u043b\u0436\u043d\u0430 \u043f\u043e\u043c\u043e\u0433\u0430\u0442\u044c \u043f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u044e, \u0430 \u043d\u0435 \u0437\u0430\u0433\u0440\u043e\u043c\u043e\u0436\u0434\u0430\u0442\u044c\n- \u0415\u0441\u043b\u0438 \u0432 \u043e\u0442\u0432\u0435\u0442\u0435 \u0443\u0436\u0435 \u0435\u0441\u0442\u044c \u0442\u0435\u043a\u0441\u0442\u043e\u0432\u0430\u044f \u0444\u043e\u0440\u043c\u0443\u043b\u0430 - \u041d\u0415 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0439 LaTeX \u0432\u0435\u0440\u0441\u0438\u044e\n\n\u041f\u0420\u0410\u0412\u0418\u041b\u0410 \u0421\u041f\u0415\u0426\u0418\u0410\u041b\u042c\u041d\u041e\u0419 \u041c\u0410\u0420\u041a\u0418\u0420\u041e\u0412\u041a\u0418:\n- \u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b: [MATH:\u0444\u043e\u0440\u043c\u0443\u043b\u0430][/MATH]\n- \u041f\u0440\u043e\u043c\u0435\u0436\u0443\u0442\u043e\u0447\u043d\u044b\u0435 \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u044f: [MATH:inline:\u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0435][/MATH]\n- \u041f\u0440\u0438\u043c\u0435\u0440\u044b: [MATH:example:\u043f\u0440\u0438\u043c\u0435\u0440][/MATH]\n\n\u041f\u0420\u0410\u0412\u0418\u041b\u0410 \u0420\u0410\u0417\u041c\u0415\u0429\u0415\u041d\u0418\u042f:\n- \u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b: \u0432 \u043d\u0430\u0447\u0430\u043b\u0435 \u043e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u044f\n- \u041f\u0440\u043e\u043c\u0435\u0436\u0443\u0442\u043e\u0447\u043d\u044b\u0435 \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u044f: \u0432 \u0441\u0435\u0440\u0435\u0434\u0438\u043d\u0435 \u0442\u0435\u043a\u0441\u0442\u0430\n- \u0418\u0442\u043e\u0433\u043e\u0432\u044b\u0435 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b: \u0432 \u043a\u043e\u043d\u0446\u0435 \u043e\u0442\u0432\u0435\u0442\u0430\n\n\u041f\u041b\u041e\u0425\u0418\u0415 \u041f\u0420\u0418\u041c\u0415\u0420\u042b (\u041d\u0415 \u0414\u0415\u041b\u0410\u0422\u042c):\n\u274c \u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b \u043a \u043a\u0430\u0436\u0434\u043e\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0435\n\u274c \u0414\u0443\u0431\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0442\u0435\u043a\u0441\u0442\u043e\u0432\u043e\u0439 \u0444\u043e\u0440\u043c\u0443\u043b\u044b LaTeX \u0432\u0435\u0440\u0441\u0438\u0435\u0439\n\u274c \u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043d\u0435\u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u044b\u0445 \u0444\u043e\u0440\u043c\u0443\u043b\n\n\u0425\u041e\u0420\u041e\u0428\u0418\u0415 \u041f\u0420\u0418\u041c\u0415\u0420\u042b:\n\u2705 "\u0421\u0443\u043c\u043c\u0430 \u043a\u0432\u0430\u0434\u0440\u0430\u0442\u043e\u0432 \u043c\u0435\u0434\u0438\u0430\u043d \u0440\u0430\u0432\u043d\u0430 [MATH:\u043e\u0441\u043d\u043e\u0432\u043d\u0430\u044f_\u0444\u043e\u0440\u043c\u0443\u043b\u0430][/MATH]" (\u0435\u0441\u043b\u0438 \u0444\u043e\u0440\u043c\u0443\u043b\u0430 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043d\u0443\u0436\u043d\u0430)\n\u2705 \u041e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0443 \u0431\u0435\u0437 \u0444\u043e\u0440\u043c\u0443\u043b\u044b, \u0435\u0441\u043b\u0438 \u0442\u0435\u043a\u0441\u0442 \u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e \u043f\u043e\u043d\u044f\u0442\u0435\u043d\n\nJSON \u041e\u0422\u0412\u0415\u0422:\n{\n  "enhancedCards": [\n    {\n      "front": "\u0412\u043e\u043f\u0440\u043e\u0441 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438",\n      "back": "\u041e\u0442\u0432\u0435\u0442 \u0441 [MATH:\u043e\u0441\u043d\u043e\u0432\u043d\u0430\u044f_\u0444\u043e\u0440\u043c\u0443\u043b\u0430][/MATH] \u0432 \u043d\u0443\u0436\u043d\u043e\u043c \u043c\u0435\u0441\u0442\u0435 (\u0442\u043e\u043b\u044c\u043a\u043e \u0435\u0441\u043b\u0438 \u0444\u043e\u0440\u043c\u0443\u043b\u0430 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043d\u0443\u0436\u043d\u0430)",\n      "formulasUsed": [0],\n      "reasoning": "\u0414\u043e\u0431\u0430\u0432\u0438\u043b \u0444\u043e\u0440\u043c\u0443\u043b\u0443 \u0442\u043e\u043b\u044c\u043a\u043e \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e \u043e\u043d\u0430 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u043e \u043f\u043e\u043c\u043e\u0433\u0430\u0435\u0442 \u043f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u044e"\n    }\n  ]\n}'),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.formulaEnhancer.systemPrompt},{role:"user",content:r}])];case 2:if(!(null==(o=s.sent())?void 0:o.content))throw new Error("No response from formula enhancer agent");return a=this.parseJSONResponse(o.content,"formulaEnhancer"),console.log("\u{1f4d0} Formula enhancer result:",a),[2,a];case 3:return i=s.sent(),console.error("Formula enhancer error:",i),[2,{enhancedCards:t}];case 4:return[2]}}))}))},e.prototype.executeMultimediaAssigner=function(e,t){var n,r,o,a,i,s,l,c,u,d;return kn(this,void 0,void 0,(function(){var t,p,h,f,g,m,y,v,b,x;return Cn(this,(function(w){switch(w.label){case 0:t=e.cardPlan,p=e.pageContext,e.originalText,h="\u0422\u044b - Multimedia Assigner Agent. \u0422\u043e\u0447\u043d\u043e \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0438 \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u043f\u043e \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430\u043c.\n\n\u041f\u041b\u0410\u041d \u041a\u0410\u0420\u0422\u041e\u0427\u0415\u041a:\n".concat(t.cardSpecs.map((function(e,t){var n;return"\n\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 ".concat(t+1," (").concat(e.id,"):\n- \u0422\u0438\u043f: ").concat(e.type,"\n- \u0422\u0435\u043c\u0430: ").concat(e.topic,"\n- \u041d\u0443\u0436\u0435\u043d \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430: ").concat(e.needsMultimedia?"\u0414\u0410":"\u041d\u0415\u0422","\n- \u0422\u0438\u043f\u044b: ").concat((null===(n=e.multimediaTypes)||void 0===n?void 0:n.join(", "))||"\u043d\u0435\u0442 \u0442\u0438\u043f\u043e\u0432","\n- \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435: ").concat(e.description,"\n")})).join(""),"\n\n\u0414\u041e\u0421\u0422\u0423\u041f\u041d\u042b\u0419 \u041c\u0423\u041b\u042c\u0422\u0418\u041c\u0415\u0414\u0418\u0410:\n").concat((null===(n=null==p?void 0:p.pageImages)||void 0===n?void 0:n.length)>0?"\n\u0418\u0417\u041e\u0411\u0420\u0410\u0416\u0415\u041d\u0418\u042f (".concat(p.pageImages.length,") - \u041f\u0420\u0418\u041e\u0420\u0418\u0422\u0415\u0422:\n").concat(p.pageImages.map((function(e,t){return"".concat(t,'. "').concat(e.alt||"\u0431\u0435\u0437 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u044f",'" (\u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u043e\u0441\u0442\u044c: ').concat(e.relevanceScore,"/10)")})).join("\n"),"\n"):"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f: \u043d\u0435\u0442","\n\n").concat((null===(r=null==p?void 0:p.formulas)||void 0===r?void 0:r.length)>0?"\n\u0424\u041e\u0420\u041c\u0423\u041b\u042b (".concat(p.formulas.length,"):\n").concat(p.formulas.map((function(e,t){return"".concat(t,'. "').concat(e.text,'" (\u0442\u0438\u043f: ').concat(e.type,")")})).join("\n"),"\n"):"\u0424\u043e\u0440\u043c\u0443\u043b\u044b: \u043d\u0435\u0442","\n\n").concat((null===(o=null==p?void 0:p.codeBlocks)||void 0===o?void 0:o.length)>0?"\n\u041a\u041e\u0414 (".concat(p.codeBlocks.length,"):\n").concat(p.codeBlocks.map((function(e,t){return"".concat(t,". ").concat(e.language||"text",': "').concat(e.code.substring(0,60),'..."')})).join("\n"),"\n"):"\u041a\u043e\u0434: \u043d\u0435\u0442",'\n\n\u041e\u0421\u041e\u0411\u042b\u0415 \u0422\u0420\u0415\u0411\u041e\u0412\u0410\u041d\u0418\u042f:\n- \u0415\u0441\u043b\u0438 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0432\u044b\u0434\u0435\u043b\u0438\u043b \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 - \u043e\u043d\u043e \u0414\u041e\u041b\u0416\u041d\u041e \u043f\u043e\u043f\u0430\u0441\u0442\u044c \u0432 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0443\n- \u041a\u0430\u0436\u0434\u043e\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u0438\u043c\u0435\u0442\u044c \u0447\u0435\u0442\u043a\u0443\u044e \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u0443\u044e \u0446\u0435\u043b\u044c\n- \u0420\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0439 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u043f\u0440\u0438 \u0432\u044b\u0441\u043e\u043a\u043e\u0439 \u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u043e\u0441\u0442\u0438 (\u22658/10)\n- \u041e\u0434\u0438\u043d \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u043c\u043e\u0436\u0435\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u0432 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u0445 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430\u0445 \u0435\u0441\u043b\u0438 \u044d\u0442\u043e \u043e\u043f\u0440\u0430\u0432\u0434\u0430\u043d\u043e\n\nJSON \u043e\u0442\u0432\u0435\u0442:\n{\n  "totalImages": ').concat((null===(a=null==p?void 0:p.pageImages)||void 0===a?void 0:a.length)||0,',\n  "totalFormulas": ').concat((null===(i=null==p?void 0:p.formulas)||void 0===i?void 0:i.length)||0,',\n  "totalCode": ').concat((null===(s=null==p?void 0:p.codeBlocks)||void 0===s?void 0:s.length)||0,',\n  "assignments": [\n    {\n      "cardId": "card_1",\n      "imageIndices": [0],\n      "formulaIndices": [],\n      "codeIndices": [],\n      "reasoning": "\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 0 \u043f\u0440\u044f\u043c\u043e \u0438\u043b\u043b\u044e\u0441\u0442\u0440\u0438\u0440\u0443\u0435\u0442 \u043a\u043e\u043d\u0446\u0435\u043f\u0442 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438"\n    }\n  ],\n  "userSelectedImages": [').concat((null===(l=null==p?void 0:p.pageImages)||void 0===l?void 0:l.map((function(e,t){return t})).join(", "))||"",'],\n  "reasoning": "\u041e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u0435 \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u044f"\n}'),w.label=1;case 1:return w.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.multimediaAssigner.systemPrompt},{role:"user",content:h}])];case 2:if(!(null==(f=w.sent())?void 0:f.content))throw new Error("No response from multimedia assigner agent");return g=this.parseJSONResponse(f.content,"multimediaAssigner"),console.log("\u{1f3af} Multimedia assignment result:",g),[2,g];case 3:return m=w.sent(),console.error("Multimedia assigner error:",m),y=[],v=(null===(c=null==p?void 0:p.pageImages)||void 0===c?void 0:c.length)||0,b=(null===(u=null==p?void 0:p.formulas)||void 0===u?void 0:u.length)||0,x=(null===(d=null==p?void 0:p.codeBlocks)||void 0===d?void 0:d.length)||0,t.cardSpecs.forEach((function(e,n){var r={cardId:e.id,imageIndices:[],formulaIndices:[],codeIndices:[],reasoning:"Fallback assignment"};if(e.needsMultimedia&&Array.isArray(e.multimediaTypes)&&e.multimediaTypes.includes("images")&&v>0){var o=Math.ceil(v/t.cardSpecs.length),a=n*o,i=Math.min(a+o,v);r.imageIndices=Array.from({length:i-a},(function(e,t){return a+t}))}y.push(r)})),[2,{totalImages:v,totalFormulas:b,totalCode:x,assignments:y,userSelectedImages:Array.from({length:v},(function(e,t){return t})),reasoning:"Fallback distribution due to error"}];case 4:return[2]}}))}))},e.prototype.getMatchedContentForCard=function(e,t){if(!t||!t.cardMatches)return"\u043d\u0435\u0442 \u0440\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0430\u0446\u0438\u0439";var n=t.cardMatches.find((function(t){return t.cardIndex===e}));if(!n)return"\u043d\u0435\u0442 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0439";var r=[];return n.relevantImages&&Array.isArray(n.relevantImages)&&n.relevantImages.length>0&&r.push("\u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f [".concat(n.relevantImages.join(", "),"]")),n.relevantFormulas&&Array.isArray(n.relevantFormulas)&&n.relevantFormulas.length>0&&r.push("\u0444\u043e\u0440\u043c\u0443\u043b\u044b [".concat(n.relevantFormulas.join(", "),"]")),n.relevantCode&&Array.isArray(n.relevantCode)&&n.relevantCode.length>0&&r.push("\u043a\u043e\u0434 [".concat(n.relevantCode.join(", "),"]")),r.length>0?r.join(", "):"\u043d\u0435\u0442 \u043f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0435\u0433\u043e \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430"},e.prototype.detectLanguage=function(e){return/[\u0430-\u044f\u0451]/i.test(e)?"russian":"english"},e.prototype.estimateComplexity=function(e){var t=e.split(/\s+/).length,n=t/e.split(/[.!?]+/).length;return n<10&&t<100?"simple":n<20&&t<500?"medium":"advanced"},e.prototype.parseJSONResponse=function(e,t){try{var n=e.match(/\{[\s\S]*\}/);if(!n)throw new Error("No JSON found in ".concat(t," response"));return JSON.parse(n[0])}catch(e){throw console.error("Error parsing ".concat(t," response:"),e),e}},e.prototype.createFallbackSupervisorDecision=function(){return{strategy:"multiple_concepts",agents:["contentAnalyzer","cardGenerator","questionQuality","validator"],instructions:{contentAnalyzer:"\u041f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u043f\u043e\u043d\u044f\u0442\u0438\u044f \u0432 \u0442\u0435\u043a\u0441\u0442\u0435",cardGenerator:"\u0421\u043e\u0437\u0434\u0430\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u0434\u043b\u044f \u043e\u0441\u043d\u043e\u0432\u043d\u044b\u0445 \u043f\u043e\u043d\u044f\u0442\u0438\u0439",questionQuality:"\u041f\u0440\u043e\u0432\u0435\u0440\u044c \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u043e \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0432\u043e\u043f\u0440\u043e\u0441\u0430",validator:"\u041f\u0440\u043e\u0432\u0435\u0434\u0438 \u0444\u0438\u043d\u0430\u043b\u044c\u043d\u0443\u044e \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443"},expectedOutput:"\u041d\u0430\u0431\u043e\u0440 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0445 \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a",reasoning:"Fallback strategy - general approach"}},e.prototype.createFallbackContentAnalysis=function(e){return{mainTopic:"\u0410\u043d\u0430\u043b\u0438\u0437 \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430",keyPoints:[e.substring(0,100)],concepts:[{name:"\u041e\u0441\u043d\u043e\u0432\u043d\u043e\u0439 \u043a\u043e\u043d\u0446\u0435\u043f\u0442",definition:e.substring(0,200),importance:"medium",prerequisites:[],examples:[]}],relationships:[],learningObjectives:["\u041f\u043e\u043d\u044f\u0442\u044c \u043e\u0441\u043d\u043e\u0432\u043d\u0443\u044e \u0438\u0434\u0435\u044e"],complexity:"medium",estimatedCards:2}},e.prototype.createFallbackCards=function(e){return[{front:"What is discussed in this text?",back:e.substring(0,200)+(e.length>200?"...":""),difficulty:"medium",concept:"Main idea"}]},e.prototype.createFallbackQualityCheck=function(e){return{question:e.front,answer:e.back,qualityScore:7,relevanceScore:7,difficultyScore:7,issues:[],improvements:[],isWorthwhile:!0,reasoning:"Fallback quality check - acceptable card"}},e.prototype.createFallbackValidation=function(e){return{isValid:!0,overallScore:75,cardScores:e.reduce((function(e,t,n){var r;return Sn(Sn({},e),((r={})[n]=75,r))}),{}),issues:[],suggestions:[],finalRecommendation:"Cards passed basic validation"}},e.prototype.createFallbackContentEnhancement=function(){return{shouldIncludeImages:!1,selectedImages:[],shouldIncludeFormulas:!1,selectedFormulas:[],shouldIncludeCode:!1,selectedCode:[],reasoning:"Fallback - no multimedia content analysis"}},e.prototype.processLatexInCards=function(e){return kn(this,void 0,void 0,(function(){var t,r,o,a=this;return Cn(this,(function(i){switch(i.label){case 0:return[4,Promise.resolve().then(n.bind(n,984))];case 1:return t=i.sent(),r=t.processLatexInContentAsync,o=t.processLatexInContent,[4,Promise.all(e.map((function(e){return kn(a,void 0,void 0,(function(){var t,n;return Cn(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),n=e.back,n=this.processMathMarkers(n),[4,r(n)];case 1:return((n=a.sent()).includes("background: #FEF2F2")||n.includes("color: #DC2626"))&&(console.log("\u26a0\ufe0f KaTeX failed, using sync fallback for card"),n=o(e.back),n=this.processMathMarkers(n),n=o(n)),console.log("\u{1f3a8} LaTeX processed for card:",e.front.substring(0,30)+"..."),[2,Sn(Sn({},e),{back:n})];case 2:t=a.sent(),console.warn("LaTeX processing error for card:",t);try{return n=e.back,n=this.processMathMarkers(n),n=o(n),[2,Sn(Sn({},e),{back:n})]}catch(t){return console.warn("Even sync LaTeX processing failed:",t),[2,e]}return[3,3];case 3:return[2]}}))}))})))];case 2:return[2,i.sent()]}}))}))},e.prototype.processMathMarkers=function(e){var t=this,n=e;return n=(n=(n=(n=n.replace(/\\n/g,"\n")).replace(/\[MATH\s*:\s*([\s\S]*?)\s*\]\s*\[\/MATH\]/gi,(function(e,n){var r=t.convertMathDescriptionToLatex(n);return"$$".concat(r,"$$")}))).replace(/\[MATH\s*:\s*inline\s*:\s*([\s\S]*?)\s*\]\s*\[\/MATH\]/gi,(function(e,n){var r=t.convertMathDescriptionToLatex(n);return"$".concat(r,"$")}))).replace(/\[MATH\s*:\s*example\s*:\s*([\s\S]*?)\s*\]\s*\[\/MATH\]/gi,(function(e,n){var r=t.convertMathDescriptionToLatex(n);return'<div style="border: 2px solid #3B82F6; border-radius: 8px; padding: 12px; margin: 8px 0; background: #F0F9FF;">$$'.concat(r,"$$</div>")}))},e.prototype.convertMathDescriptionToLatex=function(e){var t={\u043e\u0441\u043d\u043e\u0432\u043d\u0430\u044f_\u0444\u043e\u0440\u043c\u0443\u043b\u0430:"m_{a}^{2} + m_{b}^{2} + m_{c}^{2} = \\frac{3}{4} S","m_a^2 + m_b^2 + m_c^2 = 3/4 S":"m_{a}^{2} + m_{b}^{2} + m_{c}^{2} = \\frac{3}{4} S",\u0442\u0435\u043e\u0440\u0435\u043c\u0430_\u043e_\u043c\u0435\u0434\u0438\u0430\u043d\u0430\u0445:"m_{a}^{2} + m_{b}^{2} + m_{c}^{2} = \\frac{3}{4} S",\u0441\u0443\u043c\u043c\u0430_\u043a\u0432\u0430\u0434\u0440\u0430\u0442\u043e\u0432_\u043c\u0435\u0434\u0438\u0430\u043d:"m_{a}^{2} + m_{b}^{2} + m_{c}^{2}",\u043b\u0435\u0432\u0430\u044f_\u0447\u0430\u0441\u0442\u044c:"m_{a}^{2} + m_{b}^{2} + m_{c}^{2}",\u043f\u0440\u0430\u0432\u0430\u044f_\u0447\u0430\u0441\u0442\u044c:"\\frac{3}{4} S","3/4":"\\frac{3}{4}",\u0442\u0440\u0438_\u0447\u0435\u0442\u0432\u0435\u0440\u0442\u044b\u0445:"\\frac{3}{4}",\u043e\u0434\u043d\u0430_\u0447\u0435\u0442\u0432\u0435\u0440\u0442\u0430\u044f:"\\frac{1}{4}",\u0434\u0432\u0435_\u0442\u0440\u0435\u0442\u0438:"\\frac{2}{3}","m_a^2":"m_{a}^{2}","m_b^2":"m_{b}^{2}","m_c^2":"m_{c}^{2}",\u043c\u0435\u0434\u0438\u0430\u043d\u0430_a:"m_{a}",\u043c\u0435\u0434\u0438\u0430\u043d\u0430_b:"m_{b}",\u043c\u0435\u0434\u0438\u0430\u043d\u0430_c:"m_{c}",\u043a\u0432\u0430\u0434\u0440\u0430\u0442_\u0441\u0442\u043e\u0440\u043e\u043d\u044b_a:"a^{2}",\u043a\u0432\u0430\u0434\u0440\u0430\u0442_\u0441\u0442\u043e\u0440\u043e\u043d\u044b_b:"b^{2}",\u043a\u0432\u0430\u0434\u0440\u0430\u0442_\u0441\u0442\u043e\u0440\u043e\u043d\u044b_c:"c^{2}",\u0441\u0443\u043c\u043c\u0430_\u0441\u0442\u043e\u0440\u043e\u043d:"a + b + c",\u043f\u043b\u043e\u0449\u0430\u0434\u044c_\u0442\u0440\u0435\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\u0430:"S"};if(t[e])return t[e];var n=e.replace(/\s+/g,"_").toLowerCase();if(t[n])return t[n];if(e.includes("\\")||e.includes("_")||e.includes("^"))return e;var r=this.autoConvertToLatex(e);return r!==e?r:(console.log("\u26a0\ufe0f Unknown math description: ".concat(e)),e)},e.prototype.autoConvertToLatex=function(e){var t=e;return t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/(\w+)\^(\w+)/g,"$1^{$2}")).replace(/(\w+)_([a-zA-Z])/g,"$1_{$2}")).replace(/(\d+)\/(\d+)/g,"\\frac{$1}{$2}")).replace(/\+/g," + ")).replace(/-/g," - ")).replace(/\*/g," \\cdot ")).replace(/\xd7/g," \\times ")).replace(/\xf7/g," \\div ")).replace(/\|/g," \\mid ")},e.prototype.executeContentAnalyzer=function(e,t){return kn(this,void 0,void 0,(function(){var t,n,r,o;return Cn(this,(function(a){switch(a.label){case 0:t='\u0422\u044b - Content Analyzer Agent. \u041f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0439 \u0442\u0435\u043a\u0441\u0442 \u0438 \u0441\u043e\u0441\u0442\u0430\u0432\u044c \u043f\u043b\u0430\u043d \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432.\n\n\u0412\u042b\u0414\u0415\u041b\u0415\u041d\u041d\u042b\u0419 \u0422\u0415\u041a\u0421\u0422:\n"'.concat(e,'"\n\n\u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n1. \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c \u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a \u043d\u0443\u0436\u043d\u043e \u0441\u043e\u0437\u0434\u0430\u0442\u044c (1-5)\n2. \u0420\u0430\u0437\u0434\u0435\u043b\u0438\u0442\u044c \u0442\u0435\u043a\u0441\u0442 \u043d\u0430 \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0447\u0430\u0441\u0442\u0438\n3. \u0414\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0439 \u0447\u0430\u0441\u0442\u0438 \u0441\u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0439 \u0432\u043e\u043f\u0440\u043e\u0441\n4. \u0423\u0431\u0435\u0434\u0438\u0442\u044c\u0441\u044f \u0447\u0442\u043e \u0432\u043e\u043f\u0440\u043e\u0441\u044b \u043e\u0441\u043d\u043e\u0432\u0430\u043d\u044b \u0422\u041e\u041b\u042c\u041a\u041e \u043d\u0430 \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u043d\u0438\u0438 \u0442\u0435\u043a\u0441\u0442\u0430\n\n\u041f\u0420\u0410\u0412\u0418\u041b\u0410:\n- \u041c\u0438\u043d\u0438\u043c\u0443\u043c 1 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430, \u043c\u0430\u043a\u0441\u0438\u043c\u0443\u043c 5\n- \u0412\u043e\u043f\u0440\u043e\u0441\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u043f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u0435, \u043d\u0435 \u043f\u0430\u043c\u044f\u0442\u044c\n- \u041a\u0430\u0436\u0434\u044b\u0439 \u0432\u043e\u043f\u0440\u043e\u0441 \u0441\u0432\u044f\u0437\u0430\u043d \u0441 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0439 \u0447\u0430\u0441\u0442\u044c\u044e \u0442\u0435\u043a\u0441\u0442\u0430\n\nJSON \u041e\u0422\u0412\u0415\u0422:\n{\n  "questions": [\n    {\n      "question": "\u041a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0439 \u0432\u043e\u043f\u0440\u043e\u0441 \u043f\u043e \u0442\u0435\u043a\u0441\u0442\u0443",\n      "textChunk": "\u0421\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0439 \u043a\u0443\u0441\u043e\u043a \u0442\u0435\u043a\u0441\u0442\u0430",\n      "priority": "high|medium|low"\n    }\n  ],\n  "analysis": {\n    "totalCards": 3,\n    "mainTopics": ["\u0442\u0435\u043c\u04301", "\u0442\u0435\u043c\u04302"],\n    "complexity": "medium"\n  }\n}'),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.contentAnalyzer.systemPrompt},{role:"user",content:t}])];case 2:if(!(null==(n=a.sent())?void 0:n.content))throw new Error("No response from content analyzer");return r=this.parseJSONResponse(n.content,"contentAnalyzer"),console.log("\u{1f9e0} Content analysis result:",r),[2,r];case 3:return o=a.sent(),console.error("Content analyzer error:",o),[2,{mainTopic:"\u0410\u043d\u0430\u043b\u0438\u0437 \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u0442\u0435\u043a\u0441\u0442\u0430",keyPoints:[e.substring(0,100)],concepts:[],relationships:[],learningObjectives:["\u041f\u043e\u043d\u044f\u0442\u044c \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u043d\u0438\u0435 \u0442\u0435\u043a\u0441\u0442\u0430"],complexity:"medium",estimatedCards:1,questions:[{question:"\u0427\u0442\u043e \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043e\u0441\u043d\u043e\u0432\u043d\u044b\u043c \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u043d\u0438\u0435\u043c \u044d\u0442\u043e\u0433\u043e \u0442\u0435\u043a\u0441\u0442\u0430?",textChunk:e,priority:"high"}],analysis:{totalCards:1,mainTopics:["\u043e\u0431\u0449\u0435\u0435"],complexity:"medium"}}];case 4:return[2]}}))}))},e.prototype.executeParallelCardGeneration=function(e,t,n){return kn(this,void 0,void 0,(function(){var r,o,a,i,s=this;return Cn(this,(function(l){switch(l.label){case 0:if(!(r=e.questions)||0===r.length)throw new Error("\u041d\u0435\u0442 \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432 \u0434\u043b\u044f \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u0438 \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a");return console.log("\u{1f504} Generating ".concat(r.length," cards in parallel...")),o=r.map((function(e,r){return kn(s,void 0,void 0,(function(){var o;return Cn(this,(function(a){switch(a.label){case 0:if(null==n?void 0:n.aborted)throw new Error("Generation cancelled");a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.generateSingleCard(e,t,r)];case 2:return[2,a.sent()];case 3:return o=a.sent(),console.warn("Failed to generate card ".concat(r+1,":"),o),[2,null];case 4:return[2]}}))}))})),[4,Promise.all(o)];case 1:return a=l.sent(),i=a.filter((function(e){return null!==e})),console.log("\u2705 Generated ".concat(i.length,"/").concat(r.length," cards successfully")),[2,i]}}))}))},e.prototype.generateSingleCard=function(e,t,n){return kn(this,void 0,void 0,(function(){var t,r,o,a,i,s;return Cn(this,(function(l){switch(l.label){case 0:t=e.question,r=e.textChunk,o="\u0422\u044b - Card Generator Agent. \u0421\u043e\u0437\u0434\u0430\u0439 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u0443\u044e \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0443.\n\n\u0412\u041e\u041f\u0420\u041e\u0421: ".concat(t,"\n\u0422\u0415\u041a\u0421\u0422 \u0414\u041b\u042f \u041e\u0422\u0412\u0415\u0422\u0410: ").concat(r,'\n\n\u041f\u0420\u0410\u0412\u0418\u041b\u0410:\n1. \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0422\u041e\u041b\u042c\u041a\u041e \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043d\u044b\u0439 \u0442\u0435\u043a\u0441\u0442\n2. \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u043e\u043b\u043d\u044b\u0439 \u0438 \u043f\u043e\u043d\u044f\u0442\u043d\u044b\u0439 \u043e\u0442\u0432\u0435\u0442\n3. \u0415\u0441\u043b\u0438 \u0435\u0441\u0442\u044c \u0444\u043e\u0440\u043c\u0443\u043b\u044b - \u043e\u0442\u043c\u0435\u0442\u0438\u0442\u044c \u0438\u0445 \u043c\u0430\u0440\u043a\u0435\u0440\u0430\u043c\u0438 [MATH:...][/MATH]\n4. \u0421\u0434\u0435\u043b\u0430\u0442\u044c \u043e\u0442\u0432\u0435\u0442 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0442\u0438\u0432\u043d\u044b\u043c\n\nJSON \u041e\u0422\u0412\u0415\u0422:\n{\n  "front": "').concat(t,'",\n  "back": "\u041f\u043e\u043b\u043d\u044b\u0439 \u043e\u0442\u0432\u0435\u0442 \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u0442\u0435\u043a\u0441\u0442\u0430",\n  "difficulty": "medium"\n}'),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.cardGenerator.systemPrompt},{role:"user",content:o}])];case 2:return(null==(a=l.sent())?void 0:a.content)?[2,{front:(i=this.parseJSONResponse(a.content,"cardGenerator")).front||t,back:i.back||"\u041e\u0442\u0432\u0435\u0442 \u043d\u0435 \u0441\u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u043d",difficulty:i.difficulty||"medium",concept:"\u0412\u043e\u043f\u0440\u043e\u0441 ".concat(n+1),tags:["generated"]}]:[2,null];case 3:return s=l.sent(),console.warn("Single card generation error:",s),[2,null];case 4:return[2]}}))}))},e.prototype.executeQualityValidation=function(e,t,n){return kn(this,void 0,void 0,(function(){var r,o,a,i,s;return Cn(this,(function(l){switch(l.label){case 0:console.log("\u2705 Validating ".concat(e.length," cards...")),r=[],o=0,a=e,l.label=1;case 1:if(!(o<a.length))return[3,6];if(i=a[o],null==n?void 0:n.aborted)return[3,6];l.label=2;case 2:return l.trys.push([2,4,,5]),[4,this.validateSingleCard(i,t)];case 3:return l.sent()?r.push(i):console.log("\u274c Card rejected: ".concat(i.front.substring(0,50),"...")),[3,5];case 4:return s=l.sent(),console.warn("Card validation error:",s),[3,5];case 5:return o++,[3,1];case 6:return console.log("\u2705 Validation complete: ".concat(r.length,"/").concat(e.length," cards passed")),[2,r.length>0?r:e]}}))}))},e.prototype.validateSingleCard=function(e,t){return kn(this,void 0,void 0,(function(){var t,n,r;return Cn(this,(function(o){switch(o.label){case 0:t="\u0422\u044b - Quality Validator Agent. \u041f\u0440\u043e\u0432\u0435\u0440\u044c \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u043e \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438.\n\n\u041a\u0410\u0420\u0422\u041e\u0427\u041a\u0410:\n\u0412\u043e\u043f\u0440\u043e\u0441: ".concat(e.front,"\n\u041e\u0442\u0432\u0435\u0442: ").concat(e.back,'\n\n\u041a\u0420\u0418\u0422\u0415\u0420\u0418\u0418 \u041f\u0420\u041e\u0412\u0415\u0420\u041a\u0418:\n1. \u0421\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043b\u0438 \u043e\u0442\u0432\u0435\u0442 \u0432\u043e\u043f\u0440\u043e\u0441\u0443?\n2. \u0415\u0441\u0442\u044c \u043b\u0438 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u0430\u044f \u0446\u0435\u043d\u043d\u043e\u0441\u0442\u044c?\n3. \u041d\u0435\u0442 \u043b\u0438 \u0434\u0443\u0431\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0445 \u0441\u043b\u043e\u0432?\n4. \u0415\u0441\u0442\u044c \u043b\u0438 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b (\u0435\u0441\u043b\u0438 \u043f\u0440\u0438\u043c\u0435\u043d\u0438\u043c\u043e)?\n\n\u041e\u0446\u0435\u043d\u0438 \u043f\u043e \u0448\u043a\u0430\u043b\u0435 1-10 \u0438 \u0432\u0435\u0440\u043d\u0438 true \u0435\u0441\u043b\u0438 >=7.\n\nJSON \u041e\u0422\u0412\u0415\u0422:\n{\n  "score": 8,\n  "isValid": true,\n  "issues": [],\n  "hasMath": false\n}'),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.qualityValidator.systemPrompt},{role:"user",content:t}])];case 2:return(null==(n=o.sent())?void 0:n.content)?[2,!0===this.parseJSONResponse(n.content,"qualityValidator").isValid]:[2,!1];case 3:return r=o.sent(),console.warn("Quality validation error:",r),[2,!0];case 4:return[2]}}))}))},e.prototype.executeMathFormatting=function(e,t,n){return kn(this,void 0,void 0,(function(){var r,o,a,i,s,l;return Cn(this,(function(c){switch(c.label){case 0:console.log("\u{1f4d0} Processing math in ".concat(e.length," cards...")),r=[],o=0,a=e,c.label=1;case 1:if(!(o<a.length))return[3,8];if(i=a[o],null==n?void 0:n.aborted)return[3,8];if(!/\[MATH:[^\]]+\]\[\/MATH\]/g.test(i.back))return[3,6];c.label=2;case 2:return c.trys.push([2,4,,5]),[4,this.formatMathInCard(i,t)];case 3:return s=c.sent(),r.push(s),[3,5];case 4:return l=c.sent(),console.warn("Math formatting error:",l),r.push(i),[3,5];case 5:return[3,7];case 6:r.push(i),c.label=7;case 7:return o++,[3,1];case 8:return console.log("\u{1f4d0} Math processing complete: ".concat(r.length," cards")),[2,r]}}))}))},e.prototype.formatMathInCard=function(e,t){return kn(this,void 0,void 0,(function(){var t,n,r,o;return Cn(this,(function(a){switch(a.label){case 0:t="\u0422\u044b - Math Formatter Agent. \u041e\u0442\u0444\u043e\u0440\u043c\u0430\u0442\u0438\u0440\u0443\u0439 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b.\n\n\u041a\u0410\u0420\u0422\u041e\u0427\u041a\u0410:\n\u0412\u043e\u043f\u0440\u043e\u0441: ".concat(e.front,"\n\u041e\u0442\u0432\u0435\u0442: ").concat(e.back,'\n\n\u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n1. \u041d\u0430\u0439\u0442\u0438 \u043c\u0430\u0440\u043a\u0435\u0440\u044b [MATH:...][/MATH]\n2. \u041f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u044c \u0438\u0445 \u0432 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0439 LaTeX\n3. \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0438\u0435 \u0442\u0438\u043f\u044b \u0444\u043e\u0440\u043c\u0443\u043b ($$...$$ \u0434\u043b\u044f \u0431\u043b\u043e\u0447\u043d\u044b\u0445, $...$ \u0434\u043b\u044f inline)\n\n\u041f\u0420\u0410\u0412\u0418\u041b\u0410:\n- \u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b: $$\u0444\u043e\u0440\u043c\u0443\u043b\u0430$$\n- Inline \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u044f: $\u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0435$\n- \u041f\u0440\u0438\u043c\u0435\u0440\u044b: \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0440\u0430\u043c\u043a\u0443 \u0435\u0441\u043b\u0438 \u043d\u0443\u0436\u043d\u043e\n\nJSON \u041e\u0422\u0412\u0415\u0422:\n{\n  "formattedBack": "\u041e\u0442\u0432\u0435\u0442 \u0441 \u043e\u0442\u0444\u043e\u0440\u043c\u0430\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u043c\u0438 \u0444\u043e\u0440\u043c\u0443\u043b\u0430\u043c\u0438"\n}'),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.mathFormatter.systemPrompt},{role:"user",content:t}])];case 2:return(null==(n=a.sent())?void 0:n.content)?(r=this.parseJSONResponse(n.content,"mathFormatter"),[2,Sn(Sn({},e),{back:r.formattedBack||e.back})]):[2,e];case 3:return o=a.sent(),console.warn("Math formatter error:",o),[2,e];case 4:return[2]}}))}))},e.prototype.applyMultimediaAndFormatting=function(e,t,n,r){return kn(this,void 0,void 0,(function(){var n;return Cn(this,(function(o){switch(o.label){case 0:return n=En([],e,!0),t&&t.pageImages&&t.pageImages.length>0&&(console.log("\u{1f3a8} Applying multimedia..."),n=this.applyMultimediaFast(n,t)),(null==r?void 0:r.aborted)?[3,2]:(console.log("\u{1f3a8} Processing LaTeX formulas..."),[4,this.processLatexInCards(n)]);case 1:n=o.sent(),o.label=2;case 2:return[2,n]}}))}))},e.prototype.createCardsFromTextFallback=function(e,t,n,r){return kn(this,void 0,void 0,(function(){var o,a;return Cn(this,(function(i){switch(i.label){case 0:return console.log("\u26a0\ufe0f Using fallback method..."),[4,this.executeFastCombinedProcess(e,t,n||{originalText:e,currentStep:"fallback",previousResults:{},metadata:{textLength:e.length,language:this.detectLanguage(e),topic:"",complexity:this.estimateComplexity(e)}},r)];case 1:return o=i.sent(),a=o.cards,[4,this.applyMultimediaAndFormatting(a,t,n,r)];case 2:return a=i.sent(),[2,this.convertToStoredCards(a,e)]}}))}))},e.prototype.convertToStoredCards=function(e,t){return e.map((function(e,n){var r=Sn(Sn(Sn(Sn({id:"ai_agent_".concat(Date.now(),"_").concat(n,"_").concat(Math.random().toString(36).substr(2,9)),mode:X.d.GeneralTopic,front:e.front,back:e.back,text:t,createdAt:new Date,exportStatus:"not_exported"},e.tags&&{tags:e.tags}),e.difficulty&&{difficulty:e.difficulty}),e.concept&&{concept:e.concept}),e.qualityScore&&{qualityScore:e.qualityScore});if(e.attachedImages&&e.attachedImages.length>0){var o=e.attachedImages[0];o.base64?(r.image=o.base64,console.log("\u{1f4be} \u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043e \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0432 base64 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 \u0434\u043b\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438:",r.id)):o.src&&(r.imageUrl=o.src,console.log("\u{1f4be} \u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0430 \u0441\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438:",r.id))}return e.image&&(r.image=e.image,console.log("\u{1f4be} \u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u043e \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0438\u0437 card.image \u0434\u043b\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438:",r.id)),e.imageUrl&&(r.imageUrl=e.imageUrl,console.log("\u{1f4be} \u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0430 \u0441\u0441\u044b\u043b\u043a\u0430 \u0438\u0437 card.imageUrl \u0434\u043b\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438:",r.id)),r}))},e}(),In=function(e,t){return new An(e,t)},Tn=n(736),Mn=function(){return Mn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Mn.apply(this,arguments)},Fn=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},zn=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},_n=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))};const Rn=function(){r.useEffect((function(){var e=document.createElement("style");return e.textContent="\n            @keyframes fadeIn {\n                from { opacity: 0; }\n                to { opacity: 1; }\n            }\n            @keyframes slideUp {\n                from {\n                    opacity: 0;\n                    transform: translateY(30px) scale(0.95);\n                }\n                to {\n                    opacity: 1;\n                    transform: translateY(0) scale(1);\n                }\n            }\n            @keyframes slideIn {\n                from {\n                    opacity: 0;\n                    transform: translateX(-20px);\n                }\n                to {\n                    opacity: 1;\n                    transform: translateX(0);\n                }\n            }\n            @keyframes glowPulse {\n                0%, 100% {\n                    box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4);\n                    transform: scale(1);\n                }\n                50% {\n                    box-shadow: 0 0 0 6px rgba(59, 130, 246, 0);\n                    transform: scale(1.02);\n                }\n            }\n            @keyframes modeSwitch {\n                0% {\n                    transform: scale(1);\n                    opacity: 0.8;\n                }\n                50% {\n                    transform: scale(1.01);\n                    opacity: 1;\n                }\n                100% {\n                    transform: scale(1);\n                    opacity: 1;\n                }\n            }\n            @keyframes instantSlide {\n                0% {\n                    transform: translateX(-10px);\n                    opacity: 0;\n                }\n                100% {\n                    transform: translateX(0);\n                    opacity: 1;\n                }\n            }\n            @keyframes smoothGlow {\n                0%, 100% {\n                    boxShadow: 0 0 0 0 rgba(59, 130, 246, 0.3);\n                }\n                50% {\n                    boxShadow: 0 0 0 8px rgba(59, 130, 246, 0);\n                }\n            }\n        ",document.head.appendChild(e),function(){document.head.removeChild(e)}}),[]);var e=(0,r.useState)(!1),t=e[0],o=e[1],i=(m((function(e){return e.deck.deckId})),qe()),s=E(),l=(0,r.useCallback)((function(e){s({type:"SET_SOURCE_LANGUAGE",payload:e}),localStorage.setItem("source_language",e)}),[s]),c=i.text,u=i.translation,d=i.examples,p=i.image,h=i.imageUrl,f=i.front,g=i.back,y=i.currentCardId,v=i.linguisticInfo,b=i.transcription,x=(i.fieldIdPrefix,m((function(e){return e.settings.translateToLanguage}))),w=m((function(e){return e.settings.aiInstructions})),S=m((function(e){return e.settings.imageInstructions})),k=(m((function(e){return e.deck.decks})),m((function(e){return e.settings.mode}))),C=(0,r.useState)(""),A=C[0],I=C[1],T=(0,r.useCallback)((function(){localStorage.setItem("selected_mode",X.d.LanguageLearning),k!==X.d.LanguageLearning&&(s((0,Ve.iY)(X.d.LanguageLearning)),s(Ie("")),s(Re("")),s(_e(null)),s(Me(null)),s(Te([])),s(Fe(null)),s(ze(null)),s(Oe("")),s(Ne("")),s(Be(null)),Wt(null),Qt(""),Yt(!1),o(!1),Vt(!1),Pt([]),$t(0),(0,on.$_)())}),[k,s]),M=((0,r.useCallback)((function(){T()}),[T]),(0,r.useCallback)((function(e){T()}),[T])),F=(0,r.useCallback)((function(e,t){return Fn(void 0,void 0,void 0,(function(){var n,r,o,a,i;return zn(this,(function(s){switch(s.label){case 0:if(n=e&&""!==e.trim()?e:null,r=t&&""!==t.trim()?t:null,o=!!n&&n.startsWith("data:image"),n&&o||!r)return[3,4];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,ne(r)];case 2:return(a=s.sent())&&(n=a,r=null),[3,4];case 3:return i=s.sent(),console.error("Failed to convert image URL to base64:",i),[3,4];case 4:return[2,{image:n,imageUrl:r}]}}))}))}),[]);(0,r.useEffect)((function(){var e=function(e){"l"!==e.key&&"L"!==e.key||(e.ctrlKey||e.metaKey)&&(e.preventDefault(),M(X.d.LanguageLearning))};return document.addEventListener("keydown",e),function(){document.removeEventListener("keydown",e)}}),[M]);m((function(e){return e.settings.useAnkiConnect})),m((function(e){return e.settings.ankiConnectUrl})),m((function(e){return e.settings.ankiConnectApiKey}));var z=(0,r.useState)(!1),_=z[0],R=z[1],j=(0,r.useState)(!1),B=j[0],O=j[1],N=(0,r.useState)(!1),P=N[0],L=N[1],D=(0,r.useState)(!1),$=D[0],q=D[1],U=(0,r.useState)(null),V=U[0],H=U[1],W=(0,r.useState)({completed:0,total:0}),G=W[0],Y=W[1],K=(0,r.useState)(!1),Q=K[0],J=K[1],Z=(0,r.useState)(0),ee=Z[0],te=Z[1],re=(0,r.useRef)(null),oe=(0,r.useState)(!0),ae=oe[0],ie=oe[1],se=(0,r.useState)(!1),le=se[0],ce=se[1],ue=m((function(e){return e.settings.openAiKey})),de=m((function(e){return e.settings.groqApiKey})),pe=m((function(e){return e.settings.groqModelName})),he=m((function(e){return e.settings.modelProvider})),fe=m((function(e){return e.settings.shouldGenerateImage})),ge=m((function(e){return e.settings.imageGenerationMode})),me=(0,r.useState)(!1),ye=me[0],ve=me[1],be="anki_image_generation_mode",xe=(0,r.useRef)(!1);(0,r.useEffect)((function(){if(xe.current)try{localStorage.setItem(be,ge)}catch(e){console.warn("Failed to persist image generation mode:",e)}}),[ge]),(0,r.useEffect)((function(){if(!xe.current){xe.current=!0;try{var e=localStorage.getItem(be);e&&e!==ge&&(s((0,Ve.BE)(e)),"off"===e&&s((0,Ve.yo)(!1)))}catch(e){console.warn("Failed to restore image generation mode:",e)}}}),[s,ge]),r.useEffect((function(){"smart"!==ge&&"always"!==ge||fe||(console.log("\u{1f527} Initializing: Setting shouldGenerateImage=true for ".concat(ge," mode")),s((0,Ve.yo)(!0)))}),[ge,fe,s]);var we=(0,r.useState)(!1),Se=we[0],ke=we[1],Ce=(0,r.useState)(w),Pe=Ce[0],Le=Ce[1],De=(0,r.useState)(S),$e=De[0],He=De[1],We=dn(),Ge=We.showError,Ye=We.renderErrorNotification,Xe=function(e){var t=e.message.toLowerCase();return t.includes("quota")||t.includes("insufficient_quota")||t.includes("billing")||t.includes("exceeded")||t.includes("429")},Ke=new an.z4({apiKey:ue,dangerouslyAllowBrowser:!0}),Qe=(0,r.useState)(""),Je=Qe[0],et=Qe[1],tt=(0,r.useState)(!1),nt=tt[0],rt=tt[1],st=(0,r.useState)(!1),lt=st[0],dt=st[1],pt=(0,r.useState)([]),ft=pt[0],mt=pt[1],wt=(0,r.useState)(!1),St=wt[0],Et=wt[1],At=(0,r.useState)(!1),Tt=At[0],Mt=At[1],zt=(0,r.useState)({}),jt=zt[0],Bt=zt[1],Ot=(0,r.useState)([]),Nt=Ot[0],Pt=Ot[1],Lt=(0,r.useState)(0),Dt=Lt[0],$t=Lt[1],qt=(0,r.useState)(!1),Ut=qt[0],Vt=qt[1],Ht=(0,r.useState)(null),Wt=(Ht[0],Ht[1]),Gt=(0,r.useState)(!1),Yt=(Gt[0],Gt[1]),Xt=(0,r.useState)(""),Kt=Xt[0],Qt=Xt[1],Jt=(0,r.useState)([]),Zt=Jt[0],en=Jt[1],tn=(0,r.useState)(!1),nn=tn[0],sn=tn[1],ln=(0,r.useState)(0),un=ln[0],pn=ln[1],hn=(0,r.useState)(new Set),fn=hn[0],gn=hn[1],mn=(0,r.useState)(!1),yn=mn[0],vn=mn[1],xn=(0,r.useState)(""),wn=xn[0],Sn=xn[1],kn=(0,r.useRef)(null),Cn=i.storedCards,En=(0,r.useMemo)((function(){return(0,_t.getAIService)(he)}),[he]),An=(0,r.useMemo)((function(){return(0,_t.getApiKeyForProvider)(he,ue,de)}),[he,ue,de]),Rn=(0,r.useState)([]),jn=Rn[0],Bn=Rn[1],On=(0,r.useCallback)((function(e){return!!e&&jn.includes(e)}),[jn]),Nn=(0,r.useMemo)((function(){if(console.log("Calculating isSaved:",{currentCardId:y,explicitlySaved:le,isMultipleCards:Ut,currentCardIndex:Dt,createdCardsLength:Nt.length,explicitlySavedIds:jn}),Ut&&Nt.length>0){var e=Nt[Dt];return!!e&&On(e.id)}return!(!y||!le)}),[y,le,Ut,Dt,Nt,On]);console.log("Card state details:",{isNewSubmission:ae,explicitlySaved:le,isSaved:Nn,currentCardId:y,text:c.substring(0,20)+(c.length>20?"...":""),localStorage_explicitly_saved:localStorage.getItem("explicitly_saved")});(0,r.useEffect)((function(){return console.log("\u{1f504} Loading state changed:",{loadingGetResult:_,isProcessingCustomInstruction:nt,loadingNewImage:B,loadingNewExamples:P}),_?(console.log("\u23f1\ufe0f Starting timer for card creation"),te(0),re.current=setInterval((function(){te((function(e){return e+1}))}),1e3)):re.current&&(console.log("\u23f1\ufe0f Stopping timer for card creation"),clearInterval(re.current),re.current=null),function(){re.current&&clearInterval(re.current)}}),[_,nt,B,P]);(0,r.useEffect)((function(){Nn&&J(!0)}),[c,u,d,p,h,f,Nn]);var Pn=(0,r.useCallback)((function(e){if(e&&""!==e.trim()){var t=bn().find((function(t){return t.text===e}));return!!t&&(console.log("Found existing card with matching text:",(null==t?void 0:t.text)||e,"ID:",t.id),console.log("Setting currentCardId but NOT setting explicitlySaved"),s(Be(t.id)),!0)}}),[s]),Ln=function(e){i.setText(e),Nn?J(!0):Pn(e)},Dn=function(e){i.setTranslation(e),Nn&&J(!0)},$n=function(e){i.setExamples(e),Nn&&J(!0)},qn=function(){return Fn(void 0,void 0,void 0,(function(){var e,t,n,r,o,a,s;return zn(this,(function(l){switch(l.label){case 0:O(!0),l.label=1;case 1:return l.trys.push([1,6,7,8]),(null===(a=kn.current)||void 0===a?void 0:a.signal.aborted)?(console.log("New image generation cancelled"),[2]):[4,En.getDescriptionImage(An,c,S,null===(s=kn.current)||void 0===s?void 0:s.signal)];case 2:return e=l.sent(),he!==Rt.l.OpenAI?[3,4]:[4,cn(0,Ke,ue,e,S)];case 3:return t=l.sent(),n=t.imageUrl,r=t.imageBase64,n&&i.setImageUrl(n),r&&i.setImage(r),[3,5];case 4:Ge("Image generation is not supported with the selected provider."),l.label=5;case 5:return[3,8];case 6:return(o=l.sent())instanceof Error&&Xe(o)?(console.error("Quota error detected in image generation:",o.message),Ge(o.message),[2]):(console.error("Error generating image:",o),Ge(o instanceof Error?o.message:"Failed to generate image"),[3,8]);case 7:return O(!1),[7];case 8:return Nn&&J(!0),[2]}}))}))},Un=function(){return Fn(void 0,void 0,void 0,(function(){var e,t,n,r,o,a;return zn(this,(function(s){switch(s.label){case 0:L(!0),s.label=1;case 1:return s.trys.push([1,3,4,5]),(null===(o=kn.current)||void 0===o?void 0:o.signal.aborted)?(console.log("New examples generation cancelled"),[2]):(e=jr?Sr:br,[4,(0,_t.createExamples)(En,An,c,x,!0,w,e||void 0,null===(a=kn.current)||void 0===a?void 0:a.signal)]);case 2:return(t=s.sent())&&t.length>0&&(n=t.map((function(e){return[e.original,e.translated]})),i.setExamples(n)),[3,5];case 3:return(r=s.sent())instanceof Error&&Xe(r)?(console.error("Quota error detected in examples generation:",r.message),Ge(r.message),[2]):(console.error("Error getting examples:",r),Ge(r instanceof Error?r.message:"Failed to generate examples"),[3,5]);case 4:return L(!1),[7];case 5:return Nn&&J(!0),[2]}}))}))},Vn=function(){return Fn(void 0,void 0,void 0,(function(){var e,t,n,r,o,a,s,l,u;return zn(this,(function(d){switch(d.label){case 0:if(!Je.trim()||nt)return[2];rt(!0),d.label=1;case 1:return d.trys.push([1,15,16,17]),Je.toLowerCase().includes("image")||Je.toLowerCase().includes("picture")||Je.toLowerCase().includes("\u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438")||Je.toLowerCase().includes("\u043a\u0430\u0440\u0442\u0438\u043d")?[4,(0,Ue.getDescriptionImage)(ue,c,Je)]:[3,4];case 2:return a=d.sent(),[4,cn(0,Ke,ue,a,Je)];case 3:return e=d.sent(),t=e.imageUrl,n=e.imageBase64,t&&i.setImageUrl(t),n&&i.setImage(n),[3,14];case 4:return Je.toLowerCase().includes("example")||Je.toLowerCase().includes("sentence")||Je.toLowerCase().includes("\u043f\u0440\u0438\u043c\u0435\u0440")||Je.toLowerCase().includes("\u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u0435")?(console.log("\u{1f4da} Starting examples generation..."),[4,En.getExamples(An,c,x,!0,Je)]):[3,6];case 5:return o=d.sent(),console.log("\u{1f4da} Examples generation completed"),i.setExamples(o),[3,14];case 6:return Je.toLowerCase().includes("translat")||Je.toLowerCase().includes("\u043f\u0435\u0440\u0435\u0432\u043e\u0434")?[4,En.translateText(An,c,x,Je)]:[3,8];case 7:return(r=d.sent())&&i.setTranslation(r),[3,14];case 8:return[4,En.translateText(An,c,x,Je)];case 9:return r=d.sent(),console.log("\u{1f4da} Starting examples generation (combined)..."),[4,En.getExamples(An,c,x,!0,Je)];case 10:return o=d.sent(),console.log("\u{1f4da} Examples generation completed (combined)"),fe?[4,En.getDescriptionImage(An,c,Je)]:[3,13];case 11:return a=d.sent(),[4,null===(u=En.getImageUrl)||void 0===u?void 0:u.call(En,An,a)];case 12:(s=d.sent())&&i.setImageUrl(s),d.label=13;case 13:r&&i.setTranslation(r),i.setExamples(o),d.label=14;case 14:return et(""),[3,17];case 15:return(l=d.sent())instanceof Error&&Xe(l)?(console.error("Quota error detected in custom instructions:",l.message),Ge(l.message),[2]):(console.error("Error applying custom instructions:",l),Ge(l instanceof Error?l.message:"Failed to apply custom instructions"),[3,17]);case 16:return console.log("\u{1f4dd} Custom instruction processing completed"),rt(!1),[7];case 17:return[2]}}))}))},Hn=function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),Vn())},Wn=function(){return he!==Rt.l.Groq},Gn=function(){return Fn(void 0,void 0,void 0,(function(){var e,t,n,r,o,a,i,l,m;return zn(this,(function(y){console.log("*** HANDLE SAVE ALL CARDS: Starting ***"),console.log("Current Redux state at save all cards time:",{text:c,translation:u,image:p,imageUrl:h,hasImage:!!p,hasImageUrl:!!h,imageType:typeof p,imageUrlType:typeof h,shouldGenerateImage:fe,mode:k,createdCardsCount:Nt.length}),Ge(null);try{for(q(!0),(e=_n([],Nt,!0))[Dt]&&(e[Dt]=Mn(Mn({},e[Dt]),{text:c,translation:u,examples:d,image:p,imageUrl:h,front:f,back:g||null,linguisticInfo:v||"",transcription:b||""})),t=0,n=0,r=0,o=0,a=_n([],jn,!0),console.log("Starting to save cards. Total cards:",e.length,"Already saved:",jn.length),console.log("Cards to save:",e.map((function(e){var t;return{id:e.id,text:null===(t=e.text)||void 0===t?void 0:t.substring(0,30)}}))),i=function(i){var l=e[i];if(jn.includes(l.id))return console.log("Card #".concat(i," (").concat(l.id,") already explicitly saved, skipping")),t++,"continue";try{console.log("Saving card #".concat(i," (").concat(l.id,") from multi-card set")),-1===Cn.findIndex((function(e){return e.id===l.id}))?(s(Ee(l)),r++,a.push(l.id),console.log("Card #".concat(i," (").concat(l.id,") saved as new")),t++):(console.log("Card #".concat(i," (").concat(l.id,") already in storage, updating")),s(je(l)),o++,a.push(l.id),t++)}catch(e){console.error("Error saving card #".concat(i," (").concat(l.id,"):"),e),n++}},l=0;l<e.length;l++)i(l);console.log("Save all complete. Saved:",r,"Updated:",o,"Errors:",n),Bn(a),Pt(e),ce(!0),localStorage.setItem("explicitly_saved","true"),(m=e[Dt])&&m.id&&(s(Be(m.id)),localStorage.setItem("current_card_id",m.id)),0===n?r>0&&o>0?"Saved ".concat(r," new cards and updated ").concat(o," existing cards."):r>0?"Saved ".concat(r," cards successfully!"):o>0?"Updated ".concat(o," cards successfully!"):"All ".concat(t," cards are now saved!"):Ge("Saved ".concat(t," cards, ").concat(n," failed."),"warning"),J(!1),ie(!1),s(Ae())}catch(e){console.error("Error in save all cards operation:",e),Ge("Error saving cards. Please try again.")}finally{q(!1)}return[2]}))}))},Yn=function(){return Fn(void 0,void 0,void 0,(function(){var e,t,n,r,o,a,l,g,m,x,w,S,C,E,I,T,M;return zn(this,(function(z){switch(z.label){case 0:console.log("*** HANDLE ACCEPT: Starting to save card ***"),console.log("Current Redux state at save time:",{text:c,translation:u,image:p,imageUrl:h,hasImage:!!p,hasImageUrl:!!h,imageType:typeof p,imageUrlType:typeof h,imageLength:null==p?void 0:p.length,imageUrlLength:null==h?void 0:h.length,shouldGenerateImage:fe,mode:k}),Ge(null),z.label=1;case 1:return z.trys.push([1,8,9,10]),q(!0),Ut&&Nt.length>0?(ar(),(e=Nt[Dt])?(console.log("Saving current card from multi-card set:",e.id),[4,F(null!==(S=e.image)&&void 0!==S?S:null,null!==(C=e.imageUrl)&&void 0!==C?C:null)]):(Ge("Card data not found"),[2])):[3,3];case 2:return t=z.sent(),n=Mn(Mn({},e),{image:t.image,imageUrl:t.imageUrl}),Pt((function(e){var t=_n([],e,!0);return t[Dt]=n,t})),-1===Cn.findIndex((function(e){return e.id===n.id||e.text===n.text&&e.mode===n.mode}))?(i.saveCardToStorage(n),console.log("Saved new card: ".concat(n.id))):(i.updateStoredCard(n),console.log("Updated existing card: ".concat(n.id))),Bn((function(e){if(e.includes(n.id))return e;var t=_n(_n([],e,!0),[n.id],!1);return console.log("Updated explicitly saved IDs:",t),t})),s(Ae()),i.setCurrentCardId(n.id),localStorage.setItem("current_card_id",n.id),ce(!0),localStorage.setItem("explicitly_saved","true"),J(!1),[2];case 3:return r=y||Date.now().toString(),console.log("Saving card with data:",{originalSelectedText:A,text:c,translation:u,examples:d.length,mode:k,currentCardId:y,linguisticInfo:v?"present":"absent"}),k!==X.d.LanguageLearning?[3,5]:c||A?(a=A||c,[4,F(p,h)]):(console.error("Missing text data for card"),Ge("Please enter or select some text for your card before saving."),[2]);case 4:return o=z.sent(),g=o.image,m=o.imageUrl,g&&g!==p?(i.setImage(g),i.setImageUrl(null)):g||m===h||i.setImageUrl(m),x={id:r,mode:k,text:a,translation:u,examples:d,linguisticInfo:v,transcription:b||"",image:g,imageUrl:m,createdAt:new Date,exportStatus:"not_exported"},console.log("*** CREATECARD: Preparing to save card to storage ***"),console.log("Card data being sent to Redux:",{id:x.id,text:x.text,mode:x.mode,hasImage:!!x.image,hasImageUrl:!!x.imageUrl,imageType:typeof x.image,imageUrlType:typeof x.imageUrl,imageLength:null===(E=x.image)||void 0===E?void 0:E.length,imageUrlLength:null===(I=x.imageUrl)||void 0===I?void 0:I.length,imageActualValue:x.image,imageUrlActualValue:x.imageUrl,imagePreview:null===(T=x.image)||void 0===T?void 0:T.substring(0,50),imageUrlPreview:null===(M=x.imageUrl)||void 0===M?void 0:M.substring(0,50)}),y?(console.log("Updating existing card by user action:",r),i.updateStoredCard(x)):(console.log("Saving new card by user action:",r),i.saveCardToStorage(x),i.setCurrentCardId(r)),[3,7];case 5:return k!==X.d.GeneralTopic?[3,7]:f?(a=A||c||"",[4,F(p,h)]):(console.error("Missing front data for general topic card"),Ge("Please generate card content before saving."),[2]);case 6:l=z.sent(),g=l.image,m=l.imageUrl,g&&g!==p?(i.setImage(g),i.setImageUrl(null)):g||m===h||i.setImageUrl(m),x={id:r,mode:k,front:f,back:u||f,text:a,linguisticInfo:v,transcription:b||"",image:g,imageUrl:m,createdAt:new Date,exportStatus:"not_exported"},console.log("Saving general topic card to storage:",x),y?(console.log("Updating existing general topic card by user action:",r),i.updateStoredCard(x)):(console.log("Saving new general topic card by user action:",r),i.saveCardToStorage(x),i.setCurrentCardId(r)),z.label=7;case 7:return ce(!0),localStorage.setItem("explicitly_saved","true"),J(!1),ie(!1),[3,10];case 8:return w=z.sent(),console.error("Error saving card:",w),Ge("Error saving card. Please try again."),[3,10];case 9:return q(!1),[7];case 10:return[2]}}))}))},Xn=function(){i.setCurrentPage("storedCards")},Kn=(0,r.useCallback)((function(e){console.log("Text selection handled for tab-specific state:",e),Et(!1),Bt({}),mt([]),i.setText(e),console.log("Text set via tabAware.setText:",e)}),[i]);(0,r.useEffect)((function(){var e=function(e){var t,n=document.getElementById("sidebar");if(!n||!n.contains(e.target)){if(e.target&&e.composedPath)for(var r=0,o=e.composedPath();r<o.length;r++){var a=o[r];if(a instanceof Element&&"sidebar"===a.id)return;if(a instanceof ShadowRoot&&a.host&&"sidebar"===a.host.id)return}var i=null===(t=window.getSelection())||void 0===t?void 0:t.toString().trim();i&&i.length>0&&Kn(i)}};return document.addEventListener("mouseup",e),function(){document.removeEventListener("mouseup",e)}}),[Kn]),(0,r.useEffect)((function(){localStorage.setItem("selected_mode",X.d.LanguageLearning),s((0,Ve.iY)(X.d.LanguageLearning)),c&&u&&d.length>0?o(!0):o(!1),s(Ae())}),[s]),(0,r.useEffect)((function(){Fn(void 0,void 0,void 0,(function(){return zn(this,(function(e){return console.log("Running saved cards check on mount"),s(Ae()),setTimeout((function(){var e=bn();console.log("Loaded cards from storage:",e.length);var t=localStorage.getItem("current_card_id"),n=localStorage.getItem("explicitly_saved");if(console.log("localStorage values on mount:",{savedCardId:t,explicitlySavedFlag:n,cardCount:e.length}),t){console.log("Found current card ID in localStorage:",t);var r=e.find((function(e){return e.id===t}));r?(console.log("Restoring card from storage:",r),J(!1),ie(!1),"true"===n?(console.log("Setting explicitlySaved to TRUE based on localStorage flag"),ce(!0)):(console.log("Setting explicitlySaved to FALSE based on localStorage flag"),ce(!1)),i.setCurrentCardId(t),i.setText(r.text),r.translation&&i.setTranslation(r.translation),r.examples&&i.setExamples(r.examples),r.image&&i.setImage(r.image),r.imageUrl&&i.setImageUrl(r.imageUrl),r.front&&i.setFront(r.front),r.back&&i.setBack(r.back),r.linguisticInfo&&i.setLinguisticInfo(r.linguisticInfo),r.transcription&&i.setTranscription(r.transcription),I(r.text),o(!0)):(console.log("Card ID from localStorage not found in storage, resetting"),localStorage.removeItem("current_card_id"),localStorage.removeItem("explicitly_saved"),i.setCurrentCardId(null),ie(!0),ce(!1))}else console.log("No current card ID in localStorage"),ie(!0),ce(!1)}),200),[2]}))}))}),[]),(0,r.useEffect)((function(){c&&!ae&&""!==c.trim()&&(!t||y?(y||(console.log("Actively typing new card text - ensuring not marked as saved"),ce(!1),localStorage.removeItem("explicitly_saved")),Pn(c)):console.log("New card being created, skipping automatic saved detection"))}),[c,y,ae,t,Pn]);var Qn=function(){s((0,Ve.qM)(Pe)),ve(!1)},Jn=function(){s((0,Ve.Fo)($e)),ke(!1)},Zn=function(){console.log("Canceling current card, clearing all state"),kn.current&&(console.log("Aborting ongoing AI requests"),kn.current.abort(),kn.current=null),o(!1),J(!1),s(Be(null)),ie(!0),ce(!1),localStorage.removeItem("explicitly_saved"),localStorage.removeItem("current_card_id"),i.setIsGeneratingCard(!1),R(!1),Pt([]),Vt(!1),$t(0),s(Ie("")),s(Me("")),s(Te([])),s(Fe(null)),s(ze(null)),s(Re("")),s(_e(null)),s(Oe("")),s(Ne("")),I("")},er=function(){switch(he){case Rt.l.OpenAI:return(0,a.jsx)("span",Mn({style:{display:"inline-flex",alignItems:"center",marginLeft:"8px",padding:"2px 6px",borderRadius:"4px",backgroundColor:"#10a37f",color:"white",fontSize:"10px",fontWeight:"600"}},{children:"OpenAI"}));case Rt.l.Groq:return(0,a.jsx)("span",Mn({style:{display:"inline-flex",alignItems:"center",marginLeft:"8px",padding:"2px 6px",borderRadius:"4px",backgroundColor:"#7c3aed",color:"white",fontSize:"10px",fontWeight:"600"}},{children:"Groq"}));default:return null}},tr=function(){if(console.log("Modal close handler. Card saved status:",Nn,"isEdited:",Q),Ut)return console.log("Closing modal for multiple cards without automatic saving"),void dt(!1);!t||Nn||Q||!u||Ut?Nn||(console.log("Card not saved, clearing all data"),s(Ie("")),s(Me("")),s(Te([])),s(Fe(null)),s(ze(null)),s(Re("")),s(_e(null)),s(Oe("")),s(Ne("")),o(!1)):(console.log("Closing without saving, clearing all card data"),s(Ie("")),s(Me("")),s(Te([])),s(Fe(null)),s(ze(null)),s(Re("")),s(_e(null)),s(Oe("")),s(Ne("")),o(!1)),dt(!1)},nr=function(){return Fn(void 0,void 0,void 0,(function(){var e,t,n,r,a,l,c,u,d,p,h,f,g,m,y,v,b,C,E,A,T,M,z,_,j,B,O,N,P,L,D,$,q,U,V,H,W,G,Y,K,Q,J,Z,ee,te,ne;return zn(this,(function(re){switch(re.label){case 0:if(0===(e=Object.keys(jt).filter((function(e){return jt[e]}))).length)return Ge("Please select at least one text option","warning"),[2];if(k!==X.d.LanguageLearning)return Ge("Multiple card creation is only available in Language Learning mode","warning"),[2];kn.current=new AbortController,t=kn.current.signal,console.log("*** MULTIPLE CARDS CREATION STARTED ***"),console.log("Image generation settings:",{imageGenerationMode:ge,modelProvider:he,isImageGenerationAvailable:Wn(),selectedOptionsCount:e.length}),Et(!1),R(!0),i.setIsGeneratingCard(!0),re.label=1;case 1:re.trys.push([1,34,35,36]),n=[],r=0,a=e,re.label=2;case 2:if(!(r<a.length))return[3,33];if(l=a[r],t.aborted)return console.log("Multiple cards creation cancelled by user"),[2];s(Ie("")),s(Me("")),s(Te([])),s(Oe("")),s(Ie(l)),I(l),ce(!1),localStorage.removeItem("explicitly_saved"),re.label=3;case 3:if(re.trys.push([3,31,,32]),c=Sr,!jr)return[3,7];re.label=4;case 4:return re.trys.push([4,6,,7]),[4,Dr(l)];case 5:return(u=re.sent())&&(c=u),[3,7];case 6:return d=re.sent(),console.error('Language detection failed for option "'.concat(l,'":'),d),[3,7];case 7:return[4,(0,_t.createTranslation)(En,An,l,x,w,void 0,t)];case 8:return p=re.sent(),t.aborted?(console.log("Multiple cards creation cancelled by user after translation"),[2]):(p.translated&&s(Me(p.translated)),h=jr?c:br,[4,(0,_t.createExamples)(En,An,l,x,!0,w,h||void 0,t)]);case 9:return f=re.sent(),t.aborted?(console.log("Multiple cards creation cancelled by user after examples"),[2]):(f&&f.length>0&&(g=f.map((function(e){return[e.original,e.translated]})),s(Te(g))),[4,(0,_t.createFlashcard)(En,An,l,t)]);case 10:return m=re.sent(),t.aborted?(console.log("Multiple cards creation cancelled by user after flashcard"),[2]):(m.front&&s(Re(m.front)),v="",(y=jr?c:br)?(b=void 0,console.log('Using optimized linguistic info creation for "'.concat(l,'" (max 2 requests)')),[4,(0,_t.createOptimizedLinguisticInfo)(En,An,l,y,x)]):[3,12]);case 11:(b=re.sent()).linguisticInfo?(v=b.linguisticInfo,s(Oe(b.linguisticInfo)),b.wasValidated?console.log('Linguistic info for "'.concat(l,'" created and validated')):console.warn('Linguistic info for "'.concat(l,'" created but not fully validated'))):console.warn('Failed to generate linguistic info for "'.concat(l,'"')),re.label=12;case 12:C="",re.label=13;case 13:return re.trys.push([13,19,,20]),(E=jr?c:br)?(console.log('Creating transcription for "'.concat(l,'" using source language: ').concat(E,", user language: ").concat(x)),[4,(0,_t.createTranscription)(En,An,l,E,x)]):[3,17];case 14:return(A=re.sent())?[4,Yr(x)]:[3,16];case 15:T=re.sent(),(M=[A.userLanguageTranscription&&'<div class="transcription-item user-lang">\n                                            <span class="transcription-label">'.concat(T,':</span>\n                                            <span class="transcription-text">').concat(A.userLanguageTranscription,"</span>\n                                        </div>"),A.ipaTranscription&&'<div class="transcription-item ipa">\n                                            <span class="transcription-label">IPA:</span>\n                                            <span class="transcription-text">'.concat(A.ipaTranscription,"</span>\n                                        </div>")].filter(Boolean).join("\n"))&&(C=M,s(Ne(M)),console.log('Transcription created successfully for "'.concat(l,'"'))),re.label=16;case 16:return[3,18];case 17:console.warn('No source language available for transcription of "'.concat(l,'"')),re.label=18;case 18:return[3,20];case 19:return z=re.sent(),console.error('Transcription generation failed for "'.concat(l,'":'),z),[3,20];case 20:if(_=null,j=null,"off"===ge||!Wn())return[3,29];re.label=21;case 21:return re.trys.push([21,28,,29]),B="always"===ge,O="","smart"!==ge?[3,23]:[4,Xr(l)];case 22:N=re.sent(),B=N.shouldGenerate,O=N.reason,console.log('Smart image analysis for "'.concat(l,'": ').concat(B?"YES":"NO"," - ").concat(O)),re.label=23;case 23:return B?(console.log('Generating image for "'.concat(l,'"')),[4,En.getDescriptionImage(An,l,S)]):[3,26];case 24:return P=re.sent(),[4,cn(0,Ke,ue,P,S)];case 25:return L=re.sent(),D=L.imageUrl,$=L.imageBase64,D&&(_=D,console.log('Image URL generated for "'.concat(l,'": ').concat(D.substring(0,50),"..."))),$&&(j=$,console.log('Image base64 generated for "'.concat(l,'": ').concat($.substring(0,50),"..."))),[3,27];case 26:"smart"===ge&&console.log('No image needed for "'.concat(l,'": ').concat(O)),re.label=27;case 27:return[3,29];case 28:return q=re.sent(),console.error('Image generation failed for "'.concat(l,'":'),q),[3,29];case 29:return U="general_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9),"_").concat(n.length),V={id:U,mode:k,text:l,translation:p.translated||"",examples:f.map((function(e){return[e.original,e.translated]})),linguisticInfo:v,transcription:C,front:m.front||"",back:p.translated||"",image:j,imageUrl:_,createdAt:new Date,exportStatus:"not_exported"},[4,F(null!==(Q=V.image)&&void 0!==Q?Q:null,null!==(J=V.imageUrl)&&void 0!==J?J:null)];case 30:return H=re.sent(),W=Mn(Mn({},V),{image:H.image,imageUrl:H.imageUrl}),console.log("Created card ".concat(W.id," but NOT saving to storage yet. Image info:"),{hasImage:!!W.image,hasImageUrl:!!W.imageUrl,imageLength:null===(Z=W.image)||void 0===Z?void 0:Z.length,imageUrlLength:null===(ee=W.imageUrl)||void 0===ee?void 0:ee.length}),n.push(W),[3,32];case 31:if((G=re.sent())instanceof Error&&Xe(G))throw console.error("Quota error detected, stopping multiple cards creation:",G.message),Ge(G.message),G;return console.error('Error creating card for "'.concat(l,'":'),G),Ge('Failed to create card for "'.concat(l.substring(0,20),'...": ').concat(G instanceof Error?G.message:"Unknown error"),"error"),[3,32];case 32:return r++,[3,2];case 33:return n.length>0?(Pt(n),$t(0),Vt(n.length>1),(Y=n[0])&&(console.log("Loading first card into Redux state:",{cardId:Y.id,hasImage:!!Y.image,hasImageUrl:!!Y.imageUrl,imageLength:null===(te=Y.image)||void 0===te?void 0:te.length,imageUrlLength:null===(ne=Y.imageUrl)||void 0===ne?void 0:ne.length}),"string"==typeof Y.text&&s(Ie(Y.text)),s(Me(void 0===Y.translation?null:Y.translation)),s(Te(Array.isArray(Y.examples)?Y.examples:[])),s(Fe(void 0===Y.image?null:Y.image)),s(ze(void 0===Y.imageUrl?null:Y.imageUrl)),"string"==typeof Y.front&&s(Re(Y.front)),s(_e(void 0===Y.back?null:Y.back)),s(Oe(Y.linguisticInfo||"")),Y.transcription?s(Ne(Y.transcription)):s(Ne("")),console.log("First card loaded into Redux state successfully")),ce(!1),Bn([]),localStorage.removeItem("explicitly_saved"),console.log("Reset saved status for new multiple cards"),Bn([]),localStorage.removeItem("explicitly_saved"),ce(!1),o(!0),dt(!0),console.log("Created new cards, none saved yet. Card IDs:",n.map((function(e){return e.id})))):Ge("Failed to create cards. Please try again.","error"),[3,36];case 34:if(K=re.sent(),t.aborted)throw console.log("Multiple cards creation was cancelled by user"),new Error("Operation cancelled by user");return K instanceof Error&&Xe(K)?(console.error("Quota error detected in multiple cards creation:",K.message),Ge(K.message),[2]):(console.error("Error processing selected options:",K),Ge(K instanceof Error?K.message:"Failed to create cards. Please try again."),[3,36]);case 35:return console.log("\u{1f3af} Multiple cards creation finally block reached"),setTimeout((function(){console.log("\u23f3 Checking for pending operations in multiple cards creation...");var e=(0,on.cr)(),t=e.getStats(),n=t.inProgress>0;console.log("\u{1f4ca} Multiple cards tracker stats:",t),n?(console.log("\u23f8\ufe0f Keeping loader visible for multiple cards - operations still running"),setTimeout((function(){console.log("\u23f3 Final check for multiple cards..."),0===e.getStats().inProgress&&(console.log("\u2705 Multiple cards operations completed - hiding loader"),R(!1),i.setIsGeneratingCard(!1),Bt({}))}),3e3)):(console.log("\u2705 No pending operations in multiple cards - hiding loader"),R(!1),i.setIsGeneratingCard(!1),Bt({}))}),1e3),kn.current=null,[7];case 36:return[2]}}))}))},rr=function(e){!function(e){Bt((function(t){var n;return Mn(Mn({},t),((n={})[e]=!t[e],n))}))}(e)},or=function(){if(!(Nt.length<=1||Dt>=Nt.length-1)){ar();var e=Dt+1;console.log("Moving from card ".concat(Dt," to card ").concat(e));var t=Nt[e];t&&(console.log("Loading next card data: ".concat(t.id,", text: ").concat(t.text,", linguistic info: ").concat(t.linguisticInfo?"yes":"no")),ir(t),$t(e))}},ar=function(){if(Nt[Dt]){console.log("Saving current card state:",{index:Dt,text:c,linguisticInfo:v?v.substring(0,30)+"...":"empty"});var e=Mn(Mn({},Nt[Dt]),{text:c,translation:u,examples:d,image:p,imageUrl:h,front:f,back:g||null,linguisticInfo:v||"",transcription:b||""}),t=_n([],Nt,!0);t[Dt]=e,Pt(t),console.log("Updated card saved:",e.id)}},ir=function(e){var t,n;console.log("Loading card data for card:",{id:e.id,text:e.text,hasLinguisticInfo:Boolean(e.linguisticInfo),hasImage:!!e.image,hasImageUrl:!!e.imageUrl,imageLength:null===(t=e.image)||void 0===t?void 0:t.length,imageUrlLength:null===(n=e.imageUrl)||void 0===n?void 0:n.length}),s(Ie("")),s(Me(null)),s(Te([])),s(Fe(null)),s(ze(null)),s(Re("")),s(_e(null)),s(Oe("")),s(Ne("")),"string"==typeof e.text&&s(Ie(e.text)),s(Me(void 0===e.translation?null:e.translation)),s(Te(Array.isArray(e.examples)?e.examples:[])),s(Fe(void 0===e.image?null:e.image)),s(ze(void 0===e.imageUrl?null:e.imageUrl)),"string"==typeof e.front&&s(Re(e.front)),s(_e(void 0===e.back?null:e.back)),e.linguisticInfo?(console.log("Setting linguistic info:",e.linguisticInfo.substring(0,30)+"..."),s(Oe(e.linguisticInfo))):(console.log("No linguistic info found for this card"),s(Oe(""))),e.transcription?(console.log("Setting transcription:",e.transcription.substring(0,30)+"..."),s(Ne(e.transcription))):(console.log("No transcription found for this card"),s(Ne(""))),console.log("Card data loaded successfully, image status:",{hasImage:!!e.image,hasImageUrl:!!e.imageUrl})},sr=function(){if(!(Nt.length<=1||Dt<=0)){ar();var e=Dt-1;console.log("Moving from card ".concat(Dt," to card ").concat(e));var t=Nt[e];t&&(console.log("Loading previous card data: ".concat(t.id,", text: ").concat(t.text,", linguistic info: ").concat(t.linguisticInfo?"yes":"no")),ir(t),$t(e))}},lr=[{code:"ru",name:"\u0420\u0443\u0441\u0441\u043a\u0438\u0439",flag:"\u{1f1f7}\u{1f1fa}",englishName:"Russian"},{code:"en",name:"English",flag:"\u{1f1ec}\u{1f1e7}",englishName:"English"},{code:"es",name:"Espa\xf1ol",flag:"\u{1f1ea}\u{1f1f8}",englishName:"Spanish"},{code:"fr",name:"Fran\xe7ais",flag:"\u{1f1eb}\u{1f1f7}",englishName:"French"},{code:"de",name:"Deutsch",flag:"\u{1f1e9}\u{1f1ea}",englishName:"German"},{code:"it",name:"Italiano",flag:"\u{1f1ee}\u{1f1f9}",englishName:"Italian"},{code:"pt",name:"Portugu\xeas",flag:"\u{1f1f5}\u{1f1f9}",englishName:"Portuguese"},{code:"ja",name:"\u65e5\u672c\u8a9e",flag:"\u{1f1ef}\u{1f1f5}",englishName:"Japanese"},{code:"ko",name:"\ud55c\uad6d\uc5b4",flag:"\u{1f1f0}\u{1f1f7}",englishName:"Korean"},{code:"zh",name:"\u4e2d\u6587",flag:"\u{1f1e8}\u{1f1f3}",englishName:"Chinese"},{code:"ar",name:"\u0627\u0644\u0639\u0631\u0628\u064a\u0629",flag:"\u{1f1e6}\u{1f1ea}",englishName:"Arabic"},{code:"hi",name:"\u0939\u093f\u0902\u0926\u0940",flag:"\u{1f1ee}\u{1f1f3}",englishName:"Hindi"},{code:"bn",name:"\u09ac\u09be\u0982\u09b2\u09be",flag:"\u{1f1e7}\u{1f1e9}",englishName:"Bengali"},{code:"tr",name:"T\xfcrk\xe7e",flag:"\u{1f1f9}\u{1f1f7}",englishName:"Turkish"},{code:"pl",name:"Polski",flag:"\u{1f1f5}\u{1f1f1}",englishName:"Polish"},{code:"nl",name:"Nederlands",flag:"\u{1f1f3}\u{1f1f1}",englishName:"Dutch"},{code:"cs",name:"\u010ce\u0161tina",flag:"\u{1f1e8}\u{1f1ff}",englishName:"Czech"},{code:"sv",name:"Svenska",flag:"\u{1f1f8}\u{1f1ea}",englishName:"Swedish"},{code:"vi",name:"Ti\u1ebfng Vi\u1ec7t",flag:"\u{1f1fb}\u{1f1f3}",englishName:"Vietnamese"},{code:"th",name:"\u0e20\u0e32\u0e29\u0e32\u0e44\u0e17\u0e22",flag:"\u{1f1f9}\u{1f1ed}",englishName:"Thai"},{code:"he",name:"\u05e2\u05b4\u05d1\u05b0\u05e8\u05b4\u05d9\u05ea",flag:"\u{1f1ee}\u{1f1f1}",englishName:"Hebrew"},{code:"id",name:"Bahasa Indonesia",flag:"\u{1f1ee}\u{1f1e9}",englishName:"Indonesian"},{code:"uk",name:"\u0423\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430",flag:"\u{1f1fa}\u{1f1e6}",englishName:"Ukrainian"},{code:"el",name:"\u0395\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ac",flag:"\u{1f1ec}\u{1f1f7}",englishName:"Greek"},{code:"ro",name:"Rom\xe2n\u0103",flag:"\u{1f1f7}\u{1f1f4}",englishName:"Romanian"},{code:"hu",name:"Magyar",flag:"\u{1f1ed}\u{1f1fa}",englishName:"Hungarian"},{code:"fi",name:"Suomi",flag:"\u{1f1eb}\u{1f1ee}",englishName:"Finnish"},{code:"da",name:"Dansk",flag:"\u{1f1e9}\u{1f1f0}",englishName:"Danish"},{code:"no",name:"Norsk",flag:"\u{1f1f3}\u{1f1f4}",englishName:"Norwegian"},{code:"sk",name:"Sloven\u010dina",flag:"\u{1f1f8}\u{1f1f0}",englishName:"Slovak"},{code:"lt",name:"Lietuvi\u0173",flag:"\u{1f1f1}\u{1f1f9}",englishName:"Lithuanian"},{code:"lv",name:"Latvie\u0161u",flag:"\u{1f1f1}\u{1f1fb}",englishName:"Latvian"},{code:"bg",name:"\u0411\u044a\u043b\u0433\u0430\u0440\u0441\u043a\u0438",flag:"\u{1f1e7}\u{1f1ec}",englishName:"Bulgarian"},{code:"hr",name:"Hrvatski",flag:"\u{1f1ed}\u{1f1f7}",englishName:"Croatian"},{code:"sr",name:"\u0421\u0440\u043f\u0441\u043a\u0438",flag:"\u{1f1f7}\u{1f1f8}",englishName:"Serbian"},{code:"et",name:"Eesti",flag:"\u{1f1ea}\u{1f1ea}",englishName:"Estonian"},{code:"sl",name:"Sloven\u0161\u010dina",flag:"\u{1f1f8}\u{1f1ee}",englishName:"Slovenian"}],cr=(0,r.useState)(!1),ur=cr[0],dr=cr[1],pr=(0,r.useState)(""),hr=pr[0],fr=pr[1],gr=(0,r.useMemo)((function(){if(!hr)return lr;var e=hr.toLowerCase();return lr.filter((function(t){return t.name.toLowerCase().includes(e)||t.englishName.toLowerCase().includes(e)||t.code.toLowerCase().includes(e)}))}),[hr]),mr=(0,r.useMemo)((function(){return lr.find((function(e){return e.code===x}))||lr[0]}),[x]),yr=function(){return ur?(0,a.jsx)("div",Mn({style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(2px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"16px"},onClick:function(){return dr(!1)}},{children:(0,a.jsxs)("div",Mn({style:{backgroundColor:"#FFFFFF",borderRadius:"12px",width:"90%",maxWidth:"360px",maxHeight:"80vh",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",overflow:"hidden",display:"flex",flexDirection:"column"},onClick:function(e){return e.stopPropagation()}},{children:[(0,a.jsxs)("div",Mn({style:{padding:"16px",borderBottom:"1px solid #E5E7EB",display:"flex",flexDirection:"column",gap:"12px"}},{children:[(0,a.jsxs)("div",Mn({style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},{children:[(0,a.jsx)("h3",Mn({style:{margin:0,fontSize:"16px",fontWeight:600,color:"#111827"}},{children:"Select Your Language"})),(0,a.jsx)("button",Mn({onClick:function(){return dr(!1)},style:{background:"none",border:"none",cursor:"pointer",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"6px"}},{children:(0,a.jsx)("svg",Mn({xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"#6B7280",viewBox:"0 0 16 16"},{children:(0,a.jsx)("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})}))}))]})),(0,a.jsxs)("div",Mn({style:{position:"relative",width:"100%"}},{children:[(0,a.jsx)("input",{type:"text",value:hr,onChange:function(e){return fr(e.target.value)},placeholder:"Search languages...",style:{width:"100%",padding:"10px 12px 10px 36px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#F9FAFB",fontSize:"14px",color:"#374151",outline:"none"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}}),(0,a.jsx)("svg",Mn({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"#9CA3AF",viewBox:"0 0 16 16",style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)"}},{children:(0,a.jsx)("path",{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"})})),hr&&(0,a.jsx)("button",Mn({onClick:function(){return fr("")},style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",backgroundColor:"#E5E7EB"}},{children:(0,a.jsx)("svg",Mn({xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"#6B7280",viewBox:"0 0 16 16"},{children:(0,a.jsx)("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})}))}))]})),(0,a.jsx)("p",Mn({style:{margin:0,fontSize:"12px",color:"#6B7280",lineHeight:1.5}},{children:"This will be used for both the interface language and translations. Your cards will be created in this language."}))]})),(0,a.jsx)("div",Mn({style:{overflowY:"auto",maxHeight:"calc(80vh - 135px)",padding:"8px 0"}},{children:0===gr.length?(0,a.jsxs)("div",Mn({style:{padding:"16px",textAlign:"center",color:"#6B7280",fontSize:"14px"}},{children:['No languages found matching "',hr,'"']})):gr.map((function(e){return(0,a.jsxs)("button",Mn({onClick:function(){s((0,Ve._W)(e.code)),dr(!1)},style:{display:"flex",alignItems:"center",width:"100%",padding:"12px 16px",backgroundColor:e.code===x?"#EFF6FF":"transparent",border:"none",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s"},onMouseOver:function(t){e.code!==x&&(t.currentTarget.style.backgroundColor="#F3F4F6")},onMouseOut:function(t){e.code!==x&&(t.currentTarget.style.backgroundColor="transparent")}},{children:[(0,a.jsx)("span",Mn({style:{fontSize:"22px",marginRight:"12px",width:"28px",textAlign:"center"}},{children:e.flag})),(0,a.jsxs)("div",Mn({style:{display:"flex",flexDirection:"column",alignItems:"flex-start"}},{children:[(0,a.jsx)("span",Mn({style:{color:e.code===x?"#2563EB":"#111827",fontWeight:e.code===x?"600":"normal",fontSize:"14px"}},{children:e.name})),e.englishName!==e.name&&(0,a.jsx)("span",Mn({style:{color:"#6B7280",fontSize:"12px"}},{children:e.englishName}))]})),e.code===x&&(0,a.jsx)("svg",Mn({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"#2563EB",viewBox:"0 0 16 16",style:{marginLeft:"auto"}},{children:(0,a.jsx)("path",{d:"M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"})}))]}),e.code)}))}))]}))})):(0,a.jsxs)("div",Mn({style:{position:"relative",width:"100%",display:"flex",flexDirection:"column",gap:"8px"}},{children:[(0,a.jsxs)("label",Mn({style:{color:"#111827",fontWeight:"600",fontSize:"14px",margin:0,display:"flex",alignItems:"center",gap:"6px"}},{children:["Your Language",(0,a.jsx)("span",Mn({style:{fontSize:"12px",color:"#6B7280",fontWeight:"normal",fontStyle:"italic"}},{children:"(translations)"}))]})),(0,a.jsxs)("button",Mn({onClick:function(){return dr(!0)},style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#F9FAFB",color:"#374151",fontSize:"14px",cursor:"pointer",transition:"all 0.2s ease",textAlign:"left"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="#F3F4F6"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="#F9FAFB"}},{children:[(0,a.jsxs)("span",Mn({style:{display:"flex",alignItems:"center",gap:"8px"}},{children:[(0,a.jsx)("span",Mn({style:{fontSize:"18px"}},{children:mr.flag})),(0,a.jsx)("span",{children:mr.name})]})),(0,a.jsx)("svg",Mn({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},{children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"})}))]}))]}))},vr=(0,r.useState)((function(){return localStorage.getItem("source_language")||""})),br=vr[0],xr=vr[1],wr=(0,r.useState)((function(){return localStorage.getItem("detected_language")||null})),Sr=wr[0],kr=wr[1],Cr=(0,r.useState)(!1),Er=Cr[0],Ar=Cr[1],Ir=(0,r.useState)(!1),Tr=Ir[0],Mr=Ir[1],Fr=(0,r.useState)(""),zr=Fr[0],_r=Fr[1],Rr=(0,r.useState)((function(){return"false"!==localStorage.getItem("auto_detect_language")})),jr=Rr[0],Br=Rr[1],Or=(0,r.useMemo)((function(){if(!zr)return lr;var e=zr.toLowerCase();return lr.filter((function(t){return t.name.toLowerCase().includes(e)||t.englishName.toLowerCase().includes(e)||t.code.toLowerCase().includes(e)}))}),[zr]),Nr=(0,r.useMemo)((function(){return br?lr.find((function(e){return e.code===br}))||null:Sr&&lr.find((function(e){return e.code===Sr}))||null}),[br,Sr]),Pr=(0,r.useCallback)((function(e){var t=e.trim().toLowerCase();if(/[\u0430-\u044f\u0451]/i.test(t))return"ru";if(/^[a-z\s\.,!?\-'"]+$/i.test(t)){var n=["the","and","is","in","to","of","a","for","with","on","at","by","from","this","that","it","he","she","they","we","you","was","were","are","have","has","had","can","will","would","could","should"],r=t.split(/\s+/);if(r.filter((function(e){return n.includes(e.replace(/[^\w]/g,""))})).length>0||1===r.length)return"en"}return/[\xf1\xe1\xe9\xed\xf3\xfa\xfc]/i.test(t)?"es":/[\xe0\xe2\xe4\xe9\xe8\xea\xeb\xef\xee\xf4\xf6\xf9\xfb\xfc\xff\xe7]/i.test(t)?"fr":/[\xe4\xf6\xfc\xdf]/i.test(t)?"de":/[\xe0\xe8\xe9\xec\xed\xee\xf2\xf3\xf9]/i.test(t)?"it":null}),[]),Lr=(0,r.useCallback)((function(e){var t=e.trim().toLowerCase(),n=t.replace(/[\u0430-\u044f\u0451]/g,"C").replace(/[a-z]/g,"L").replace(/[0-9]/g,"N").replace(/\s+/g,"S").replace(/[^\w\s]/g,"P").slice(0,50);return"lang_pattern_".concat(n,"_").concat(t.length<20?t:t.slice(0,20))}),[]),Dr=(0,r.useCallback)((function(e){return Fn(void 0,void 0,void 0,(function(){var t,n,r,o,a,i,s,c,u,d,p,h,f,g,m,y,v,b,x,w,S,k,C,E,A,I,T,M,F,z,_,R,j,B,O,N,P;return zn(this,(function(L){switch(L.label){case 0:if(console.log("=== LANGUAGE DETECTION START ==="),console.log("Input text:",e.substring(0,100)+(e.length>100?"...":"")),console.log("Text length:",e.length),!e||e.trim().length<2)return console.log("Text too short for language detection"),[2,null];if(t=null,n=function(n,r){var o=(n||"").trim().toLowerCase();if(o){Sr!==o&&(console.log("Setting detected language (".concat(r,"):"),o),kr(o)),localStorage.setItem("detected_language",o);var a=Lr(e);localStorage.setItem(a,o),l(o),t=o}},r=Pr(e))return console.log("Language detected offline:",r),n(r,"offline detection"),[2,t];if(o=Lr(e),(a=localStorage.getItem(o))&&Sr!==a)return console.log("Using smart cached language detection result:",a),n(a,"smart cache"),[2,t];if(Sr&&a===Sr)return console.log("Language already detected for this text:",Sr),t=Sr,[2,Sr];if((0,Ue.isQuotaExceededCached)())return console.log("Language detection skipped due to cached quota error"),(0,Ue.shouldShowQuotaNotification)()&&(p=(0,Ue.getCachedQuotaError)())&&(Ge(p),(0,Ue.markQuotaNotificationShown)()),[2,null!=Sr?Sr:t];if(i=localStorage.getItem("last_language_api_call"),s=Date.now(),i&&s-parseInt(i)<2e3)return console.log("Language detection API call skipped - too frequent calls"),[2,null!=Sr?Sr:t];console.log("Making API call for language detection..."),localStorage.setItem("last_language_api_call",s.toString()),Ar(!0),L.label=1;case 1:if(L.trys.push([1,14,15,16]),!(he===Rt.l.OpenAI&&ue||he===Rt.l.Groq&&de))return[3,12];if(he!==Rt.l.OpenAI)return[3,6];if((0,Ue.isQuotaExceededCached)()){if(console.log("OpenAI language detection skipped due to cached quota error"),(0,Ue.shouldShowQuotaNotification)()&&(p=(0,Ue.getCachedQuotaError)()))throw new Error(p);return[2,null!=Sr?Sr:t]}L.label=2;case 2:return L.trys.push([2,4,,5]),[4,Ke.chat.completions.create({model:"gpt-5-nano",messages:[{role:"system",content:"You are a language detection assistant. Respond only with the ISO 639-1 language code."},{role:"user",content:"Detect the language of this text and respond only with the ISO 639-1 language code (e.g. 'en', 'ru', 'fr', etc.): \"".concat(e,'"')}]})];case 3:return u=L.sent(),c=null===(F=u.choices[0].message.content)||void 0===F?void 0:F.trim().toLowerCase(),console.log("Language detected via OpenAI:",c),[3,5];case 4:throw(d=L.sent())instanceof Error&&((v=d.message).includes("quota")||v.includes("insufficient_quota")||v.includes("billing")||v.includes("exceeded")||v.includes("429"))&&((0,Ue.cacheQuotaExceededError)(v),console.log("Quota error detected and cached in OpenAI language detection")),d;case 5:return[3,11];case 6:if(he!==Rt.l.Groq)return[3,11];if((0,Ue.isQuotaExceededCached)()){if(console.log("Groq language detection skipped due to cached quota error"),(0,Ue.shouldShowQuotaNotification)()&&(p=(0,Ue.getCachedQuotaError)()))throw new Error(p);return[2,null!=Sr?Sr:t]}return[4,fetch("https://api.groq.com/openai/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(de)},body:JSON.stringify({model:pe,messages:[{role:"system",content:"You are a language detection assistant. Respond only with the ISO 639-1 language code."},{role:"user",content:"Detect the language of this text and respond only with the ISO 639-1 language code (e.g. 'en', 'ru', 'fr', etc.): \"".concat(e,'"')}]})})];case 7:return(h=L.sent()).ok?[3,9]:[4,h.json()];case 8:if(f=L.sent(),v="Groq API error: ".concat(h.status," ").concat(h.statusText," - ").concat(JSON.stringify(f)),429===h.status||f&&((null===(_=null===(z=f.error)||void 0===z?void 0:z.includes)||void 0===_?void 0:_.call(z,"quota"))||(null===(j=null===(R=f.error)||void 0===R?void 0:R.includes)||void 0===j?void 0:j.call(R,"limit"))))throw new Error("API rate limit exceeded. Please try again in a few minutes.");throw new Error(v);case 9:return[4,h.json()];case 10:g=L.sent(),c=null===(P=null===(N=null===(O=null===(B=g.choices)||void 0===B?void 0:B[0])||void 0===O?void 0:O.message)||void 0===N?void 0:N.content)||void 0===P?void 0:P.trim().toLowerCase(),console.log("Language detected via Groq:",c),L.label=11;case 11:return c&&lr.some((function(e){return e.code===c}))?(console.log("Language successfully detected:",c),n(c,"API detection"),[2,t]):(console.log("Invalid or unrecognized language code:",c),[3,13]);case 12:if(m=e.trim().toLowerCase().slice(0,100),w=/[\u0430-\u044f\u0451]/gi,S=/[a-z]/gi,k=/[\u4e00-\u9fff]/gi,C=/[\u3040-\u309f\u30a0-\u30ff]/gi,E=/[\uac00-\ud7af]/gi,A=/[\u0600-\u06ff]/gi,I=/[\xe1\xe9\xed\xf3\xfa\xfc\xf1\xbf\xa1]/gi,T=["hasta","desde","como","pero","porque","adonde","quien","para","por"].some((function(e){return m===e||m.startsWith(e+" ")||m.includes(" "+e+" ")})),M="",w.test(m)?(console.log("Detected Cyrillic script - setting Russian"),M="ru"):k.test(m)?(console.log("Detected Chinese characters"),M="zh"):C.test(m)?(console.log("Detected Japanese characters"),M="ja"):E.test(m)?(console.log("Detected Korean characters"),M="ko"):A.test(m)?(console.log("Detected Arabic script"),M="ar"):I.test(m)||T?(console.log("Detected Spanish text or common Spanish word"),M="es"):S.test(m)&&(console.log("Detected Latin script, defaulting to English"),M="en"),M)return console.log("Language detected using fallback method:",M),n(M,"fallback detection"),[2,t];L.label=13;case 13:return[3,16];case 14:return y=L.sent(),console.error("Error detecting language:",y),y instanceof Error&&Xe(y)?(console.error("Quota error detected in language detection:",y.message),Ge(y.message),(0,Ue.markQuotaNotificationShown)(),[2,null!=Sr?Sr:t]):(v=y instanceof Error?y.message:String(y),(v.includes("401")||v.includes("Unauthorized")||v.includes("Authentication")||v.includes("Invalid API key")||v.includes("Incorrect API key")||v.includes("API key is missing"))&&(console.warn("API key error detected, disabling auto-detection to prevent infinite retries"),Br(!1),localStorage.setItem("auto_detect_language","false"),b=he===Rt.l.OpenAI?"OpenAI":he===Rt.l.Groq?"Groq":"AI","function"==typeof Ge&&Ge("Language detection failed: Invalid ".concat(b," API key. Please check your API key in settings."),"error"),x=e.trim().toLowerCase().slice(0,100),w=/[\u0430-\u044f\u0451]/gi,S=/[a-z]/gi,k=/[\u4e00-\u9fff]/gi,C=/[\u3040-\u309f\u30a0-\u30ff]/gi,E=/[\uac00-\ud7af]/gi,A=/[\u0600-\u06ff]/gi,I=/[\xe1\xe9\xed\xf3\xfa\xfc\xf1\xbf\xa1]/gi,T=["hasta","desde","como","pero","porque","adonde","quien","para","por"].some((function(e){return x===e||x.startsWith(e+" ")||x.includes(" "+e+" ")})),M="",w.test(x)?M="ru":k.test(x)?M="zh":C.test(x)?M="ja":E.test(x)?M="ko":A.test(x)?M="ar":I.test(x)||T?M="es":S.test(x)&&(M="en"),M)?(console.log("Language detected using fallback method in error handler:",M),n(M,"fallback method in error handler"),[2,t]):[3,16]);case 15:return Ar(!1),console.log("=== LANGUAGE DETECTION END ==="),[7];case 16:return[2,t]}}))}))}),[Ke,ue,he,de,pe,Pr,Lr,l,Sr,Ge,Ue.shouldShowQuotaNotification,Ue.getCachedQuotaError,Ue.markQuotaNotificationShown,Ue.cacheQuotaExceededError,Br,lr]),$r=function(){var e=!jr;Br(e),localStorage.setItem("auto_detect_language",e?"true":"false"),jr?Sr&&l(Sr):(l(""),kr(null),localStorage.removeItem("detected_language"))},qr=function(){return Tr?(0,a.jsx)("div",Mn({style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(2px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"16px"},onClick:function(){return Mr(!1)}},{children:(0,a.jsxs)("div",Mn({style:{backgroundColor:"#FFFFFF",borderRadius:"12px",width:"90%",maxWidth:"360px",maxHeight:"80vh",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",overflow:"hidden",display:"flex",flexDirection:"column"},onClick:function(e){return e.stopPropagation()}},{children:[(0,a.jsxs)("div",Mn({style:{padding:"16px",borderBottom:"1px solid #E5E7EB",display:"flex",flexDirection:"column",gap:"12px"}},{children:[(0,a.jsxs)("div",Mn({style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},{children:[(0,a.jsxs)("h3",Mn({style:{margin:0,fontSize:"16px",fontWeight:600,color:"#111827",display:"flex",alignItems:"center",gap:"8px"}},{children:[(0,a.jsx)(yt,{color:"#6366F1",size:18}),(0,a.jsx)("span",{children:"Select Source Language"})]})),(0,a.jsx)("button",Mn({onClick:function(){return Mr(!1)},style:{background:"none",border:"none",cursor:"pointer",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"6px"}},{children:(0,a.jsx)("svg",Mn({xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"#6B7280",viewBox:"0 0 16 16"},{children:(0,a.jsx)("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})}))}))]})),(0,a.jsxs)("div",Mn({style:{position:"relative",width:"100%"}},{children:[(0,a.jsx)("input",{type:"text",value:zr,onChange:function(e){return _r(e.target.value)},placeholder:"Search languages...",style:{width:"100%",padding:"10px 12px 10px 36px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#F9FAFB",fontSize:"14px",color:"#374151",outline:"none"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}}),(0,a.jsx)("svg",Mn({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"#9CA3AF",viewBox:"0 0 16 16",style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)"}},{children:(0,a.jsx)("path",{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"})})),zr&&(0,a.jsx)("button",Mn({onClick:function(){return _r("")},style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",backgroundColor:"#E5E7EB"}},{children:(0,a.jsx)("svg",Mn({xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"#6B7280",viewBox:"0 0 16 16"},{children:(0,a.jsx)("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})}))}))]})),(0,a.jsx)("p",Mn({style:{margin:0,fontSize:"12px",color:"#6B7280",lineHeight:1.5}},{children:"Select the language of your text. This helps generate more accurate translations and examples."}))]})),(0,a.jsx)("div",Mn({style:{overflowY:"auto",maxHeight:"calc(80vh - 135px)",padding:"8px 0"}},{children:0===Or.length?(0,a.jsxs)("div",Mn({style:{padding:"16px",textAlign:"center",color:"#6B7280",fontSize:"14px"}},{children:['No languages found matching "',zr,'"']})):Or.map((function(e){return(0,a.jsxs)("button",Mn({onClick:function(){xr(e.code),Mr(!1),Br(!1)},style:{display:"flex",alignItems:"center",width:"100%",padding:"12px 16px",backgroundColor:e.code===br?"#EFF6FF":"transparent",border:"none",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s"},onMouseOver:function(t){e.code!==br&&(t.currentTarget.style.backgroundColor="#F3F4F6")},onMouseOut:function(t){e.code!==br&&(t.currentTarget.style.backgroundColor="transparent")}},{children:[(0,a.jsx)("span",Mn({style:{fontSize:"22px",marginRight:"12px",width:"28px",textAlign:"center"}},{children:e.flag})),(0,a.jsxs)("div",Mn({style:{display:"flex",flexDirection:"column",alignItems:"flex-start"}},{children:[(0,a.jsx)("span",Mn({style:{color:e.code===br?"#2563EB":"#111827",fontWeight:e.code===br?"600":"normal",fontSize:"14px"}},{children:e.name})),e.englishName!==e.name&&(0,a.jsx)("span",Mn({style:{color:"#6B7280",fontSize:"12px"}},{children:e.englishName}))]})),e.code===br&&(0,a.jsx)("svg",Mn({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"#2563EB",viewBox:"0 0 16 16",style:{marginLeft:"auto"}},{children:(0,a.jsx)("path",{d:"M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"})}))]}),e.code)}))}))]}))})):(0,a.jsxs)("div",Mn({style:{position:"relative",width:"100%",display:"flex",flexDirection:"column",gap:"8px"}},{children:[(0,a.jsxs)("div",Mn({style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"}},{children:[(0,a.jsxs)("label",Mn({style:{color:"#111827",fontWeight:"600",fontSize:"14px",margin:0,display:"flex",alignItems:"center",gap:"6px"}},{children:[(0,a.jsx)("span",{children:"Source Language"}),(0,a.jsx)("span",Mn({style:{fontSize:"12px",color:"#6B7280",fontWeight:"normal",fontStyle:"italic"}},{children:"(of your text)"}))]})),(0,a.jsxs)("div",Mn({style:{display:"flex",alignItems:"center",gap:"8px"}},{children:[(0,a.jsx)("span",Mn({style:{fontSize:"12px",color:jr?"#10B981":"#9CA3AF",transition:"color 0.2s ease"}},{children:"Auto"})),(0,a.jsx)("button",Mn({onClick:$r,style:{width:"36px",height:"20px",backgroundColor:jr?"#10B981":"#E5E7EB",border:"none",borderRadius:"10px",position:"relative",cursor:"pointer",transition:"background-color 0.2s ease"}},{children:(0,a.jsx)("span",{style:{position:"absolute",width:"16px",height:"16px",backgroundColor:"white",borderRadius:"50%",top:"2px",left:jr?"18px":"2px",transition:"left 0.2s ease",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.1)"}})}))]}))]})),(0,a.jsxs)("button",Mn({onClick:function(){return Mr(!0)},disabled:jr,style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:jr?"#F3F4F6":"#F9FAFB",color:"#374151",fontSize:"14px",cursor:jr?"not-allowed":"pointer",opacity:jr?.7:1,transition:"all 0.2s ease",textAlign:"left"},onMouseOver:function(e){return!jr&&(e.currentTarget.style.backgroundColor="#F3F4F6")},onMouseOut:function(e){return!jr&&(e.currentTarget.style.backgroundColor="#F9FAFB")}},{children:[(0,a.jsx)("span",Mn({style:{display:"flex",alignItems:"center",gap:"8px"}},{children:Er?(0,a.jsx)(Ft,{type:"spinner",size:"small",inline:!0,color:"#6B7280"}):Nr?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",Mn({style:{fontSize:"18px"}},{children:Nr.flag})),(0,a.jsx)("span",{children:Nr.name}),jr&&(0,a.jsxs)("span",Mn({style:{fontSize:"11px",color:"#10B981",backgroundColor:"#ECFDF5",padding:"2px 6px",borderRadius:"4px",marginLeft:"4px",display:"flex",alignItems:"center",gap:"3px"}},{children:[(0,a.jsx)(Ze,{size:10}),(0,a.jsx)("span",{children:"Detected"})]}))]}):(0,a.jsx)("span",Mn({style:{color:"#9CA3AF"}},{children:jr?"Detecting language...":"Select source language"}))})),!jr&&(0,a.jsx)("svg",Mn({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},{children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"})}))]})),(0,a.jsxs)("div",Mn({style:{display:"flex",alignItems:"center",gap:"8px",padding:"6px 8px",backgroundColor:"#F3F4F6",borderRadius:"6px",marginTop:"4px"}},{children:[(0,a.jsxs)("div",Mn({style:{display:"flex",alignItems:"center",gap:"4px"}},{children:[(0,a.jsx)("span",Mn({style:{fontSize:"14px"}},{children:Nr?Nr.flag:"\u{1f310}"})),(0,a.jsx)(ut,{size:12,color:"#6B7280"}),(0,a.jsx)("span",Mn({style:{fontSize:"14px"}},{children:mr.flag}))]})),(0,a.jsxs)("span",Mn({style:{fontSize:"12px",color:"#4B5563"}},{children:["Translating ",Nr?"from ".concat(Nr.englishName):""," to ",mr.englishName]})),jr&&(0,a.jsx)("button",Mn({onClick:function(){if((0,Ue.isQuotaExceededCached)()){if(console.log("Language detection reset skipped due to cached quota error"),(0,Ue.shouldShowQuotaNotification)()){var e=(0,Ue.getCachedQuotaError)();e&&(Ge(e),(0,Ue.markQuotaNotificationShown)())}}else c&&(console.log("Manually triggering language detection for:",c.substring(0,50)+"..."),Dr(c))},title:"Reset language detection",style:{marginLeft:"auto",background:"none",border:"none",display:"flex",padding:"2px",cursor:"pointer",color:"#6B7280"}},{children:(0,a.jsxs)("svg",Mn({xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",fill:"currentColor",viewBox:"0 0 16 16"},{children:[(0,a.jsx)("path",{d:"M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"}),(0,a.jsx)("path",{d:"M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"})]}))}))]}))]}))},Ur=function(e){s(Oe(e)),Nn&&J(!0)};(0,r.useEffect)((function(){var e=localStorage.getItem("source_language"),t=localStorage.getItem("detected_language"),n=localStorage.getItem("auto_detect_language");console.log("Initializing language settings from localStorage:",{savedSourceLanguage:e,savedDetectedLanguage:t,savedAutoDetect:n}),e?l(e):t&&"false"!==n&&l(t),"false"===n&&Br(!1)}),[]);var Vr,Hr,Wr,Gr=(0,r.useCallback)((function(e){return Fn(void 0,void 0,void 0,(function(){var t,n,r,o;return zn(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),An?(t='Return only the native name of the language with ISO 639-1 code "'.concat(e,'".\nExamples: \n- "en" -> "English"\n- "ru" -> "\u0420\u0443\u0441\u0441\u043a\u0438\u0439" \n- "es" -> "Espa\xf1ol"\n- "fr" -> "Fran\xe7ais"\n- "de" -> "Deutsch"\n- "zh" -> "\u4e2d\u6587"\n- "ja" -> "\u65e5\u672c\u8a9e"\n- "ar" -> "\u0627\u0644\u0639\u0631\u0628\u064a\u0629"\n\nRespond with ONLY the native language name, no additional text.'),[4,En.createChatCompletion(An,[{role:"user",content:t}])]):[2,e.toUpperCase()];case 1:return(n=a.sent())&&n.content?(r=n.content.trim(),localStorage.setItem("language_name_".concat(e),r),[2,r]):[2,e.toUpperCase()];case 2:return o=a.sent(),console.error("Error getting language name from AI:",o),[2,e.toUpperCase()];case 3:return[2]}}))}))}),[An,En]),Yr=(0,r.useCallback)((function(e){return Fn(void 0,void 0,void 0,(function(){var t;return zn(this,(function(n){switch(n.label){case 0:return(t=localStorage.getItem("language_name_".concat(e)))?[2,t]:[4,Gr(e)];case 1:return[2,n.sent()]}}))}))}),[Gr]),Xr=(0,r.useCallback)((function(e){return Fn(void 0,void 0,void 0,(function(){var t,n,r,o,a,i;return zn(this,(function(s){switch(s.label){case 0:if(!e||0===e.trim().length)return[2,{shouldGenerate:!1,reason:"No text provided"}];s.label=1;case 1:return s.trys.push([1,3,,4]),t='Analyze this word/phrase and determine if a visual image would be helpful for language learning: "'.concat(e,'"\n\nConsider these criteria:\n- Concrete objects, animals, places, foods, tools, vehicles = YES\n- Abstract concepts, emotions, actions, grammar terms = NO\n- People, professions, activities that can be visualized = YES\n- Numbers, prepositions, conjunctions, abstract ideas = NO\n\nRespond with ONLY "YES" or "NO" followed by a brief reason (max 10 words).\nFormat: "YES - concrete object that can be visualized" or "NO - abstract concept"'),[4,En.createChatCompletion(An,[{role:"user",content:t}])];case 2:return(n=s.sent())&&n.content?(r=n.content.trim(),o=r.toUpperCase().startsWith("YES"),a=r.includes(" - ")?r.split(" - ")[1]:"AI analysis",[2,{shouldGenerate:o,reason:a}]):[2,{shouldGenerate:!1,reason:"AI analysis failed"}];case 3:return i=s.sent(),console.error("Error analyzing text for image generation:",i),[2,{shouldGenerate:!1,reason:"Analysis error"}];case 4:return[2]}}))}))}),[En,An]),Kr=function(e){s((0,Ve.BE)(e)),"smart"===e||"always"===e?(console.log("\u{1f527} Automatically enabling shouldGenerateImage for ".concat(e," mode")),s((0,Ve.yo)(!0)),setTimeout((function(){console.log("\u{1f50d} Verification: shouldGenerateImage should now be true for ".concat(e," mode"))}),100)):"off"===e&&(console.log("\u{1f527} Disabling shouldGenerateImage for off mode"),s((0,Ve.yo)(!1))),"always"===e&&c&&Wn()&&qn(),"off"===e&&(s(Fe(null)),s(ze(null)))},Qr=(0,r.useCallback)((function(e,t,n){return Fn(void 0,void 0,void 0,(function(){var r,a,i,l,c,u,d,p,h,f,g,m,y,v,b,x,w,k;return zn(this,(function(C){switch(C.label){case 0:if(!t.trim())return Ge("Please enter some text to create a card from","error"),[2];C.label=1;case 1:return C.trys.push([1,9,10,11]),r=n||e.prompt,a="".concat(r,'\n\nText: "').concat(t,'"\n\nProvide a clear, educational response that would work well as flashcard content. Be concise but informative.'),[4,En.translateText(a,"en")];case 2:if(!(i=C.sent()))throw new Error("Failed to generate card content");if(l=e.name,c=i,"qa"===e.id&&i.includes("Q:")&&i.includes("A:")?(u=i.indexOf("Q:"),d=i.indexOf("A:"),-1!==u&&-1!==d&&d>u&&(l=i.substring(u+2,d).trim(),c=i.substring(d+2).trim())):"definition"===e.id?(p=i.split("\n").filter((function(e){return e.trim()}))).length>0&&((h=p[0]).includes(":")?(f=h.split(":"),l=f[0].trim(),c=f.slice(1).join(":").trim(),p.length>1&&(c+="\n"+p.slice(1).join("\n"))):(g=t.split(" ").filter((function(e){return e.length>3})),l=g.slice(0,3).join(" ")+(g.length>3?"...":""),c=i)):(m=t.length>50?t.substring(0,50)+"...":t,l="".concat(e.name,": ").concat(m),c=i),y=null,!fe||"off"===ge||!Wn())return[3,8];C.label=3;case 3:return C.trys.push([3,7,,8]),[4,En.getDescriptionImage(An,t,S)];case 4:return(v=C.sent())?[4,null===(k=En.getImageUrl)||void 0===k?void 0:k.call(En,An,v)]:[3,6];case 5:(b=C.sent())&&(y=b),C.label=6;case 6:return[3,8];case 7:return x=C.sent(),console.warn("Failed to generate image:",x),[3,8];case 8:return s(Re(l)),s(_e(c)),s(Ie(t)),y&&s(ze(y)),o(!0),[3,11];case 9:return w=C.sent(),console.error("Error generating general card:",w),Ge("Failed to generate card: ".concat(w instanceof Error?w.message:"Unknown error"),"error"),[3,11];case 10:return[7];case 11:return[2]}}))}))}),[En,Ge,s,fe,ge,Wn,S]),Jr=((0,r.useCallback)((function(e){Wt(e),c.trim()&&Qr(e,c),Yt(!1)}),[c,Qr]),(0,r.useCallback)((function(){return Fn(void 0,void 0,void 0,(function(){return zn(this,(function(e){switch(e.label){case 0:return Kt.trim()&&c.trim()?[4,Qr({id:"custom",name:"Custom",description:"Custom prompt",icon:"\u26a1",prompt:Kt},c,Kt)]:(Ge("Please enter both text and a custom prompt","error"),[2]);case 1:return e.sent(),Qt(""),[2]}}))}))}),[Kt,c,Qr,Ge]),(0,r.useCallback)((function(){return Fn(void 0,void 0,void 0,(function(){var e,t,n,r,o,a,i,s,l,u;return zn(this,(function(d){switch(d.label){case 0:if(!c.trim())return Ge("Please enter or select text to create cards","error"),[2];kn.current=new AbortController,e=kn.current.signal,R(!0),d.label=1;case 1:if(d.trys.push([1,7,8,9]),e.aborted)throw new Error("Generation cancelled by user");t=In(En,An),n=void 0,d.label=2;case 2:return d.trys.push([2,4,,5]),r=window.getSelection(),o=void 0,r&&r.rangeCount>0&&(a=r.getRangeAt(0),o=a.commonAncestorContainer.nodeType===Node.ELEMENT_NODE?a.commonAncestorContainer:a.commonAncestorContainer.parentElement||void 0),[4,Tn.PageContentExtractor.extractPageContentAsync(c,o)];case 3:return n=d.sent(),console.log("\u{1f4c4} Extracted page content:",{images:n.pageImages.length,formulas:n.formulas.length,codeBlocks:n.codeBlocks.length,links:n.links.length,metadata:n.metadata,selectedText:c.substring(0,100)+"..."}),n.pageImages.forEach((function(e,t){console.log("\u{1f5bc}\ufe0f \u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 ".concat(t,":"),{src:e.src,alt:e.alt,relevanceScore:e.relevanceScore,isRelevant:e.relevanceScore>.3,hasBase64:!!e.base64})})),[3,5];case 4:return i=d.sent(),console.warn("Failed to extract page content, proceeding without multimedia:",i),n=void 0,[3,5];case 5:return[4,t.createCardsFromTextFast(c,n,e)];case 6:return s=d.sent(),e.aborted?(console.log("AI card creation was cancelled by user"),[2]):(console.log("\u{1f389} AI Agents created ".concat(s.length," cards successfully")),s.forEach((function(e,t){var n;console.log("\u{1f0cf} \u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 ".concat(t,":"),{front:e.front,backPreview:e.back.substring(0,200)+"...",hasAttachedImages:!!e.attachedImages&&e.attachedImages.length>0,attachedImagesCount:(null===(n=e.attachedImages)||void 0===n?void 0:n.length)||0,multimedia:e.multimedia,hasImageInBack:e.back.includes("[IMAGE:")||e.back.includes("!["),hasFormulaInBack:e.back.includes("[FORMULA:")||e.back.includes("$$"),hasCodeInBack:e.back.includes("[CODE:")||e.back.includes("```")}),0===t&&console.log("\u{1f0cf} \u041f\u043e\u043b\u043d\u044b\u0439 back \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 0:",e.back)})),en(s),pn(0),sn(!0),[3,9]);case 7:return l=d.sent(),e.aborted?(console.log("AI card creation was cancelled by user"),[2]):(console.error("\u274c Error in AI agent card creation:",l),u=l instanceof Error?l.message:"Unknown error",Ge("Card creation error: ".concat(u),"error"),[3,9]);case 8:return console.log("\u{1f3af} Main card creation function finally block reached"),setTimeout((function(){console.log("\u23f3 Checking for pending operations before hiding loader...");var e=(0,on.cr)(),t=e.getStats(),n=t.inProgress>0;console.log("\u{1f4ca} Tracker stats:",t),console.log("\u{1f504} Has pending requests:",n);var r=nt||B||P;console.log("\u{1f3e0} Local loading states:",{isProcessingCustomInstruction:nt,loadingNewImage:B,loadingNewExamples:P,hasLocalOperations:r}),n||r?(console.log("\u23f8\ufe0f Keeping loader visible - operations still running"),setTimeout((function(){console.log("\u23f3 Second check after additional delay..."),e.getStats().inProgress>0||nt||B||P?console.log("\u23f8\ufe0f Still has pending operations - keeping loader"):(console.log("\u2705 Second check passed - hiding loader"),R(!1),H(null),Y({completed:0,total:0}))}),2e3)):(console.log("\u2705 No pending operations - hiding loader"),R(!1),H(null),Y({completed:0,total:0}))}),1500),kn.current=null,[7];case 9:return[2]}}))}))}),[c,En,An,Ge])),Zr=function(){sn(!1),en([]),pn(0),gn(new Set),Sn("")},eo=function(){return Fn(void 0,void 0,void 0,(function(){var e,t,n,r,o,a;return zn(this,(function(i){switch(i.label){case 0:q(!0),i.label=1;case 1:return i.trys.push([1,3,4,5]),(e=Zt[un])?[4,F(null!==(o=e.image)&&void 0!==o?o:null,null!==(a=e.imageUrl)&&void 0!==a?a:null)]:(Ge("No card to save","error"),[2]);case 2:return t=i.sent(),n=Mn(Mn({},e),{image:t.image,imageUrl:t.imageUrl}),s(Ee(n)),gn((function(e){return new Set(e).add(un)})),[3,5];case 3:return r=i.sent(),console.error("Error saving current card:",r),Ge("Error saving card","error"),[3,5];case 4:return q(!1),[7];case 5:return[2]}}))}))},to=m((function(e){return e.cards.isGeneratingCard}));return(0,a.jsxs)("div",Mn({style:{display:"flex",flexDirection:"column",flex:1,width:"100%",height:"100%",position:"relative"}},{children:[_&&(0,a.jsxs)("div",Mn({className:"loading-overlay",style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.9)",backdropFilter:"blur(4px)",zIndex:10,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"20px",padding:"0 20px",borderRadius:"12px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)"}},{children:[(0,a.jsxs)("div",Mn({style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"12px"}},{children:[(0,a.jsx)(Ft,{type:"spinner",size:"large",color:(null==V?void 0:V.color)||"#3B82F6"}),V&&(0,a.jsx)("div",Mn({style:{fontSize:"20px",opacity:.8}},{children:V.icon}))]})),(0,a.jsxs)("div",Mn({style:{textAlign:"center",color:"#374151",maxWidth:"400px"}},{children:[(0,a.jsx)("div",Mn({style:{fontSize:"18px",fontWeight:"600",marginBottom:"8px",color:(null==V?void 0:V.color)||"#1f2937"}},{children:(null==V?void 0:V.currentStepTitle)||(null==V?void 0:V.title)||"Starting..."})),(0,a.jsx)("div",Mn({style:{fontSize:"14px",color:"#6b7280",lineHeight:"1.5"}},{children:(null==V?void 0:V.currentStepSubtitle)||(null==V?void 0:V.subtitle)||"Preparing your request..."}))]})),(0,a.jsx)("div",Mn({style:{width:"280px",height:"8px",backgroundColor:"#f3f4f6",borderRadius:"4px",overflow:"hidden",marginTop:"12px",boxShadow:"inset 0 1px 2px rgba(0, 0, 0, 0.1)"}},{children:(0,a.jsx)("div",Mn({style:{height:"100%",width:"".concat(G.total>0?Math.max(5,G.completed/G.total*100):15,"%"),background:"linear-gradient(90deg, ".concat((null==V?void 0:V.color)||"#3B82F6"," 0%, ").concat((null==V?void 0:V.color)||"#3B82F6","dd 50%, ").concat((null==V?void 0:V.color)||"#3B82F6"," 100%)"),borderRadius:"4px",transition:"width 0.6s ease-out, background 0.3s ease-in-out",boxShadow:"0 0 10px ".concat((null==V?void 0:V.color)||"#3B82F6","40"),position:"relative",overflow:"hidden"}},{children:(0,a.jsx)("div",{style:{position:"absolute",top:0,left:"-100%",width:"100%",height:"100%",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent)",animation:"shimmer 2s infinite"}})}))})),(0,a.jsxs)("div",Mn({style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",marginTop:"16px",padding:"8px 16px",backgroundColor:"rgba(255, 255, 255, 0.1)",borderRadius:"20px",border:"1px solid ".concat((null==V?void 0:V.color)||"#3B82F6","20"),boxShadow:"0 0 15px ".concat((null==V?void 0:V.color)||"#3B82F6","20")}},{children:[(0,a.jsx)(ot,{style:{color:(null==V?void 0:V.color)||"#3B82F6",fontSize:"14px",animation:"pulse 2s ease-in-out infinite"}}),(0,a.jsx)("span",Mn({style:{fontSize:"16px",fontWeight:"600",color:(null==V?void 0:V.color)||"#3B82F6",fontFamily:"monospace",letterSpacing:"1px"}},{children:(Vr=ee,Hr=Math.floor(Vr/60),Wr=Vr%60,"".concat(Hr,":").concat(Wr.toString().padStart(2,"0")))}))]})),(0,a.jsxs)("button",Mn({onClick:Zn,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",backgroundColor:"#F3F4F6",color:"#4B5563",border:"1px solid #E5E7EB",borderRadius:"6px",padding:"10px 16px",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",marginTop:"10px"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#E5E7EB",e.currentTarget.style.color="#374151"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.color="#4B5563"},title:"Cancel card generation"},{children:[(0,a.jsx)(It,{}),"Cancel Generation"]}))]})),Tt&&(0,a.jsxs)("div",Mn({style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.8)",zIndex:5,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"20px",padding:"0 20px"}},{children:[(0,a.jsx)(Ft,{type:"spinner",size:"large",color:"#3B82F6",text:"Analyzing selected text..."}),(0,a.jsxs)("button",Mn({onClick:function(){return Mt(!1)},style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",backgroundColor:"#F3F4F6",color:"#4B5563",border:"1px solid #E5E7EB",borderRadius:"6px",padding:"10px 16px",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",marginTop:"10px"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#E5E7EB",e.currentTarget.style.color="#374151"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.color="#4B5563"},title:"Cancel text analysis"},{children:[(0,a.jsx)(It,{}),"Cancel Analysis"]}))]})),(0,a.jsx)("div",Mn({style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",gap:"12px",width:"100%",padding:"12px",paddingTop:"16px",height:"100%",overflowY:"auto",overflowX:"hidden",backgroundColor:"#ffffff",paddingBottom:"16px",boxSizing:"border-box"}},{children:(0,a.jsxs)("div",Mn({style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"12px",width:"100%",maxWidth:"320px"}},{children:[k===X.d.LanguageLearning&&(0,a.jsxs)("div",Mn({style:{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%",gap:"8px"}},{children:[yr(),qr(),(0,a.jsxs)("div",Mn({style:{display:"flex",flexDirection:"column",width:"100%",gap:"8px",marginTop:"4px"}},{children:[(0,a.jsx)("label",Mn({style:{color:"#111827",fontWeight:"600",fontSize:"14px",margin:0}},{children:"Image Generation:"})),(0,a.jsxs)("div",Mn({style:{display:"flex",width:"100%",backgroundColor:"#F3F4F6",borderRadius:"8px",padding:"4px",gap:"2px",opacity:Wn()?1:.5}},{children:[(0,a.jsx)("button",Mn({type:"button",onClick:function(){return Kr("off")},disabled:!Wn(),style:{flex:1,whiteSpace:"nowrap",padding:"8px 12px",borderRadius:"6px",border:"none",backgroundColor:"off"===ge?"#FFFFFF":"transparent",color:"off"===ge?"#111827":"#6B7280",fontSize:"11px",fontWeight:"off"===ge?"600":"500",cursor:Wn()?"pointer":"not-allowed",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",boxShadow:"off"===ge?"0 1px 2px rgba(0, 0, 0, 0.05)":"none"}},{children:"\u{1f6ab} Off"})),(0,a.jsx)("button",Mn({type:"button",onClick:function(){return Kr("smart")},disabled:!Wn(),style:{flex:1,whiteSpace:"nowrap",padding:"8px 12px",borderRadius:"6px",border:"none",backgroundColor:"smart"===ge?"#FFFFFF":"transparent",color:"smart"===ge?"#111827":"#6B7280",fontSize:"11px",fontWeight:"smart"===ge?"600":"500",cursor:Wn()?"pointer":"not-allowed",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",boxShadow:"smart"===ge?"0 1px 2px rgba(0, 0, 0, 0.05)":"none"}},{children:"\u{1f9e0} Smart"})),(0,a.jsx)("button",Mn({type:"button",onClick:function(){return Kr("always")},disabled:!Wn(),style:{flex:1,whiteSpace:"nowrap",padding:"8px 12px",borderRadius:"6px",border:"none",backgroundColor:"always"===ge?"#FFFFFF":"transparent",color:"always"===ge?"#111827":"#6B7280",fontSize:"11px",fontWeight:"always"===ge?"600":"500",cursor:Wn()?"pointer":"not-allowed",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",boxShadow:"always"===ge?"0 1px 2px rgba(0, 0, 0, 0.05)":"none"}},{children:"\u{1f3a8} Always"}))]})),(0,a.jsx)("div",Mn({style:{position:"relative",height:"2.8em",marginTop:"2px"}},{children:(0,a.jsxs)("div",Mn({style:{position:"absolute",top:0,left:0,right:0,fontSize:"11px",color:"#6B7280",lineHeight:"1.4",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"}},{children:["off"===ge&&"No images will be generated","smart"===ge&&"AI decides: Images only for concrete objects, places, and visual concepts. Saves API costs by skipping abstract terms.","always"===ge&&"Images generated for all cards"]}))})),!Wn()&&(0,a.jsx)("div",Mn({style:{fontSize:"11px",color:"#EF4444",backgroundColor:"#FEF2F2",padding:"6px 8px",borderRadius:"6px",border:"1px solid #FECACA"}},{children:"Image generation not available with Groq provider"}))]})),"off"!==ge&&Wn()&&(fe?Se?(0,a.jsxs)("div",Mn({style:{backgroundColor:"#F9FAFB",border:"1px solid #E5E7EB",borderRadius:"8px",padding:"16px",width:"100%",marginBottom:"12px",marginTop:"8px"}},{children:[(0,a.jsxs)("div",Mn({style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"}},{children:[(0,a.jsxs)("h3",Mn({style:{margin:0,fontSize:"16px",fontWeight:600,display:"flex",alignItems:"center",gap:"8px"}},{children:[(0,a.jsx)(gt,{size:14,color:"#10B981"}),"Image Instructions"]})),(0,a.jsx)("button",Mn({onClick:function(){return ke(!1)},style:{background:"transparent",border:"none",cursor:"pointer",color:"#6B7280",fontSize:"13px"}},{children:"Cancel"}))]})),(0,a.jsxs)("div",Mn({style:{marginBottom:"16px"}},{children:[(0,a.jsx)("label",Mn({style:{display:"block",marginBottom:"4px",fontSize:"14px",fontWeight:500,color:"#374151"}},{children:"Image generation style"})),(0,a.jsx)("textarea",{value:$e,onChange:function(e){return He(e.target.value)},placeholder:"E.g., use anime style, make it minimalist, use pastel colors, make it black and white",style:{width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",fontSize:"14px",minHeight:"100px",resize:"vertical"}}),(0,a.jsxs)("div",Mn({style:{fontSize:"12px",color:"#6B7280",marginTop:"8px",lineHeight:"1.4"}},{children:[(0,a.jsx)("p",Mn({style:{margin:"0 0 6px 0",fontWeight:"500"}},{children:"How to use:"})),(0,a.jsxs)("ul",Mn({style:{margin:0,paddingLeft:"16px"}},{children:[(0,a.jsxs)("li",{children:["These are ",(0,a.jsx)("strong",{children:"style instructions"})," for image generation"]}),(0,a.jsx)("li",{children:"The image will still be related to the word you're learning"}),(0,a.jsx)("li",{children:"Focus on artistic style, mood, colors, composition, etc."}),(0,a.jsx)("li",{children:'Examples: "watercolor style", "dark background", "realistic rendering"'})]}))]}))]})),(0,a.jsxs)("button",Mn({onClick:Jn,style:{backgroundColor:"#10B981",color:"white",border:"none",borderRadius:"6px",padding:"8px 16px",fontSize:"14px",fontWeight:500,cursor:"pointer",width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"}},{children:[(0,a.jsx)(gt,{size:14}),"Save Image Instructions"]}))]})):(0,a.jsxs)("button",Mn({onClick:function(){return ke(!0)},style:{display:"flex",alignItems:"center",gap:"6px",backgroundColor:"#F3F4F6",border:"1px solid #E5E7EB",borderRadius:"6px",padding:"6px 12px",fontSize:"13px",color:"#4B5563",cursor:"pointer",width:"100%",justifyContent:"center",marginTop:"8px"}},{children:[(0,a.jsx)(gt,{size:14}),"Customize image generation"]})):null)]})),k===X.d.GeneralTopic&&(0,a.jsxs)("div",Mn({style:{display:"flex",flexDirection:"column",gap:"12px",padding:"16px",backgroundColor:"#F8FAFC",borderRadius:"8px",border:"1px solid #E2E8F0"}},{children:[(0,a.jsxs)("div",Mn({style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"}},{children:[(0,a.jsx)(kt,{style:{color:"#6366F1"}}),(0,a.jsx)("h4",Mn({style:{fontSize:"16px",fontWeight:"600",color:"#111827",margin:0}},{children:"AI Agent Card Creator"}))]})),(0,a.jsx)("p",Mn({style:{fontSize:"14px",color:"#6B7280",margin:0,lineHeight:"1.4"}},{children:"Select text on any page and AI agents will automatically create optimal cards for learning. The system analyzes content and creates 1 to several cards with quality validation."})),(0,a.jsxs)("div",Mn({style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 12px",backgroundColor:"#FEF3C7",borderRadius:"6px",border:"1px solid #F59E0B"}},{children:[(0,a.jsx)(vt,{style:{color:"#F59E0B"}}),(0,a.jsx)("span",Mn({style:{fontSize:"11px",color:"#92400E",fontWeight:"500"}},{children:"AI analyzes text, creates cards and validates results"}))]})),!_&&(0,a.jsxs)("button",Mn({onClick:Jr,disabled:!c.trim()||_,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",width:"100%",padding:"8px 10px",backgroundColor:c.trim()&&!_?"#2563EB":"#E5E7EB",color:c.trim()&&!_?"#ffffff":"#9CA3AF",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:"600",cursor:c.trim()&&!_?"pointer":"not-allowed",transition:"all 0.2s ease",marginTop:"4px",opacity:_?.7:1},onMouseOver:function(e){c.trim()&&!_&&(e.currentTarget.style.backgroundColor="#1D4ED8")},onMouseOut:function(e){c.trim()&&!_&&(e.currentTarget.style.backgroundColor="#2563EB")}},{children:[_?(0,a.jsx)(Ft,{type:"spinner",size:"small",inline:!0,color:"#ffffff"}):(0,a.jsx)(kt,{}),"Create Cards with AI"]}))]})),ye?(0,a.jsxs)("div",Mn({style:{backgroundColor:"#F9FAFB",border:"1px solid #E5E7EB",borderRadius:"8px",padding:"16px",width:"100%",marginBottom:"12px"}},{children:[(0,a.jsxs)("div",Mn({style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"}},{children:[(0,a.jsxs)("h3",Mn({style:{margin:0,fontSize:"16px",fontWeight:600,display:"flex",alignItems:"center",gap:"8px"}},{children:[(0,a.jsx)(vt,{size:14,color:"#2563EB"}),"AI Instructions"]})),(0,a.jsx)("button",Mn({onClick:function(){return ve(!1)},style:{background:"transparent",border:"none",cursor:"pointer",color:"#6B7280",fontSize:"13px"}},{children:"Cancel"}))]})),(0,a.jsxs)("div",Mn({style:{marginBottom:"16px"}},{children:[(0,a.jsx)("label",Mn({style:{display:"block",marginBottom:"4px",fontSize:"14px",fontWeight:500,color:"#374151"}},{children:"Additional instructions for AI"})),(0,a.jsx)("textarea",{value:Pe,onChange:function(e){return Le(e.target.value)},placeholder:"E.g., Keep specialized terms untranslated. Make examples more advanced. Use formal language.",style:{width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",fontSize:"14px",minHeight:"100px",resize:"vertical"}}),(0,a.jsxs)("div",Mn({style:{fontSize:"12px",color:"#6B7280",marginTop:"8px",lineHeight:"1.4"}},{children:[(0,a.jsx)("p",Mn({style:{margin:"0 0 6px 0",fontWeight:"500"}},{children:"How to use:"})),(0,a.jsxs)("ul",Mn({style:{margin:0,paddingLeft:"16px"}},{children:[(0,a.jsxs)("li",{children:["These are ",(0,a.jsx)("strong",{children:"additional"})," instructions that supplement the basic AI behavior"]}),(0,a.jsx)("li",{children:"The original word will always be used (no need to specify it)"}),(0,a.jsx)("li",{children:"Examples will always be generated for the word you're learning"}),(0,a.jsx)("li",{children:"Use this for style guidance, preferences, or special requirements"})]}))]}))]})),(0,a.jsxs)("button",Mn({onClick:Qn,style:{backgroundColor:"#2563EB",color:"white",border:"none",borderRadius:"6px",padding:"8px 16px",fontSize:"14px",fontWeight:500,cursor:"pointer",width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",marginBottom:"8px"}},{children:[(0,a.jsx)(at,{size:14}),"Save Instructions"]}))]})):(0,a.jsxs)("button",Mn({onClick:function(){return ve(!0)},style:{display:"flex",alignItems:"center",gap:"6px",backgroundColor:"#F3F4F6",border:"1px solid #E5E7EB",borderRadius:"6px",padding:"6px 12px",fontSize:"13px",color:"#4B5563",cursor:"pointer",width:"100%",justifyContent:"center"}},{children:[(0,a.jsx)(it,{size:14}),"Customize AI behavior"]})),k===X.d.LanguageLearning&&(0,a.jsxs)("form",Mn({onSubmit:function(e){return Fn(void 0,void 0,void 0,(function(){var t,r,a,s,l,u,d,p,h,f,g,m,y,v,b,S,C,E,T,M,F,z,_,j,B,O;return zn(this,(function(N){switch(N.label){case 0:if(e.preventDefault(),!c.trim())return[2];if(t=Sr,!jr)return[3,4];N.label=1;case 1:return N.trys.push([1,3,,4]),[4,Dr(c)];case 2:return(r=N.sent())&&(t=r),[3,4];case 3:return a=N.sent(),console.error("Language detection failed before submission:",a),[3,4];case 4:kn.current=new AbortController,s=kn.current.signal,i.setIsGeneratingCard(!0),ce(!1),localStorage.removeItem("explicitly_saved"),Pt([]),Vt(!1),i.setCurrentCardId(null),fe?A!==c&&(console.log("Text has changed, clearing existing images for new generation"),i.setImage(null),i.setImageUrl(null)):(console.log("Image generation is disabled, clearing existing images"),i.setImage(null),i.setImageUrl(null)),i.setLinguisticInfo(""),i.setTranscription(""),R(!0),H(null),(0,on.cr)().reset(),(0,on.Y3)((function(e){console.log("\u{1f504} Progress update: ".concat(e.completed,"/").concat(e.total," - ").concat(e.message.title)),H(e.message),Y({completed:e.completed,total:e.total})})),I(c),Ge(null),N.label=5;case 5:if(N.trys.push([5,19,20,21]),console.log("=== DEBUG INFO ==="),console.log("Model Provider:",he),console.log("API Key available:",Boolean(An)),console.log("Model Name (if Groq):",he===Rt.l.Groq?pe:"N/A"),console.log("AI Service:",Object.keys(En)),console.log("Source Language:",jr?t:br),!An)throw new Error("API key for ".concat(he," is missing. Please go to settings and add your API key."));if(l=jr?t:br,k===X.d.LanguageLearning)return[3,16];console.log("\u{1f680} General mode - using fast AI agent workflow for complete cards..."),N.label=6;case 6:N.trys.push([6,12,,15]),u=void 0,N.label=7;case 7:return N.trys.push([7,9,,10]),[4,Promise.resolve().then(n.bind(n,736))];case 8:return d=N.sent().PageContentExtractor,u=d.extractPageContent(c),console.log("\u{1f4cb} General mode: Extracted page context with ".concat((null===(j=null==u?void 0:u.pageImages)||void 0===j?void 0:j.length)||0," images")),[3,10];case 9:return p=N.sent(),console.warn("Failed to extract page content for General mode:",p),u=void 0,[3,10];case 10:return[4,In(En,An).createCardsFromTextFast(c,u,s)];case 11:return(h=N.sent())&&h.length>0&&((f=h[0]).front&&i.setFront(f.front),f.back&&i.setBack(f.back),f.image&&i.setImage(f.image),f.imageUrl&&i.setImageUrl(f.imageUrl),console.log("\u2705 General mode: Created ".concat(h.length," cards with fast workflow"))),[3,15];case 12:return g=N.sent(),console.error("\u274c Error in General mode fast workflow:",g),console.log("\u{1f504} Falling back to simple flashcard creation..."),[4,Promise.resolve().then(n.bind(n,75))];case 13:return[4,(0,N.sent().createFlashcard)(En,An,c,s)];case 14:return(m=N.sent())&&m.front&&i.setFront(m.front),[3,15];case 15:return o(!0),[2];case 16:return console.log("\u{1f680} Using parallel card creation for Language Learning mode..."),[4,Promise.resolve().then(n.bind(n,75))];case 17:return y=N.sent().createCardComponentsParallel,v=Date.now(),[4,y(En,An,c,x,w,l||void 0,fe,s,ge)];case 18:if(b=N.sent(),S=Date.now()-v,console.log("\u26a1 Parallel card creation completed in ".concat(S,"ms")),s.aborted)throw new Error("Generation cancelled by user");if(C={translation:!1,examples:!1,flashcard:!1,image:!1,linguisticInfo:!1},(null===(B=b.translation)||void 0===B?void 0:B.translated)&&(i.setTranslation(b.translation.translated),C.translation=!0),b.examples&&b.examples.length>0&&(E=b.examples.map((function(e){return[e.original,e.translated]})),i.setExamples(E),C.examples=!0),(null===(O=b.flashcard)||void 0===O?void 0:O.front)&&(i.setFront(b.flashcard.front),C.flashcard=!0),b.linguisticInfo&&(i.setLinguisticInfo(b.linguisticInfo),C.linguisticInfo=!0),b.imageUrl&&(i.setImageUrl(b.imageUrl),C.image=!0),b.errors.length>0){for(console.warn("Some components failed:",b.errors),T=0,M=b.errors;T<M.length;T++)"translation"===(F=M[T]).component?Ge("Translation failed: ".concat(F.error),"error"):Ge("".concat(F.component," generation failed: ").concat(F.error),"warning");if(!C.translation)throw new Error("Translation failed - cannot create card without translation")}if(!C.translation)throw new Error("Translation failed - cannot create card without translation");if(console.log("Parallel card creation completed with:",C),o(!0),ce(!1),localStorage.removeItem("explicitly_saved"),console.log("Setting showResult to true after successful parallel card creation"),z="".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),i.setCurrentCardId(z),console.log("Created card with ID:",z),!C.translation)throw new Error("Failed to create card: No data was successfully generated. Please check your API key and try again.");return o(!0),dt(!0),ie(!0),setTimeout((function(){console.log("\u{1f3af} Parallel content is ready - hiding loading"),R(!1),H(null),Y({completed:0,total:0})}),500),[3,21];case 19:if(_=N.sent(),s.aborted)throw console.log("Card generation was cancelled by user"),new Error("Operation cancelled by user");return _ instanceof Error&&Xe(_)?(console.error("Quota error detected in main catch:",_.message),Ge(_.message),R(!1),H(null),Y({completed:0,total:0}),[2]):(console.error("Error processing text:",_),Ge(_ instanceof Error?"".concat(_.message):"Failed to create card. Please check your API key and try again."),R(!1),H(null),Y({completed:0,total:0}),[3,21]);case 20:return i.setIsGeneratingCard(!1),kn.current=null,[7];case 21:return[2]}}))}))},style:{width:"100%",display:"flex",flexDirection:"column",gap:"8px",marginTop:"4px",marginBottom:"0"}},{children:[(0,a.jsxs)("div",Mn({style:{display:"flex",flexDirection:"column",gap:"4px",width:"100%"}},{children:[(0,a.jsxs)("label",Mn({htmlFor:"text",style:{color:"#111827",fontWeight:"600",fontSize:"14px",display:"flex",alignItems:"center"}},{children:["Text:",er()]})),(0,a.jsx)("textarea",{id:"text",value:c,onChange:function(e){return Ln(e.target.value)},placeholder:"Enter text to translate or select text from a webpage",style:{width:"100%",minHeight:"80px",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"14px",resize:"vertical",outline:"none",transition:"all 0.2s ease"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}})]})),(0,a.jsx)("button",Mn({type:"submit",disabled:_,style:{width:"100%",padding:"8px 10px",marginTop:"4px",borderRadius:"6px",backgroundColor:"#2563EB",color:"#ffffff",fontWeight:"600",fontSize:"14px",border:"none",cursor:"pointer",transition:"all 0.2s ease",opacity:_?.7:1},onMouseOver:function(e){return!_&&(e.currentTarget.style.backgroundColor="#1D4ED8")},onMouseOut:function(e){return!_&&(e.currentTarget.style.backgroundColor="#2563EB")}},{children:_?(0,a.jsx)("div",Mn({style:{display:"flex",alignItems:"center",justifyContent:"center"}},{children:(0,a.jsx)(Ft,{type:"spinner",size:"small",inline:!0,color:"#ffffff",text:"Creating card"})})):"Create Card"}))]})),k===X.d.GeneralTopic&&(0,a.jsxs)("div",Mn({style:{width:"100%",display:"flex",flexDirection:"column",gap:"8px",marginTop:"4px"}},{children:[(0,a.jsxs)("label",Mn({htmlFor:"general-text",style:{color:"#111827",fontWeight:"600",fontSize:"14px",display:"flex",alignItems:"center"}},{children:["Text for Analysis:",er()]})),(0,a.jsx)("textarea",{id:"general-text",value:c,onChange:function(e){return Ln(e.target.value)},placeholder:"Enter or select text from the page to create cards",style:{width:"100%",minHeight:"80px",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"14px",resize:"vertical",outline:"none",transition:"all 0.2s ease"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}})]}))]}))})),function(){if(!St)return null;var e=Object.values(jt).filter(Boolean).length;return(0,a.jsx)("div",Mn({style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(2px)",padding:"16px"},onClick:function(){Bt({}),Et(!1)}},{children:(0,a.jsxs)("div",Mn({style:{backgroundColor:"#ffffff",borderRadius:"12px",maxWidth:"360px",width:"100%",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",position:"relative",padding:"16px"},onClick:function(e){return e.stopPropagation()}},{children:[(0,a.jsxs)("div",Mn({style:{position:"sticky",top:0,display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid #E5E7EB",paddingBottom:"12px",marginBottom:"16px",backgroundColor:"#ffffff",zIndex:2}},{children:[(0,a.jsxs)("h3",Mn({style:{margin:0,fontSize:"16px",fontWeight:600,color:"#111827",display:"flex",alignItems:"center",gap:"8px"}},{children:[(0,a.jsx)(ht,{size:14,color:"#2563EB"}),"Select Terms for Cards"]})),(0,a.jsx)("button",Mn({onClick:function(){Bt({}),mt([]),Et(!1)},style:{background:"none",border:"none",display:"flex",alignItems:"center",justifyContent:"center",padding:"8px",borderRadius:"50%",cursor:"pointer",transition:"background-color 0.2s"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="#F3F4F6"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="transparent"},"aria-label":"Close"},{children:(0,a.jsx)(It,{size:16,color:"#6B7280"})}))]})),(0,a.jsxs)("div",Mn({style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"14px"}},{children:[(0,a.jsxs)("p",Mn({style:{fontSize:"14px",color:"#4B5563",margin:0,lineHeight:"1.4"}},{children:["Found ",ft.length," key terms"]})),e>0&&(0,a.jsxs)("span",Mn({style:{fontSize:"13px",fontWeight:500,color:"#2563EB",padding:"3px 8px",backgroundColor:"#EFF6FF",borderRadius:"6px"}},{children:[e," selected"]}))]})),(0,a.jsxs)("div",Mn({style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 4px",marginBottom:"12px"}},{children:[(0,a.jsx)("button",Mn({onClick:function(){var t=e<ft.length,n={};ft.forEach((function(e){n[e]=t})),Bt(n)},style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"13px",background:"none",border:"none",padding:"4px 8px",borderRadius:"4px",color:"#4B5563",cursor:"pointer"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="#F3F4F6"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="transparent"}},{children:e===ft.length?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",Mn({style:{fontSize:"13px"}},{children:"\u2713"}))," Deselect all"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",Mn({style:{fontSize:"13px"}},{children:"\u2610"}))," Select all"]})})),(0,a.jsx)("span",Mn({style:{fontSize:"12px",color:"#6B7280",fontStyle:"italic"}},{children:"Tap to select"}))]})),(0,a.jsx)("div",Mn({style:{display:"flex",flexDirection:"column",gap:"8px",marginBottom:"16px",maxHeight:"300px",overflowY:"auto",padding:"4px",listStyle:"none"}},{children:Tt?(0,a.jsx)("div",Mn({style:{display:"flex",justifyContent:"center",padding:"20px"}},{children:(0,a.jsx)(Ft,{type:"spinner",size:"large",color:"#3B82F6",text:"Analyzing selected text..."})})):ft.map((function(e,t){return(0,a.jsxs)("div",Mn({style:{display:"flex",alignItems:"center",padding:"10px 12px",backgroundColor:jt[e]?"#EFF6FF":"#F9FAFB",border:"1px solid ".concat(jt[e]?"#BFDBFE":"#E5E7EB"),borderRadius:"8px",cursor:"pointer",transition:"all 0.2s ease",position:"relative",listStyleType:"none"},onClick:function(){return rr(e)}},{children:[(0,a.jsx)("input",{type:"checkbox",checked:!!jt[e],onChange:function(){return rr(e)},style:{marginRight:"12px",width:"16px",height:"16px",accentColor:"#2563EB",minWidth:"16px"},id:"option-".concat(t)}),(0,a.jsx)("span",Mn({style:{fontSize:"14px",color:"#374151",flex:1,cursor:"pointer",wordBreak:"break-word",textAlign:"left",paddingLeft:"0",marginLeft:"0",display:"inline-block"}},{children:e.replace(/^[-\u2013\u2014\u2022\s]+/,"")})),(0,a.jsx)("span",Mn({style:{position:"absolute",right:"10px",top:"10px",fontSize:"10px",padding:"2px 6px",borderRadius:"10px",backgroundColor:e.split(/\s+/).length>1?"#DBEAFE":"#F3F4F6",color:e.split(/\s+/).length>1?"#1E40AF":"#6B7280",fontWeight:e.split(/\s+/).length>1?"500":"normal"}},{children:e.split(/\s+/).length>1?"phrase":"word"}))]}),t)}))})),(0,a.jsxs)("div",Mn({style:{display:"flex",gap:"8px",marginTop:"12px"}},{children:[(0,a.jsx)("button",Mn({onClick:function(){Bt({}),Et(!1)},style:{flex:"1",padding:"10px 12px",backgroundColor:"#F9FAFB",color:"#4B5563",border:"1px solid #E5E7EB",borderRadius:"6px",fontSize:"14px",fontWeight:500,cursor:"pointer",transition:"all 0.2s ease"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#F3F4F6"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#F9FAFB"}},{children:"Cancel"})),(0,a.jsxs)("button",Mn({onClick:nr,disabled:0===e,style:{flex:"2",padding:"10px 12px",backgroundColor:0===e?"#E5E7EB":"#2563EB",color:0===e?"#9CA3AF":"#FFFFFF",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:500,cursor:0===e?"not-allowed":"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},onMouseOver:function(t){e>0&&(t.currentTarget.style.backgroundColor="#1D4ED8")},onMouseOut:function(t){e>0&&(t.currentTarget.style.backgroundColor="#2563EB")}},{children:[(0,a.jsx)(bt,{size:14}),"Create ",e>0?"".concat(e," Card").concat(e>1?"s":""):"Cards"]}))]}))]}))}))}(),lt&&t?(0,a.jsx)("div",Mn({style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"flex-start",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(2px)",padding:"16px",overflowY:"auto",overflowX:"hidden"},onClick:tr},{children:(0,a.jsxs)("div",Mn({style:{backgroundColor:"#ffffff",borderRadius:"12px",maxWidth:"340px",width:"100%",maxHeight:"calc(100% - 32px)",overflowY:"auto",overflowX:"hidden",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",position:"relative",padding:"16px",boxSizing:"border-box",margin:"auto"},onClick:function(e){return e.stopPropagation()}},{children:[(0,a.jsxs)("div",Mn({style:{position:"sticky",top:0,display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid #E5E7EB",paddingBottom:"12px",marginBottom:"16px",backgroundColor:"#ffffff",zIndex:2}},{children:[(0,a.jsx)("h3",Mn({style:{margin:0,fontSize:"16px",fontWeight:600,color:"#111827"}},{children:Ut?"Card ".concat(Dt+1," of ").concat(Nt.length):"Your Card"})),(0,a.jsx)("button",Mn({onClick:tr,style:{background:"none",border:"none",display:"flex",alignItems:"center",justifyContent:"center",padding:"8px",borderRadius:"50%",cursor:"pointer",transition:"background-color 0.2s"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="#F3F4F6"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="transparent"},"aria-label":"Close"},{children:(0,a.jsx)(It,{size:16,color:"#6B7280"})}))]})),(0,a.jsxs)("div",Mn({style:{width:"100%",maxWidth:"100%",marginBottom:"12px"}},{children:[(0,a.jsxs)("div",Mn({style:{position:"relative",width:"100%",maxWidth:"100%"}},{children:[(0,a.jsx)("input",{type:"text",value:Je,onChange:function(e){return et(e.target.value)},onKeyDown:Hn,placeholder:"Enter custom instructions (e.g., 'more formal examples', 'change image style')",style:{width:"100%",maxWidth:"100%",padding:"10px 12px",paddingRight:"44px",borderRadius:"8px",border:"1px solid #E5E7EB",fontSize:"14px",color:"#374151",backgroundColor:nt?"#F9FAFB":"#FFFFFF",transition:"all 0.2s ease",boxShadow:nt?"inset 0 1px 2px rgba(0, 0, 0, 0.05)":"none",boxSizing:"border-box"},disabled:nt}),nt?(0,a.jsx)("div",Mn({style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",padding:"6px",borderRadius:"50%",color:"#4F46E5"}},{children:(0,a.jsx)(Ft,{type:"spinner",size:"small",inline:!0,color:"#4F46E5"})})):(0,a.jsx)("button",Mn({onClick:Vn,disabled:!Je.trim()||nt,style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",background:Je.trim()?"linear-gradient(to right, #4F46E5, #6366F1)":"none",border:"none",color:Je.trim()?"#FFFFFF":"#9CA3AF",cursor:Je.trim()?"pointer":"not-allowed",display:"flex",alignItems:"center",justifyContent:"center",padding:"6px",borderRadius:"50%",width:"28px",height:"28px",boxShadow:Je.trim()?"0 1px 3px rgba(0, 0, 0, 0.1)":"none",transition:"all 0.2s ease"},title:"Apply instructions"},{children:(0,a.jsx)(xt,{size:14})}))]})),(0,a.jsxs)("div",Mn({style:{fontSize:"12px",color:nt?"#4F46E5":"#6B7280",marginTop:"6px",display:"flex",alignItems:"center",gap:"6px",fontWeight:nt?"500":"normal"}},{children:[nt&&(0,a.jsx)("span",{style:{display:"inline-block",width:"6px",height:"6px",borderRadius:"50%",backgroundColor:"#4F46E5",animation:"pulse 1.5s infinite"}}),nt?"Applying your instructions...":"Type instructions and press Enter or click the magic wand"]})),(0,a.jsx)("style",{children:"\n                            @keyframes pulse {\n                                0% { opacity: 1; }\n                                50% { opacity: 0.4; }\n                                100% { opacity: 1; }\n                            }\n                        "})]})),Ut&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",Mn({style:{marginBottom:"8px",display:"flex",justifyContent:"center",alignItems:"center"}},{children:(0,a.jsxs)("div",Mn({style:{fontSize:"13px",color:"#4B5563",backgroundColor:"#F9FAFB",padding:"4px 10px",borderRadius:"16px",display:"flex",alignItems:"center",gap:"4px"}},{children:["Card ",Dt+1," of ",Nt.length,Nt[Dt]&&On(Nt[Dt].id)&&(0,a.jsxs)("span",Mn({style:{display:"inline-flex",alignItems:"center",gap:"3px",backgroundColor:"#ECFDF5",color:"#10B981",padding:"2px 6px",borderRadius:"10px",fontSize:"11px",fontWeight:"bold"}},{children:[(0,a.jsx)(Ze,{size:8}),"SAVED"]}))]}))})),(0,a.jsxs)("div",Mn({style:{display:"flex",justifyContent:"space-between",gap:"8px",marginBottom:"12px"}},{children:[(0,a.jsxs)("button",Mn({onClick:sr,disabled:0===Dt,style:{padding:"8px 16px",backgroundColor:0===Dt?"#F3F4F6":"#EFF6FF",color:0===Dt?"#9CA3AF":"#2563EB",border:"1px solid ".concat(0===Dt?"#E5E7EB":"#BFDBFE"),borderRadius:"6px",fontSize:"14px",fontWeight:500,cursor:0===Dt?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"6px",flex:1}},{children:["\u2190 Prev",Dt>0&&Nt[Dt-1]&&(On(Nt[Dt-1].id)?(0,a.jsx)("span",{style:{width:"6px",height:"6px",borderRadius:"50%",backgroundColor:"#10B981",marginLeft:"auto"}}):null)]})),(0,a.jsxs)("button",Mn({onClick:or,disabled:Dt===Nt.length-1,style:{padding:"8px 16px",backgroundColor:Dt===Nt.length-1?"#F3F4F6":"#EFF6FF",color:Dt===Nt.length-1?"#9CA3AF":"#2563EB",border:"1px solid ".concat(Dt===Nt.length-1?"#E5E7EB":"#BFDBFE"),borderRadius:"6px",fontSize:"14px",fontWeight:500,cursor:Dt===Nt.length-1?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"6px",flex:1,justifyContent:"flex-end"}},{children:[Dt<Nt.length-1&&Nt[Dt+1]&&(On(Nt[Dt+1].id)?(0,a.jsx)("span",{style:{width:"6px",height:"6px",borderRadius:"50%",backgroundColor:"#10B981",marginRight:"auto"}}):null),"Next \u2192"]}))]})),(0,a.jsx)("button",Mn({onClick:Gn,style:{width:"100%",padding:"10px 12px",backgroundColor:"#10B981",color:"white",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:500,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",marginBottom:"12px",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"},disabled:$},{children:$?(0,a.jsx)(Ft,{type:"spinner",size:"small",inline:!0,color:"#ffffff",text:"Saving"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("svg",Mn({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},{children:(0,a.jsx)("path",{d:"M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022Z"})})),jn.length>0?(0,a.jsxs)(a.Fragment,{children:["Save ",Nt.length-jn.length," Remaining Cards",(0,a.jsxs)("span",Mn({style:{fontSize:"11px",backgroundColor:"rgba(255,255,255,0.25)",borderRadius:"4px",padding:"1px 6px",marginLeft:"4px"}},{children:[jn.length," saved"]}))]}):(0,a.jsxs)(a.Fragment,{children:["Save All Cards (",Nt.length,")"]})]})}))]}),(0,a.jsx)(rn,{mode:k,front:f,translation:u,examples:d,imageUrl:h,image:p,linguisticInfo:v,transcription:b,onNewImage:qn,onNewExamples:Un,onAccept:Yn,onViewSavedCards:Xn,onCancel:Zn,loadingNewImage:B,loadingNewExamples:P,createdAt:new Date,loadingAccept:$,loadingGetResult:_,shouldGenerateImage:fe,isSaved:Nn,isEdited:Q,isGeneratingCard:to,setTranslation:Dn,setExamples:$n,setLinguisticInfo:Ur})]}))})):null,Tr&&qr(),ur&&yr(),nn&&Zt.length>0&&(0,a.jsx)("div",Mn({style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.8)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px",animation:"fadeIn 0.3s ease-out"}},{children:(0,a.jsxs)("div",Mn({style:{backgroundColor:"#ffffff",borderRadius:"8px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",maxWidth:"640px",width:"100%",maxHeight:"90vh",overflow:"hidden",display:"flex",flexDirection:"column",border:"1px solid #EAEAEA",animation:"slideUp 0.4s ease-out"}},{children:[(0,a.jsx)("div",Mn({style:{padding:"20px 24px 16px 24px",borderBottom:"1px solid #EAEAEA"}},{children:(0,a.jsxs)("div",Mn({style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",Mn({style:{margin:0,fontSize:"18px",fontWeight:"600",color:"#000000",letterSpacing:"-0.025em"}},{children:"Review Cards"})),(0,a.jsxs)("p",Mn({style:{margin:"4px 0 0 0",fontSize:"14px",color:"#666666",fontWeight:"400"}},{children:[Zt.length," cards generated by AI"]}))]}),(0,a.jsx)("button",Mn({onClick:Zr,style:{background:"none",border:"none",fontSize:"16px",color:"#999999",cursor:"pointer",padding:"6px",borderRadius:"4px",transition:"all 0.15s ease"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#F5F5F5",e.currentTarget.style.color="#666666"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="#999999"}},{children:(0,a.jsx)(It,{})}))]}))})),Zt.length>1&&(0,a.jsx)("div",Mn({style:{padding:"12px 24px",backgroundColor:"#FAFAFA",borderBottom:"1px solid #EAEAEA",display:"flex",alignItems:"center",justifyContent:"center"}},{children:(0,a.jsxs)("div",Mn({style:{display:"flex",alignItems:"center",gap:"12px"}},{children:[(0,a.jsx)("button",Mn({onClick:function(){un>0&&pn(un-1)},disabled:0===un,style:{backgroundColor:"transparent",color:0===un?"#CCCCCC":"#666666",border:"1px solid ".concat(0===un?"#EAEAEA":"#DDDDD"),borderRadius:"6px",padding:"6px 10px",fontSize:"13px",fontWeight:"500",cursor:0===un?"not-allowed":"pointer",transition:"all 0.15s ease",display:"flex",alignItems:"center",gap:"4px"},onMouseOver:function(e){0!==un&&(e.currentTarget.style.borderColor="#999999",e.currentTarget.style.color="#333333")},onMouseOut:function(e){0!==un&&(e.currentTarget.style.borderColor="#DDDDDD",e.currentTarget.style.color="#666666")}},{children:"\u2190"})),(0,a.jsxs)("div",Mn({style:{fontSize:"13px",color:"#666666",fontWeight:"500",padding:"0 8px"}},{children:[un+1," of ",Zt.length]})),(0,a.jsx)("button",Mn({onClick:function(){un<Zt.length-1&&pn(un+1)},disabled:un===Zt.length-1,style:{backgroundColor:"transparent",color:un===Zt.length-1?"#CCCCCC":"#666666",border:"1px solid ".concat(un===Zt.length-1?"#EAEAEA":"#DDDDDD"),borderRadius:"6px",padding:"6px 10px",fontSize:"13px",fontWeight:"500",cursor:un===Zt.length-1?"not-allowed":"pointer",transition:"all 0.15s ease",display:"flex",alignItems:"center",gap:"4px"},onMouseOver:function(e){un!==Zt.length-1&&(e.currentTarget.style.borderColor="#999999",e.currentTarget.style.color="#333333")},onMouseOut:function(e){un!==Zt.length-1&&(e.currentTarget.style.borderColor="#DDDDDD",e.currentTarget.style.color="#666666")}},{children:"\u2192"}))]}))})),(0,a.jsx)("div",Mn({style:{flex:1,overflow:"auto",padding:"16px",backgroundColor:"#ffffff"}},{children:Zt[un]&&(0,a.jsx)("div",Mn({style:{animation:"slideIn 0.3s ease-out"}},{children:(0,a.jsx)(rn,{front:Zt[un].front||null,back:Zt[un].back||null,translation:null,examples:[],imageUrl:Zt[un].imageUrl||null,image:Zt[un].image||null,linguisticInfo:"",transcription:null,onNewImage:function(){},onNewExamples:function(){},onAccept:eo,onViewSavedCards:function(){},loadingNewImage:!1,loadingNewExamples:!1,loadingAccept:$,createdAt:new Date,mode:X.d.GeneralTopic,shouldGenerateImage:!1,isSaved:fn.has(un),isEdited:!1,isGeneratingCard:!1,hideActionButtons:!0,setBack:function(e){var t=_n([],Zt,!0);t[un]=Mn(Mn({},t[un]),{back:e}),en(t)}})}))})),(0,a.jsxs)("div",Mn({style:{padding:"16px 20px",borderTop:"1px solid #EAEAEA",backgroundColor:"#FAFAFA",display:"flex",flexDirection:"column",gap:"12px"}},{children:[(0,a.jsxs)("div",Mn({style:{display:"flex",justifyContent:"center",gap:"8px"}},{children:[(0,a.jsx)("button",Mn({onClick:eo,disabled:$||fn.has(un),style:{backgroundColor:fn.has(un)?"#10B981":"#ffffff",color:fn.has(un)?"#ffffff":"#374151",border:"1px solid ".concat(fn.has(un)?"#10B981":"#D1D5DB"),borderRadius:"6px",padding:"8px 16px",fontSize:"14px",fontWeight:"500",cursor:$||fn.has(un)?"not-allowed":"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"6px",minWidth:"100px",justifyContent:"center",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",opacity:$||fn.has(un)?.7:1},onMouseOver:function(e){$||fn.has(un)||(e.currentTarget.style.borderColor="#9CA3AF",e.currentTarget.style.boxShadow="0 4px 6px -1px rgba(0, 0, 0, 0.1)")},onMouseOut:function(e){$||fn.has(un)||(e.currentTarget.style.borderColor="#D1D5DB",e.currentTarget.style.boxShadow="0 1px 2px 0 rgba(0, 0, 0, 0.05)")}},{children:fn.has(un)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Ze,{size:14}),"Saved"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Ct,{size:14}),"Save"]})})),(0,a.jsxs)("button",Mn({onClick:function(){vn(!0),Sn("")},disabled:$,style:{backgroundColor:"#ffffff",color:"#F59E0B",border:"1px solid #F59E0B",borderRadius:"6px",padding:"8px 16px",fontSize:"14px",fontWeight:"500",cursor:$?"not-allowed":"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"6px",minWidth:"100px",justifyContent:"center",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",opacity:$?.7:1},onMouseOver:function(e){$||(e.currentTarget.style.backgroundColor="#F59E0B",e.currentTarget.style.color="#ffffff",e.currentTarget.style.boxShadow="0 4px 6px -1px rgba(0, 0, 0, 0.1)")},onMouseOut:function(e){$||(e.currentTarget.style.backgroundColor="#ffffff",e.currentTarget.style.color="#F59E0B",e.currentTarget.style.boxShadow="0 1px 2px 0 rgba(0, 0, 0, 0.05)")}},{children:[(0,a.jsx)(ct,{size:14}),"Improve"]}))]})),(0,a.jsxs)("div",Mn({style:{display:"flex",justifyContent:"center",gap:"8px"}},{children:[(0,a.jsx)("button",Mn({onClick:Zr,disabled:$,style:{backgroundColor:"#ffffff",color:"#6B7280",border:"1px solid #D1D5DB",borderRadius:"6px",padding:"8px 16px",fontSize:"14px",fontWeight:"500",cursor:$?"not-allowed":"pointer",transition:"all 0.2s ease",minWidth:"100px",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",opacity:$?.7:1},onMouseOver:function(e){$||(e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.boxShadow="0 4px 6px -1px rgba(0, 0, 0, 0.1)")},onMouseOut:function(e){$||(e.currentTarget.style.backgroundColor="#ffffff",e.currentTarget.style.boxShadow="0 1px 2px 0 rgba(0, 0, 0, 0.05)")}},{children:"Cancel"})),(0,a.jsx)("button",Mn({onClick:function(){return Fn(void 0,void 0,void 0,(function(){var e,t,n,r,o,a,i,l;return zn(this,(function(c){switch(c.label){case 0:q(!0),c.label=1;case 1:c.trys.push([1,6,7,8]),e=0,t=Zt,c.label=2;case 2:return e<t.length?(n=t[e],[4,F(null!==(i=n.image)&&void 0!==i?i:null,null!==(l=n.imageUrl)&&void 0!==l?l:null)]):[3,5];case 3:r=c.sent(),o=Mn(Mn({},n),{image:r.image,imageUrl:r.imageUrl}),s(Ee(o)),c.label=4;case 4:return e++,[3,2];case 5:return sn(!1),en([]),pn(0),s(Ie("")),[3,8];case 6:return a=c.sent(),console.error("Error saving preview cards:",a),Ge("Error saving cards","error"),[3,8];case 7:return q(!1),[7];case 8:return[2]}}))}))},disabled:$,style:{backgroundColor:$?"#9CA3AF":"#3B82F6",color:"#ffffff",border:"none",borderRadius:"6px",padding:"8px 20px",fontSize:"14px",fontWeight:"600",cursor:$?"not-allowed":"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"6px",minWidth:"140px",justifyContent:"center",boxShadow:"0 4px 6px -1px rgba(59, 130, 246, 0.3)",opacity:$?.7:1},onMouseOver:function(e){$||(e.currentTarget.style.backgroundColor="#2563EB",e.currentTarget.style.boxShadow="0 6px 10px -1px rgba(59, 130, 246, 0.4)",e.currentTarget.style.transform="translateY(-1px)")},onMouseOut:function(e){$||(e.currentTarget.style.backgroundColor="#3B82F6",e.currentTarget.style.boxShadow="0 4px 6px -1px rgba(59, 130, 246, 0.3)",e.currentTarget.style.transform="translateY(0)")}},{children:$?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Ft,{type:"spinner",size:"small",inline:!0,color:"#ffffff"}),"Saving..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Ze,{size:14}),"Save All (",Zt.length,")"]})}))]}))]}))]}))})),yn&&(0,a.jsx)("div",Mn({style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:1e4,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"}},{children:(0,a.jsxs)("div",Mn({style:{backgroundColor:"#ffffff",borderRadius:"8px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",maxWidth:"520px",width:"100%",maxHeight:"80vh",overflow:"hidden",display:"flex",flexDirection:"column",border:"1px solid #EAEAEA"}},{children:[(0,a.jsx)("div",Mn({style:{padding:"20px 24px 16px 24px",borderBottom:"1px solid #EAEAEA"}},{children:(0,a.jsxs)("div",Mn({style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",Mn({style:{margin:0,fontSize:"18px",fontWeight:"600",color:"#000000",letterSpacing:"-0.025em"}},{children:"Improve Card"})),(0,a.jsx)("p",Mn({style:{margin:"4px 0 0 0",fontSize:"14px",color:"#666666",fontWeight:"400"}},{children:"Provide feedback to create a better version"}))]}),(0,a.jsx)("button",Mn({onClick:function(){return vn(!1)},style:{background:"none",border:"none",fontSize:"16px",color:"#999999",cursor:"pointer",padding:"6px",borderRadius:"4px",transition:"all 0.15s ease"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#F5F5F5",e.currentTarget.style.color="#666666"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="#999999"}},{children:(0,a.jsx)(It,{})}))]}))})),(0,a.jsxs)("div",Mn({style:{padding:"24px",flex:1,overflow:"auto"}},{children:[(0,a.jsx)("textarea",{value:wn,onChange:function(e){return Sn(e.target.value)},placeholder:"Example: Make the question more specific, simplify the answer, add more context, focus on practical examples...",style:{width:"100%",minHeight:"140px",padding:"16px",borderRadius:"6px",border:"1px solid #EAEAEA",backgroundColor:"#FAFAFA",fontSize:"14px",lineHeight:"1.6",resize:"vertical",fontFamily:"inherit",outline:"none",transition:"all 0.15s ease"},onFocus:function(e){e.currentTarget.style.borderColor="#0070F3",e.currentTarget.style.backgroundColor="#ffffff"},onBlur:function(e){e.currentTarget.style.borderColor="#EAEAEA",e.currentTarget.style.backgroundColor="#FAFAFA"}}),(0,a.jsx)("div",Mn({style:{marginTop:"16px",padding:"12px 16px",backgroundColor:"#F9F9F9",borderRadius:"6px",border:"1px solid #EAEAEA"}},{children:(0,a.jsxs)("div",Mn({style:{display:"flex",alignItems:"flex-start",gap:"6px",fontSize:"13px",color:"#666666",lineHeight:"1.5"}},{children:[(0,a.jsx)(vt,{size:14,style:{color:"#999999",marginTop:"1px"}}),(0,a.jsx)("span",{children:"Be specific about what you want to change for better results"})]}))}))]})),(0,a.jsxs)("div",Mn({style:{padding:"20px 24px",borderTop:"1px solid #EAEAEA",backgroundColor:"#FAFAFA",display:"flex",justifyContent:"flex-end",gap:"8px"}},{children:[(0,a.jsx)("button",Mn({onClick:function(){return vn(!1)},style:{backgroundColor:"transparent",color:"#999999",border:"none",padding:"8px 12px",fontSize:"13px",fontWeight:"500",cursor:"pointer",transition:"all 0.15s ease",borderRadius:"5px"},onMouseOver:function(e){e.currentTarget.style.color="#666666",e.currentTarget.style.backgroundColor="#F5F5F5"},onMouseOut:function(e){e.currentTarget.style.color="#999999",e.currentTarget.style.backgroundColor="transparent"}},{children:"Cancel"})),(0,a.jsx)("button",Mn({onClick:function(){return Fn(void 0,void 0,void 0,(function(){var e,t,n,r,o,a,i,s,l,u,d,p;return zn(this,(function(h){switch(h.label){case 0:vn(!1),q(!0),h.label=1;case 1:if(h.trys.push([1,7,8,9]),!(e=Zt[un]))return Ge("No card to recreate","error"),[2];t=In(En,An),n="Please recreate this card with improvements. Original card:\nQuestion: ".concat(e.front,"\nAnswer: ").concat(e.back,"\nOriginal text: ").concat(c),wn.trim()&&(n+="\n\nUser feedback: ".concat(wn.trim())),n+="\n\nPlease create an improved version based on the feedback.",r=void 0,h.label=2;case 2:return h.trys.push([2,4,,5]),o=window.getSelection(),a=void 0,o&&o.rangeCount>0&&(i=o.getRangeAt(0),a=i.commonAncestorContainer.nodeType===Node.ELEMENT_NODE?i.commonAncestorContainer:i.commonAncestorContainer.parentElement||void 0),[4,Tn.PageContentExtractor.extractPageContentAsync(c,a)];case 3:return r=h.sent(),[3,5];case 4:return s=h.sent(),console.warn("Failed to extract page content for recreation:",s),r=void 0,[3,5];case 5:return[4,t.createCardsFromTextFast(n,r)];case 6:return(l=h.sent()).length>0?((u=_n([],Zt,!0))[un]=l[0],en(u),gn((function(e){var t=new Set(e);return t.delete(un),t}))):Ge("Failed to recreate card","error"),[3,9];case 7:return d=h.sent(),console.error("Error recreating card:",d),p=d instanceof Error?d.message:"Unknown error",Ge("Card recreation error: ".concat(p),"error"),[3,9];case 8:return q(!1),Sn(""),[7];case 9:return[2]}}))}))},disabled:$,style:{backgroundColor:$?"#F5F5F5":"#000000",color:$?"#999999":"#ffffff",border:"none",borderRadius:"5px",padding:"8px 16px",fontSize:"13px",fontWeight:"500",cursor:$?"not-allowed":"pointer",transition:"all 0.15s ease",display:"flex",alignItems:"center",gap:"6px",opacity:$?.6:1},onMouseOver:function(e){$||(e.currentTarget.style.backgroundColor="#333333")},onMouseOut:function(e){$||(e.currentTarget.style.backgroundColor="#000000")}},{children:$?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Ft,{type:"spinner",size:"small",inline:!0,color:"#999999"}),"Improving..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ct,{size:11}),"Improve Card"]})}))]}))]}))})),(0,a.jsx)("div",Mn({style:{position:"absolute",top:"16px",right:"16px",zIndex:9999,pointerEvents:"none"}},{children:(0,a.jsx)("div",Mn({style:{pointerEvents:"auto"}},{children:Ye()}))})),(0,a.jsx)("style",{children:"\n                    @keyframes shimmer {\n                        0% {\n                            left: -100%;\n                        }\n                        100% {\n                            left: 100%;\n                        }\n                    }\n                "})]}))},jn=n.p+"assets/img/chat-gpt39f424be38a6852eb2c5.png",Bn=n.p+"assets/img/copy-iconb2b0ec637a2b0fd4ca40.svg";var On=function(){return On=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},On.apply(this,arguments)},Nn=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},Pn=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}};const Ln=function(e){e.onBackClick;var t=e.popup,n=void 0!==t&&t,o=E(),i=(0,r.useState)(null),s=i[0],l=i[1],c=m((function(e){return e.settings.openAiKey})),u=(m((function(e){return e.settings.ankiConnectUrl})),m((function(e){return e.settings.ankiConnectApiKey}))),d=m((function(e){return e.settings.groqApiKey})),p=m((function(e){return e.settings.groqModelName})),h=m((function(e){return e.settings.modelProvider})),f=function(e){o((0,Ve.Wy)(e.target.value))},g=function(e){o((0,Ve.H1)(e.target.value))},y=function(e){o((0,Ve.KS)(e.target.value))},v=chrome.runtime.getURL(jn),b=chrome.runtime.getURL(Bn),x=function(e){return Nn(void 0,void 0,void 0,(function(){var t,n,r,o,a,i,s,u;return Pn(this,(function(h){switch(h.label){case 0:l(null),h.label=1;case 1:switch(h.trys.push([1,4,,5]),t="",n={},r={},o="",e){case Rt.l.OpenAI:t="https://api.openai.com/v1/chat/completions",n={"Content-Type":"application/json",Authorization:"Bearer ".concat(o=c)},r={model:"gpt-5-nano",messages:[{role:"user",content:"Say hello"}]};break;case Rt.l.Groq:t="https://api.groq.com/openai/v1/chat/completions",n={"Content-Type":"application/json",Authorization:"Bearer ".concat(o=d)},r={model:p,messages:[{role:"user",content:"Say hello"}]}}return o.trim()?[4,fetch(t,{method:"POST",headers:n,body:JSON.stringify(r)})]:(l({success:!1,message:"API key is missing. Please enter your API key."}),[2]);case 2:return[4,(a=h.sent()).json()];case 3:return i=h.sent(),a.ok?(console.log("API test response:",i),l({success:!0,message:"Connection successful! API is working properly."})):(console.error("API test error:",i),l({success:!1,message:"Error: ".concat((null===(u=i.error)||void 0===u?void 0:u.message)||"Unknown error occurred")})),[3,5];case 4:return s=h.sent(),console.error("API connection test error:",s),l({success:!1,message:"Error: ".concat(s instanceof Error?s.message:"Unknown error occurred")}),[3,5];case 5:return[2]}}))}))},w=function(){return s?(0,a.jsx)("div",On({style:{padding:"10px",marginTop:"10px",borderRadius:"6px",backgroundColor:s.success?"#ECFDF5":"#FEF2F2",color:s.success?"#065F46":"#B91C1C",fontSize:"14px",borderLeft:"4px solid ".concat(s.success?"#10B981":"#EF4444")}},{children:s.message})):null};return(0,a.jsxs)("div",On({style:{boxSizing:"border-box",padding:"14px",backgroundColor:"#ffffff",height:"100%",width:"100%",maxWidth:n?"100%":"640px",margin:"0 auto",overflowY:"auto",overflowX:"hidden",paddingBottom:"18px",marginTop:"12px",borderRadius:n?"12px":"0",boxShadow:n?"0 16px 35px rgba(15, 23, 42, 0.12)":"none"}},{children:[(0,a.jsxs)("div",On({style:{marginBottom:"20px",backgroundColor:"#F9FAFB",padding:"12px",borderRadius:"8px"}},{children:[(0,a.jsx)("label",On({htmlFor:"modelProvider",style:{display:"block",fontWeight:"600",marginBottom:"8px",color:"#111827",fontSize:"14px"}},{children:"AI Provider"})),(0,a.jsx)("p",On({style:{fontSize:"12px",marginBottom:"8px",color:"#6B7280"}},{children:"Select which provider to use for generating flashcards"})),(0,a.jsxs)("select",On({id:"modelProvider",value:h,onChange:function(e){o((0,Ve.dU)(e.target.value)),l(null)},style:{width:"100%",padding:"8px 12px",boxSizing:"border-box",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"13px",outline:"none",transition:"all 0.2s ease",cursor:"pointer"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}},{children:[(0,a.jsx)("option",On({value:Rt.l.OpenAI},{children:"OpenAI"})),(0,a.jsx)("option",On({value:Rt.l.Groq},{children:"Groq"}))]}))]})),(0,a.jsxs)("div",{children:[h!==Rt.l.OpenAI?null:(0,a.jsxs)("div",On({style:{marginBottom:"20px"}},{children:[(0,a.jsxs)("div",On({style:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:"6px",marginBottom:"8px"}},{children:[(0,a.jsx)("label",On({htmlFor:"openAiKey",style:{display:"block",fontWeight:"600",marginBottom:"0",marginRight:"8px",color:"#111827",fontSize:"14px"}},{children:"OpenAI API Key"})),(0,a.jsx)("img",{src:v,alt:"ChatGPT Logo",style:{width:"16px",height:"16px",marginTop:"-2px"}})]})),(0,a.jsxs)("p",On({style:{fontSize:"12px",marginBottom:"6px",color:"#6B7280"}},{children:["You can get your OpenAI API key from ",(0,a.jsx)("a",On({href:"https://platform.openai.com/account/api-keys",target:"_blank",rel:"noopener noreferrer",style:{color:"#2563EB",textDecoration:"underline"}},{children:"here"})),"."]})),(0,a.jsx)("div",On({style:{position:"relative",marginBottom:"16px"}},{children:(0,a.jsx)("input",{type:"text",id:"openAiKey",value:c,onChange:f,style:{width:"100%",padding:"8px 10px",boxSizing:"border-box",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"13px",outline:"none",transition:"all 0.2s ease"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}})})),(0,a.jsx)("button",On({onClick:function(){return x(Rt.l.OpenAI)},style:{marginTop:"8px",padding:"6px 12px",backgroundColor:"#10a37f",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px"}},{children:"Test API Connection"})),w()]})),h!==Rt.l.Groq?null:(0,a.jsxs)("div",On({style:{marginBottom:"20px"}},{children:[(0,a.jsx)("label",On({htmlFor:"groqApiKey",style:{display:"block",fontWeight:"600",marginBottom:"8px",color:"#111827",fontSize:"14px"}},{children:"Groq API Key"})),(0,a.jsxs)("p",On({style:{fontSize:"12px",marginBottom:"8px",color:"#6B7280"}},{children:["You can get your Groq API key from ",(0,a.jsx)("a",On({href:"https://console.groq.com/keys",target:"_blank",rel:"noopener noreferrer",style:{color:"#2563EB",textDecoration:"underline"}},{children:"here"})),"."]})),(0,a.jsx)("input",{type:"text",id:"groqApiKey",value:d,onChange:g,style:{width:"100%",padding:"8px 12px",boxSizing:"border-box",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"13px",outline:"none",transition:"all 0.2s ease",marginBottom:"16px"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}}),(0,a.jsx)("div",On({style:{padding:"8px",backgroundColor:"#DBEAFE",borderRadius:"6px",marginBottom:"16px"}},{children:(0,a.jsxs)("p",On({style:{fontSize:"12px",color:"#1E40AF",margin:0}},{children:[(0,a.jsx)("strong",{children:"Note:"})," Image generation is not available with Groq."]}))})),(0,a.jsx)("label",On({htmlFor:"groqModelName",style:{display:"block",fontWeight:"600",marginBottom:"8px",color:"#111827",fontSize:"14px"}},{children:"Groq Model"})),(0,a.jsxs)("select",On({id:"groqModelName",value:p,onChange:y,style:{width:"100%",padding:"8px 12px",boxSizing:"border-box",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"13px",outline:"none",transition:"all 0.2s ease",cursor:"pointer",marginBottom:"16px"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}},{children:[(0,a.jsx)("option",On({value:"llama3-8b-8192"},{children:"Llama-3 8B"})),(0,a.jsx)("option",On({value:"llama3-70b-8192"},{children:"Llama-3 70B"})),(0,a.jsx)("option",On({value:"mixtral-8x7b-32768"},{children:"Mixtral 8x7B"})),(0,a.jsx)("option",On({value:"gemma-7b-it"},{children:"Gemma 7B"}))]})),(0,a.jsx)("button",On({onClick:function(){return x(Rt.l.Groq)},style:{marginTop:"8px",padding:"6px 12px",backgroundColor:"#7c3aed",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px"}},{children:"Test API Connection"})),w()]})),(0,a.jsx)("div",{style:{marginBottom:"20px"}})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",On({htmlFor:"ankiConnectApiKey",style:{display:"block",fontWeight:"600",marginBottom:"8px",color:"#111827",fontSize:"14px"}},{children:"AnkiConnect API Key (optional)"})),(0,a.jsx)("input",{type:"text",id:"ankiConnectApiKey",value:null!==u?u:"",onChange:function(e){o((0,Ve.Zm)(e.target.value))},style:{width:"100%",padding:"8px 12px",boxSizing:"border-box",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"13px",outline:"none",transition:"all 0.2s ease",marginBottom:"20px"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",On({style:{fontSize:"13px",marginBottom:"8px",color:"#6B7280"}},{children:["Install the Anki plugin ",(0,a.jsx)("strong",{children:"AnkiConnect"})," and configure it as follows:"]})),(0,a.jsxs)("ul",On({style:{fontSize:"13px",listStyle:"disc",paddingLeft:"20px",marginBottom:"8px",color:"#6B7280"}},{children:[(0,a.jsxs)("li",On({style:{marginBottom:"4px"}},{children:["Go to ",(0,a.jsx)("strong",{children:"Tools"})," then ",(0,a.jsx)("strong",{children:"Add-ons"})," then ",(0,a.jsx)("strong",{children:"Get Add-ons..."})]})),(0,a.jsxs)("li",On({style:{marginBottom:"4px",display:"flex",alignItems:"center",flexWrap:"wrap",gap:"6px"}},{children:["Paste Code\xa0\xa0",(0,a.jsxs)("button",On({onClick:function(){return navigator.clipboard.writeText("2055492159")},style:{display:"flex",alignItems:"center",backgroundColor:"#F3F4F6",padding:"4px 6px",borderRadius:"4px",color:"#2563EB",transition:"all 0.2s ease",border:"none",cursor:"pointer"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="#E5E7EB"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="#F3F4F6"}},{children:[(0,a.jsx)("img",{src:b,alt:"Copy Icon",style:{width:"16px",height:"16px",marginRight:"4px"}}),(0,a.jsx)("code",On({style:{backgroundColor:"transparent",fontSize:"12px"}},{children:"2055492159"}))]}))]})),(0,a.jsxs)("li",On({style:{marginBottom:"4px"}},{children:["Then click ",(0,a.jsx)("strong",{children:"OK"})]})),(0,a.jsx)("li",On({style:{marginBottom:"4px"}},{children:"Restart Anki"})),(0,a.jsxs)("li",On({style:{marginBottom:"4px"}},{children:["Navigate to ",(0,a.jsx)("strong",{children:"Tools"})," > ",(0,a.jsx)("strong",{children:"Add-ons"})," > ",(0,a.jsx)("strong",{children:"AnkiConnect"})," >",(0,a.jsx)("strong",{children:"Config"})]}))]})),(0,a.jsxs)("div",On({style:{position:"relative",backgroundColor:"#F9FAFB",padding:"12px",borderRadius:"6px",marginBottom:"20px"}},{children:[(0,a.jsxs)("p",On({style:{fontSize:"13px",marginBottom:"8px",color:"#6B7280"}},{children:["Copy paste the following config, you can change the ",(0,a.jsx)("code",{children:"apiKey"}),":"]})),(0,a.jsx)("pre",On({style:{display:"block",overflowX:"hidden",overflowY:"auto",padding:"10px",backgroundColor:"#F3F4F6",borderRadius:"4px",whiteSpace:"pre-wrap",cursor:"pointer",fontSize:"12px",color:"#374151",margin:0,wordBreak:"break-word"},onClick:function(){return navigator.clipboard.writeText(JSON.stringify({apiKey:u||"your_api_key",webCorsOriginList:["http://localhost","*"],webBindPort:8765},null,2))},title:"Click to copy"},{children:JSON.stringify({apiKey:u||"your_api_key",webCorsOriginList:["http://localhost","*"],webBindPort:8765},null,2)})),(0,a.jsx)("button",On({onClick:function(){return navigator.clipboard.writeText(JSON.stringify({apiKey:u||"your_api_key",webCorsOriginList:["http://localhost","*"],webBindPort:8765},null,2))},style:{position:"absolute",top:"8px",right:"8px",background:"transparent",border:"none",cursor:"pointer",padding:"4px"},title:"Copy to clipboard"},{children:(0,a.jsx)("img",{src:b,alt:"Copy Icon",style:{width:"16px",height:"16px"}})}))]}))]})]}))};var Dn="FETCH_DECKS_SUCCESS",$n="SET_DECK_ID",qn=function(e){return{type:$n,payload:e}},Un=function(){return Un=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Un.apply(this,arguments)},Vn=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},Hn=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},Wn=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))};const Gn=function(e){e.onBackClick;var t=E(),n=qe(),o=n.storedCards,i=m((function(e){return e.deck.deckId})),s=m((function(e){return e.deck.decks})),l=m((function(e){return e.settings.useAnkiConnect})),c=m((function(e){return e.settings.ankiConnectUrl})),u=m((function(e){return e.settings.ankiConnectApiKey})),d=m((function(e){return e.settings.openAiKey})),p=m((function(e){return e.settings.imageInstructions})),h=m((function(e){return e.cards})),f=(0,r.useState)([]),g=f[0],y=f[1],v=(0,r.useState)(!1),b=v[0],x=v[1],w=(0,r.useState)(!1),S=w[0],k=w[1],C=(0,r.useState)("not_exported"),A=C[0],I=C[1],T=(0,r.useState)(!1),M=T[0],F=T[1],z=(0,r.useState)(null),_=z[0],R=z[1],j=(0,r.useState)(!1),B=j[0],O=j[1],N=(0,r.useState)(!1),P=(N[0],N[1]),L=(0,r.useState)(""),D=L[0],$=L[1],q=(0,r.useState)(!1),U=q[0],V=q[1],H=(0,r.useState)(null),W=H[0],G=H[1],Y=(0,r.useState)(!1),K=Y[0],Q=Y[1],J=(0,r.useState)(!1),Z=J[0],ee=J[1],te=(0,r.useState)(1),ne=te[0],oe=te[1],ae=(0,r.useState)(10),ie=ae[0],se=ae[1],le=(0,r.useState)(1),ce=le[0],ue=le[1],de=(0,r.useState)(!1),pe=de[0],he=de[1],fe=(0,r.useState)("anki_cards"),ge=fe[0],me=fe[1],ye=(0,r.useState)(!1),ve=ye[0],be=ye[1],xe=dn(),we=xe.showError,Se=xe.renderErrorNotification;new an.z4({apiKey:d,dangerouslyAllowBrowser:!0});(0,r.useEffect)((function(){Vn(void 0,void 0,void 0,(function(){var e,n,r;return Hn(this,(function(a){console.log("StoredCards component mounted, forcing complete reload of cards...");try{if(e=localStorage.getItem("anki_stored_cards"))try{n=JSON.parse(e),console.log("Direct from localStorage, found cards:",n.length)}catch(e){console.error("Failed to parse localStorage data directly:",e)}else console.log("No cards found directly in localStorage")}catch(e){console.error("Error accessing localStorage directly:",e)}return t(Ae()),r=setTimeout((function(){if(console.log("Current stored cards after initial load:",o.length),0===o.length){console.log("No cards loaded, trying to load directly from localStorage...");try{var e=localStorage.getItem("anki_stored_cards");if(e){var n=JSON.parse(e);Array.isArray(n)&&n.length>0&&(console.log("Found cards directly in localStorage, manually setting in Redux..."),t({type:"SET_STORED_CARDS",payload:n}))}}catch(e){console.error("Failed to manually load cards:",e)}}if(o.length>0){var r=o.filter((function(e){return"not_exported"===e.exportStatus})).length,a=o.filter((function(e){return"exported_to_anki"===e.exportStatus||"exported_to_file"===e.exportStatus})).length;console.log("Card stats: total=",o.length,"not_exported=",r,"exported=",a),o.forEach((function(e,t){var n,r,o,a;(e.image||e.imageUrl)&&console.log("Card ".concat(t," (").concat(e.id,") has images:"),{hasImage:!!e.image,hasImageUrl:!!e.imageUrl,imageType:typeof e.image,imageUrlType:typeof e.imageUrl,imageLength:null===(n=e.image)||void 0===n?void 0:n.length,imageUrlLength:null===(r=e.imageUrl)||void 0===r?void 0:r.length,imageStart:null===(o=e.image)||void 0===o?void 0:o.substring(0,30),imageUrlStart:null===(a=e.imageUrl)||void 0===a?void 0:a.substring(0,30)})}))}}),500),[2,function(){return clearTimeout(r)}]}))}))}),[t,o.length]),(0,r.useEffect)((function(){console.log("Stored cards updated:",o)}),[o]);var ke=function(){return Vn(void 0,void 0,void 0,(function(){var e,n;return Hn(this,(function(r){switch(r.label){case 0:if(!l)return[2];r.label=1;case 1:return r.trys.push([1,3,4,5]),k(!0),[4,re(u)];case 2:return(e=r.sent()).result&&(t({type:"FETCH_DECKS_SUCCESS",payload:e.result}),!i&&e.result.length>0&&t(qn(e.result[0].deckId))),[3,5];case 3:return n=r.sent(),console.error("Error loading decks:",n),l&&we("Failed to load Anki decks. Make sure Anki is running with AnkiConnect plugin."),[3,5];case 4:return k(!1),[7];case 5:return[2]}}))}))};(0,r.useEffect)((function(){l&&0===s.length&&ke()}),[l]);var Ee=function(){if(console.log("All cards in store:",o.length,"cards"),!Array.isArray(o)||0===o.length)return console.log("No cards to filter"),[];var e,t={not_exported:0,exported_to_anki:0,exported_to_file:0,unknown:0};switch(o.forEach((function(e){"not_exported"===e.exportStatus?t.not_exported++:"exported_to_anki"===e.exportStatus?t.exported_to_anki++:"exported_to_file"===e.exportStatus?t.exported_to_file++:t.unknown++})),console.log("Card status counts:",t),A){case"not_exported":e=o.filter((function(e){return"not_exported"===e.exportStatus})),console.log("Filtered to not_exported cards:",e.length);break;case"exported":e=o.filter((function(e){return"exported_to_anki"===e.exportStatus||"exported_to_file"===e.exportStatus})),console.log("Filtered to exported cards:",e.length);break;default:e=Wn([],o,!0),console.log("Using all cards:",e.length)}var n=e.sort((function(e,t){return new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()}));return console.log("Final filtered and sorted cards:",n.length),n}(),Ie=function(){if(0===Ee.length)return[];var e=(ne-1)*ie,t=e+ie;return e>=Ee.length?(oe(1),Ee.slice(0,ie)):(console.log("Pagination debug:",{totalCards:o.length,filteredCards:Ee.length,currentPage:ne,itemsPerPage:ie,startIndex:e,endIndex:t,cardsOnThisPage:Ee.slice(e,t).length}),Ee.slice(e,t))}();(0,r.useEffect)((function(){var e=Math.max(1,Math.ceil(Ee.length/ie));ue(e),ne>e&&oe(1)}),[Ee.length,ie]);var Te={all:o.length,not_exported:o.filter((function(e){return"not_exported"===e.exportStatus})).length,exported:o.filter((function(e){return"exported_to_anki"===e.exportStatus||"exported_to_file"===e.exportStatus})).length},Me=function(e){var t=new Date(e),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),o=String(t.getHours()).padStart(2,"0"),a=String(t.getMinutes()).padStart(2,"0");return"".concat(r,"/").concat(n," ").concat(o,":").concat(a)},Fe=function(e){switch(e){case"exported_to_anki":return(0,a.jsx)("span",Un({style:{fontSize:"11px",color:"#10B981",marginLeft:"8px"}},{children:"\u2713 Anki"}));case"exported_to_file":return(0,a.jsx)("span",Un({style:{fontSize:"11px",color:"#2563EB",marginLeft:"8px"}},{children:"\u2713 File"}));default:return null}},ze=function(e){return _===e?null:(0,a.jsxs)("div",Un({className:"card-content",style:{padding:"8px"}},{children:[(e.text||e.front)&&(e.mode===X.d.LanguageLearning?(0,a.jsx)("p",Un({style:{fontWeight:"bold",fontSize:"14px",marginBottom:"4px",color:"#111827",lineHeight:"1.4",wordWrap:"break-word"}},{children:e.text})):(0,a.jsx)("div",Un({style:{fontWeight:600,fontSize:"14px",marginBottom:"4px",color:"#111827",lineHeight:"1.4",wordWrap:"break-word"}},{children:(0,a.jsx)(Xt,{content:e.front||"",enableAI:!0,style:{fontSize:"14px",color:"#111827"}})}))),(e.translation||e.back)&&(0,a.jsx)("div",Un({style:{color:"#374151",fontSize:"13px",marginBottom:"8px",lineHeight:"1.4",wordWrap:"break-word"}},{children:e.mode===X.d.LanguageLearning?e.translation:e.back&&(0,a.jsx)(Xt,{content:e.back.length>150?e.back.substring(0,150)+"...":e.back,enableAI:!0,style:{fontSize:"13px",color:"#374151"}})})),e.mode===X.d.LanguageLearning&&e.examples&&e.examples.length>0&&(0,a.jsxs)("div",Un({style:{marginTop:"8px"}},{children:[(0,a.jsx)("p",Un({style:{fontSize:"12px",color:"#6B7280",marginBottom:"4px"}},{children:"Examples:"})),e.examples.slice(0,1).map((function(e,t){var n=e[0],r=e[1];return(0,a.jsxs)("div",Un({style:{fontSize:"12px",marginBottom:"2px"}},{children:[(0,a.jsx)("p",Un({style:{color:"#111827",marginBottom:"2px",lineHeight:"1.4",wordWrap:"break-word",overflow:"visible",whiteSpace:"normal"}},{children:n})),r&&(0,a.jsx)("p",Un({style:{color:"#6B7280",fontStyle:"italic",lineHeight:"1.4",wordWrap:"break-word",overflow:"visible",whiteSpace:"normal"}},{children:r}))]}),t)})),e.examples.length>1&&(0,a.jsxs)("p",Un({style:{fontSize:"11px",color:"#6B7280"}},{children:["+",e.examples.length-1," more examples"]}))]})),(e.image||e.imageUrl)&&(0,a.jsx)("div",Un({style:{marginTop:"8px",textAlign:"center"}},{children:(0,a.jsx)("img",{src:e.image||e.imageUrl||"",alt:"Card image",style:{maxWidth:"100%",maxHeight:"80px",borderRadius:"4px",border:"1px solid #E5E7EB",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"},onError:function(t){var n,r,o,a,i;console.error("Image failed to load for card:",e.id,"image data:",{hasImage:!!e.image,hasImageUrl:!!e.imageUrl,imageLength:null===(n=e.image)||void 0===n?void 0:n.length,imageUrlLength:null===(r=e.imageUrl)||void 0===r?void 0:r.length,imagePreview:null===(o=e.image)||void 0===o?void 0:o.substring(0,50),imageUrlPreview:null===(a=e.imageUrl)||void 0===a?void 0:a.substring(0,50),imageSrc:(e.image||e.imageUrl||"").substring(0,100),usingType:e.image?"base64 (permanent)":"url (temporary)"});var s=t.target;s.style.display="none";var l=document.createElement("div");l.style.cssText="\n                                    width: 100%;\n                                    height: 60px;\n                                    background-color: #F3F4F6;\n                                    border: 1px dashed #D1D5DB;\n                                    border-radius: 4px;\n                                    display: flex;\n                                    align-items: center;\n                                    justify-content: center;\n                                    color: #6B7280;\n                                    font-size: 12px;\n                                ",l.textContent=e.image?"\u{1f5bc}\ufe0f Image error":"\u{1f5bc}\ufe0f URL expired",null===(i=s.parentNode)||void 0===i||i.insertBefore(l,s.nextSibling)},onLoad:function(){var t,n;console.log("\u2705 Image loaded successfully for card:",e.id,{usingType:e.image?"base64 (permanent)":"url (temporary)",imageLength:null===(t=e.image)||void 0===t?void 0:t.length,imageUrlLength:null===(n=e.imageUrl)||void 0===n?void 0:n.length})}})})),(0,a.jsxs)("div",Un({style:{marginTop:"8px",display:"flex",justifyContent:"space-between",alignItems:"center"}},{children:[(0,a.jsx)("span",Un({style:{fontSize:"10px",color:"#6B7280",backgroundColor:e.mode===X.d.LanguageLearning?"#EEF2FF":"#F0FDF4",padding:"2px 6px",borderRadius:"12px",border:"1px solid ".concat(e.mode===X.d.LanguageLearning?"#C7D2FE":"#BBF7D0"),fontWeight:"500"}},{children:e.mode===X.d.LanguageLearning?"\u{1f5e3}\ufe0f Language":"\u{1f4da} General"})),(0,a.jsx)("span",Un({style:{fontSize:"10px",color:"#9CA3AF"}},{children:Me(e.createdAt)}))]}))]}))},_e=function(e){t(qn(e.target.value))},Re=function(){F((function(e){return!e}))},je=function(e){console.log("Starting to edit card:",e.id),console.log("Card data:",e),R(e),G(Un({},e)),O(!0),P(!0),$(""),V(!1),Q(!1),ee(!1),console.log("Modal state set for editing card:",e.id)},Be=function(){console.log("Canceling edit, resetting modal state..."),R(null),G(null),O(!1),P(!1),$(""),V(!1),Q(!1),ee(!1),console.log("Edit canceled, modal should be hidden now.")},Oe=function(){return Vn(void 0,void 0,void 0,(function(){var e,t;return Hn(this,(function(r){if(!_||!W)return[2];try{if(ee(!0),(e=Un(Un({},_),{text:W.text||_.text||"",translation:W.translation||_.translation||"",examples:Array.isArray(W.examples)?W.examples:Array.isArray(_.examples)?_.examples:[],front:W.front||_.front||"",back:W.back||_.back||"",image:W.image||_.image||null,imageUrl:W.imageUrl||_.imageUrl||null,linguisticInfo:W.linguisticInfo||_.linguisticInfo||"",transcription:W.transcription||_.transcription||""})).mode===X.d.LanguageLearning){if(!e.text||!e.translation)return we("Please provide both text and translation"),[2];e.text=e.text.trim(),e.translation=e.translation.trim()}else{if(!e.front||!e.back)return we("Please provide both front and back content"),[2];e.front=e.front.trim(),e.back=(null===(t=e.back)||void 0===t?void 0:t.trim())||null}console.log("Final data being saved to Redux:",e),n.updateStoredCard(e),Be()}catch(e){console.error("Error saving card:",e),we("Failed to update card. Please try again.")}finally{ee(!1)}return[2]}))}))},Ne=function(){return Vn(void 0,void 0,void 0,(function(){var e,t,n,r,o,a,i;return Hn(this,(function(s){switch(s.label){case 0:if(!_)return[2];s.label=1;case 1:if(s.trys.push([1,6,,7]),!d)throw new Error("OpenAI API key is not configured. Please add it in the settings.");return e=(null==W?void 0:W.text)||_.text,console.log("Starting image generation for text:",e),[4,(0,Ue.getDescriptionImage)(d,e,p)];case 2:if(t=s.sent(),console.log("Description generated:",t),!t)throw new Error("Failed to generate image description");return n=p?"".concat(t,". ").concat(p):t,[4,fetch("https://api.openai.com/v1/images/generations",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(d)},body:JSON.stringify({prompt:n,n:1,size:"512x512",response_format:"url"})})];case 3:return[4,s.sent().json()];case 4:if(r=s.sent(),console.log("OpenAI direct API response:",r),!r.data||!r.data[0]||!r.data[0].url)throw new Error("OpenAI did not return an image URL");return o=r.data[0].url,console.log("Image URL generated:",o),[4,new Promise((function(e,t){chrome.runtime.sendMessage(o,(function(n){if(chrome.runtime.lastError)return console.error("Error sending message:",chrome.runtime.lastError),void t(chrome.runtime.lastError);console.log("Response from background script:",n),n&&n.status&&n.data?e(n.data):t(new Error("Failed to get image data from background script"))}))}))];case 5:return a=s.sent(),console.log("Image data received from background"),W&&G(Un(Un({},W),{imageUrl:a,image:a})),[3,7];case 6:return i=s.sent(),console.error("Error generating image:",i),we("Image generation failed: ".concat((null==i?void 0:i.message)||"Unknown error")),[3,7];case 7:return[2]}}))}))},Pe=function(){return Vn(void 0,void 0,void 0,(function(){return Hn(this,(function(e){if(!_)return[2];try{Q(!0),(null==W?void 0:W.text)||_.text,we("Examples generation would be implemented here","info")}catch(e){console.error("Error generating examples:",e),we("Examples generation failed: ".concat((null==e?void 0:e.message)||"Unknown error"))}finally{Q(!1)}return[2]}))}))},Le=function(){return Vn(void 0,void 0,void 0,(function(){return Hn(this,(function(e){if(!D.trim()||U||!_)return[2];V(!0);try{we('Custom instruction "'.concat(D,'" would be applied here'),"info"),$("")}catch(e){console.error("Error applying custom instructions:",e),we("Failed to apply custom instructions")}finally{V(!1)}return[2]}))}))},De=function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),Le())},$e=function(e){W&&G(Un(Un({},W),{translation:e}))},Ve=function(e){W&&G(Un(Un({},W),{examples:e}))},He=function(e){W&&G(Un(Un({},W),{back:e}))},We=function(e){W&&G(Un(Un({},W),{linguisticInfo:e}))},Ge=function(e){e>=1&&e<=ce&&oe(e)},Ye=function(e){se(Number(e.target.value)),oe(1)};(0,r.useEffect)((function(){var e,t;console.log("Modal state changed:",{showEditModal:B,editingCard:null==_?void 0:_.id,currentCardData:{text:(null===(e=h.text)||void 0===e?void 0:e.substring(0,20))+"...",translation:(null===(t=h.translation)||void 0===t?void 0:t.substring(0,20))+"..."}})}),[B,_,h.text,h.translation]);var Xe,Ke=function(){return Vn(void 0,void 0,void 0,(function(){var e,t,r,a,i,s,l,c;return Hn(this,(function(u){if(0===g.length)return we("Please select at least one card to export"),[2];try{be(!0),e=o.filter((function(e){return g.includes(e.id)})),t="#separator:tab\n#html:true\n",e.forEach((function(e,n){var r,o,a,i;if(console.log("Processing card ".concat(n," for file export:"),{id:e.id,mode:e.mode,hasImage:!!e.image,hasImageUrl:!!e.imageUrl,imageType:typeof e.image,imageUrlType:typeof e.imageUrl,imageLength:null===(r=e.image)||void 0===r?void 0:r.length,imageUrlLength:null===(o=e.imageUrl)||void 0===o?void 0:o.length,imagePreview:null===(a=e.image)||void 0===a?void 0:a.substring(0,50),imageUrlPreview:null===(i=e.imageUrl)||void 0===i?void 0:i.substring(0,50),hasLinguisticInfo:!!e.linguisticInfo}),e.mode===X.d.LanguageLearning){var s=e.text.trim(),l="";if(e.translation&&(l+="<b>".concat(e.translation,"</b>")),e.examples&&e.examples.length>0&&(l+="<br><br>",e.examples.forEach((function(e,t){var n=e[0],r=e[1];l+="".concat(t+1,". ").concat(n),r&&(l+="<br><span style='font-size: 0.8em;'><i>".concat(r,"</i></span>")),l+="<br><br>"}))),e.image)if((g=e.image).startsWith("data:")){var c="base64,";if(-1!==(v=g.indexOf(c))){var u=g.substring(v+c.length);l+='<div><img src="data:image/jpeg;base64,'.concat(u,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else l+='<div><img src="'.concat(g,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else l+='<div><img src="data:image/jpeg;base64,'.concat(g,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>');else if(e.imageUrl){if((y=e.imageUrl).startsWith("data:")){c="base64,";if(-1!==(v=y.indexOf(c))){u=y.substring(v+c.length);l+='<div><img src="data:image/jpeg;base64,'.concat(u,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else l+='<div><img src="'.concat(y,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else y.startsWith("http")?l+='<div><img src="'.concat(y,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>'):l+='<div><img src="data:image/jpeg;base64,'.concat(y,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}if(e.linguisticInfo&&e.linguisticInfo.trim()){var d=e.linguisticInfo.trim().split("\n").filter((function(e){return e.trim()})),p="";d.forEach((function(e){var t=e.trim();if(t.match(/^[\u0410-\u042f\u0401A-Z][^:]*:$/))p+='<div style="color: #2563EB; font-weight: bold; margin-top: 12px; margin-bottom: 4px;">'.concat(t,"</div>");else if(t.startsWith("\u2022")||t.startsWith("-")||t.startsWith("*")){var n=t.replace(/^[\u2022\-*]\s*/,"");p+='<div style="margin-left: 16px; margin-bottom: 2px; color: #374151;">\u2022 '.concat(n,"</div>")}else if(t.includes(":")&&!t.endsWith(":")){var r=t.split(":"),o=r[0],a=r.slice(1).join(":").trim();p+='<div style="margin-bottom: 4px;"><span style="color: #6B7280; font-weight: 500;">'.concat(o.trim(),':</span> <span style="color: #111827;">').concat(a,"</span></div>")}else t&&(p+='<div style="margin-bottom: 6px; color: #374151; line-height: 1.4;">'.concat(t,"</div>"))})),p&&(l+='<div style="margin-top: 20px; padding: 12px; background-color: #F8FAFC; border-left: 4px solid #2563EB; border-radius: 0 6px 6px 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1);"><div style="color: #1E40AF; font-weight: bold; font-size: 14px; margin-bottom: 8px; display: flex; align-items: center;"><span style="margin-right: 6px;">\u{1f4da}</span>Grammar & Linguistics</div>'.concat(p,"</div>"))}var h=s.replace(/\t/g," ").replace(/\n/g," ").trim(),f=l.replace(/\t/g," ").replace(/\r?\n/g,"<br>").trim();t+="".concat(h,"\t").concat(f,"\n"),console.log("Exported card ".concat(n,":"),{front:h.substring(0,50),backLength:f.length,hasLinguisticInfo:f.includes("Grammar & Linguistics")})}else if(e.mode===X.d.GeneralTopic){s=(e.front||e.text||"No content").trim();var g,m=(e.back||e.text||"").trim();if(e.image)if((g=e.image).startsWith("data:")){c="base64,";if(-1!==(v=g.indexOf(c))){u=g.substring(v+c.length);m+='<div><img src="data:image/jpeg;base64,'.concat(u,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else m+='<div><img src="'.concat(g,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else m+='<div><img src="data:image/jpeg;base64,'.concat(g,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>');else if(e.imageUrl){var y;if((y=e.imageUrl).startsWith("data:")){var v;c="base64,";if(-1!==(v=y.indexOf(c))){u=y.substring(v+c.length);m+='<div><img src="data:image/jpeg;base64,'.concat(u,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else m+='<div><img src="'.concat(y,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else y.startsWith("http")?m+='<div><img src="'.concat(y,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>'):m+='<div><img src="data:image/jpeg;base64,'.concat(y,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}h=s.replace(/\t/g," ").replace(/\n/g," ").trim(),f=m.replace(/\t/g," ").replace(/\r?\n/g,"<br>").trim();t+="".concat(h,"\t").concat(f,"\n"),console.log("Exported General Topic card ".concat(n,":"),{front:h.substring(0,50),backLength:f.length,hasImage:!(!e.image&&!e.imageUrl),imageSource:e.image?"image field":e.imageUrl?"imageUrl field":"none"})}})),(r=ge.trim())||(r="anki_cards"),(r=r.replace(/[<>:"/\\|?*]/g,"_")).toLowerCase().endsWith(".txt")||(r+=".txt"),a=new Blob([t],{type:"text/plain;charset=utf-8;"}),i=URL.createObjectURL(a),(s=document.createElement("a")).setAttribute("href",i),s.setAttribute("download",r),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),l=e.length,c=e.filter((function(e){return e.linguisticInfo&&e.linguisticInfo.trim()})).length,console.log("Export complete: ".concat(l," cards exported, ").concat(c," with grammar information")),g.forEach((function(e){n.updateCardExportStatus(e,"exported_to_file"),console.log("Updated card ".concat(e," export status to 'exported_to_file'"))})),he(!1),setTimeout((function(){try{var e=localStorage.getItem("anki_stored_cards");if(e){var t=JSON.parse(e);console.log("Verified localStorage after file export:",t.filter((function(e){return e.id&&g.includes(e.id)})).map((function(e){return{id:e.id,status:e.exportStatus}})))}}catch(e){console.error("Error verifying localStorage after file export:",e)}}),500)}catch(e){console.error("Error during file export:",e),we("Failed to export cards. Please try again.")}finally{be(!1)}return[2]}))}))};return(0,a.jsxs)("div",Un({style:{display:"flex",flexDirection:"column",height:"100%",padding:"12px",paddingBottom:"20px",overflowY:"auto",overflowX:"hidden",width:"100%",maxWidth:"320px",margin:"0 auto",position:"relative"}},{children:[(0,a.jsx)("div",Un({style:{display:"flex",justifyContent:"center",alignItems:"center",marginBottom:"16px",paddingBottom:"12px",borderBottom:"1px solid #E5E7EB",marginTop:"20px"}},{children:(0,a.jsxs)("div",Un({style:{fontWeight:"600",fontSize:"16px",color:"#111827",background:"linear-gradient(to right, #4F46E5, #2563EB)",backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",padding:"4px 12px",borderRadius:"16px",border:"1px solid #E5E7EB",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"}},{children:["Saved Cards (",o.length,")"]}))})),o.length>0?(0,a.jsxs)(a.Fragment,{children:[(Xe={base:{padding:"8px 16px",fontSize:"14px",fontWeight:"500",borderRadius:"6px 6px 0 0",cursor:"pointer",textAlign:"center",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"6px"},active:{backgroundColor:"#ffffff",color:"#2563EB",borderBottom:"2px solid #2563EB"},inactive:{backgroundColor:"#F3F4F6",color:"#6B7280",borderBottom:"2px solid transparent"}},(0,a.jsxs)("div",Un({style:{display:"flex",width:"100%",borderBottom:"1px solid #E5E7EB",marginBottom:"16px",backgroundColor:"#F3F4F6"}},{children:[(0,a.jsxs)("div",Un({onClick:function(){return I("not_exported")},style:Un(Un(Un({},Xe.base),"not_exported"===A?Xe.active:Xe.inactive),{flex:1})},{children:["New",(0,a.jsx)("span",Un({style:{backgroundColor:"not_exported"===A?"#2563EB":"#9CA3AF",color:"white",borderRadius:"9999px",fontSize:"12px",padding:"1px 6px",minWidth:"20px"}},{children:Te.not_exported}))]})),(0,a.jsxs)("div",Un({onClick:function(){return I("all")},style:Un(Un(Un({},Xe.base),"all"===A?Xe.active:Xe.inactive),{flex:1})},{children:["All",(0,a.jsx)("span",Un({style:{backgroundColor:"all"===A?"#2563EB":"#9CA3AF",color:"white",borderRadius:"9999px",fontSize:"12px",padding:"1px 6px",minWidth:"20px"}},{children:Te.all}))]})),(0,a.jsxs)("div",Un({onClick:function(){return I("exported")},style:Un(Un(Un({},Xe.base),"exported"===A?Xe.active:Xe.inactive),{flex:1})},{children:["Exported",(0,a.jsx)("span",Un({style:{backgroundColor:"exported"===A?"#2563EB":"#9CA3AF",color:"white",borderRadius:"9999px",fontSize:"12px",padding:"1px 6px",minWidth:"20px"}},{children:Te.exported}))]}))]}))),l&&function(){var e;if(!l)return null;var t={container:{display:"flex",flexDirection:"column",gap:"8px",marginBottom:"16px",backgroundColor:"#F9FAFB",padding:"12px",borderRadius:"8px",border:"1px solid #E5E7EB"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},title:{fontSize:"14px",fontWeight:"600",color:"#111827"},button:{backgroundColor:"transparent",border:"none",cursor:"pointer",color:"#6B7280",display:"flex",alignItems:"center",padding:"0",fontSize:"12px"},selectContainer:{display:"flex",alignItems:"center",gap:"8px",width:"100%"},select:{flex:1,padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"14px",cursor:"pointer"},refreshButton:{backgroundColor:"#F3F4F6",border:"1px solid #E5E7EB",borderRadius:"6px",cursor:"pointer",color:"#6B7280",display:"flex",alignItems:"center",justifyContent:"center",padding:"8px",minWidth:"36px",height:"38px"}};return M?(0,a.jsxs)("div",Un({style:t.container},{children:[(0,a.jsxs)("div",Un({style:t.header},{children:[(0,a.jsx)("span",Un({style:t.title},{children:"Select Anki Deck"})),(0,a.jsx)("button",Un({onClick:Re,style:t.button},{children:"Hide"}))]})),(0,a.jsxs)("div",Un({style:t.selectContainer},{children:[(0,a.jsxs)("select",Un({value:i,onChange:_e,style:t.select,disabled:S},{children:[0===s.length&&(0,a.jsx)("option",Un({value:""},{children:"No decks available"})),s.map((function(e){return(0,a.jsx)("option",Un({value:e.deckId},{children:e.name}),e.deckId)}))]})),(0,a.jsx)("button",Un({onClick:ke,disabled:S,title:"Refresh decks list",style:t.refreshButton,"aria-label":"Refresh decks"},{children:S?(0,a.jsx)("span",Un({style:{marginLeft:"2px"}},{children:(0,a.jsx)(Ft,{type:"spinner",size:"small",color:"#4B5563"})})):(0,a.jsx)(Et,{size:14})}))]})),(0,a.jsx)("style",{children:"\n                    @keyframes spin {\n                        0% { transform: rotate(0deg); }\n                        100% { transform: rotate(360deg); }\n                    }\n                    "})]})):(0,a.jsxs)("div",Un({style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",marginBottom:"12px",padding:"8px 12px",backgroundColor:"#F9FAFB",borderRadius:"6px",border:"1px solid #E5E7EB"}},{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",Un({style:{fontSize:"13px",color:"#6B7280"}},{children:"Anki Deck:"})),(0,a.jsx)("span",Un({style:{fontSize:"14px",fontWeight:"500",marginLeft:"8px",color:"#111827"}},{children:(null===(e=s.find((function(e){return e.deckId===i})))||void 0===e?void 0:e.name)||"None selected"}))]}),(0,a.jsx)("button",Un({onClick:Re,style:{backgroundColor:"transparent",border:"none",cursor:"pointer",color:"#2563EB",fontSize:"13px"}},{children:"Change"}))]}))}(),(0,a.jsxs)("div",Un({style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"}},{children:[(0,a.jsxs)("div",Un({style:{display:"flex",alignItems:"center"}},{children:[(0,a.jsx)("input",{type:"checkbox",id:"selectAll",checked:g.length===Ee.length&&Ee.length>0,onChange:function(){_||(g.length===Ee.length?y([]):y(Ee.map((function(e){return e.id}))))},style:{marginRight:"8px"},disabled:null!==_}),(0,a.jsx)("label",Un({htmlFor:"selectAll",style:{fontSize:"14px",cursor:null!==_?"default":"pointer",opacity:null!==_?.6:1}},{children:g.length===Ee.length&&Ee.length>0?"Deselect All":"Select All"}))]})),(0,a.jsxs)("div",Un({style:{display:"flex",gap:"8px",flexWrap:"wrap"}},{children:[(0,a.jsx)("button",Un({onClick:function(){return Vn(void 0,void 0,void 0,(function(){var e,r,a,s,l,d,p,h;return Hn(this,(function(f){switch(f.label){case 0:if(0===g.length)return we("Please select at least one card to save"),[2];x(!0),f.label=1;case 1:f.trys.push([1,10,11,12]),e="Basic",r=o.filter((function(e){return g.includes(e.id)})),a=[],s=[],l=function(e){var t,n,r,o,i,l,c,u,d,p;return Hn(this,(function(h){switch(h.label){case 0:return e.mode===X.d.LanguageLearning&&e.translation?(n=null,e.image&&(e.image.startsWith("data:")?(o="base64,",i=e.image.indexOf(o),n=-1!==i?e.image.substring(i+o.length):e.image):n=e.image),t={text:e.text,translation:e.translation,examples:e.examples||[],image_base64:n,linguisticInfo:e.linguisticInfo},console.log("Adding language learning card to Anki export:",{cardId:e.id,text:e.text,hasImage:!!n,imageLength:null==n?void 0:n.length,imagePreview:null==n?void 0:n.substring(0,30)}),a.push(t),[3,13]):[3,1];case 1:return e.mode!==X.d.GeneralTopic||!e.front&&!e.text||!e.back&&!e.text?[3,13]:(n=null,(r=e.image||e.imageUrl)?r.startsWith("data:")?(o="base64,",i=r.indexOf(o),n=-1!==i?r.substring(i+o.length):r,[3,12]):[3,2]:[3,12]);case 2:if(!r.startsWith("http://")&&!r.startsWith("https://"))return[3,11];h.label=3;case 3:return h.trys.push([3,9,,10]),console.log("Fetching image from URL for card ".concat(e.id,": ").concat(r)),[4,fetch(r)];case 4:return(l=h.sent()).ok?[4,l.blob()]:[3,7];case 5:return c=h.sent(),[4,new Promise((function(e){var t=new FileReader;t.onloadend=function(){var n=t.result,r="base64,",o=n.indexOf(r);e(-1!==o?n.substring(o+7):n)},t.readAsDataURL(c)}))];case 6:return u=h.sent(),n=u,console.log("Successfully converted URL to base64 for card ".concat(e.id)),[3,8];case 7:console.warn("Failed to fetch image from URL for card ".concat(e.id,": ").concat(l.status)),h.label=8;case 8:return[3,10];case 9:return d=h.sent(),console.error("Error fetching image from URL for card ".concat(e.id,":"),d),[3,10];case 10:return[3,12];case 11:n=r,h.label=12;case 12:p={front:e.front||e.text||"No content",back:e.back||e.text||"No content",text:e.text,image_base64:n},console.log("Adding general topic card to Anki export:",{cardId:e.id,text:e.text,hasImage:!!n,imageLength:null==n?void 0:n.length,imagePreview:null==n?void 0:n.substring(0,30),originalImageSource:null==r?void 0:r.substring(0,50),hadImageField:!!e.image,hadImageUrlField:!!e.imageUrl,usedField:e.image?"image":e.imageUrl?"imageUrl":"none"}),s.push(p),h.label=13;case 13:return[2]}}))},d=0,p=r,f.label=2;case 2:return d<p.length?(h=p[d],[5,l(h)]):[3,5];case 3:f.sent(),f.label=4;case 4:return d++,[3,2];case 5:return a.length>0?[4,t(Ce(X.d.LanguageLearning,c,u,i,e,a))]:[3,7];case 6:f.sent(),f.label=7;case 7:return s.length>0?[4,t(Ce(X.d.GeneralTopic,c,u,i,e,s))]:[3,9];case 8:f.sent(),f.label=9;case 9:return g.forEach((function(e){n.updateCardExportStatus(e,"exported_to_anki"),console.log("Updated card ".concat(e," export status to 'exported_to_anki'"))})),setTimeout((function(){try{var e=localStorage.getItem("anki_stored_cards");if(e){var t=JSON.parse(e);console.log("Verified localStorage after export:",t.filter((function(e){return e.id&&g.includes(e.id)})).map((function(e){return{id:e.id,status:e.exportStatus}})))}}catch(e){console.error("Error verifying localStorage after export:",e)}}),500),[3,12];case 10:return f.sent(),we("Failed to save cards to Anki. Make sure Anki is running and AnkiConnect is properly configured."),[3,12];case 11:return x(!1),[7];case 12:return[2]}}))}))},disabled:b||0===g.length||!l||!i||null!==_,style:{padding:"6px 10px",borderRadius:"6px",backgroundColor:"#10B981",color:"#ffffff",fontSize:"13px",border:"none",cursor:"pointer",opacity:!b&&0!==g.length&&l&&i&&null===_?1:.6},title:null!==_?"Finish editing first":!i&&l?"Please select a deck first":""},{children:b?(0,a.jsx)("div",Un({style:{display:"flex",alignItems:"center",justifyContent:"center"}},{children:(0,a.jsx)(Ft,{type:"spinner",size:"small",inline:!0,color:"#ffffff",text:"Saving to Anki"})})):"Save to Anki"})),(0,a.jsxs)("button",Un({onClick:function(){if(0!==g.length){var e=(new Date).toISOString().split("T")[0],t="anki_cards_".concat(e);me(t),he(!0)}else we("Please select at least one card to export")},disabled:b||0===g.length||null!==_,style:{padding:"6px 10px",borderRadius:"6px",backgroundColor:"#2563EB",color:"#ffffff",fontSize:"13px",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",opacity:b||0===g.length||null!==_?.6:1}},{children:[(0,a.jsx)(lt,{size:12}),(0,a.jsx)("span",{children:"Export"})]}))]}))]})),(0,a.jsx)("div",Un({style:{flex:1,overflow:"auto",marginBottom:"16px"}},{children:0===Ee.length?(0,a.jsx)("div",Un({style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"200px",color:"#6B7280",textAlign:"center",padding:"20px"}},{children:(0,a.jsx)("p",Un({style:{fontSize:"14px"}},{children:"all"===A?"No cards yet":"not_exported"===A?"No new cards":"No exported cards"}))})):Ie.map((function(e){return(0,a.jsxs)("div",Un({style:{border:"1px solid #E5E7EB",borderRadius:"6px",marginBottom:"8px",backgroundColor:g.includes(e.id)?"#F3F4F6":"#ffffff"}},{children:[(0,a.jsxs)("div",Un({style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",borderBottom:_===e?"none":"1px solid #E5E7EB"}},{children:[(0,a.jsxs)("div",Un({style:{display:"flex",alignItems:"center"}},{children:[(0,a.jsx)("input",{type:"checkbox",checked:g.includes(e.id),onChange:function(){return t=e.id,void(_||(g.includes(t)?y(g.filter((function(e){return e!==t}))):y(Wn(Wn([],g,!0),[t],!1))));var t},style:{marginRight:"8px"},disabled:null!==_}),(0,a.jsx)("div",Un({style:{flex:1,minWidth:0}},{children:(0,a.jsxs)("div",Un({style:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:"4px"}},{children:[(0,a.jsx)("span",Un({style:{fontSize:"12px",color:"#6B7280"}},{children:e.mode===X.d.LanguageLearning?"Language":"Topic"})),(0,a.jsx)("span",Un({style:{fontSize:"10px",color:"#9CA3AF"}},{children:Me(e.createdAt)})),Fe(e.exportStatus)]}))}))]})),(0,a.jsx)("div",Un({style:{display:"flex",alignItems:"center",gap:"4px"}},{children:_!==e&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",Un({onClick:function(){return je(e)},style:{backgroundColor:"transparent",border:"1px solid #E5E7EB",borderRadius:"6px",cursor:"pointer",color:"#2563EB",display:"flex",alignItems:"center",justifyContent:"center",padding:"6px 8px",fontSize:"12px",minWidth:"70px",height:"32px",transition:"all 0.2s ease",gap:"4px"},title:"Edit card",onMouseOver:function(e){e.currentTarget.style.backgroundColor="#EFF6FF",e.currentTarget.style.borderColor="#2563EB"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.borderColor="#E5E7EB"}},{children:[(0,a.jsx)(ct,{size:12}),"Edit"]})),(0,a.jsxs)("button",Un({onClick:function(){return t=e.id,n.deleteStoredCard(t),void y((function(e){return e.filter((function(e){return e!==t}))}));var t},style:{backgroundColor:"transparent",border:"1px solid #E5E7EB",borderRadius:"6px",cursor:"pointer",color:"#EF4444",display:"flex",alignItems:"center",justifyContent:"center",padding:"6px 8px",fontSize:"12px",minWidth:"70px",height:"32px",transition:"all 0.2s ease",gap:"4px"},title:"Delete card",onMouseOver:function(e){e.currentTarget.style.backgroundColor="#FEF2F2",e.currentTarget.style.borderColor="#EF4444"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.borderColor="#E5E7EB"}},{children:[(0,a.jsx)(Tt,{size:12}),"Delete"]}))]})}))]})),ze(e)]}),e.id)}))})),(0,a.jsxs)("div",Un({style:{display:"flex",flexDirection:"column",gap:"12px",marginTop:"16px",marginBottom:"16px",padding:"12px",backgroundColor:"#F9FAFB",borderRadius:"8px",border:"1px solid #E5E7EB"}},{children:[(0,a.jsxs)("div",Un({style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},{children:[(0,a.jsx)("div",Un({style:{display:"flex",alignItems:"center",gap:"8px"}},{children:(0,a.jsxs)("select",Un({value:ie,onChange:Ye,style:{padding:"6px 8px",borderRadius:"6px",border:"1px solid #D1D5DB",fontSize:"13px",backgroundColor:"#FFFFFF",color:"#111827",fontWeight:"500",cursor:"pointer",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)",WebkitAppearance:"none",MozAppearance:"none",appearance:"none",backgroundImage:'url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2212%22%20height%3D%2212%22%20viewBox%3D%220%200%2012%2012%22%3E%3Cpath%20fill%3D%22%23424242%22%20d%3D%22M6%2C9L1.2%2C4.2%20c-0.4-0.4-0.4-1%2C0-1.4s1-0.4%2C1.4%2C0L6%2C6.2l3.4-3.4c0.4-0.4%2C1-0.4%2C1.4%2C0s0.4%2C1%2C0%2C1.4L6%2C9z%22%2F%3E%3C%2Fsvg%3E")',backgroundRepeat:"no-repeat",backgroundPosition:"right 8px center",paddingRight:"28px",minWidth:"90px"},"aria-label":"Cards per page"},{children:[(0,a.jsx)("option",Un({value:5},{children:"5 per page"})),(0,a.jsx)("option",Un({value:10},{children:"10 per page"})),(0,a.jsx)("option",Un({value:20},{children:"20 per page"})),(0,a.jsx)("option",Un({value:50},{children:"50 per page"}))]}))})),(0,a.jsx)("div",Un({style:{display:"flex",alignItems:"center",fontSize:"13px",fontWeight:"500",color:"#4B5563"}},{children:Ee.length>0?"".concat(Math.min((ne-1)*ie+1,Ee.length),"-").concat(Math.min(ne*ie,Ee.length)," of ").concat(Ee.length," cards"):"0 cards"}))]})),(0,a.jsx)("div",Un({style:{display:"flex",justifyContent:"center",alignItems:"center"}},{children:(0,a.jsxs)("div",Un({style:{display:"flex",alignItems:"center",border:"1px solid #D1D5DB",borderRadius:"8px",overflow:"hidden",backgroundColor:"#FFFFFF",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"}},{children:[(0,a.jsx)("button",Un({onClick:function(){return Ge(1)},disabled:1===ne,style:{padding:"8px 10px",backgroundColor:"transparent",border:"none",borderRight:"1px solid #E5E7EB",cursor:1===ne?"default":"pointer",color:1===ne?"#9CA3AF":"#111827",display:"flex",alignItems:"center",justifyContent:"center",transition:"background-color 0.2s"},onMouseOver:function(e){1!==ne&&(e.currentTarget.style.backgroundColor="#F9FAFB")},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent"},"aria-label":"Go to first page",title:"First page"},{children:(0,a.jsx)("svg",Un({width:"14",height:"14",fill:"currentColor",viewBox:"0 0 20 20"},{children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M15.707 15.707a1 1 0 01-1.414 0l-5-5a1 1 0 010-1.414l5-5a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 010 1.414zm-6 0a1 1 0 01-1.414 0l-5-5a1 1 0 010-1.414l5-5a1 1 0 011.414 1.414L5.414 10l4.293 4.293a1 1 0 010 1.414z",clipRule:"evenodd"})}))})),(0,a.jsx)("button",Un({onClick:function(){return Ge(ne-1)},disabled:1===ne,style:{padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRight:"1px solid #E5E7EB",cursor:1===ne?"default":"pointer",color:1===ne?"#9CA3AF":"#111827",display:"flex",alignItems:"center",justifyContent:"center",transition:"background-color 0.2s"},onMouseOver:function(e){1!==ne&&(e.currentTarget.style.backgroundColor="#F9FAFB")},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent"},"aria-label":"Previous page",title:"Previous page"},{children:(0,a.jsx)(tt,{size:14})})),(0,a.jsxs)("div",Un({style:{padding:"6px 16px",fontSize:"13px",fontWeight:"500",color:"#111827",display:"flex",alignItems:"center",backgroundColor:"transparent",borderRight:"1px solid #E5E7EB",minWidth:"60px",justifyContent:"center"}},{children:[ne," / ",ce||1]})),(0,a.jsx)("button",Un({onClick:function(){return Ge(ne+1)},disabled:ne===ce||0===ce,style:{padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRight:"1px solid #E5E7EB",cursor:ne===ce||0===ce?"default":"pointer",color:ne===ce||0===ce?"#9CA3AF":"#111827",display:"flex",alignItems:"center",justifyContent:"center",transition:"background-color 0.2s"},onMouseOver:function(e){ne!==ce&&0!==ce&&(e.currentTarget.style.backgroundColor="#F9FAFB")},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent"},"aria-label":"Next page",title:"Next page"},{children:(0,a.jsx)(nt,{size:14})})),(0,a.jsx)("button",Un({onClick:function(){return Ge(ce)},disabled:ne===ce||0===ce,style:{padding:"8px 10px",backgroundColor:"transparent",border:"none",cursor:ne===ce||0===ce?"default":"pointer",color:ne===ce||0===ce?"#9CA3AF":"#111827",display:"flex",alignItems:"center",justifyContent:"center",transition:"background-color 0.2s"},onMouseOver:function(e){ne!==ce&&0!==ce&&(e.currentTarget.style.backgroundColor="#F9FAFB")},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent"},"aria-label":"Go to last page",title:"Last page"},{children:(0,a.jsx)("svg",Un({width:"14",height:"14",fill:"currentColor",viewBox:"0 0 20 20"},{children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M4.293 15.707a1 1 0 001.414 0l5-5a1 1 0 000-1.414l-5-5a1 1 0 00-1.414 1.414L8.586 10l-4.293 4.293a1 1 0 000 1.414zm6 0a1 1 0 001.414 0l5-5a1 1 0 000-1.414l-5-5a1 1 0 00-1.414 1.414L14.586 10l-4.293 4.293a1 1 0 000 1.414z",clipRule:"evenodd"})}))}))]}))}))]}))]}):(0,a.jsx)("div",Un({style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"300px",color:"#6B7280",textAlign:"center"}},{children:(0,a.jsx)("p",{children:"No saved cards yet."})})),pe&&(0,a.jsx)("div",Un({style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(4px)"}},{children:(0,a.jsxs)("div",Un({style:{backgroundColor:"#ffffff",borderRadius:"12px",padding:"24px",maxWidth:"400px",width:"90%",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",border:"1px solid #E5E7EB"}},{children:[(0,a.jsxs)("div",Un({style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"20px"}},{children:[(0,a.jsxs)("h3",Un({style:{margin:0,fontSize:"18px",fontWeight:"600",color:"#111827",display:"flex",alignItems:"center",gap:"8px"}},{children:[(0,a.jsx)(lt,{size:16,style:{color:"#2563EB"}}),"Export Cards"]})),(0,a.jsx)("button",Un({onClick:function(){return he(!1)},disabled:ve,style:{backgroundColor:"transparent",border:"none",cursor:ve?"default":"pointer",padding:"4px",borderRadius:"4px",color:"#6B7280",opacity:ve?.5:1}},{children:(0,a.jsx)(It,{size:16})}))]})),(0,a.jsxs)("div",Un({style:{marginBottom:"20px"}},{children:[(0,a.jsxs)("p",Un({style:{margin:"0 0 16px 0",fontSize:"14px",color:"#6B7280",lineHeight:"1.5"}},{children:["Export ",g.length," selected cards to a file. Choose a filename or use the default."]})),(0,a.jsx)("label",Un({style:{display:"block",fontSize:"14px",fontWeight:"500",color:"#374151",marginBottom:"8px"}},{children:"Filename"})),(0,a.jsxs)("div",Un({style:{position:"relative"}},{children:[(0,a.jsx)("input",{type:"text",value:ge,onChange:function(e){return me(e.target.value)},placeholder:"Enter filename (without extension)",disabled:ve,style:{width:"100%",padding:"10px 12px",paddingRight:"48px",border:"1px solid #D1D5DB",borderRadius:"8px",fontSize:"14px",outline:"none",transition:"border-color 0.2s ease",backgroundColor:ve?"#F9FAFB":"#ffffff",opacity:ve?.7:1,boxSizing:"border-box"},onFocus:function(e){ve||(e.target.style.borderColor="#2563EB",e.target.style.boxShadow="0 0 0 3px rgba(37, 99, 235, 0.1)")},onBlur:function(e){e.target.style.borderColor="#D1D5DB",e.target.style.boxShadow="none"},onKeyDown:function(e){"Enter"!==e.key||ve||Ke(),"Escape"===e.key&&he(!1)}}),(0,a.jsx)("span",Un({style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",fontSize:"13px",color:"#9CA3AF",pointerEvents:"none"}},{children:".txt"}))]})),(0,a.jsx)("p",Un({style:{margin:"6px 0 0 0",fontSize:"12px",color:"#6B7280"}},{children:"The .txt extension will be added automatically"}))]})),(0,a.jsxs)("div",Un({style:{display:"flex",gap:"12px",justifyContent:"flex-end"}},{children:[(0,a.jsx)("button",Un({onClick:function(){return he(!1)},disabled:ve,style:{padding:"10px 16px",border:"1px solid #D1D5DB",borderRadius:"8px",backgroundColor:"#ffffff",color:"#374151",fontSize:"14px",fontWeight:"500",cursor:ve?"default":"pointer",transition:"all 0.2s ease",opacity:ve?.5:1},onMouseOver:function(e){ve||(e.currentTarget.style.backgroundColor="#F9FAFB",e.currentTarget.style.borderColor="#9CA3AF")},onMouseOut:function(e){ve||(e.currentTarget.style.backgroundColor="#ffffff",e.currentTarget.style.borderColor="#D1D5DB")}},{children:"Cancel"})),(0,a.jsx)("button",Un({onClick:Ke,disabled:ve||!ge.trim(),style:{padding:"10px 16px",border:"none",borderRadius:"8px",backgroundColor:!ge.trim()||ve?"#9CA3AF":"#2563EB",color:"#ffffff",fontSize:"14px",fontWeight:"500",cursor:!ge.trim()||ve?"default":"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"8px",minWidth:"100px",justifyContent:"center"},onMouseOver:function(e){!ve&&ge.trim()&&(e.currentTarget.style.backgroundColor="#1D4ED8")},onMouseOut:function(e){!ve&&ge.trim()&&(e.currentTarget.style.backgroundColor="#2563EB")}},{children:ve?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Ft,{type:"spinner",size:"small",inline:!0,color:"#ffffff"}),(0,a.jsx)("span",{children:"Exporting..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(lt,{size:14}),(0,a.jsx)("span",{children:"Export"})]})}))]}))]}))})),function(){if(console.log("renderEditModal called. showEditModal:",B,"editingCard:",_),!B||!_)return console.log("Modal not showing because showEditModal:",B,"editingCard:",!!_),null;if(!W)return console.log("No local editing card data available"),null;var e=W.text,t=W.translation,n=W.examples,r=W.front,o=W.back,i=W.image,s=W.imageUrl,l=W.linguisticInfo,c=W.transcription;return console.log("Rendering edit modal with local data:",{text:(null==e?void 0:e.substring(0,20))+"...",translation:(null==t?void 0:t.substring(0,20))+"...",examplesCount:null==n?void 0:n.length,hasImage:!!i,hasImageUrl:!!s}),(0,a.jsx)("div",Un({style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"flex-start",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(2px)",padding:"16px",overflowY:"auto",overflowX:"hidden"},onClick:Be},{children:(0,a.jsxs)("div",Un({style:{backgroundColor:"#ffffff",borderRadius:"12px",maxWidth:"340px",width:"100%",maxHeight:"calc(100% - 32px)",overflowY:"auto",overflowX:"hidden",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",position:"relative",padding:"16px",boxSizing:"border-box",margin:"auto"},onClick:function(e){return e.stopPropagation()}},{children:[(0,a.jsxs)("div",Un({style:{position:"sticky",top:0,display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid #E5E7EB",paddingBottom:"12px",marginBottom:"16px",backgroundColor:"#ffffff",zIndex:2}},{children:[(0,a.jsx)("h3",Un({style:{margin:0,fontSize:"16px",fontWeight:600,color:"#111827"}},{children:"Edit Card LOL"})),(0,a.jsx)("button",Un({onClick:Be,style:{background:"none",border:"none",display:"flex",alignItems:"center",justifyContent:"center",padding:"8px",borderRadius:"50%",cursor:"pointer",transition:"background-color 0.2s"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="#F3F4F6"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="transparent"},"aria-label":"Close"},{children:(0,a.jsx)(It,{size:16,color:"#6B7280"})}))]})),(0,a.jsxs)("div",Un({style:{width:"100%",marginBottom:"12px"}},{children:[(0,a.jsxs)("div",Un({style:{position:"relative",width:"100%",maxWidth:"100%"}},{children:[(0,a.jsx)("input",{type:"text",value:D,onChange:function(e){return $(e.target.value)},onKeyDown:De,placeholder:"Enter custom instructions for this card (e.g., 'regenerate examples', 'change image style')",style:{width:"100%",maxWidth:"100%",padding:"10px 12px",paddingRight:"44px",borderRadius:"8px",border:"1px solid #E5E7EB",fontSize:"14px",color:"#374151",backgroundColor:U?"#F9FAFB":"#FFFFFF",transition:"all 0.2s ease",boxShadow:U?"inset 0 1px 2px rgba(0, 0, 0, 0.05)":"none",boxSizing:"border-box"},disabled:U}),U?(0,a.jsx)("div",Un({style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",padding:"6px",borderRadius:"50%",color:"#4F46E5"}},{children:(0,a.jsx)(Ft,{type:"spinner",size:"small",inline:!0,color:"#4F46E5"})})):(0,a.jsx)("button",Un({onClick:Le,disabled:!D.trim()||U,style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",background:D.trim()?"linear-gradient(to right, #4F46E5, #6366F1)":"none",border:"none",color:D.trim()?"#FFFFFF":"#9CA3AF",cursor:D.trim()?"pointer":"not-allowed",display:"flex",alignItems:"center",justifyContent:"center",padding:"6px",borderRadius:"50%",width:"28px",height:"28px",boxShadow:D.trim()?"0 1px 3px rgba(0, 0, 0, 0.1)":"none",transition:"all 0.2s ease"},title:"Apply instructions"},{children:(0,a.jsx)(xt,{size:14})}))]})),(0,a.jsxs)("div",Un({style:{fontSize:"12px",color:U?"#4F46E5":"#6B7280",marginTop:"6px",display:"flex",alignItems:"center",gap:"6px",fontWeight:U?"500":"normal"}},{children:[U&&(0,a.jsx)("span",{style:{display:"inline-block",width:"6px",height:"6px",borderRadius:"50%",backgroundColor:"#4F46E5",animation:"pulse 1.5s infinite"}}),U?"Applying your instructions...":"Type instructions and press Enter or click the magic wand"]}))]})),(0,a.jsx)(rn,{mode:_.mode,front:r||null,back:o||null,translation:t||null,examples:n||[],imageUrl:s||null,image:i||null,linguisticInfo:l||void 0,transcription:c||null,onNewImage:Ne,onNewExamples:Pe,onAccept:Oe,onViewSavedCards:function(){},onCancel:Be,loadingNewImage:!1,loadingNewExamples:K,loadingAccept:Z,shouldGenerateImage:!0,isSaved:!0,isEdited:!0,createdAt:_.createdAt?new Date(_.createdAt):new Date,setTranslation:$e,setBack:He,setExamples:Ve,setLinguisticInfo:We})]}))}))}(),(0,a.jsx)("div",Un({style:{position:"absolute",top:"16px",right:"16px",zIndex:9999,pointerEvents:"none"}},{children:(0,a.jsx)("div",Un({style:{pointerEvents:"auto"}},{children:Se()}))}))]}))};var Yn="SET_ANKI_AVAILABILITY",Xn=function(e){return{type:Yn,payload:e}},Kn="TOGGLE_SIDEBAR",Qn="SET_SIDEBAR_VISIBILITY",Jn="SET_GLOBAL_SIDEBAR_STATE",Zn="INHERIT_SIDEBAR_STATE",er="SHOW_NOTIFICATION",tr="HIDE_NOTIFICATION",nr=function(e){return{type:tr,payload:{id:e}}},rr=function(){return rr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},rr.apply(this,arguments)};const or=function(){var e=m((function(e){return e.notifications.notifications})),t=E();(0,r.useEffect)((function(){e.forEach((function(e){var n=e.id,r=e.type,o=0;"success"===r||"info"===r?o=5e3:"warning"===r&&(o=6e3),o>0&&setTimeout((function(){t(nr(n))}),o)}))}),[e,t]);return 0===e.length?null:(0,a.jsx)("div",rr({style:{position:"absolute",top:"16px",right:"16px",zIndex:9999,maxWidth:"300px",width:"auto",display:"flex",flexDirection:"column",gap:"8px"}},{children:e.map((function(e){var n=function(e){switch(e){case"success":return{icon:(0,a.jsx)(Je,{size:16}),color:"#059669",bgColor:"#ECFDF5",borderColor:"#10B981"};case"warning":return{icon:(0,a.jsx)(dt,{size:16}),color:"#D97706",bgColor:"#FFFBEB",borderColor:"#F59E0B"};case"info":return{icon:(0,a.jsx)(mt,{size:16}),color:"#2563EB",bgColor:"#EFF6FF",borderColor:"#3B82F6"};default:return{icon:(0,a.jsx)(At,{size:16}),color:"#DC2626",bgColor:"#FEF2F2",borderColor:"#EF4444"}}}(e.type),r=n.icon,o=n.color,i=n.bgColor,s=n.borderColor;return(0,a.jsxs)("div",rr({style:{transform:"translateX(0)",opacity:1,transition:"all 0.3s ease-out",backgroundColor:i,border:"1px solid ".concat(s),borderRadius:"12px",padding:"16px",minWidth:"280px",maxWidth:"320px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",position:"relative",display:"flex",alignItems:"flex-start",gap:"12px"},role:"alert","aria-live":"polite"},{children:[(0,a.jsx)("div",rr({style:{color:o,marginTop:"2px",flexShrink:0}},{children:r})),(0,a.jsx)("div",rr({style:{flex:1,paddingRight:"8px"}},{children:(0,a.jsx)("p",rr({style:{color:"#374151",margin:0,fontSize:"14px",lineHeight:"1.5",fontWeight:500}},{children:e.message}))})),(0,a.jsx)("button",rr({onClick:function(){return n=e.id,void t(nr(n));var n},style:{position:"absolute",top:"8px",right:"8px",background:"transparent",border:"none",color:"#9CA3AF",cursor:"pointer",padding:"4px",borderRadius:"4px",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="rgba(0, 0, 0, 0.1)",e.currentTarget.style.color="#374151"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="#9CA3AF"},"aria-label":"Close notification"},{children:(0,a.jsx)(It,{size:12})}))]}),e.id)}))}))};var ar=function(){return ar=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},ar.apply(this,arguments)},ir="anki_view_prefs_v1",sr="view/HYDRATE",lr="view/SET_MODE",cr="view/SET_VISIBILITY",ur="view/SET_FLOAT_GEOMETRY",dr={preferredModeByTab:{},visibleByTab:{},floatGeometryByTab:{},globalMode:"sidebar",globalVisible:!0},pr=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},hr=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},fr=function(e){var t,n,r;return{preferredModeByTab:null!==(t=null==e?void 0:e.preferredModeByTab)&&void 0!==t?t:{},visibleByTab:null!==(n=null==e?void 0:e.visibleByTab)&&void 0!==n?n:{},floatGeometryByTab:null!==(r=null==e?void 0:e.floatGeometryByTab)&&void 0!==r?r:{},globalMode:"float"===(null==e?void 0:e.globalMode)?"float":"sidebar",globalVisible:"boolean"!=typeof(null==e?void 0:e.globalVisible)||e.globalVisible}},gr=function(e){return new Promise((function(t){var n;try{chrome.storage.local.set(((n={})[ir]=e,n),(function(){return t()}))}catch(e){t()}}))},mr=function(e,t){return function(n,r){return pr(void 0,void 0,void 0,(function(){return hr(this,(function(o){switch(o.label){case 0:return n({type:lr,payload:{tabId:e,mode:t}}),[4,gr(fr(r().view))];case 1:return o.sent(),[2]}}))}))}},yr=function(e,t){return function(n,r){return pr(void 0,void 0,void 0,(function(){return hr(this,(function(o){switch(o.label){case 0:return n({type:cr,payload:{tabId:e,visible:t}}),[4,gr(fr(r().view))];case 1:return o.sent(),[2]}}))}))}},vr=function(){return vr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},vr.apply(this,arguments)},br=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},xr=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},wr=function(e,t,n){return Math.max(t,Math.min(n,e))},Sr=360,kr=660,Cr=24,Er=24,Ar=Sr+48,Ir=2147483646,Tr=function(e){var t="anki-float-reset-gap",n=document.getElementById(t);e?(n||((n=document.createElement("style")).id=t,n.textContent="\n        html, body { margin-right: 0 !important; padding-right: 0 !important; }\n        #anki-sidebar-spacer, .anki-sidebar-spacer { display: none !important; width: 0 !important; }\n      ",document.head.appendChild(n)),document.documentElement.style.marginRight="",document.documentElement.style.paddingRight="",document.body.style.marginRight="",document.body.style.paddingRight=""):n&&n.parentNode&&n.parentNode.removeChild(n)},Mr=function(e){try{var t=document.querySelector("#sidebar");t&&(t.style.display=e?"":"none");for(var n=Array.from(document.querySelectorAll("*")),r=0,o=n;r<o.length;r++){var a=o[r],i=getComputedStyle(a),s="0px"===a.style.right||"0px"===i.right;if(("fixed"===i.position||"absolute"===i.position)&&s&&a.offsetWidth>=280&&a.offsetWidth<=520){if("anki-floating-root"===a.id)continue;a.querySelector("[data-anki-app-anchor]")&&(a.style.display=e?"":"none")}}}catch(e){}},Fr=function(e){var t=e.tabId,n=qe(),o=n.currentPage,s=n.setCurrentPage,l=(0,r.useState)(!0),c=l[0],u=l[1],d=(0,r.useState)(!1),p=d[0],h=d[1],f=E(),g=m((function(e){return e.settings.ankiConnectApiKey})),y=(0,r.useState)(!1),v=y[0],b=y[1],x=(0,r.useState)({x:Cr,y:Er}),w=x[0],S=x[1],k=(0,r.useState)({width:Sr,height:kr}),C=k[0],A=k[1],I=(0,r.useRef)(null),T=(0,r.useRef)(null),M=(0,r.useRef)(null),F=(0,r.useCallback)((function(){return"anki_ui_tab_".concat(t)}),[t]),z=(0,r.useCallback)((function(e){var t;try{var n=F();null===(t=chrome.storage)||void 0===t||t.local.get([n],(function(t){var r,o,a,i=null!==(o=null==t?void 0:t[n])&&void 0!==o?o:{sidebarVisible:!1,floatingVisible:!1,preferredMode:"sidebar"},s=vr(vr({},i),e);try{null===(a=chrome.storage)||void 0===a||a.local.set(((r={})[n]=s,r))}catch(e){}}))}catch(e){}}),[F]),_=(0,r.useCallback)((function(e){try{var t=document.getElementById("sidebar");t&&(t.style.transform=e?"translateX(0)":"translateX(100%)",t.style.display=e?"":"none"),document.body.style.marginRight=e?"350px":"0"}catch(e){}}),[]);(0,r.useEffect)((function(){var e=M.current;if(e){var t=function(){var t=document.querySelector("#anki-sidebar-root");if(t)return t;for(var n=e.parentElement;n&&n!==document.body;){var r=getComputedStyle(n),o=n.offsetWidth,a="0px"===n.style.right||"0px"===r.right;if(("fixed"===r.position||"absolute"===r.position)&&a&&o>=280&&o<=520)return n;n=n.parentElement}for(var i=0,s=Array.from(document.querySelectorAll("*"));i<s.length;i++){var l=s[i];r=getComputedStyle(l),a="0px"===l.style.right||"0px"===r.right;if(("fixed"===r.position||"absolute"===r.position)&&a&&l.offsetWidth>=280&&l.offsetWidth<=520&&l.contains(e))return l}return null}();t&&(t.style.display=v?"none":""),Tr(v)}}),[v]),(0,r.useEffect)((function(){c&&br(void 0,void 0,void 0,(function(){var e;return xr(this,(function(t){switch(t.label){case 0:t.trys.push([0,,5,6]),f(Ae()),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,re(g)];case 2:return(e=t.sent()).error?f(Xn(!1)):(f(function(e){return{type:Dn,payload:e}}(e.result)),f(Xn(!0))),[3,4];case 3:return t.sent(),f(Xn(!1)),[3,4];case 4:return[3,6];case 5:return u(!1),[7];case 6:return[2]}}))}))}),[f,g,c]),(0,r.useEffect)((function(){f((function(e,t){return pr(void 0,void 0,void 0,(function(){var n,r;return hr(this,(function(o){switch(o.label){case 0:return[4,new Promise((function(e){try{chrome.storage.local.get([ir],(function(t){e(t&&t[ir]||null)}))}catch(t){e(null)}}))];case 1:return(n=o.sent())?(e({type:sr,payload:fr(n)}),[3,4]):[3,2];case 2:return r=fr(t().view),e({type:sr,payload:r}),[4,gr(r)];case 3:o.sent(),o.label=4;case 4:return[2]}}))}))})).finally((function(){return h(!0)}))}),[f]);var R=m((function(e){return function(e,t){var n,r,o,a,i,s=null!==(r=null===(n=e.view)||void 0===n?void 0:n.globalMode)&&void 0!==r?r:"sidebar";return null!==(i=null===(a=null===(o=e.view)||void 0===o?void 0:o.preferredModeByTab)||void 0===a?void 0:a[t])&&void 0!==i?i:s}(e,t)})),j=m((function(e){return function(e,t){var n,r,o,a=null===(r=null===(n=e.view)||void 0===n?void 0:n.visibleByTab)||void 0===r?void 0:r[t];if("boolean"==typeof a)return a;var i=null===(o=e.view)||void 0===o?void 0:o.globalVisible;return"boolean"!=typeof i||i}(e,t)})),B=m((function(e){return function(e,t){var n,r,o;return null!==(o=null===(r=null===(n=e.view)||void 0===n?void 0:n.floatGeometryByTab)||void 0===r?void 0:r[t])&&void 0!==o?o:null}(e,t)})),O=(0,r.useCallback)((function(){if(!B)try{var e=Sr,t=Math.min(kr,Math.max(340,window.innerHeight-48)),n=Math.max(8,window.innerWidth-e-24),r=Math.max(8,Math.min(Er,window.innerHeight-t-8));S({x:n,y:r}),A({width:e,height:t})}catch(e){}}),[B]);(0,r.useEffect)((function(){b("float"===R&&!1!==j)}),[R,j]),(0,r.useEffect)((function(){p&&("float"===R?(z({preferredMode:"floating",floatingVisible:!1!==j,sidebarVisible:!1}),!1!==j&&_(!1)):(z({preferredMode:"sidebar",floatingVisible:!1,sidebarVisible:!1!==j}),_(!1!==j)))}),[R,j,p,z,_]),(0,r.useEffect)((function(){if(B){var e=B.x,t=B.y,n=B.width,r=B.height;S((function(n){return n.x===e&&n.y===t?n:{x:e,y:t}})),A((function(e){return e.width===n&&e.height===r?e:{width:n,height:r}}))}else O()}),[B,O]);var N=(0,r.useCallback)((function(){f(yr(t,!1)),b(!1),z({preferredMode:"floating",floatingVisible:!1,sidebarVisible:!1}),_(!1);var e=document.getElementById("anki-floating-root");e&&e.remove();try{null==ee||ee(!1)}catch(e){}}),[f,t,z,_]),P=(0,r.useCallback)((function(){if(v)N();else{f(mr(t,"sidebar")),f(yr(t,!1)),f(function(e,t){return void 0===t&&(t=!0),{type:Kn,payload:{tabId:e,persist:t}}}(t)),z({preferredMode:"sidebar",floatingVisible:!1,sidebarVisible:!1});try{chrome.runtime.sendMessage({action:"toggleSidebar",tabId:t})}catch(e){}}}),[f,t,v,z,N]),L=(0,r.useCallback)((function(){O(),f(mr(t,"float")),f(yr(t,!0)),b(!0),Tr(!0),z({preferredMode:"floating",floatingVisible:!0,sidebarVisible:!1}),_(!1)}),[f,t,z,_,O]),D=(0,r.useCallback)((function(){f(mr(t,"sidebar")),f(yr(t,!0)),b(!1),Tr(!1),z({preferredMode:"sidebar",floatingVisible:!1,sidebarVisible:!0}),_(!0);var e=document.querySelector("#sidebar");e&&(e.removeAttribute("hidden"),e.style.removeProperty("display"),e.style.removeProperty("visibility"),e.style.removeProperty("opacity"));var n=document.getElementById("anki-floating-root");n&&0===n.childElementCount&&n.remove()}),[f,t,z,_]),$=(0,r.useCallback)((function(){b((function(e){var n,r=!e;return f(mr(t,r?"float":"sidebar")),f(yr(t,!0)),r?(O(),Tr(!0),Mr(!1),z({preferredMode:"floating",floatingVisible:!0,sidebarVisible:!1}),_(!1)):(Tr(!1),Mr(!0),(n=document.querySelector("#sidebar"))&&(n.removeAttribute("hidden"),n.style.removeProperty("display"),n.style.removeProperty("visibility"),n.style.removeProperty("opacity"),n.style.removeProperty("transform"),n.classList.remove("hidden","is-hidden","collapsed")),z({preferredMode:"sidebar",floatingVisible:!1,sidebarVisible:!0}),_(!0)),r}))}),[f,t,z,_,O]);(0,r.useEffect)((function(){var e=function(e,t,n){if(null==e?void 0:e.action)return"toggleFloating"===e.action?($(),null==n||n({ok:!0}),!0):"showFloating"===e.action?(L(),null==n||n({ok:!0}),!0):"hideFloating"===e.action?(N(),null==n||n({ok:!0}),!0):"collapseSidebar"===e.action?(L(),null==n||n({ok:!0}),!0):"expandSidebar"===e.action?(D(),null==n||n({ok:!0}),!0):void 0};return chrome.runtime.onMessage.addListener(e),function(){return chrome.runtime.onMessage.removeListener(e)}}),[$,L,D,N]);var q=function(e){if(v){e.preventDefault(),ee(!0);var t=e.clientX,n=e.clientY;I.current={offsetX:t-w.x,offsetY:n-w.y},window.addEventListener("mousemove",V),window.addEventListener("mouseup",U)}},U=function(){I.current=null,window.removeEventListener("mousemove",V),window.removeEventListener("mouseup",U),ee(!1)},V=function(e){if(I.current){var t=window.innerWidth,n=window.innerHeight,r=wr(e.clientX-I.current.offsetX,8,t-C.width-8),o=wr(e.clientY-I.current.offsetY,8,n-C.height-8);S({x:r,y:o})}},H=function(e){v&&(e.preventDefault(),e.stopPropagation(),ee(!0),T.current={startX:e.clientX,startY:e.clientY,startW:C.width,startH:C.height},window.addEventListener("mousemove",G),window.addEventListener("mouseup",W))},W=function(){T.current=null,window.removeEventListener("mousemove",G),window.removeEventListener("mouseup",W),ee(!1)},G=function(e){if(T.current){var t=e.clientX-T.current.startX,n=e.clientY-T.current.startY,r=wr(T.current.startW+t,340,Math.min(window.innerWidth-16,Ar)),o=wr(T.current.startH+n,340,Math.min(window.innerHeight-16,900));A({width:r,height:o})}},Y=(0,r.useRef)(null);(0,r.useEffect)((function(){p&&(Y.current=null)}),[p]),(0,r.useEffect)((function(){var e={x:w.x,y:w.y,width:C.width,height:C.height};if(p){var n=Y.current;n&&n.x===e.x&&n.y===e.y&&n.width===e.width&&n.height===e.height||(Y.current=e,f(function(e,t){return function(n,r){return pr(void 0,void 0,void 0,(function(){return hr(this,(function(o){switch(o.label){case 0:return n({type:ur,payload:{tabId:e,geometry:t}}),[4,gr(fr(r().view))];case 1:return o.sent(),[2]}}))}))}}(t,e)))}else Y.current=e}),[f,t,w,C,B,p]);var X,K,Q=(0,r.useCallback)((function(e){return s(e)}),[s]),J=function(){var e="createCard"!==o?"46px":"12px",t="58px",n=v?"12px":"0px",r={width:"100%",height:"100%",paddingTop:e,paddingBottom:t,paddingLeft:n,paddingRight:n,overflowY:"auto",overflowX:"hidden",opacity:1,transform:"translateX(0)",transition:"all 0.3s ease-in-out",boxSizing:"border-box"};switch(o){case"settings":return(0,a.jsx)("div",vr({style:r},{children:(0,a.jsx)(Ln,{onBackClick:function(){return Q("createCard")},popup:!1})}));case"storedCards":return(0,a.jsx)("div",vr({style:r},{children:(0,a.jsx)(Gn,{onBackClick:function(){return Q("createCard")}})}));default:return(0,a.jsx)("div",vr({style:{width:"100%",flex:1,display:"flex",flexDirection:"column",overflowY:"auto",overflowX:"hidden",height:"100%",position:"relative",paddingTop:e,paddingBottom:t,paddingLeft:n,paddingRight:n,opacity:1,transform:"translateX(0)",transition:"all 0.3s ease-in-out",boxSizing:"border-box"}},{children:(0,a.jsx)(Rn,{})}))}},Z=function(){var e=n.storedCards.filter((function(e){return"not_exported"===e.exportStatus})).length;return(0,a.jsxs)(a.Fragment,{children:[v&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:{position:"absolute",top:0,left:0,right:0,height:32,pointerEvents:"none",background:"linear-gradient(to right, rgba(243,244,246,0.96), rgba(255,255,255,0.84))",borderTopLeftRadius:12,borderTopRightRadius:12,borderBottom:"1px solid rgba(0,0,0,0.06)",zIndex:Ir+0}}),(0,a.jsx)("div",{onMouseDown:q,style:{position:"absolute",top:0,left:0,right:96,height:32,cursor:"move",zIndex:Ir+1},title:"Drag to move"})]}),(0,a.jsx)("button",vr({onClick:P,style:{position:"absolute",top:"6px",right:"12px",background:"transparent",border:"none",cursor:"pointer",padding:"6px",color:"#6B7280",borderRadius:5,width:28,height:28,zIndex:Ir+2},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.color="#EF4444"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="#6B7280"},title:"Close extension"},{children:(0,a.jsx)(It,{size:14})})),(0,a.jsx)("button",vr({onClick:$,style:{position:"absolute",top:"6px",right:"46px",background:"transparent",border:"none",cursor:"pointer",padding:"6px",color:"#6B7280",borderRadius:5,width:28,height:28,zIndex:Ir+2},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.color="#111827"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="#6B7280"},title:v?"Dock to sidebar":"Make window floating"},{children:v?(0,a.jsx)(st,{size:14}):(0,a.jsx)(pt,{size:14})})),"createCard"!==o&&(0,a.jsx)("div",vr({style:{position:"absolute",top:v?"".concat(40,"px"):"6px",left:"12px",right:"80px",zIndex:Ir+2}},{children:(0,a.jsxs)("button",vr({onClick:function(){return Q("createCard")},style:{backgroundColor:"#2563EB",border:"none",cursor:"pointer",padding:"6px 14px",color:"#fff",borderRadius:7,width:"100%",height:32,fontSize:13,fontWeight:600,boxShadow:"0 1px 3px rgba(37,99,235,0.2)",transition:"all .2s"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#1D4ED8",e.currentTarget.style.transform="translateY(-0.5px)"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#2563EB",e.currentTarget.style.transform="translateY(0)"}},{children:[(0,a.jsx)(St,{style:{marginRight:5},size:13})," New Card"]}))})),(0,a.jsxs)("div",vr({style:{position:"absolute",bottom:"8px",left:"12px",right:"12px",display:"flex",gap:"6px",zIndex:100}},{children:[(0,a.jsxs)("button",vr({onClick:function(){return Q("storedCards")},disabled:n.isGeneratingCard,className:"nav-button",style:{backgroundColor:"storedCards"===o?"#EFF6FF":"#F9FAFB",border:"1px solid ".concat("storedCards"===o?"#BFDBFE":"#E5E7EB"),cursor:n.isGeneratingCard?"not-allowed":"pointer",padding:"10px 14px",color:n.isGeneratingCard?"#9CA3AF":"storedCards"===o?"#2563EB":"#6B7280",borderRadius:"10px",transition:"all 0.2s ease",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flex:1,gap:"3px",fontSize:"11px",fontWeight:"storedCards"===o?600:500,boxShadow:"storedCards"===o?"0 2px 4px rgba(37, 99, 235, 0.1)":"0 1px 2px rgba(0, 0, 0, 0.05)",position:"relative",opacity:n.isGeneratingCard?.6:1},title:n.isGeneratingCard?"Please wait while card is being generated":"View your saved cards"},{children:[(0,a.jsxs)("div",vr({style:{position:"relative",display:"flex",alignItems:"center"}},{children:[(0,a.jsx)(bt,{size:16}),e>0&&(0,a.jsx)("span",vr({style:{position:"absolute",top:"-6px",right:"-8px",backgroundColor:"#EF4444",color:"white",borderRadius:"10px",fontSize:"10px",fontWeight:"bold",padding:"2px 6px",minWidth:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.1)"}},{children:e>99?"99+":e}))]})),(0,a.jsx)("span",{children:"Cards"})]})),(0,a.jsxs)("button",vr({onClick:function(){return Q("settings")},disabled:n.isGeneratingCard,className:"nav-button",style:{backgroundColor:"settings"===o?"#EFF6FF":"#F9FAFB",border:"1px solid ".concat("settings"===o?"#BFDBFE":"#E5E7EB"),cursor:n.isGeneratingCard?"not-allowed":"pointer",padding:"10px 14px",color:n.isGeneratingCard?"#9CA3AF":"settings"===o?"#2563EB":"#6B7280",borderRadius:"10px",transition:"all 0.2s ease",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flex:1,gap:"3px",fontSize:"11px",fontWeight:"settings"===o?600:500,boxShadow:"settings"===o?"0 2px 4px rgba(37, 99, 235, 0.1)":"0 1px 2px rgba(0, 0, 0, 0.05)",opacity:n.isGeneratingCard?.6:1},title:n.isGeneratingCard?"Please wait while card is being generated":"App settings and API configuration"},{children:[(0,a.jsx)(it,{size:16}),(0,a.jsx)("span",{children:"Settings"})]}))]})),v&&(0,a.jsx)("div",{onMouseDown:H,title:"Drag to resize",style:{position:"absolute",width:16,height:16,right:6,bottom:6,cursor:"nwse-resize",borderRadius:4,background:"linear-gradient(135deg, rgba(203,213,225,.9), rgba(148,163,184,.9))",boxShadow:"0 1px 2px rgba(0,0,0,.08)",zIndex:Ir+2}})]})},ee=function(e){var t,n,r="anki-disable-user-select",o="anki-drag-overlay",a=document.getElementById(r),i=ee;if(e){if(a||((a=document.createElement("style")).id=r,a.textContent="\n          html, body, * { user-select: none !important; -webkit-user-select: none !important; }\n          body { cursor: grabbing !important; }\n        ",document.head.appendChild(a)),!document.getElementById(o))(l=document.createElement("div")).id=o,l.style.position="fixed",l.style.inset="0",l.style.zIndex=String(Ir-1),l.style.cursor="grabbing",l.style.background="transparent",document.body.appendChild(l);var s=function(e){return e.preventDefault()};i._preventHandler=s,document.addEventListener("selectstart",s,!0),document.addEventListener("dragstart",s,!0)}else{var l;a&&a.remove(),(l=document.getElementById(o))&&l.remove(),(s=i._preventHandler)&&(document.removeEventListener("selectstart",s,!0),document.removeEventListener("dragstart",s,!0),i._preventHandler=void 0);try{null===(n=null===(t=window.getSelection())||void 0===t?void 0:t.removeAllRanges)||void 0===n||n.call(t)}catch(e){}}},te=v?{backgroundColor:"#ffffff",position:"fixed",left:w.x,top:w.y,width:C.width,height:C.height,display:"flex",flexDirection:"column",zIndex:Ir,borderRadius:12,overflow:"hidden",boxShadow:"0 8px 24px rgba(0,0,0,0.18), 0 1px 0 rgba(0,0,0,0.08)",border:"1px solid rgba(0,0,0,0.06)"}:{backgroundColor:"#ffffff",height:"100vh",display:"flex",flexDirection:"column",position:"absolute",right:0,top:0,width:"350px",fontFamily:"Inter, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, sans-serif",boxShadow:"0 0 0 1px rgba(0,0,0,0.05), 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06)"},ne={width:"100%",flex:1,display:"flex",flexDirection:"column",backgroundColor:"#ffffff",marginTop:0,height:"100%",overflowY:"auto",overflowX:"hidden",boxSizing:"border-box",paddingTop:v?40:0,paddingRight:v?12:0,paddingLeft:v?8:0,scrollPaddingTop:v?40:0};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{ref:M,"data-anki-app-anchor":!0,style:{display:"none"}}),v?(0,i.createPortal)((0,a.jsx)("div",vr({className:"App",style:te},{children:(0,a.jsxs)("div",vr({style:{flex:1,width:"100%",height:"100%",position:"relative",display:"flex",flexDirection:"column"}},{children:[Z(),(0,a.jsxs)("header",vr({className:"App-header",style:ne},{children:[J(),(0,a.jsx)("div",vr({style:{position:"absolute",top:16,right:16,zIndex:Ir+2,maxWidth:300,width:"auto",pointerEvents:"none"}},{children:(0,a.jsx)("div",vr({style:{pointerEvents:"auto"}},{children:(0,a.jsx)(or,{})}))}))]}))]}))})),(X="anki-floating-root",K=document.getElementById(X),K||((K=document.createElement("div")).id=X,document.body.appendChild(K)),K)):(0,a.jsx)("div",vr({className:"App",style:te},{children:(0,a.jsxs)("div",vr({style:{flex:1,width:"100%",height:"100%",position:"relative",display:"flex",flexDirection:"column"}},{children:[Z(),(0,a.jsxs)("header",vr({className:"App-header",style:ne},{children:[J(),(0,a.jsx)("div",vr({style:{position:"absolute",top:16,right:16,zIndex:Ir+2,maxWidth:300,width:"auto",pointerEvents:"none"}},{children:(0,a.jsx)("div",vr({style:{pointerEvents:"auto"}},{children:(0,a.jsx)(or,{})}))}))]}))]}))}))]})};const zr=function(e){var t=e.tabId,n=E();return(0,r.useEffect)((function(){n(function(e){return{type:T,payload:e}}(t)),Mr(!0),Tr(!1)}),[n,t]),(0,a.jsx)($e,vr({tabId:t},{children:(0,a.jsx)(Fr,{tabId:t})}))};
/**
 * @license
 * ReduxedChromeStorage v3.0.10
 * https://github.com/hindmost/reduxed-chrome-storage
 * Copyright (c) Savr Goryaev aka hindmost
 *
 * This source code is licensed under the MIT license
 * https://github.com/hindmost/reduxed-chrome-storage/blob/master/LICENSE
 *
 * Dependencies:
 *
 * uuid v8.3.2
 */
var _r,Rr=new Uint8Array(16);function jr(){if(!_r&&!(_r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return _r(Rr)}var Br=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var Or=[],Nr=0;Nr<256;++Nr)Or.push((Nr+256).toString(16).substr(1));function Pr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(Or[e[t+0]]+Or[e[t+1]]+Or[e[t+2]]+Or[e[t+3]]+"-"+Or[e[t+4]]+Or[e[t+5]]+"-"+Or[e[t+6]]+Or[e[t+7]]+"-"+Or[e[t+8]]+Or[e[t+9]]+"-"+Or[e[t+10]]+Or[e[t+11]]+Or[e[t+12]]+Or[e[t+13]]+Or[e[t+14]]+Or[e[t+15]]).toLowerCase();if(!function(e){return"string"==typeof e&&Br.test(e)}(n))throw TypeError("Stringified UUID is invalid");return n}function Lr(e,t,n){var r=(e=e||{}).random||(e.rng||jr)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var o=0;o<16;++o)t[n+o]=r[o];return t}return Pr(r)}function Dr(e){return null==e||"object"!=typeof e?e:JSON.parse(JSON.stringify(e))}function $r(e,t){if(e===t)return!0;if(null==e||"object"!=typeof e||null==t||"object"!=typeof t||Array.isArray(e)!==Array.isArray(t))return!1;const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(const o of n)if(r.indexOf(o)<=-1||!$r(e[o],t[o]))return!1;return!0}function qr(e,t){if(e===t)return;if(null==e||"object"!=typeof e||null==t||"object"!=typeof t)return e;if(Array.isArray(e)||Array.isArray(t))return $r(e,t)?void 0:e;const n=Object.keys(e),r=Object.keys(t);let o=!0;const a=n.reduce(((n,a)=>{const i=r.indexOf(a)>-1?qr(e[a],t[a]):e[a];return void 0===i||(o=!1,n[a]=i),n}),{});return r.forEach((e=>{n.indexOf(e)>-1||(o=!1,a[e]=void 0)})),o?void 0:a}function Ur(e,t,n){if(Array.isArray(t))return Dr(t);if(null==e||"object"!=typeof e||Array.isArray(e)||null==t||"object"!=typeof t)return Dr(void 0!==t?t:e);const r=Object.keys(e).concat(Object.keys(t).filter((t=>!(t in e)))).reduce(((r,o)=>(r[o]=Ur(e[o],t[o],n),r)),{});if(!n)return r;const o=Object.keys(t);return Object.keys(e).forEach((e=>{o.indexOf(e)>-1||delete r[e]})),r}const Vr=e=>{if(void 0===e||!Array.isArray(e)||3!==e.length)return[e,"",0];const[t,n,r]=e;return"string"==typeof t&&"number"==typeof n?[r,t,n]:[e,"",0]};class Hr{constructor(e,t,n,r,o,a,i){this.container=e,this.storage=t,this.isolated=n,this.plain=r,this.timeout=o?Math.max(o,500):1e3,this.resetState=i,this.store=this._instantiateStore(),this.state=null,this.id=Lr(),this.tmstamp=0,this.outdted=[],"function"==typeof a&&(this.lisner=a),this.lisners=[],this.getState=this.getState.bind(this),this.subscribe=this.subscribe.bind(this),this.dispatch=this.dispatch.bind(this),this.replaceReducer=this.replaceReducer.bind(this),this[Symbol.observable]=this[Symbol.observable].bind(this)}init(){this.tmstamp||this.isolated||this.storage.subscribe(((e,t)=>{const[n,r,o]=Vr(e);if(r===this.id||$r(n,this.state))return;const a=o>=this.tmstamp,i=a?Ur(this.state,n,!0):Ur(n,this.state,!0);!a&&$r(i,this.state)||(this._setState(i,o),this._renewStore(),$r(i,n)||this._send2Storage(),this._callListeners())}));const e=this.store.getState();return new Promise((t=>{this.storage.load((n=>{const[r,,o]=Vr(n);let a=r?Ur(e,r):e;this.resetState&&(a=Ur(a,this.resetState)),this._setState(a,o),this._renewStore(),$r(a,r)||this._send2Storage(),t(this)}))}))}initFrom(e){return this._setState(e,0),this._renewStore(),this}_setState(e,t){this.state=Dr(e),(t=void 0!==t?t:Date.now())>this.tmstamp&&(this.tmstamp=t)}_renewStore(){this.plain?this.unsub&&this.unsub():this._clean();const e=this.store=this._instantiateStore(this.state),t=Date.now(),n=this.outdted.length;this.outdted=this.outdted.map((([e,r],o)=>e||o>=n-1?[e,r]:[t,r]));let r=Dr(this.state);const o=this.store.subscribe((()=>{const t=e&&e.getState(),n=this.store===e;if(this._clean(),!$r(t,this.state)){if(n)this._setState(t);else{const e=qr(t,r);if(void 0===e)return;this._setState(Ur(this.state,e)),this._renewStore()}this._send2Storage(),this._callListeners(!0,r),r=Dr(t)}}));this.plain?this.unsub=o:this.outdted.push([0,o])}_clean(){if(this.plain)return;const e=Date.now(),t=this.outdted.length;this.outdted.forEach((([n,r],o)=>{o>=t-1||e-n<this.timeout||(r(),delete this.outdted[o])}))}_instantiateStore(e){const t=this.container(e);if("object"!=typeof t||"function"!=typeof t.getState)throw new Error("Invalid 'storeCreatorContainer' supplied");return t}_send2Storage(){var e,t,n;this.storage.save((e=this.state,t=this.id,n=this.tmstamp,[t,n,e]))}_callListeners(e,t){e&&this.lisner&&this.lisner(this,t);for(const e of this.lisners)e()}getState(){return this.state}subscribe(e){return"function"==typeof e&&this.lisners.push(e),()=>{"function"==typeof e&&(this.lisners=this.lisners.filter((t=>t!==e)))}}dispatch(e){return this.store.dispatch(e)}replaceReducer(e){return"function"==typeof e&&this.store.replaceReducer(e),this}[Symbol.observable](){const e=this.getState,t=this.subscribe;return{subscribe(n){if("object"!=typeof n||null===n)throw new TypeError("Expected the observer to be an object.");function r(){const t=n;t.next&&t.next(e())}r();return{unsubscribe:t(r)}},[Symbol.observable](){return this}}}}var Wr;!function(e){e.local="local",e.sync="sync"}(Wr||(Wr={}));const Gr=e=>(new TextEncoder).encode(Object.entries(e).map((([e,t])=>e+JSON.stringify(t))).join("")).length;class Yr{constructor({namespace:e,area:t,key:n}){this.ns=e,this.areaName=t===Wr.sync?Wr.sync:Wr.local,this.key=n||"reduxed",this.listeners=[],this.errListeners=[]}regShared(){this.regListener(((e,t)=>{for(const n of this.listeners)n(e,t)}))}regListener(e){this.ns.storage.onChanged.addListener(((t,n)=>{if(n!==this.areaName||!(this.key in t))return;const{newValue:r,oldValue:o}=t[this.key];r&&e(r,o)}))}subscribe(e){"function"==typeof e&&this.listeners.push(e)}subscribeForError(e){"function"==typeof e&&this.errListeners.push(e)}fireErrorListeners(e,t){for(const n of this.errListeners)n(e,t)}callbackOnLoad(e,t,n){t(!this.ns.runtime.lastError&&(n?e:e&&e[this.key]))}callbackOnSave(e,t){if(!this.ns.runtime.lastError)return;const{message:n}=this.ns.runtime.lastError;if(!n||!e||!t)return void this.fireErrorListeners(n||"",!1);this.areaName===Wr.sync&&t.QUOTA_BYTES_PER_ITEM&&Gr({[this.key]:e})>t.QUOTA_BYTES_PER_ITEM?this.fireErrorListeners(n,!0):this.load((r=>{const o="object"==typeof r&&t.QUOTA_BYTES>0&&Gr(Object.assign(Object.assign({},r),{[this.key]:e}))>t.QUOTA_BYTES;this.fireErrorListeners(n,o)}),!0)}}class Xr extends Yr{constructor({namespace:e,area:t,key:n}){super({namespace:e,area:t,key:n}),this.areaApi=this.ns.storage[this.areaName]}load(e,t){"function"==typeof e&&this.areaApi.get(t?null:this.key,(n=>{this.callbackOnLoad(n,e,t)}))}save(e){this.areaApi.set({[this.key]:e},(()=>{this.callbackOnSave(e,this.areaApi)}))}}class Kr extends Yr{constructor({namespace:e,area:t,key:n}){super({namespace:e,area:t,key:n}),this.areaApi=this.ns.storage[this.areaName]}load(e,t){"function"==typeof e&&this.areaApi.get(t?null:this.key).then((t=>{this.callbackOnLoad(t,e)}))}save(e){this.areaApi.set({[this.key]:e}).then((()=>{this.callbackOnSave(e,this.areaApi)}))}}var Qr;function Jr(e){return Jr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jr(e)}function Zr(e){var t=function(e,t){if("object"!==Jr(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==Jr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Jr(t)?t:String(t)}function eo(e,t,n){return(t=Zr(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function to(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function no(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?to(Object(n),!0).forEach((function(t){eo(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):to(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ro(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}!function(e){e.chrome="chrome",e.browser="browser"}(Qr||(Qr={}));var oo="function"==typeof Symbol&&Symbol.observable||"@@observable",ao=function(){return Math.random().toString(36).substring(7).split("").join(".")},io={INIT:"@@redux/INIT"+ao(),REPLACE:"@@redux/REPLACE"+ao(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+ao()}};function so(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function lo(e,t,n){var r;if("function"==typeof t&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw new Error(ro(0));if("function"==typeof t&&void 0===n&&(n=t,t=void 0),void 0!==n){if("function"!=typeof n)throw new Error(ro(1));return n(lo)(e,t)}if("function"!=typeof e)throw new Error(ro(2));var o=e,a=t,i=[],s=i,l=!1;function c(){s===i&&(s=i.slice())}function u(){if(l)throw new Error(ro(3));return a}function d(e){if("function"!=typeof e)throw new Error(ro(4));if(l)throw new Error(ro(5));var t=!0;return c(),s.push(e),function(){if(t){if(l)throw new Error(ro(6));t=!1,c();var n=s.indexOf(e);s.splice(n,1),i=null}}}function p(e){if(!so(e))throw new Error(ro(7));if(void 0===e.type)throw new Error(ro(8));if(l)throw new Error(ro(9));try{l=!0,a=o(a,e)}finally{l=!1}for(var t=i=s,n=0;n<t.length;n++){(0,t[n])()}return e}return p({type:io.INIT}),(r={dispatch:p,subscribe:d,getState:u,replaceReducer:function(e){if("function"!=typeof e)throw new Error(ro(10));o=e,p({type:io.REPLACE})}})[oo]=function(){var e,t=d;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new Error(ro(11));function n(){e.next&&e.next(u())}return n(),{unsubscribe:t(n)}}})[oo]=function(){return this},e},r}function co(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}function uo(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return function(){var n=e.apply(void 0,arguments),r=function(){throw new Error(ro(15))},o={getState:n.getState,dispatch:function(){return r.apply(void 0,arguments)}},a=t.map((function(e){return e(o)}));return r=co.apply(void 0,a)(n.dispatch),no(no({},n),{},{dispatch:r})}}}function po(e){return function(t){var n=t.dispatch,r=t.getState;return function(t){return function(o){return"function"==typeof o?o(n,r,e):t(o)}}}}var ho=po();ho.withExtraArgument=po;const fo=ho;var go=function(){return go=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},go.apply(this,arguments)},mo={decks:[],deckId:""};var yo=function(){return yo=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},yo.apply(this,arguments)},vo=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},bo=yo({savedCards:[],storedCards:[],text:"",translation:"",examples:[],image:null,imageUrl:null,error:void 0,back:null,front:"",currentCardId:null,linguisticInfo:"",transcription:"",isGeneratingCard:!1});const xo=function(e,t){var n,r,o,a,i,s,l,c,u,d;void 0===e&&(e=bo);var p=yo({},e);switch(t.type){case ie:p.savedCards=vo(vo([],e.savedCards,!0),t.payload,!0);break;case fe:console.log("*** REDUCER: SAVE_CARD_TO_STORAGE action received ***"),console.log("Action payload raw:",t.payload),console.log("Action payload image data:",{hasImage:!!t.payload.image,hasImageUrl:!!t.payload.imageUrl,imageType:typeof t.payload.image,imageUrlType:typeof t.payload.imageUrl,imageValue:t.payload.image,imageUrlValue:t.payload.imageUrl,imageUndefinedCheck:void 0!==t.payload.image,imageUrlUndefinedCheck:void 0!==t.payload.imageUrl});var h=yo(yo({},t.payload.id?t.payload:yo(yo({},t.payload),{id:Date.now().toString()})),{image:void 0!==t.payload.image?t.payload.image:null,imageUrl:void 0!==t.payload.imageUrl?t.payload.imageUrl:null,exportStatus:t.payload.exportStatus||"not_exported",linguisticInfo:t.payload.linguisticInfo||"",transcription:t.payload.transcription||""});console.log("REDUCER: Final card object created:",{cardId:h.id,hasImage:!!h.image,hasImageUrl:!!h.imageUrl,imageType:typeof h.image,imageUrlType:typeof h.imageUrl,imageLength:null===(n=h.image)||void 0===n?void 0:n.length,imageUrlLength:null===(r=h.imageUrl)||void 0===r?void 0:r.length,imageActualValue:h.image,imageUrlActualValue:h.imageUrl,imagePreview:null===(o=h.image)||void 0===o?void 0:o.substring(0,50),imageUrlPreview:null===(a=h.imageUrl)||void 0===a?void 0:a.substring(0,50)});var f=e.storedCards.find((function(e){return e.id===h.id}));f?(p.storedCards=e.storedCards.map((function(e){return e.id===f.id?yo(yo({},h),{id:f.id}):e})),console.log("Updated existing card with ID:",h.id,"text:",h.text)):(p.storedCards=vo(vo([],e.storedCards,!0),[h],!1),console.log("Added new card with ID:",h.id,"text:",h.text),console.log("Total stored cards after addition:",p.storedCards.length));break;case ve:p.storedCards=e.storedCards.map((function(e){return e.id===t.payload.cardId?yo(yo({},e),{exportStatus:t.payload.status}):e}));break;case be:if(console.log("*** REDUCER: UPDATE_STORED_CARD action received ***"),console.log("Update payload image info:",{cardId:t.payload.id,hasImage:!!t.payload.image,hasImageUrl:!!t.payload.imageUrl,imageType:typeof t.payload.image,imageUrlType:typeof t.payload.imageUrl,imageValue:t.payload.image,imageUrlValue:t.payload.imageUrl,imageLength:null===(i=t.payload.image)||void 0===i?void 0:i.length,imageUrlLength:null===(s=t.payload.imageUrl)||void 0===s?void 0:s.length}),!t.payload.id)return console.error("Cannot update card without ID"),e;if(e.storedCards.some((function(e){return e.id===t.payload.id})))p.storedCards=e.storedCards.map((function(e){return e.id===t.payload.id?yo(yo({},t.payload),{exportStatus:t.payload.exportStatus||e.exportStatus,linguisticInfo:t.payload.linguisticInfo||e.linguisticInfo,transcription:t.payload.transcription||e.transcription}):e})),console.log("UPDATE_STORED_CARD: Updated existing card with ID:",t.payload.id,"image:",!!t.payload.image);else{var g=yo(yo({},t.payload),{exportStatus:t.payload.exportStatus||"not_exported",linguisticInfo:t.payload.linguisticInfo||"",transcription:t.payload.transcription||""});p.storedCards=vo(vo([],e.storedCards,!0),[g],!1),console.log("UPDATE_STORED_CARD: Added new card with ID:",t.payload.id,"image:",!!g.image)}break;case ge:break;case ye:p.storedCards=t.payload;break;case me:p.storedCards=e.storedCards.filter((function(e){return e.id!==t.payload}));break;case se:p.text=t.payload,""!==t.payload&&""!==t.payload.trim()||(console.log("Text cleared completely, also clearing images"),p.image=null,p.imageUrl=null);break;case le:p.translation=t.payload;break;case ce:p.examples=t.payload;break;case ue:console.log("*** REDUCER: SET_IMAGE called with:",{hasPayload:!!t.payload,payloadType:typeof t.payload,payloadLength:null===(l=t.payload)||void 0===l?void 0:l.length,payloadPreview:null===(c=t.payload)||void 0===c?void 0:c.substring(0,50)}),p.image=t.payload;break;case de:return console.log("*** REDUCER: SET_IMAGE_URL called with:",{hasPayload:!!t.payload,payloadType:typeof t.payload,payloadLength:null===(u=t.payload)||void 0===u?void 0:u.length,payloadPreview:null===(d=t.payload)||void 0===d?void 0:d.substring(0,50)}),yo(yo({},e),{imageUrl:t.payload});case pe:return yo(yo({},e),{back:t.payload});case he:return yo(yo({},e),{front:t.payload});case xe:return yo(yo({},e),{currentCardId:t.payload});case we:return yo(yo({},e),{linguisticInfo:t.payload});case Se:return yo(yo({},e),{transcription:t.payload});case ke:return yo(yo({},e),{isGeneratingCard:t.payload});default:return e}return p};const wo=function(e,t){return void 0===e&&(e="createCard"),"SET_CURRENT_PAGE"===t.type?t.currentPage:e};var So=function(){return So=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},So.apply(this,arguments)},ko={isAnkiAvailable:!1};const Co=function(e,t){return void 0===e&&(e=ko),t.type===Yn?So(So({},e),{isAnkiAvailable:t.payload}):e};var Eo=function(){return Eo=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Eo.apply(this,arguments)},Ao={globalState:{isVisible:!1,lastToggleTime:Date.now()},tabStates:{},inheritanceSettings:{enabled:!0,mode:"lastActive"}},Io=function(e,t){return e.tabStates[t]||{isVisible:e.globalState.isVisible,lastToggleTime:Date.now()}};const To=function(e,t){var n,r,o;switch(void 0===e&&(e=Ao),t.type){case Kn:var a=t.payload||{},i=a.tabId,s=a.persist,l=void 0===s||s,c=Date.now();if(i){var u=!(g=Io(e,i)).isVisible,d=Eo(Eo({},e),{tabStates:Eo(Eo({},e.tabStates),(n={},n[i]=Eo(Eo({},g),{isVisible:u,lastToggleTime:c}),n))});return l&&(d.globalState=Eo(Eo({},e.globalState),{isVisible:u,lastActiveTabId:i,lastToggleTime:c})),d}return Eo(Eo({},e),{globalState:Eo(Eo({},e.globalState),{isVisible:!e.globalState.isVisible,lastToggleTime:c})});case Qn:var p=t.payload,h=p.isVisible,f=(i=p.tabId,p.persist);l=void 0===f||f,c=Date.now();if(i){var g=Io(e,i);d=Eo(Eo({},e),{tabStates:Eo(Eo({},e.tabStates),(r={},r[i]=Eo(Eo({},g),{isVisible:h,lastToggleTime:c}),r))});return l&&(d.globalState=Eo(Eo({},e.globalState),{isVisible:h,lastActiveTabId:i,lastToggleTime:c})),d}return Eo(Eo({},e),{globalState:Eo(Eo({},e.globalState),{isVisible:h,lastToggleTime:c})});case Jn:var m=t.payload,y=(h=m.isVisible,m.lastActiveTabId);return Eo(Eo({},e),{globalState:Eo(Eo({},e.globalState),{isVisible:h,lastActiveTabId:y||e.globalState.lastActiveTabId,lastToggleTime:Date.now()})});case Zn:var v=t.payload,b=v.fromTabId,x=v.toTabId,w=void 0,S=void 0;return b&&e.tabStates[b]?(w=e.tabStates[b].isVisible,S=b):(w=function(e){return e.globalState.lastActiveTabId&&e.tabStates[e.globalState.lastActiveTabId]?e.tabStates[e.globalState.lastActiveTabId].isVisible:e.globalState.isVisible}(e),S=e.globalState.lastActiveTabId),Eo(Eo({},e),{tabStates:Eo(Eo({},e.tabStates),(o={},o[x]={isVisible:w,inheritedFrom:S,lastToggleTime:Date.now()},o))});default:return e}};var Mo=function(){return Mo=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Mo.apply(this,arguments)},Fo=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},zo={notifications:[]};const _o=function(e,t){switch(void 0===e&&(e=zo),t.type){case er:return e.notifications.find((function(e){return e.message===t.payload.message&&e.type===t.payload.type}))?e:Mo(Mo({},e),{notifications:Fo(Fo([],e.notifications,!0),[t.payload],!1)});case tr:return Mo(Mo({},e),{notifications:e.notifications.filter((function(e){return e.id!==t.payload.id}))});default:return e}};var Ro=function(){return Ro=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Ro.apply(this,arguments)},jo=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},Bo={currentTabId:null,tabStates:{}};const Oo=function(e,t){var n,r,o,a,i,s,l,c,u,d;void 0===e&&(e=Bo);var p=Ro({},e);switch(t.type){case T:var h=t.payload;p.currentTabId=h,h&&!p.tabStates[h]&&(p.tabStates=Ro(Ro({},p.tabStates),((n={})[h]=function(e){return{cardData:{text:"",translation:"",examples:[],image:null,imageUrl:null,front:"",back:null,linguisticInfo:"",transcription:"",isGeneratingCard:!1,currentCardId:null},storedCards:[],fieldIdPrefix:"tab_".concat(e,"_").concat(Date.now(),"_"),currentPage:"createCard"}}(h),n)));break;case M:var f=t.payload,g=f.tabId,m=f.field,y=f.value;g&&p.tabStates[g]&&(p.tabStates=Ro(Ro({},p.tabStates),((r={})[g]=Ro(Ro({},p.tabStates[g]),{cardData:Ro(Ro({},p.tabStates[g].cardData),(o={},o[m]=y,o))}),r)));break;case F:var v=t.payload.tabId;v&&p.tabStates[v]&&(p.tabStates=Ro(Ro({},p.tabStates),((a={})[v]=Ro(Ro({},p.tabStates[v]),{cardData:{text:"",translation:"",examples:[],image:null,imageUrl:null,front:"",back:null,linguisticInfo:"",transcription:"",isGeneratingCard:!1,currentCardId:null}}),a)));break;case z:var b=t.payload,x=b.tabId,w=b.card;if(x&&p.tabStates[x]){var S=p.tabStates[x],k=Ro(Ro({},w),{id:w.id||"".concat(S.fieldIdPrefix).concat(Date.now()),createdAt:w.createdAt||new Date}),C=S.storedCards.findIndex((function(e){return e.text===k.text})),E=void 0;C>=0?(E=jo([],S.storedCards,!0))[C]=Ro(Ro({},k),{id:S.storedCards[C].id}):E=jo(jo([],S.storedCards,!0),[k],!1),p.tabStates=Ro(Ro({},p.tabStates),((i={})[x]=Ro(Ro({},S),{storedCards:E}),i))}break;case _:var A=t.payload,I=A.tabId,N=A.cardId;if(I&&p.tabStates[I]){S=p.tabStates[I];p.tabStates=Ro(Ro({},p.tabStates),((s={})[I]=Ro(Ro({},S),{storedCards:S.storedCards.filter((function(e){return e.id!==N}))}),s))}break;case R:var P=t.payload,L=P.tabId,D=P.cards;L&&p.tabStates[L]&&(p.tabStates=Ro(Ro({},p.tabStates),((l={})[L]=Ro(Ro({},p.tabStates[L]),{storedCards:D}),l)));break;case j:var $=t.payload,q=$.tabId,U=$.cardId,V=$.status;if(q&&p.tabStates[q]){S=p.tabStates[q];p.tabStates=Ro(Ro({},p.tabStates),((c={})[q]=Ro(Ro({},S),{storedCards:S.storedCards.map((function(e){return e.id===U?Ro(Ro({},e),{exportStatus:V}):e}))}),c))}break;case B:var H=t.payload,W=H.tabId,G=H.card;if(W&&p.tabStates[W]&&G.id){var Y=(S=p.tabStates[W]).storedCards.some((function(e){return e.id===G.id}));E=void 0;E=Y?S.storedCards.map((function(e){return e.id===G.id?Ro({},G):e})):jo(jo([],S.storedCards,!0),[G],!1),p.tabStates=Ro(Ro({},p.tabStates),((u={})[W]=Ro(Ro({},S),{storedCards:E}),u))}break;case O:var X=t.payload,K=X.tabId,Q=X.currentPage;K&&p.tabStates[K]&&(p.tabStates=Ro(Ro({},p.tabStates),((d={})[K]=Ro(Ro({},p.tabStates[K]),{currentPage:Q}),d)))}return p};var No,Po=function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++){var o=t[r];0,"function"==typeof e[o]&&(n[o]=e[o])}var a,i=Object.keys(n);try{!function(e){Object.keys(e).forEach((function(t){var n=e[t];if(void 0===n(void 0,{type:io.INIT}))throw new Error(ro(12));if(void 0===n(void 0,{type:io.PROBE_UNKNOWN_ACTION()}))throw new Error(ro(13))}))}(n)}catch(e){a=e}return function(e,t){if(void 0===e&&(e={}),a)throw a;for(var r=!1,o={},s=0;s<i.length;s++){var l=i[s],c=n[l],u=e[l],d=c(u,t);if(void 0===d){t&&t.type;throw new Error(ro(14))}o[l]=d,r=r||d!==u}return(r=r||i.length!==Object.keys(e).length)?o:e}}({deck:function(e,t){switch(void 0===e&&(e=mo),t.type){case Dn:return go(go({},e),{decks:t.payload});case $n:return go(go({},e),{deckId:t.payload});default:return e}},cards:xo,settings:Rt.W,currentPage:wo,anki:Co,sidebar:To,notifications:_o,tabState:Oo,view:function(e,t){var n,r,o,a,i;switch(void 0===e&&(e=dr),t.type){case sr:return ar(ar(ar({},e),t.payload),{globalMode:null!==(i=null!==(a=t.payload.globalMode)&&void 0!==a?a:e.globalMode)&&void 0!==i?i:"sidebar",globalVisible:"boolean"==typeof t.payload.globalVisible?t.payload.globalVisible:"boolean"!=typeof e.globalVisible||e.globalVisible});case lr:var s=t.payload,l=s.tabId,c=s.mode;return ar(ar({},e),{preferredModeByTab:ar(ar({},e.preferredModeByTab),(n={},n[l]=c,n)),globalMode:c});case cr:var u=t.payload,d=(l=u.tabId,u.visible);return ar(ar({},e),{visibleByTab:ar(ar({},e.visibleByTab),(r={},r[l]=d,r)),globalVisible:d});case ur:var p=t.payload,h=(l=p.tabId,p.geometry);return ar(ar({},e),{floatGeometryByTab:ar(ar({},e.floatGeometryByTab),(o={},o[l]=h,o))});default:return e}}}),Lo=function(e,t,n){const{namespace:r,chromeNs:o,browserNs:a,storageArea:i,storageKey:s,isolated:l,plainActions:c,outdatedTimeout:u}=t||{},{onGlobalChange:d,onLocalChange:p,onError:h}=n||{};if("function"!=typeof e)throw new Error("Missing argument for 'storeCreatorContainer'");const f=a||r===Qr.browser?new Kr({namespace:a||browser,area:i,key:s}):new Xr({namespace:o||chrome,area:i,key:s});return"function"==typeof d&&f.regListener(((t,n)=>{const r=new Hr(e,f,!0,c),[o]=Vr(t),[a]=Vr(n);d(r.initFrom(o),a)})),l||f.regShared(),t=>{h&&f.subscribeForError(h);return new Hr(e,f,l,c,u,p,t).init()}}((function(e){return lo(Po,e,uo(fo,wn))}));console.log("Content script works!"),console.log("Must reload extension for modifications to take effect."),No="Using the 'printLine' function from the Print Module",console.log("===> FROM THE PRINT MODULE:",No);const Do=document.createElement("div");Do.id="sidebar",Do.setAttribute("style","\n  all: initial;\n  position: fixed;\n  top: 0;\n  right: 0;\n  width: 350px;\n  height: 100%;\n  overflow: auto;\n  z-index: 2147483645; /* \u043d\u0438\u0436\u0435 \u043f\u043b\u0430\u0432\u0430\u044e\u0449\u0435\u0433\u043e \u043e\u043a\u043d\u0430 */\n  background-color: #ffffff;\n  box-shadow: -2px 0 5px rgba(0, 0, 0, 0.15);\n  transform: translateX(100%); /* \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u0441\u043a\u0440\u044b\u0442\u043e */\n  transition: transform 0.3s ease-in-out;\n");const $o=Do.attachShadow({mode:"open"}),qo=document.createElement("link");qo.setAttribute("rel","stylesheet"),qo.setAttribute("href",chrome.runtime.getURL("tailwind.css")),$o.appendChild(qo),document.body.appendChild(Do);const Uo=(0,o.H)($o),Vo=()=>r.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",background:"linear-gradient(135deg, #2563EB 0%, #1D4ED8 100%)",fontFamily:"system-ui, -apple-system, sans-serif",color:"#ffffff"}},[r.createElement("div",{key:"logo",style:{width:"48px",height:"48px",background:"rgba(255,255,255,0.2)",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:"24px",animation:"pulse 2s ease-in-out infinite"}},"\u{1f9e0}"),r.createElement("div",{key:"spinner",style:{width:"32px",height:"32px",border:"2px solid rgba(255,255,255,0.3)",borderTop:"2px solid #ffffff",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:"20px"}}),r.createElement("h2",{key:"title",style:{color:"#ffffff",fontSize:20,fontWeight:700,marginBottom:8,textAlign:"center"}},"Anki Flash Cards"),r.createElement("p",{key:"subtitle",style:{color:"rgba(255,255,255,0.8)",fontSize:14,textAlign:"center"}},"Initializing your learning assistant..."),r.createElement("div",{key:"progress-bar",style:{width:200,height:2,backgroundColor:"rgba(255,255,255,0.3)",borderRadius:1,marginTop:24,overflow:"hidden"}},r.createElement("div",{style:{width:"100%",height:"100%",backgroundColor:"#ffffff",animation:"progressBar 2s ease-in-out infinite"}})),r.createElement("style",{key:"styles"},"\n      @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }\n      @keyframes pulse { 0%,100% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.05); opacity: 0.8; } }\n      @keyframes progressBar { 0% { transform: translateX(-100%); } 50% { transform: translateX(0%); } 100% { transform: translateX(100%); } }\n    ")]),Ho="anki_view_prefs_v1",Wo=e=>new Promise((t=>{chrome.storage.local.get([Ho],(n=>{const r=(o=n[Ho],{preferredModeByTab:{...o?.preferredModeByTab||{}},visibleByTab:{...o?.visibleByTab||{}},floatGeometryByTab:{...o?.floatGeometryByTab||{}},globalMode:"float"===o?.globalMode?"float":"sidebar",globalVisible:"boolean"!=typeof o?.globalVisible||o.globalVisible});var o;const a=e(r)||r;chrome.storage.local.set({[Ho]:a},(()=>t(a)))}))}));function Go(){this.prefix="anki_ui_tab_"}Go.prototype.key=function(e){return this.prefix+String(e)},Go.prototype.get=function(e){const t=this.key(e);return new Promise((e=>{chrome.storage.local.get([t,Ho],(n=>{const r=n[t];if(r)return void e(r);const o=n[Ho]||{},a="float"===o.globalMode?"floating":"sidebar",i="boolean"!=typeof o.globalVisible||o.globalVisible;e({sidebarVisible:"sidebar"===a&&i,floatingVisible:"floating"===a&&i,preferredMode:a})}))}))},Go.prototype.set=function(e,t){const n=this.key(e);return new Promise((e=>{chrome.storage.local.get([n],(r=>{const o={...r[n]||{sidebarVisible:!1,floatingVisible:!1,preferredMode:"sidebar"},...t};chrome.storage.local.set({[n]:o},(()=>e(o)))}))}))};const Yo=new Go,Xo=()=>{Do.removeAttribute("hidden"),Do.style.removeProperty("display"),Do.style.removeProperty("visibility"),Do.style.removeProperty("opacity"),Do.style.transform="translateX(0)",document.body.style.marginRight="350px"},Ko=()=>{Do.style.transform="translateX(100%)",document.body.style.marginRight="0"},Qo=e=>{e?Xo():Ko()},Jo=()=>{const[e,t]=(0,r.useState)(null),[n,o]=(0,r.useState)(!0),[a,i]=(0,r.useState)(null);return(0,r.useEffect)((()=>{(async()=>{try{chrome.runtime.sendMessage({action:"getTabId"},(async e=>{const t=e&&void 0!==e.tabId?e.tabId:Math.floor(1e6*Math.random());i(t);try{const e=await Yo.get(t);Qo(e.sidebarVisible)}catch(e){console.error("Error reading initial UI state:",e),Qo(!1)}}));const e=await Lo();t(e),setTimeout((()=>o(!1)),100)}catch(e){console.error("Error initializing store:",e),o(!1)}})()}),[]),n||!e||null===a?r.createElement(Vo):r.createElement(w,{store:e},r.createElement(zr,{tabId:a}))};Uo.render(r.createElement(Jo)),chrome.runtime.onMessage.addListener(((e,t,n)=>{if(e&&e.action){if("toggleSidebar"===e.action){const t=e.tabId;return t?(Yo.get(t).then((e=>{const r=!e.sidebarVisible;Qo(r),Yo.set(t,{sidebarVisible:r}).then((()=>{Wo((e=>(e.visibleByTab[t]=r,r&&(e.preferredModeByTab[t]="sidebar",e.globalMode="sidebar"),e.globalVisible=r,e))).finally((()=>{n&&n({status:"Sidebar toggled",visible:r,tabId:t})}))}))})),!0):(n&&n({status:"error",message:"Unknown tab ID"}),!0)}if("collapseSidebar"===e.action||"forceHideSidebar"===e.action){const t=e.tabId;return t&&(Yo.set(t,{sidebarVisible:!1}),Wo((e=>(e.visibleByTab[t]=!1,e.globalVisible=!1,e)))),Ko(),n&&n({ok:!0}),!0}if("expandSidebar"===e.action||"forceShowSidebar"===e.action){const t=e.tabId;return t&&(Yo.set(t,{sidebarVisible:!0}),Wo((e=>(e.visibleByTab[t]=!0,e.preferredModeByTab[t]="sidebar",e.globalVisible=!0,e.globalMode="sidebar",e)))),Xo(),n&&n({ok:!0}),!0}if("setPreferredMode"===e.action){const t=e.tabId,r="floating"===e.mode?"floating":"sidebar";return t&&Yo.set(t,{preferredMode:r}),Wo((e=>(t&&(e.preferredModeByTab[t]="floating"===r?"float":"sidebar"),e.globalMode="floating"===r?"float":"sidebar",e))).finally((()=>{n&&n({ok:!0,preferredMode:r})})),!0}if("syncFloatingState"===e.action){const t=e.tabId,r=!!e.floatingVisible;return t&&Yo.set(t,{floatingVisible:r}),t&&Wo((e=>(e.visibleByTab[t]=r,r&&(e.preferredModeByTab[t]="float",e.globalMode="float"),e.globalVisible=r,e))),n&&n({ok:!0}),!0}if("togglePreferredUI"===e.action){const t=e.tabId;return t?(Yo.get(t).then((e=>{if("floating"===(e.preferredMode||"sidebar"))e.floatingVisible?(chrome.runtime.sendMessage({action:"hideFloating",tabId:t},(()=>{})),Yo.set(t,{floatingVisible:!1,sidebarVisible:!1}).then((()=>{Wo((e=>(e.visibleByTab[t]=!1,e.globalVisible=!1,e))).finally((()=>{Qo(!1),n&&n({ok:!0,toggled:"floating:off"})}))}))):(chrome.runtime.sendMessage({action:"showFloating",tabId:t},(()=>{})),Yo.set(t,{floatingVisible:!0,sidebarVisible:!1}).then((()=>{Wo((e=>(e.visibleByTab[t]=!0,e.preferredModeByTab[t]="float",e.globalVisible=!0,e.globalMode="float",e))).finally((()=>{Qo(!1),n&&n({ok:!0,toggled:"floating:on"})}))})));else{const r=!e.sidebarVisible;Qo(r),Yo.set(t,{sidebarVisible:r,floatingVisible:!1}).then((()=>{Wo((e=>(e.visibleByTab[t]=r,r&&(e.preferredModeByTab[t]="sidebar",e.globalMode="sidebar"),e.globalVisible=r,e))).finally((()=>{r&&chrome.runtime.sendMessage({action:"hideFloating",tabId:t},(()=>{})),n&&n({ok:!0,toggled:"sidebar:"+(r?"on":"off")})}))}))}})),!0):(n&&n({status:"error",message:"Unknown tab ID"}),!0)}return"toggleFloating"===e.action||"showFloating"===e.action||"hideFloating"===e.action?(n&&n({ok:!0}),!0):void 0}}))})();