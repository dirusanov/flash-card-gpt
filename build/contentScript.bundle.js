(()=>{"use strict";var e={146:(e,t,n)=>{var r=n(363),o={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},a={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},i={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};function l(e){return r.isMemo(e)?i:s[e.$$typeof]||o}s[r.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},s[r.Memo]=i;var c=Object.defineProperty,u=Object.getOwnPropertyNames,d=Object.getOwnPropertySymbols,f=Object.getOwnPropertyDescriptor,p=Object.getPrototypeOf,g=Object.prototype;e.exports=function e(t,n,r){if("string"!=typeof n){if(g){var o=p(n);o&&o!==g&&e(t,o,r)}var i=u(n);d&&(i=i.concat(d(n)));for(var s=l(t),h=l(n),m=0;m<i.length;++m){var y=i[m];if(!(a[y]||r&&r[y]||h&&h[y]||s&&s[y])){var x=f(n,y);try{c(t,y,x)}catch(e){}}}}return t}},551:(e,t,n)=>{
/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var r=n(540),o=n(982);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,s={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(s[e]=t,e=0;e<t.length;e++)i.add(t[e])}var u=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),d=Object.prototype.hasOwnProperty,f=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},g={};function h(e,t,n,r,o,a,i){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=i}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){m[e]=new h(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];m[t]=new h(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){m[e]=new h(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){m[e]=new h(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){m[e]=new h(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){m[e]=new h(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){m[e]=new h(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){m[e]=new h(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){m[e]=new h(e,5,!1,e.toLowerCase(),null,!1,!1)}));var y=/[\-:]([a-z])/g;function x(e){return e[1].toUpperCase()}function v(e,t,n,r){var o=m.hasOwnProperty(t)?m[t]:null;(null!==o?0!==o.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null==t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,o,r)&&(n=null),r||null===o?function(e){return!!d.call(g,e)||!d.call(p,e)&&(f.test(e)?g[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):o.mustUseProperty?e[o.propertyName]=null===n?3!==o.type&&"":n:(t=o.attributeName,r=o.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(o=o.type)||4===o&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(y,x);m[t]=new h(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(y,x);m[t]=new h(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(y,x);m[t]=new h(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){m[e]=new h(e,1,!1,e.toLowerCase(),null,!1,!1)})),m.xlinkHref=new h("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){m[e]=new h(e,1,!1,e.toLowerCase(),null,!0,!0)}));var b=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for("react.element"),S=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),k=Symbol.for("react.profiler"),I=Symbol.for("react.provider"),A=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),F=Symbol.for("react.suspense"),T=Symbol.for("react.suspense_list"),j=Symbol.for("react.memo"),O=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var P=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var R=Symbol.iterator;function N(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=R&&e[R]||e["@@iterator"])?e:null}var L,B=Object.assign;function z(e){if(void 0===L)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);L=t&&t[1]||""}return"\n"+L+e}var D=!1;function M(e,t){if(!e||D)return"";D=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(e){var r=e}Reflect.construct(e,[],t)}else{try{t.call()}catch(e){r=e}e.call(t.prototype)}else{try{throw Error()}catch(e){r=e}e()}}catch(t){if(t&&r&&"string"==typeof t.stack){for(var o=t.stack.split("\n"),a=r.stack.split("\n"),i=o.length-1,s=a.length-1;1<=i&&0<=s&&o[i]!==a[s];)s--;for(;1<=i&&0<=s;i--,s--)if(o[i]!==a[s]){if(1!==i||1!==s)do{if(i--,0>--s||o[i]!==a[s]){var l="\n"+o[i].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=i&&0<=s);break}}}finally{D=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?z(e):""}function U(e){switch(e.tag){case 5:return z(e.type);case 16:return z("Lazy");case 13:return z("Suspense");case 19:return z("SuspenseList");case 0:case 2:case 15:return e=M(e.type,!1);case 11:return e=M(e.type.render,!1);case 1:return e=M(e.type,!0);default:return""}}function $(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case C:return"Fragment";case S:return"Portal";case k:return"Profiler";case E:return"StrictMode";case F:return"Suspense";case T:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case A:return(e.displayName||"Context")+".Consumer";case I:return(e._context.displayName||"Context")+".Provider";case _:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case j:return null!==(t=e.displayName||null)?t:$(e.type)||"Memo";case O:t=e._payload,e=e._init;try{return $(e(t))}catch(e){}}return null}function W(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return $(t);case 8:return t===E?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t}return null}function V(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function q(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function G(e){e._valueTracker||(e._valueTracker=function(e){var t=q(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var o=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function H(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=q(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function K(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Y(e,t){var n=t.checked;return B({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Q(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=V(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function J(e,t){null!=(t=t.checked)&&v(e,"checked",t,!1)}function X(e,t){J(e,t);var n=V(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,V(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&K(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var o=0;o<n.length;o++)t["$"+n[o]]=!0;for(n=0;n<e.length;n++)o=t.hasOwnProperty("$"+e[n].value),e[n].selected!==o&&(e[n].selected=o),o&&r&&(e[n].defaultSelected=!0)}else{for(n=""+V(n),t=null,o=0;o<e.length;o++){if(e[o].value===n)return e[o].selected=!0,void(r&&(e[o].defaultSelected=!0));null!==t||e[o].disabled||(t=e[o])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return B({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function oe(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(a(92));if(te(n)){if(1<n.length)throw Error(a(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:V(n)}}function ae(e,t){var n=V(t.value),r=V(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function ie(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,de=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return ue(e,t)}))}:ue);function fe(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ge=["Webkit","ms","Moz","O"];function he(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function me(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),o=he(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,o):e[n]=o}}Object.keys(pe).forEach((function(e){ge.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]}))}));var ye=B({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function xe(e,t){if(t){if(ye[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(a(62))}}function ve(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var be=null;function we(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Se=null,Ce=null,Ee=null;function ke(e){if(e=bo(e)){if("function"!=typeof Se)throw Error(a(280));var t=e.stateNode;t&&(t=So(t),Se(e.stateNode,e.type,t))}}function Ie(e){Ce?Ee?Ee.push(e):Ee=[e]:Ce=e}function Ae(){if(Ce){var e=Ce,t=Ee;if(Ee=Ce=null,ke(e),t)for(e=0;e<t.length;e++)ke(t[e])}}function _e(e,t){return e(t)}function Fe(){}var Te=!1;function je(e,t,n){if(Te)return e(t,n);Te=!0;try{return _e(e,t,n)}finally{Te=!1,(null!==Ce||null!==Ee)&&(Fe(),Ae())}}function Oe(e,t){var n=e.stateNode;if(null===n)return null;var r=So(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(a(231,t,typeof n));return n}var Pe=!1;if(u)try{var Re={};Object.defineProperty(Re,"passive",{get:function(){Pe=!0}}),window.addEventListener("test",Re,Re),window.removeEventListener("test",Re,Re)}catch(ue){Pe=!1}function Ne(e,t,n,r,o,a,i,s,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(e){this.onError(e)}}var Le=!1,Be=null,ze=!1,De=null,Me={onError:function(e){Le=!0,Be=e}};function Ue(e,t,n,r,o,a,i,s,l){Le=!1,Be=null,Ne.apply(Me,arguments)}function $e(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function We(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ve(e){if($e(e)!==e)throw Error(a(188))}function qe(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=$e(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,r=t;;){var o=n.return;if(null===o)break;var i=o.alternate;if(null===i){if(null!==(r=o.return)){n=r;continue}break}if(o.child===i.child){for(i=o.child;i;){if(i===n)return Ve(o),e;if(i===r)return Ve(o),t;i=i.sibling}throw Error(a(188))}if(n.return!==r.return)n=o,r=i;else{for(var s=!1,l=o.child;l;){if(l===n){s=!0,n=o,r=i;break}if(l===r){s=!0,r=o,n=i;break}l=l.sibling}if(!s){for(l=i.child;l;){if(l===n){s=!0,n=i,r=o;break}if(l===r){s=!0,r=i,n=o;break}l=l.sibling}if(!s)throw Error(a(189))}}if(n.alternate!==r)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(e))?Ge(e):null}function Ge(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ge(e);if(null!==t)return t;e=e.sibling}return null}var He=o.unstable_scheduleCallback,Ke=o.unstable_cancelCallback,Ye=o.unstable_shouldYield,Qe=o.unstable_requestPaint,Je=o.unstable_now,Xe=o.unstable_getCurrentPriorityLevel,Ze=o.unstable_ImmediatePriority,et=o.unstable_UserBlockingPriority,tt=o.unstable_NormalPriority,nt=o.unstable_LowPriority,rt=o.unstable_IdlePriority,ot=null,at=null;var it=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(st(e)/lt|0)|0},st=Math.log,lt=Math.LN2;var ct=64,ut=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ft(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,o=e.suspendedLanes,a=e.pingedLanes,i=268435455&n;if(0!==i){var s=i&~o;0!==s?r=dt(s):0!==(a&=i)&&(r=dt(a))}else 0!==(i=n&~o)?r=dt(i):0!==a&&(r=dt(a));if(0===r)return 0;if(0!==t&&t!==r&&!(t&o)&&((o=r&-r)>=(a=t&-t)||16===o&&4194240&a))return t;if(4&r&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)o=1<<(n=31-it(t)),r|=e[n],t&=~o;return r}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function gt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function ht(){var e=ct;return!(4194240&(ct<<=1))&&(ct=64),e}function mt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function yt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-it(t)]=n}function xt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-it(n),o=1<<r;o&t|e[r]&t&&(e[r]|=t),n&=~o}}var vt=0;function bt(e){return 1<(e&=-e)?4<e?268435455&e?16:536870912:4:1}var wt,St,Ct,Et,kt,It=!1,At=[],_t=null,Ft=null,Tt=null,jt=new Map,Ot=new Map,Pt=[],Rt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Nt(e,t){switch(e){case"focusin":case"focusout":_t=null;break;case"dragenter":case"dragleave":Ft=null;break;case"mouseover":case"mouseout":Tt=null;break;case"pointerover":case"pointerout":jt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ot.delete(t.pointerId)}}function Lt(e,t,n,r,o,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[o]},null!==t&&(null!==(t=bo(t))&&St(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==o&&-1===t.indexOf(o)&&t.push(o),e)}function Bt(e){var t=vo(e.target);if(null!==t){var n=$e(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=We(n)))return e.blockedOn=t,void kt(e.priority,(function(){Ct(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function zt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Yt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=bo(n))&&St(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);be=r,n.target.dispatchEvent(r),be=null,t.shift()}return!0}function Dt(e,t,n){zt(e)&&n.delete(t)}function Mt(){It=!1,null!==_t&&zt(_t)&&(_t=null),null!==Ft&&zt(Ft)&&(Ft=null),null!==Tt&&zt(Tt)&&(Tt=null),jt.forEach(Dt),Ot.forEach(Dt)}function Ut(e,t){e.blockedOn===t&&(e.blockedOn=null,It||(It=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,Mt)))}function $t(e){function t(t){return Ut(t,e)}if(0<At.length){Ut(At[0],e);for(var n=1;n<At.length;n++){var r=At[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==_t&&Ut(_t,e),null!==Ft&&Ut(Ft,e),null!==Tt&&Ut(Tt,e),jt.forEach(t),Ot.forEach(t),n=0;n<Pt.length;n++)(r=Pt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Pt.length&&null===(n=Pt[0]).blockedOn;)Bt(n),null===n.blockedOn&&Pt.shift()}var Wt=b.ReactCurrentBatchConfig,Vt=!0;function qt(e,t,n,r){var o=vt,a=Wt.transition;Wt.transition=null;try{vt=1,Ht(e,t,n,r)}finally{vt=o,Wt.transition=a}}function Gt(e,t,n,r){var o=vt,a=Wt.transition;Wt.transition=null;try{vt=4,Ht(e,t,n,r)}finally{vt=o,Wt.transition=a}}function Ht(e,t,n,r){if(Vt){var o=Yt(e,t,n,r);if(null===o)Vr(e,t,r,Kt,n),Nt(e,r);else if(function(e,t,n,r,o){switch(t){case"focusin":return _t=Lt(_t,e,t,n,r,o),!0;case"dragenter":return Ft=Lt(Ft,e,t,n,r,o),!0;case"mouseover":return Tt=Lt(Tt,e,t,n,r,o),!0;case"pointerover":var a=o.pointerId;return jt.set(a,Lt(jt.get(a)||null,e,t,n,r,o)),!0;case"gotpointercapture":return a=o.pointerId,Ot.set(a,Lt(Ot.get(a)||null,e,t,n,r,o)),!0}return!1}(o,e,t,n,r))r.stopPropagation();else if(Nt(e,r),4&t&&-1<Rt.indexOf(e)){for(;null!==o;){var a=bo(o);if(null!==a&&wt(a),null===(a=Yt(e,t,n,r))&&Vr(e,t,r,Kt,n),a===o)break;o=a}null!==o&&r.stopPropagation()}else Vr(e,t,r,null,n)}}var Kt=null;function Yt(e,t,n,r){if(Kt=null,null!==(e=vo(e=we(r))))if(null===(t=$e(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=We(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Kt=e,null}function Qt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Xe()){case Ze:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Jt=null,Xt=null,Zt=null;function en(){if(Zt)return Zt;var e,t,n=Xt,r=n.length,o="value"in Jt?Jt.value:Jt.textContent,a=o.length;for(e=0;e<r&&n[e]===o[e];e++);var i=r-e;for(t=1;t<=i&&n[r-t]===o[a-t];t++);return Zt=o.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function on(e){function t(t,n,r,o,a){for(var i in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=o,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(i)&&(t=e[i],this[i]=t?t(o):o[i]);return this.isDefaultPrevented=(null!=o.defaultPrevented?o.defaultPrevented:!1===o.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return B(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var an,sn,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=on(cn),dn=B({},cn,{view:0,detail:0}),fn=on(dn),pn=B({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:kn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(an=e.screenX-ln.screenX,sn=e.screenY-ln.screenY):sn=an=0,ln=e),an)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),gn=on(pn),hn=on(B({},pn,{dataTransfer:0})),mn=on(B({},dn,{relatedTarget:0})),yn=on(B({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),xn=B({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),vn=on(xn),bn=on(B({},cn,{data:0})),wn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Cn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function En(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Cn[e])&&!!t[e]}function kn(){return En}var In=B({},dn,{key:function(e){if(e.key){var t=wn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Sn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:kn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),An=on(In),_n=on(B({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Fn=on(B({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:kn})),Tn=on(B({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),jn=B({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),On=on(jn),Pn=[9,13,27,32],Rn=u&&"CompositionEvent"in window,Nn=null;u&&"documentMode"in document&&(Nn=document.documentMode);var Ln=u&&"TextEvent"in window&&!Nn,Bn=u&&(!Rn||Nn&&8<Nn&&11>=Nn),zn=String.fromCharCode(32),Dn=!1;function Mn(e,t){switch(e){case"keyup":return-1!==Pn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Un(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var $n=!1;var Wn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Wn[e.type]:"textarea"===t}function qn(e,t,n,r){Ie(r),0<(t=Gr(t,"onChange")).length&&(n=new un("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Gn=null,Hn=null;function Kn(e){zr(e,0)}function Yn(e){if(H(wo(e)))return e}function Qn(e,t){if("change"===e)return t}var Jn=!1;if(u){var Xn;if(u){var Zn="oninput"in document;if(!Zn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Zn="function"==typeof er.oninput}Xn=Zn}else Xn=!1;Jn=Xn&&(!document.documentMode||9<document.documentMode)}function tr(){Gn&&(Gn.detachEvent("onpropertychange",nr),Hn=Gn=null)}function nr(e){if("value"===e.propertyName&&Yn(Hn)){var t=[];qn(t,Hn,e,we(e)),je(Kn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Hn=n,(Gn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function or(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Yn(Hn)}function ar(e,t){if("click"===e)return Yn(t)}function ir(e,t){if("input"===e||"change"===e)return Yn(t)}var sr="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function lr(e,t){if(sr(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var o=n[r];if(!d.call(t,o)||!sr(e[o],t[o]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ur(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function dr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?dr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function fr(){for(var e=window,t=K();t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(e){n=!1}if(!n)break;t=K((e=t.contentWindow).document)}return t}function pr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function gr(e){var t=fr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&dr(n.ownerDocument.documentElement,n)){if(null!==r&&pr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var o=n.textContent.length,a=Math.min(r.start,o);r=void 0===r.end?a:Math.min(r.end,o),!e.extend&&a>r&&(o=r,r=a,a=o),o=ur(n,a);var i=ur(n,r);o&&i&&(1!==e.rangeCount||e.anchorNode!==o.node||e.anchorOffset!==o.offset||e.focusNode!==i.node||e.focusOffset!==i.offset)&&((t=t.createRange()).setStart(o.node,o.offset),e.removeAllRanges(),a>r?(e.addRange(t),e.extend(i.node,i.offset)):(t.setEnd(i.node,i.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"==typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var hr=u&&"documentMode"in document&&11>=document.documentMode,mr=null,yr=null,xr=null,vr=!1;function br(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;vr||null==mr||mr!==K(r)||("selectionStart"in(r=mr)&&pr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},xr&&lr(xr,r)||(xr=r,0<(r=Gr(yr,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=mr)))}function wr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Sr={animationend:wr("Animation","AnimationEnd"),animationiteration:wr("Animation","AnimationIteration"),animationstart:wr("Animation","AnimationStart"),transitionend:wr("Transition","TransitionEnd")},Cr={},Er={};function kr(e){if(Cr[e])return Cr[e];if(!Sr[e])return e;var t,n=Sr[e];for(t in n)if(n.hasOwnProperty(t)&&t in Er)return Cr[e]=n[t];return e}u&&(Er=document.createElement("div").style,"AnimationEvent"in window||(delete Sr.animationend.animation,delete Sr.animationiteration.animation,delete Sr.animationstart.animation),"TransitionEvent"in window||delete Sr.transitionend.transition);var Ir=kr("animationend"),Ar=kr("animationiteration"),_r=kr("animationstart"),Fr=kr("transitionend"),Tr=new Map,jr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Or(e,t){Tr.set(e,t),l(t,[e])}for(var Pr=0;Pr<jr.length;Pr++){var Rr=jr[Pr];Or(Rr.toLowerCase(),"on"+(Rr[0].toUpperCase()+Rr.slice(1)))}Or(Ir,"onAnimationEnd"),Or(Ar,"onAnimationIteration"),Or(_r,"onAnimationStart"),Or("dblclick","onDoubleClick"),Or("focusin","onFocus"),Or("focusout","onBlur"),Or(Fr,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Nr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Lr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Nr));function Br(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,o,i,s,l,c){if(Ue.apply(this,arguments),Le){if(!Le)throw Error(a(198));var u=Be;Le=!1,Be=null,ze||(ze=!0,De=u)}}(r,t,void 0,e),e.currentTarget=null}function zr(e,t){t=!!(4&t);for(var n=0;n<e.length;n++){var r=e[n],o=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var i=r.length-1;0<=i;i--){var s=r[i],l=s.instance,c=s.currentTarget;if(s=s.listener,l!==a&&o.isPropagationStopped())break e;Br(o,s,c),a=l}else for(i=0;i<r.length;i++){if(l=(s=r[i]).instance,c=s.currentTarget,s=s.listener,l!==a&&o.isPropagationStopped())break e;Br(o,s,c),a=l}}}if(ze)throw e=De,ze=!1,De=null,e}function Dr(e,t){var n=t[mo];void 0===n&&(n=t[mo]=new Set);var r=e+"__bubble";n.has(r)||(Wr(t,e,2,!1),n.add(r))}function Mr(e,t,n){var r=0;t&&(r|=4),Wr(n,e,r,t)}var Ur="_reactListening"+Math.random().toString(36).slice(2);function $r(e){if(!e[Ur]){e[Ur]=!0,i.forEach((function(t){"selectionchange"!==t&&(Lr.has(t)||Mr(t,!1,e),Mr(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Ur]||(t[Ur]=!0,Mr("selectionchange",!1,t))}}function Wr(e,t,n,r){switch(Qt(t)){case 1:var o=qt;break;case 4:o=Gt;break;default:o=Ht}n=o.bind(null,t,n,e),o=void 0,!Pe||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(o=!0),r?void 0!==o?e.addEventListener(t,n,{capture:!0,passive:o}):e.addEventListener(t,n,!0):void 0!==o?e.addEventListener(t,n,{passive:o}):e.addEventListener(t,n,!1)}function Vr(e,t,n,r,o){var a=r;if(!(1&t||2&t||null===r))e:for(;;){if(null===r)return;var i=r.tag;if(3===i||4===i){var s=r.stateNode.containerInfo;if(s===o||8===s.nodeType&&s.parentNode===o)break;if(4===i)for(i=r.return;null!==i;){var l=i.tag;if((3===l||4===l)&&((l=i.stateNode.containerInfo)===o||8===l.nodeType&&l.parentNode===o))return;i=i.return}for(;null!==s;){if(null===(i=vo(s)))return;if(5===(l=i.tag)||6===l){r=a=i;continue e}s=s.parentNode}}r=r.return}je((function(){var r=a,o=we(n),i=[];e:{var s=Tr.get(e);if(void 0!==s){var l=un,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=An;break;case"focusin":c="focus",l=mn;break;case"focusout":c="blur",l=mn;break;case"beforeblur":case"afterblur":l=mn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=gn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=hn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Fn;break;case Ir:case Ar:case _r:l=yn;break;case Fr:l=Tn;break;case"scroll":l=fn;break;case"wheel":l=On;break;case"copy":case"cut":case"paste":l=vn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=_n}var u=!!(4&t),d=!u&&"scroll"===e,f=u?null!==s?s+"Capture":null:s;u=[];for(var p,g=r;null!==g;){var h=(p=g).stateNode;if(5===p.tag&&null!==h&&(p=h,null!==f&&(null!=(h=Oe(g,f))&&u.push(qr(g,h,p)))),d)break;g=g.return}0<u.length&&(s=new l(s,c,null,n,o),i.push({event:s,listeners:u}))}}if(!(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===be||!(c=n.relatedTarget||n.fromElement)||!vo(c)&&!c[ho])&&(l||s)&&(s=o.window===o?o:(s=o.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=r,null!==(c=(c=n.relatedTarget||n.toElement)?vo(c):null)&&(c!==(d=$e(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=r),l!==c)){if(u=gn,h="onMouseLeave",f="onMouseEnter",g="mouse","pointerout"!==e&&"pointerover"!==e||(u=_n,h="onPointerLeave",f="onPointerEnter",g="pointer"),d=null==l?s:wo(l),p=null==c?s:wo(c),(s=new u(h,g+"leave",l,n,o)).target=d,s.relatedTarget=p,h=null,vo(o)===r&&((u=new u(f,g+"enter",c,n,o)).target=p,u.relatedTarget=d,h=u),d=h,l&&c)e:{for(f=c,g=0,p=u=l;p;p=Hr(p))g++;for(p=0,h=f;h;h=Hr(h))p++;for(;0<g-p;)u=Hr(u),g--;for(;0<p-g;)f=Hr(f),p--;for(;g--;){if(u===f||null!==f&&u===f.alternate)break e;u=Hr(u),f=Hr(f)}u=null}else u=null;null!==l&&Kr(i,s,l,u,!1),null!==c&&null!==d&&Kr(i,d,c,u,!0)}if("select"===(l=(s=r?wo(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var m=Qn;else if(Vn(s))if(Jn)m=ir;else{m=or;var y=rr}else(l=s.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(m=ar);switch(m&&(m=m(e,r))?qn(i,m,n,o):(y&&y(e,s,r),"focusout"===e&&(y=s._wrapperState)&&y.controlled&&"number"===s.type&&ee(s,"number",s.value)),y=r?wo(r):window,e){case"focusin":(Vn(y)||"true"===y.contentEditable)&&(mr=y,yr=r,xr=null);break;case"focusout":xr=yr=mr=null;break;case"mousedown":vr=!0;break;case"contextmenu":case"mouseup":case"dragend":vr=!1,br(i,n,o);break;case"selectionchange":if(hr)break;case"keydown":case"keyup":br(i,n,o)}var x;if(Rn)e:{switch(e){case"compositionstart":var v="onCompositionStart";break e;case"compositionend":v="onCompositionEnd";break e;case"compositionupdate":v="onCompositionUpdate";break e}v=void 0}else $n?Mn(e,n)&&(v="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(v="onCompositionStart");v&&(Bn&&"ko"!==n.locale&&($n||"onCompositionStart"!==v?"onCompositionEnd"===v&&$n&&(x=en()):(Xt="value"in(Jt=o)?Jt.value:Jt.textContent,$n=!0)),0<(y=Gr(r,v)).length&&(v=new bn(v,e,null,n,o),i.push({event:v,listeners:y}),x?v.data=x:null!==(x=Un(n))&&(v.data=x))),(x=Ln?function(e,t){switch(e){case"compositionend":return Un(t);case"keypress":return 32!==t.which?null:(Dn=!0,zn);case"textInput":return(e=t.data)===zn&&Dn?null:e;default:return null}}(e,n):function(e,t){if($n)return"compositionend"===e||!Rn&&Mn(e,t)?(e=en(),Zt=Xt=Jt=null,$n=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Bn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Gr(r,"onBeforeInput")).length&&(o=new bn("onBeforeInput","beforeinput",null,n,o),i.push({event:o,listeners:r}),o.data=x))}zr(i,t)}))}function qr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Gr(e,t){for(var n=t+"Capture",r=[];null!==e;){var o=e,a=o.stateNode;5===o.tag&&null!==a&&(o=a,null!=(a=Oe(e,n))&&r.unshift(qr(e,a,o)),null!=(a=Oe(e,t))&&r.push(qr(e,a,o))),e=e.return}return r}function Hr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Kr(e,t,n,r,o){for(var a=t._reactName,i=[];null!==n&&n!==r;){var s=n,l=s.alternate,c=s.stateNode;if(null!==l&&l===r)break;5===s.tag&&null!==c&&(s=c,o?null!=(l=Oe(n,a))&&i.unshift(qr(n,l,s)):o||null!=(l=Oe(n,a))&&i.push(qr(n,l,s))),n=n.return}0!==i.length&&e.push({event:t,listeners:i})}var Yr=/\r\n?/g,Qr=/\u0000|\uFFFD/g;function Jr(e){return("string"==typeof e?e:""+e).replace(Yr,"\n").replace(Qr,"")}function Xr(e,t,n){if(t=Jr(t),Jr(e)!==t&&n)throw Error(a(425))}function Zr(){}var eo=null,to=null;function no(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ro="function"==typeof setTimeout?setTimeout:void 0,oo="function"==typeof clearTimeout?clearTimeout:void 0,ao="function"==typeof Promise?Promise:void 0,io="function"==typeof queueMicrotask?queueMicrotask:void 0!==ao?function(e){return ao.resolve(null).then(e).catch(so)}:ro;function so(e){setTimeout((function(){throw e}))}function lo(e,t){var n=t,r=0;do{var o=n.nextSibling;if(e.removeChild(n),o&&8===o.nodeType)if("/$"===(n=o.data)){if(0===r)return e.removeChild(o),void $t(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=o}while(n);$t(t)}function co(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function uo(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var fo=Math.random().toString(36).slice(2),po="__reactFiber$"+fo,go="__reactProps$"+fo,ho="__reactContainer$"+fo,mo="__reactEvents$"+fo,yo="__reactListeners$"+fo,xo="__reactHandles$"+fo;function vo(e){var t=e[po];if(t)return t;for(var n=e.parentNode;n;){if(t=n[ho]||n[po]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=uo(e);null!==e;){if(n=e[po])return n;e=uo(e)}return t}n=(e=n).parentNode}return null}function bo(e){return!(e=e[po]||e[ho])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function wo(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function So(e){return e[go]||null}var Co=[],Eo=-1;function ko(e){return{current:e}}function Io(e){0>Eo||(e.current=Co[Eo],Co[Eo]=null,Eo--)}function Ao(e,t){Eo++,Co[Eo]=e.current,e.current=t}var _o={},Fo=ko(_o),To=ko(!1),jo=_o;function Oo(e,t){var n=e.type.contextTypes;if(!n)return _o;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var o,a={};for(o in n)a[o]=t[o];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Po(e){return null!=(e=e.childContextTypes)}function Ro(){Io(To),Io(Fo)}function No(e,t,n){if(Fo.current!==_o)throw Error(a(168));Ao(Fo,t),Ao(To,n)}function Lo(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!=typeof r.getChildContext)return n;for(var o in r=r.getChildContext())if(!(o in t))throw Error(a(108,W(e)||"Unknown",o));return B({},n,r)}function Bo(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||_o,jo=Fo.current,Ao(Fo,e),Ao(To,To.current),!0}function zo(e,t,n){var r=e.stateNode;if(!r)throw Error(a(169));n?(e=Lo(e,t,jo),r.__reactInternalMemoizedMergedChildContext=e,Io(To),Io(Fo),Ao(Fo,e)):Io(To),Ao(To,n)}var Do=null,Mo=!1,Uo=!1;function $o(e){null===Do?Do=[e]:Do.push(e)}function Wo(){if(!Uo&&null!==Do){Uo=!0;var e=0,t=vt;try{var n=Do;for(vt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Do=null,Mo=!1}catch(t){throw null!==Do&&(Do=Do.slice(e+1)),He(Ze,Wo),t}finally{vt=t,Uo=!1}}return null}var Vo=[],qo=0,Go=null,Ho=0,Ko=[],Yo=0,Qo=null,Jo=1,Xo="";function Zo(e,t){Vo[qo++]=Ho,Vo[qo++]=Go,Go=e,Ho=t}function ea(e,t,n){Ko[Yo++]=Jo,Ko[Yo++]=Xo,Ko[Yo++]=Qo,Qo=e;var r=Jo;e=Xo;var o=32-it(r)-1;r&=~(1<<o),n+=1;var a=32-it(t)+o;if(30<a){var i=o-o%5;a=(r&(1<<i)-1).toString(32),r>>=i,o-=i,Jo=1<<32-it(t)+o|n<<o|r,Xo=a+e}else Jo=1<<a|n<<o|r,Xo=e}function ta(e){null!==e.return&&(Zo(e,1),ea(e,1,0))}function na(e){for(;e===Go;)Go=Vo[--qo],Vo[qo]=null,Ho=Vo[--qo],Vo[qo]=null;for(;e===Qo;)Qo=Ko[--Yo],Ko[Yo]=null,Xo=Ko[--Yo],Ko[Yo]=null,Jo=Ko[--Yo],Ko[Yo]=null}var ra=null,oa=null,aa=!1,ia=null;function sa(e,t){var n=Oc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function la(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ra=e,oa=co(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ra=e,oa=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Qo?{id:Jo,overflow:Xo}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Oc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ra=e,oa=null,!0);default:return!1}}function ca(e){return!(!(1&e.mode)||128&e.flags)}function ua(e){if(aa){var t=oa;if(t){var n=t;if(!la(e,t)){if(ca(e))throw Error(a(418));t=co(n.nextSibling);var r=ra;t&&la(e,t)?sa(r,n):(e.flags=-4097&e.flags|2,aa=!1,ra=e)}}else{if(ca(e))throw Error(a(418));e.flags=-4097&e.flags|2,aa=!1,ra=e}}}function da(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ra=e}function fa(e){if(e!==ra)return!1;if(!aa)return da(e),aa=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!no(e.type,e.memoizedProps)),t&&(t=oa)){if(ca(e))throw pa(),Error(a(418));for(;t;)sa(e,t),t=co(t.nextSibling)}if(da(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){oa=co(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}oa=null}}else oa=ra?co(e.stateNode.nextSibling):null;return!0}function pa(){for(var e=oa;e;)e=co(e.nextSibling)}function ga(){oa=ra=null,aa=!1}function ha(e){null===ia?ia=[e]:ia.push(e)}var ma=b.ReactCurrentBatchConfig;function ya(e,t){if(e&&e.defaultProps){for(var n in t=B({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var xa=ko(null),va=null,ba=null,wa=null;function Sa(){wa=ba=va=null}function Ca(e){var t=xa.current;Io(xa),e._currentValue=t}function Ea(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function ka(e,t){va=e,wa=ba=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(!!(e.lanes&t)&&(bs=!0),e.firstContext=null)}function Ia(e){var t=e._currentValue;if(wa!==e)if(e={context:e,memoizedValue:t,next:null},null===ba){if(null===va)throw Error(a(308));ba=e,va.dependencies={lanes:0,firstContext:e}}else ba=ba.next=e;return t}var Aa=null;function _a(e){null===Aa?Aa=[e]:Aa.push(e)}function Fa(e,t,n,r){var o=t.interleaved;return null===o?(n.next=n,_a(t)):(n.next=o.next,o.next=n),t.interleaved=n,Ta(e,r)}function Ta(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var ja=!1;function Oa(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Pa(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ra(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Na(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,2&Fl){var o=r.pending;return null===o?t.next=t:(t.next=o.next,o.next=t),r.pending=t,Ta(e,n)}return null===(o=r.interleaved)?(t.next=t,_a(r)):(t.next=o.next,o.next=t),r.interleaved=t,Ta(e,n)}function La(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,xt(e,n)}}function Ba(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var o=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var i={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?o=a=i:a=a.next=i,n=n.next}while(null!==n);null===a?o=a=t:a=a.next=t}else o=a=t;return n={baseState:r.baseState,firstBaseUpdate:o,lastBaseUpdate:a,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function za(e,t,n,r){var o=e.updateQueue;ja=!1;var a=o.firstBaseUpdate,i=o.lastBaseUpdate,s=o.shared.pending;if(null!==s){o.shared.pending=null;var l=s,c=l.next;l.next=null,null===i?a=c:i.next=c,i=l;var u=e.alternate;null!==u&&((s=(u=u.updateQueue).lastBaseUpdate)!==i&&(null===s?u.firstBaseUpdate=c:s.next=c,u.lastBaseUpdate=l))}if(null!==a){var d=o.baseState;for(i=0,u=c=l=null,s=a;;){var f=s.lane,p=s.eventTime;if((r&f)===f){null!==u&&(u=u.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var g=e,h=s;switch(f=t,p=n,h.tag){case 1:if("function"==typeof(g=h.payload)){d=g.call(p,d,f);break e}d=g;break e;case 3:g.flags=-65537&g.flags|128;case 0:if(null==(f="function"==typeof(g=h.payload)?g.call(p,d,f):g))break e;d=B({},d,f);break e;case 2:ja=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(f=o.effects)?o.effects=[s]:f.push(s))}else p={eventTime:p,lane:f,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===u?(c=u=p,l=d):u=u.next=p,i|=f;if(null===(s=s.next)){if(null===(s=o.shared.pending))break;s=(f=s).next,f.next=null,o.lastBaseUpdate=f,o.shared.pending=null}}if(null===u&&(l=d),o.baseState=l,o.firstBaseUpdate=c,o.lastBaseUpdate=u,null!==(t=o.shared.interleaved)){o=t;do{i|=o.lane,o=o.next}while(o!==t)}else null===a&&(o.shared.lanes=0);Bl|=i,e.lanes=i,e.memoizedState=d}}function Da(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],o=r.callback;if(null!==o){if(r.callback=null,r=n,"function"!=typeof o)throw Error(a(191,o));o.call(r)}}}var Ma=(new r.Component).refs;function Ua(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:B({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var $a={isMounted:function(e){return!!(e=e._reactInternals)&&$e(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=tc(),o=nc(e),a=Ra(r,o);a.payload=t,null!=n&&(a.callback=n),null!==(t=Na(e,a,o))&&(rc(t,e,o,r),La(t,e,o))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=tc(),o=nc(e),a=Ra(r,o);a.tag=1,a.payload=t,null!=n&&(a.callback=n),null!==(t=Na(e,a,o))&&(rc(t,e,o,r),La(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tc(),r=nc(e),o=Ra(n,r);o.tag=2,null!=t&&(o.callback=t),null!==(t=Na(e,o,r))&&(rc(t,e,r,n),La(t,e,r))}};function Wa(e,t,n,r,o,a,i){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,i):!t.prototype||!t.prototype.isPureReactComponent||(!lr(n,r)||!lr(o,a))}function Va(e,t,n){var r=!1,o=_o,a=t.contextType;return"object"==typeof a&&null!==a?a=Ia(a):(o=Po(t)?jo:Fo.current,a=(r=null!=(r=t.contextTypes))?Oo(e,o):_o),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=$a,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=a),t}function qa(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&$a.enqueueReplaceState(t,t.state,null)}function Ga(e,t,n,r){var o=e.stateNode;o.props=n,o.state=e.memoizedState,o.refs=Ma,Oa(e);var a=t.contextType;"object"==typeof a&&null!==a?o.context=Ia(a):(a=Po(t)?jo:Fo.current,o.context=Oo(e,a)),o.state=e.memoizedState,"function"==typeof(a=t.getDerivedStateFromProps)&&(Ua(e,t,a,n),o.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof o.getSnapshotBeforeUpdate||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||(t=o.state,"function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount(),t!==o.state&&$a.enqueueReplaceState(o,o.state,null),za(e,n,o,r),o.state=e.memoizedState),"function"==typeof o.componentDidMount&&(e.flags|=4194308)}function Ha(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var r=n.stateNode}if(!r)throw Error(a(147,e));var o=r,i=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===i?t.ref:(t=function(e){var t=o.refs;t===Ma&&(t=o.refs={}),null===e?delete t[i]:t[i]=e},t._stringRef=i,t)}if("string"!=typeof e)throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function Ka(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Ya(e){return(0,e._init)(e._payload)}function Qa(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function o(e,t){return(e=Rc(e,t)).index=0,e.sibling=null,e}function i(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=zc(n,e.mode,r)).return=e,t):((t=o(t,n)).return=e,t)}function c(e,t,n,r){var a=n.type;return a===C?d(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===a||"object"==typeof a&&null!==a&&a.$$typeof===O&&Ya(a)===t.type)?((r=o(t,n.props)).ref=Ha(e,t,n),r.return=e,r):((r=Nc(n.type,n.key,n.props,null,e.mode,r)).ref=Ha(e,t,n),r.return=e,r)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Dc(n,e.mode,r)).return=e,t):((t=o(t,n.children||[])).return=e,t)}function d(e,t,n,r,a){return null===t||7!==t.tag?((t=Lc(n,e.mode,r,a)).return=e,t):((t=o(t,n)).return=e,t)}function f(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t)return(t=zc(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case w:return(n=Nc(t.type,t.key,t.props,null,e.mode,n)).ref=Ha(e,null,t),n.return=e,n;case S:return(t=Dc(t,e.mode,n)).return=e,t;case O:return f(e,(0,t._init)(t._payload),n)}if(te(t)||N(t))return(t=Lc(t,e.mode,n,null)).return=e,t;Ka(e,t)}return null}function p(e,t,n,r){var o=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n)return null!==o?null:l(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case w:return n.key===o?c(e,t,n,r):null;case S:return n.key===o?u(e,t,n,r):null;case O:return p(e,t,(o=n._init)(n._payload),r)}if(te(n)||N(n))return null!==o?null:d(e,t,n,r,null);Ka(e,n)}return null}function g(e,t,n,r,o){if("string"==typeof r&&""!==r||"number"==typeof r)return l(t,e=e.get(n)||null,""+r,o);if("object"==typeof r&&null!==r){switch(r.$$typeof){case w:return c(t,e=e.get(null===r.key?n:r.key)||null,r,o);case S:return u(t,e=e.get(null===r.key?n:r.key)||null,r,o);case O:return g(e,t,n,(0,r._init)(r._payload),o)}if(te(r)||N(r))return d(t,e=e.get(n)||null,r,o,null);Ka(t,r)}return null}function h(o,a,s,l){for(var c=null,u=null,d=a,h=a=0,m=null;null!==d&&h<s.length;h++){d.index>h?(m=d,d=null):m=d.sibling;var y=p(o,d,s[h],l);if(null===y){null===d&&(d=m);break}e&&d&&null===y.alternate&&t(o,d),a=i(y,a,h),null===u?c=y:u.sibling=y,u=y,d=m}if(h===s.length)return n(o,d),aa&&Zo(o,h),c;if(null===d){for(;h<s.length;h++)null!==(d=f(o,s[h],l))&&(a=i(d,a,h),null===u?c=d:u.sibling=d,u=d);return aa&&Zo(o,h),c}for(d=r(o,d);h<s.length;h++)null!==(m=g(d,o,h,s[h],l))&&(e&&null!==m.alternate&&d.delete(null===m.key?h:m.key),a=i(m,a,h),null===u?c=m:u.sibling=m,u=m);return e&&d.forEach((function(e){return t(o,e)})),aa&&Zo(o,h),c}function m(o,s,l,c){var u=N(l);if("function"!=typeof u)throw Error(a(150));if(null==(l=u.call(l)))throw Error(a(151));for(var d=u=null,h=s,m=s=0,y=null,x=l.next();null!==h&&!x.done;m++,x=l.next()){h.index>m?(y=h,h=null):y=h.sibling;var v=p(o,h,x.value,c);if(null===v){null===h&&(h=y);break}e&&h&&null===v.alternate&&t(o,h),s=i(v,s,m),null===d?u=v:d.sibling=v,d=v,h=y}if(x.done)return n(o,h),aa&&Zo(o,m),u;if(null===h){for(;!x.done;m++,x=l.next())null!==(x=f(o,x.value,c))&&(s=i(x,s,m),null===d?u=x:d.sibling=x,d=x);return aa&&Zo(o,m),u}for(h=r(o,h);!x.done;m++,x=l.next())null!==(x=g(h,o,m,x.value,c))&&(e&&null!==x.alternate&&h.delete(null===x.key?m:x.key),s=i(x,s,m),null===d?u=x:d.sibling=x,d=x);return e&&h.forEach((function(e){return t(o,e)})),aa&&Zo(o,m),u}return function e(r,a,i,l){if("object"==typeof i&&null!==i&&i.type===C&&null===i.key&&(i=i.props.children),"object"==typeof i&&null!==i){switch(i.$$typeof){case w:e:{for(var c=i.key,u=a;null!==u;){if(u.key===c){if((c=i.type)===C){if(7===u.tag){n(r,u.sibling),(a=o(u,i.props.children)).return=r,r=a;break e}}else if(u.elementType===c||"object"==typeof c&&null!==c&&c.$$typeof===O&&Ya(c)===u.type){n(r,u.sibling),(a=o(u,i.props)).ref=Ha(r,u,i),a.return=r,r=a;break e}n(r,u);break}t(r,u),u=u.sibling}i.type===C?((a=Lc(i.props.children,r.mode,l,i.key)).return=r,r=a):((l=Nc(i.type,i.key,i.props,null,r.mode,l)).ref=Ha(r,a,i),l.return=r,r=l)}return s(r);case S:e:{for(u=i.key;null!==a;){if(a.key===u){if(4===a.tag&&a.stateNode.containerInfo===i.containerInfo&&a.stateNode.implementation===i.implementation){n(r,a.sibling),(a=o(a,i.children||[])).return=r,r=a;break e}n(r,a);break}t(r,a),a=a.sibling}(a=Dc(i,r.mode,l)).return=r,r=a}return s(r);case O:return e(r,a,(u=i._init)(i._payload),l)}if(te(i))return h(r,a,i,l);if(N(i))return m(r,a,i,l);Ka(r,i)}return"string"==typeof i&&""!==i||"number"==typeof i?(i=""+i,null!==a&&6===a.tag?(n(r,a.sibling),(a=o(a,i)).return=r,r=a):(n(r,a),(a=zc(i,r.mode,l)).return=r,r=a),s(r)):n(r,a)}}var Ja=Qa(!0),Xa=Qa(!1),Za={},ei=ko(Za),ti=ko(Za),ni=ko(Za);function ri(e){if(e===Za)throw Error(a(174));return e}function oi(e,t){switch(Ao(ni,t),Ao(ti,e),Ao(ei,Za),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Io(ei),Ao(ei,t)}function ai(){Io(ei),Io(ti),Io(ni)}function ii(e){ri(ni.current);var t=ri(ei.current),n=le(t,e.type);t!==n&&(Ao(ti,e),Ao(ei,n))}function si(e){ti.current===e&&(Io(ei),Io(ti))}var li=ko(0);function ci(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(128&t.flags)return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ui=[];function di(){for(var e=0;e<ui.length;e++)ui[e]._workInProgressVersionPrimary=null;ui.length=0}var fi=b.ReactCurrentDispatcher,pi=b.ReactCurrentBatchConfig,gi=0,hi=null,mi=null,yi=null,xi=!1,vi=!1,bi=0,wi=0;function Si(){throw Error(a(321))}function Ci(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!sr(e[n],t[n]))return!1;return!0}function Ei(e,t,n,r,o,i){if(gi=i,hi=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,fi.current=null===e||null===e.memoizedState?ss:ls,e=n(r,o),vi){i=0;do{if(vi=!1,bi=0,25<=i)throw Error(a(301));i+=1,yi=mi=null,t.updateQueue=null,fi.current=cs,e=n(r,o)}while(vi)}if(fi.current=is,t=null!==mi&&null!==mi.next,gi=0,yi=mi=hi=null,xi=!1,t)throw Error(a(300));return e}function ki(){var e=0!==bi;return bi=0,e}function Ii(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===yi?hi.memoizedState=yi=e:yi=yi.next=e,yi}function Ai(){if(null===mi){var e=hi.alternate;e=null!==e?e.memoizedState:null}else e=mi.next;var t=null===yi?hi.memoizedState:yi.next;if(null!==t)yi=t,mi=e;else{if(null===e)throw Error(a(310));e={memoizedState:(mi=e).memoizedState,baseState:mi.baseState,baseQueue:mi.baseQueue,queue:mi.queue,next:null},null===yi?hi.memoizedState=yi=e:yi=yi.next=e}return yi}function _i(e,t){return"function"==typeof t?t(e):t}function Fi(e){var t=Ai(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=mi,o=r.baseQueue,i=n.pending;if(null!==i){if(null!==o){var s=o.next;o.next=i.next,i.next=s}r.baseQueue=o=i,n.pending=null}if(null!==o){i=o.next,r=r.baseState;var l=s=null,c=null,u=i;do{var d=u.lane;if((gi&d)===d)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var f={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=f,s=r):c=c.next=f,hi.lanes|=d,Bl|=d}u=u.next}while(null!==u&&u!==i);null===c?s=r:c.next=l,sr(r,t.memoizedState)||(bs=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){o=e;do{i=o.lane,hi.lanes|=i,Bl|=i,o=o.next}while(o!==e)}else null===o&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Ti(e){var t=Ai(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=n.dispatch,o=n.pending,i=t.memoizedState;if(null!==o){n.pending=null;var s=o=o.next;do{i=e(i,s.action),s=s.next}while(s!==o);sr(i,t.memoizedState)||(bs=!0),t.memoizedState=i,null===t.baseQueue&&(t.baseState=i),n.lastRenderedState=i}return[i,r]}function ji(){}function Oi(e,t){var n=hi,r=Ai(),o=t(),i=!sr(r.memoizedState,o);if(i&&(r.memoizedState=o,bs=!0),r=r.queue,Vi(Ni.bind(null,n,r,e),[e]),r.getSnapshot!==t||i||null!==yi&&1&yi.memoizedState.tag){if(n.flags|=2048,Di(9,Ri.bind(null,n,r,o,t),void 0,null),null===Tl)throw Error(a(349));30&gi||Pi(n,t,o)}return o}function Pi(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=hi.updateQueue)?(t={lastEffect:null,stores:null},hi.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Ri(e,t,n,r){t.value=n,t.getSnapshot=r,Li(t)&&Bi(e)}function Ni(e,t,n){return n((function(){Li(t)&&Bi(e)}))}function Li(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!sr(e,n)}catch(e){return!0}}function Bi(e){var t=Ta(e,1);null!==t&&rc(t,e,1,-1)}function zi(e){var t=Ii();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:_i,lastRenderedState:e},t.queue=e,e=e.dispatch=ns.bind(null,hi,e),[t.memoizedState,e]}function Di(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=hi.updateQueue)?(t={lastEffect:null,stores:null},hi.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Mi(){return Ai().memoizedState}function Ui(e,t,n,r){var o=Ii();hi.flags|=e,o.memoizedState=Di(1|t,n,void 0,void 0===r?null:r)}function $i(e,t,n,r){var o=Ai();r=void 0===r?null:r;var a=void 0;if(null!==mi){var i=mi.memoizedState;if(a=i.destroy,null!==r&&Ci(r,i.deps))return void(o.memoizedState=Di(t,n,a,r))}hi.flags|=e,o.memoizedState=Di(1|t,n,a,r)}function Wi(e,t){return Ui(8390656,8,e,t)}function Vi(e,t){return $i(2048,8,e,t)}function qi(e,t){return $i(4,2,e,t)}function Gi(e,t){return $i(4,4,e,t)}function Hi(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ki(e,t,n){return n=null!=n?n.concat([e]):null,$i(4,4,Hi.bind(null,t,e),n)}function Yi(){}function Qi(e,t){var n=Ai();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Ci(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Ji(e,t){var n=Ai();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Ci(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Xi(e,t,n){return 21&gi?(sr(n,t)||(n=ht(),hi.lanes|=n,Bl|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,bs=!0),e.memoizedState=n)}function Zi(e,t){var n=vt;vt=0!==n&&4>n?n:4,e(!0);var r=pi.transition;pi.transition={};try{e(!1),t()}finally{vt=n,pi.transition=r}}function es(){return Ai().memoizedState}function ts(e,t,n){var r=nc(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},rs(e))os(t,n);else if(null!==(n=Fa(e,t,n,r))){rc(n,e,r,tc()),as(n,t,r)}}function ns(e,t,n){var r=nc(e),o={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(rs(e))os(t,o);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var i=t.lastRenderedState,s=a(i,n);if(o.hasEagerState=!0,o.eagerState=s,sr(s,i)){var l=t.interleaved;return null===l?(o.next=o,_a(t)):(o.next=l.next,l.next=o),void(t.interleaved=o)}}catch(e){}null!==(n=Fa(e,t,o,r))&&(rc(n,e,r,o=tc()),as(n,t,r))}}function rs(e){var t=e.alternate;return e===hi||null!==t&&t===hi}function os(e,t){vi=xi=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function as(e,t,n){if(4194240&n){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,xt(e,n)}}var is={readContext:Ia,useCallback:Si,useContext:Si,useEffect:Si,useImperativeHandle:Si,useInsertionEffect:Si,useLayoutEffect:Si,useMemo:Si,useReducer:Si,useRef:Si,useState:Si,useDebugValue:Si,useDeferredValue:Si,useTransition:Si,useMutableSource:Si,useSyncExternalStore:Si,useId:Si,unstable_isNewReconciler:!1},ss={readContext:Ia,useCallback:function(e,t){return Ii().memoizedState=[e,void 0===t?null:t],e},useContext:Ia,useEffect:Wi,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,Ui(4194308,4,Hi.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Ui(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ui(4,2,e,t)},useMemo:function(e,t){var n=Ii();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Ii();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=ts.bind(null,hi,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Ii().memoizedState=e},useState:zi,useDebugValue:Yi,useDeferredValue:function(e){return Ii().memoizedState=e},useTransition:function(){var e=zi(!1),t=e[0];return e=Zi.bind(null,e[1]),Ii().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=hi,o=Ii();if(aa){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===Tl)throw Error(a(349));30&gi||Pi(r,t,n)}o.memoizedState=n;var i={value:n,getSnapshot:t};return o.queue=i,Wi(Ni.bind(null,r,i,e),[e]),r.flags|=2048,Di(9,Ri.bind(null,r,i,n,t),void 0,null),n},useId:function(){var e=Ii(),t=Tl.identifierPrefix;if(aa){var n=Xo;t=":"+t+"R"+(n=(Jo&~(1<<32-it(Jo)-1)).toString(32)+n),0<(n=bi++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=wi++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ls={readContext:Ia,useCallback:Qi,useContext:Ia,useEffect:Vi,useImperativeHandle:Ki,useInsertionEffect:qi,useLayoutEffect:Gi,useMemo:Ji,useReducer:Fi,useRef:Mi,useState:function(){return Fi(_i)},useDebugValue:Yi,useDeferredValue:function(e){return Xi(Ai(),mi.memoizedState,e)},useTransition:function(){return[Fi(_i)[0],Ai().memoizedState]},useMutableSource:ji,useSyncExternalStore:Oi,useId:es,unstable_isNewReconciler:!1},cs={readContext:Ia,useCallback:Qi,useContext:Ia,useEffect:Vi,useImperativeHandle:Ki,useInsertionEffect:qi,useLayoutEffect:Gi,useMemo:Ji,useReducer:Ti,useRef:Mi,useState:function(){return Ti(_i)},useDebugValue:Yi,useDeferredValue:function(e){var t=Ai();return null===mi?t.memoizedState=e:Xi(t,mi.memoizedState,e)},useTransition:function(){return[Ti(_i)[0],Ai().memoizedState]},useMutableSource:ji,useSyncExternalStore:Oi,useId:es,unstable_isNewReconciler:!1};function us(e,t){try{var n="",r=t;do{n+=U(r),r=r.return}while(r);var o=n}catch(e){o="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:t,stack:o,digest:null}}function ds(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function fs(e,t){try{console.error(t.value)}catch(e){setTimeout((function(){throw e}))}}var ps="function"==typeof WeakMap?WeakMap:Map;function gs(e,t,n){(n=Ra(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){ql||(ql=!0,Gl=r),fs(0,t)},n}function hs(e,t,n){(n=Ra(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"==typeof r){var o=t.value;n.payload=function(){return r(o)},n.callback=function(){fs(0,t)}}var a=e.stateNode;return null!==a&&"function"==typeof a.componentDidCatch&&(n.callback=function(){fs(0,t),"function"!=typeof r&&(null===Hl?Hl=new Set([this]):Hl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ms(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new ps;var o=new Set;r.set(t,o)}else void 0===(o=r.get(t))&&(o=new Set,r.set(t,o));o.has(n)||(o.add(n),e=Ic.bind(null,e,t,n),t.then(e,e))}function ys(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function xs(e,t,n,r,o){return 1&e.mode?(e.flags|=65536,e.lanes=o,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Ra(-1,1)).tag=2,Na(n,t,1))),n.lanes|=1),e)}var vs=b.ReactCurrentOwner,bs=!1;function ws(e,t,n,r){t.child=null===e?Xa(t,null,n,r):Ja(t,e.child,n,r)}function Ss(e,t,n,r,o){n=n.render;var a=t.ref;return ka(t,o),r=Ei(e,t,n,r,a,o),n=ki(),null===e||bs?(aa&&n&&ta(t),t.flags|=1,ws(e,t,r,o),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,qs(e,t,o))}function Cs(e,t,n,r,o){if(null===e){var a=n.type;return"function"!=typeof a||Pc(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Nc(n.type,null,r,t,t.mode,o)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,Es(e,t,a,r,o))}if(a=e.child,!(e.lanes&o)){var i=a.memoizedProps;if((n=null!==(n=n.compare)?n:lr)(i,r)&&e.ref===t.ref)return qs(e,t,o)}return t.flags|=1,(e=Rc(a,r)).ref=t.ref,e.return=t,t.child=e}function Es(e,t,n,r,o){if(null!==e){var a=e.memoizedProps;if(lr(a,r)&&e.ref===t.ref){if(bs=!1,t.pendingProps=r=a,!(e.lanes&o))return t.lanes=e.lanes,qs(e,t,o);131072&e.flags&&(bs=!0)}}return As(e,t,n,r,o)}function ks(e,t,n){var r=t.pendingProps,o=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(1&t.mode){if(!(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ao(Rl,Pl),Pl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==a?a.baseLanes:n,Ao(Rl,Pl),Pl|=r}else t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ao(Rl,Pl),Pl|=n;else null!==a?(r=a.baseLanes|n,t.memoizedState=null):r=n,Ao(Rl,Pl),Pl|=r;return ws(e,t,o,n),t.child}function Is(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function As(e,t,n,r,o){var a=Po(n)?jo:Fo.current;return a=Oo(t,a),ka(t,o),n=Ei(e,t,n,r,a,o),r=ki(),null===e||bs?(aa&&r&&ta(t),t.flags|=1,ws(e,t,n,o),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,qs(e,t,o))}function _s(e,t,n,r,o){if(Po(n)){var a=!0;Bo(t)}else a=!1;if(ka(t,o),null===t.stateNode)Vs(e,t),Va(t,n,r),Ga(t,n,r,o),r=!0;else if(null===e){var i=t.stateNode,s=t.memoizedProps;i.props=s;var l=i.context,c=n.contextType;"object"==typeof c&&null!==c?c=Ia(c):c=Oo(t,c=Po(n)?jo:Fo.current);var u=n.getDerivedStateFromProps,d="function"==typeof u||"function"==typeof i.getSnapshotBeforeUpdate;d||"function"!=typeof i.UNSAFE_componentWillReceiveProps&&"function"!=typeof i.componentWillReceiveProps||(s!==r||l!==c)&&qa(t,i,r,c),ja=!1;var f=t.memoizedState;i.state=f,za(t,r,i,o),l=t.memoizedState,s!==r||f!==l||To.current||ja?("function"==typeof u&&(Ua(t,n,u,r),l=t.memoizedState),(s=ja||Wa(t,n,s,r,f,l,c))?(d||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||("function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount()),"function"==typeof i.componentDidMount&&(t.flags|=4194308)):("function"==typeof i.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),i.props=r,i.state=l,i.context=c,r=s):("function"==typeof i.componentDidMount&&(t.flags|=4194308),r=!1)}else{i=t.stateNode,Pa(e,t),s=t.memoizedProps,c=t.type===t.elementType?s:ya(t.type,s),i.props=c,d=t.pendingProps,f=i.context,"object"==typeof(l=n.contextType)&&null!==l?l=Ia(l):l=Oo(t,l=Po(n)?jo:Fo.current);var p=n.getDerivedStateFromProps;(u="function"==typeof p||"function"==typeof i.getSnapshotBeforeUpdate)||"function"!=typeof i.UNSAFE_componentWillReceiveProps&&"function"!=typeof i.componentWillReceiveProps||(s!==d||f!==l)&&qa(t,i,r,l),ja=!1,f=t.memoizedState,i.state=f,za(t,r,i,o);var g=t.memoizedState;s!==d||f!==g||To.current||ja?("function"==typeof p&&(Ua(t,n,p,r),g=t.memoizedState),(c=ja||Wa(t,n,c,r,f,g,l)||!1)?(u||"function"!=typeof i.UNSAFE_componentWillUpdate&&"function"!=typeof i.componentWillUpdate||("function"==typeof i.componentWillUpdate&&i.componentWillUpdate(r,g,l),"function"==typeof i.UNSAFE_componentWillUpdate&&i.UNSAFE_componentWillUpdate(r,g,l)),"function"==typeof i.componentDidUpdate&&(t.flags|=4),"function"==typeof i.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof i.componentDidUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!=typeof i.getSnapshotBeforeUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=g),i.props=r,i.state=g,i.context=l,r=c):("function"!=typeof i.componentDidUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!=typeof i.getSnapshotBeforeUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),r=!1)}return Fs(e,t,n,r,a,o)}function Fs(e,t,n,r,o,a){Is(e,t);var i=!!(128&t.flags);if(!r&&!i)return o&&zo(t,n,!1),qs(e,t,a);r=t.stateNode,vs.current=t;var s=i&&"function"!=typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&i?(t.child=Ja(t,e.child,null,a),t.child=Ja(t,null,s,a)):ws(e,t,s,a),t.memoizedState=r.state,o&&zo(t,n,!0),t.child}function Ts(e){var t=e.stateNode;t.pendingContext?No(0,t.pendingContext,t.pendingContext!==t.context):t.context&&No(0,t.context,!1),oi(e,t.containerInfo)}function js(e,t,n,r,o){return ga(),ha(o),t.flags|=256,ws(e,t,n,r),t.child}var Os,Ps,Rs,Ns,Ls={dehydrated:null,treeContext:null,retryLane:0};function Bs(e){return{baseLanes:e,cachePool:null,transitions:null}}function zs(e,t,n){var r,o=t.pendingProps,i=li.current,s=!1,l=!!(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&!!(2&i)),r?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(i|=1),Ao(li,1&i),null===e)return ua(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(1&t.mode?"$!"===e.data?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(l=o.children,e=o.fallback,s?(o=t.mode,s=t.child,l={mode:"hidden",children:l},1&o||null===s?s=Bc(l,o,0,null):(s.childLanes=0,s.pendingProps=l),e=Lc(e,o,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Bs(n),t.memoizedState=Ls,e):Ds(t,l));if(null!==(i=e.memoizedState)&&null!==(r=i.dehydrated))return function(e,t,n,r,o,i,s){if(n)return 256&t.flags?(t.flags&=-257,Ms(e,t,s,r=ds(Error(a(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(i=r.fallback,o=t.mode,r=Bc({mode:"visible",children:r.children},o,0,null),(i=Lc(i,o,s,null)).flags|=2,r.return=t,i.return=t,r.sibling=i,t.child=r,1&t.mode&&Ja(t,e.child,null,s),t.child.memoizedState=Bs(s),t.memoizedState=Ls,i);if(!(1&t.mode))return Ms(e,t,s,null);if("$!"===o.data){if(r=o.nextSibling&&o.nextSibling.dataset)var l=r.dgst;return r=l,Ms(e,t,s,r=ds(i=Error(a(419)),r,void 0))}if(l=!!(s&e.childLanes),bs||l){if(null!==(r=Tl)){switch(s&-s){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}0!==(o=o&(r.suspendedLanes|s)?0:o)&&o!==i.retryLane&&(i.retryLane=o,Ta(e,o),rc(r,e,o,-1))}return mc(),Ms(e,t,s,r=ds(Error(a(421))))}return"$?"===o.data?(t.flags|=128,t.child=e.child,t=_c.bind(null,e),o._reactRetry=t,null):(e=i.treeContext,oa=co(o.nextSibling),ra=t,aa=!0,ia=null,null!==e&&(Ko[Yo++]=Jo,Ko[Yo++]=Xo,Ko[Yo++]=Qo,Jo=e.id,Xo=e.overflow,Qo=t),t=Ds(t,r.children),t.flags|=4096,t)}(e,t,l,o,r,i,n);if(s){s=o.fallback,l=t.mode,r=(i=e.child).sibling;var c={mode:"hidden",children:o.children};return 1&l||t.child===i?(o=Rc(i,c)).subtreeFlags=14680064&i.subtreeFlags:((o=t.child).childLanes=0,o.pendingProps=c,t.deletions=null),null!==r?s=Rc(r,s):(s=Lc(s,l,n,null)).flags|=2,s.return=t,o.return=t,o.sibling=s,t.child=o,o=s,s=t.child,l=null===(l=e.child.memoizedState)?Bs(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},s.memoizedState=l,s.childLanes=e.childLanes&~n,t.memoizedState=Ls,o}return e=(s=e.child).sibling,o=Rc(s,{mode:"visible",children:o.children}),!(1&t.mode)&&(o.lanes=n),o.return=t,o.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=o,t.memoizedState=null,o}function Ds(e,t){return(t=Bc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Ms(e,t,n,r){return null!==r&&ha(r),Ja(t,e.child,null,n),(e=Ds(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Us(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Ea(e.return,t,n)}function $s(e,t,n,r,o){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:o}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=o)}function Ws(e,t,n){var r=t.pendingProps,o=r.revealOrder,a=r.tail;if(ws(e,t,r.children,n),2&(r=li.current))r=1&r|2,t.flags|=128;else{if(null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Us(e,n,t);else if(19===e.tag)Us(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ao(li,r),1&t.mode)switch(o){case"forwards":for(n=t.child,o=null;null!==n;)null!==(e=n.alternate)&&null===ci(e)&&(o=n),n=n.sibling;null===(n=o)?(o=t.child,t.child=null):(o=n.sibling,n.sibling=null),$s(t,!1,o,n,a);break;case"backwards":for(n=null,o=t.child,t.child=null;null!==o;){if(null!==(e=o.alternate)&&null===ci(e)){t.child=o;break}e=o.sibling,o.sibling=n,n=o,o=e}$s(t,!0,n,null,a);break;case"together":$s(t,!1,null,null,void 0);break;default:t.memoizedState=null}else t.memoizedState=null;return t.child}function Vs(e,t){!(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function qs(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Bl|=t.lanes,!(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Rc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Rc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Gs(e,t){if(!aa)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Hs(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var o=e.child;null!==o;)n|=o.lanes|o.childLanes,r|=14680064&o.subtreeFlags,r|=14680064&o.flags,o.return=e,o=o.sibling;else for(o=e.child;null!==o;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags,r|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Ks(e,t,n){var r=t.pendingProps;switch(na(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Hs(t),null;case 1:case 17:return Po(t.type)&&Ro(),Hs(t),null;case 3:return r=t.stateNode,ai(),Io(To),Io(Fo),di(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(fa(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,null!==ia&&(sc(ia),ia=null))),Ps(e,t),Hs(t),null;case 5:si(t);var o=ri(ni.current);if(n=t.type,null!==e&&null!=t.stateNode)Rs(e,t,n,r,o),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(a(166));return Hs(t),null}if(e=ri(ei.current),fa(t)){r=t.stateNode,n=t.type;var i=t.memoizedProps;switch(r[po]=t,r[go]=i,e=!!(1&t.mode),n){case"dialog":Dr("cancel",r),Dr("close",r);break;case"iframe":case"object":case"embed":Dr("load",r);break;case"video":case"audio":for(o=0;o<Nr.length;o++)Dr(Nr[o],r);break;case"source":Dr("error",r);break;case"img":case"image":case"link":Dr("error",r),Dr("load",r);break;case"details":Dr("toggle",r);break;case"input":Q(r,i),Dr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Dr("invalid",r);break;case"textarea":oe(r,i),Dr("invalid",r)}for(var l in xe(n,i),o=null,i)if(i.hasOwnProperty(l)){var c=i[l];"children"===l?"string"==typeof c?r.textContent!==c&&(!0!==i.suppressHydrationWarning&&Xr(r.textContent,c,e),o=["children",c]):"number"==typeof c&&r.textContent!==""+c&&(!0!==i.suppressHydrationWarning&&Xr(r.textContent,c,e),o=["children",""+c]):s.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Dr("scroll",r)}switch(n){case"input":G(r),Z(r,i,!0);break;case"textarea":G(r),ie(r);break;case"select":case"option":break;default:"function"==typeof i.onClick&&(r.onclick=Zr)}r=o,t.updateQueue=r,null!==r&&(t.flags|=4)}else{l=9===o.nodeType?o:o.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof r.is?e=l.createElement(n,{is:r.is}):(e=l.createElement(n),"select"===n&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,n),e[po]=t,e[go]=r,Os(e,t,!1,!1),t.stateNode=e;e:{switch(l=ve(n,r),n){case"dialog":Dr("cancel",e),Dr("close",e),o=r;break;case"iframe":case"object":case"embed":Dr("load",e),o=r;break;case"video":case"audio":for(o=0;o<Nr.length;o++)Dr(Nr[o],e);o=r;break;case"source":Dr("error",e),o=r;break;case"img":case"image":case"link":Dr("error",e),Dr("load",e),o=r;break;case"details":Dr("toggle",e),o=r;break;case"input":Q(e,r),o=Y(e,r),Dr("invalid",e);break;case"option":default:o=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},o=B({},r,{value:void 0}),Dr("invalid",e);break;case"textarea":oe(e,r),o=re(e,r),Dr("invalid",e)}for(i in xe(n,o),c=o)if(c.hasOwnProperty(i)){var u=c[i];"style"===i?me(e,u):"dangerouslySetInnerHTML"===i?null!=(u=u?u.__html:void 0)&&de(e,u):"children"===i?"string"==typeof u?("textarea"!==n||""!==u)&&fe(e,u):"number"==typeof u&&fe(e,""+u):"suppressContentEditableWarning"!==i&&"suppressHydrationWarning"!==i&&"autoFocus"!==i&&(s.hasOwnProperty(i)?null!=u&&"onScroll"===i&&Dr("scroll",e):null!=u&&v(e,i,u,l))}switch(n){case"input":G(e),Z(e,r,!1);break;case"textarea":G(e),ie(e);break;case"option":null!=r.value&&e.setAttribute("value",""+V(r.value));break;case"select":e.multiple=!!r.multiple,null!=(i=r.value)?ne(e,!!r.multiple,i,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"==typeof o.onClick&&(e.onclick=Zr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Hs(t),null;case 6:if(e&&null!=t.stateNode)Ns(e,t,e.memoizedProps,r);else{if("string"!=typeof r&&null===t.stateNode)throw Error(a(166));if(n=ri(ni.current),ri(ei.current),fa(t)){if(r=t.stateNode,n=t.memoizedProps,r[po]=t,(i=r.nodeValue!==n)&&null!==(e=ra))switch(e.tag){case 3:Xr(r.nodeValue,n,!!(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Xr(r.nodeValue,n,!!(1&e.mode))}i&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[po]=t,t.stateNode=r}return Hs(t),null;case 13:if(Io(li),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(aa&&null!==oa&&1&t.mode&&!(128&t.flags))pa(),ga(),t.flags|=98560,i=!1;else if(i=fa(t),null!==r&&null!==r.dehydrated){if(null===e){if(!i)throw Error(a(318));if(!(i=null!==(i=t.memoizedState)?i.dehydrated:null))throw Error(a(317));i[po]=t}else ga(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Hs(t),i=!1}else null!==ia&&(sc(ia),ia=null),i=!0;if(!i)return 65536&t.flags?t:null}return 128&t.flags?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,1&t.mode&&(null===e||1&li.current?0===Nl&&(Nl=3):mc())),null!==t.updateQueue&&(t.flags|=4),Hs(t),null);case 4:return ai(),Ps(e,t),null===e&&$r(t.stateNode.containerInfo),Hs(t),null;case 10:return Ca(t.type._context),Hs(t),null;case 19:if(Io(li),null===(i=t.memoizedState))return Hs(t),null;if(r=!!(128&t.flags),null===(l=i.rendering))if(r)Gs(i,!1);else{if(0!==Nl||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(l=ci(e))){for(t.flags|=128,Gs(i,!1),null!==(r=l.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(i=n).flags&=14680066,null===(l=i.alternate)?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=l.childLanes,i.lanes=l.lanes,i.child=l.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=l.memoizedProps,i.memoizedState=l.memoizedState,i.updateQueue=l.updateQueue,i.type=l.type,e=l.dependencies,i.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ao(li,1&li.current|2),t.child}e=e.sibling}null!==i.tail&&Je()>Wl&&(t.flags|=128,r=!0,Gs(i,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=ci(l))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Gs(i,!0),null===i.tail&&"hidden"===i.tailMode&&!l.alternate&&!aa)return Hs(t),null}else 2*Je()-i.renderingStartTime>Wl&&1073741824!==n&&(t.flags|=128,r=!0,Gs(i,!1),t.lanes=4194304);i.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=i.last)?n.sibling=l:t.child=l,i.last=l)}return null!==i.tail?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=Je(),t.sibling=null,n=li.current,Ao(li,r?1&n|2:1&n),t):(Hs(t),null);case 22:case 23:return fc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&1&t.mode?!!(1073741824&Pl)&&(Hs(t),6&t.subtreeFlags&&(t.flags|=8192)):Hs(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}function Ys(e,t){switch(na(t),t.tag){case 1:return Po(t.type)&&Ro(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return ai(),Io(To),Io(Fo),di(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 5:return si(t),null;case 13:if(Io(li),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));ga()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Io(li),null;case 4:return ai(),null;case 10:return Ca(t.type._context),null;case 22:case 23:return fc(),null;default:return null}}Os=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ps=function(){},Rs=function(e,t,n,r){var o=e.memoizedProps;if(o!==r){e=t.stateNode,ri(ei.current);var a,i=null;switch(n){case"input":o=Y(e,o),r=Y(e,r),i=[];break;case"select":o=B({},o,{value:void 0}),r=B({},r,{value:void 0}),i=[];break;case"textarea":o=re(e,o),r=re(e,r),i=[];break;default:"function"!=typeof o.onClick&&"function"==typeof r.onClick&&(e.onclick=Zr)}for(u in xe(n,r),n=null,o)if(!r.hasOwnProperty(u)&&o.hasOwnProperty(u)&&null!=o[u])if("style"===u){var l=o[u];for(a in l)l.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(s.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var c=r[u];if(l=null!=o?o[u]:void 0,r.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(a in l)!l.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in c)c.hasOwnProperty(a)&&l[a]!==c[a]&&(n||(n={}),n[a]=c[a])}else n||(i||(i=[]),i.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(i=i||[]).push(u,c)):"children"===u?"string"!=typeof c&&"number"!=typeof c||(i=i||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(s.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&Dr("scroll",e),i||l===c||(i=[])):(i=i||[]).push(u,c))}n&&(i=i||[]).push("style",n);var u=i;(t.updateQueue=u)&&(t.flags|=4)}},Ns=function(e,t,n,r){n!==r&&(t.flags|=4)};var Qs=!1,Js=!1,Xs="function"==typeof WeakSet?WeakSet:Set,Zs=null;function el(e,t){var n=e.ref;if(null!==n)if("function"==typeof n)try{n(null)}catch(n){kc(e,t,n)}else n.current=null}function tl(e,t,n){try{n()}catch(n){kc(e,t,n)}}var nl=!1;function rl(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var o=r=r.next;do{if((o.tag&e)===e){var a=o.destroy;o.destroy=void 0,void 0!==a&&tl(t,n,a)}o=o.next}while(o!==r)}}function ol(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function al(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"==typeof t?t(e):t.current=e}}function il(e){var t=e.alternate;null!==t&&(e.alternate=null,il(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[po],delete t[go],delete t[mo],delete t[yo],delete t[xo])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function sl(e){return 5===e.tag||3===e.tag||4===e.tag}function ll(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||sl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function cl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=Zr));else if(4!==r&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}function ul(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(ul(e,t,n),e=e.sibling;null!==e;)ul(e,t,n),e=e.sibling}var dl=null,fl=!1;function pl(e,t,n){for(n=n.child;null!==n;)gl(e,t,n),n=n.sibling}function gl(e,t,n){if(at&&"function"==typeof at.onCommitFiberUnmount)try{at.onCommitFiberUnmount(ot,n)}catch(e){}switch(n.tag){case 5:Js||el(n,t);case 6:var r=dl,o=fl;dl=null,pl(e,t,n),fl=o,null!==(dl=r)&&(fl?(e=dl,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):dl.removeChild(n.stateNode));break;case 18:null!==dl&&(fl?(e=dl,n=n.stateNode,8===e.nodeType?lo(e.parentNode,n):1===e.nodeType&&lo(e,n),$t(e)):lo(dl,n.stateNode));break;case 4:r=dl,o=fl,dl=n.stateNode.containerInfo,fl=!0,pl(e,t,n),dl=r,fl=o;break;case 0:case 11:case 14:case 15:if(!Js&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){o=r=r.next;do{var a=o,i=a.destroy;a=a.tag,void 0!==i&&(2&a||4&a)&&tl(n,t,i),o=o.next}while(o!==r)}pl(e,t,n);break;case 1:if(!Js&&(el(n,t),"function"==typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(e){kc(n,t,e)}pl(e,t,n);break;case 21:pl(e,t,n);break;case 22:1&n.mode?(Js=(r=Js)||null!==n.memoizedState,pl(e,t,n),Js=r):pl(e,t,n);break;default:pl(e,t,n)}}function hl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Xs),t.forEach((function(t){var r=Fc.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function ml(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var o=n[r];try{var i=e,s=t,l=s;e:for(;null!==l;){switch(l.tag){case 5:dl=l.stateNode,fl=!1;break e;case 3:case 4:dl=l.stateNode.containerInfo,fl=!0;break e}l=l.return}if(null===dl)throw Error(a(160));gl(i,s,o),dl=null,fl=!1;var c=o.alternate;null!==c&&(c.return=null),o.return=null}catch(e){kc(o,t,e)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)yl(t,e),t=t.sibling}function yl(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ml(t,e),xl(e),4&r){try{rl(3,e,e.return),ol(3,e)}catch(t){kc(e,e.return,t)}try{rl(5,e,e.return)}catch(t){kc(e,e.return,t)}}break;case 1:ml(t,e),xl(e),512&r&&null!==n&&el(n,n.return);break;case 5:if(ml(t,e),xl(e),512&r&&null!==n&&el(n,n.return),32&e.flags){var o=e.stateNode;try{fe(o,"")}catch(t){kc(e,e.return,t)}}if(4&r&&null!=(o=e.stateNode)){var i=e.memoizedProps,s=null!==n?n.memoizedProps:i,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===i.type&&null!=i.name&&J(o,i),ve(l,s);var u=ve(l,i);for(s=0;s<c.length;s+=2){var d=c[s],f=c[s+1];"style"===d?me(o,f):"dangerouslySetInnerHTML"===d?de(o,f):"children"===d?fe(o,f):v(o,d,f,u)}switch(l){case"input":X(o,i);break;case"textarea":ae(o,i);break;case"select":var p=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!i.multiple;var g=i.value;null!=g?ne(o,!!i.multiple,g,!1):p!==!!i.multiple&&(null!=i.defaultValue?ne(o,!!i.multiple,i.defaultValue,!0):ne(o,!!i.multiple,i.multiple?[]:"",!1))}o[go]=i}catch(t){kc(e,e.return,t)}}break;case 6:if(ml(t,e),xl(e),4&r){if(null===e.stateNode)throw Error(a(162));o=e.stateNode,i=e.memoizedProps;try{o.nodeValue=i}catch(t){kc(e,e.return,t)}}break;case 3:if(ml(t,e),xl(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{$t(t.containerInfo)}catch(t){kc(e,e.return,t)}break;case 4:default:ml(t,e),xl(e);break;case 13:ml(t,e),xl(e),8192&(o=e.child).flags&&(i=null!==o.memoizedState,o.stateNode.isHidden=i,!i||null!==o.alternate&&null!==o.alternate.memoizedState||($l=Je())),4&r&&hl(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?(Js=(u=Js)||d,ml(t,e),Js=u):ml(t,e),xl(e),8192&r){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&1&e.mode)for(Zs=e,d=e.child;null!==d;){for(f=Zs=d;null!==Zs;){switch(g=(p=Zs).child,p.tag){case 0:case 11:case 14:case 15:rl(4,p,p.return);break;case 1:el(p,p.return);var h=p.stateNode;if("function"==typeof h.componentWillUnmount){r=p,n=p.return;try{t=r,h.props=t.memoizedProps,h.state=t.memoizedState,h.componentWillUnmount()}catch(e){kc(r,n,e)}}break;case 5:el(p,p.return);break;case 22:if(null!==p.memoizedState){Sl(f);continue}}null!==g?(g.return=p,Zs=g):Sl(f)}d=d.sibling}e:for(d=null,f=e;;){if(5===f.tag){if(null===d){d=f;try{o=f.stateNode,u?"function"==typeof(i=o.style).setProperty?i.setProperty("display","none","important"):i.display="none":(l=f.stateNode,s=null!=(c=f.memoizedProps.style)&&c.hasOwnProperty("display")?c.display:null,l.style.display=he("display",s))}catch(t){kc(e,e.return,t)}}}else if(6===f.tag){if(null===d)try{f.stateNode.nodeValue=u?"":f.memoizedProps}catch(t){kc(e,e.return,t)}}else if((22!==f.tag&&23!==f.tag||null===f.memoizedState||f===e)&&null!==f.child){f.child.return=f,f=f.child;continue}if(f===e)break e;for(;null===f.sibling;){if(null===f.return||f.return===e)break e;d===f&&(d=null),f=f.return}d===f&&(d=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:ml(t,e),xl(e),4&r&&hl(e);case 21:}}function xl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(sl(n)){var r=n;break e}n=n.return}throw Error(a(160))}switch(r.tag){case 5:var o=r.stateNode;32&r.flags&&(fe(o,""),r.flags&=-33),ul(e,ll(e),o);break;case 3:case 4:var i=r.stateNode.containerInfo;cl(e,ll(e),i);break;default:throw Error(a(161))}}catch(t){kc(e,e.return,t)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function vl(e,t,n){Zs=e,bl(e,t,n)}function bl(e,t,n){for(var r=!!(1&e.mode);null!==Zs;){var o=Zs,a=o.child;if(22===o.tag&&r){var i=null!==o.memoizedState||Qs;if(!i){var s=o.alternate,l=null!==s&&null!==s.memoizedState||Js;s=Qs;var c=Js;if(Qs=i,(Js=l)&&!c)for(Zs=o;null!==Zs;)l=(i=Zs).child,22===i.tag&&null!==i.memoizedState?Cl(o):null!==l?(l.return=i,Zs=l):Cl(o);for(;null!==a;)Zs=a,bl(a,t,n),a=a.sibling;Zs=o,Qs=s,Js=c}wl(e)}else 8772&o.subtreeFlags&&null!==a?(a.return=o,Zs=a):wl(e)}}function wl(e){for(;null!==Zs;){var t=Zs;if(8772&t.flags){var n=t.alternate;try{if(8772&t.flags)switch(t.tag){case 0:case 11:case 15:Js||ol(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Js)if(null===n)r.componentDidMount();else{var o=t.elementType===t.type?n.memoizedProps:ya(t.type,n.memoizedProps);r.componentDidUpdate(o,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;null!==i&&Da(t,i,r);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Da(t,s,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var f=d.dehydrated;null!==f&&$t(f)}}}break;default:throw Error(a(163))}Js||512&t.flags&&al(t)}catch(e){kc(t,t.return,e)}}if(t===e){Zs=null;break}if(null!==(n=t.sibling)){n.return=t.return,Zs=n;break}Zs=t.return}}function Sl(e){for(;null!==Zs;){var t=Zs;if(t===e){Zs=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Zs=n;break}Zs=t.return}}function Cl(e){for(;null!==Zs;){var t=Zs;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{ol(4,t)}catch(e){kc(t,n,e)}break;case 1:var r=t.stateNode;if("function"==typeof r.componentDidMount){var o=t.return;try{r.componentDidMount()}catch(e){kc(t,o,e)}}var a=t.return;try{al(t)}catch(e){kc(t,a,e)}break;case 5:var i=t.return;try{al(t)}catch(e){kc(t,i,e)}}}catch(e){kc(t,t.return,e)}if(t===e){Zs=null;break}var s=t.sibling;if(null!==s){s.return=t.return,Zs=s;break}Zs=t.return}}var El,kl=Math.ceil,Il=b.ReactCurrentDispatcher,Al=b.ReactCurrentOwner,_l=b.ReactCurrentBatchConfig,Fl=0,Tl=null,jl=null,Ol=0,Pl=0,Rl=ko(0),Nl=0,Ll=null,Bl=0,zl=0,Dl=0,Ml=null,Ul=null,$l=0,Wl=1/0,Vl=null,ql=!1,Gl=null,Hl=null,Kl=!1,Yl=null,Ql=0,Jl=0,Xl=null,Zl=-1,ec=0;function tc(){return 6&Fl?Je():-1!==Zl?Zl:Zl=Je()}function nc(e){return 1&e.mode?2&Fl&&0!==Ol?Ol&-Ol:null!==ma.transition?(0===ec&&(ec=ht()),ec):0!==(e=vt)?e:e=void 0===(e=window.event)?16:Qt(e.type):1}function rc(e,t,n,r){if(50<Jl)throw Jl=0,Xl=null,Error(a(185));yt(e,n,r),2&Fl&&e===Tl||(e===Tl&&(!(2&Fl)&&(zl|=n),4===Nl&&lc(e,Ol)),oc(e,r),1===n&&0===Fl&&!(1&t.mode)&&(Wl=Je()+500,Mo&&Wo()))}function oc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,o=e.expirationTimes,a=e.pendingLanes;0<a;){var i=31-it(a),s=1<<i,l=o[i];-1===l?s&n&&!(s&r)||(o[i]=pt(s,t)):l<=t&&(e.expiredLanes|=s),a&=~s}}(e,t);var r=ft(e,e===Tl?Ol:0);if(0===r)null!==n&&Ke(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Ke(n),1===t)0===e.tag?function(e){Mo=!0,$o(e)}(cc.bind(null,e)):$o(cc.bind(null,e)),io((function(){!(6&Fl)&&Wo()})),n=null;else{switch(bt(r)){case 1:n=Ze;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Tc(n,ac.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function ac(e,t){if(Zl=-1,ec=0,6&Fl)throw Error(a(327));var n=e.callbackNode;if(Cc()&&e.callbackNode!==n)return null;var r=ft(e,e===Tl?Ol:0);if(0===r)return null;if(30&r||r&e.expiredLanes||t)t=yc(e,r);else{t=r;var o=Fl;Fl|=2;var i=hc();for(Tl===e&&Ol===t||(Vl=null,Wl=Je()+500,pc(e,t));;)try{vc();break}catch(t){gc(e,t)}Sa(),Il.current=i,Fl=o,null!==jl?t=0:(Tl=null,Ol=0,t=Nl)}if(0!==t){if(2===t&&(0!==(o=gt(e))&&(r=o,t=ic(e,o))),1===t)throw n=Ll,pc(e,0),lc(e,r),oc(e,Je()),n;if(6===t)lc(e,r);else{if(o=e.current.alternate,!(30&r||function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var o=n[r],a=o.getSnapshot;o=o.value;try{if(!sr(a(),o))return!1}catch(e){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(o)||(t=yc(e,r),2===t&&(i=gt(e),0!==i&&(r=i,t=ic(e,i))),1!==t)))throw n=Ll,pc(e,0),lc(e,r),oc(e,Je()),n;switch(e.finishedWork=o,e.finishedLanes=r,t){case 0:case 1:throw Error(a(345));case 2:case 5:Sc(e,Ul,Vl);break;case 3:if(lc(e,r),(130023424&r)===r&&10<(t=$l+500-Je())){if(0!==ft(e,0))break;if(((o=e.suspendedLanes)&r)!==r){tc(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=ro(Sc.bind(null,e,Ul,Vl),t);break}Sc(e,Ul,Vl);break;case 4:if(lc(e,r),(4194240&r)===r)break;for(t=e.eventTimes,o=-1;0<r;){var s=31-it(r);i=1<<s,(s=t[s])>o&&(o=s),r&=~i}if(r=o,10<(r=(120>(r=Je()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*kl(r/1960))-r)){e.timeoutHandle=ro(Sc.bind(null,e,Ul,Vl),r);break}Sc(e,Ul,Vl);break;default:throw Error(a(329))}}}return oc(e,Je()),e.callbackNode===n?ac.bind(null,e):null}function ic(e,t){var n=Ml;return e.current.memoizedState.isDehydrated&&(pc(e,t).flags|=256),2!==(e=yc(e,t))&&(t=Ul,Ul=n,null!==t&&sc(t)),e}function sc(e){null===Ul?Ul=e:Ul.push.apply(Ul,e)}function lc(e,t){for(t&=~Dl,t&=~zl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-it(t),r=1<<n;e[n]=-1,t&=~r}}function cc(e){if(6&Fl)throw Error(a(327));Cc();var t=ft(e,0);if(!(1&t))return oc(e,Je()),null;var n=yc(e,t);if(0!==e.tag&&2===n){var r=gt(e);0!==r&&(t=r,n=ic(e,r))}if(1===n)throw n=Ll,pc(e,0),lc(e,t),oc(e,Je()),n;if(6===n)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Sc(e,Ul,Vl),oc(e,Je()),null}function uc(e,t){var n=Fl;Fl|=1;try{return e(t)}finally{0===(Fl=n)&&(Wl=Je()+500,Mo&&Wo())}}function dc(e){null!==Yl&&0===Yl.tag&&!(6&Fl)&&Cc();var t=Fl;Fl|=1;var n=_l.transition,r=vt;try{if(_l.transition=null,vt=1,e)return e()}finally{vt=r,_l.transition=n,!(6&(Fl=t))&&Wo()}}function fc(){Pl=Rl.current,Io(Rl)}function pc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,oo(n)),null!==jl)for(n=jl.return;null!==n;){var r=n;switch(na(r),r.tag){case 1:null!=(r=r.type.childContextTypes)&&Ro();break;case 3:ai(),Io(To),Io(Fo),di();break;case 5:si(r);break;case 4:ai();break;case 13:case 19:Io(li);break;case 10:Ca(r.type._context);break;case 22:case 23:fc()}n=n.return}if(Tl=e,jl=e=Rc(e.current,null),Ol=Pl=t,Nl=0,Ll=null,Dl=zl=Bl=0,Ul=Ml=null,null!==Aa){for(t=0;t<Aa.length;t++)if(null!==(r=(n=Aa[t]).interleaved)){n.interleaved=null;var o=r.next,a=n.pending;if(null!==a){var i=a.next;a.next=o,r.next=i}n.pending=r}Aa=null}return e}function gc(e,t){for(;;){var n=jl;try{if(Sa(),fi.current=is,xi){for(var r=hi.memoizedState;null!==r;){var o=r.queue;null!==o&&(o.pending=null),r=r.next}xi=!1}if(gi=0,yi=mi=hi=null,vi=!1,bi=0,Al.current=null,null===n||null===n.return){Nl=1,Ll=t,jl=null;break}e:{var i=e,s=n.return,l=n,c=t;if(t=Ol,l.flags|=32768,null!==c&&"object"==typeof c&&"function"==typeof c.then){var u=c,d=l,f=d.tag;if(!(1&d.mode||0!==f&&11!==f&&15!==f)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var g=ys(s);if(null!==g){g.flags&=-257,xs(g,s,l,0,t),1&g.mode&&ms(i,u,t),c=u;var h=(t=g).updateQueue;if(null===h){var m=new Set;m.add(c),t.updateQueue=m}else h.add(c);break e}if(!(1&t)){ms(i,u,t),mc();break e}c=Error(a(426))}else if(aa&&1&l.mode){var y=ys(s);if(null!==y){!(65536&y.flags)&&(y.flags|=256),xs(y,s,l,0,t),ha(us(c,l));break e}}i=c=us(c,l),4!==Nl&&(Nl=2),null===Ml?Ml=[i]:Ml.push(i),i=s;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t,Ba(i,gs(0,c,t));break e;case 1:l=c;var x=i.type,v=i.stateNode;if(!(128&i.flags||"function"!=typeof x.getDerivedStateFromError&&(null===v||"function"!=typeof v.componentDidCatch||null!==Hl&&Hl.has(v)))){i.flags|=65536,t&=-t,i.lanes|=t,Ba(i,hs(i,l,t));break e}}i=i.return}while(null!==i)}wc(n)}catch(e){t=e,jl===n&&null!==n&&(jl=n=n.return);continue}break}}function hc(){var e=Il.current;return Il.current=is,null===e?is:e}function mc(){0!==Nl&&3!==Nl&&2!==Nl||(Nl=4),null===Tl||!(268435455&Bl)&&!(268435455&zl)||lc(Tl,Ol)}function yc(e,t){var n=Fl;Fl|=2;var r=hc();for(Tl===e&&Ol===t||(Vl=null,pc(e,t));;)try{xc();break}catch(t){gc(e,t)}if(Sa(),Fl=n,Il.current=r,null!==jl)throw Error(a(261));return Tl=null,Ol=0,Nl}function xc(){for(;null!==jl;)bc(jl)}function vc(){for(;null!==jl&&!Ye();)bc(jl)}function bc(e){var t=El(e.alternate,e,Pl);e.memoizedProps=e.pendingProps,null===t?wc(e):jl=t,Al.current=null}function wc(e){var t=e;do{var n=t.alternate;if(e=t.return,32768&t.flags){if(null!==(n=Ys(n,t)))return n.flags&=32767,void(jl=n);if(null===e)return Nl=6,void(jl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}else if(null!==(n=Ks(n,t,Pl)))return void(jl=n);if(null!==(t=t.sibling))return void(jl=t);jl=t=e}while(null!==t);0===Nl&&(Nl=5)}function Sc(e,t,n){var r=vt,o=_l.transition;try{_l.transition=null,vt=1,function(e,t,n,r){do{Cc()}while(null!==Yl);if(6&Fl)throw Error(a(327));n=e.finishedWork;var o=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var i=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var o=31-it(n),a=1<<o;t[o]=0,r[o]=-1,e[o]=-1,n&=~a}}(e,i),e===Tl&&(jl=Tl=null,Ol=0),!(2064&n.subtreeFlags)&&!(2064&n.flags)||Kl||(Kl=!0,Tc(tt,(function(){return Cc(),null}))),i=!!(15990&n.flags),!!(15990&n.subtreeFlags)||i){i=_l.transition,_l.transition=null;var s=vt;vt=1;var l=Fl;Fl|=4,Al.current=null,function(e,t){if(eo=Vt,pr(e=fr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var o=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch(e){n=null;break e}var s=0,l=-1,c=-1,u=0,d=0,f=e,p=null;t:for(;;){for(var g;f!==n||0!==o&&3!==f.nodeType||(l=s+o),f!==i||0!==r&&3!==f.nodeType||(c=s+r),3===f.nodeType&&(s+=f.nodeValue.length),null!==(g=f.firstChild);)p=f,f=g;for(;;){if(f===e)break t;if(p===n&&++u===o&&(l=s),p===i&&++d===r&&(c=s),null!==(g=f.nextSibling))break;p=(f=p).parentNode}f=g}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(to={focusedElem:e,selectionRange:n},Vt=!1,Zs=t;null!==Zs;)if(e=(t=Zs).child,1028&t.subtreeFlags&&null!==e)e.return=t,Zs=e;else for(;null!==Zs;){t=Zs;try{var h=t.alternate;if(1024&t.flags)switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==h){var m=h.memoizedProps,y=h.memoizedState,x=t.stateNode,v=x.getSnapshotBeforeUpdate(t.elementType===t.type?m:ya(t.type,m),y);x.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var b=t.stateNode.containerInfo;1===b.nodeType?b.textContent="":9===b.nodeType&&b.documentElement&&b.removeChild(b.documentElement);break;default:throw Error(a(163))}}catch(e){kc(t,t.return,e)}if(null!==(e=t.sibling)){e.return=t.return,Zs=e;break}Zs=t.return}h=nl,nl=!1}(e,n),yl(n,e),gr(to),Vt=!!eo,to=eo=null,e.current=n,vl(n,e,o),Qe(),Fl=l,vt=s,_l.transition=i}else e.current=n;if(Kl&&(Kl=!1,Yl=e,Ql=o),i=e.pendingLanes,0===i&&(Hl=null),function(e){if(at&&"function"==typeof at.onCommitFiberRoot)try{at.onCommitFiberRoot(ot,e,void 0,!(128&~e.current.flags))}catch(e){}}(n.stateNode),oc(e,Je()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)o=t[n],r(o.value,{componentStack:o.stack,digest:o.digest});if(ql)throw ql=!1,e=Gl,Gl=null,e;!!(1&Ql)&&0!==e.tag&&Cc(),i=e.pendingLanes,1&i?e===Xl?Jl++:(Jl=0,Xl=e):Jl=0,Wo()}(e,t,n,r)}finally{_l.transition=o,vt=r}return null}function Cc(){if(null!==Yl){var e=bt(Ql),t=_l.transition,n=vt;try{if(_l.transition=null,vt=16>e?16:e,null===Yl)var r=!1;else{if(e=Yl,Yl=null,Ql=0,6&Fl)throw Error(a(331));var o=Fl;for(Fl|=4,Zs=e.current;null!==Zs;){var i=Zs,s=i.child;if(16&Zs.flags){var l=i.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Zs=u;null!==Zs;){var d=Zs;switch(d.tag){case 0:case 11:case 15:rl(8,d,i)}var f=d.child;if(null!==f)f.return=d,Zs=f;else for(;null!==Zs;){var p=(d=Zs).sibling,g=d.return;if(il(d),d===u){Zs=null;break}if(null!==p){p.return=g,Zs=p;break}Zs=g}}}var h=i.alternate;if(null!==h){var m=h.child;if(null!==m){h.child=null;do{var y=m.sibling;m.sibling=null,m=y}while(null!==m)}}Zs=i}}if(2064&i.subtreeFlags&&null!==s)s.return=i,Zs=s;else e:for(;null!==Zs;){if(2048&(i=Zs).flags)switch(i.tag){case 0:case 11:case 15:rl(9,i,i.return)}var x=i.sibling;if(null!==x){x.return=i.return,Zs=x;break e}Zs=i.return}}var v=e.current;for(Zs=v;null!==Zs;){var b=(s=Zs).child;if(2064&s.subtreeFlags&&null!==b)b.return=s,Zs=b;else e:for(s=v;null!==Zs;){if(2048&(l=Zs).flags)try{switch(l.tag){case 0:case 11:case 15:ol(9,l)}}catch(e){kc(l,l.return,e)}if(l===s){Zs=null;break e}var w=l.sibling;if(null!==w){w.return=l.return,Zs=w;break e}Zs=l.return}}if(Fl=o,Wo(),at&&"function"==typeof at.onPostCommitFiberRoot)try{at.onPostCommitFiberRoot(ot,e)}catch(e){}r=!0}return r}finally{vt=n,_l.transition=t}}return!1}function Ec(e,t,n){e=Na(e,t=gs(0,t=us(n,t),1),1),t=tc(),null!==e&&(yt(e,1,t),oc(e,t))}function kc(e,t,n){if(3===e.tag)Ec(e,e,n);else for(;null!==t;){if(3===t.tag){Ec(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===Hl||!Hl.has(r))){t=Na(t,e=hs(t,e=us(n,e),1),1),e=tc(),null!==t&&(yt(t,1,e),oc(t,e));break}}t=t.return}}function Ic(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=tc(),e.pingedLanes|=e.suspendedLanes&n,Tl===e&&(Ol&n)===n&&(4===Nl||3===Nl&&(130023424&Ol)===Ol&&500>Je()-$l?pc(e,0):Dl|=n),oc(e,t)}function Ac(e,t){0===t&&(1&e.mode?(t=ut,!(130023424&(ut<<=1))&&(ut=4194304)):t=1);var n=tc();null!==(e=Ta(e,t))&&(yt(e,t,n),oc(e,n))}function _c(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Ac(e,n)}function Fc(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,o=e.memoizedState;null!==o&&(n=o.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(a(314))}null!==r&&r.delete(t),Ac(e,n)}function Tc(e,t){return He(e,t)}function jc(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Oc(e,t,n,r){return new jc(e,t,n,r)}function Pc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Rc(e,t){var n=e.alternate;return null===n?((n=Oc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Nc(e,t,n,r,o,i){var s=2;if(r=e,"function"==typeof e)Pc(e)&&(s=1);else if("string"==typeof e)s=5;else e:switch(e){case C:return Lc(n.children,o,i,t);case E:s=8,o|=8;break;case k:return(e=Oc(12,n,t,2|o)).elementType=k,e.lanes=i,e;case F:return(e=Oc(13,n,t,o)).elementType=F,e.lanes=i,e;case T:return(e=Oc(19,n,t,o)).elementType=T,e.lanes=i,e;case P:return Bc(n,o,i,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case I:s=10;break e;case A:s=9;break e;case _:s=11;break e;case j:s=14;break e;case O:s=16,r=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=Oc(s,n,t,o)).elementType=e,t.type=r,t.lanes=i,t}function Lc(e,t,n,r){return(e=Oc(7,e,r,t)).lanes=n,e}function Bc(e,t,n,r){return(e=Oc(22,e,r,t)).elementType=P,e.lanes=n,e.stateNode={isHidden:!1},e}function zc(e,t,n){return(e=Oc(6,e,null,t)).lanes=n,e}function Dc(e,t,n){return(t=Oc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Mc(e,t,n,r,o){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mt(0),this.expirationTimes=mt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mt(0),this.identifierPrefix=r,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function Uc(e,t,n,r,o,a,i,s,l){return e=new Mc(e,t,n,s,l),1===t?(t=1,!0===a&&(t|=8)):t=0,a=Oc(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Oa(a),e}function $c(e){if(!e)return _o;e:{if($e(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Po(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var n=e.type;if(Po(n))return Lo(e,n,t)}return t}function Wc(e,t,n,r,o,a,i,s,l){return(e=Uc(n,r,!0,e,0,a,0,s,l)).context=$c(null),n=e.current,(a=Ra(r=tc(),o=nc(n))).callback=null!=t?t:null,Na(n,a,o),e.current.lanes=o,yt(e,o,r),oc(e,r),e}function Vc(e,t,n,r){var o=t.current,a=tc(),i=nc(o);return n=$c(n),null===t.context?t.context=n:t.pendingContext=n,(t=Ra(a,i)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Na(o,t,i))&&(rc(e,o,i,a),La(e,o,i)),i}function qc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Gc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Hc(e,t){Gc(e,t),(e=e.alternate)&&Gc(e,t)}El=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||To.current)bs=!0;else{if(!(e.lanes&n||128&t.flags))return bs=!1,function(e,t,n){switch(t.tag){case 3:Ts(t),ga();break;case 5:ii(t);break;case 1:Po(t.type)&&Bo(t);break;case 4:oi(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,o=t.memoizedProps.value;Ao(xa,r._currentValue),r._currentValue=o;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ao(li,1&li.current),t.flags|=128,null):n&t.child.childLanes?zs(e,t,n):(Ao(li,1&li.current),null!==(e=qs(e,t,n))?e.sibling:null);Ao(li,1&li.current);break;case 19:if(r=!!(n&t.childLanes),128&e.flags){if(r)return Ws(e,t,n);t.flags|=128}if(null!==(o=t.memoizedState)&&(o.rendering=null,o.tail=null,o.lastEffect=null),Ao(li,li.current),r)break;return null;case 22:case 23:return t.lanes=0,ks(e,t,n)}return qs(e,t,n)}(e,t,n);bs=!!(131072&e.flags)}else bs=!1,aa&&1048576&t.flags&&ea(t,Ho,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Vs(e,t),e=t.pendingProps;var o=Oo(t,Fo.current);ka(t,n),o=Ei(null,t,r,e,o,n);var i=ki();return t.flags|=1,"object"==typeof o&&null!==o&&"function"==typeof o.render&&void 0===o.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Po(r)?(i=!0,Bo(t)):i=!1,t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null,Oa(t),o.updater=$a,t.stateNode=o,o._reactInternals=t,Ga(t,r,e,n),t=Fs(null,t,r,!0,i,n)):(t.tag=0,aa&&i&&ta(t),ws(null,t,o,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Vs(e,t),e=t.pendingProps,r=(o=r._init)(r._payload),t.type=r,o=t.tag=function(e){if("function"==typeof e)return Pc(e)?1:0;if(null!=e){if((e=e.$$typeof)===_)return 11;if(e===j)return 14}return 2}(r),e=ya(r,e),o){case 0:t=As(null,t,r,e,n);break e;case 1:t=_s(null,t,r,e,n);break e;case 11:t=Ss(null,t,r,e,n);break e;case 14:t=Cs(null,t,r,ya(r.type,e),n);break e}throw Error(a(306,r,""))}return t;case 0:return r=t.type,o=t.pendingProps,As(e,t,r,o=t.elementType===r?o:ya(r,o),n);case 1:return r=t.type,o=t.pendingProps,_s(e,t,r,o=t.elementType===r?o:ya(r,o),n);case 3:e:{if(Ts(t),null===e)throw Error(a(387));r=t.pendingProps,o=(i=t.memoizedState).element,Pa(e,t),za(t,r,null,n);var s=t.memoizedState;if(r=s.element,i.isDehydrated){if(i={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=i,t.memoizedState=i,256&t.flags){t=js(e,t,r,n,o=us(Error(a(423)),t));break e}if(r!==o){t=js(e,t,r,n,o=us(Error(a(424)),t));break e}for(oa=co(t.stateNode.containerInfo.firstChild),ra=t,aa=!0,ia=null,n=Xa(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(ga(),r===o){t=qs(e,t,n);break e}ws(e,t,r,n)}t=t.child}return t;case 5:return ii(t),null===e&&ua(t),r=t.type,o=t.pendingProps,i=null!==e?e.memoizedProps:null,s=o.children,no(r,o)?s=null:null!==i&&no(r,i)&&(t.flags|=32),Is(e,t),ws(e,t,s,n),t.child;case 6:return null===e&&ua(t),null;case 13:return zs(e,t,n);case 4:return oi(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Ja(t,null,r,n):ws(e,t,r,n),t.child;case 11:return r=t.type,o=t.pendingProps,Ss(e,t,r,o=t.elementType===r?o:ya(r,o),n);case 7:return ws(e,t,t.pendingProps,n),t.child;case 8:case 12:return ws(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,o=t.pendingProps,i=t.memoizedProps,s=o.value,Ao(xa,r._currentValue),r._currentValue=s,null!==i)if(sr(i.value,s)){if(i.children===o.children&&!To.current){t=qs(e,t,n);break e}}else for(null!==(i=t.child)&&(i.return=t);null!==i;){var l=i.dependencies;if(null!==l){s=i.child;for(var c=l.firstContext;null!==c;){if(c.context===r){if(1===i.tag){(c=Ra(-1,n&-n)).tag=2;var u=i.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}i.lanes|=n,null!==(c=i.alternate)&&(c.lanes|=n),Ea(i.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===i.tag)s=i.type===t.type?null:i.child;else if(18===i.tag){if(null===(s=i.return))throw Error(a(341));s.lanes|=n,null!==(l=s.alternate)&&(l.lanes|=n),Ea(s,n,t),s=i.sibling}else s=i.child;if(null!==s)s.return=i;else for(s=i;null!==s;){if(s===t){s=null;break}if(null!==(i=s.sibling)){i.return=s.return,s=i;break}s=s.return}i=s}ws(e,t,o.children,n),t=t.child}return t;case 9:return o=t.type,r=t.pendingProps.children,ka(t,n),r=r(o=Ia(o)),t.flags|=1,ws(e,t,r,n),t.child;case 14:return o=ya(r=t.type,t.pendingProps),Cs(e,t,r,o=ya(r.type,o),n);case 15:return Es(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:ya(r,o),Vs(e,t),t.tag=1,Po(r)?(e=!0,Bo(t)):e=!1,ka(t,n),Va(t,r,o),Ga(t,r,o,n),Fs(null,t,r,!0,e,n);case 19:return Ws(e,t,n);case 22:return ks(e,t,n)}throw Error(a(156,t.tag))};var Kc="function"==typeof reportError?reportError:function(e){console.error(e)};function Yc(e){this._internalRoot=e}function Qc(e){this._internalRoot=e}function Jc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Xc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Zc(){}function eu(e,t,n,r,o){var a=n._reactRootContainer;if(a){var i=a;if("function"==typeof o){var s=o;o=function(){var e=qc(i);s.call(e)}}Vc(t,i,e,o)}else i=function(e,t,n,r,o){if(o){if("function"==typeof r){var a=r;r=function(){var e=qc(i);a.call(e)}}var i=Wc(t,r,e,0,null,!1,0,"",Zc);return e._reactRootContainer=i,e[ho]=i.current,$r(8===e.nodeType?e.parentNode:e),dc(),i}for(;o=e.lastChild;)e.removeChild(o);if("function"==typeof r){var s=r;r=function(){var e=qc(l);s.call(e)}}var l=Uc(e,0,!1,null,0,!1,0,"",Zc);return e._reactRootContainer=l,e[ho]=l.current,$r(8===e.nodeType?e.parentNode:e),dc((function(){Vc(t,l,n,r)})),l}(n,t,e,o,r);return qc(i)}Qc.prototype.render=Yc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));Vc(e,t,null,null)},Qc.prototype.unmount=Yc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;dc((function(){Vc(null,e,null,null)})),t[ho]=null}},Qc.prototype.unstable_scheduleHydration=function(e){if(e){var t=Et();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Pt.length&&0!==t&&t<Pt[n].priority;n++);Pt.splice(n,0,e),0===n&&Bt(e)}},wt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(xt(t,1|n),oc(t,Je()),!(6&Fl)&&(Wl=Je()+500,Wo()))}break;case 13:dc((function(){var t=Ta(e,1);if(null!==t){var n=tc();rc(t,e,1,n)}})),Hc(e,1)}},St=function(e){if(13===e.tag){var t=Ta(e,134217728);if(null!==t)rc(t,e,134217728,tc());Hc(e,134217728)}},Ct=function(e){if(13===e.tag){var t=nc(e),n=Ta(e,t);if(null!==n)rc(n,e,t,tc());Hc(e,t)}},Et=function(){return vt},kt=function(e,t){var n=vt;try{return vt=e,t()}finally{vt=n}},Se=function(e,t,n){switch(t){case"input":if(X(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var o=So(r);if(!o)throw Error(a(90));H(r),X(r,o)}}}break;case"textarea":ae(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},_e=uc,Fe=dc;var tu={usingClientEntryPoint:!1,Events:[bo,wo,So,Ie,Ae,uc]},nu={findFiberByHostInstance:vo,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},ru={bundleType:nu.bundleType,version:nu.version,rendererPackageName:nu.rendererPackageName,rendererConfig:nu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=qe(e))?null:e.stateNode},findFiberByHostInstance:nu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ou=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ou.isDisabled&&ou.supportsFiber)try{ot=ou.inject(ru),at=ou}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Jc(t))throw Error(a(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:S,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Jc(e))throw Error(a(299));var n=!1,r="",o=Kc;return null!=t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(o=t.onRecoverableError)),t=Uc(e,1,!1,null,0,n,0,r,o),e[ho]=t.current,$r(8===e.nodeType?e.parentNode:e),new Yc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=null===(e=qe(t))?null:e.stateNode},t.flushSync=function(e){return dc(e)},t.hydrate=function(e,t,n){if(!Xc(t))throw Error(a(200));return eu(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Jc(e))throw Error(a(405));var r=null!=n&&n.hydratedSources||null,o=!1,i="",s=Kc;if(null!=n&&(!0===n.unstable_strictMode&&(o=!0),void 0!==n.identifierPrefix&&(i=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Wc(t,null,e,1,null!=n?n:null,o,0,i,s),e[ho]=t.current,$r(e),r)for(e=0;e<r.length;e++)o=(o=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,o]:t.mutableSourceEagerHydrationData.push(n,o);return new Qc(t)},t.render=function(e,t,n){if(!Xc(t))throw Error(a(200));return eu(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Xc(e))throw Error(a(40));return!!e._reactRootContainer&&(dc((function(){eu(null,null,e,!1,(function(){e._reactRootContainer=null,e[ho]=null}))})),!0)},t.unstable_batchedUpdates=uc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Xc(n))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return eu(e,t,n,!1,r)},t.version="18.2.0-next-9e3b772b8-20220608"},338:(e,t,n)=>{var r=n(961);t.H=r.createRoot,r.hydrateRoot},961:(e,t,n)=>{!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=n(551)},799:(e,t)=>{
/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var n="function"==typeof Symbol&&Symbol.for,r=n?Symbol.for("react.element"):60103,o=n?Symbol.for("react.portal"):60106,a=n?Symbol.for("react.fragment"):60107,i=n?Symbol.for("react.strict_mode"):60108,s=n?Symbol.for("react.profiler"):60114,l=n?Symbol.for("react.provider"):60109,c=n?Symbol.for("react.context"):60110,u=n?Symbol.for("react.async_mode"):60111,d=n?Symbol.for("react.concurrent_mode"):60111,f=n?Symbol.for("react.forward_ref"):60112,p=n?Symbol.for("react.suspense"):60113,g=n?Symbol.for("react.suspense_list"):60120,h=n?Symbol.for("react.memo"):60115,m=n?Symbol.for("react.lazy"):60116,y=n?Symbol.for("react.block"):60121,x=n?Symbol.for("react.fundamental"):60117,v=n?Symbol.for("react.responder"):60118,b=n?Symbol.for("react.scope"):60119;function w(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type){case u:case d:case a:case s:case i:case p:return e;default:switch(e=e&&e.$$typeof){case c:case f:case m:case h:case l:return e;default:return t}}case o:return t}}}function S(e){return w(e)===d}t.AsyncMode=u,t.ConcurrentMode=d,t.ContextConsumer=c,t.ContextProvider=l,t.Element=r,t.ForwardRef=f,t.Fragment=a,t.Lazy=m,t.Memo=h,t.Portal=o,t.Profiler=s,t.StrictMode=i,t.Suspense=p,t.isAsyncMode=function(e){return S(e)||w(e)===u},t.isConcurrentMode=S,t.isContextConsumer=function(e){return w(e)===c},t.isContextProvider=function(e){return w(e)===l},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===r},t.isForwardRef=function(e){return w(e)===f},t.isFragment=function(e){return w(e)===a},t.isLazy=function(e){return w(e)===m},t.isMemo=function(e){return w(e)===h},t.isPortal=function(e){return w(e)===o},t.isProfiler=function(e){return w(e)===s},t.isStrictMode=function(e){return w(e)===i},t.isSuspense=function(e){return w(e)===p},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===a||e===d||e===s||e===i||e===p||e===g||"object"==typeof e&&null!==e&&(e.$$typeof===m||e.$$typeof===h||e.$$typeof===l||e.$$typeof===c||e.$$typeof===f||e.$$typeof===x||e.$$typeof===v||e.$$typeof===b||e.$$typeof===y)},t.typeOf=w},363:(e,t,n)=>{e.exports=n(799)},989:(e,t)=>{var n,r=Symbol.for("react.element"),o=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),c=Symbol.for("react.context"),u=Symbol.for("react.server_context"),d=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),p=Symbol.for("react.suspense_list"),g=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),m=Symbol.for("react.offscreen");
/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */function y(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type){case a:case s:case i:case f:case p:return e;default:switch(e=e&&e.$$typeof){case u:case c:case d:case h:case g:case l:return e;default:return t}}case o:return t}}}n=Symbol.for("react.module.reference")},737:(e,t,n)=>{n(989)},20:(e,t,n)=>{
/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var r=n(540),o=Symbol.for("react.element"),a=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,a={},c=null,u=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)i.call(t,r)&&!l.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===a[r]&&(a[r]=t[r]);return{$$typeof:o,type:e,key:c,ref:u,props:a,_owner:s.current}}t.Fragment=a,t.jsx=c,t.jsxs=c},287:(e,t)=>{
/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),p=Symbol.iterator;var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},h=Object.assign,m={};function y(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||g}function x(){}function v(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||g}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},x.prototype=y.prototype;var b=v.prototype=new x;b.constructor=v,h(b,y.prototype),b.isPureReactComponent=!0;var w=Array.isArray,S=Object.prototype.hasOwnProperty,C={current:null},E={key:!0,ref:!0,__self:!0,__source:!0};function k(e,t,r){var o,a={},i=null,s=null;if(null!=t)for(o in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(i=""+t.key),t)S.call(t,o)&&!E.hasOwnProperty(o)&&(a[o]=t[o]);var l=arguments.length-2;if(1===l)a.children=r;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];a.children=c}if(e&&e.defaultProps)for(o in l=e.defaultProps)void 0===a[o]&&(a[o]=l[o]);return{$$typeof:n,type:e,key:i,ref:s,props:a,_owner:C.current}}function I(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var A=/\/+/g;function _(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function F(e,t,o,a,i){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var l=!1;if(null===e)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case r:l=!0}}if(l)return i=i(l=e),e=""===a?"."+_(l,0):a,w(i)?(o="",null!=e&&(o=e.replace(A,"$&/")+"/"),F(i,t,o,"",(function(e){return e}))):null!=i&&(I(i)&&(i=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(i,o+(!i.key||l&&l.key===i.key?"":(""+i.key).replace(A,"$&/")+"/")+e)),t.push(i)),1;if(l=0,a=""===a?".":a+":",w(e))for(var c=0;c<e.length;c++){var u=a+_(s=e[c],c);l+=F(s,t,o,u,i)}else if(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"==typeof u)for(e=u.call(e),c=0;!(s=e.next()).done;)l+=F(s=s.value,t,o,u=a+_(s,c++),i);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function T(e,t,n){if(null==e)return e;var r=[],o=0;return F(e,r,"","",(function(e){return t.call(n,e,o++)})),r}function j(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var O={current:null},P={transition:null},R={ReactCurrentDispatcher:O,ReactCurrentBatchConfig:P,ReactCurrentOwner:C};function N(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:T,forEach:function(e,t,n){T(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return T(e,(function(){t++})),t},toArray:function(e){return T(e,(function(e){return e}))||[]},only:function(e){if(!I(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=o,t.Profiler=i,t.PureComponent=v,t.StrictMode=a,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=R,t.act=N,t.cloneElement=function(e,t,r){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var o=h({},e.props),a=e.key,i=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(i=t.ref,s=C.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)S.call(t,c)&&!E.hasOwnProperty(c)&&(o[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)o.children=r;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];o.children=l}return{$$typeof:n,type:e.type,key:a,ref:i,props:o,_owner:s}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=k,t.createFactory=function(e){var t=k.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=I,t.lazy=function(e){return{$$typeof:f,_payload:{_status:-1,_result:e},_init:j}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=P.transition;P.transition={};try{e()}finally{P.transition=t}},t.unstable_act=N,t.useCallback=function(e,t){return O.current.useCallback(e,t)},t.useContext=function(e){return O.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return O.current.useDeferredValue(e)},t.useEffect=function(e,t){return O.current.useEffect(e,t)},t.useId=function(){return O.current.useId()},t.useImperativeHandle=function(e,t,n){return O.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return O.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return O.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return O.current.useMemo(e,t)},t.useReducer=function(e,t,n){return O.current.useReducer(e,t,n)},t.useRef=function(e){return O.current.useRef(e)},t.useState=function(e){return O.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return O.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return O.current.useTransition()},t.version="18.3.1"},540:(e,t,n)=>{e.exports=n(287)},848:(e,t,n)=>{e.exports=n(20)},463:(e,t)=>{
/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,o=e[r];if(!(0<a(o,t)))break e;e[r]=t,e[n]=o,n=r}}function r(e){return 0===e.length?null:e[0]}function o(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,o=e.length,i=o>>>1;r<i;){var s=2*(r+1)-1,l=e[s],c=s+1,u=e[c];if(0>a(l,n))c<o&&0>a(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[s]=n,r=s);else{if(!(c<o&&0>a(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var i=performance;t.unstable_now=function(){return i.now()}}else{var s=Date,l=s.now();t.unstable_now=function(){return s.now()-l}}var c=[],u=[],d=1,f=null,p=3,g=!1,h=!1,m=!1,y="function"==typeof setTimeout?setTimeout:null,x="function"==typeof clearTimeout?clearTimeout:null,v="undefined"!=typeof setImmediate?setImmediate:null;function b(e){for(var t=r(u);null!==t;){if(null===t.callback)o(u);else{if(!(t.startTime<=e))break;o(u),t.sortIndex=t.expirationTime,n(c,t)}t=r(u)}}function w(e){if(m=!1,b(e),!h)if(null!==r(c))h=!0,P(S);else{var t=r(u);null!==t&&R(w,t.startTime-e)}}function S(e,n){h=!1,m&&(m=!1,x(I),I=-1),g=!0;var a=p;try{for(b(n),f=r(c);null!==f&&(!(f.expirationTime>n)||e&&!F());){var i=f.callback;if("function"==typeof i){f.callback=null,p=f.priorityLevel;var s=i(f.expirationTime<=n);n=t.unstable_now(),"function"==typeof s?f.callback=s:f===r(c)&&o(c),b(n)}else o(c);f=r(c)}if(null!==f)var l=!0;else{var d=r(u);null!==d&&R(w,d.startTime-n),l=!1}return l}finally{f=null,p=a,g=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var C,E=!1,k=null,I=-1,A=5,_=-1;function F(){return!(t.unstable_now()-_<A)}function T(){if(null!==k){var e=t.unstable_now();_=e;var n=!0;try{n=k(!0,e)}finally{n?C():(E=!1,k=null)}}else E=!1}if("function"==typeof v)C=function(){v(T)};else if("undefined"!=typeof MessageChannel){var j=new MessageChannel,O=j.port2;j.port1.onmessage=T,C=function(){O.postMessage(null)}}else C=function(){y(T,0)};function P(e){k=e,E||(E=!0,C())}function R(e,n){I=y((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){h||g||(h=!0,P(S))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,o,a){var i=t.unstable_now();switch("object"==typeof a&&null!==a?a="number"==typeof(a=a.delay)&&0<a?i+a:i:a=i,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:d++,callback:o,priorityLevel:e,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>i?(e.sortIndex=a,n(u,e),null===r(c)&&e===r(u)&&(m?(x(I),I=-1):m=!0,R(w,a-i))):(e.sortIndex=s,n(c,e),h||g||(h=!0,P(S))),e},t.unstable_shouldYield=F,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},982:(e,t,n)=>{e.exports=n(463)},63:(e,t,n)=>{
/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var r=n(540);var o="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},a=r.useState,i=r.useEffect,s=r.useLayoutEffect,l=r.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!o(e,n)}catch(e){return!0}}var u="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),r=a({inst:{value:n,getSnapshot:t}}),o=r[0].inst,u=r[1];return s((function(){o.value=n,o.getSnapshot=t,c(o)&&u({inst:o})}),[e,n,t]),i((function(){return c(o)&&u({inst:o}),e((function(){c(o)&&u({inst:o})}))}),[e]),l(n),n};t.useSyncExternalStore=void 0!==r.useSyncExternalStore?r.useSyncExternalStore:u},940:(e,t,n)=>{
/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var r=n(540),o=n(888);var a="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},i=o.useSyncExternalStore,s=r.useRef,l=r.useEffect,c=r.useMemo,u=r.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,n,r,o){var d=s(null);if(null===d.current){var f={hasValue:!1,value:null};d.current=f}else f=d.current;d=c((function(){function e(e){if(!l){if(l=!0,i=e,e=r(e),void 0!==o&&f.hasValue){var t=f.value;if(o(t,e))return s=t}return s=e}if(t=s,a(i,e))return t;var n=r(e);return void 0!==o&&o(t,n)?t:(i=e,s=n)}var i,s,l=!1,c=void 0===n?null:n;return[function(){return e(t())},null===c?void 0:function(){return e(c())}]}),[t,n,r,o]);var p=i(e,d[0],d[1]);return l((function(){f.hasValue=!0,f.value=p}),[p]),u(p),p}},888:(e,t,n)=>{e.exports=n(63)},242:(e,t,n)=>{e.exports=n(940)}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.p="/";var r=n(540),o=n(338),a=n(848),i=n(888),s=n(242),l=n(961);let c=function(e){e()};const u=()=>c,d=(0,r.createContext)(null);function f(){return(0,r.useContext)(d)}let p=()=>{throw new Error("uSES not initialized!")};const g=(e,t)=>e===t;function h(e=d){const t=e===d?f:()=>(0,r.useContext)(e);return function(e,n=g){const{store:o,subscription:a,getServerState:i}=t(),s=p(a.addNestedSub,o.getState,i||o.getState,e,n);return(0,r.useDebugValue)(s),s}}const m=h();n(146),n(737);const y={notify(){},get:()=>[]};function x(e,t){let n,r=y;function o(){i.onStateChange&&i.onStateChange()}function a(){n||(n=t?t.addNestedSub(o):e.subscribe(o),r=function(){const e=u();let t=null,n=null;return{clear(){t=null,n=null},notify(){e((()=>{let e=t;for(;e;)e.callback(),e=e.next}))},get(){let e=[],n=t;for(;n;)e.push(n),n=n.next;return e},subscribe(e){let r=!0,o=n={callback:e,next:null,prev:n};return o.prev?o.prev.next=o:t=o,function(){r&&null!==t&&(r=!1,o.next?o.next.prev=o.prev:n=o.prev,o.prev?o.prev.next=o.next:t=o.next)}}}}())}const i={addNestedSub:function(e){return a(),r.subscribe(e)},notifyNestedSubs:function(){r.notify()},handleChangeWrapper:o,isSubscribed:function(){return Boolean(n)},trySubscribe:a,tryUnsubscribe:function(){n&&(n(),n=void 0,r.clear(),r=y)},getListeners:()=>r};return i}const v=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement)?r.useLayoutEffect:r.useEffect;let b=null;const w=function({store:e,context:t,children:n,serverState:o}){const a=(0,r.useMemo)((()=>{const t=x(e);return{store:e,subscription:t,getServerState:o?()=>o:void 0}}),[e,o]),i=(0,r.useMemo)((()=>e.getState()),[e]);v((()=>{const{subscription:t}=a;return t.onStateChange=t.notifyNestedSubs,t.trySubscribe(),i!==e.getState()&&t.notifyNestedSubs(),()=>{t.tryUnsubscribe(),t.onStateChange=void 0}}),[a,i]);const s=t||d;return r.createElement(s.Provider,{value:a},n)};function S(e=d){const t=e===d?f:()=>(0,r.useContext)(e);return function(){const{store:e}=t();return e}}const C=S();function E(e=d){const t=e===d?C:S(e);return function(){return t().dispatch}}const k=E();var I,A;I=s.useSyncExternalStoreWithSelector,p=I,(e=>{b=e})(i.useSyncExternalStore),A=l.unstable_batchedUpdates,c=A;var _,F="SET_CURRENT_TAB_ID",T="SET_TAB_CARD_FIELD",j="CLEAR_TAB_CARD_DATA",O="SAVE_TAB_CARD",P="DELETE_TAB_CARD",R="SET_TAB_STORED_CARDS",N="UPDATE_TAB_CARD_EXPORT_STATUS",L="UPDATE_TAB_STORED_CARD",B="SET_TAB_CURRENT_PAGE",z=function(e,t,n){return{type:T,payload:{tabId:e,field:t,value:n}}},D=function(e,t){return z(e,"text",t)},M=function(e,t){return z(e,"translation",t)},U=function(e,t){return z(e,"examples",t)},$=function(e,t){return z(e,"image",t)},W=function(e,t){return z(e,"imageUrl",t)},V=function(e,t){return z(e,"front",t)},q=function(e,t){return z(e,"back",t)},G=function(e,t){return z(e,"linguisticInfo",t)},H=function(e,t){return z(e,"transcription",t)},K=function(e,t){return z(e,"isGeneratingCard",t)},Y=function(e,t){return z(e,"currentCardId",t)};!function(e){e.LanguageLearning="language-learning",e.GeneralTopic="general-topic"}(_||(_={}));var Q=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},J=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}};function X(e){var t=e.examples.map((function(t){return function(e,t,n,r){void 0===n&&(n=null),void 0===r&&(r="0.8em");var o=e.replace(t,"<b>".concat(t,"</b>"));if(n){var a=n.split(" ").slice(1).join(" ");return"".concat(o,"<br><span style='font-size: ").concat(r,";'><i>").concat(a,"</i></span>")}return o}(t[0],e.text,t[1])})).join("<br><br>"),n="";if(e.image_base64){var r=e.image_base64;if(r.startsWith("data:")){var o="base64,",a=r.indexOf(o);if(-1!==a){var i=r.substring(a+7);n='<div><img src="data:image/jpeg;base64,'.concat(i,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else n='<div><img src="'.concat(r,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else n='<div><img src="data:image/jpeg;base64,'.concat(r,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}var s="";if(e.linguisticInfo&&e.linguisticInfo.trim()){var l=e.linguisticInfo.trim().split("\n").filter((function(e){return e.trim()})),c="";l.forEach((function(e){var t=e.trim();if(t.match(/^[А-ЯЁA-Z][^:]*:$/))c+='<div style="color: #2563EB; font-weight: bold; margin-top: 12px; margin-bottom: 4px;">'.concat(t,"</div>");else if(t.startsWith("•")||t.startsWith("-")||t.startsWith("*")){var n=t.replace(/^[•\-*]\s*/,"");c+='<div style="margin-left: 16px; margin-bottom: 2px; color: #374151;">• '.concat(n,"</div>")}else if(t.includes(":")&&!t.endsWith(":")){var r=t.split(":"),o=r[0],a=r.slice(1).join(":").trim();c+='<div style="margin-bottom: 4px;"><span style="color: #6B7280; font-weight: 500;">'.concat(o.trim(),':</span> <span style="color: #111827;">').concat(a,"</span></div>")}else t&&(c+='<div style="margin-bottom: 6px; color: #374151; line-height: 1.4;">'.concat(t,"</div>"))})),c&&(s='\n                <div style="margin-top: 20px; padding: 12px; background-color: #F8FAFC; border-left: 4px solid #2563EB; border-radius: 0 6px 6px 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">\n                    <div style="color: #1E40AF; font-weight: bold; font-size: 14px; margin-bottom: 8px; display: flex; align-items: center;">\n                        <span style="margin-right: 6px;">📚</span>\n                        Grammar & Linguistics\n                    </div>\n                    '.concat(c,"\n                </div>\n            "))}return"\n        <b>".concat(e.translation,"</b>\n        <br><br>").concat(t,"<br><br>\n        ").concat(n,"\n        ").concat(s,"\n    ")}function Z(e,t){var n=e.replace("Key points:","").trim().split("-").map((function(e){return"<li>".concat(e.trim(),"</li>")})).join(""),r="";if(t){var o=t;if(o.startsWith("data:")){var a="base64,",i=o.indexOf(a);if(-1!==i){var s=o.substring(i+7);r='<div><img src="data:image/jpeg;base64,'.concat(s,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else r='<div><img src="'.concat(o,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else r='<div><img src="data:image/jpeg;base64,'.concat(o,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}return"\n        <b>Key points:</b>\n        <ul>\n            ".concat(n,"\n        </ul>\n        ").concat(r,"\n    ")}var ee=function(e,t,n,r,o,a){return Q(void 0,void 0,void 0,(function(){var i,s,l,c,u;return J(this,(function(d){switch(d.label){case 0:return d.trys.push([0,4,,5]),i=JSON.stringify({action:"createDeck",version:6,key:n,params:{deck:r}}),[4,fetch(t,{method:"POST",body:i,headers:{"Content-Type":"application/json"}})];case 1:if(!d.sent().ok)throw new Error("Failed to create deck.");return s=a.map((function(t){var n;if(e===_.LanguageLearning&&"translation"in t&&"examples"in t&&"image_base64"in t)n={Front:t.text,Back:X(t)};else if(e===_.GeneralTopic&&"back"in t){var a=t;n={Front:a.front,Back:Z(a.back,a.image_base64)}}return{deckName:r,modelName:o,fields:n,options:{allowDuplicate:!1},tags:[]}})),l=JSON.stringify({action:"addNotes",version:6,key:n,params:{notes:s}}),[4,fetch(t,{method:"POST",body:l,headers:{"Content-Type":"application/json"}})];case 2:if(!(c=d.sent()).ok)throw new Error("Failed to add notes.");return[4,c.json()];case 3:if((u=d.sent()).error)throw new Error("Anki error: ".concat(u.error));return[2,u.result];case 4:throw d.sent();case 5:return[2]}}))}))};function te(e){return Q(this,void 0,void 0,(function(){return J(this,(function(t){return[2,new Promise((function(t,n){chrome.runtime.sendMessage(e,(function(e){e.status&&void 0!==e.data?t(e.data):(console.error("Error fetching image:",e.error),n(null))}))}))]}))}))}var ne=function(e){return Q(void 0,void 0,void 0,(function(){var t,n,r;return J(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,fetch("http://localhost:8765",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"deckNames",version:6,key:e})})];case 1:if(!(t=o.sent()).ok)throw new Error("HTTP error! Status: ".concat(t.status));return[4,t.json()];case 2:return(n=o.sent()).result?[2,{result:n.result.map((function(e){return{deckId:e,name:e}})),error:n.error}]:[2,n];case 3:throw r=o.sent(),console.error("Error fetching decks:",r),r;case 4:return[2]}}))}))},re=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},oe=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},ae="SAVE_ANKI_CARDS",ie="SET_TEXT",se="SET_TRANSLATION",le="SET_EXAMPLES",ce="SET_IMAGE",ue="SET_IMAGE_URL",de="SET_BACK",fe="SET_FRONT",pe="SAVE_CARD_TO_STORAGE",ge="LOAD_STORED_CARDS",he="DELETE_STORED_CARD",me="SET_STORED_CARDS",ye="UPDATE_CARD_EXPORT_STATUS",xe="UPDATE_STORED_CARD",ve="SET_CURRENT_CARD_ID",be="SET_LINGUISTIC_INFO",we="SET_TRANSCRIPTION",Se="SET_IS_GENERATING_CARD",Ce=function(e,t,n,r,o,a){return void 0===n&&(n=null),function(i){return re(void 0,void 0,void 0,(function(){var s,l;return oe(this,(function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,ee(e,t,n,r,o,a)];case 1:return s=c.sent(),i({type:ae,payload:s}),[3,3];case 2:throw l=c.sent(),console.error("Error saving Anki cards:",l),l;case 3:return[2]}}))}))}},Ee=function(e){var t,n,r,o;return console.log("*** ACTION: saveCardToStorage called with card data ***"),console.log("Action payload image info:",{hasImage:!!e.image,hasImageUrl:!!e.imageUrl,imageType:typeof e.image,imageUrlType:typeof e.imageUrl,imageLength:null===(t=e.image)||void 0===t?void 0:t.length,imageUrlLength:null===(n=e.imageUrl)||void 0===n?void 0:n.length,imageValue:e.image,imageUrlValue:e.imageUrl,imagePreview:null===(r=e.image)||void 0===r?void 0:r.substring(0,50),imageUrlPreview:null===(o=e.imageUrl)||void 0===o?void 0:o.substring(0,50)}),{type:pe,payload:e}},ke=function(){return{type:ge}},Ie=function(e){return{type:ie,payload:e}},Ae=function(e){return{type:le,payload:e}},_e=function(e){return{type:se,payload:e}},Fe=function(e){return{type:ce,payload:e}},Te=function(e){return{type:ue,payload:e}},je=function(e){return{type:de,payload:e}},Oe=function(e){return{type:fe,payload:e}},Pe=function(e){var t,n,r,o;return console.log("*** ACTION: updateStoredCard called ***"),console.log("Updated card image info:",{cardId:e.id,hasImage:!!e.image,hasImageUrl:!!e.imageUrl,imageType:typeof e.image,imageUrlType:typeof e.imageUrl,imageLength:null===(t=e.image)||void 0===t?void 0:t.length,imageUrlLength:null===(n=e.imageUrl)||void 0===n?void 0:n.length,imageValue:e.image,imageUrlValue:e.imageUrl,imagePreview:null===(r=e.image)||void 0===r?void 0:r.substring(0,50),imageUrlPreview:null===(o=e.imageUrl)||void 0===o?void 0:o.substring(0,50)}),{type:xe,payload:e}},Re=function(e){return{type:ve,payload:e}},Ne=function(e){return{type:be,payload:e}},Le=function(e){return{type:we,payload:e}},Be=function(e){return{type:Se,payload:e}},ze=function(){return ze=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},ze.apply(this,arguments)},De=(0,r.createContext)(null),Me=function(e){var t=e.tabId,n=e.children,o=k(),i=m((function(e){return e.tabState.tabStates[t]})),s=m((function(e){return e.cards})),l=(0,r.useMemo)((function(){var e=(null==i?void 0:i.cardData)||{text:s.text,translation:s.translation,examples:s.examples,image:s.image,imageUrl:s.imageUrl,front:s.front,back:s.back,linguisticInfo:s.linguisticInfo,transcription:s.transcription,isGeneratingCard:s.isGeneratingCard,currentCardId:s.currentCardId},n=s.storedCards,r=(null==i?void 0:i.fieldIdPrefix)||"fallback_".concat(Date.now(),"_"),a=m((function(e){return e.currentPage})),l=(null==i?void 0:i.currentPage)||a;return{text:e.text,translation:e.translation,examples:e.examples,image:e.image,imageUrl:e.imageUrl,front:e.front,back:e.back,linguisticInfo:e.linguisticInfo,transcription:e.transcription,isGeneratingCard:e.isGeneratingCard,currentCardId:e.currentCardId,storedCards:n,fieldIdPrefix:r,currentPage:l,setText:function(e){o(i?D(t,e):Ie(e))},setTranslation:function(e){o(i?M(t,e):_e(e))},setExamples:function(e){o(i?U(t,e):Ae(e))},setImage:function(e){o(i?$(t,e):Fe(e))},setImageUrl:function(e){o(i?W(t,e):Te(e))},setFront:function(e){o(i?V(t,e):Oe(e))},setBack:function(e){o(i?q(t,e):je(e))},setLinguisticInfo:function(e){o(i?G(t,e):Ne(e))},setTranscription:function(e){o(i?H(t,e):Le(e))},setIsGeneratingCard:function(e){o(i?K(t,e):Be(e))},setCurrentCardId:function(e){o(i?Y(t,e):Re(e))},saveCardToStorage:function(e){o(Ee(e))},updateStoredCard:function(e){o(Pe(e))},deleteStoredCard:function(e){o(function(e){return{type:he,payload:e}}(e))},updateCardExportStatus:function(e,t){o(function(e,t){return{type:ye,payload:{cardId:e,status:t}}}(e,t))},setCurrentPage:function(e){o(i?function(e,t){return{type:B,payload:{tabId:e,currentPage:t}}}(t,e):function(e){return{type:"SET_CURRENT_PAGE",currentPage:e}}(e))},updateCard:function(e){Object.keys(e).forEach((function(n){var r=e[n];if(void 0!==r)switch(n){case"text":o(i?D(t,r):Ie(r));break;case"translation":o(i?M(t,r):_e(r));break;case"examples":o(i?U(t,r):Ae(r));break;case"image":o(i?$(t,r):Fe(r));break;case"imageUrl":o(i?W(t,r):Te(r));break;case"front":o(i?V(t,r):Oe(r));break;case"back":o(i?q(t,r):je(r));break;case"linguisticInfo":o(i?G(t,r):Ne(r));break;case"transcription":o(i?H(t,r):Le(r));break;case"isGeneratingCard":o(i?K(t,r):Be(r));break;case"currentCardId":o(i?Y(t,r):Re(r))}}))}}}),[i,s,t,o]);return(0,a.jsx)(De.Provider,ze({value:l},{children:n}))},Ue=function(){var e=(0,r.useContext)(De);if(!e)throw new Error("useTabAware must be used within a TabAwareProvider");return e},$e=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},We=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},Ve=null,qe=function(){return!!Ve&&(!(Date.now()-Ve.timestamp>3e5)||(Ve=null,!1))},Ge=function(e){Ve={timestamp:Date.now(),message:e,notificationShown:!1}},He=function(){Ve&&(Ve.notificationShown=!0)},Ke=function(){return null!==Ve&&!Ve.notificationShown},Ye=function(){return(null==Ve?void 0:Ve.message)||null},Qe=function(e){if(!e||!e.error)return"Unknown OpenAI API error";var t=e.error,n=t.message,r=t.type,o=t.code,a="";return a="insufficient_quota"===o?"Your OpenAI account has exceeded its quota.\n\nPlease check your billing details or use a different API key.":"invalid_request_error"===r?"Invalid request to OpenAI.\n\nPlease check your API key and settings.":"rate_limit_exceeded"===r?"OpenAI rate limit exceeded.\n\nPlease try again in a few minutes.":"OpenAI API Error: ".concat(n||"Unknown error"),a+="\n\nDetails:\n- Type: ".concat(r||"unknown","\n- Code: ").concat(o||"none")},Je=function(e,t){return $e(void 0,void 0,void 0,(function(){var n,r,o,a,i,s,l,c,u,d,f;return We(this,(function(p){switch(p.label){case 0:if(!e)throw new Error("OpenAI API key is missing. Please check your settings.");if(qe())throw new Error(Ve.message);n=[{role:"system",content:"Is the word '".concat(t,"' an abstract concept or a concrete object? Answer 'abstract' or 'concrete':")}],p.label=1;case 1:return p.trys.push([1,6,,7]),r={model:"gpt-4o-mini",messages:n,max_tokens:900},[4,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(r),signal:void 0})];case 2:return(o=p.sent()).ok?[3,4]:[4,o.json()];case 3:if((a=p.sent())&&a.error)throw i=Qe(a),"insufficient_quota"!==a.error.code&&429!==o.status||Ge(i),new Error(i);throw new Error("OpenAI API error: ".concat(o.status," ").concat(o.statusText));case 4:return[4,o.json()];case 5:return s=p.sent(),[2,"abstract"===(null!==(f=null===(d=null===(u=null===(c=s.choices[0])||void 0===c?void 0:c.message)||void 0===u?void 0:u.content)||void 0===d?void 0:d.trim().toLowerCase())&&void 0!==f?f:"")];case 6:return l=p.sent(),console.error("Error during determining abstractness:",l),[2,!1];case 7:return[2]}}))}))},Xe=function(e,t,n,r){return void 0===n&&(n=""),$e(void 0,void 0,void 0,(function(){var o,a,i,s,l,c,u,d,f,p,g,h,m,y;return We(this,(function(x){switch(x.label){case 0:if(!e)throw new Error("OpenAI API key is missing. Please check your settings.");if(qe())throw new Error(Ve.message);o="Provide a detailed description for an image that represents the concept of '".concat(t,"'"),a=n?"".concat(o,". ").concat(n):o,i=[{role:"system",content:a}],x.label=1;case 1:return x.trys.push([1,6,,7]),s={model:"gpt-4o-mini",messages:i,max_tokens:100},[4,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(s),signal:r})];case 2:return(l=x.sent()).ok?[3,4]:[4,l.json()];case 3:if((c=x.sent())&&c.error)throw u=Qe(c),"insufficient_quota"!==c.error.code&&429!==l.status||Ge(u),new Error(u);throw new Error("Could not generate image description. OpenAI API error: ".concat(l.status," ").concat(l.statusText));case 4:return[4,l.json()];case 5:if(d=x.sent(),!(f=null!==(y=null===(m=null===(h=null===(g=d.choices[0])||void 0===g?void 0:g.message)||void 0===h?void 0:h.content)||void 0===m?void 0:m.trim())&&void 0!==y?y:""))throw new Error("Could not generate a valid image description. Please try again.");return[2,f];case 6:throw p=x.sent(),console.error("Error during getting description image:",p),p;case 7:return[2]}}))}))},Ze=function(e,t,n){return void 0===n&&(n=""),$e(void 0,void 0,void 0,(function(){var r,o,a,i,s,l,c,u;return We(this,(function(d){switch(d.label){case 0:return d.trys.push([0,2,,3]),r=n?"".concat(t,". ").concat(n):t,[4,e.images.generate({prompt:r,n:1,size:"512x512",response_format:"url"})];case 1:if(!(o=d.sent()).data||!(null===(u=o.data[0])||void 0===u?void 0:u.url))throw new Error("OpenAI did not return an image URL. Please try again.");return[2,o.data[0].url];case 2:if(a=d.sent(),console.error("Error during image generation:",a),a instanceof Error){if((i=a.message||"").includes("quota")||i.includes("billing"))throw Ge(s="Your OpenAI account has exceeded its quota.\n\nPlease check your billing details or use a different API key."),new Error(s);if(i.includes("rate limit"))throw new Error("OpenAI rate limit exceeded.\n\nPlease try again in a few minutes.");if(i.includes("invalid API key"))throw new Error("Invalid OpenAI API key.\n\nPlease check your API key in settings.");if(i.includes("moderation")||i.includes("policy"))throw new Error("OpenAI content policy violation.\n\nThe image request was flagged for content policy violation. Please modify your request.");if(i.includes("{")&&i.includes("}"))try{if(l=i.substring(i.indexOf("{"),i.lastIndexOf("}")+1),(c=JSON.parse(l))&&c.error)return[2,Qe(c)]}catch(e){}throw a}throw new Error("Failed to generate image.\n\nPlease check your OpenAI API key and try again.");case 3:return[2]}}))}))},et=function(e,t,n,r){return void 0===r&&(r=""),$e(void 0,void 0,void 0,(function(){var o,a,i;return We(this,(function(s){switch(s.label){case 0:if(!t)throw new Error("OpenAI API key is missing. Please check your settings.");if(qe())throw new Error(Ve.message);s.label=1;case 1:return s.trys.push([1,8,,9]),[4,Je(t,n)];case 2:return s.sent()?[4,Xe(t,n,r)]:[3,5];case 3:return o=s.sent(),[4,Ze(e,"Create a vivid, high-quality illustration representing the concept of '".concat(o,"'"),r)];case 4:return[2,s.sent()];case 5:return a="Create a high-quality, photorealistic image of a ".concat(n," with a neutral expression and clear features"),[4,Ze(e,a,r)];case 6:return[2,s.sent()];case 7:return[3,9];case 8:if(i=s.sent(),console.error("Error during getting image for word:",i),i instanceof Error){if(i.message.includes("OpenAI API Error")||i.message.includes("exceeded its quota")||i.message.includes("rate limit")||i.message.includes("API key"))throw i;throw new Error('Failed to generate image for "'.concat(n,'". ').concat(i.message))}throw new Error('Failed to generate image for "'.concat(n,'". Please check your OpenAI API key and try again.'));case 9:return[2]}}))}))},tt="SET_OPEN_AI_KEY",nt="SET_SELECTED_MODE",rt="SET_TRANSLATE_TO_LANGUAGE",ot="SET_ANKI_CONNECT_URL",at="SET_ANKI_CONNECT_API_KEY",it="SET_USE_ANKI_CONNECT",st="SET_VISIBLE_SIDEBAR",lt="SET_SHOULD_GENERATE_IMAGE",ct="SET_IMAGE_GENERATION_MODE",ut="SET_TRANSLATION_PROMPT",dt="SET_EXAMPLES_PROMPT",ft="SET_AI_INSTRUCTIONS",pt="SET_IMAGE_INSTRUCTIONS",gt="SET_MODEL_PROVIDER",ht="SET_GROQ_API_KEY",mt="SET_GROQ_MODEL_NAME",yt="SET_SOURCE_LANGUAGE",xt=function(e){return{type:nt,payload:e}},vt={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},bt=r.createContext&&r.createContext(vt),wt=function(){return wt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},wt.apply(this,arguments)},St=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n};function Ct(e){return e&&e.map((function(e,t){return r.createElement(e.tag,wt({key:t},e.attr),Ct(e.child))}))}function Et(e){return function(t){return r.createElement(kt,wt({attr:wt({},e.attr)},t),Ct(e.child))}}function kt(e){var t=function(t){var n,o=e.attr,a=e.size,i=e.title,s=St(e,["attr","size","title"]),l=a||t.size||"1em";return t.className&&(n=t.className),e.className&&(n=(n?n+" ":"")+e.className),r.createElement("svg",wt({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,o,s,{className:n,style:wt(wt({color:e.color||t.color},t.style),e.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),i&&r.createElement("title",null,i),e.children)};return void 0!==bt?r.createElement(bt.Consumer,null,(function(e){return t(e)})):t(vt)}function It(e){return Et({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M208 0c-29.9 0-54.7 20.5-61.8 48.2-.8 0-1.4-.2-2.2-.2-35.3 0-64 28.7-64 64 0 4.8.6 9.5 1.7 14C52.5 138 32 166.6 32 200c0 12.6 3.2 24.3 8.3 34.9C16.3 248.7 0 274.3 0 304c0 33.3 20.4 61.9 49.4 73.9-.9 4.6-1.4 9.3-1.4 14.1 0 39.8 32.2 72 72 72 4.1 0 8.1-.5 12-1.2 9.6 28.5 36.2 49.2 68 49.2 39.8 0 72-32.2 72-72V64c0-35.3-28.7-64-64-64zm368 304c0-29.7-16.3-55.3-40.3-69.1 5.2-10.6 8.3-22.3 8.3-34.9 0-33.4-20.5-62-49.7-74 1-4.5 1.7-9.2 1.7-14 0-35.3-28.7-64-64-64-.8 0-1.5.2-2.2.2C422.7 20.5 397.9 0 368 0c-35.3 0-64 28.6-64 64v376c0 39.8 32.2 72 72 72 31.8 0 58.4-20.7 68-49.2 3.9.7 7.9 1.2 12 1.2 39.8 0 72-32.2 72-72 0-4.8-.5-9.5-1.4-14.1 29-12 49.4-40.6 49.4-73.9z"}}]})(e)}function At(e){return Et({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"}}]})(e)}function _t(e){return Et({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"}}]})(e)}function Ft(e){return Et({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M207.029 381.476L12.686 187.132c-9.373-9.373-9.373-24.569 0-33.941l22.667-22.667c9.357-9.357 24.522-9.375 33.901-.04L224 284.505l154.745-154.021c9.379-9.335 24.544-9.317 33.901.04l22.667 22.667c9.373 9.373 9.373 24.569 0 33.941L240.971 381.476c-9.373 9.372-24.569 9.372-33.942 0z"}}]})(e)}function Tt(e){return Et({tag:"svg",attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M34.52 239.03L228.87 44.69c9.37-9.37 24.57-9.37 33.94 0l22.67 22.67c9.36 9.36 9.37 24.52.04 33.9L131.49 256l154.02 154.75c9.34 9.38 9.32 24.54-.04 33.9l-22.67 22.67c-9.37 9.37-24.57 9.37-33.94 0L34.52 272.97c-9.37-9.37-9.37-24.57 0-33.94z"}}]})(e)}function jt(e){return Et({tag:"svg",attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"}}]})(e)}function Ot(e){return Et({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M240.971 130.524l194.343 194.343c9.373 9.373 9.373 24.569 0 33.941l-22.667 22.667c-9.357 9.357-24.522 9.375-33.901.04L224 227.495 69.255 381.516c-9.379 9.335-24.544 9.317-33.901-.04l-22.667-22.667c-9.373-9.373-9.373-24.569 0-33.941L207.03 130.525c9.372-9.373 24.568-9.373 33.941-.001z"}}]})(e)}function Pt(e){return Et({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M278.9 511.5l-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2l43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6l144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z"}}]})(e)}function Rt(e){return Et({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"}}]})(e)}function Nt(e){return Et({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"}}]})(e)}function Lt(e){return Et({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"}}]})(e)}function Bt(e){return Et({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M0 168v-16c0-13.255 10.745-24 24-24h360V80c0-21.367 25.899-32.042 40.971-16.971l80 80c9.372 9.373 9.372 24.569 0 33.941l-80 80C409.956 271.982 384 261.456 384 240v-48H24c-13.255 0-24-10.745-24-24zm488 152H128v-48c0-21.314-25.862-32.08-40.971-16.971l-80 80c-9.372 9.373-9.372 24.569 0 33.941l80 80C102.057 463.997 128 453.437 128 432v-48h360c13.255 0 24-10.745 24-24v-16c0-13.255-10.745-24-24-24z"}}]})(e)}function zt(e){return Et({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"}}]})(e)}function Dt(e){return Et({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M432 416h-23.41L277.88 53.69A32 32 0 0 0 247.58 32h-47.16a32 32 0 0 0-30.3 21.69L39.41 416H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h128a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16h-19.58l23.3-64h152.56l23.3 64H304a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h128a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM176.85 272L224 142.51 271.15 272z"}}]})(e)}function Mt(e){return Et({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M622.34 153.2L343.4 67.5c-15.2-4.67-31.6-4.67-46.79 0L17.66 153.2c-23.54 7.23-23.54 38.36 0 45.59l48.63 14.94c-10.67 13.19-17.23 29.28-17.88 46.9C38.78 266.15 32 276.11 32 288c0 10.78 5.68 19.85 13.86 25.65L20.33 428.53C18.11 438.52 25.71 448 35.94 448h56.11c10.24 0 17.84-9.48 15.62-19.47L82.14 313.65C90.32 307.85 96 298.78 96 288c0-11.57-6.47-21.25-15.66-26.87.76-15.02 8.44-28.3 20.69-36.72L296.6 284.5c9.06 2.78 26.44 6.25 46.79 0l278.95-85.7c23.55-7.24 23.55-38.36 0-45.6zM352.79 315.09c-28.53 8.76-52.84 3.92-65.59 0l-145.02-44.55L128 384c0 35.35 85.96 64 192 64s192-28.65 192-64l-14.18-113.47-145.03 44.56z"}}]})(e)}function Ut(e){return Et({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h416c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM112 120c-30.928 0-56 25.072-56 56s25.072 56 56 56 56-25.072 56-56-25.072-56-56-56zM64 384h384V272l-87.515-87.515c-4.686-4.686-12.284-4.686-16.971 0L208 320l-55.515-55.515c-4.686-4.686-12.284-4.686-16.971 0L64 336v48z"}}]})(e)}function $t(e){return Et({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}}]})(e)}function Wt(e){return Et({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M152.1 236.2c-3.5-12.1-7.8-33.2-7.8-33.2h-.5s-4.3 21.1-7.8 33.2l-11.1 37.5H163zM616 96H336v320h280c13.3 0 24-10.7 24-24V120c0-13.3-10.7-24-24-24zm-24 120c0 6.6-5.4 12-12 12h-11.4c-6.9 23.6-21.7 47.4-42.7 69.9 8.4 6.4 17.1 12.5 26.1 18 5.5 3.4 7.3 10.5 4.1 16.2l-7.9 13.9c-3.4 5.9-10.9 7.8-16.7 4.3-12.6-7.8-24.5-16.1-35.4-24.9-10.9 8.7-22.7 17.1-35.4 24.9-5.8 3.5-13.3 1.6-16.7-4.3l-7.9-13.9c-3.2-5.6-1.4-12.8 4.2-16.2 9.3-5.7 18-11.7 26.1-18-7.9-8.4-14.9-17-21-25.7-4-5.7-2.2-13.6 3.7-17.1l6.5-3.9 7.3-4.3c5.4-3.2 12.4-1.7 16 3.4 5 7 10.8 14 17.4 20.9 13.5-14.2 23.8-28.9 30-43.2H412c-6.6 0-12-5.4-12-12v-16c0-6.6 5.4-12 12-12h64v-16c0-6.6 5.4-12 12-12h16c6.6 0 12 5.4 12 12v16h64c6.6 0 12 5.4 12 12zM0 120v272c0 13.3 10.7 24 24 24h280V96H24c-13.3 0-24 10.7-24 24zm58.9 216.1L116.4 167c1.7-4.9 6.2-8.1 11.4-8.1h32.5c5.1 0 9.7 3.3 11.4 8.1l57.5 169.1c2.6 7.8-3.1 15.9-11.4 15.9h-22.9a12 12 0 0 1-11.5-8.6l-9.4-31.9h-60.2l-9.1 31.8c-1.5 5.1-6.2 8.7-11.5 8.7H70.3c-8.2 0-14-8.1-11.4-15.9z"}}]})(e)}function Vt(e){return Et({tag:"svg",attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M96.06 454.35c.01 6.29 1.87 12.45 5.36 17.69l17.09 25.69a31.99 31.99 0 0 0 26.64 14.28h61.71a31.99 31.99 0 0 0 26.64-14.28l17.09-25.69a31.989 31.989 0 0 0 5.36-17.69l.04-38.35H96.01l.05 38.35zM0 176c0 44.37 16.45 84.85 43.56 115.78 16.52 18.85 42.36 58.23 52.21 91.45.04.26.07.52.11.78h160.24c.04-.26.07-.51.11-.78 9.85-33.22 35.69-72.6 52.21-91.45C335.55 260.85 352 220.37 352 176 352 78.61 272.91-.3 175.45 0 73.44.31 0 82.97 0 176zm176-80c-44.11 0-80 35.89-80 80 0 8.84-7.16 16-16 16s-16-7.16-16-16c0-61.76 50.24-112 112-112 8.84 0 16 7.16 16 16s-7.16 16-16 16z"}}]})(e)}function qt(e){return Et({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M80 368H16a16 16 0 0 0-16 16v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16v-64a16 16 0 0 0-16-16zm0-320H16A16 16 0 0 0 0 64v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16V64a16 16 0 0 0-16-16zm0 160H16a16 16 0 0 0-16 16v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16v-64a16 16 0 0 0-16-16zm416 176H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z"}}]})(e)}function Gt(e){return Et({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M224 96l16-32 32-16-32-16-16-32-16 32-32 16 32 16 16 32zM80 160l26.66-53.33L160 80l-53.34-26.67L80 0 53.34 53.33 0 80l53.34 26.67L80 160zm352 128l-26.66 53.33L352 368l53.34 26.67L432 448l26.66-53.33L512 368l-53.34-26.67L432 288zm70.62-193.77L417.77 9.38C411.53 3.12 403.34 0 395.15 0c-8.19 0-16.38 3.12-22.63 9.38L9.38 372.52c-12.5 12.5-12.5 32.76 0 45.25l84.85 84.85c6.25 6.25 14.44 9.37 22.62 9.37 8.19 0 16.38-3.12 22.63-9.37l363.14-363.15c12.5-12.48 12.5-32.75 0-45.24zM359.45 203.46l-50.91-50.91 86.6-86.6 50.91 50.91-86.6 86.6z"}}]})(e)}function Ht(e){return Et({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M290.74 93.24l128.02 128.02-277.99 277.99-114.14 12.6C11.35 513.54-1.56 500.62.14 485.34l12.7-114.22 277.9-277.88zm207.2-19.06l-60.11-60.11c-18.75-18.75-49.16-18.75-67.91 0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.76 18.75-49.16 0-67.91z"}}]})(e)}function Kt(e){return Et({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(e)}function Yt(e){return Et({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M32,224H64V416H32A31.96166,31.96166,0,0,1,0,384V256A31.96166,31.96166,0,0,1,32,224Zm512-48V448a64.06328,64.06328,0,0,1-64,64H160a64.06328,64.06328,0,0,1-64-64V176a79.974,79.974,0,0,1,80-80H288V32a32,32,0,0,1,64,0V96H464A79.974,79.974,0,0,1,544,176ZM264,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,264,256Zm-8,128H192v32h64Zm96,0H288v32h64ZM456,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,456,256Zm-8,128H384v32h64ZM640,256V384a31.96166,31.96166,0,0,1-32,32H576V224h32A31.96166,31.96166,0,0,1,640,256Z"}}]})(e)}function Qt(e){return Et({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"}}]})(e)}function Jt(e){return Et({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M440.65 12.57l4 82.77A247.16 247.16 0 0 0 255.83 8C134.73 8 33.91 94.92 12.29 209.82A12 12 0 0 0 24.09 224h49.05a12 12 0 0 0 11.67-9.26 175.91 175.91 0 0 1 317-56.94l-101.46-4.86a12 12 0 0 0-12.57 12v47.41a12 12 0 0 0 12 12H500a12 12 0 0 0 12-12V12a12 12 0 0 0-12-12h-47.37a12 12 0 0 0-11.98 12.57zM255.83 432a175.61 175.61 0 0 1-146-77.8l101.8 4.87a12 12 0 0 0 12.57-12v-47.4a12 12 0 0 0-12-12H12a12 12 0 0 0-12 12V500a12 12 0 0 0 12 12h47.35a12 12 0 0 0 12-12.6l-4.15-82.57A247.17 247.17 0 0 0 255.83 504c121.11 0 221.93-86.92 243.55-201.82a12 12 0 0 0-11.8-14.18h-49.05a12 12 0 0 0-11.67 9.26A175.86 175.86 0 0 1 255.83 432z"}}]})(e)}function Xt(e){return Et({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"}}]})(e)}function Zt(e){return Et({tag:"svg",attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"}}]})(e)}function en(e){return Et({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z"}}]})(e)}var tn=function(){return tn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},tn.apply(this,arguments)};const nn=function(e){var t=e.size,n=void 0===t?"medium":t,r=e.type,o=void 0===r?"spinner":r,i=e.color,s=void 0===i?"#3B82F6":i,l=e.text,c=e.fullScreen,u=void 0!==c&&c,d=e.overlay,f=void 0!==d&&d,p=e.inline,g=void 0!==p&&p,h={small:{container:"16px",fontSize:"12px",spacing:"8px"},medium:{container:"24px",fontSize:"14px",spacing:"12px"},large:{container:"32px",fontSize:"16px",spacing:"16px"}}[n],m={display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:h.spacing,zIndex:1e3};return u&&(m.position="fixed",m.top=0,m.left=0,m.right=0,m.bottom=0),f&&(m.position="absolute",m.top=0,m.left=0,m.right=0,m.bottom=0,m.backgroundColor="rgba(255, 255, 255, 0.8)"),g&&(m.display="inline-flex",m.flexDirection="row",m.marginLeft="8px",m.marginRight="8px"),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("style",{children:["\n    @keyframes spin {\n      0% { transform: rotate(0deg); }\n      100% { transform: rotate(360deg); }\n    }\n  ","\n    @keyframes pulse {\n      0%, 100% { opacity: 1; transform: scale(1); }\n      50% { opacity: 0.5; transform: scale(0.8); }\n    }\n  ","\n    @keyframes dots1 {\n      0%, 80%, 100% { transform: scale(0); }\n      40% { transform: scale(1); }\n    }\n    @keyframes dots2 {\n      0%, 80%, 100% { transform: scale(0); }\n      40% { transform: scale(1); }\n      animation-delay: 0.2s;\n    }\n    @keyframes dots3 {\n      0%, 80%, 100% { transform: scale(0); }\n      40% { transform: scale(1); }\n      animation-delay: 0.4s;\n    }\n  "]}),(0,a.jsxs)("div",tn({style:m},{children:[function(){switch(o){case"spinner":return(0,a.jsx)("div",{style:{width:h.container,height:h.container,border:"2px solid ".concat(s),borderTopColor:"transparent",borderRadius:"50%",animation:"spin 0.8s linear infinite"}});case"pulse":return(0,a.jsx)("div",{style:{width:h.container,height:h.container,backgroundColor:s,borderRadius:"50%",animation:"pulse 1.2s ease-in-out infinite"}});case"dots":return(0,a.jsx)("div",tn({style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"}},{children:[1,2,3].map((function(e){return(0,a.jsx)("div",{style:{width:"calc(".concat(h.container," / 3)"),height:"calc(".concat(h.container," / 3)"),backgroundColor:s,borderRadius:"50%",animation:"dots".concat(e," 1.4s infinite ease-in-out both"),animationDelay:"".concat(.2*(e-1),"s")}},e)}))}));default:return null}}(),l&&(0,a.jsx)("div",tn({style:{color:s,fontSize:h.fontSize,fontWeight:500,textAlign:"center"}},{children:l}))]}))]})};var rn=function(){return rn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},rn.apply(this,arguments)};const on=function(e){var t=e.content,n=e.isEditable,r=void 0!==n&&n,o=e.onEditClick;return(0,a.jsxs)("div",rn({className:"grammar-card-container",style:{position:"relative"},onClick:function(e){e.stopPropagation()}},{children:[(0,a.jsx)("div",{className:"grammar-card grammar-reference",dangerouslySetInnerHTML:{__html:t||""},onClick:function(e){e.stopPropagation()}}),r&&o&&(0,a.jsxs)("button",rn({onClick:function(e){e.stopPropagation(),o()},style:{position:"absolute",top:"8px",right:"8px",background:"rgba(255, 255, 255, 0.8)",border:"1px solid #E5E7EB",color:"#3B82F6",fontSize:"12px",padding:"4px 8px",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",borderRadius:"4px",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"}},{children:[(0,a.jsx)(Lt,{size:12}),"Edit"]}))]}))};var an=function(){return an=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},an.apply(this,arguments)},sn=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))};const ln=function(e){var t=e.front,n=e.back,o=e.translation,i=e.examples,s=e.imageUrl,l=e.image,c=e.linguisticInfo,u=e.transcription,d=e.onNewImage,f=e.onNewExamples,p=e.onAccept,g=e.onViewSavedCards,h=e.onCancel,m=e.mode,y=void 0===m?_.LanguageLearning:m,x=e.loadingNewImage,v=e.loadingNewExamples,b=e.loadingAccept,w=e.loadingGetResult,S=void 0!==w&&w,C=(e.shouldGenerateImage,e.isSaved),E=void 0!==C&&C,k=(e.isEdited,e.isGeneratingCard),I=e.setTranslation,A=e.setBack,F=e.setExamples,T=e.setLinguisticInfo,j=e.hideActionButtons,O=void 0!==j&&j,P=(0,r.useState)(!1),R=P[0],N=P[1],L=(0,r.useState)(o||""),B=L[0],z=L[1],D=(0,r.useState)(!1),M=D[0],U=D[1],$=(0,r.useState)(n||""),W=$[0],V=$[1],q=(0,r.useState)(!1),G=q[0],H=q[1],K=(0,r.useState)(!0),Y=(K[0],K[1],(0,r.useState)(!0)),Q=Y[0],J=Y[1];(0,r.useEffect)((function(){z(o||"")}),[o]),(0,r.useEffect)((function(){V(n||"")}),[n]),(0,r.useEffect)((function(){we(c||"")}),[c]);var X,Z,ee=function(){H(!0)},te=function(){if(R&&I&&(I(B),N(!1)),M&&A&&(A(W),U(!1)),null!==ue&&F){var e=sn([],i,!0);e[ue]=[pe,he],F(e),de(null)}ye&&T&&(T(be),xe(!1)),E&&p(),H(!1)},ne=function(){G&&(N(!0),z(o||""))},re=function(){I&&I(B),N(!1)},oe=function(){G&&(U(!0),V(n||""))},ae=function(){A&&A(W),U(!1)},ie=function(e,t,n){if(G&&F&&i){var r=sn([],i,!0);t?r[e][0]=n:r[e][1]=n||null,F(r)}},se=(0,r.useState)(!1),le=(se[0],se[1],(0,r.useState)(o||"")),ce=(le[0],le[1],(0,r.useState)(null)),ue=ce[0],de=ce[1],fe=(0,r.useState)(""),pe=fe[0],ge=(fe[1],(0,r.useState)("")),he=ge[0],me=(ge[1],(0,r.useState)(!1)),ye=me[0],xe=me[1],ve=(0,r.useState)(c||""),be=ve[0],we=ve[1];return(0,a.jsxs)("div",an({style:{padding:"16px",borderRadius:"8px",width:"100%",maxWidth:"100%",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",overflowX:"hidden",backgroundColor:G?"#FAFAFA":"#ffffff",borderLeft:G?"3px solid #3B82F6":"3px solid transparent"}},{children:[(0,a.jsxs)("div",an({style:{fontSize:"10px",color:"#9CA3AF",marginBottom:"12px",textAlign:"right",display:"flex",justifyContent:"flex-end",alignItems:"center",gap:"4px",padding:"4px 8px",backgroundColor:G?"#EFF6FF":E?"#ECFDF5":"#F9FAFB",borderRadius:"4px",border:G?"1px solid #DBEAFE":E?"1px solid #D1FAE5":"1px solid #F3F4F6"}},{children:[(0,a.jsx)("span",{style:{display:"inline-block",width:"8px",height:"8px",borderRadius:"50%",backgroundColor:G?"#3B82F6":E?"#10B981":"#6B7280"}}),(0,a.jsx)("strong",an({style:{color:G?"#1E40AF":E?"#059669":"#4B5563"}},{children:G?"Editing":E?"Saved to Collection":"New - Not Saved Yet"}))]})),G?(0,a.jsxs)("button",an({onClick:te,disabled:b,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",backgroundColor:"#3B82F6",color:"white",border:"none",borderRadius:"6px",padding:"10px 12px",fontSize:"14px",fontWeight:"600",cursor:"pointer",marginBottom:"12px",width:"100%",opacity:b?.7:1},onMouseOver:function(e){return!b&&(e.currentTarget.style.backgroundColor="#2563EB")},onMouseOut:function(e){return!b&&(e.currentTarget.style.backgroundColor="#3B82F6")}},{children:[(0,a.jsx)(Qt,{size:14}),b?(0,a.jsx)("div",an({style:{display:"flex",alignItems:"center",justifyContent:"center"}},{children:(0,a.jsx)(nn,{type:"spinner",size:"small",inline:!0,color:"#ffffff",text:"Saving"})})):E?"Save & Finish Editing":"Finish Editing"]})):G?null:(0,a.jsxs)("button",an({onClick:ee,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",backgroundColor:"#F3F4F6",color:"#4B5563",border:"1px solid #E5E7EB",borderRadius:"6px",padding:"10px 12px",fontSize:"14px",fontWeight:"600",cursor:"pointer",marginBottom:"12px",width:"100%"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#E5E7EB",e.currentTarget.style.color="#1F2937"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.color="#4B5563"}},{children:[(0,a.jsx)(Lt,{size:14}),"Edit Card"]})),G?(0,a.jsxs)("div",an({style:{marginBottom:"16px",backgroundColor:"#EFF6FF",borderRadius:"6px",padding:"10px",border:"1px solid #DBEAFE",fontSize:"13px",color:"#1E40AF"}},{children:[(0,a.jsxs)("div",an({style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"6px",fontWeight:"600"}},{children:[(0,a.jsx)(Lt,{size:12}),"Editing Mode"]})),(0,a.jsxs)("p",an({style:{margin:0,fontSize:"12px"}},{children:['Click on text elements to edit them. When finished, click "',E?"Save & Finish Editing":"Finish Editing",'" at the top of the card.']}))]})):null,t&&(0,a.jsx)("div",an({style:{marginBottom:"12px"}},{children:t.includes("/")?function(){var e,n=t.split(/\s*\//),r=(null===(e=n[0])||void 0===e?void 0:e.trim())||"",o=n.length>1?"/".concat(n.slice(1).join("/").replace(/\/$/,"")):"";return(0,a.jsxs)("div",an({style:{textAlign:"center",padding:"12px",backgroundColor:"#F3F4F6",borderRadius:"8px"}},{children:[(0,a.jsx)("h3",an({style:{fontSize:"20px",fontWeight:"700",margin:"0 0 6px 0",color:"#111827"}},{children:r})),o&&(0,a.jsx)("div",an({style:{fontSize:"14px",color:"#6B7280",fontStyle:"italic"}},{children:o}))]}))}():(0,a.jsx)("h3",an({style:{fontSize:"18px",fontWeight:"600",textAlign:"center",margin:"2px 0",color:"#111827",padding:"10px",backgroundColor:"#F3F4F6",borderRadius:"8px"}},{children:t}))})),u&&(0,a.jsx)("div",an({style:{marginBottom:"12px",textAlign:"center",padding:"8px 12px",backgroundColor:"#F8FAFC",border:"1px solid #E2E8F0",borderRadius:"6px"}},{children:(0,a.jsx)("div",{style:{fontSize:"14px",lineHeight:"1.6",color:"#475569"},dangerouslySetInnerHTML:{__html:u}})})),(y===_.LanguageLearning?o:n)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("hr",{style:{margin:"10px 0",border:"none",borderTop:"1px solid #E5E7EB"}}),(y===_.LanguageLearning?R:M)&&G?(0,a.jsxs)("div",an({style:{marginBottom:"12px",position:"relative"}},{children:[y===_.LanguageLearning?(0,a.jsx)("input",{type:"text",value:B,onChange:function(e){return z(e.target.value)},style:{width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #3B82F6",backgroundColor:"#ffffff",color:"#111827",fontSize:"14px",outline:"none",fontWeight:"600",textAlign:"center"},autoFocus:!0,onBlur:re,onKeyDown:function(e){"Enter"===e.key&&re()}}):(0,a.jsx)("textarea",{value:W,onChange:function(e){return V(e.target.value)},style:{width:"100%",minHeight:"120px",padding:"12px",borderRadius:"6px",border:"1px solid #3B82F6",backgroundColor:"#ffffff",color:"#111827",fontSize:"14px",outline:"none",fontWeight:"400",lineHeight:"1.5",resize:"vertical"},autoFocus:!0,onBlur:ae,onKeyDown:function(e){"Enter"===e.key&&e.ctrlKey&&ae()}}),(0,a.jsx)("div",an({style:{fontSize:"11px",color:"#6B7280",textAlign:"center",marginTop:"4px"}},{children:y===_.LanguageLearning?"Press Enter or click outside to save":"Press Ctrl+Enter or click outside to save"}))]})):(0,a.jsxs)("div",an({style:an({marginBottom:"12px",textAlign:y===_.LanguageLearning?"center":"left",position:"relative",paddingRight:G?"24px":"0"},G?{padding:"8px",border:"1px dashed #E5E7EB",borderRadius:"4px",transition:"all 0.2s ease",cursor:"pointer",backgroundColor:"#FAFAFA"}:{}),onClick:G?y===_.LanguageLearning?ne:oe:void 0,onMouseOver:function(e){G&&(e.currentTarget.style.borderColor="#3B82F6",e.currentTarget.style.backgroundColor="#F9FAFB")},onMouseOut:function(e){G&&(e.currentTarget.style.borderColor="#E5E7EB",e.currentTarget.style.backgroundColor="#FAFAFA")}},{children:[y===_.LanguageLearning?(0,a.jsx)("p",an({style:{fontWeight:"600",color:"#111827",fontSize:"14px",margin:0}},{children:o})):(0,a.jsx)("div",{style:{color:"#111827",fontSize:"14px",lineHeight:"1.6",margin:0,whiteSpace:"pre-wrap",wordWrap:"break-word"},dangerouslySetInnerHTML:{__html:(X=n||"",Z=X,Z=(Z=(Z=(Z=(Z=Z.replace(/!\[([^\]]*)\]\(([^)]+)\)/g,(function(e,t,n){var r=t&&"Изображение"!==t&&"Image"!==t?t:"";return'<div style="text-align: center; margin: 4px 0;">\n            <img src="'.concat(n,'" alt="').concat(r,'" style="max-width: 100%; height: auto; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); display: block; margin: 0 auto;" />\n            ').concat(r?'<div style="font-size: 11px; color: #6B7280; margin-top: 2px; font-style: italic;">'.concat(r,"</div>"):"","\n        </div>")}))).replace(/\$\$([^$]+)\$\$/g,(function(e,t){return'<div style="text-align: center; margin: 12px 0; padding: 8px; background: #F8FAFC; border-radius: 6px; font-family: serif;">\n            <strong>Формула:</strong> '.concat(t,"\n        </div>")}))).replace(/```(\w*)\n([\s\S]*?)\n```/g,(function(e,t,n){return'<div style="margin: 12px 0;">\n            <div style="background: #2D2D2D; color: #F8F8F2; padding: 12px; border-radius: 6px; font-family: monospace; overflow-x: auto; white-space: pre; font-size: 13px;">\n                '.concat(t?'<div style="color: #6B7280; margin-bottom: 8px; font-size: 11px;">'.concat(t,"</div>"):"","\n                ").concat(n,"\n            </div>\n        </div>")}))).replace(/`([^`]+)`/g,'<code style="background: #F3F4F6; padding: 2px 4px; border-radius: 3px; font-family: monospace; font-size: 13px;">$1</code>')).replace(/\n/g,"<br />"))}}),G&&(0,a.jsx)("button",an({onClick:function(e){e.stopPropagation(),y===_.LanguageLearning?ne():oe()},style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",background:"#F3F4F6",border:"none",borderRadius:"4px",cursor:"pointer",color:"#6B7280",display:"flex",padding:"4px",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},title:y===_.LanguageLearning?"Edit translation":"Edit content",onMouseOver:function(e){e.currentTarget.style.backgroundColor="#E5E7EB",e.currentTarget.style.color="#3B82F6"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.color="#6B7280"}},{children:(0,a.jsx)(Ht,{size:12})}))]}))]}),c&&(0,a.jsxs)("div",an({style:{marginTop:"12px",marginBottom:"16px",borderRadius:"10px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.05)",border:"1px solid",borderColor:Q?"#BFDBFE":"#E5E7EB",backgroundColor:Q?"#EFF6FF":"#F9FAFB",transition:"all 0.3s ease",overflow:"hidden"}},{children:[(0,a.jsxs)("div",an({style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",borderBottom:Q?"1px solid #BFDBFE":"none",transition:"background-color 0.2s"}},{children:[(0,a.jsxs)("div",an({style:{display:"flex",alignItems:"center",gap:"10px",fontWeight:600,fontSize:"14px",color:Q?"#1D4ED8":"#4B5563",flex:1}},{children:[(0,a.jsx)(Mt,{size:16,color:Q?"#2563EB":"#6B7280"}),(0,a.jsx)("span",{children:"Grammar & Linguistics"})]})),(0,a.jsx)("button",an({onClick:function(e){e.stopPropagation(),J(!Q)},style:{background:"none",border:"none",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px",transition:"background-color 0.2s"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="rgba(0,0,0,0.05)"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="transparent"}},{children:Q?(0,a.jsx)(Ot,{size:14,color:"#6B7280"}):(0,a.jsx)(Ft,{size:14,color:"#6B7280"})}))]})),Q&&(0,a.jsx)("div",an({style:{padding:"16px"}},{children:ye?(0,a.jsxs)("div",an({style:{width:"100%"}},{children:[(0,a.jsx)("textarea",{value:be,onChange:function(e){we(e.target.value)},style:{width:"100%",minHeight:"120px",padding:"10px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",fontSize:"14px",lineHeight:"1.5",resize:"vertical",marginBottom:"8px"}}),(0,a.jsxs)("div",an({style:{display:"flex",justifyContent:"flex-end",gap:"8px"}},{children:[(0,a.jsx)("button",an({onClick:function(){we(c||""),xe(!1)},style:{padding:"6px 12px",backgroundColor:"#F3F4F6",color:"#4B5563",border:"1px solid #E5E7EB",borderRadius:"6px",fontSize:"13px",cursor:"pointer"}},{children:"Cancel"})),(0,a.jsx)("button",an({onClick:function(){T&&T(be),xe(!1)},style:{padding:"6px 12px",backgroundColor:"#2563EB",color:"white",border:"none",borderRadius:"6px",fontSize:"13px",cursor:"pointer"}},{children:"Save"}))]}))]})):(0,a.jsx)("div",an({style:{position:"relative"}},{children:(0,a.jsx)(on,{content:c||"",isEditable:G,onEditClick:function(){return xe(!0)}})}))}))]})),i.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("hr",{style:{margin:"10px 0",border:"none",borderTop:"1px solid #E5E7EB"}}),(0,a.jsxs)("div",an({style:{marginBottom:"12px"}},{children:[(0,a.jsx)("div",an({style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"}},{children:(0,a.jsx)("h4",an({style:{fontSize:"14px",fontWeight:"600",color:"#374151",margin:0}},{children:"Examples"}))})),(0,a.jsx)("ul",an({style:{listStyle:"none",padding:0,margin:0,display:"flex",flexDirection:"column",gap:"8px"}},{children:i.map((function(e,t){var n=e[0],r=e[1];return(0,a.jsxs)("li",an({style:an({padding:"12px",backgroundColor:"#F9FAFB",borderRadius:"6px",position:"relative",minHeight:"auto",wordWrap:"break-word",overflow:"visible"},G?{border:"1px dashed #CBD5E1",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"}:{})},{children:[G&&(0,a.jsx)("div",an({style:{position:"absolute",top:"8px",right:"8px",display:"flex",gap:"8px",zIndex:5}},{children:(0,a.jsxs)("button",an({onClick:function(){return function(e){if(G&&F&&i){var t=sn([],i,!0);t.splice(e,1),F(t)}}(t)},style:{background:"#FEE2E2",border:"none",borderRadius:"4px",cursor:"pointer",color:"#EF4444",padding:"4px 6px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"11px",fontWeight:"500"},title:"Delete example",onMouseOver:function(e){e.currentTarget.style.backgroundColor="#FECACA"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#FEE2E2"}},{children:[(0,a.jsx)(en,{size:10,style:{marginRight:"4px"}}),"Delete"]}))})),G?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",an({style:{marginBottom:"8px"}},{children:(0,a.jsx)("textarea",{value:n,onChange:function(e){return ie(t,!0,e.target.value)},style:{width:"100%",padding:"6px 8px",borderRadius:"4px",border:"1px solid #E5E7EB",fontSize:"13px",color:"#111827",fontWeight:"500",backgroundColor:"#ffffff",minHeight:"40px",resize:"vertical",fontFamily:"inherit",lineHeight:"1.4"},placeholder:"Example sentence"})})),(0,a.jsx)("div",{children:(0,a.jsx)("textarea",{value:r||"",onChange:function(e){return ie(t,!1,e.target.value)},style:{width:"100%",padding:"6px 8px",borderRadius:"4px",border:"1px solid #E5E7EB",fontSize:"13px",color:"#6B7280",fontStyle:"italic",backgroundColor:"#ffffff",minHeight:"40px",resize:"vertical",fontFamily:"inherit",lineHeight:"1.4"},placeholder:"Translation (optional)"})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",an({style:{fontWeight:"500",color:"#111827",fontSize:"13px",marginBottom:r?"6px":0,lineHeight:"1.4",wordWrap:"break-word",overflow:"visible",whiteSpace:"normal"}},{children:n})),r&&(0,a.jsx)("div",an({style:{color:"#6B7280",fontSize:"13px",fontStyle:"italic",lineHeight:"1.4",wordWrap:"break-word",overflow:"visible",whiteSpace:"normal"}},{children:r}))]})]}),t)}))})),G&&(0,a.jsxs)("button",an({onClick:function(){if(G&&F&&i){var e=sn([],i,!0);e.push(["",null]),F(e)}},style:{width:"100%",padding:"10px",borderRadius:"6px",backgroundColor:"#EFF6FF",color:"#3B82F6",fontSize:"14px",fontWeight:"500",border:"1px dashed #BFDBFE",cursor:"pointer",marginTop:"12px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"all 0.2s ease"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#DBEAFE",e.currentTarget.style.borderColor="#93C5FD"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#EFF6FF",e.currentTarget.style.borderColor="#BFDBFE"}},{children:[(0,a.jsx)(Kt,{size:12}),"Add Example"]}))]}))]}),(l||s)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("hr",{style:{margin:"16px 0",border:"none",borderTop:"1px solid #E5E7EB"}}),(0,a.jsx)("div",an({style:{marginBottom:"16px"}},{children:(0,a.jsx)("img",{src:l||s||"",alt:"",style:{width:"100%",borderRadius:"6px",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)"}})}))]}),!E&&(0,a.jsxs)("div",an({style:{display:"flex",gap:"6px",marginBottom:"8px"}},{children:[(l||s)&&(0,a.jsx)("button",an({onClick:d,disabled:x,style:{flex:1,padding:"8px 12px",borderRadius:"6px",backgroundColor:"#F59E0B",color:"#ffffff",fontWeight:"600",fontSize:"13px",border:"none",cursor:"pointer",transition:"all 0.2s ease",opacity:x?.7:1},onMouseOver:function(e){return!x&&(e.currentTarget.style.backgroundColor="#D97706")},onMouseOut:function(e){return!x&&(e.currentTarget.style.backgroundColor="#F59E0B")}},{children:x?(0,a.jsx)("div",an({style:{display:"flex",alignItems:"center",justifyContent:"center"}},{children:(0,a.jsx)(nn,{type:"spinner",size:"small",inline:!0,color:"#ffffff",text:"Generating"})})):"New Image"})),i.length>0&&(0,a.jsx)("button",an({onClick:f,disabled:v,style:{flex:1,padding:"8px 12px",borderRadius:"6px",backgroundColor:"#F59E0B",color:"#ffffff",fontWeight:"600",fontSize:"13px",border:"none",cursor:"pointer",transition:"all 0.2s ease",opacity:v?.7:1},onMouseOver:function(e){return!v&&(e.currentTarget.style.backgroundColor="#D97706")},onMouseOut:function(e){return!v&&(e.currentTarget.style.backgroundColor="#F59E0B")}},{children:v?(0,a.jsx)("div",an({style:{display:"flex",alignItems:"center",justifyContent:"center"}},{children:(0,a.jsx)(nn,{type:"spinner",size:"small",inline:!0,color:"#ffffff",text:"Loading"})})):"New Examples"}))]})),!O&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",an({style:{marginBottom:"10px"}},{children:[!G&&(!E||k||S)&&(0,a.jsxs)("div",an({style:{display:"flex",gap:"8px",width:"100%"}},{children:[(0,a.jsxs)("button",an({onClick:h,disabled:b,style:{flex:"1",padding:"10px",borderRadius:"6px",backgroundColor:"#F3F4F6",color:"#4B5563",fontWeight:"600",fontSize:"14px",border:"1px solid #E5E7EB",cursor:b?"not-allowed":"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",opacity:b?.7:1},onMouseOver:function(e){b||(e.currentTarget.style.backgroundColor="#E5E7EB",e.currentTarget.style.color="#374151")},onMouseOut:function(e){b||(e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.color="#4B5563")}},{children:[(0,a.jsx)(Zt,{}),k||S?"Cancel Generation":"Cancel"]})),!k&&!S&&(0,a.jsxs)("button",an({onClick:p,disabled:b,style:{flex:"2",padding:"10px",borderRadius:"6px",backgroundColor:"#22C55E",color:"#ffffff",fontWeight:"600",fontSize:"14px",border:"none",cursor:"pointer",transition:"all 0.2s ease",opacity:b?.7:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},onMouseOver:function(e){return!b&&(e.currentTarget.style.backgroundColor="#15803D")},onMouseOut:function(e){return!b&&(e.currentTarget.style.backgroundColor="#22C55E")}},{children:[(0,a.jsx)(_t,{}),b?(0,a.jsx)("div",an({style:{display:"flex",alignItems:"center",justifyContent:"center"}},{children:(0,a.jsx)(nn,{type:"spinner",size:"small",inline:!0,color:"#ffffff",text:"Saving"})})):"Save Card"]}))]})),!G&&E&&(0,a.jsxs)("div",an({style:{width:"100%",padding:"10px",borderRadius:"6px",backgroundColor:"#ECFDF5",border:"1px solid #D1FAE5",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"}},{children:[(0,a.jsx)("div",an({style:{display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",borderRadius:"50%",backgroundColor:"#10B981",color:"white"}},{children:(0,a.jsx)(_t,{size:12})})),(0,a.jsx)("span",an({style:{fontWeight:"600",fontSize:"14px",color:"#059669"}},{children:"Saved to Collection"}))]})),!G&&!E&&(0,a.jsx)("p",an({style:{fontSize:"11px",color:"#6B7280",textAlign:"center",margin:"4px 0 0 0"}},{children:"The card will be saved to your collection"}))]})),(0,a.jsxs)("button",an({onClick:g,style:{width:"100%",padding:"10px",borderRadius:"6px",backgroundColor:"#4B5563",color:"#ffffff",fontWeight:"600",fontSize:"13px",border:"none",cursor:"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="#374151"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="#4B5563"}},{children:[(0,a.jsx)(qt,{size:14}),"View Saved Cards"]}))]})]}))},cn="RFC3986",un={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:e=>String(e)},dn=(Object.prototype.hasOwnProperty,Array.isArray),fn=(()=>{const e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();const pn=1024;function gn(e,t){if(dn(e)){const n=[];for(let r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)}const hn=Object.prototype.hasOwnProperty,mn={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},yn=Array.isArray,xn=Array.prototype.push,vn=function(e,t){xn.apply(e,yn(t)?t:[t])},bn=Date.prototype.toISOString,wn={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,n,r,o)=>{if(0===e.length)return e;let a=e;if("symbol"==typeof e?a=Symbol.prototype.toString.call(e):"string"!=typeof e&&(a=String(e)),"iso-8859-1"===n)return escape(a).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));let i="";for(let e=0;e<a.length;e+=pn){const t=a.length>=pn?a.slice(e,e+pn):a,n=[];for(let e=0;e<t.length;++e){let r=t.charCodeAt(e);45===r||46===r||95===r||126===r||r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122||"RFC1738"===o&&(40===r||41===r)?n[n.length]=t.charAt(e):r<128?n[n.length]=fn[r]:r<2048?n[n.length]=fn[192|r>>6]+fn[128|63&r]:r<55296||r>=57344?n[n.length]=fn[224|r>>12]+fn[128|r>>6&63]+fn[128|63&r]:(e+=1,r=65536+((1023&r)<<10|1023&t.charCodeAt(e)),n[n.length]=fn[240|r>>18]+fn[128|r>>12&63]+fn[128|r>>6&63]+fn[128|63&r])}i+=n.join("")}return i},encodeValuesOnly:!1,format:cn,formatter:un[cn],indices:!1,serializeDate:e=>bn.call(e),skipNulls:!1,strictNullHandling:!1};const Sn={};function Cn(e,t,n,r,o,a,i,s,l,c,u,d,f,p,g,h,m,y){let x=e,v=y,b=0,w=!1;for(;void 0!==(v=v.get(Sn))&&!w;){const t=v.get(e);if(b+=1,void 0!==t){if(t===b)throw new RangeError("Cyclic object value");w=!0}void 0===v.get(Sn)&&(b=0)}if("function"==typeof c?x=c(t,x):x instanceof Date?x=f?.(x):"comma"===n&&yn(x)&&(x=gn(x,(function(e){return e instanceof Date?f?.(e):e}))),null===x){if(a)return l&&!h?l(t,wn.encoder,m,"key",p):t;x=""}if("string"==typeof(S=x)||"number"==typeof S||"boolean"==typeof S||"symbol"==typeof S||"bigint"==typeof S||function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))}(x)){if(l){const e=h?t:l(t,wn.encoder,m,"key",p);return[g?.(e)+"="+g?.(l(x,wn.encoder,m,"value",p))]}return[g?.(t)+"="+g?.(String(x))]}var S;const C=[];if(void 0===x)return C;let E;if("comma"===n&&yn(x))h&&l&&(x=gn(x,l)),E=[{value:x.length>0?x.join(",")||null:void 0}];else if(yn(c))E=c;else{const e=Object.keys(x);E=u?e.sort(u):e}const k=s?String(t).replace(/\./g,"%2E"):String(t),I=r&&yn(x)&&1===x.length?k+"[]":k;if(o&&yn(x)&&0===x.length)return I+"[]";for(let t=0;t<E.length;++t){const v=E[t],w="object"==typeof v&&void 0!==v.value?v.value:x[v];if(i&&null===w)continue;const S=d&&s?v.replace(/\./g,"%2E"):v,k=yn(x)?"function"==typeof n?n(I,S):I:I+(d?"."+S:"["+S+"]");y.set(e,b);const A=new WeakMap;A.set(Sn,y),vn(C,Cn(w,k,n,r,o,a,i,s,"comma"===n&&h&&yn(x)?null:l,c,u,d,f,p,g,h,m,A))}return C}function En(e,t={}){let n=e;const r=function(e=wn){if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");const t=e.charset||wn.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=cn;if(void 0!==e.format){if(!hn.call(un,e.format))throw new TypeError("Unknown format option provided.");n=e.format}const r=un[n];let o,a=wn.filter;if(("function"==typeof e.filter||yn(e.filter))&&(a=e.filter),o=e.arrayFormat&&e.arrayFormat in mn?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":wn.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const i=void 0===e.allowDots?1==!!e.encodeDotInKeys||wn.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:wn.addQueryPrefix,allowDots:i,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:wn.allowEmptyArrays,arrayFormat:o,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:wn.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?wn.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:wn.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:wn.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:wn.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:wn.encodeValuesOnly,filter:a,format:n,formatter:r,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:wn.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:wn.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:wn.strictNullHandling}}(t);let o,a;"function"==typeof r.filter?(a=r.filter,n=a("",n)):yn(r.filter)&&(a=r.filter,o=a);const i=[];if("object"!=typeof n||null===n)return"";const s=mn[r.arrayFormat],l="comma"===s&&r.commaRoundTrip;o||(o=Object.keys(n)),r.sort&&o.sort(r.sort);const c=new WeakMap;for(let e=0;e<o.length;++e){const t=o[e];r.skipNulls&&null===n[t]||vn(i,Cn(n[t],t,s,l,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,c))}const u=i.join(r.delimiter);let d=!0===r.addQueryPrefix?"?":"";return r.charsetSentinel&&("iso-8859-1"===r.charset?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),u.length>0?d+u:""}const kn="4.100.0";let In,An,_n,Fn,Tn,jn,On,Pn,Rn,Nn=!1,Ln=null,Bn=null,zn=null,Dn=null;class Mn{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}const Un=()=>{In||function(e,t={auto:!1}){if(Nn)throw new Error(`you must \`import 'openai/shims/${e.kind}'\` before importing anything else from openai`);if(In)throw new Error(`can't \`import 'openai/shims/${e.kind}'\` after \`import 'openai/shims/${In}'\``);Nn=t.auto,In=e.kind,An=e.fetch,Ln=e.Request,Bn=e.Response,zn=e.Headers,_n=e.FormData,Dn=e.Blob,Fn=e.File,Tn=e.ReadableStream,jn=e.getMultipartRequestOptions,On=e.getDefaultAgent,Pn=e.fileFromPath,Rn=e.isFsReadStream}(function({manuallyImported:e}={}){const t=e?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let n,r,o,a;try{n=fetch,r=Request,o=Response,a=Headers}catch(e){throw new Error(`this environment is missing the following Web Fetch API type: ${e.message}. ${t}`)}return{kind:"web",fetch:n,Request:r,Response:o,Headers:a,FormData:"undefined"!=typeof FormData?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${t}`)}},Blob:"undefined"!=typeof Blob?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${t}`)}},File:"undefined"!=typeof File?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${t}`)}},ReadableStream:"undefined"!=typeof ReadableStream?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${t}`)}},getMultipartRequestOptions:async(e,t)=>({...t,body:new Mn(e)}),getDefaultAgent:e=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:e=>!1}}(),{auto:!0})};Un();class $n extends Error{}class Wn extends $n{constructor(e,t,n,r){super(`${Wn.makeMessage(e,t,n)}`),this.status=e,this.headers=r,this.request_id=r?.["x-request-id"],this.error=t;const o=t;this.code=o?.code,this.param=o?.param,this.type=o?.type}static makeMessage(e,t,n){const r=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,n,r){if(!e||!r)return new qn({message:n,cause:qr(t)});const o=t?.error;return 400===e?new Hn(e,o,n,r):401===e?new Kn(e,o,n,r):403===e?new Yn(e,o,n,r):404===e?new Qn(e,o,n,r):409===e?new Jn(e,o,n,r):422===e?new Xn(e,o,n,r):429===e?new Zn(e,o,n,r):e>=500?new er(e,o,n,r):new Wn(e,o,n,r)}}class Vn extends Wn{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class qn extends Wn{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class Gn extends qn{constructor({message:e}={}){super({message:e??"Request timed out."})}}class Hn extends Wn{}class Kn extends Wn{}class Yn extends Wn{}class Qn extends Wn{}class Jn extends Wn{}class Xn extends Wn{}class Zn extends Wn{}class er extends Wn{}class tr extends $n{constructor(){super("Could not parse response content as the length limit was reached")}}class nr extends $n{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var rr,or=function(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,n):o?o.value=n:t.set(e,n),n},ar=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class ir{constructor(){rr.set(this,void 0),this.buffer=new Uint8Array,or(this,rr,null,"f")}decode(e){if(null==e)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?(new TextEncoder).encode(e):e;let n=new Uint8Array(this.buffer.length+t.length);n.set(this.buffer),n.set(t,this.buffer.length),this.buffer=n;const r=[];let o;for(;null!=(o=sr(this.buffer,ar(this,rr,"f")));){if(o.carriage&&null==ar(this,rr,"f")){or(this,rr,o.index,"f");continue}if(null!=ar(this,rr,"f")&&(o.index!==ar(this,rr,"f")+1||o.carriage)){r.push(this.decodeText(this.buffer.slice(0,ar(this,rr,"f")-1))),this.buffer=this.buffer.slice(ar(this,rr,"f")),or(this,rr,null,"f");continue}const e=null!==ar(this,rr,"f")?o.preceding-1:o.preceding,t=this.decodeText(this.buffer.slice(0,e));r.push(t),this.buffer=this.buffer.slice(o.index),or(this,rr,null,"f")}return r}decodeText(e){if(null==e)return"";if("string"==typeof e)return e;if("undefined"!=typeof Buffer){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new $n(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new $n(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new $n("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode("\n"):[]}}function sr(e,t){for(let n=t??0;n<e.length;n++){if(10===e[n])return{preceding:n,index:n+1,carriage:!1};if(13===e[n])return{preceding:n,index:n+1,carriage:!0}}return null}function lr(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1])return t+2;if(13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return-1}function cr(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}rr=new WeakMap,ir.NEWLINE_CHARS=new Set(["\n","\r"]),ir.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class ur{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;return new ur((async function*(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let r=!1;try{for await(const n of async function*(e,t){if(!e.body)throw t.abort(),new $n("Attempted to iterate over a response with no body");const n=new dr,r=new ir,o=cr(e.body);for await(const e of async function*(e){let t=new Uint8Array;for await(const n of e){if(null==n)continue;const e=n instanceof ArrayBuffer?new Uint8Array(n):"string"==typeof n?(new TextEncoder).encode(n):n;let r,o=new Uint8Array(t.length+e.length);for(o.set(t),o.set(e,t.length),t=o;-1!==(r=lr(t));)yield t.slice(0,r),t=t.slice(r)}t.length>0&&(yield t)}(o))for(const t of r.decode(e)){const e=n.decode(t);e&&(yield e)}for(const e of r.flush()){const t=n.decode(e);t&&(yield t)}}(e,t))if(!r)if(n.data.startsWith("[DONE]"))r=!0;else if(null===n.event||n.event.startsWith("response.")||n.event.startsWith("transcript.")){let t;try{t=JSON.parse(n.data)}catch(e){throw console.error("Could not parse message into JSON:",n.data),console.error("From chunk:",n.raw),e}if(t&&t.error)throw new Wn(void 0,t.error,void 0,Or(e.headers));yield t}else{let e;try{e=JSON.parse(n.data)}catch(e){throw console.error("Could not parse message into JSON:",n.data),console.error("From chunk:",n.raw),e}if("error"==n.event)throw new Wn(void 0,e.error,e.message,void 0);yield{event:n.event,data:e}}r=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{r||t.abort()}}),t)}static fromReadableStream(e,t){let n=!1;return new ur((async function*(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let r=!1;try{for await(const t of async function*(){const t=new ir,n=cr(e);for await(const e of n)for(const n of t.decode(e))yield n;for(const e of t.flush())yield e}())r||t&&(yield JSON.parse(t));r=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{r||t.abort()}}),t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),r=r=>({next:()=>{if(0===r.length){const r=n.next();e.push(r),t.push(r)}return r.shift()}});return[new ur((()=>r(e)),this.controller),new ur((()=>r(t)),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new Tn({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{const{value:r,done:o}=await t.next();if(o)return e.close();const a=n.encode(JSON.stringify(r)+"\n");e.enqueue(a)}catch(t){e.error(t)}},async cancel(){await(t.return?.())}})}}class dr{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,r]=function(e,t){const n=e.indexOf(t);if(-1!==n)return[e.substring(0,n),t,e.substring(n+t.length)];return[e,"",""]}(e,":");return r.startsWith(" ")&&(r=r.substring(1)),"event"===t?this.event=r:"data"===t&&this.data.push(r),null}}const fr=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob,pr=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&gr(e),gr=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer,hr=e=>pr(e)||fr(e)||Rn(e);async function mr(e,t,n){if(e=await e,pr(e))return e;if(fr(e)){const r=await e.blob();t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()??"unknown_file");const o=gr(r)?[await r.arrayBuffer()]:[r];return new Fn(o,t,n)}const r=await async function(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(gr(e))t.push(await e.arrayBuffer());else{if(!xr(e))throw new Error(`Unexpected data type: ${typeof e}; constructor: ${e?.constructor?.name}; props: ${function(e){const t=Object.getOwnPropertyNames(e);return`[${t.map((e=>`"${e}"`)).join(", ")}]`}(e)}`);for await(const n of e)t.push(n)}return t}(e);if(t||(t=function(e){return yr(e.name)||yr(e.filename)||yr(e.path)?.split(/[\\/]/).pop()}(e)??"unknown_file"),!n?.type){const e=r[0]?.type;"string"==typeof e&&(n={...n,type:e})}return new Fn(r,t,n)}const yr=e=>"string"==typeof e?e:"undefined"!=typeof Buffer&&e instanceof Buffer?String(e):void 0,xr=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],vr=e=>e&&"object"==typeof e&&e.body&&"MultipartBody"===e[Symbol.toStringTag],br=async e=>{const t=await wr(e.body);return jn(t,e)},wr=async e=>{const t=new _n;return await Promise.all(Object.entries(e||{}).map((([e,n])=>Sr(t,e,n)))),t},Sr=async(e,t,n)=>{if(void 0!==n){if(null==n)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)e.append(t,String(n));else if(hr(n)){const r=await mr(n);e.append(t,r)}else if(Array.isArray(n))await Promise.all(n.map((n=>Sr(e,t+"[]",n))));else{if("object"!=typeof n)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`);await Promise.all(Object.entries(n).map((([n,r])=>Sr(e,`${t}[${n}]`,r))))}}};var Cr,Er=function(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,n):o?o.value=n:t.set(e,n),n},kr=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};async function Ir(e){const{response:t}=e;if(e.options.stream)return Jr("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):ur.fromSSEResponse(t,e.controller);if(204===t.status)return null;if(e.options.__binaryResponse)return t;const n=t.headers.get("content-type"),r=n?.split(";")[0]?.trim();if(r?.includes("application/json")||r?.endsWith("+json")){const e=await t.json();return Jr("response",t.status,t.url,t.headers,e),Ar(e,t)}const o=await t.text();return Jr("response",t.status,t.url,t.headers,o),o}function Ar(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}Un();class _r extends Promise{constructor(e,t=Ir){super((e=>{e(null)})),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new _r(this.responsePromise,(async t=>Ar(e(await this.parseResponse(t),t),t.response)))}asResponse(){return this.responsePromise.then((e=>e.response))}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class Fr{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:r,fetch:o}){this.baseURL=e,this.maxRetries=Vr("maxRetries",t),this.timeout=Vr("timeout",n),this.httpAgent=r,this.fetch=o??An}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Dr(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${Xr()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then((async n=>{const r=n&&gr(n?.body)?new DataView(await n.body.arrayBuffer()):n?.body instanceof DataView?n.body:n?.body instanceof ArrayBuffer?new DataView(n.body):n&&ArrayBuffer.isView(n?.body)?new DataView(n.body.buffer):n?.body;return{method:e,path:t,...n,body:r}})))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if("string"==typeof e){if("undefined"!=typeof Buffer)return Buffer.byteLength(e,"utf8").toString();if("undefined"!=typeof TextEncoder){return(new TextEncoder).encode(e).length.toString()}}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){const n={...e},{method:r,path:o,query:a,headers:i={}}=n,s=ArrayBuffer.isView(n.body)||n.__binaryRequest&&"string"==typeof n.body?n.body:vr(n.body)?n.body.body:n.body?JSON.stringify(n.body,null,2):null,l=this.calculateContentLength(s),c=this.buildURL(o,a);"timeout"in n&&Vr("timeout",n.timeout),n.timeout=n.timeout??this.timeout;const u=n.httpAgent??this.httpAgent??On(c),d=n.timeout+1e3;"number"==typeof u?.options?.timeout&&d>(u.options.timeout??0)&&(u.options.timeout=d),this.idempotencyHeader&&"get"!==r&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);return{req:{method:r,...s&&{body:s},headers:this.buildHeaders({options:n,headers:i,contentLength:l,retryCount:t}),...u&&{agent:u},signal:n.signal??null},url:c,timeout:n.timeout}}buildHeaders({options:e,headers:t,contentLength:n,retryCount:r}){const o={};n&&(o["content-length"]=n);const a=this.defaultHeaders(e);return Yr(o,a),Yr(o,t),vr(e.body)&&"node"!==In&&delete o["content-type"],void 0===Zr(a,"x-stainless-retry-count")&&void 0===Zr(t,"x-stainless-retry-count")&&(o["x-stainless-retry-count"]=String(r)),void 0===Zr(a,"x-stainless-timeout")&&void 0===Zr(t,"x-stainless-timeout")&&e.timeout&&(o["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(o,t),o}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map((e=>[...e]))):{...e}:{}}makeStatusError(e,t,n,r){return Wn.generate(e,t,n,r)}request(e,t=null){return new _r(this.makeRequest(e,t))}async makeRequest(e,t){const n=await e,r=n.maxRetries??this.maxRetries;null==t&&(t=r),await this.prepareOptions(n);const{req:o,url:a,timeout:i}=this.buildRequest(n,{retryCount:r-t});if(await this.prepareRequest(o,{url:a,options:n}),Jr("request",a,n,o.headers),n.signal?.aborted)throw new Vn;const s=new AbortController,l=await this.fetchWithTimeout(a,o,i,s).catch(qr);if(l instanceof Error){if(n.signal?.aborted)throw new Vn;if(t)return this.retryRequest(n,t);if("AbortError"===l.name)throw new Gn;throw new qn({cause:l})}const c=Or(l.headers);if(!l.ok){if(t&&this.shouldRetry(l)){return Jr(`response (error; ${`retrying, ${t} attempts remaining`})`,l.status,a,c),this.retryRequest(n,t,c)}const e=await l.text().catch((e=>qr(e).message)),r=Mr(e),o=r?void 0:e;Jr(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,l.status,a,c,o);throw this.makeStatusError(l.status,r,o,c)}return{response:l,options:n,controller:s}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new jr(this,n,e)}buildURL(e,t){const n=$r(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),r=this.defaultQuery();return Hr(r)||(t={...r,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter((([e,t])=>void 0!==t)).map((([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new $n(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)})).join("&")}async fetchWithTimeout(e,t,n,r){const{signal:o,...a}=t||{};o&&o.addEventListener("abort",(()=>r.abort()));const i=setTimeout((()=>r.abort()),n),s={signal:r.signal,...a};return s.method&&(s.method=s.method.toUpperCase()),this.fetch.call(void 0,e,s).finally((()=>{clearTimeout(i)}))}shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||(409===e.status||(429===e.status||e.status>=500)))}async retryRequest(e,t,n){let r;const o=n?.["retry-after-ms"];if(o){const e=parseFloat(o);Number.isNaN(e)||(r=e)}const a=n?.["retry-after"];if(a&&!r){const e=parseFloat(a);r=Number.isNaN(e)?Date.parse(a)-Date.now():1e3*e}if(!(r&&0<=r&&r<6e4)){const n=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,n)}return await Wr(r),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const n=t-e;return Math.min(.5*Math.pow(2,n),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS ${kn}`}}class Tr{constructor(e,t,n,r){Cr.set(this,void 0),Er(this,Cr,e,"f"),this.options=r,this.response=t,this.body=n}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageInfo()}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new $n("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&"object"==typeof t.query)t.query={...t.query,...e.params};else if("url"in e){const n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[t,r]of n)e.url.searchParams.set(t,r);t.query=void 0,t.path=e.url.toString()}return await kr(this,Cr,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Cr=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class jr extends _r{constructor(e,t,n){super(t,(async t=>new n(e,t.response,await Ir(t),t.options)))}async*[Symbol.asyncIterator](){const e=await(this);for await(const t of e)yield t}}const Or=e=>new Proxy(Object.fromEntries(e.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),Pr={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},Rr=e=>"object"==typeof e&&null!==e&&!Hr(e)&&Object.keys(e).every((e=>Kr(Pr,e))),Nr=()=>{if("undefined"!=typeof Deno&&null!=Deno.build)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":kn,"X-Stainless-OS":Br(Deno.build.os),"X-Stainless-Arch":Lr(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":kn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if("[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0))return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":kn,"X-Stainless-OS":Br(process.platform),"X-Stainless-Arch":Lr(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const e=function(){if("undefined"==typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:n}of e){const e=n.exec(navigator.userAgent);if(e){return{browser:t,version:`${e[1]||0}.${e[2]||0}.${e[3]||0}`}}}return null}();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":kn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":kn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};const Lr=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",Br=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";let zr;const Dr=()=>zr??(zr=Nr()),Mr=e=>{try{return JSON.parse(e)}catch(e){return}},Ur=/^[a-z][a-z0-9+.-]*:/i,$r=e=>Ur.test(e),Wr=e=>new Promise((t=>setTimeout(t,e))),Vr=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new $n(`${e} must be an integer`);if(t<0)throw new $n(`${e} must be a positive integer`);return t},qr=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e)try{return new Error(JSON.stringify(e))}catch{}return new Error(e)},Gr=e=>"undefined"!=typeof process?process.env?.[e]?.trim()??void 0:"undefined"!=typeof Deno?Deno.env?.get?.(e)?.trim():void 0;function Hr(e){if(!e)return!0;for(const t in e)return!1;return!0}function Kr(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Yr(e,t){for(const n in t){if(!Kr(t,n))continue;const r=n.toLowerCase();if(!r)continue;const o=t[n];null===o?delete e[r]:void 0!==o&&(e[r]=o)}}const Qr=new Set(["authorization","api-key"]);function Jr(e,...t){if("undefined"!=typeof process&&"true"===process?.env?.DEBUG){const n=t.map((e=>{if(!e)return e;if(e.headers){const t={...e,headers:{...e.headers}};for(const n in e.headers)Qr.has(n.toLowerCase())&&(t.headers[n]="REDACTED");return t}let t=null;for(const n in e)Qr.has(n.toLowerCase())&&(t??(t={...e}),t[n]="REDACTED");return t??e}));console.log(`OpenAI:DEBUG:${e}`,...n)}}const Xr=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),Zr=(e,t)=>{const n=t.toLowerCase();if((e=>"function"==typeof e?.get)(e)){const r=t[0]?.toUpperCase()+t.substring(1).replace(/([^\w])(\w)/g,((e,t,n)=>t+n.toUpperCase()));for(const o of[t,n,t.toUpperCase(),r]){const t=e.get(o);if(t)return t}}for(const[r,o]of Object.entries(e))if(r.toLowerCase()===n)return Array.isArray(o)?(o.length<=1||console.warn(`Received ${o.length} entries for the ${t} header, using the first entry.`),o[0]):o};function eo(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}class to{constructor(e){this._client=e}}class no extends to{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class ro extends to{list(e,t={},n){return Rr(t)?this.list(e,{},t):this._client.getAPIList(`/chat/completions/${e}/messages`,lo,{query:t,...n})}}class oo extends Tr{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class ao extends Tr{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){const e=this.getPaginatedItems();if(!e.length)return null;const t=e[e.length-1]?.id;return t?{params:{after:t}}:null}}class io extends to{constructor(){super(...arguments),this.messages=new ro(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return Rr(e)?this.list({},e):this._client.getAPIList("/chat/completions",so,{query:e,...t})}del(e,t){return this._client.delete(`/chat/completions/${e}`,t)}}class so extends ao{}class lo extends ao{}io.ChatCompletionsPage=so,io.Messages=ro;class co extends to{constructor(){super(...arguments),this.completions=new io(this._client)}}co.Completions=io,co.ChatCompletionsPage=so;class uo extends to{create(e,t){const n=!!e.encoding_format;let r=n?e.encoding_format:"base64";n&&Jr("Request","User defined encoding_format:",e.encoding_format);const o=this._client.post("/embeddings",{body:{...e,encoding_format:r},...t});return n?o:(Jr("response","Decoding base64 embeddings to float32 array"),o._thenUnwrap((e=>(e&&e.data&&e.data.forEach((e=>{const t=e.embedding;e.embedding=(e=>{if("undefined"!=typeof Buffer){const t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{const t=atob(e),n=t.length,r=new Uint8Array(n);for(let e=0;e<n;e++)r[e]=t.charCodeAt(e);return Array.from(new Float32Array(r.buffer))}})(t)})),e))))}}class fo extends to{create(e,t){return this._client.post("/files",br({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return Rr(e)?this.list({},e):this._client.getAPIList("/files",po,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t?.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=18e5}={}){const r=new Set(["processed","error","deleted"]),o=Date.now();let a=await this.retrieve(e);for(;!a.status||!r.has(a.status);)if(await Wr(t),a=await this.retrieve(e),Date.now()-o>n)throw new Gn({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return a}}class po extends ao{}fo.FileObjectsPage=po;class go extends to{createVariation(e,t){return this._client.post("/images/variations",br({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",br({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class ho extends to{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t?.headers},__binaryResponse:!0})}}class mo extends to{create(e,t){return this._client.post("/audio/transcriptions",br({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}}))}}class yo extends to{create(e,t){return this._client.post("/audio/translations",br({body:e,...t,__metadata:{model:e.model}}))}}class xo extends to{constructor(){super(...arguments),this.transcriptions=new mo(this._client),this.translations=new yo(this._client),this.speech=new ho(this._client)}}xo.Transcriptions=mo,xo.Translations=yo,xo.Speech=ho;class vo extends to{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class bo extends to{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",wo,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class wo extends oo{}bo.ModelsPage=wo;class So extends to{}class Co extends to{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}}class Eo extends to{constructor(){super(...arguments),this.graders=new Co(this._client)}}Eo.Graders=Co;class ko extends to{create(e,t,n){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,Io,{body:t,method:"post",...n})}retrieve(e,t={},n){return Rr(t)?this.retrieve(e,{},t):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...n})}del(e,t,n){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions/${t}`,n)}}class Io extends oo{}ko.PermissionCreateResponsesPage=Io;class Ao extends to{constructor(){super(...arguments),this.permissions=new ko(this._client)}}Ao.Permissions=ko,Ao.PermissionCreateResponsesPage=Io;class _o extends to{list(e,t={},n){return Rr(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Fo,{query:t,...n})}}class Fo extends ao{}_o.FineTuningJobCheckpointsPage=Fo;class To extends to{constructor(){super(...arguments),this.checkpoints=new _o(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return Rr(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",jo,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return Rr(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Oo,{query:t,...n})}pause(e,t){return this._client.post(`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(`/fine_tuning/jobs/${e}/resume`,t)}}class jo extends ao{}class Oo extends ao{}To.FineTuningJobsPage=jo,To.FineTuningJobEventsPage=Oo,To.Checkpoints=_o,To.FineTuningJobCheckpointsPage=Fo;class Po extends to{constructor(){super(...arguments),this.methods=new So(this._client),this.jobs=new To(this._client),this.checkpoints=new Ao(this._client),this.alpha=new Eo(this._client)}}Po.Methods=So,Po.Jobs=To,Po.FineTuningJobsPage=jo,Po.FineTuningJobEventsPage=Oo,Po.Checkpoints=Ao,Po.Alpha=Eo;class Ro extends to{}class No extends to{constructor(){super(...arguments),this.graderModels=new Ro(this._client)}}No.GraderModels=Ro;class Lo extends to{create(e,t,n){return this._client.post(`/vector_stores/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,r){return this._client.post(`/vector_stores/${e}/files/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e,t={},n){return Rr(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,Bo,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t,n){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}async poll(e,t,n){const r={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const o=await this.retrieve(e,t,{...n,headers:r}).withResponse(),a=o.data;switch(a.status){case"in_progress":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=o.response.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await Wr(e);break;case"failed":case"completed":return a}}}async upload(e,t,n){const r=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:r.id},n)}async uploadAndPoll(e,t,n){const r=await this.upload(e,t,n);return await this.poll(e,r.id,n)}content(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/files/${t}/content`,zo,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}}class Bo extends ao{}class zo extends oo{}Lo.VectorStoreFilesPage=Bo,Lo.FileContentResponsesPage=zo;class Do extends to{create(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}cancel(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t);return await this.poll(e,r.id,n)}listFiles(e,t,n={},r){return Rr(n)?this.listFiles(e,t,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,Bo,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async poll(e,t,n){const r={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:o,response:a}=await this.retrieve(e,t,{...n,headers:r}).withResponse();switch(o.status){case"in_progress":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=a.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await Wr(e);break;case"failed":case"cancelled":case"completed":return o}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},r){if(null==t||0==t.length)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const o=r?.maxConcurrency??5,a=Math.min(o,t.length),i=this._client,s=t.values(),l=[...n];const c=Array(a).fill(s).map((async function(e){for(let t of e){const e=await i.files.create({file:t,purpose:"assistants"},r);l.push(e.id)}}));return await(async e=>{const t=await Promise.allSettled(e),n=t.filter((e=>"rejected"===e.status));if(n.length){for(const e of n)console.error(e.reason);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const r=[];for(const e of t)"fulfilled"===e.status&&r.push(e.value);return r})(c),await this.createAndPoll(e,{file_ids:l})}}class Mo extends to{constructor(){super(...arguments),this.files=new Lo(this._client),this.fileBatches=new Do(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/vector_stores/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e={},t){return Rr(e)?this.list({},e):this._client.getAPIList("/vector_stores",Uo,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}search(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/search`,$o,{body:t,method:"post",...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}}class Uo extends ao{}class $o extends oo{}Mo.VectorStoresPage=Uo,Mo.VectorStoreSearchResponsesPage=$o,Mo.Files=Lo,Mo.VectorStoreFilesPage=Bo,Mo.FileContentResponsesPage=zo,Mo.FileBatches=Do;class Wo extends to{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e={},t){return Rr(e)?this.list({},e):this._client.getAPIList("/assistants",Vo,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class Vo extends ao{}function qo(e){return"function"==typeof e.parse}Wo.AssistantsPage=Vo;const Go=e=>"assistant"===e?.role,Ho=e=>"function"===e?.role,Ko=e=>"tool"===e?.role;var Yo,Qo,Jo,Xo,Zo,ea,ta,na,ra,oa,aa,ia,sa,la=function(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,n):o?o.value=n:t.set(e,n),n},ca=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class ua{constructor(){Yo.add(this),this.controller=new AbortController,Qo.set(this,void 0),Jo.set(this,(()=>{})),Xo.set(this,(()=>{})),Zo.set(this,void 0),ea.set(this,(()=>{})),ta.set(this,(()=>{})),na.set(this,{}),ra.set(this,!1),oa.set(this,!1),aa.set(this,!1),ia.set(this,!1),la(this,Qo,new Promise(((e,t)=>{la(this,Jo,e,"f"),la(this,Xo,t,"f")})),"f"),la(this,Zo,new Promise(((e,t)=>{la(this,ea,e,"f"),la(this,ta,t,"f")})),"f"),ca(this,Qo,"f").catch((()=>{})),ca(this,Zo,"f").catch((()=>{}))}_run(e){setTimeout((()=>{e().then((()=>{this._emitFinal(),this._emit("end")}),ca(this,Yo,"m",sa).bind(this))}),0)}_connected(){this.ended||(ca(this,Jo,"f").call(this),this._emit("connect"))}get ended(){return ca(this,ra,"f")}get errored(){return ca(this,oa,"f")}get aborted(){return ca(this,aa,"f")}abort(){this.controller.abort()}on(e,t){return(ca(this,na,"f")[e]||(ca(this,na,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=ca(this,na,"f")[e];if(!n)return this;const r=n.findIndex((e=>e.listener===t));return r>=0&&n.splice(r,1),this}once(e,t){return(ca(this,na,"f")[e]||(ca(this,na,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise(((t,n)=>{la(this,ia,!0,"f"),"error"!==e&&this.once("error",n),this.once(e,t)}))}async done(){la(this,ia,!0,"f"),await ca(this,Zo,"f")}_emit(e,...t){if(ca(this,ra,"f"))return;"end"===e&&(la(this,ra,!0,"f"),ca(this,ea,"f").call(this));const n=ca(this,na,"f")[e];if(n&&(ca(this,na,"f")[e]=n.filter((e=>!e.once)),n.forEach((({listener:e})=>e(...t)))),"abort"===e){const e=t[0];return ca(this,ia,"f")||n?.length||Promise.reject(e),ca(this,Xo,"f").call(this,e),ca(this,ta,"f").call(this,e),void this._emit("end")}if("error"===e){const e=t[0];ca(this,ia,"f")||n?.length||Promise.reject(e),ca(this,Xo,"f").call(this,e),ca(this,ta,"f").call(this,e),this._emit("end")}}_emitFinal(){}}function da(e){return"auto-parseable-response-format"===e?.$brand}function fa(e){return"auto-parseable-tool"===e?.$brand}function pa(e,t){const n=e.choices.map((e=>{if("length"===e.finish_reason)throw new tr;if("content_filter"===e.finish_reason)throw new nr;return{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map((e=>function(e,t){const n=e.tools?.find((e=>e.function?.name===t.function.name));return{...t,function:{...t.function,parsed_arguments:fa(n)?n.$parseRaw(t.function.arguments):n?.function.strict?JSON.parse(t.function.arguments):null}}}(t,e)))??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?ga(t,e.message.content):null}}}));return{...e,choices:n}}function ga(e,t){if("json_schema"!==e.response_format?.type)return null;if("json_schema"===e.response_format?.type){if("$parseRaw"in e.response_format){return e.response_format.$parseRaw(t)}return JSON.parse(t)}return null}function ha(e,t){if(!e)return!1;const n=e.tools?.find((e=>e.function?.name===t.function.name));return fa(n)||n?.function.strict||!1}function ma(e){return!!da(e.response_format)||(e.tools?.some((e=>fa(e)||"function"===e.type&&!0===e.function.strict))??!1)}Qo=new WeakMap,Jo=new WeakMap,Xo=new WeakMap,Zo=new WeakMap,ea=new WeakMap,ta=new WeakMap,na=new WeakMap,ra=new WeakMap,oa=new WeakMap,aa=new WeakMap,ia=new WeakMap,Yo=new WeakSet,sa=function(e){if(la(this,oa,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new Vn),e instanceof Vn)return la(this,aa,!0,"f"),this._emit("abort",e);if(e instanceof $n)return this._emit("error",e);if(e instanceof Error){const t=new $n(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new $n(String(e)))};var ya,xa,va,ba,wa,Sa,Ca,Ea,ka=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};const Ia=10;class Aa extends ua{constructor(){super(...arguments),ya.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t)if(this._emit("message",e),(Ho(e)||Ko(e))&&e.content)this._emit("functionCallResult",e.content);else if(Go(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Go(e)&&e.tool_calls)for(const t of e.tool_calls)"function"===t.type&&this._emit("functionCall",t.function)}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new $n("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),ka(this,ya,"m",xa).call(this)}async finalMessage(){return await this.done(),ka(this,ya,"m",va).call(this)}async finalFunctionCall(){return await this.done(),ka(this,ya,"m",ba).call(this)}async finalFunctionCallResult(){return await this.done(),ka(this,ya,"m",wa).call(this)}async totalUsage(){return await this.done(),ka(this,ya,"m",Sa).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=ka(this,ya,"m",va).call(this);t&&this._emit("finalMessage",t);const n=ka(this,ya,"m",xa).call(this);n&&this._emit("finalContent",n);const r=ka(this,ya,"m",ba).call(this);r&&this._emit("finalFunctionCall",r);const o=ka(this,ya,"m",wa).call(this);null!=o&&this._emit("finalFunctionCallResult",o),this._chatCompletions.some((e=>e.usage))&&this._emit("totalUsage",ka(this,ya,"m",Sa).call(this))}async _createChatCompletion(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort()))),ka(this,ya,"m",Ca).call(this,t);const o=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(pa(o,t))}async _runChatCompletion(e,t,n){for(const e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){const r="function",{function_call:o="auto",stream:a,...i}=t,s="string"!=typeof o&&o?.name,{maxChatCompletions:l=Ia}=n||{},c={};for(const e of t.functions)c[e.name||e.function.name]=e;const u=t.functions.map((e=>({name:e.name||e.function.name,parameters:e.parameters,description:e.description})));for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){const t=await this._createChatCompletion(e,{...i,function_call:o,functions:u,messages:[...this.messages]},n),a=t.choices[0]?.message;if(!a)throw new $n("missing message in ChatCompletion response");if(!a.function_call)return;const{name:l,arguments:d}=a.function_call,f=c[l];if(!f){const e=`Invalid function_call: ${JSON.stringify(l)}. Available options are: ${u.map((e=>JSON.stringify(e.name))).join(", ")}. Please try again`;this._addMessage({role:r,name:l,content:e});continue}if(s&&s!==l){const e=`Invalid function_call: ${JSON.stringify(l)}. ${JSON.stringify(s)} requested. Please try again`;this._addMessage({role:r,name:l,content:e});continue}let p;try{p=qo(f)?await f.parse(d):d}catch(e){this._addMessage({role:r,name:l,content:e instanceof Error?e.message:String(e)});continue}const g=await f.function(p,this),h=ka(this,ya,"m",Ea).call(this,g);if(this._addMessage({role:r,name:l,content:h}),s)return}}async _runTools(e,t,n){const r="tool",{tool_choice:o="auto",stream:a,...i}=t,s="string"!=typeof o&&o?.function?.name,{maxChatCompletions:l=Ia}=n||{},c=t.tools.map((e=>{if(fa(e)){if(!e.$callback)throw new $n("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e})),u={};for(const e of c)"function"===e.type&&(u[e.function.name||e.function.function.name]=e.function);const d="tools"in t?c.map((e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e)):void 0;for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){const t=await this._createChatCompletion(e,{...i,tool_choice:o,tools:d,messages:[...this.messages]},n),a=t.choices[0]?.message;if(!a)throw new $n("missing message in ChatCompletion response");if(!a.tool_calls?.length)return;for(const e of a.tool_calls){if("function"!==e.type)continue;const t=e.id,{name:n,arguments:o}=e.function,a=u[n];if(!a){const e=`Invalid tool_call: ${JSON.stringify(n)}. Available options are: ${Object.keys(u).map((e=>JSON.stringify(e))).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:t,content:e});continue}if(s&&s!==n){const e=`Invalid tool_call: ${JSON.stringify(n)}. ${JSON.stringify(s)} requested. Please try again`;this._addMessage({role:r,tool_call_id:t,content:e});continue}let i;try{i=qo(a)?await a.parse(o):o}catch(e){const n=e instanceof Error?e.message:String(e);this._addMessage({role:r,tool_call_id:t,content:n});continue}const l=await a.function(i,this),c=ka(this,ya,"m",Ea).call(this,l);if(this._addMessage({role:r,tool_call_id:t,content:c}),s)return}}}}ya=new WeakSet,xa=function(){return ka(this,ya,"m",va).call(this).content??null},va=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(Go(t)){const{function_call:e,...n}=t,r={...n,content:t.content??null,refusal:t.refusal??null};return e&&(r.function_call=e),r}}throw new $n("stream ended without producing a ChatCompletionMessage with role=assistant")},ba=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Go(t)&&t?.function_call)return t.function_call;if(Go(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},wa=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Ho(t)&&null!=t.content)return t.content;if(Ko(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some((e=>"assistant"===e.role&&e.tool_calls?.some((e=>"function"===e.type&&e.id===t.tool_call_id)))))return t.content}},Sa=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Ca=function(e){if(null!=e.n&&e.n>1)throw new $n("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Ea=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class _a extends Aa{static runFunctions(e,t,n){const r=new _a,o={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run((()=>r._runFunctions(e,t,o))),r}static runTools(e,t,n){const r=new _a,o={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run((()=>r._runTools(e,t,o))),r}_addMessage(e,t=!0){super._addMessage(e,t),Go(e)&&e.content&&this._emit("content",e.content)}}const Fa=1,Ta=2,ja=4,Oa=8,Pa=16,Ra=32,Na=64,La=128,Ba=256,za=511;class Da extends Error{}class Ma extends Error{}const Ua=(e,t)=>{const n=e.length;let r=0;const o=e=>{throw new Da(`${e} at position ${r}`)},a=e=>{throw new Ma(`${e} at position ${r}`)},i=()=>(d(),r>=n&&o("Unexpected end of input"),'"'===e[r]?s():"{"===e[r]?l():"["===e[r]?c():"null"===e.substring(r,r+4)||Pa&t&&n-r<4&&"null".startsWith(e.substring(r))?(r+=4,null):"true"===e.substring(r,r+4)||Ra&t&&n-r<4&&"true".startsWith(e.substring(r))?(r+=4,!0):"false"===e.substring(r,r+5)||Ra&t&&n-r<5&&"false".startsWith(e.substring(r))?(r+=5,!1):"Infinity"===e.substring(r,r+8)||La&t&&n-r<8&&"Infinity".startsWith(e.substring(r))?(r+=8,1/0):"-Infinity"===e.substring(r,r+9)||Ba&t&&1<n-r&&n-r<9&&"-Infinity".startsWith(e.substring(r))?(r+=9,-1/0):"NaN"===e.substring(r,r+3)||Na&t&&n-r<3&&"NaN".startsWith(e.substring(r))?(r+=3,NaN):u()),s=()=>{const i=r;let s=!1;for(r++;r<n&&('"'!==e[r]||s&&"\\"===e[r-1]);)s="\\"===e[r]&&!s,r++;if('"'==e.charAt(r))try{return JSON.parse(e.substring(i,++r-Number(s)))}catch(e){a(String(e))}else if(Fa&t)try{return JSON.parse(e.substring(i,r-Number(s))+'"')}catch(t){return JSON.parse(e.substring(i,e.lastIndexOf("\\"))+'"')}o("Unterminated string literal")},l=()=>{r++,d();const a={};try{for(;"}"!==e[r];){if(d(),r>=n&&Oa&t)return a;const o=s();d(),r++;try{const e=i();Object.defineProperty(a,o,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(e){if(Oa&t)return a;throw e}d(),","===e[r]&&r++}}catch(e){if(Oa&t)return a;o("Expected '}' at end of object")}return r++,a},c=()=>{r++;const n=[];try{for(;"]"!==e[r];)n.push(i()),d(),","===e[r]&&r++}catch(e){if(ja&t)return n;o("Expected ']' at end of array")}return r++,n},u=()=>{if(0===r){"-"===e&&Ta&t&&o("Not sure what '-' is");try{return JSON.parse(e)}catch(n){if(Ta&t)try{return"."===e[e.length-1]?JSON.parse(e.substring(0,e.lastIndexOf("."))):JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(e){}a(String(n))}}const i=r;for("-"===e[r]&&r++;e[r]&&!",]}".includes(e[r]);)r++;r!=n||Ta&t||o("Unterminated number literal");try{return JSON.parse(e.substring(i,r))}catch(n){"-"===e.substring(i,r)&&Ta&t&&o("Not sure what '-' is");try{return JSON.parse(e.substring(i,e.lastIndexOf("e")))}catch(e){a(String(e))}}},d=()=>{for(;r<n&&" \n\r\t".includes(e[r]);)r++};return i()},$a=e=>function(e,t=za){if("string"!=typeof e)throw new TypeError("expecting str, got "+typeof e);if(!e.trim())throw new Error(`${e} is empty`);return Ua(e.trim(),t)}(e,za^Ta);var Wa,Va,qa,Ga,Ha,Ka,Ya,Qa,Ja,Xa,Za,ei,ti=function(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,n):o?o.value=n:t.set(e,n),n},ni=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class ri extends Aa{constructor(e){super(),Wa.add(this),Va.set(this,void 0),qa.set(this,void 0),Ga.set(this,void 0),ti(this,Va,e,"f"),ti(this,qa,[],"f")}get currentChatCompletionSnapshot(){return ni(this,Ga,"f")}static fromReadableStream(e){const t=new ri(null);return t._run((()=>t._fromReadableStream(e))),t}static createChatCompletion(e,t,n){const r=new ri(t);return r._run((()=>r._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}}))),r}async _createChatCompletion(e,t,n){super._createChatCompletion;const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort()))),ni(this,Wa,"m",Ha).call(this);const o=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const e of o)ni(this,Wa,"m",Ya).call(this,e);if(o.controller.signal?.aborted)throw new Vn;return this._addChatCompletion(ni(this,Wa,"m",Xa).call(this))}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),ni(this,Wa,"m",Ha).call(this),this._connected();const r=ur.fromReadableStream(e,this.controller);let o;for await(const e of r)o&&o!==e.id&&this._addChatCompletion(ni(this,Wa,"m",Xa).call(this)),ni(this,Wa,"m",Ya).call(this,e),o=e.id;if(r.controller.signal?.aborted)throw new Vn;return this._addChatCompletion(ni(this,Wa,"m",Xa).call(this))}[(Va=new WeakMap,qa=new WeakMap,Ga=new WeakMap,Wa=new WeakSet,Ha=function(){this.ended||ti(this,Ga,void 0,"f")},Ka=function(e){let t=ni(this,qa,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},ni(this,qa,"f")[e.index]=t,t)},Ya=function(e){if(this.ended)return;const t=ni(this,Wa,"m",ei).call(this,e);this._emit("chunk",e,t);for(const n of e.choices){const e=t.choices[n.index];null!=n.delta.content&&"assistant"===e.message?.role&&e.message?.content&&(this._emit("content",n.delta.content,e.message.content),this._emit("content.delta",{delta:n.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=n.delta.refusal&&"assistant"===e.message?.role&&e.message?.refusal&&this._emit("refusal.delta",{delta:n.delta.refusal,snapshot:e.message.refusal}),null!=n.logprobs?.content&&"assistant"===e.message?.role&&this._emit("logprobs.content.delta",{content:n.logprobs?.content,snapshot:e.logprobs?.content??[]}),null!=n.logprobs?.refusal&&"assistant"===e.message?.role&&this._emit("logprobs.refusal.delta",{refusal:n.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});const r=ni(this,Wa,"m",Ka).call(this,e);e.finish_reason&&(ni(this,Wa,"m",Ja).call(this,e),null!=r.current_tool_call_index&&ni(this,Wa,"m",Qa).call(this,e,r.current_tool_call_index));for(const t of n.delta.tool_calls??[])r.current_tool_call_index!==t.index&&(ni(this,Wa,"m",Ja).call(this,e),null!=r.current_tool_call_index&&ni(this,Wa,"m",Qa).call(this,e,r.current_tool_call_index)),r.current_tool_call_index=t.index;for(const t of n.delta.tool_calls??[]){const n=e.message.tool_calls?.[t.index];n?.type&&("function"===n?.type&&this._emit("tool_calls.function.arguments.delta",{name:n.function?.name,index:t.index,arguments:n.function.arguments,parsed_arguments:n.function.parsed_arguments,arguments_delta:t.function?.arguments??""}))}}},Qa=function(e,t){if(ni(this,Wa,"m",Ka).call(this,e).done_tool_calls.has(t))return;const n=e.message.tool_calls?.[t];if(!n)throw new Error("no tool call snapshot");if(!n.type)throw new Error("tool call snapshot missing `type`");if("function"===n.type){const e=ni(this,Va,"f")?.tools?.find((e=>"function"===e.type&&e.function.name===n.function.name));this._emit("tool_calls.function.arguments.done",{name:n.function.name,index:t,arguments:n.function.arguments,parsed_arguments:fa(e)?e.$parseRaw(n.function.arguments):e?.function.strict?JSON.parse(n.function.arguments):null})}else n.type},Ja=function(e){const t=ni(this,Wa,"m",Ka).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;const n=ni(this,Wa,"m",Za).call(this);this._emit("content.done",{content:e.message.content,parsed:n?n.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},Xa=function(){if(this.ended)throw new $n("stream has ended, this shouldn't happen");const e=ni(this,Ga,"f");if(!e)throw new $n("request ended without sending any chunks");return ti(this,Ga,void 0,"f"),ti(this,qa,[],"f"),function(e,t){const{id:n,choices:r,created:o,model:a,system_fingerprint:i,...s}=e,l={...s,id:n,choices:r.map((({message:t,finish_reason:n,index:r,logprobs:o,...a})=>{if(!n)throw new $n(`missing finish_reason for choice ${r}`);const{content:i=null,function_call:s,tool_calls:l,...c}=t,u=t.role;if(!u)throw new $n(`missing role for choice ${r}`);if(s){const{arguments:e,name:l}=s;if(null==e)throw new $n(`missing function_call.arguments for choice ${r}`);if(!l)throw new $n(`missing function_call.name for choice ${r}`);return{...a,message:{content:i,function_call:{arguments:e,name:l},role:u,refusal:t.refusal??null},finish_reason:n,index:r,logprobs:o}}return l?{...a,index:r,finish_reason:n,logprobs:o,message:{...c,role:u,content:i,refusal:t.refusal??null,tool_calls:l.map(((t,n)=>{const{function:o,type:a,id:i,...s}=t,{arguments:l,name:c,...u}=o||{};if(null==i)throw new $n(`missing choices[${r}].tool_calls[${n}].id\n${oi(e)}`);if(null==a)throw new $n(`missing choices[${r}].tool_calls[${n}].type\n${oi(e)}`);if(null==c)throw new $n(`missing choices[${r}].tool_calls[${n}].function.name\n${oi(e)}`);if(null==l)throw new $n(`missing choices[${r}].tool_calls[${n}].function.arguments\n${oi(e)}`);return{...s,id:i,type:a,function:{...u,name:c,arguments:l}}}))}}:{...a,message:{...c,content:i,role:u,refusal:t.refusal??null},finish_reason:n,index:r,logprobs:o}})),created:o,model:a,object:"chat.completion",...i?{system_fingerprint:i}:{}};return function(e,t){return t&&ma(t)?pa(e,t):{...e,choices:e.choices.map((e=>({...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}})))}}(l,t)}(e,ni(this,Va,"f"))},Za=function(){const e=ni(this,Va,"f")?.response_format;return da(e)?e:null},ei=function(e){var t,n,r,o;let a=ni(this,Ga,"f");const{choices:i,...s}=e;a?Object.assign(a,s):a=ti(this,Ga,{...s,choices:[]},"f");for(const{delta:i,finish_reason:s,index:l,logprobs:c=null,...u}of e.choices){let e=a.choices[l];if(e||(e=a.choices[l]={finish_reason:s,index:l,message:{},logprobs:c,...u}),c)if(e.logprobs){const{content:r,refusal:o,...a}=c;Object.assign(e.logprobs,a),r&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...r)),o&&((n=e.logprobs).refusal??(n.refusal=[]),e.logprobs.refusal.push(...o))}else e.logprobs=Object.assign({},c);if(s&&(e.finish_reason=s,ni(this,Va,"f")&&ma(ni(this,Va,"f")))){if("length"===s)throw new tr;if("content_filter"===s)throw new nr}if(Object.assign(e,u),!i)continue;const{content:d,refusal:f,function_call:p,role:g,tool_calls:h,...m}=i;if(Object.assign(e.message,m),f&&(e.message.refusal=(e.message.refusal||"")+f),g&&(e.message.role=g),p&&(e.message.function_call?(p.name&&(e.message.function_call.name=p.name),p.arguments&&((r=e.message.function_call).arguments??(r.arguments=""),e.message.function_call.arguments+=p.arguments)):e.message.function_call=p),d&&(e.message.content=(e.message.content||"")+d,!e.message.refusal&&ni(this,Wa,"m",Za).call(this)&&(e.message.parsed=$a(e.message.content))),h){e.message.tool_calls||(e.message.tool_calls=[]);for(const{index:t,id:n,type:r,function:a,...i}of h){const s=(o=e.message.tool_calls)[t]??(o[t]={});Object.assign(s,i),n&&(s.id=n),r&&(s.type=r),a&&(s.function??(s.function={name:a.name??"",arguments:""})),a?.name&&(s.function.name=a.name),a?.arguments&&(s.function.arguments+=a.arguments,ha(ni(this,Va,"f"),s)&&(s.function.parsed_arguments=$a(s.function.arguments)))}}}return a},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",(n=>{const r=t.shift();r?r.resolve(n):e.push(n)})),this.on("end",(()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),this.on("error",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),{next:async()=>{if(!e.length)return n?{value:void 0,done:!0}:new Promise(((e,n)=>t.push({resolve:e,reject:n}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0}));return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new ur(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function oi(e){return JSON.stringify(e)}class ai extends ri{static fromReadableStream(e){const t=new ai(null);return t._run((()=>t._fromReadableStream(e))),t}static runFunctions(e,t,n){const r=new ai(null),o={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run((()=>r._runFunctions(e,t,o))),r}static runTools(e,t,n){const r=new ai(t),o={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run((()=>r._runTools(e,t,o))),r}}class ii extends to{parse(e,t){return function(e){for(const t of e??[]){if("function"!==t.type)throw new $n(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new $n(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap((t=>pa(t,e)))}runFunctions(e,t){return e.stream?ai.runFunctions(this._client,e,t):_a.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?ai.runTools(this._client,e,t):_a.runTools(this._client,e,t)}stream(e,t){return ri.createChatCompletion(this._client,e,t)}}class si extends to{constructor(){super(...arguments),this.completions=new ii(this._client)}}!function(e){e.Completions=ii}(si||(si={}));class li extends to{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class ci extends to{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class ui extends to{constructor(){super(...arguments),this.sessions=new li(this._client),this.transcriptionSessions=new ci(this._client)}}ui.Sessions=li,ui.TranscriptionSessions=ci;var di,fi,pi,gi,hi,mi,yi,xi,vi,bi,wi,Si,Ci,Ei,ki,Ii,Ai,_i,Fi,Ti,ji,Oi,Pi=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},Ri=function(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,n):o?o.value=n:t.set(e,n),n};class Ni extends ua{constructor(){super(...arguments),di.add(this),fi.set(this,[]),pi.set(this,{}),gi.set(this,{}),hi.set(this,void 0),mi.set(this,void 0),yi.set(this,void 0),xi.set(this,void 0),vi.set(this,void 0),bi.set(this,void 0),wi.set(this,void 0),Si.set(this,void 0),Ci.set(this,void 0)}[(fi=new WeakMap,pi=new WeakMap,gi=new WeakMap,hi=new WeakMap,mi=new WeakMap,yi=new WeakMap,xi=new WeakMap,vi=new WeakMap,bi=new WeakMap,wi=new WeakMap,Si=new WeakMap,Ci=new WeakMap,di=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",(n=>{const r=t.shift();r?r.resolve(n):e.push(n)})),this.on("end",(()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),this.on("error",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),{next:async()=>{if(!e.length)return n?{value:void 0,done:!0}:new Promise(((e,n)=>t.push({resolve:e,reject:n}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0}));return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new Ni;return t._run((()=>t._fromReadableStream(e))),t}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),this._connected();const r=ur.fromReadableStream(e,this.controller);for await(const e of r)Pi(this,di,"m",Ei).call(this,e);if(r.controller.signal?.aborted)throw new Vn;return this._addRun(Pi(this,di,"m",ki).call(this))}toReadableStream(){return new ur(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,r,o){const a=new Ni;return a._run((()=>a._runToolAssistantStream(e,t,n,r,{...o,headers:{...o?.headers,"X-Stainless-Helper-Method":"stream"}}))),a}async _createToolAssistantStream(e,t,n,r,o){const a=o?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",(()=>this.controller.abort())));const i={...r,stream:!0},s=await e.submitToolOutputs(t,n,i,{...o,signal:this.controller.signal});this._connected();for await(const e of s)Pi(this,di,"m",Ei).call(this,e);if(s.controller.signal?.aborted)throw new Vn;return this._addRun(Pi(this,di,"m",ki).call(this))}static createThreadAssistantStream(e,t,n){const r=new Ni;return r._run((()=>r._threadAssistantStream(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}}))),r}static createAssistantStream(e,t,n,r){const o=new Ni;return o._run((()=>o._runAssistantStream(e,t,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}}))),o}currentEvent(){return Pi(this,wi,"f")}currentRun(){return Pi(this,Si,"f")}currentMessageSnapshot(){return Pi(this,hi,"f")}currentRunStepSnapshot(){return Pi(this,Ci,"f")}async finalRunSteps(){return await this.done(),Object.values(Pi(this,pi,"f"))}async finalMessages(){return await this.done(),Object.values(Pi(this,gi,"f"))}async finalRun(){if(await this.done(),!Pi(this,mi,"f"))throw Error("Final run was not received.");return Pi(this,mi,"f")}async _createThreadAssistantStream(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort())));const o={...t,stream:!0},a=await e.createAndRun(o,{...n,signal:this.controller.signal});this._connected();for await(const e of a)Pi(this,di,"m",Ei).call(this,e);if(a.controller.signal?.aborted)throw new Vn;return this._addRun(Pi(this,di,"m",ki).call(this))}async _createAssistantStream(e,t,n,r){const o=r?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",(()=>this.controller.abort())));const a={...n,stream:!0},i=await e.create(t,a,{...r,signal:this.controller.signal});this._connected();for await(const e of i)Pi(this,di,"m",Ei).call(this,e);if(i.controller.signal?.aborted)throw new Vn;return this._addRun(Pi(this,di,"m",ki).call(this))}static accumulateDelta(e,t){for(const[n,r]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=r;continue}let t=e[n];if(null!=t)if("index"!==n&&"type"!==n){if("string"==typeof t&&"string"==typeof r)t+=r;else if("number"==typeof t&&"number"==typeof r)t+=r;else{if(!eo(t)||!eo(r)){if(Array.isArray(t)&&Array.isArray(r)){if(t.every((e=>"string"==typeof e||"number"==typeof e))){t.push(...r);continue}for(const e of r){if(!eo(e))throw new Error(`Expected array delta entry to be an object but got: ${e}`);const n=e.index;if(null==n)throw console.error(e),new Error("Expected array delta entry to have an `index` property");if("number"!=typeof n)throw new Error(`Expected array delta entry \`index\` property to be a number but got ${n}`);const r=t[n];null==r?t.push(e):t[n]=this.accumulateDelta(r,e)}continue}throw Error(`Unhandled record type: ${n}, deltaValue: ${r}, accValue: ${t}`)}t=this.accumulateDelta(t,r)}e[n]=t}else e[n]=r;else e[n]=r}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,r){return await this._createAssistantStream(t,e,n,r)}async _runToolAssistantStream(e,t,n,r,o){return await this._createToolAssistantStream(n,e,t,r,o)}}Ei=function(e){if(!this.ended)switch(Ri(this,wi,e,"f"),Pi(this,di,"m",_i).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":Pi(this,di,"m",Oi).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Pi(this,di,"m",Ai).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":Pi(this,di,"m",Ii).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},ki=function(){if(this.ended)throw new $n("stream has ended, this shouldn't happen");if(!Pi(this,mi,"f"))throw Error("Final run has not been received");return Pi(this,mi,"f")},Ii=function(e){const[t,n]=Pi(this,di,"m",Ti).call(this,e,Pi(this,hi,"f"));Ri(this,hi,t,"f"),Pi(this,gi,"f")[t.id]=t;for(const e of n){const n=t.content[e.index];"text"==n?.type&&this._emit("textCreated",n.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const n of e.data.delta.content){if("text"==n.type&&n.text){let e=n.text,r=t.content[n.index];if(!r||"text"!=r.type)throw Error("The snapshot associated with this text delta is not text or missing");this._emit("textDelta",e,r.text)}if(n.index!=Pi(this,yi,"f")){if(Pi(this,xi,"f"))switch(Pi(this,xi,"f").type){case"text":this._emit("textDone",Pi(this,xi,"f").text,Pi(this,hi,"f"));break;case"image_file":this._emit("imageFileDone",Pi(this,xi,"f").image_file,Pi(this,hi,"f"))}Ri(this,yi,n.index,"f")}Ri(this,xi,t.content[n.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==Pi(this,yi,"f")){const t=e.data.content[Pi(this,yi,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,Pi(this,hi,"f"));break;case"text":this._emit("textDone",t.text,Pi(this,hi,"f"))}}Pi(this,hi,"f")&&this._emit("messageDone",e.data),Ri(this,hi,void 0,"f")}},Ai=function(e){const t=Pi(this,di,"m",Fi).call(this,e);switch(Ri(this,Ci,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&"tool_calls"==n.step_details.type&&n.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(const e of n.step_details.tool_calls)e.index==Pi(this,vi,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(Pi(this,bi,"f")&&this._emit("toolCallDone",Pi(this,bi,"f")),Ri(this,vi,e.index,"f"),Ri(this,bi,t.step_details.tool_calls[e.index],"f"),Pi(this,bi,"f")&&this._emit("toolCallCreated",Pi(this,bi,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Ri(this,Ci,void 0,"f");"tool_calls"==e.data.step_details.type&&Pi(this,bi,"f")&&(this._emit("toolCallDone",Pi(this,bi,"f")),Ri(this,bi,void 0,"f")),this._emit("runStepDone",e.data,t)}},_i=function(e){Pi(this,fi,"f").push(e),this._emit("event",e)},Fi=function(e){switch(e.event){case"thread.run.step.created":return Pi(this,pi,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=Pi(this,pi,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const r=Ni.accumulateDelta(t,n.delta);Pi(this,pi,"f")[e.data.id]=r}return Pi(this,pi,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":Pi(this,pi,"f")[e.data.id]=e.data}if(Pi(this,pi,"f")[e.data.id])return Pi(this,pi,"f")[e.data.id];throw new Error("No snapshot available")},Ti=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let r=e.data;if(r.delta.content)for(const e of r.delta.content)if(e.index in t.content){let n=t.content[e.index];t.content[e.index]=Pi(this,di,"m",ji).call(this,e,n)}else t.content[e.index]=e,n.push(e);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},ji=function(e,t){return Ni.accumulateDelta(t,e)},Oi=function(e){switch(Ri(this,Si,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.cancelling":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":Ri(this,mi,e.data,"f"),Pi(this,bi,"f")&&(this._emit("toolCallDone",Pi(this,bi,"f")),Ri(this,bi,void 0,"f"))}};class Li extends to{create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e,t={},n){return Rr(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,Bi,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t,n){return this._client.delete(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}}class Bi extends ao{}Li.MessagesPage=Bi;class zi extends to{retrieve(e,t,n,r={},o){return Rr(r)?this.retrieve(e,t,n,{},r):this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{query:r,...o,headers:{"OpenAI-Beta":"assistants=v2",...o?.headers}})}list(e,t,n={},r){return Rr(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,Di,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}}class Di extends ao{}zi.RunStepsPage=Di;class Mi extends to{constructor(){super(...arguments),this.steps=new zi(this._client)}create(e,t,n){const{include:r,...o}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:r},body:o,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers},stream:t.stream??!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e,t={},n){return Rr(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,Ui,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}createAndStream(e,t,n){return Ni.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const r={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:o,response:a}=await this.retrieve(e,t,{...n,headers:{...n?.headers,...r}}).withResponse();switch(o.status){case"queued":case"in_progress":case"cancelling":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=a.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await Wr(e);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return o}}}stream(e,t,n){return Ni.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,r){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(e,t,n,r){const o=await this.submitToolOutputs(e,t,n,r);return await this.poll(e,o.id,r)}submitToolOutputsStream(e,t,n,r){return Ni.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,r)}}class Ui extends ao{}Mi.RunsPage=Ui,Mi.Steps=zi,Mi.RunStepsPage=Di;class $i extends to{constructor(){super(...arguments),this.runs=new Mi(this._client),this.messages=new Li(this._client)}create(e={},t){return Rr(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.thread_id,n.id,t)}createAndRunStream(e,t){return Ni.createThreadAssistantStream(e,this._client.beta.threads,t)}}$i.Runs=Mi,$i.RunsPage=Ui,$i.Messages=Li,$i.MessagesPage=Bi;class Wi extends to{constructor(){super(...arguments),this.realtime=new ui(this._client),this.chat=new si(this._client),this.assistants=new Wo(this._client),this.threads=new $i(this._client)}}Wi.Realtime=ui,Wi.Assistants=Wo,Wi.AssistantsPage=Vo,Wi.Threads=$i;class Vi extends to{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return Rr(e)?this.list({},e):this._client.getAPIList("/batches",qi,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class qi extends ao{}Vi.BatchesPage=qi;class Gi extends to{create(e,t,n){return this._client.post(`/uploads/${e}/parts`,br({body:t,...n}))}}class Hi extends to{constructor(){super(...arguments),this.parts=new Gi(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(`/uploads/${e}/complete`,{body:t,...n})}}function Ki(e,t){return t&&function(e){if(da(e.text?.format))return!0;return!1}(t)?Yi(e,t):{...e,output_parsed:null,output:e.output.map((e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map((e=>({...e,parsed:null})))}:e))}}function Yi(e,t){const n=e.output.map((e=>{if("function_call"===e.type)return{...e,parsed_arguments:Zi(t,e)};if("message"===e.type){const n=e.content.map((e=>"output_text"===e.type?{...e,parsed:Qi(t,e.text)}:e));return{...e,content:n}}return e})),r=Object.assign({},e,{output:n});return Object.getOwnPropertyDescriptor(e,"output_text")||es(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(const e of r.output)if("message"===e.type)for(const t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed;return null}}),r}function Qi(e,t){if("json_schema"!==e.text?.format?.type)return null;if("$parseRaw"in e.text?.format){const n=e.text?.format;return n.$parseRaw(t)}return JSON.parse(t)}function Ji(e){return"auto-parseable-tool"===e?.$brand}function Xi(e,t){return e.find((e=>"function"===e.type&&e.name===t))}function Zi(e,t){const n=Xi(e.tools??[],t.name);return{...t,...t,parsed_arguments:Ji(n)?n.$parseRaw(t.arguments):n?.strict?JSON.parse(t.arguments):null}}function es(e){const t=[];for(const n of e.output)if("message"===n.type)for(const e of n.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}Hi.Parts=Gi;class ts extends to{list(e,t={},n){return Rr(t)?this.list(e,{},t):this._client.getAPIList(`/responses/${e}/input_items`,hs,{query:t,...n})}}var ns,rs,os,as,is,ss,ls,cs,us,ds=function(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,n):o?o.value=n:t.set(e,n),n},fs=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class ps extends ua{constructor(e){super(),ns.add(this),rs.set(this,void 0),os.set(this,void 0),as.set(this,void 0),ds(this,rs,e,"f")}static createResponse(e,t,n){const r=new ps(t);return r._run((()=>r._createResponse(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}}))),r}async _createResponse(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort()))),fs(this,ns,"m",is).call(this);const o=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const e of o)fs(this,ns,"m",ss).call(this,e);if(o.controller.signal?.aborted)throw new Vn;return fs(this,ns,"m",ls).call(this)}[(rs=new WeakMap,os=new WeakMap,as=new WeakMap,ns=new WeakSet,is=function(){this.ended||ds(this,os,void 0,"f")},ss=function(e){if(this.ended)return;const t=fs(this,ns,"m",cs).call(this,e);switch(this._emit("event",e),e.type){case"response.output_text.delta":{const n=t.output[e.output_index];if(!n)throw new $n(`missing output at index ${e.output_index}`);if("message"===n.type){const t=n.content[e.content_index];if(!t)throw new $n(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new $n(`expected content to be 'output_text', got ${t.type}`);this._emit("response.output_text.delta",{...e,snapshot:t.text})}break}case"response.function_call_arguments.delta":{const n=t.output[e.output_index];if(!n)throw new $n(`missing output at index ${e.output_index}`);"function_call"===n.type&&this._emit("response.function_call_arguments.delta",{...e,snapshot:n.arguments});break}default:this._emit(e.type,e)}},ls=function(){if(this.ended)throw new $n("stream has ended, this shouldn't happen");const e=fs(this,os,"f");if(!e)throw new $n("request ended without sending any events");ds(this,os,void 0,"f");const t=function(e,t){return Ki(e,t)}(e,fs(this,rs,"f"));return ds(this,as,t,"f"),t},cs=function(e){let t=fs(this,os,"f");if(!t){if("response.created"!==e.type)throw new $n(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return t=ds(this,os,e.response,"f"),t}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{const n=t.output[e.output_index];if(!n)throw new $n(`missing output at index ${e.output_index}`);"message"===n.type&&n.content.push(e.part);break}case"response.output_text.delta":{const n=t.output[e.output_index];if(!n)throw new $n(`missing output at index ${e.output_index}`);if("message"===n.type){const t=n.content[e.content_index];if(!t)throw new $n(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new $n(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{const n=t.output[e.output_index];if(!n)throw new $n(`missing output at index ${e.output_index}`);"function_call"===n.type&&(n.arguments+=e.delta);break}case"response.completed":ds(this,os,e.response,"f")}return t},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",(n=>{const r=t.shift();r?r.resolve(n):e.push(n)})),this.on("end",(()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),this.on("error",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),{next:async()=>{if(!e.length)return n?{value:void 0,done:!0}:new Promise(((e,n)=>t.push({resolve:e,reject:n}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0}));return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=fs(this,as,"f");if(!e)throw new $n("stream ended without producing a ChatCompletion");return e}}class gs extends to{constructor(){super(...arguments),this.inputItems=new ts(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap((e=>("object"in e&&"response"===e.object&&es(e),e)))}retrieve(e,t={},n){return Rr(t)?this.retrieve(e,{},t):this._client.get(`/responses/${e}`,{query:t,...n})}del(e,t){return this._client.delete(`/responses/${e}`,{...t,headers:{Accept:"*/*",...t?.headers}})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap((t=>Yi(t,e)))}stream(e,t){return ps.createResponse(this._client,e,t)}}class hs extends ao{}gs.InputItems=ts;class ms extends to{retrieve(e,t,n,r){return this._client.get(`/evals/${e}/runs/${t}/output_items/${n}`,r)}list(e,t,n={},r){return Rr(n)?this.list(e,t,{},n):this._client.getAPIList(`/evals/${e}/runs/${t}/output_items`,ys,{query:n,...r})}}class ys extends ao{}ms.OutputItemListResponsesPage=ys;class xs extends to{constructor(){super(...arguments),this.outputItems=new ms(this._client)}create(e,t,n){return this._client.post(`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){return this._client.get(`/evals/${e}/runs/${t}`,n)}list(e,t={},n){return Rr(t)?this.list(e,{},t):this._client.getAPIList(`/evals/${e}/runs`,vs,{query:t,...n})}del(e,t,n){return this._client.delete(`/evals/${e}/runs/${t}`,n)}cancel(e,t,n){return this._client.post(`/evals/${e}/runs/${t}`,n)}}class vs extends ao{}xs.RunListResponsesPage=vs,xs.OutputItems=ms,xs.OutputItemListResponsesPage=ys;class bs extends to{constructor(){super(...arguments),this.runs=new xs(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(`/evals/${e}`,t)}update(e,t,n){return this._client.post(`/evals/${e}`,{body:t,...n})}list(e={},t){return Rr(e)?this.list({},e):this._client.getAPIList("/evals",ws,{query:e,...t})}del(e,t){return this._client.delete(`/evals/${e}`,t)}}class ws extends ao{}bs.EvalListResponsesPage=ws,bs.Runs=xs,bs.RunListResponsesPage=vs;class Ss extends Fr{constructor({baseURL:e=Gr("OPENAI_BASE_URL"),apiKey:t=Gr("OPENAI_API_KEY"),organization:n=Gr("OPENAI_ORG_ID")??null,project:r=Gr("OPENAI_PROJECT_ID")??null,...o}={}){if(void 0===t)throw new $n("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const a={apiKey:t,organization:n,project:r,...o,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator)throw new $n("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new no(this),this.chat=new co(this),this.embeddings=new uo(this),this.files=new fo(this),this.images=new go(this),this.audio=new xo(this),this.moderations=new vo(this),this.models=new bo(this),this.fineTuning=new Po(this),this.graders=new No(this),this.vectorStores=new Mo(this),this.beta=new Wi(this),this.batches=new Vi(this),this.uploads=new Hi(this),this.responses=new gs(this),this.evals=new bs(this),this._options=a,this.apiKey=t,this.organization=n,this.project=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return En(e,{arrayFormat:"brackets"})}}us=Ss,Ss.OpenAI=us,Ss.DEFAULT_TIMEOUT=6e5,Ss.OpenAIError=$n,Ss.APIError=Wn,Ss.APIConnectionError=qn,Ss.APIConnectionTimeoutError=Gn,Ss.APIUserAbortError=Vn,Ss.NotFoundError=Qn,Ss.ConflictError=Jn,Ss.RateLimitError=Zn,Ss.BadRequestError=Hn,Ss.AuthenticationError=Kn,Ss.InternalServerError=er,Ss.PermissionDeniedError=Yn,Ss.UnprocessableEntityError=Xn,Ss.toFile=mr,Ss.fileFromPath=Pn,Ss.Completions=no,Ss.Chat=co,Ss.ChatCompletionsPage=so,Ss.Embeddings=uo,Ss.Files=fo,Ss.FileObjectsPage=po,Ss.Images=go,Ss.Audio=xo,Ss.Moderations=vo,Ss.Models=bo,Ss.ModelsPage=wo,Ss.FineTuning=Po,Ss.Graders=No,Ss.VectorStores=Mo,Ss.VectorStoresPage=Uo,Ss.VectorStoreSearchResponsesPage=$o,Ss.Beta=Wi,Ss.Batches=Vi,Ss.BatchesPage=qi,Ss.Uploads=Hi,Ss.Responses=gs,Ss.Evals=bs,Ss.EvalListResponsesPage=ws;new Set(["/completions","/chat/completions","/embeddings","/audio/transcriptions","/audio/translations","/audio/speech","/images/generations"]);var Cs=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},Es=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}};function ks(e,t,n,r,o){return void 0===o&&(o=""),Cs(this,void 0,void 0,(function(){var e,a,i,s,l;return Es(this,(function(c){switch(c.label){case 0:if(console.log("getImage called with description:",r),e=null,a=null,!r)throw new Error("Cannot generate image: missing description");if(!n)throw new Error("Cannot generate image: no OpenAI API key provided. Please check your settings.");c.label=1;case 1:return c.trys.push([1,7,,8]),console.log("Using OpenAI with key:",n?n.substring(0,5)+"...":"null"),[4,et(t,n,r,o)];case 2:if(e=c.sent(),console.log("OpenAI returned URL:",e?"success":"null"),!e)return[3,6];c.label=3;case 3:return c.trys.push([3,5,,6]),console.log("Converting image URL to base64 for permanent storage..."),[4,te(e)];case 4:return a=c.sent(),console.log("Image URL converted to base64:",a?"success":"null"),a?console.log("✅ Image successfully converted to base64 - keeping both URL and base64 for reliability"):console.warn("⚠️ Failed to convert image to base64 - keeping temporary URL as fallback"),[3,6];case 5:return i=c.sent(),console.error("❌ Error converting URL to base64:",i),console.warn("⚠️ Will use temporary URL as fallback, but it may disappear later"),[3,6];case 6:return[3,8];case 7:throw s=c.sent(),console.error("OpenAI image generation error:",s),s instanceof Error?s:new Error("Failed to generate image with OpenAI. Please check your API key and try again.");case 8:if(!e&&!a)throw new Error("Failed to generate image. Please check your API key and try again.");return l=a?null:e,console.log("Final result:",{hasBase64:!!a,hasUrl:!!l,status:a?"Base64 (permanent)":l?"URL only (temporary)":"No image"}),[2,{imageUrl:l,imageBase64:a}]}}))}))}var Is=function(){return Is=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Is.apply(this,arguments)};const As=function(){var e=(0,r.useState)(null),t=e[0],n=e[1],o=(0,r.useState)("error"),i=o[0],s=o[1],l=(0,r.useState)(!1),c=l[0],u=l[1],d=(0,r.useState)(!1),f=d[0],p=d[1],g=function(){p(!1),setTimeout((function(){u(!1),n(null)}),300)};return{showError:function(e,t){void 0===t&&(t="error"),console.log("showError called:",{message:e,errorType:t,visible:c,isAnimating:f}),e?(n(e),s(t),u(!0),setTimeout((function(){p(!0)}),50),setTimeout((function(){g()}),5e3)):g()},renderErrorNotification:function(){if(console.log("renderErrorNotification called:",{visible:c,error:t,isAnimating:f,type:i}),!c||!t)return null;var e,n=function(){switch(i){case"success":return{icon:(0,a.jsx)(At,{size:16}),color:"#059669",bgColor:"#ECFDF5",borderColor:"#10B981"};case"warning":return{icon:(0,a.jsx)(zt,{size:16}),color:"#D97706",bgColor:"#FFFBEB",borderColor:"#F59E0B"};case"info":return{icon:(0,a.jsx)($t,{size:16}),color:"#2563EB",bgColor:"#EFF6FF",borderColor:"#3B82F6"};default:return{icon:(0,a.jsx)(Xt,{size:16}),color:"#DC2626",bgColor:"#FEF2F2",borderColor:"#EF4444"}}}(),r=n.icon,o=n.color,s=n.bgColor,l=n.borderColor,u=(e=t).includes("401")||e.includes("Unauthorized")||e.includes("Authentication")?"API Authentication failed: Please check your API key in Settings.":e.includes("429")||e.includes("Rate limit")?"API rate limit exceeded: Please try again in a few minutes.":e.includes("500")||e.includes("502")||e.includes("503")||e.includes("504")?"AI service is currently unavailable. Please try again later.":e.includes("key is missing")||e.includes("API key")?"API key is missing or invalid. Please check your settings.":e.includes("OpenAI")?"OpenAI API error: ".concat(e.split("OpenAI").pop()):e.includes("Groq")?"Groq API error: ".concat(e.split("Groq").pop()):e;return(0,a.jsxs)("div",Is({style:{transform:f?"translateX(0)":"translateX(100%)",opacity:f?1:0,transition:"all 0.3s ease-out",backgroundColor:s,border:"1px solid ".concat(l),borderRadius:"12px",padding:"16px",minWidth:"280px",maxWidth:"320px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",position:"relative",display:"flex",alignItems:"flex-start",gap:"12px",marginBottom:"8px"},role:"alert","aria-live":"polite"},{children:[(0,a.jsx)("div",Is({style:{color:o,marginTop:"2px",flexShrink:0}},{children:r})),(0,a.jsx)("div",Is({style:{flex:1,paddingRight:"8px"}},{children:(0,a.jsx)("p",Is({style:{color:"#374151",margin:0,fontSize:"14px",lineHeight:"1.5",fontWeight:500}},{children:u}))})),(0,a.jsx)("button",Is({onClick:g,style:{position:"absolute",top:"8px",right:"8px",background:"transparent",border:"none",color:"#9CA3AF",cursor:"pointer",padding:"4px",borderRadius:"4px",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="rgba(0, 0, 0, 0.1)",e.currentTarget.style.color="#374151"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="#9CA3AF"},"aria-label":"Close notification"},{children:(0,a.jsx)(Zt,{size:12})})),(0,a.jsx)("div",Is({style:{position:"absolute",bottom:0,left:0,right:0,height:"3px",backgroundColor:"rgba(0, 0, 0, 0.1)",borderRadius:"0 0 12px 12px",overflow:"hidden"}},{children:(0,a.jsx)("div",{style:{height:"100%",backgroundColor:l,width:"100%",transition:"width 5s linear",transformOrigin:"left"}})}))]}))}}};var _s=function(){return _s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},_s.apply(this,arguments)},Fs=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},Ts="anki_stored_cards",js="anki_tab_cards",Os=function(e){try{return e.startsWith("data:image/")&&e.length>1e5?(console.log("Large image detected, applying basic compression"),console.warn("Large image (".concat(Math.round(e.length/1024),"KB) detected. Consider using smaller images.")),e):e}catch(t){return console.error("Error compressing image:",t),e}},Ps=function(e){try{var t=JSON.stringify(e,(function(e,t){return t instanceof Date?t.toISOString():t})),n=new Blob([t]).size/1048576;if(console.log("Storage analysis: ".concat(e.length," cards, ").concat(n.toFixed(2),"MB")),n<4)return e;console.warn("Storage size is large, optimizing...");for(var r=Fs([],e,!0).sort((function(e,t){return new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()})),o=[],a=0,i=0,s=r;i<s.length;i++){var l=s[i],c=JSON.stringify(l,(function(e,t){return t instanceof Date?t.toISOString():t})),u=new Blob([c]).size;if(a+u>4194304){console.warn("Stopping at ".concat(o.length," cards to stay within storage limit"));break}o.push(l),a+=u}return o}catch(t){return console.error("Error managing storage quota:",t),e}},Rs=function(){console.warn("⚠️ Storage quota exceeded! This usually happens when you have many cards with large images."),console.warn("💡 To fix this:"),console.warn("   • Use smaller images"),console.warn("   • Export older cards and delete them"),console.warn("   • Consider using image URLs instead of embedded images")},Ns=function(){try{var e=localStorage.getItem(Ts);if(console.log("Loading cards from localStorage. Data exists:",!!e),e)try{var t=JSON.parse(e);if(console.log("Successfully parsed cards from localStorage, total count:",t.length),t.length>0){var n=t.slice(0,Math.min(3,t.length)),r=t.length>3?t.slice(-3):[];console.log("First few cards:",n.map((function(e){var t;return{id:e.id,text:null===(t=e.text)||void 0===t?void 0:t.substring(0,20)}}))),r.length>0&&console.log("Last few cards:",r.map((function(e){var t;return{id:e.id,text:null===(t=e.text)||void 0===t?void 0:t.substring(0,20)}})))}if(!Array.isArray(t))return console.error("Stored cards is not an array!",t),[];var o=t.filter((function(e){var t=!!e.id,n=!!e.text,r=!!e.createdAt;return!!(t&&n&&r)||(console.warn("Found invalid card, removing from results:",e),!1)}));console.log("Card validation: ".concat(o.length," valid out of ").concat(t.length," total"));var a=o.map((function(e){return _s(_s({},e),{createdAt:new Date(e.createdAt)})})),i=a.filter((function(e){return e.image||e.imageUrl}));return console.log("Loaded cards with images:",i.length),i.forEach((function(e){var t,n,r,o;console.log("Loaded card ".concat(e.id," image data:"),{hasImage:!!e.image,hasImageUrl:!!e.imageUrl,imageLength:null===(t=e.image)||void 0===t?void 0:t.length,imageUrlLength:null===(n=e.imageUrl)||void 0===n?void 0:n.length,imagePreview:null===(r=e.image)||void 0===r?void 0:r.substring(0,50),imageUrlPreview:null===(o=e.imageUrl)||void 0===o?void 0:o.substring(0,50)})})),a}catch(e){return console.error("JSON parse error:",e),localStorage.removeItem(Ts),[]}}catch(e){console.error("Error loading cards from localStorage:",e);try{localStorage.removeItem(Ts)}catch(e){console.error("Could not clean up localStorage:",e)}}return[]},Ls=function(e,t,n){var r="".concat(js,"_").concat(e);try{var o=JSON.stringify(t,(function(e,t){return t instanceof Date?t.toISOString():t}));new Blob([o]).size}catch(e){console.error("Could not determine original size:",e)}if(n instanceof DOMException&&("QuotaExceededError"===n.name||"NS_ERROR_DOM_QUOTA_REACHED"===n.name)){console.error("localStorage quota exceeded for tab ".concat(e,". Using storage optimization.")),Rs();var a=Ps(t);try{var i=JSON.stringify(a,(function(e,t){return t instanceof Date?t.toISOString():t}));localStorage.setItem(r,i),console.warn("Smart optimization for tab ".concat(e,": Saved ").concat(a.length," of ").concat(t.length," cards"))}catch(t){console.error("Failed to save optimized cards for tab ".concat(e,":"),t)}}};const Bs=function(e){return function(t){return function(n){var r=t(n);switch(n.type){case ge:try{var o=Ns();e.dispatch({type:"SET_STORED_CARDS",payload:o})}catch(t){console.error("Error in LOAD_STORED_CARDS middleware:",t),e.dispatch({type:"SET_STORED_CARDS",payload:[]})}break;case pe:case he:case xe:case ye:try{!function(e){try{console.log("Saving cards to localStorage:",e),console.log("Total cards count:",e.length);var t=e.filter((function(e){return e.image||e.imageUrl}));console.log("Cards with images:",t.length),t.forEach((function(e){var t,n,r,o;console.log("Card ".concat(e.id," image data:"),{hasImage:!!e.image,hasImageUrl:!!e.imageUrl,imageLength:null===(t=e.image)||void 0===t?void 0:t.length,imageUrlLength:null===(n=e.imageUrl)||void 0===n?void 0:n.length,imagePreview:null===(r=e.image)||void 0===r?void 0:r.substring(0,50),imageUrlPreview:null===(o=e.imageUrl)||void 0===o?void 0:o.substring(0,50)})}));var n=Ps(e);n.length<e.length&&console.warn("Storage optimization: keeping ".concat(n.length," of ").concat(e.length," cards to preserve images"));var r=JSON.stringify(n,(function(e,t){return t instanceof Date?t.toISOString():t})),o=new Blob([r]).size;console.log("Storage size in bytes:",o,"Approximate max size: ~5MB"),o>4194304&&console.warn("Warning: localStorage size is getting large (>4MB). This might cause issues in some browsers."),localStorage.setItem(Ts,r),console.log("Cards saved successfully to localStorage with image preservation")}catch(t){console.error("Error saving cards to localStorage:",t);var a=0;try{var i=JSON.stringify(e,(function(e,t){return t instanceof Date?t.toISOString():t}));a=new Blob([i]).size}catch(e){console.error("Could not determine original size:",e)}if(t instanceof DOMException&&("QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&(console.error("localStorage quota exceeded. Cannot save more cards. Trying to preserve images by using other strategies."),Rs(),e.length>0)){console.warn("CRITICAL: Storage quota exceeded. Attempting to preserve images while managing storage.");try{console.warn("Storage quota exceeded. Using intelligent optimization to preserve images...");var s=Ps(e);if(s.length>0){var l=JSON.stringify(s,(function(e,t){return t instanceof Date?t.toISOString():t}));if(new Blob([l]).size<=4718592)return localStorage.setItem(Ts,l),void console.warn("Smart optimization: Saved ".concat(s.length," of ").concat(e.length," cards with images preserved"))}var c=e.map((function(e){return _s(_s({},e),{image:e.image?Os(e.image):null,id:e.id,text:e.text,translation:e.translation,front:e.front,back:e.back,examples:e.examples,imageUrl:e.imageUrl,createdAt:e.createdAt,exportStatus:e.exportStatus,linguisticInfo:e.linguisticInfo,transcription:e.transcription})}));console.warn("Attempting to save cards with compressed images instead of removing them.");var u=JSON.stringify(c,(function(e,t){return t instanceof Date?t.toISOString():t})),d=new Blob([u]).size;if(console.log("Reduced size from ".concat(a," to ").concat(d," bytes")),d>4718592){console.warn("Still too large after size reduction, falling back to limiting card count");for(var f=Fs([],c,!0).sort((function(e,t){return new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime()})),p=Math.min(10,f.length),g=void 0;p<f.length;){g=f.slice(0,p);var h=JSON.stringify(g,(function(e,t){return t instanceof Date?t.toISOString():t}));if(new Blob([h]).size>4718592)break;p+=5}console.warn("Emergency preservation: keeping ".concat(p," cards out of ").concat(f.length," total (removing oldest to preserve newest with images)"));var m=f.slice(-p);localStorage.setItem(Ts,JSON.stringify(m,(function(e,t){return t instanceof Date?t.toISOString():t})))}else localStorage.setItem(Ts,u);return void console.log("Saved cards with image preservation strategy to fit within quota")}catch(e){console.error("Failed to save with data reduction:",e)}}}}(e.getState().cards.storedCards)}catch(e){console.error("Error in card storage middleware:",e)}break;case O:case P:case L:case N:try{var a=e.getState().tabState.tabStates,i=n.payload.tabId;if(i&&a[i])!function(e,t){try{var n="".concat(js,"_").concat(e);console.log("Saving ".concat(t.length," cards for tab ").concat(e));var r=Ps(t),o=JSON.stringify(r,(function(e,t){return t instanceof Date?t.toISOString():t}));localStorage.setItem(n,o),console.log("Successfully saved ".concat(r.length," cards for tab ").concat(e))}catch(n){console.error("Error saving cards for tab ".concat(e,":"),n),Ls(e,t,n)}}(i,a[i].storedCards)}catch(e){console.error("Error in tab storage middleware:",e)}break;case ve:n.payload?localStorage.setItem("current_card_id",n.payload):(localStorage.removeItem("current_card_id"),localStorage.removeItem("explicitly_saved"));break;case ie:0===e.getState().cards.storedCards.length&&e.dispatch({type:ge})}return r}}};var zs,Ds=function(){return Ds=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Ds.apply(this,arguments)};!function(e){e.OpenAI="openai",e.Groq="groq"}(zs||(zs={}));var Ms,Us={openAiKey:"",mode:_.LanguageLearning,translateToLanguage:"ru",ankiConnectUrl:"http://127.0.0.1:8765",ankiConnectApiKey:null,useAnkiConnect:!1,visibleSideBar:!0,groqApiKey:"",groqModelName:"llama3-8b-8192",shouldGenerateImage:!0,imageGenerationMode:"smart",translationPrompt:"",examplesPrompt:"",aiInstructions:"",imageInstructions:"",modelProvider:zs.OpenAI,sourceLanguage:"en"},$s=function(e,t,n){var r="".concat(e," - ");return r+=401===t?"Authentication error. Please check your API key.":429===t?"Rate limit exceeded. Please try again later.":500===t||503===t?"Service unavailable. The model might be overloaded or offline.":400===t?"Bad request. The input may be invalid.":"Error code ".concat(t,". ").concat(Ws(n))},Ws=function(e){if(!e)return"Unknown error";if(e.error){if("string"==typeof e.error)return e.error;if(e.error.message)return e.error.message;if(e.error.type)return"Error type: ".concat(e.error.type)}if(e.message)return e.message;try{return JSON.stringify(e)}catch(e){return"Unable to parse error details"}},Vs=(Ms=function(e,t){return Ms=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},Ms(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}Ms(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),qs=function(){return qs=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},qs.apply(this,arguments)},Gs=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},Hs=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},Ks=function(){function e(e,t){void 0===t&&(t=""),this.apiKey=e,this.modelName=t}return e.prototype.extractPlainText=function(e){if(!e)return null;var t=e.replace(/<\/?[^>]+(>|$)/g,"");return t=t.replace(/^#+\s+/gm,"").replace(/\*\*(.*?)\*\*/g,"$1").replace(/\*(.*?)\*/g,"$1").replace(/`(.*?)`/g,"$1").replace(/```[\s\S]*?```/g,"").replace(/\[(.*?)\]\((.*?)\)/g,"$1").trim()},e.prototype.getPrompts=function(){return{translate:function(e,t){return"Translate the following text to ".concat(t,': "').concat(e,'". \nOutput ONLY the direct translation, without any additional text, explanations, quotes, examples, or formatting.\nProvide the most common and appropriate translation. Only include multiple meanings if the word has distinctly different translations that are equally common.\nIf multiple translations are needed, separate them with commas (e.g., "перевод1, перевод2, перевод3").\nDo not include definitions, examples, notes, or part of speech information in English like (noun), (verb), (adjective), etc.\nOnly provide the clean translated word or phrase without any parenthetical information.')},examples:function(e,t){var n=t?"Give me exactly three example sentences using the word '".concat(e,"' in the language with code \"").concat(t,'".'):"Give me exactly three example sentences using the word '".concat(e,"' in its original language.");return"".concat(n,"\nEach sentence should show natural usage of '").concat(e,"' in that language.\nFormat your response as follows:\n1. [First example sentence here]\n2. [Second example sentence here] \n3. [Third example sentence here]\nDo not include definitions, explanations, or translations, ONLY the numbered example sentences as shown above.")},imageDescription:function(e){return'Create a short visual description of the word/concept "'.concat(e,'" for image generation.\nThe description should be concrete, visual, and focus on representational elements.\nKeep the description under 50 words and make sure it is purely descriptive without any formatting.')}}},e.prototype.translateText=function(e,t,n){return void 0===t&&(t="ru"),void 0===n&&(n=""),Gs(this,void 0,void 0,(function(){var r,o,a,i,s,l,c,u;return Hs(this,(function(d){switch(d.label){case 0:return d.trys.push([0,2,,3]),r=this.getPrompts().translate(e,t),o=n?"".concat(r,". ").concat(n):r,[4,this.sendRequest(o)];case 1:return(a=d.sent())?(i=this.extractPlainText(a))&&(i=i.replace(/^translation[:\s-]*/i,"").replace(/^["']|["']$/g,"").replace(/^.*?:\s*/i,"").replace(/^\s*-\s*/,"").replace(/^translated\s*as\s*:?\s*/i,"").replace(/^перевод\s*:?\s*/i,"").replace(/\s*definition:[\s\S]*$/i,"").replace(/\s*examples:[\s\S]*$/i,"").replace(/\s*example:[\s\S]*$/i,"").replace(/\s*example sentences:[\s\S]*$/i,"").replace(/\s*примеры:[\s\S]*$/i,"").replace(/\s*пример:[\s\S]*$/i,"").replace(/\s*notes:[\s\S]*$/i,"").replace(/\s*определение:[\s\S]*$/i,"").replace(/\s*here is the response[\s\S]*$/i,"").replace(/\s*\(adjective\)[\s\S]*$/i,"").replace(/\s*\(noun\)[\s\S]*$/i,"").replace(/\s*\(verb\)[\s\S]*$/i,"").replace(/\s*\(adverb\)[\s\S]*$/i,"").replace(/\s*\(preposition\)[\s\S]*$/i,"").replace(/\s*\(pronoun\)[\s\S]*$/i,"").replace(/\s*\(conjunction\)[\s\S]*$/i,"").replace(/\s*\(interjection\)[\s\S]*$/i,"").replace(/\s*\([^)]*\)[\s\S]*$/i,"").replace(/^the word[\s\S]*translated as[\s:]*/i,"").replace(/^словосочетание[\s\S]*переводится как[\s:]*/i,"").replace(/^слово[\s\S]*переводится как[\s:]*/i,"").replace(/^.*?это[\s:]*/i,"").replace(/^.*?означает[\s:]*/i,"").replace(/^.*?means[\s:]*/i,"").replace(/^the translation is[\s:]*/i,"").split("\n")[0].trim(),s=i.split(/\s+/),i.includes(",")?(l=i.split(",").map((function(e){return e.trim()})).filter((function(e){return e.length>0})).slice(0,3),i=l.join(", ")):s.length>8&&((c=e.split(/\s+/).length)<=5||s.length<=2*c||(console.log("Translation too long, trimming:",i),i=s.slice(0,8).join(" "))),!i&&a)?[2,a.split("\n")[0].trim()]:(console.log("Original translation:",a),console.log("Cleaned translation:",i),[2,i]):[2,null];case 2:throw u=d.sent(),console.error("Error during translation:",u),u;case 3:return[2]}}))}))},e.prototype.getExamples=function(e,t,n,r,o){return void 0===n&&(n=!1),void 0===r&&(r=""),Gs(this,void 0,void 0,(function(){var a,i,s,l,c,u,d,f,p,g,h,m,y,x,v;return Hs(this,(function(b){switch(b.label){case 0:return b.trys.push([0,9,,10]),a=this.getPrompts().examples(e,o),i=r?"".concat(a," ").concat(r.replace(/\{word\}/g,e)):a,[4,this.sendRequest(i)];case 1:if(!(s=b.sent()))throw new Error("Failed to generate examples. Please try again with a different word.");for(console.log("Raw examples response:",s),l=this.extractPlainText(s)||"",c=l.replace(/^[\s\S]*?((?:\d+\s*\.\s*|•\s*|[\-\*]\s*).+$)/m,"$1").trim(),u=/(?:^|\n)(?:\d+\s*\.\s*|•\s*|[\-\*]\s*)(.+?)(?=(?:\n+(?:\d+\s*\.\s*|•\s*|[\-\*]\s*)|\n*$))/g,d=[],f=void 0;null!==(f=u.exec(c));)f[1]&&d.push(f[1].trim());0===d.length&&(d=c.split(/\n+/).map((function(e){return e.replace(/^\d+\s*\.\s*|^\s*•\s*|^\s*[\-\*]\s*/,"").trim()})).filter((function(t){return t.length>0&&t.toLowerCase().includes(e.toLowerCase())})).slice(0,3)),0===d.length&&(d=c.split(/\n+/).map((function(e){return e.replace(/^\d+\s*\.\s*|^\s*•\s*|^\s*[\-\*]\s*/,"").trim()})).filter((function(e){return e.length>0})).slice(0,3)),d=d.map((function(e){return e.replace(/^(example|sentence|пример|предложение)[\s:]*/i,"").replace(/^["']|["']$/g,"")})),console.log("Processed examples:",d),p=[],g=0,h=d,b.label=2;case 2:if(!(g<h.length))return[3,8];if(!(m=h[g]).trim())return[3,7];if(y=null,!n)return[3,6];b.label=3;case 3:return b.trys.push([3,5,,6]),[4,this.translateText(m,t)];case 4:return y=b.sent(),[3,6];case 5:return x=b.sent(),console.error("Error translating example:",x),[3,6];case 6:if(p.push([m,y]),p.length>=3)return[3,8];b.label=7;case 7:return g++,[3,2];case 8:if(0===p.length)throw new Error("Could not generate examples. Please try again with a different word or check your API key.");return[2,p];case 9:throw v=b.sent(),console.error("Error getting examples:",v),v;case 10:return[2]}}))}))},e.prototype.getDescriptionImage=function(e,t){return void 0===t&&(t=""),Gs(this,void 0,void 0,(function(){var n,r,o,a;return Hs(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),n=this.getPrompts().imageDescription(e),r=t?"".concat(n," ").concat(t):n,[4,this.sendRequest(r)];case 1:if(!(o=i.sent()))throw new Error("Failed to generate image description. Please try again.");return[2,this.extractPlainText(o)||o];case 2:throw a=i.sent(),console.error("Error generating image description:",a),a;case 3:return[2]}}))}))},e.prototype.generateAnkiFront=function(e){return Gs(this,void 0,void 0,(function(){var t,n,r,o;return Hs(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),t='For the word or phrase "'.concat(e,'", provide ONLY the word itself without any pronunciation or additional formatting.\nJust return the clean word/phrase as it should appear on the front of an Anki card.\nFor example: if input is "hello", return "hello"\nIf input is "beautiful", return "beautiful"\nYour response should contain ONLY the word/phrase, no pronunciation, no IPA, no additional text.'),[4,this.sendRequest(t)];case 1:return(n=a.sent())?(r=(r=this.extractPlainText(n)||n).split("\n")[0].replace(/^["']|["']$/g,"").replace(/\/.*?\//g,"").replace(/\[.*?\]/g,"").replace(/\(.*?\)/g,"").replace(/^front:[\s:]*/i,"").replace(/^word:[\s:]*/i,"").trim(),console.log("Front card response:",r),[2,r||e]):[2,e];case 2:return o=a.sent(),console.error("Error generating Anki front:",o),[2,e];case 3:return[2]}}))}))},e.prototype.createTranscription=function(e,t,n){return Gs(this,void 0,void 0,(function(){var r,o,a;return Hs(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),r=this.createTranscriptionPrompt(e,t,n),[4,this.sendRequest(r)];case 1:return(o=i.sent())?[2,this.parseTranscriptionResponse(o)]:[2,null];case 2:return a=i.sent(),console.error("Error creating transcription:",a),[2,null];case 3:return[2]}}))}))},e.prototype.createTranscriptionPrompt=function(e,t,n){return'Create transcriptions for the word/phrase "'.concat(e,'" (in ').concat(t,"):\n\n1. User language transcription: Show how to pronounce this word using ").concat(n,' phonetics/script\n2. IPA transcription: International Phonetic Alphabet notation\n\nIMPORTANT:\n- For user language: Write how "').concat(e,'" sounds using ').concat(n," pronunciation system\n- For IPA: Use proper IPA symbols [ˈ ˌ ə ɪ ɛ æ ɑ ɔ ʊ ʌ θ ð ʃ ʒ ʧ ʤ ŋ etc.]\n- Format exactly as shown below:\n\nUSER_LANG: [how the word sounds in ").concat(n,']\nIPA: [ˈaɪ.pi.eɪ notation]\n\nExample for Russian "короткая" with Spanish user language:\nUSER_LANG: korotkaya\nIPA: [kəˈrotkəjə]\n\nProvide ONLY the two lines as shown above, no additional text.')},e.prototype.parseTranscriptionResponse=function(e){var t=this.extractPlainText(e)||e,n=null,r=null,o=t.match(/USER_LANG:\s*(.+)/i);o&&(n=o[1].trim());var a=t.match(/IPA:\s*(.+)/i);return a&&(r=a[1].trim().replace(/^\[|\]$/g,"").replace(/^\/|\/$/g,""))&&!r.startsWith("[")&&(r="[".concat(r,"]")),{userLanguageTranscription:n,ipaTranscription:r}},e}(),Ys=function(e){function t(t,n){void 0===n&&(n="gpt-3.5-turbo");var r=e.call(this,t,n)||this;return r.openai=new Ss({apiKey:t,dangerouslyAllowBrowser:!0}),r}return Vs(t,e),t.prototype.sendRequest=function(e,t){var n,r,o;return void 0===t&&(t={}),Gs(this,void 0,void 0,(function(){var a,i;return Hs(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this.openai.chat.completions.create(qs({model:this.modelName,messages:[{role:"user",content:e}]},t))];case 1:return a=s.sent(),[2,(null===(o=null===(r=null===(n=a.choices[0])||void 0===n?void 0:n.message)||void 0===r?void 0:r.content)||void 0===o?void 0:o.trim())||null];case 2:throw i=s.sent(),console.error("Error in OpenAI request:",i),i;case 3:return[2]}}))}))},t.prototype.getImageUrl=function(e){var t,n;return Gs(this,void 0,void 0,(function(){var r,o;return Hs(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this.openai.images.generate({model:"dall-e-3",prompt:e,n:1,size:"1024x1024"})];case 1:return r=a.sent(),[2,(null===(n=null===(t=r.data)||void 0===t?void 0:t[0])||void 0===n?void 0:n.url)||null];case 2:throw o=a.sent(),console.error("Error generating image with OpenAI:",o),o;case 3:return[2]}}))}))},t.prototype.extractKeyTerms=function(e){return Gs(this,void 0,void 0,(function(){var t,n,r,o;return Hs(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),t="You are a helpful language learning assistant. Extract key terms from the text that would be useful to learn as flashcards. Limit to 5 most important terms max. Return only the terms, one per line, without any additional text or formatting.",[4,this.sendRequest(t,{messages:[{role:"system",content:t},{role:"user",content:e}]})];case 1:return n=a.sent(),(r=n||"")?[2,r.split("\n").map((function(e){return e.trim()})).filter((function(e){return e.length>0}))]:[2,[]];case 2:return o=a.sent(),console.error("Error extracting key terms with OpenAI:",o),[2,[]];case 3:return[2]}}))}))},t.prototype.createChatCompletion=function(e,t){var n,r,o;return Gs(this,void 0,void 0,(function(){var e,a,i,s;return Hs(this,(function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),e=t.map((function(e){return{role:e.role,content:e.content}})),[4,this.openai.chat.completions.create({model:this.modelName,messages:e})];case 1:return a=l.sent(),(i=(null===(o=null===(r=null===(n=a.choices[0])||void 0===n?void 0:n.message)||void 0===r?void 0:r.content)||void 0===o?void 0:o.trim())||"")?[2,{content:i}]:[2,null];case 2:throw s=l.sent(),console.error("Error in OpenAI chat completion:",s),s;case 3:return[2]}}))}))},t}(Ks),Qs=function(e){function t(t,n){void 0===n&&(n="llama3-8b-8192");var r=e.call(this,t,n)||this;return r.apiBaseUrl="https://api.groq.com/openai/v1",r}return Vs(t,e),t.prototype.sendRequest=function(e,t){var n,r,o,a,i;return void 0===t&&(t={}),Gs(this,void 0,void 0,(function(){var s,l,c,u;return Hs(this,(function(d){switch(d.label){case 0:if(d.trys.push([0,5,,6]),!this.apiKey)throw new Error("Groq API key is missing. Please check your settings.");return[4,fetch("".concat(this.apiBaseUrl,"/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)},body:JSON.stringify({model:this.modelName,messages:[{role:"user",content:e}],max_tokens:t.max_tokens||1e3})})];case 1:return(s=d.sent()).ok?[3,3]:[4,s.json()];case 2:throw l=d.sent(),new Error($s("Groq API Error",s.status,l));case 3:return[4,s.json()];case 4:return c=d.sent(),[2,null!==(i=null===(a=null===(o=null===(r=null===(n=c.choices)||void 0===n?void 0:n[0])||void 0===r?void 0:r.message)||void 0===o?void 0:o.content)||void 0===a?void 0:a.trim())&&void 0!==i?i:null];case 5:throw u=d.sent(),console.error("Error in Groq API request:",u),u;case 6:return[2]}}))}))},t.prototype.getImageUrl=function(){throw new Error("Image generation is not supported by Groq.")},t.prototype.extractKeyTerms=function(e){return Gs(this,void 0,void 0,(function(){var t,n,r,o;return Hs(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),t="You are a helpful language learning assistant. Extract key terms from the text that would be useful to learn as flashcards. Limit to 5 most important terms max. Return only the terms, one per line, without any additional text or formatting.",[4,this.sendRequest(t,{messages:[{role:"system",content:t},{role:"user",content:e}]})];case 1:return n=a.sent(),(r=n||"")?[2,r.split("\n").map((function(e){return e.trim()})).filter((function(e){return e.length>0}))]:[2,[]];case 2:return o=a.sent(),console.error("Error extracting key terms with Groq:",o),[2,[]];case 3:return[2]}}))}))},t.prototype.createChatCompletion=function(e,t){var n,r,o,a,i;return Gs(this,void 0,void 0,(function(){var e,s,l,c,u;return Hs(this,(function(d){switch(d.label){case 0:if(d.trys.push([0,5,,6]),!this.apiKey)throw new Error("Groq API key is missing. Please check your settings.");return[4,fetch("".concat(this.apiBaseUrl,"/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)},body:JSON.stringify({model:this.modelName,messages:t,max_tokens:1e3})})];case 1:return(e=d.sent()).ok?[3,3]:[4,e.json()];case 2:throw s=d.sent(),new Error($s("Groq API Error",e.status,s));case 3:return[4,e.json()];case 4:return l=d.sent(),(c=null!==(i=null===(a=null===(o=null===(r=null===(n=l.choices)||void 0===n?void 0:n[0])||void 0===r?void 0:r.message)||void 0===o?void 0:o.content)||void 0===a?void 0:a.trim())&&void 0!==i?i:"")?[2,{content:c}]:[2,null];case 5:throw u=d.sent(),console.error("Error in Groq chat completion:",u),u;case 6:return[2]}}))}))},t}(Ks),Js=function(e,t,n){switch(void 0===n&&(n=""),e){case zs.OpenAI:return new Ys(t,n||"gpt-3.5-turbo");case zs.Groq:return new Qs(t,n||"llama3-8b-8192");default:return new Ys(t,n||"gpt-3.5-turbo")}},Xs=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},Zs=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},el=function(e){return function(e){return{translateText:function(t,n,r,o,a){return void 0===r&&(r="ru"),void 0===o&&(o=""),Xs(void 0,void 0,void 0,(function(){return Zs(this,(function(i){if(null==a?void 0:a.aborted)throw new Error("Request cancelled");return[2,Js(e,t).translateText(n,r,o)]}))}))},getExamples:function(t,n,r,o,a,i,s){return void 0===o&&(o=!1),void 0===a&&(a=""),Xs(void 0,void 0,void 0,(function(){return Zs(this,(function(l){if(null==s?void 0:s.aborted)throw new Error("Request cancelled");return[2,Js(e,t).getExamples(n,r,o,a,i)]}))}))},getDescriptionImage:function(t,n,r,o){return void 0===r&&(r=""),Xs(void 0,void 0,void 0,(function(){return Zs(this,(function(a){if(null==o?void 0:o.aborted)throw new Error("Request cancelled");return[2,Js(e,t).getDescriptionImage(n,r)]}))}))},getImageUrl:function(t,n){return Xs(void 0,void 0,void 0,(function(){var r;return Zs(this,(function(o){return[2,(r=Js(e,t)).getImageUrl?r.getImageUrl(n):null]}))}))},generateAnkiFront:function(t,n,r){return Xs(void 0,void 0,void 0,(function(){return Zs(this,(function(o){if(null==r?void 0:r.aborted)throw new Error("Request cancelled");return[2,Js(e,t).generateAnkiFront(n)]}))}))},extractKeyTerms:function(t,n){return Xs(void 0,void 0,void 0,(function(){return Zs(this,(function(r){return[2,Js(e,t).extractKeyTerms(n)]}))}))},createChatCompletion:function(t,n){return Xs(void 0,void 0,void 0,(function(){var r;return Zs(this,(function(o){return(r=Js(e,t)).createChatCompletion?[2,r.createChatCompletion(t,n)]:(console.error("createChatCompletion not implemented in the provider"),[2,null])}))}))},createTranscription:function(t,n,r,o){return Xs(void 0,void 0,void 0,(function(){return Zs(this,(function(a){return[2,Js(e,t).createTranscription(n,r,o)]}))}))}}}(e)},tl=function(e,t,n,r,o,a,i){return Xs(void 0,void 0,void 0,(function(){var a,s;return Zs(this,(function(l){switch(l.label){case 0:if(l.trys.push([0,2,,3]),!t)throw new Error("API key is missing. Please check your settings.");return[4,e.translateText(t,n,r,o,i)];case 1:return a=l.sent(),[2,{original:n,translated:a}];case 2:throw s=l.sent(),console.error("Error in unified translation:",s),s instanceof Error?s:new Error("Failed to translate text. Please check your API key and settings.");case 3:return[2]}}))}))},nl=function(e,t,n,r,o,a,i,s){return void 0===o&&(o=!1),Xs(void 0,void 0,void 0,(function(){var l;return Zs(this,(function(c){switch(c.label){case 0:if(c.trys.push([0,2,,3]),!t)throw new Error("API key is missing. Please check your settings.");return[4,e.getExamples(t,n,r,o,a,i,s)];case 1:return[2,c.sent().map((function(e){return{original:e[0],translated:e[1]}}))];case 2:throw l=c.sent(),console.error("Error in unified examples generation:",l),l instanceof Error?l:new Error("Failed to generate examples. Please check your API key and settings.");case 3:return[2]}}))}))},rl=function(e,t,n,r){return Xs(void 0,void 0,void 0,(function(){var o,a;return Zs(this,(function(i){switch(i.label){case 0:if(i.trys.push([0,2,,3]),!t)throw new Error("API key is missing. Please check your settings.");return[4,e.generateAnkiFront(t,n,r)];case 1:if(!(o=i.sent()))throw new Error("Failed to generate flashcard content. Please try again or check your API key.");return[2,{front:o}];case 2:throw a=i.sent(),console.error("Error in unified flashcard creation:",a),a instanceof Error?a:new Error("Failed to create flashcard. Please check your API key and settings.");case 3:return[2]}}))}))},ol=function(e,t,n,r,o){return void 0===o&&(o="ru"),Xs(void 0,void 0,void 0,(function(){var a,i;return Zs(this,(function(s){switch(s.label){case 0:if(s.trys.push([0,2,,3]),!t)throw new Error("API key is missing. Please check your settings.");return[4,e.createTranscription(t,n,r,o)];case 1:if(!(a=s.sent()))throw new Error("Failed to generate transcription. Please try again or check your API key.");return[2,a];case 2:throw i=s.sent(),console.error("Error in unified transcription creation:",i),i instanceof Error?i:new Error("Failed to create transcription. Please check your API key and settings.");case 3:return[2]}}))}))};function al(e,t,n,r,o){return void 0===o&&(o="ru"),Xs(this,void 0,void 0,(function(){var a,i,s,l;return Zs(this,(function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),console.log('Creating linguistic info for "'.concat(n,'" in ').concat(r,", interface: ").concat(o)),a=function(e,t,n){void 0===n&&(n="ru");var r=function(e){switch(e){case"ru":return{name:"RUSSIAN",terms:"Глагол, Существительное, Прилагательное, Наречие",gender:"Мужской, Женский, Средний",number:"Единственное число, Множественное число",tense:"Настоящее время, Прошедшее время, Будущее время",case:"Именительный, Родительный, Дательный, Винительный, Творительный, Предложный",person:"1-е лицо, 2-е лицо, 3-е лицо",labels:{partOfSpeech:"Часть речи",baseForm:"Основная форма",gender:"Род",number:"Число",case:"Падеж",tense:"Время/Вид",person:"Лицо/Число"},forbidden:"Verb, Noun, Adjective, Present, Past, Masculine, Feminine, Singular, Plural"};case"es":return{name:"SPANISH",terms:"Verbo, Sustantivo, Adjetivo, Adverbio",gender:"Masculino, Femenino, Neutro",number:"Singular, Plural",tense:"Presente, Pasado, Futuro",case:"Nominativo, Genitivo, Dativo, Acusativo",person:"1ª persona, 2ª persona, 3ª persona",labels:{partOfSpeech:"Categoría gramatical",baseForm:"Forma base",gender:"Género",number:"Número",case:"Caso",tense:"Tiempo/Aspecto",person:"Persona/Número"},forbidden:"Verb, Noun, Adjective, Present, Past, Masculine, Feminine, Singular, Plural"};case"fr":return{name:"FRENCH",terms:"Verbe, Nom, Adjectif, Adverbe",gender:"Masculin, Féminin, Neutre",number:"Singulier, Pluriel",tense:"Présent, Passé, Futur",case:"Nominatif, Génitif, Datif, Accusatif",person:"1ère personne, 2ème personne, 3ème personne",labels:{partOfSpeech:"Catégorie grammaticale",baseForm:"Forme de base",gender:"Genre",number:"Nombre",case:"Cas",tense:"Temps/Aspect",person:"Personne/Nombre"},forbidden:"Verb, Noun, Adjective, Present, Past, Masculine, Feminine, Singular, Plural"};case"de":return{name:"GERMAN",terms:"Verb, Substantiv, Adjektiv, Adverb",gender:"Maskulin, Feminin, Neutrum",number:"Singular, Plural",tense:"Präsens, Präteritum, Futur",case:"Nominativ, Genitiv, Dativ, Akkusativ",person:"1. Person, 2. Person, 3. Person",labels:{partOfSpeech:"Wortart",baseForm:"Grundform",gender:"Geschlecht",number:"Numerus",case:"Kasus",tense:"Tempus/Aspekt",person:"Person/Numerus"},forbidden:"English terms like Verb, Noun, Present, Past, Masculine, Feminine"};case"it":return{name:"ITALIAN",terms:"Verbo, Sostantivo, Aggettivo, Avverbio",gender:"Maschile, Femminile, Neutro",number:"Singolare, Plurale",tense:"Presente, Passato, Futuro",case:"Nominativo, Genitivo, Dativo, Accusativo",person:"1ª persona, 2ª persona, 3ª persona",labels:{partOfSpeech:"Categoria grammaticale",baseForm:"Forma base",gender:"Genere",number:"Numero",case:"Caso",tense:"Tempo/Aspetto",person:"Persona/Numero"},forbidden:"Verb, Noun, Adjective, Present, Past, Masculine, Feminine, Singular, Plural"};default:return{name:"ENGLISH",terms:"Verb, Noun, Adjective, Adverb",gender:"Masculine, Feminine, Neuter",number:"Singular, Plural",tense:"Present, Past, Future",case:"Nominative, Genitive, Dative, Accusative",person:"1st person, 2nd person, 3rd person",labels:{partOfSpeech:"Part of speech",baseForm:"Base form",gender:"Gender",number:"Number",case:"Case",tense:"Tense/Aspect",person:"Person/Number"},forbidden:"Russian, Spanish, French, German terms"}}}(n),o='You are a professional linguist creating grammar references for language learners.\n\n⚠️ CRITICAL LANGUAGE REQUIREMENTS ⚠️\n1. ONLY analyze the SOURCE TERM "'.concat(e,'" in "').concat(t,'" language\n2. DO NOT analyze any translation - ONLY the ORIGINAL TERM\n3. ALL interface labels and grammatical terms MUST be in ').concat(r.name,' ONLY\n4. Base forms of words should be in the source language "').concat(t,'"\n5. NEVER mix languages - use ONLY ').concat(r.name," throughout\n\n").concat(r.name," LANGUAGE REQUIREMENTS:\n- Use ONLY ").concat(r.name," grammatical terms: ").concat(r.terms,"\n- Use ONLY ").concat(r.name," gender terms: ").concat(r.gender,"\n- Use ONLY ").concat(r.name," number terms: ").concat(r.number,"\n- Use ONLY ").concat(r.name," tense terms: ").concat(r.tense,"\n- Use ONLY ").concat(r.name," case terms: ").concat(r.case,"\n- Use ONLY ").concat(r.name," person terms: ").concat(r.person,"\n\nFORBIDDEN TERMS:\n❌ Never use: ").concat(r.forbidden,"\n✅ Always use: ").concat(r.terms,'\n\nUSE EMOJI SYMBOLS FOR CATEGORIES:\n📚 For part of speech\n🏠 For root/base form (ONLY if current word is NOT in its base form)\n⚥ For gender\n📋 For number/form\n🎯 For case\n🕒 For tense/aspect\n👤 For person\n🎭 For mood\n🔄 For voice\n📐 For degree\n⚠️ For irregular forms\n\nHTML STRUCTURE:\n<div class="grammar-item">\n  <span class="icon-pos">📚</span> <strong>').concat(r.labels.partOfSpeech,':</strong> <span class="grammar-tag tag-pos">[').concat(r.name," term]</span>\n</div>\n\nEXAMPLE CORRECT OUTPUT (").concat(r.name,' interface):\n<div class="grammar-item">\n  <span class="icon-pos">📚</span> <strong>').concat(r.labels.partOfSpeech,':</strong> <span class="grammar-tag tag-pos">').concat(r.terms.split(",")[0].trim(),'</span>\n</div>\n<div class="grammar-item">\n  <span class="icon-root">🏠</span> <strong>').concat(r.labels.baseForm,':</strong> <span class="grammar-tag tag-root">[word in source language]</span>\n</div>\n<div class="grammar-item">\n  <span class="icon-gender">⚥</span> <strong>').concat(r.labels.gender,':</strong> <span class="grammar-tag tag-gender">').concat(r.gender.split(",")[0].trim(),"</span>\n</div>\n\nEXAMPLE WRONG OUTPUT (DO NOT DO THIS):\n❌ <strong>Part of speech:</strong> <span>Noun</span>\n❌ <strong>Gender:</strong> <span>Feminine</span>\n❌ <strong>Case:</strong> <span>Nominative</span>\n❌ <strong>Number/Form:</strong> <span>Singular</span>\n\n⚠️ CRITICAL GRAMMAR RULES for ").concat(t.toUpperCase(),':\n1. **PLURAL FORMS**: If word is plural (e.g., ends in -и, -ы, -а in Russian), DO NOT include gender\n2. **GENDER ONLY FOR SINGULAR**: Gender specification only for singular nouns/adjectives\n3. **ALWAYS INCLUDE NUMBER**: Specify if word is singular or plural\n4. **INCLUDE CASE**: For languages with cases, always specify the case\n5. **PART OF SPEECH ACCURACY**: Ensure correct classification (noun/verb/adjective/etc.)\n\nEXAMPLES OF CORRECT ANALYSIS:\n✅ "заслуги" (Russian plural): Number: Plural, Case: Nominative, NO gender\n✅ "книга" (Russian singular): Gender: Feminine, Number: Singular, Case: Nominative  \n✅ "стол" (Russian singular): Gender: Masculine, Number: Singular, Case: Nominative\n\nEXAMPLES OF WRONG ANALYSIS:\n❌ "заслуги" + Gender: Masculine (plural can\'t have gender)\n❌ "столы" + Gender: Masculine (plural can\'t have gender)\n❌ Missing number specification\n❌ Missing case specification\n\nMANDATORY REQUIREMENTS:\n1. Maximum 4-6 grammar points\n2. Each tag content: maximum 3-4 words\n3. Include comprehensive grammatical information\n4. Use ONLY ').concat(r.name," language throughout\n5. Be thorough but concise\n6. Include base form ONLY if current word is NOT in its base form\n7. ALL labels and terms must be in ").concat(r.name," consistently\n8. **NEVER specify gender for plural forms**\n9. **ALWAYS specify number (singular/plural)**\n10. **ALWAYS specify case for languages that have cases**\n\nCRITICAL: Your response must be 100% in ").concat(r.name," for all grammatical terms and labels. No mixing of languages allowed.");return o}(n,r,o),[4,e.createChatCompletion(t,[{role:"user",content:a}])];case 1:return(i=c.sent())&&i.content?((s=i.content).includes("<"),console.log("Generated linguistic info length:",(null==s?void 0:s.length)||0),[2,s]):[2,null];case 2:return l=c.sent(),console.error("Error creating linguistic info:",l),[2,null];case 3:return[2]}}))}))}function il(e,t,n,r){return'You are an expert linguist specializing in grammar validation. Your task is to verify the grammatical accuracy of a linguistic reference.\n\nANALYSIS TARGET:\n- Word/Phrase: "'.concat(e,'"\n- Source Language: ').concat(n,"\n- Interface Language: ").concat(r,"\n\nLINGUISTIC REFERENCE TO VALIDATE:\n").concat(t,'\n\nVALIDATION INSTRUCTIONS:\n1. **Analyze the source word "').concat(e,'" in ').concat(n," language ONLY**\n2. **DO NOT analyze translations** - focus only on the original word\n3. **Check grammatical consistency** according to ").concat(n," language rules\n4. **Verify logical compatibility** of grammatical characteristics\n\nSPECIFIC CHECKS FOR ").concat(n.toUpperCase(),' LANGUAGE:\n• **Part of Speech**: Verify the word classification is correct\n• **Gender**: Check if gender is appropriate (singular forms only for most languages)\n• **Number**: Ensure number is correctly identified\n• **Case**: Validate case forms match the language\'s case system\n• **Tense/Aspect**: For verbs, check tense and aspect accuracy\n• **Degree**: Comparison degrees should only apply to adjectives/adverbs, NOT nouns\n• **Morphological Features**: Verify all features are linguistically valid\n\nCOMMON ERRORS TO DETECT:\n❌ Gender specified for plural forms (where not applicable)\n❌ Comparison degrees assigned to nouns\n❌ Incorrect case systems for the language\n❌ Wrong tense/aspect combinations\n❌ Analysis of translation instead of source word\n❌ Inconsistent grammatical categories\n\nRESPONSE FORMAT:\nVALIDATION: [VALID/INVALID]\n\nERRORS:\n[List specific errors found, or "None"]\n\nCORRECTIONS:\n[Suggest specific corrections, or "None"]\n\nBe thorough and precise. Focus on grammatical accuracy for ').concat(n," language rules.")}function sl(e,t,n,r,o,a){return void 0===a&&(a="ru"),Xs(this,void 0,void 0,(function(){var i,s,l,c,u,d,f,p,g,h,m;return Zs(this,(function(y){switch(y.label){case 0:return y.trys.push([0,2,,3]),console.log('Validating linguistic info for "'.concat(n,'" in ').concat(o)),i=il(n,r,o,a),[4,e.createChatCompletion(t,[{role:"user",content:i}])];case 1:return(s=y.sent())&&s.content?(l=s.content.trim(),console.log("Validation response:",l),c=l.includes("VALIDATION: VALID")||l.includes("✅ VALID"),u=l.match(/ERRORS?:([\s\S]*?)(?:CORRECTIONS?:|$)/),d=l.match(/CORRECTIONS?:([\s\S]*?)$/),f=[],p=[],u&&u[1]&&(g=u[1].trim())&&"None"!==g&&"Нет"!==g&&f.push.apply(f,g.split("\n").filter((function(e){return e.trim()})).map((function(e){return e.replace(/^[•\-*]\s*/,"").trim()}))),d&&d[1]&&(h=d[1].trim())&&"None"!==h&&"Нет"!==h&&p.push.apply(p,h.split("\n").filter((function(e){return e.trim()})).map((function(e){return e.replace(/^[•\-*]\s*/,"").trim()}))),[2,{isValid:c,errors:f,corrections:p.length>0?p:void 0}]):[2,{isValid:!1,errors:["Failed to validate linguistic information"]}];case 2:return m=y.sent(),console.error("Error validating linguistic info:",m),[2,{isValid:!1,errors:["Validation service unavailable"]}];case 3:return[2]}}))}))}function ll(e,t,n,r,o,a,i,s){return void 0===s&&(s="ru"),Xs(this,void 0,void 0,(function(){var l,c,u;return Zs(this,(function(d){switch(d.label){case 0:return d.trys.push([0,2,,3]),console.log('Correcting linguistic info for "'.concat(n,'" based on validation errors')),l=function(e,t,n,r,o,a){var i=n.map((function(e){return"• ".concat(e)})).join("\n"),s=r.map((function(e){return"• ".concat(e)})).join("\n");return'Ты эксперт-лингвист. Исправь грамматическую справку на основе найденных ошибок.\n\nСЛОВО ДЛЯ АНАЛИЗА: "'.concat(e,'" (язык: ').concat(o,")\n\nИСХОДНАЯ СПРАВКА:\n").concat(t,"\n\nНАЙДЕННЫЕ ОШИБКИ:\n").concat(i,"\n\nРЕКОМЕНДАЦИИ ПО ИСПРАВЛЕНИЮ:\n").concat(s,'\n\nЗАДАЧА: Создай исправленную версию грамматической справки, устранив все указанные ошибки.\n\nТРЕБОВАНИЯ:\n1. Сохрани исходное HTML-форматирование\n2. Исправь только грамматические ошибки\n3. Убери неприменимые характеристики (например, род для мн.ч., степени сравнения для существительных)\n4. Все термины должны быть на языке "').concat(a,'"\n5. Анализируй только исходное слово "').concat(e,'", не его перевод\n\nВыведи ТОЛЬКО исправленную справку без дополнительных комментариев:')}(n,r,o,a,i,s),[4,e.createChatCompletion(t,[{role:"user",content:l}])];case 1:return(c=d.sent())&&c.content?[2,c.content.trim()]:[2,null];case 2:return u=d.sent(),console.error("Error correcting linguistic info:",u),[2,null];case 3:return[2]}}))}))}function cl(e,t,n,r,o,a,i){return Xs(this,void 0,void 0,(function(){var s,l,c,u,d,f,p,g,h,m,y,x,v;return Zs(this,(function(b){switch(b.label){case 0:return b.trys.push([0,2,,3]),console.log("Running ".concat(i,' validator for "').concat(n,'"')),s=function(e,t,n,r,o){var a='\nANALYSIS TARGET:\n- Word/Phrase: "'.concat(e,'"\n- Source Language: ').concat(n,"\n- Interface Language: ").concat(r,"\n\nLINGUISTIC REFERENCE TO VALIDATE:\n").concat(t);switch(o){case"morphology":return"".concat(a,"\n\n🔬 MORPHOLOGY SPECIALIST VALIDATION\n\nYou are a specialist in morphological analysis. Focus EXCLUSIVELY on word formation and morphological features:\n\nPRIMARY CHECKS:\n• **Part of Speech**: Is the word classification accurate?\n• **Morphological Form**: Are inflectional forms correctly identified?\n• **Gender/Number/Case**: Are these consistent with ").concat(n," morphology?\n• **Base Form**: Is the root/lemma correctly identified?\n• **Morphological Categories**: Do the features match the word class?\n\nCRITICAL ERROR DETECTION for ").concat(n.toUpperCase(),":\n❌ **Gender for plural forms**: In most languages (Russian, English, etc.), gender should NOT be specified for plural forms\n❌ **Impossible morphological combinations**: Check if all features can coexist\n❌ **Missing essential features**: Ensure number, case (where applicable) are present\n❌ **Wrong part of speech**: Verify the word actually belongs to the stated category\n\nSPECIFIC ").concat(n.toUpperCase(),' RULES:\n• If word ends in -и, -ы, -а (plural markers), check if it\'s truly plural\n• Plural nouns typically don\'t have gender specification\n• Adjectives in plural may have gender only in specific contexts\n• Verify case markers match the word form\n\nIGNORE: Syntax, semantics, context - focus ONLY on morphology.\n\nRESPONSE FORMAT:\nVALIDATION: [VALID/INVALID]\nCONFIDENCE: [0.0-1.0]\nERRORS: [morphological errors only, or "None"]\nCORRECTIONS: [morphological corrections only, or "None"]');case"syntax":return"".concat(a,"\n\n🏗️ SYNTAX SPECIALIST VALIDATION\n\nYou are a specialist in syntactic analysis. Focus EXCLUSIVELY on grammatical structure:\n\nPRIMARY CHECKS:\n• **Grammatical Role**: Does the word fit its syntactic position?\n• **Agreement**: Are agreement patterns consistent?\n• **Case Assignment**: Is case marking appropriate for syntax?\n• **Tense/Aspect**: Are verbal categories syntactically coherent?\n• **Syntactic Features**: Do features match syntactic requirements?\n\nCRITICAL SYNTAX VALIDATION for ").concat(n.toUpperCase(),':\n❌ **Agreement violations**: Check subject-verb, noun-adjective agreement\n❌ **Case mismatches**: Ensure case reflects syntactic role\n❌ **Tense inconsistencies**: Verify temporal features make syntactic sense\n❌ **Feature conflicts**: Look for syntactically impossible combinations\n\nIGNORE: Word-internal morphology, meaning - focus ONLY on syntax.\n\nRESPONSE FORMAT:\nVALIDATION: [VALID/INVALID]\nCONFIDENCE: [0.0-1.0]\nERRORS: [syntactic errors only, or "None"]\nCORRECTIONS: [syntactic corrections only, or "None"]');case"semantics":return"".concat(a,'\n\n💭 SEMANTICS SPECIALIST VALIDATION\n\nYou are a specialist in semantic analysis. Focus EXCLUSIVELY on meaning and usage:\n\nPRIMARY CHECKS:\n• **Semantic Category**: Does the classification match the word\'s meaning?\n• **Usage Context**: Are grammatical features appropriate for the word\'s usage?\n• **Semantic Agreement**: Do features align with semantic properties?\n• **Register/Style**: Are formal features appropriate for the word type?\n• **Semantic Coherence**: Do all features make sense together semantically?\n\nSEMANTIC VALIDATION PRIORITIES:\n❌ **Meaning mismatches**: Ensure part of speech matches actual meaning\n❌ **Register conflicts**: Check if formality level matches word type\n❌ **Usage inconsistencies**: Verify features match how word is actually used\n❌ **Semantic impossibilities**: Look for logically impossible feature combinations\n\nIGNORE: Pure morphological/syntactic technicalities - focus on meaning-based validation.\n\nRESPONSE FORMAT:\nVALIDATION: [VALID/INVALID]\nCONFIDENCE: [0.0-1.0]\nERRORS: [semantic errors only, or "None"]\nCORRECTIONS: [semantic corrections only, or "None"]');case"consistency":return"".concat(a,"\n\n⚖️ CONSISTENCY SPECIALIST VALIDATION\n\nYou are a specialist in logical consistency. Focus EXCLUSIVELY on internal coherence:\n\nPRIMARY CHECKS:\n• **Feature Compatibility**: Are all features mutually compatible?\n• **Language Rules**: Does everything follow ").concat(n," rules?\n• **Logical Contradictions**: Are there any impossible combinations?\n• **Completeness**: Are required features present/absent appropriately?\n• **Cross-feature Validation**: Do different features support each other?\n\nCONSISTENCY CRITICAL CHECKS for ").concat(n.toUpperCase(),":\n❌ **GENDER + PLURAL**: Major error - gender should NOT be specified for plural forms in ").concat(n,"\n❌ **Part of speech conflicts**: Ensure all features match the stated part of speech\n❌ **Missing essential info**: Check if number, case, or other required features are missing\n❌ **Redundant information**: Remove features that don't apply to this word form\n❌ **Language-specific violations**: Apply ").concat(n,' grammatical rules strictly\n\nEXAMPLE VIOLATIONS TO CATCH:\n• "заслуги" (plural) + "Gender: Masculine" → INVALID (plural has no gender)\n• "Noun" + "Degree of comparison" → INVALID (nouns don\'t have degrees)\n• "Singular" + plural word ending → INVALID (form/feature mismatch)\n\nIGNORE: Individual feature accuracy - focus ONLY on overall consistency.\n\nRESPONSE FORMAT:\nVALIDATION: [VALID/INVALID]\nCONFIDENCE: [0.0-1.0]\nERRORS: [consistency errors only, or "None"]\nCORRECTIONS: [consistency corrections only, or "None"]');default:return il(e,t,n,r)}}(n,r,o,a,i),[4,e.createChatCompletion(t,[{role:"user",content:s}])];case 1:return(l=b.sent())&&l.content?(c=l.content.trim(),console.log("".concat(i," validator response:"),c),u=c.includes("VALIDATION: VALID"),d=c.match(/CONFIDENCE:\s*([\d.]+)/),f=d?parseFloat(d[1]):.5,p=c.match(/ERRORS?:([\s\S]*?)(?:CORRECTIONS?:|$)/),g=c.match(/CORRECTIONS?:([\s\S]*?)$/),h=[],m=[],p&&p[1]&&(y=p[1].trim())&&"None"!==y&&"Нет"!==y&&h.push.apply(h,y.split("\n").filter((function(e){return e.trim()})).map((function(e){return e.replace(/^[•\-*]\s*/,"").trim()})).filter((function(e){return e.length>0}))),g&&g[1]&&(x=g[1].trim())&&"None"!==x&&"Нет"!==x&&m.push.apply(m,x.split("\n").filter((function(e){return e.trim()})).map((function(e){return e.replace(/^[•\-*]\s*/,"").trim()})).filter((function(e){return e.length>0}))),[2,{isValid:u,errors:h,corrections:m.length>0?m:void 0,confidence:f,validatorType:i}]):[2,{isValid:!1,errors:["".concat(i," validation failed - no response")],confidence:0,validatorType:i}];case 2:return v=b.sent(),console.error("Error in ".concat(i," validator:"),v),[2,{isValid:!1,errors:["".concat(i," validator error: ").concat(v instanceof Error?v.message:"Unknown error")],confidence:0,validatorType:i}];case 3:return[2]}}))}))}function ul(e,t,n,r,o,a){return void 0===a&&(a="ru"),Xs(this,void 0,void 0,(function(){var i,s,l,c,u,d,f,p,g;return Zs(this,(function(h){switch(h.label){case 0:return console.log('Running multiple validation for "'.concat(n,'"')),i=["morphology","syntax","semantics","consistency"].map((function(i){return cl(e,t,n,r,o,a,i)})),[4,Promise.all(i)];case 1:return s=h.sent(),l=s.filter((function(e){return e.isValid})),c=s.filter((function(e){return!e.isValid})),u=s.reduce((function(e,t){return e+t.confidence}),0)/s.length,d=l.length/s.length,f=d>=.75,p=[],g=[],c.forEach((function(e){e.errors.forEach((function(t){p.includes(t)||p.push("[".concat(e.validatorType,"] ").concat(t))})),e.corrections&&e.corrections.forEach((function(t){g.includes(t)||g.push("[".concat(e.validatorType,"] ").concat(t))}))})),console.log("Multiple validation complete: ".concat(l.length,"/").concat(s.length," passed, confidence: ").concat(u.toFixed(2))),[2,{overallValid:f,confidence:u,validations:s,finalErrors:p,finalCorrections:g,attempts:1}]}}))}))}function dl(e,t,n,r,o,a,i){return void 0===o&&(o="ru"),void 0===a&&(a=5),void 0===i&&(i=!0),Xs(this,void 0,void 0,(function(){var s,l,c,u,d,f,p;return Zs(this,(function(g){switch(g.label){case 0:s=0,l=null,console.log('Starting advanced iterative creation of linguistic info for "'.concat(n,'" (max ').concat(a," attempts, multiple validators: ").concat(i,")")),g.label=1;case 1:if(!(s<a))return[3,14];s++,console.log("Attempt ".concat(s,"/").concat(a)),g.label=2;case 2:return g.trys.push([2,12,,13]),l?[3,4]:[4,al(e,t,n,r,o)];case 3:if(!(l=g.sent()))return console.log("Failed to generate linguistic info on attempt ".concat(s)),[3,1];g.label=4;case 4:return u=void 0,i?[4,ul(e,t,n,l,r,o)]:[3,6];case 5:return u=g.sent(),[3,8];case 6:return[4,sl(e,t,n,l,r,o)];case 7:d=g.sent(),u={overallValid:d.isValid,confidence:.7,validations:[{isValid:d.isValid,errors:d.errors,corrections:d.corrections,confidence:.7,validatorType:"general"}],finalErrors:d.errors,finalCorrections:d.corrections||[],attempts:1},g.label=8;case 8:return c=u,u.overallValid?(console.log("Validation passed on attempt ".concat(s," with confidence ").concat(u.confidence.toFixed(2))),[2,{linguisticInfo:l,wasValidated:!0,attempts:s,confidence:u.confidence,validationDetails:u}]):u.finalErrors.length>0?(console.log("Validation failed on attempt ".concat(s,":"),u.finalErrors),u.finalCorrections.length>0&&s<a?(console.log("Attempting correction on attempt ".concat(s,"...")),[4,ll(e,t,n,l,u.finalErrors,u.finalCorrections,r,o)]):[3,10]):[3,11];case 9:return(f=g.sent())?(l=f,console.log("Correction completed on attempt ".concat(s)),[3,1]):(console.log("Correction failed on attempt ".concat(s)),[3,11]);case 10:console.log("No corrections available or max attempts reached"),g.label=11;case 11:return s>=a?(console.log("Max attempts reached (".concat(a,"), returning current result")),[2,{linguisticInfo:l,wasValidated:!1,attempts:s,confidence:u.confidence,validationDetails:u}]):[3,13];case 12:return p=g.sent(),console.error("Error on attempt ".concat(s,":"),p),s>=a?[2,{linguisticInfo:null,wasValidated:!1,attempts:s,confidence:0,validationDetails:c}]:[3,13];case 13:return[3,1];case 14:return[2,{linguisticInfo:l,wasValidated:!1,attempts:s,confidence:(null==c?void 0:c.confidence)||0,validationDetails:c}]}}))}))}function fl(e,t,n,r,o,a){return void 0===o&&(o="ru"),void 0===a&&(a=5),Xs(this,void 0,void 0,(function(){var i;return Zs(this,(function(s){switch(s.label){case 0:return[4,dl(e,t,n,r,o,a,!1)];case 1:return[2,{linguisticInfo:(i=s.sent()).linguisticInfo,wasValidated:i.wasValidated,attempts:i.attempts}]}}))}))}function pl(e,t,n,r,o,a,i){return void 0===o&&(o="ru"),void 0===a&&(a=5),void 0===i&&(i=!0),Xs(this,void 0,void 0,(function(){return Zs(this,(function(s){return[2,dl(e,t,n,r,o,a,i)]}))}))}var gl=function(){return gl=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},gl.apply(this,arguments)},hl=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},ml=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},yl=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},xl=function(){function e(e,t){this.aiService=e,this.apiKey=t,this.agents=this.initializeAgents()}return e.prototype.initializeAgents=function(){return{supervisor:{name:"Supervisor",role:"Управляющий агент",systemPrompt:"Ты - Supervisor AI Agent, который управляет процессом создания образовательных карточек.\n                Твоя задача - проанализировать текст и определить оптимальную стратегию создания карточек.\n                Ты координируешь работу других агентов и принимаешь решения о том, какие агенты должны работать и как.",execute:this.executeSupervisor.bind(this)},contentAnalyzer:{name:"Content Analyzer",role:"Анализатор контента",systemPrompt:"Ты - Content Analyzer Agent, эксперт по анализу образовательного контента.\n                Твоя задача - глубоко проанализировать текст, выделить ключевые концепции, определить связи между ними.\n                Ты определяешь что важно изучать и как это лучше структурировать для запоминания.",execute:this.executeContentAnalyzer.bind(this)},questionQuality:{name:"Question Quality",role:"Контролер качества вопросов",systemPrompt:'Ты - Question Quality Agent, строгий эксперт по оценке качества образовательных вопросов.\n\nТВОЯ ЗАДАЧА: \nОтфильтровывать некачественные карточки и пропускать только действительно полезные.\n\nКРИТЕРИИ ОТКЛОНЕНИЯ (isWorthwhile: false):\n1. ДУБЛИРОВАНИЕ - вопрос и ответ содержат одинаковые ключевые слова\n2. ОЧЕВИДНОСТЬ - ответ прямо содержится в вопросе\n3. ТАВТОЛОГИЯ - ответ повторяет вопрос другими словами\n4. БЕСПОЛЕЗНОСТЬ - не добавляет понимания темы\n5. НЕТОЧНОСТЬ - неправильная или неполная информация\n\nПРИМЕРЫ ПЛОХИХ КАРТОЧЕК (ОТКЛОНЯЙ):\n❌ "Какой вид хищных млекопитающих представляет собой лев?" → "Лев - вид хищных млекопитающих" (ДУБЛИРОВАНИЕ)\n❌ "Что такое HTML?" → "HTML - это HTML" (ТАВТОЛОГИЯ)\n❌ "Где живут пингвины?" → "Пингвины живут в Антарктиде" (СЛИШКОМ ПРОСТОЕ)\n\nПРИМЕРЫ ХОРОШИХ КАРТОЧЕК (ПРИНИМАЙ):\n✅ "Почему львы единственные социальные кошки?" → "Объяснение эволюционных причин и преимуществ прайда"\n✅ "Как структура HTML влияет на SEO?" → "Конкретные технические детали и примеры"\n\nСТРОГИЕ ТРЕБОВАНИЯ:\n- qualityScore < 6 → isWorthwhile: false\n- Любое дублирование ключевых слов → балл -3\n- Отсутствие образовательной ценности → isWorthwhile: false\n- Неточная информация → isWorthwhile: false\n\nБУДЬ СТРОГИМ! Лучше отклонить сомнительную карточку, чем пропустить бесполезную.',execute:this.executeQuestionQuality.bind(this)},cardGenerator:{name:"Card Generator",role:"Генератор карточек",systemPrompt:'Ты - Card Generator Agent, эксперт по созданию высококачественных образовательных карточек.\n\nТВОЯ ГЛАВНАЯ ЗАДАЧА:\nСоздавать карточки, которые действительно помогают понять и запомнить материал.\n\nПРИНЦИПЫ КАЧЕСТВЕННЫХ КАРТОЧЕК:\n1. ИЗБЕГАЙ ОЧЕВИДНОГО - не создавай карточки где ответ содержится в вопросе\n2. СОЗДАВАЙ ПОНИМАНИЕ - вопросы должны проверять понимание, а не механическое запоминание\n3. БУДЬ КОНКРЕТНЫМ - избегай расплывчатых формулировок\n4. ДОБАВЛЯЙ КОНТЕКСТ - объясняй "почему" и "как", а не только "что"\n5. РАЗНООБРАЗЬ ТИПЫ - определения, примеры, применение, сравнения\n\nПЛОХИЕ ПРИМЕРЫ (НЕ ДЕЛАЙ ТАК):\n❌ "Какой вид хищных млекопитающих представляет собой лев?" → "Лев - вид хищных млекопитающих"\n❌ "Что такое фотосинтез?" → "Фотосинтез - это процесс фотосинтеза"\n\nХОРОШИЕ ПРИМЕРЫ:\n✅ "К какому семейству относится лев и какие особенности это определяют?" → "Лев относится к семейству кошачьих. Основные особенности: втяжные когти, клыки для захвата добычи, бинокулярное зрение для охоты, гибкое тело для прыжков"\n✅ "Почему львы живут прайдами, в отличие от других больших кошек?" → "Львы - единственные социальные большие кошки. Прайд помогает: совместно охотиться на крупную добычу, защищать территорию, воспитывать потомство"\n\nОБЯЗАТЕЛЬНЫЕ ТРЕБОВАНИЯ:\n- Каждый вопрос должен проверять ПОНИМАНИЕ, а не память\n- Ответы должны быть информативными и обучающими\n- Избегай дублирования слов из вопроса в ответе\n- Добавляй примеры и контекст где возможно',execute:this.executeCardGenerator.bind(this)},validator:{name:"Validator",role:"Валидатор и улучшатель",systemPrompt:"Ты - Validator Agent, финальный эксперт по проверке и улучшению карточек.\n                Твоя задача - провести комплексную оценку всех карточек и при необходимости улучшить их.\n                Ты следишь за тем, чтобы карточки были максимально полезны для изучения.",execute:this.executeValidator.bind(this)},pageContentAnalyzer:{name:"Page Content Analyzer",role:"Анализатор мультимедийного контента страницы",systemPrompt:"Ты - Page Content Analyzer Agent, эксперт по анализу веб-страниц и мультимедийного контента.\n                Твоя задача - интеллектуально определить, какие элементы страницы (изображения, формулы, код) \n                должны быть включены в образовательную карточку для лучшего понимания материала.\n                Ты принимаешь решения на основе контекста и релевантности контента.",execute:this.executePageContentAnalyzer.bind(this)},contentEnhancer:{name:"Content Enhancer",role:"Интеллектуальный улучшатель контента карточек",systemPrompt:'Ты - Content Enhancer Agent, эксперт по созданию богатого мультимедийного образовательного контента.\n                Твоя главная задача - для КАЖДОЙ карточки ИНДИВИДУАЛЬНО определить, какой мультимедиа контент действительно поможет её пониманию.\n                НЕ добавляй контент "на всякий случай" - только если он ПРЯМО СВЯЗАН с темой конкретной карточки.\n                \n                ПРИНЦИПЫ РАБОТЫ:\n                1. Анализируй тему каждой карточки отдельно\n                2. Добавляй контент только при высокой релевантности (>7/10)\n                3. Предпочитай качество количеству\n                4. Учитывай контекст: теория, практика, математика, программирование',execute:this.executeContentEnhancer.bind(this)},cardContentMatcher:{name:"Card Content Matcher",role:"Аналитик соответствия контента карточкам",systemPrompt:"Ты - Card Content Matcher Agent, эксперт по анализу соответствия мультимедиа контента конкретным образовательным карточкам.\n                Твоя задача - точно определить, какой контент подходит к каждой карточке, основываясь на семантическом анализе и образовательной ценности.",execute:this.executeCardContentMatcher.bind(this)},textAnalyst:{name:"Text Analyst",role:"Аналитик текста и планировщик обучения",systemPrompt:"Ты - Text Analyst Agent, эксперт по глубокому анализу образовательного текста.\n                \n                ТВОЯ ГЛАВНАЯ ЗАДАЧА:\n                1. Анализируй размер и сложность текста\n                2. Определи основные темы и подтемы\n                3. Оцени, сколько карточек ДЕЙСТВИТЕЛЬНО нужно для понимания\n                4. Приоритизируй темы по важности\n                5. Учитывай наличие мультимедиа контента\n                \n                ПРИНЦИПЫ:\n                - Большой текст ≠ много карточек (только важные концепты)\n                - Качество > количества\n                - Фокус на ключевых знаниях для понимания темы\n                - Если есть изображения - ОБЯЗАТЕЛЬНО включай их в планирование",execute:this.executeTextAnalyst.bind(this)},cardPlanner:{name:"Card Planner",role:"Планировщик структуры карточек",systemPrompt:"Ты - Card Planner Agent, эксперт по планированию оптимальной структуры образовательных карточек.\n                \n                ТВОЯ ЗАДАЧА:\n                1. Получи анализ от Text Analyst\n                2. Создай детальный план карточек\n                3. Определи тип каждой карточки (концепт, пример, применение, сравнение)\n                4. Спланируй распределение мультимедиа контента\n                5. Оптимизируй количество карточек для эффективного обучения\n                \n                ТИПЫ КАРТОЧЕК:\n                - Основные концепты (с изображениями/схемами)\n                - Формулы и определения (с формулами)\n                - Примеры применения (с кодом/диаграммами)\n                - Сравнения и связи\n                - Практические вопросы",execute:this.executeCardPlanner.bind(this)},multimediaAssigner:{name:"Multimedia Assigner",role:"Распределитель мультимедиа контента",systemPrompt:"Ты - Multimedia Assigner Agent, эксперт по интеллектуальному распределению мультимедиа контента.\n                \n                ОСОБОЕ ВНИМАНИЕ К ИЗОБРАЖЕНИЯМ:\n                - Если пользователь выделил изображение - оно ДОЛЖНО попасть в карточку\n                - Изображения помогают лучше запомнить материал\n                - Каждое изображение должно иметь четкую образовательную цель\n                \n                ТВОЯ ЗАДАЧА:\n                1. Анализируй план карточек от Card Planner\n                2. Точно определи, какой мультимедиа контент к какой карточке подходит\n                3. ПРИОРИТЕТ: выделенные пользователем изображения\n                4. Обеспечь максимальную образовательную ценность",execute:this.executeMultimediaAssigner.bind(this)}}},e.prototype.createCardsFromText=function(e,t,n){var r,o,a,i,s;return hl(this,void 0,void 0,(function(){var l,c,u,d,f,p,g,h,m,y,x,v,b,w,S,C,E,k,I,A;return ml(this,(function(_){switch(_.label){case 0:if(_.trys.push([0,11,,12]),console.log("🚀 AI Agent Workflow: Starting intelligent card creation with advanced analysis"),l={originalText:e,currentStep:"initialization",previousResults:{},metadata:{textLength:e.length,language:this.detectLanguage(e),topic:"",complexity:this.estimateComplexity(e)}},t?(l.previousResults.pageContext=t,console.log("📋 Page context: ".concat((null===(r=t.pageImages)||void 0===r?void 0:r.length)||0," images, ").concat((null===(o=t.formulas)||void 0===o?void 0:o.length)||0," formulas, ").concat((null===(a=t.codeBlocks)||void 0===a?void 0:a.length)||0," code blocks")),t.pageImages&&t.pageImages.length>0?(console.log("🖼️ Selected images details:"),t.pageImages.forEach((function(e,t){var n;console.log("  ".concat(t+1,'. "').concat(e.alt||"No alt",'" - ').concat((null===(n=e.src)||void 0===n?void 0:n.substring(0,50))||"No src","...")),console.log("      base64 available: ".concat(!!e.base64,", relevance: ").concat(e.relevanceScore))}))):console.log("⚠️ No images found in pageContext")):console.log("⚠️ No pageContext provided - no multimedia content available"),null==n?void 0:n.aborted)throw new Error("AI card creation was cancelled by user");return console.log("📊 Step 1: Deep text analysis and learning strategy"),l.currentStep="text_analysis",[4,this.agents.textAnalyst.execute({text:e,pageContext:t},l)];case 1:if(c=_.sent(),l.previousResults.textAnalysis=c,l.metadata.topic=(null===(i=c.mainTopics[0])||void 0===i?void 0:i.name)||"Общая тема",console.log("📋 Text analysis: ".concat(c.estimatedCards," cards recommended for ").concat(c.mainTopics.length," topics")),null==n?void 0:n.aborted)throw new Error("AI card creation was cancelled by user");return console.log("🎯 Step 2: Card structure planning"),l.currentStep="card_planning",[4,this.agents.cardPlanner.execute({textAnalysis:c,originalText:e,pageContext:t},l)];case 2:if(u=_.sent(),l.previousResults.cardPlan=u,console.log("📋 Card plan: ".concat(u.totalCards," cards planned with multimedia distribution")),null==n?void 0:n.aborted)throw new Error("AI card creation was cancelled by user");return d=null,t&&(t.pageImages.length>0||t.formulas.length>0||t.codeBlocks.length>0)?(console.log("🎨 Step 3: Intelligent multimedia assignment"),l.currentStep="multimedia_assignment",[4,this.agents.multimediaAssigner.execute({cardPlan:u,pageContext:t,originalText:e},l)]):[3,4];case 3:d=_.sent(),l.previousResults.multimediaDistribution=d,console.log("🎨 Multimedia assigned: ".concat((null===(s=null==d?void 0:d.assignments)||void 0===s?void 0:s.length)||0," assignments created")),_.label=4;case 4:if(null==n?void 0:n.aborted)throw new Error("AI card creation was cancelled by user");return console.log("🎯 Step 4: Structured card generation"),l.currentStep="card_generation",[4,this.agents.cardGenerator.execute({text:e,cardPlan:u,multimediaDistribution:d,textAnalysis:c},l)];case 5:if(f=_.sent(),l.previousResults.generatedCards=f,console.log("🎯 Generated ".concat(f.length," cards based on plan")),null==n?void 0:n.aborted)throw new Error("AI card creation was cancelled by user");console.log("🔍 Step 5: Question quality validation"),l.currentStep="quality_check",p=[],g=0,h=f,_.label=6;case 6:if(!(g<h.length))return[3,9];if(m=h[g],null==n?void 0:n.aborted)throw new Error("AI card creation was cancelled by user");return[4,this.agents.questionQuality.execute(m,l)];case 7:y=_.sent(),p.push(y),_.label=8;case 8:return g++,[3,6];case 9:if(l.previousResults.qualityResults=p,x=f.filter((function(e,t){var n=p[t],r=n.isWorthwhile&&n.qualityScore>=6&&n.relevanceScore>=6;return r||(console.log("❌ Card ".concat(t+1," rejected: Q=").concat(n.qualityScore,", R=").concat(n.relevanceScore,", W=").concat(n.isWorthwhile)),console.log("   Reason: ".concat(n.reasoning)),console.log("   Issues: ".concat(n.issues.join(", ")))),r})),console.log("✅ Quality filter: ".concat(x.length,"/").concat(f.length," cards passed strict quality check")),0===x.length&&f.length>0&&(console.log("🚨 All cards rejected by quality filter! Creating fallback quality card"),v={front:"Какие ключевые концепты раскрывает данный материал?",back:"Материал раскрывает следующие концепты: ".concat(e.substring(0,200),"... (требует дополнительного анализа для создания более конкретных вопросов)"),tags:[l.metadata.topic||"общее"],difficulty:"medium",concept:"Общий анализ материала"},x.push(v),console.log("✅ Fallback card created to ensure user gets at least one card")),null==n?void 0:n.aborted)throw new Error("AI card creation was cancelled by user");return b=x,w=t&&t.pageImages&&t.pageImages.length>0,console.log("🖼️ Selected images available: ".concat(w?null==t?void 0:t.pageImages.length:0)),w?(console.log("🎨 Step 6: Applying multimedia to quality cards"),d&&d.assignments.length>0?(console.log("📊 Using intelligent multimedia distribution"),b=x.map((function(e,n){var r,o=null===(r=u.cardSpecs[n])||void 0===r?void 0:r.id,a=null==d?void 0:d.assignments.find((function(e){return e.cardId===o}));if(a){var i=gl({},e);if(a.imageIndices.length>0&&(i.attachedImages=a.imageIndices.map((function(e){return null==t?void 0:t.pageImages[e]})).filter(Boolean)),a.formulaIndices.length>0&&(i.attachedFormulas=a.formulaIndices.map((function(e){return null==t?void 0:t.formulas[e]})).filter(Boolean)),a.codeIndices.length>0&&(i.attachedCode=a.codeIndices.map((function(e){return null==t?void 0:t.codeBlocks[e]})).filter(Boolean)),console.log("🎨 Card ".concat(n+1,": added ").concat(a.imageIndices.length," images, ").concat(a.formulaIndices.length," formulas, ").concat(a.codeIndices.length," code blocks")),i.attachedImages&&i.attachedImages.length>0){var s=i.attachedImages[0];s.base64?(i.image=s.base64,console.log("📱 Установлено image для предпросмотра карточки",n+1)):s.src&&(i.imageUrl=s.src,console.log("📱 Установлено imageUrl для предпросмотра карточки",n+1))}return i}return e}))):(console.log("🚨 No multimedia distribution found, using fallback logic to ensure images are included"),console.log("🖼️ Forcing inclusion of ".concat(null==t?void 0:t.pageImages.length," selected images")),b.length>0&&(null==t?void 0:t.pageImages.length)>0&&(S=t.pageImages[0],b[0]=gl(gl({},b[0]),{attachedImages:t.pageImages,image:S.base64||null,imageUrl:S.src||null}),console.log("🎯 FALLBACK: Added all ".concat(t.pageImages.length," images to first card")),console.log("📱 FALLBACK: Установлено image/imageUrl для предпросмотра первой карточки")),b.length>1&&(null==t?void 0:t.pageImages.length)>1&&(C=Math.ceil(t.pageImages.length/b.length),b=b.map((function(e,n){var r=n*C,o=Math.min(r+C,t.pageImages.length),a=t.pageImages.slice(r,o);if(a.length>0){console.log("🎯 FALLBACK: Added ".concat(a.length," images to card ").concat(n+1));var i=a[0];return gl(gl({},e),{attachedImages:a,image:i.base64||null,imageUrl:i.src||null})}return e})))),E=b.reduce((function(e,t){var n;return e+((null===(n=t.attachedImages)||void 0===n?void 0:n.length)||0)}),0),console.log("✅ Total images attached to cards: ".concat(E,"/").concat((null==t?void 0:t.pageImages.length)||0)),0===E&&(null==t?void 0:t.pageImages.length)>0&&(console.log("🚨 CRITICAL: No images were attached despite having selected images!"),console.log("🎯 Emergency fallback: Adding all images to all cards"),b=b.map((function(e,n){var r=t.pageImages[0];return gl(gl({},e),{attachedImages:t.pageImages,image:r.base64||null,imageUrl:r.src||null})})),console.log("🎯 Emergency: Added ".concat(t.pageImages.length," images to ").concat(b.length," cards")))):console.log("ℹ️ No selected images to apply"),console.log("🔬 Step 7: Final validation"),l.currentStep="final_validation",[4,this.agents.validator.execute({cards:b,originalText:e,context:l},l)];case 10:return k=_.sent(),I=k.improvedCards||b,console.log("🎉 Workflow completed: ".concat(I.length," high-quality cards created")),console.log("📈 Overall score: ".concat(k.overallScore,"/100")),[2,this.convertToStoredCards(I,e)];case 11:throw A=_.sent(),console.error("❌ Error in AI agent workflow:",A),A;case 12:return[2]}}))}))},e.prototype.executeSupervisor=function(e,t){return hl(this,void 0,void 0,(function(){var n,r,o;return ml(this,(function(a){switch(a.label){case 0:n='Ты - Supervisor AI Agent. Проанализируй текст и определи оптимальную стратегию создания карточек.\n\nТЕКСТ: "'.concat(e,'"\n\nКОНТЕКСТ:\n- Длина: ').concat(t.metadata.textLength," символов\n- Сложность: ").concat(t.metadata.complexity,"\n- Язык: ").concat(t.metadata.language,'\n\nТВОЯ ЗАДАЧА:\n1. Определи стратегию обучения (single_concept, multiple_concepts, step_by_step, comparison)\n2. Реши какие агенты должны работать и как\n3. Дай четкие инструкции каждому агенту\n4. Определи ожидаемый результат\n\nСТРАТЕГИИ:\n- single_concept: один ключевой концепт\n- multiple_concepts: несколько независимых концептов  \n- step_by_step: пошаговый процесс или алгоритм\n- comparison: сравнение или противопоставление\n\nJSON ответ:\n{\n  "strategy": "step_by_step",\n  "agents": ["contentAnalyzer", "cardGenerator", "questionQuality", "validator"],\n  "instructions": {\n    "contentAnalyzer": "Выдели основные шаги процесса и их последовательность",\n    "cardGenerator": "Создай карточки для каждого шага с акцентом на практическое применение",\n    "questionQuality": "Проверь что каждый вопрос помогает понять последовательность действий",\n    "validator": "Убедись что карточки образуют логическую последовательность обучения"\n  },\n  "expectedOutput": "Набор карточек покрывающих пошаговый процесс",\n  "reasoning": "Текст описывает процедуру, лучше изучать по шагам"\n}'),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.supervisor.systemPrompt},{role:"user",content:n}])];case 2:if(!(null==(r=a.sent())?void 0:r.content))throw new Error("No response from supervisor agent");return[2,this.parseJSONResponse(r.content,"supervisor")];case 3:return o=a.sent(),console.error("Supervisor agent error:",o),[2,this.createFallbackSupervisorDecision()];case 4:return[2]}}))}))},e.prototype.executeContentAnalyzer=function(e,t){var n,r;return hl(this,void 0,void 0,(function(){var o,a,i,s;return ml(this,(function(l){switch(l.label){case 0:o=(null===(r=null===(n=t.previousResults.supervisor)||void 0===n?void 0:n.instructions)||void 0===r?void 0:r.contentAnalyzer)||"Проведи глубокий анализ контента",a='Ты - Content Analyzer Agent. Глубоко проанализируй образовательный контент.\n\nТЕКСТ: "'.concat(e,'"\n\nИНСТРУКЦИИ ОТ SUPERVISOR: ').concat(o,'\n\nТВОЯ ЗАДАЧА:\n1. Определи основную тему и ключевые понятия\n2. Выяви связи между концептами\n3. Определи цели обучения\n4. Оцени сложность материала\n5. Оцени сколько карточек нужно\n\nJSON ответ:\n{\n  "mainTopic": "Основная тема",\n  "keyPoints": ["пункт1", "пункт2"],\n  "concepts": [\n    {\n      "name": "Концепт1",\n      "definition": "Определение",\n      "importance": "high",\n      "prerequisites": ["предпосылка1"],\n      "examples": ["пример1"]\n    }\n  ],\n  "relationships": [\n    {\n      "from": "Концепт1",\n      "to": "Концепт2", \n      "type": "depends_on"\n    }\n  ],\n  "learningObjectives": ["цель1", "цель2"],\n  "complexity": "medium",\n  "estimatedCards": 3\n}'),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.contentAnalyzer.systemPrompt},{role:"user",content:a}])];case 2:if(!(null==(i=l.sent())?void 0:i.content))throw new Error("No response from content analyzer agent");return[2,this.parseJSONResponse(i.content,"contentAnalyzer")];case 3:return s=l.sent(),console.error("Content analyzer error:",s),[2,this.createFallbackContentAnalysis(e)];case 4:return[2]}}))}))},e.prototype.executeCardGenerator=function(e,t){var n,r,o,a;return hl(this,void 0,void 0,(function(){var t,i,s,l,c,u,d,f;return ml(this,(function(p){switch(p.label){case 0:t=e.text,i=e.cardPlan,s=e.textAnalysis,e.multimediaDistribution,l=e.analysis,c=e.instructions,u=i&&s?'Ты - Card Generator Agent. Создай высококачественные образовательные карточки ТОЧНО по плану.\n\nТЕКСТ: "'.concat(t,'"\n\nАНАЛИЗ ТЕКСТА:\n- Основные темы: ').concat(s.mainTopics.map((function(e){return e.name})).join(", "),"\n- Рекомендуемые карточки: ").concat(s.estimatedCards,"\n- Сложность: ").concat(s.complexity,"\n- Мультимедиа доступно: ").concat(s.hasMultimedia?"ДА":"НЕТ","\n\nПЛАН КАРТОЧЕК (СЛЕДУЙ ТОЧНО):\n").concat(i.cardSpecs.map((function(e,t){return"\nКарточка ".concat(t+1," (").concat(e.id,"):\n- Тип: ").concat(e.type,"\n- Тема: ").concat(e.topic,"\n- Приоритет: ").concat(e.priority,"\n- Сложность: ").concat(e.difficulty,"\n- Описание: ").concat(e.description,"\n- Нужен мультимедиа: ").concat(e.needsMultimedia?"ДА":"НЕТ","\n")})).join(""),'\n\nКРИТИЧЕСКИЕ ТРЕБОВАНИЯ К КАЧЕСТВУ:\n1. НИКОГДА НЕ ДУБЛИРУЙ ключевые слова из вопроса в ответе\n2. Вопросы должны проверять ПОНИМАНИЕ, не память\n3. Ответы должны быть ИНФОРМАТИВНЫМИ и ОБУЧАЮЩИМИ\n4. Добавляй КОНТЕКСТ и ОБЪЯСНЕНИЯ\n5. Избегай ОЧЕВИДНЫХ вопросов\n\nПЛОХИЕ ПРИМЕРЫ (НЕ ДЕЛАЙ ТАК):\n❌ "Что такое лев?" → "Лев - это лев"\n❌ "Какой вид млекопитающих лев?" → "Лев - вид хищных млекопитающих"\n❌ "Где живут львы?" → "Львы живут в Африке"\n\nХОРОШИЕ ПРИМЕРЫ:\n✅ "Почему львы единственные социальные большие кошки?" → "Львы живут прайдами для совместной охоты на крупную добычу, защиты территории и воспитания потомства. Другие большие кошки (тигры, леопарды) - одиночки"\n✅ "Какие адаптации помогают львам охотиться в группе?" → "Специализация ролей: самки-охотницы используют скрытность и координацию, самцы защищают прайд. Развитая коммуникация через рык и жесты"\n\nТВОЯ ЗАДАЧА:\n1. Создай РОВНО ').concat(i.totalCards,' карточек по плану\n2. Каждая карточка должна соответствовать своему CardSpec\n3. НЕ добавляй мультимедиа сейчас - это будет сделано отдельно\n4. Сосредоточься на качественном содержании\n5. ПРОВЕРЬ каждую карточку на дублирование слов\n\nJSON ответ:\n{\n  "cards": [\n    {\n      "front": "Вопрос для карточки 1 (БЕЗ дублирования ключевых слов из ответа)",\n      "back": "Информативный ответ с контекстом и объяснениями",\n      "tags": ["').concat((null===(n=s.mainTopics[0])||void 0===n?void 0:n.name)||"общее",'"],\n      "difficulty": "medium",\n      "concept": "').concat((null===(r=i.cardSpecs[0])||void 0===r?void 0:r.topic)||"концепт",'"\n    }\n  ]\n}'):'Ты - Card Generator Agent. Создай высококачественные образовательные карточки.\n\nТЕКСТ: "'.concat(t,'"\n\nАНАЛИЗ КОНТЕНТА:\n- Тема: ').concat((null==l?void 0:l.mainTopic)||"Общая тема","\n- Ключевые понятия: ").concat((null===(o=null==l?void 0:l.concepts)||void 0===o?void 0:o.map((function(e){return e.name})).join(", "))||"Основные концепты","\n- Цели обучения: ").concat((null===(a=null==l?void 0:l.learningObjectives)||void 0===a?void 0:a.join(", "))||"Изучение материала","\n- Сложность: ").concat((null==l?void 0:l.complexity)||"medium","\n\nИНСТРУКЦИИ: ").concat(c||"Создай качественные образовательные карточки",'\n\nКРИТИЧЕСКИЕ ТРЕБОВАНИЯ К КАЧЕСТВУ:\n1. НИКОГДА НЕ ДУБЛИРУЙ ключевые слова из вопроса в ответе\n2. Вопросы должны проверять ПОНИМАНИЕ, не память\n3. Ответы должны быть ИНФОРМАТИВНЫМИ и ОБУЧАЮЩИМИ\n4. Добавляй КОНТЕКСТ и ОБЪЯСНЕНИЯ\n5. Избегай ОЧЕВИДНЫХ вопросов\n\nПЛОХИЕ ПРИМЕРЫ (НЕ ДЕЛАЙ ТАК):\n❌ "Что такое HTML?" → "HTML - это HTML"\n❌ "Какой язык программирования Python?" → "Python - язык программирования"\n❌ "Где используется JavaScript?" → "JavaScript используется в веб-разработке"\n\nХОРОШИЕ ПРИМЕРЫ:\n✅ "Почему Python считается подходящим для начинающих программистов?" → "Python имеет простой синтаксис, близкий к английскому языку, автоматическое управление памятью, богатую стандартную библиотеку и активное сообщество"\n✅ "Какие преимущества дает использование JavaScript на сервере?" → "Node.js позволяет использовать один язык для фронтенда и бэкенда, имеет высокую производительность благодаря V8, большую экосистему npm пакетов"\n\nПРИНЦИПЫ КАЧЕСТВЕННЫХ КАРТОЧЕК:\n1. Один вопрос - один концепт\n2. Четкие, конкретные вопросы БЕЗ дублирования\n3. Полные, точные ответы с контекстом\n4. Практическая применимость\n5. Прогрессивная сложность\n\nJSON ответ:\n{\n  "cards": [\n    {\n      "front": "Четкий вопрос БЕЗ дублирования ключевых слов",\n      "back": "Полный информативный ответ с объяснениями",\n      "tags": ["тег1"],\n      "difficulty": "medium",\n      "concept": "Название концепта"\n    }\n  ]\n}'),p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.cardGenerator.systemPrompt},{role:"user",content:u}])];case 2:if(!(null==(d=p.sent())?void 0:d.content))throw new Error("No response from card generator agent");return[2,this.parseJSONResponse(d.content,"cardGenerator").cards||[]];case 3:return f=p.sent(),console.error("Card generator error:",f),[2,this.createFallbackCards(t)];case 4:return[2]}}))}))},e.prototype.executeQuestionQuality=function(e,t){return hl(this,void 0,void 0,(function(){var n,r,o;return ml(this,(function(a){switch(a.label){case 0:n='Ты - Question Quality Agent. СТРОГО оцени качество образовательного вопроса.\n\nКАРТОЧКА ДЛЯ АНАЛИЗА:\nВопрос: "'.concat(e.front,'"\nОтвет: "').concat(e.back,'"\nКонцепт: ').concat(e.concept||"не указан",'\n\nОРИГИНАЛЬНЫЙ ТЕКСТ: "').concat(t.originalText.substring(0,500),'..."\n\nКРИТИЧЕСКИЙ АНАЛИЗ:\n1. ПРОВЕРЬ НА ДУБЛИРОВАНИЕ:\n   - Есть ли одинаковые ключевые слова в вопросе и ответе?\n   - Повторяет ли ответ формулировку вопроса?\n\n2. ПРОВЕРЬ ОБРАЗОВАТЕЛЬНУЮ ЦЕННОСТЬ:\n   - Учит ли что-то новое?\n   - Проверяет ли понимание, а не память?\n   - Добавляет ли контекст и объяснения?\n\n3. ПРОВЕРЬ КАЧЕСТВО ФОРМУЛИРОВКИ:\n   - Ясен ли вопрос?\n   - Полон ли ответ?\n   - Есть ли конкретные детали?\n\nШКАЛА ОЦЕНКИ:\n- 9-10: Отличная карточка, учит и проверяет понимание\n- 7-8: Хорошая карточка с небольшими недостатками\n- 5-6: Посредственная карточка, требует улучшений\n- 3-4: Плохая карточка, серьезные проблемы\n- 1-2: Очень плохая карточка, бесполезна\n\nАВТОМАТИЧЕСКОЕ ОТКЛОНЕНИЕ (isWorthwhile: false) ЕСЛИ:\n- Вопрос содержит те же ключевые слова что и ответ\n- Ответ просто переформулирует вопрос\n- Качество меньше 6 баллов\n- Нет образовательной ценности\n\nJSON ответ:\n{\n  "question": "').concat(e.front,'",\n  "answer": "').concat(e.back,'",\n  "qualityScore": 3,\n  "relevanceScore": 4,\n  "difficultyScore": 2,\n  "issues": ["Дублирование ключевых слов", "Ответ повторяет вопрос", "Нет образовательной ценности"],\n  "improvements": ["Переформулировать вопрос", "Добавить контекст в ответ", "Сделать вопрос более конкретным"],\n  "isWorthwhile": false,\n  "reasoning": "Карточка отклонена из-за дублирования: вопрос \'Какой вид хищных млекопитающих представляет собой лев?\' и ответ \'Лев - вид хищных млекопитающих\' содержат одинаковые слова. Нет образовательной ценности."\n}'),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.questionQuality.systemPrompt},{role:"user",content:n}])];case 2:if(!(null==(r=a.sent())?void 0:r.content))throw new Error("No response from question quality agent");return[2,this.parseJSONResponse(r.content,"questionQuality")];case 3:return o=a.sent(),console.error("Question quality error:",o),[2,this.createFallbackQualityCheck(e)];case 4:return[2]}}))}))},e.prototype.executeValidator=function(e,t){var n;return hl(this,void 0,void 0,(function(){var r,o,a,i,s;return ml(this,(function(l){switch(l.label){case 0:r=e.cards,o=e.originalText,a='Ты - Validator Agent. Проведи финальную проверку набора карточек.\n\nОРИГИНАЛЬНЫЙ ТЕКСТ: "'.concat(o,'"\n\nКАРТОЧКИ (').concat(r.length," шт):\n").concat(r.map((function(e,t){return"\n".concat(t+1,". Q: ").concat(e.front,"\n   A: ").concat(e.back,"\n   Концепт: ").concat(e.concept||"не указан","\n")})).join(""),"\n\nКОНТЕКСТ WORKFLOW:\n- Тема: ").concat(t.metadata.topic,"\n- Стратегия: ").concat(null===(n=t.previousResults.supervisor)||void 0===n?void 0:n.strategy,'\n\nПРОВЕРЬ:\n1. Полнота покрытия темы (0-25 баллов)\n2. Качество карточек (0-25 баллов)  \n3. Логическая последовательность (0-25 баллов)\n4. Практическая ценность (0-25 баллов)\n\nЕСЛИ ОБЩИЙ БАЛЛ < 80, ПРЕДЛОЖИ УЛУЧШЕНИЯ.\n\nJSON ответ:\n{\n  "isValid": true,\n  "overallScore": 85,\n  "cardScores": {0: 85, 1: 90},\n  "issues": ["проблема если есть"],\n  "suggestions": ["предложение1"],\n  "improvedCards": [...],\n  "finalRecommendation": "Рекомендация по использованию"\n}'),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.validator.systemPrompt},{role:"user",content:a}])];case 2:if(!(null==(i=l.sent())?void 0:i.content))throw new Error("No response from validator agent");return[2,this.parseJSONResponse(i.content,"validator")];case 3:return s=l.sent(),console.error("Validator error:",s),[2,this.createFallbackValidation(r)];case 4:return[2]}}))}))},e.prototype.executePageContentAnalyzer=function(e,t){var n,r,o;return hl(this,void 0,void 0,(function(){var t,a,i,s,l,c,u,d,f;return ml(this,(function(p){switch(p.label){case 0:t=e.text,a=e.pageContext,i='Ты - Page Content Analyzer Agent. Проанализируй страницу и определи, какие элементы помогут в обучении.\n\nВЫДЕЛЕННЫЙ ТЕКСТ: "'.concat(t,'"\n\nКОНТЕНТ СТРАНИЦЫ:\nИзображения (').concat(a.pageImages.length,"):\n").concat(a.pageImages.map((function(e,t){return"".concat(t+1,". ").concat(e.alt||"Без описания"," (").concat(e.isNearText?"рядом с текстом":"далеко от текста",")")})).join("\n"),"\n\nФормулы (").concat(a.formulas.length,"):\n").concat(a.formulas.map((function(e,t){return"".concat(t+1,". ").concat(e.text," (").concat(e.type,")")})).join("\n"),"\n\nКод (").concat(a.codeBlocks.length,"):\n").concat(a.codeBlocks.map((function(e,t){return"".concat(t+1,". ").concat(e.language||"unknown",": ").concat(e.code.substring(0,100),"...")})).join("\n"),'\n\nТВОЯ ЗАДАЧА:\n1. Определи, какие изображения релевантны для понимания текста\n2. Определи, какие формулы важны для объяснения\n3. Определи, какие блоки кода нужны для примеров\n4. Обоснуй каждое решение\n\nКРИТЕРИИ ОТБОРА:\n- Изображения: диаграммы, схемы, иллюстрации концептов\n- Формулы: математические выражения, связанные с текстом\n- Код: примеры, алгоритмы, упомянутые в тексте\n\nJSON ответ:\n{\n  "shouldIncludeImages": true,\n  "selectedImages": [0, 2],\n  "shouldIncludeFormulas": false,\n  "selectedFormulas": [],\n  "shouldIncludeCode": true,\n  "selectedCode": [0],\n  "reasoning": "Изображение 1 и 3 иллюстрируют основные концепты. Код показывает практическое применение."\n}'),p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.pageContentAnalyzer.systemPrompt},{role:"user",content:i}])];case 2:if(!(null==(s=p.sent())?void 0:s.content))throw new Error("No response from page content analyzer agent");return l=this.parseJSONResponse(s.content,"pageContentAnalyzer"),c=(null===(n=l.selectedImages)||void 0===n?void 0:n.map((function(e){return a.pageImages[e]})).filter(Boolean))||[],u=(null===(r=l.selectedFormulas)||void 0===r?void 0:r.map((function(e){return a.formulas[e]})).filter(Boolean))||[],d=(null===(o=l.selectedCode)||void 0===o?void 0:o.map((function(e){return a.codeBlocks[e]})).filter(Boolean))||[],[2,{shouldIncludeImages:l.shouldIncludeImages||!1,selectedImages:c,shouldIncludeFormulas:l.shouldIncludeFormulas||!1,selectedFormulas:u,shouldIncludeCode:l.shouldIncludeCode||!1,selectedCode:d,reasoning:l.reasoning||"No reasoning provided"}];case 3:return f=p.sent(),console.error("Page content analyzer error:",f),[2,this.createFallbackContentEnhancement()];case 4:return[2]}}))}))},e.prototype.executeContentEnhancer=function(e,t){var n;return hl(this,void 0,void 0,(function(){var t,r,o,a,i,s,l,c,u,d,f=this;return ml(this,(function(p){switch(p.label){case 0:t=e.cards,r=e.contentEnhancement,o=e.originalText,a=e.contentMatches,i=a&&a.cardMatches&&a.cardMatches.length>0,s="Ты - Content Enhancer Agent. Улучши карточки на основе ТОЧНОГО анализа соответствия контента.\n\n".concat(i?"СПЕЦИАЛЬНЫЕ ИНСТРУКЦИИ: Используй ТОЧНЫЕ РЕЗУЛЬТАТЫ анализа соответствия - добавляй контент только к тем карточкам, где это прямо указано.":"ОБЩИЕ ИНСТРУКЦИИ: Анализируй каждую карточку индивидуально.",'\n\nОРИГИНАЛЬНЫЙ ТЕКСТ: "').concat(o,'"\n\nКАРТОЧКИ (').concat(t.length,"):\n").concat(t.map((function(e,t){return"\nКарточка ".concat(t+1,":\nВопрос: ").concat(e.front,"\nОтвет: ").concat(e.back,"\nТема: ").concat(f.extractCardTopic(e.front,e.back),"\n").concat(i?"Рекомендованный контент: ".concat(f.getMatchedContentForCard(t,a)):"","\n")})).join(""),"\n\nДОСТУПНЫЙ КОНТЕНТ:\n").concat(r.shouldIncludeImages?"Изображения (".concat(r.selectedImages.length,"):\n").concat(r.selectedImages.map((function(e,t){return"".concat(t+1,'. "').concat(e.alt||"без описания",'" (релевантность: ').concat(e.relevanceScore,"/10)")})).join("\n")):"Изображения: отсутствуют","\n\n").concat(r.shouldIncludeFormulas?"Формулы (".concat(r.selectedFormulas.length,"):\n").concat(r.selectedFormulas.map((function(e,t){return"".concat(t+1,'. "').concat(e.text,'" (релевантность: ').concat(e.relevanceScore,"/10)")})).join("\n")):"Формулы: отсутствуют","\n\n").concat(r.shouldIncludeCode?"Код (".concat(r.selectedCode.length,"):\n").concat(r.selectedCode.map((function(e,t){return"".concat(t+1,". ").concat(e.language||"text",': "').concat(e.code.substring(0,60),'..." (релевантность: ').concat(e.relevanceScore,"/10)")})).join("\n")):"Код: отсутствует","\n\n").concat(i?"\nРЕЗУЛЬТАТЫ АНАЛИЗА СООТВЕТСТВИЯ:\n".concat(a.cardMatches.map((function(e){return"\nКарточка ".concat(e.cardIndex+1,":\n- Изображения: [").concat(e.relevantImages.join(", "),"]\n- Формулы: [").concat(e.relevantFormulas.join(", "),"] \n- Код: [").concat(e.relevantCode.join(", "),"]\n- Обоснование: ").concat(e.reasoning,"\n")})).join(""),"\n\nСТРОГО СЛЕДУЙ РЕЗУЛЬТАТАМ АНАЛИЗА! Добавляй контент только к указанным карточкам."):'\nПРАВИЛА САМОСТОЯТЕЛЬНОГО АНАЛИЗА:\n1. Анализируй каждую карточку отдельно\n2. Добавляй контент только при релевантности ≥8/10\n3. Учитывай тематику: математика→формулы, код→программирование, процессы→схемы\n4. НЕ добавляй контент "на всякий случай"','\n\nJSON ответ:\n{\n  "enhancedCards": [\n    {\n      "front": "Что такое фотосинтез?",\n      "back": "Фотосинтез - это процесс преобразования углекислого газа и воды в глюкозу с помощью солнечного света.\n\n[IMAGE:0]\n\nХимическая формула: [FORMULA:0]",\n      "multimedia": {\n        "images": [0],\n        "formulas": [0], \n        "code": []\n      },\n      "reasoning": "Добавил схему фотосинтеза и химическую формулу, так как они прямо иллюстрируют процесс"\n    },\n    {\n      "front": "Какие факторы влияют на скорость фотосинтеза?",\n      "back": "Температура, освещенность, концентрация CO2 и доступность воды влияют на скорость фотосинтеза.",\n      "multimedia": {\n        "images": [],\n        "formulas": [],\n        "code": []\n      },\n      "reasoning": "Эта карточка о факторах - не нужен мультимедиа контент, текст достаточно ясен"\n    }\n  ]\n}\n\nВАЖНО: Используй плейсхолдеры [IMAGE:N], [FORMULA:N], [CODE:N] только когда контент ДЕЙСТВИТЕЛЬНО нужен для этой конкретной карточки.'),p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.contentEnhancer.systemPrompt},{role:"user",content:s}])];case 2:if(!(null==(l=p.sent())?void 0:l.content))throw new Error("No response from content enhancer agent");return c=this.parseJSONResponse(l.content,"contentEnhancer"),console.log("🎨 Content enhancer parsed result:",c),u=(null===(n=c.enhancedCards)||void 0===n?void 0:n.map((function(e,t){var n,o,a,i,s,l,c,u,d,f,p,g,h=e.back;console.log("🔧 Обработка карточки ".concat(t+1,": ").concat(e.front)),console.log("📋 Мультимедиа для карточки:",e.multimedia);var m=h.match(/\[IMAGE:(\d+)\]/g);m&&(console.log("🔍 Найдены плейсхолдеры изображений в карточке ".concat(t+1,":"),m),m.forEach((function(e){var n=e.match(/\[IMAGE:(\d+)\]/);if(n){var o=parseInt(n[1]),a=r.selectedImages[o];if(console.log("🔄 Замена ".concat(e," на изображение ").concat(o," в карточке ").concat(t+1,":"),(null==a?void 0:a.src)||"НЕ НАЙДЕНО"),a){var i=a.base64||a.src;console.log("🖼️ Используем ".concat(a.base64?"base64":"URL"," для изображения в карточке ").concat(t+1));var s=a.alt&&""!==a.alt.trim()?a.alt:"";h=h.replace(e,"\n![".concat(s,"](").concat(i,")\n"))}else console.warn("⚠️ Изображение с индексом ".concat(o," не найдено в selectedImages")),h=h.replace(e,"")}})));var y=h.match(/\[FORMULA:(\d+)\]/g);y&&(console.log("🔍 Найдены плейсхолдеры формул в карточке ".concat(t+1,":"),y),y.forEach((function(e){var n=e.match(/\[FORMULA:(\d+)\]/);if(n){var o=parseInt(n[1]),a=r.selectedFormulas[o];console.log("🔄 Замена ".concat(e," на формулу ").concat(o," в карточке ").concat(t+1,":"),(null==a?void 0:a.text)||"НЕ НАЙДЕНО"),a?h=h.replace(e,"\n$$".concat(a.text,"$$\n")):(console.warn("⚠️ Формула с индексом ".concat(o," не найдена в selectedFormulas")),h=h.replace(e,""))}})));var x=h.match(/\[CODE:(\d+)\]/g);return x&&(console.log("🔍 Найдены плейсхолдеры кода в карточке ".concat(t+1,":"),x),x.forEach((function(e){var n,o=e.match(/\[CODE:(\d+)\]/);if(o){var a=parseInt(o[1]),i=r.selectedCode[a];console.log("🔄 Замена ".concat(e," на код ").concat(a," в карточке ").concat(t+1,":"),(null===(n=null==i?void 0:i.code)||void 0===n?void 0:n.substring(0,30))||"НЕ НАЙДЕНО"),i?h=h.replace(e,"\n```".concat(i.language||"","\n").concat(i.code,"\n```\n")):(console.warn("⚠️ Код с индексом ".concat(a," не найден в selectedCode")),h=h.replace(e,""))}}))),h=h.replace(/\n{3,}/g,"\n\n"),console.log("✅ Карточка ".concat(t+1," обработана. Мультимедиа:"),{images:(null===(o=null===(n=e.multimedia)||void 0===n?void 0:n.images)||void 0===o?void 0:o.length)||0,formulas:(null===(i=null===(a=e.multimedia)||void 0===a?void 0:a.formulas)||void 0===i?void 0:i.length)||0,code:(null===(l=null===(s=e.multimedia)||void 0===s?void 0:s.code)||void 0===l?void 0:l.length)||0}),gl(gl({},e),{back:h,multimedia:e.multimedia,attachedImages:(null===(u=null===(c=e.multimedia)||void 0===c?void 0:c.images)||void 0===u?void 0:u.map((function(e){return r.selectedImages[e]})).filter(Boolean))||[],attachedFormulas:(null===(f=null===(d=e.multimedia)||void 0===d?void 0:d.formulas)||void 0===f?void 0:f.map((function(e){return r.selectedFormulas[e]})).filter(Boolean))||[],attachedCode:(null===(g=null===(p=e.multimedia)||void 0===p?void 0:p.code)||void 0===g?void 0:g.map((function(e){return r.selectedCode[e]})).filter(Boolean))||[]})})))||t,console.log("🎉 Content Enhancement завершен. Обработано ".concat(u.length," карточек")),[2,{enhancedCards:u}];case 3:return d=p.sent(),console.error("Content enhancer error:",d),[2,{enhancedCards:t}];case 4:return[2]}}))}))},e.prototype.executeCardContentMatcher=function(e,t){return hl(this,void 0,void 0,(function(){var t,n,r,o,a,i,s,l=this;return ml(this,(function(c){switch(c.label){case 0:t=e.cards,n=e.contentEnhancement,r=e.originalText,o='Ты - Card Content Matcher Agent. Проанализируй каждую карточку и точно определи, какой мультимедиа контент ей подходит.\n\nОРИГИНАЛЬНЫЙ ТЕКСТ: "'.concat(r,'"\n\nКАРТОЧКИ ДЛЯ АНАЛИЗА (').concat(t.length,"):\n").concat(t.map((function(e,t){return"\nКарточка ".concat(t+1,":\nВопрос: ").concat(e.front,"\nОтвет: ").concat(e.back,"\nТема: ").concat(l.extractCardTopic(e.front,e.back),"\n")})).join(""),"\n\nДОСТУПНЫЙ КОНТЕНТ:\n").concat(n.shouldIncludeImages?"Изображения (".concat(n.selectedImages.length,"):\n").concat(n.selectedImages.map((function(e,t){return"".concat(t+1,'. Alt: "').concat(e.alt||"без описания",'" | Релевантность: ').concat(e.relevanceScore,"/10")})).join("\n")):"Изображения: отсутствуют","\n\n").concat(n.shouldIncludeFormulas?"Формулы (".concat(n.selectedFormulas.length,"):\n").concat(n.selectedFormulas.map((function(e,t){return"".concat(t+1,'. "').concat(e.text,'" | Релевантность: ').concat(e.relevanceScore,"/10")})).join("\n")):"Формулы: отсутствуют","\n\n").concat(n.shouldIncludeCode?"Код (".concat(n.selectedCode.length,"):\n").concat(n.selectedCode.map((function(e,t){return"".concat(t+1,". ").concat(e.language||"text",': "').concat(e.code.substring(0,80),'..." | Релевантность: ').concat(e.relevanceScore,"/10")})).join("\n")):"Код: отсутствует",'\n\nПРАВИЛА АНАЛИЗА:\n1. Для каждой карточки определи степень соответствия (0-10) каждого элемента контента\n2. Элемент добавляется к карточке только при соответствии ≥ 8/10\n3. Учитывай тематику: математика→формулы, программирование→код, процессы→схемы\n4. НЕ добавляй контент если он не добавляет образовательной ценности\n5. Приоритет: специфичность > общность\n\nJSON ответ:\n{\n  "cardMatches": [\n    {\n      "cardIndex": 0,\n      "relevantImages": [0],\n      "relevantFormulas": [],\n      "relevantCode": [],\n      "reasoning": "Изображение 1 прямо иллюстрирует концепт из вопроса"\n    },\n    {\n      "cardIndex": 1,\n      "relevantImages": [],\n      "relevantFormulas": [0],\n      "relevantCode": [],\n      "reasoning": "Формула 1 объясняет математическую зависимость из ответа"\n    }\n  ]\n}'),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.cardContentMatcher.systemPrompt},{role:"user",content:o}])];case 2:if(!(null==(a=c.sent())?void 0:a.content))throw new Error("No response from card content matcher agent");return i=this.parseJSONResponse(a.content,"cardContentMatcher"),console.log("🎯 Card content matcher result:",i),[2,i];case 3:return s=c.sent(),console.error("Card content matcher error:",s),[2,{cardMatches:[]}];case 4:return[2]}}))}))},e.prototype.extractCardTopic=function(e,t){var n=(e+" "+t).toLowerCase();return n.includes("формула")||n.includes("уравнение")||n.includes("математ")?"математика":n.includes("код")||n.includes("программ")||n.includes("алгоритм")?"программирование":n.includes("схема")||n.includes("диаграмма")||n.includes("процесс")?"схематика":n.includes("история")||n.includes("дата")||n.includes("событие")?"история":n.includes("определение")||n.includes("понятие")||n.includes("термин")?"теория":"общая"},e.prototype.executeTextAnalyst=function(e,t){var n,r,o;return hl(this,void 0,void 0,(function(){var t,a,i,s,l,c,u,d,f;return ml(this,(function(p){switch(p.label){case 0:t=e.text,a=e.pageContext,i=(null===(n=null==a?void 0:a.pageImages)||void 0===n?void 0:n.length)>0,s=(null===(r=null==a?void 0:a.formulas)||void 0===r?void 0:r.length)>0,l=(null===(o=null==a?void 0:a.codeBlocks)||void 0===o?void 0:o.length)>0,c="Ты - Text Analyst Agent. Проведи глубокий анализ текста и определи оптимальную стратегию обучения.\n\nТЕКСТ ДЛЯ АНАЛИЗА (".concat(t.length,' символов):\n"').concat(t,'"\n\nДОСТУПНЫЙ МУЛЬТИМЕДИА КОНТЕНТ:\n- Изображения: ').concat(i?a.pageImages.length:0," ").concat(i?"(ЕСТЬ - обязательно учти!)":"","\n- Формулы: ").concat(s?a.formulas.length:0,"\n- Код: ").concat(l?a.codeBlocks.length:0,'\n\nТВОЯ ЗАДАЧА:\n1. Определи основные темы и их важность\n2. Оцени сложность материала\n3. ТОЧНО определи сколько карточек ДЕЙСТВИТЕЛЬНО нужно (не переборщи!)\n4. Учти мультимедиа контент в планировании\n5. Приоритизируй темы\n\nПРИНЦИПЫ:\n- Большой текст ≠ много карточек\n- Фокус на ключевых концептах для понимания\n- Если есть изображения - они ДОЛЖНЫ быть использованы\n- Качество > количество\n\nJSON ответ:\n{\n  "textLength": ').concat(t.length,',\n  "complexity": "medium",\n  "mainTopics": [\n    {\n      "name": "Основная тема",\n      "importance": "critical",\n      "complexity": "medium",\n      "estimatedCards": 2,\n      "needsMultimedia": true,\n      "multimediaTypes": ["images"],\n      "subtopics": ["подтема1", "подтема2"]\n    }\n  ],\n  "estimatedCards": 3,\n  "learningObjectives": ["понять X", "запомнить Y"],\n  "hasMultimedia": ').concat(i||s||l,',\n  "multimediaTypes": [').concat(i?'"images"':"").concat(s?', "formulas"':"").concat(l?', "code"':"",'],\n  "priority": "high",\n  "reasoning": "Объяснение стратегии"\n}'),p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.textAnalyst.systemPrompt},{role:"user",content:c}])];case 2:if(!(null==(u=p.sent())?void 0:u.content))throw new Error("No response from text analyst agent");return d=this.parseJSONResponse(u.content,"textAnalyst"),console.log("📋 Text analysis result:",d),[2,d];case 3:return f=p.sent(),console.error("Text analyst error:",f),[2,{textLength:t.length,complexity:this.estimateComplexity(t),mainTopics:[{name:"Основная тема",importance:"important",complexity:"medium",estimatedCards:Math.min(5,Math.ceil(t.length/1e3)),needsMultimedia:i||s||l,multimediaTypes:yl(yl(yl([],i?["images"]:[],!0),s?["formulas"]:[],!0),l?["code"]:[],!0),subtopics:[]}],estimatedCards:Math.min(5,Math.ceil(t.length/1e3)),learningObjectives:["Понимание основных концептов"],hasMultimedia:i||s||l,multimediaTypes:yl(yl(yl([],i?["images"]:[],!0),s?["formulas"]:[],!0),l?["code"]:[],!0),priority:"medium",reasoning:"Fallback analysis due to error"}];case 4:return[2]}}))}))},e.prototype.executeCardPlanner=function(e,t){var n,r,o,a,i,s,l,c,u,d,f,p;return hl(this,void 0,void 0,(function(){var t,g,h,m,y,x,v;return ml(this,(function(b){switch(b.label){case 0:t=e.textAnalysis,e.originalText,g=e.pageContext,h="Ты - Card Planner Agent. Создай детальный план карточек на основе анализа текста.\n\nАНАЛИЗ ТЕКСТА:\nОсновные темы: ".concat((null===(n=t.mainTopics)||void 0===n?void 0:n.map((function(e){return"".concat(e.name," (важность: ").concat(e.importance,")")})).join(", "))||"Основные темы","\nРекомендуемое количество карточек: ").concat(t.estimatedCards,"\nСложность: ").concat(t.complexity,"\nЕсть мультимедиа: ").concat(t.hasMultimedia?"ДА":"НЕТ","\nТипы мультимедиа: ").concat((null===(r=t.multimediaTypes)||void 0===r?void 0:r.join(", "))||"нет типов","\n\nДОСТУПНЫЙ КОНТЕНТ:\n").concat((null===(o=null==g?void 0:g.pageImages)||void 0===o?void 0:o.length)>0?"- Изображения: ".concat(g.pageImages.length," (ПРИОРИТЕТ - пользователь выделил!)"):"","\n").concat((null===(a=null==g?void 0:g.formulas)||void 0===a?void 0:a.length)>0?"- Формулы: ".concat(g.formulas.length):"","\n").concat((null===(i=null==g?void 0:g.codeBlocks)||void 0===i?void 0:i.length)>0?"- Код: ".concat(g.codeBlocks.length):"",'\n\nТВОЯ ЗАДАЧА:\n1. Создай точный план каждой карточки\n2. Определи тип карточки (концепт, пример, формула, код)\n3. Спланируй распределение мультимедиа\n4. Оптимизируй для эффективного обучения\n5. ОБЯЗАТЕЛЬНО включи изображения если они есть\n\nТИПЫ КАРТОЧЕК:\n- concept: основные понятия (с изображениями/схемами)\n- definition: определения терминов\n- formula: формулы и уравнения (с формулами)\n- code: примеры кода (с кодом)\n- example: практические примеры\n- application: применение знаний\n\nJSON ответ:\n{\n  "totalCards": 3,\n  "cardSpecs": [\n    {\n      "id": "card_1",\n      "type": "concept",\n      "topic": "Основное понятие",\n      "priority": "high",\n      "difficulty": "medium",\n      "needsMultimedia": true,\n      "multimediaTypes": ["images"],\n      "estimatedLength": "medium",\n      "description": "Карточка объясняет основной концепт с использованием схемы"\n    }\n  ],\n  "multimediaDistribution": {\n    "totalImages": ').concat((null===(s=null==g?void 0:g.pageImages)||void 0===s?void 0:s.length)||0,',\n    "totalFormulas": ').concat((null===(l=null==g?void 0:g.formulas)||void 0===l?void 0:l.length)||0,',\n    "totalCode": ').concat((null===(c=null==g?void 0:g.codeBlocks)||void 0===c?void 0:c.length)||0,',\n    "assignments": [],\n    "userSelectedImages": [0, 1],\n    "reasoning": "Распределение мультимедиа"\n  },\n  "learningFlow": ["card_1", "card_2", "card_3"],\n  "reasoning": "Объяснение плана"\n}'),b.label=1;case 1:return b.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.cardPlanner.systemPrompt},{role:"user",content:h}])];case 2:if(!(null==(m=b.sent())?void 0:m.content))throw new Error("No response from card planner agent");return y=this.parseJSONResponse(m.content,"cardPlanner"),console.log("📋 Card plan result:",y),[2,y];case 3:return x=b.sent(),console.error("Card planner error:",x),[2,{totalCards:v=Math.min(t.estimatedCards,5),cardSpecs:Array.from({length:v},(function(e,n){return{id:"card_".concat(n+1),type:"concept",topic:"Тема ".concat(n+1),priority:"medium",difficulty:"medium",needsMultimedia:t.hasMultimedia,multimediaTypes:t.multimediaTypes||[],estimatedLength:"medium",description:"Карточка ".concat(n+1)}})),multimediaDistribution:{totalImages:(null===(u=null==g?void 0:g.pageImages)||void 0===u?void 0:u.length)||0,totalFormulas:(null===(d=null==g?void 0:g.formulas)||void 0===d?void 0:d.length)||0,totalCode:(null===(f=null==g?void 0:g.codeBlocks)||void 0===f?void 0:f.length)||0,assignments:[],userSelectedImages:(null===(p=null==g?void 0:g.pageImages)||void 0===p?void 0:p.map((function(e,t){return t})))||[],reasoning:"Fallback distribution"},learningFlow:Array.from({length:v},(function(e,t){return"card_".concat(t+1)})),reasoning:"Fallback plan due to error"}];case 4:return[2]}}))}))},e.prototype.executeMultimediaAssigner=function(e,t){var n,r,o,a,i,s,l,c,u,d;return hl(this,void 0,void 0,(function(){var t,f,p,g,h,m,y,x,v,b;return ml(this,(function(w){switch(w.label){case 0:t=e.cardPlan,f=e.pageContext,e.originalText,p="Ты - Multimedia Assigner Agent. Точно распредели мультимедиа контент по карточкам.\n\nПЛАН КАРТОЧЕК:\n".concat(t.cardSpecs.map((function(e,t){var n;return"\nКарточка ".concat(t+1," (").concat(e.id,"):\n- Тип: ").concat(e.type,"\n- Тема: ").concat(e.topic,"\n- Нужен мультимедиа: ").concat(e.needsMultimedia?"ДА":"НЕТ","\n- Типы: ").concat((null===(n=e.multimediaTypes)||void 0===n?void 0:n.join(", "))||"нет типов","\n- Описание: ").concat(e.description,"\n")})).join(""),"\n\nДОСТУПНЫЙ МУЛЬТИМЕДИА:\n").concat((null===(n=null==f?void 0:f.pageImages)||void 0===n?void 0:n.length)>0?"\nИЗОБРАЖЕНИЯ (".concat(f.pageImages.length,") - ПРИОРИТЕТ:\n").concat(f.pageImages.map((function(e,t){return"".concat(t,'. "').concat(e.alt||"без описания",'" (релевантность: ').concat(e.relevanceScore,"/10)")})).join("\n"),"\n"):"Изображения: нет","\n\n").concat((null===(r=null==f?void 0:f.formulas)||void 0===r?void 0:r.length)>0?"\nФОРМУЛЫ (".concat(f.formulas.length,"):\n").concat(f.formulas.map((function(e,t){return"".concat(t,'. "').concat(e.text,'" (тип: ').concat(e.type,")")})).join("\n"),"\n"):"Формулы: нет","\n\n").concat((null===(o=null==f?void 0:f.codeBlocks)||void 0===o?void 0:o.length)>0?"\nКОД (".concat(f.codeBlocks.length,"):\n").concat(f.codeBlocks.map((function(e,t){return"".concat(t,". ").concat(e.language||"text",': "').concat(e.code.substring(0,60),'..."')})).join("\n"),"\n"):"Код: нет",'\n\nОСОБЫЕ ТРЕБОВАНИЯ:\n- Если пользователь выделил изображение - оно ДОЛЖНО попасть в карточку\n- Каждое изображение должно иметь четкую образовательную цель\n- Распределяй контент только при высокой релевантности (≥8/10)\n- Один элемент мультимедиа может использоваться в нескольких карточках если это оправдано\n\nJSON ответ:\n{\n  "totalImages": ').concat((null===(a=null==f?void 0:f.pageImages)||void 0===a?void 0:a.length)||0,',\n  "totalFormulas": ').concat((null===(i=null==f?void 0:f.formulas)||void 0===i?void 0:i.length)||0,',\n  "totalCode": ').concat((null===(s=null==f?void 0:f.codeBlocks)||void 0===s?void 0:s.length)||0,',\n  "assignments": [\n    {\n      "cardId": "card_1",\n      "imageIndices": [0],\n      "formulaIndices": [],\n      "codeIndices": [],\n      "reasoning": "Изображение 0 прямо иллюстрирует концепт карточки"\n    }\n  ],\n  "userSelectedImages": [').concat((null===(l=null==f?void 0:f.pageImages)||void 0===l?void 0:l.map((function(e,t){return t})).join(", "))||"",'],\n  "reasoning": "Объяснение распределения"\n}'),w.label=1;case 1:return w.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.multimediaAssigner.systemPrompt},{role:"user",content:p}])];case 2:if(!(null==(g=w.sent())?void 0:g.content))throw new Error("No response from multimedia assigner agent");return h=this.parseJSONResponse(g.content,"multimediaAssigner"),console.log("🎯 Multimedia assignment result:",h),[2,h];case 3:return m=w.sent(),console.error("Multimedia assigner error:",m),y=[],x=(null===(c=null==f?void 0:f.pageImages)||void 0===c?void 0:c.length)||0,v=(null===(u=null==f?void 0:f.formulas)||void 0===u?void 0:u.length)||0,b=(null===(d=null==f?void 0:f.codeBlocks)||void 0===d?void 0:d.length)||0,t.cardSpecs.forEach((function(e,n){var r={cardId:e.id,imageIndices:[],formulaIndices:[],codeIndices:[],reasoning:"Fallback assignment"};if(e.needsMultimedia&&Array.isArray(e.multimediaTypes)&&e.multimediaTypes.includes("images")&&x>0){var o=Math.ceil(x/t.cardSpecs.length),a=n*o,i=Math.min(a+o,x);r.imageIndices=Array.from({length:i-a},(function(e,t){return a+t}))}y.push(r)})),[2,{totalImages:x,totalFormulas:v,totalCode:b,assignments:y,userSelectedImages:Array.from({length:x},(function(e,t){return t})),reasoning:"Fallback distribution due to error"}];case 4:return[2]}}))}))},e.prototype.getMatchedContentForCard=function(e,t){if(!t||!t.cardMatches)return"нет рекомендаций";var n=t.cardMatches.find((function(t){return t.cardIndex===e}));if(!n)return"нет соответствий";var r=[];return n.relevantImages&&Array.isArray(n.relevantImages)&&n.relevantImages.length>0&&r.push("изображения [".concat(n.relevantImages.join(", "),"]")),n.relevantFormulas&&Array.isArray(n.relevantFormulas)&&n.relevantFormulas.length>0&&r.push("формулы [".concat(n.relevantFormulas.join(", "),"]")),n.relevantCode&&Array.isArray(n.relevantCode)&&n.relevantCode.length>0&&r.push("код [".concat(n.relevantCode.join(", "),"]")),r.length>0?r.join(", "):"нет подходящего контента"},e.prototype.detectLanguage=function(e){return/[а-яё]/i.test(e)?"russian":"english"},e.prototype.estimateComplexity=function(e){var t=e.split(/\s+/).length,n=t/e.split(/[.!?]+/).length;return n<10&&t<100?"simple":n<20&&t<500?"medium":"advanced"},e.prototype.parseJSONResponse=function(e,t){try{var n=e.match(/\{[\s\S]*\}/);if(!n)throw new Error("No JSON found in ".concat(t," response"));return JSON.parse(n[0])}catch(e){throw console.error("Error parsing ".concat(t," response:"),e),e}},e.prototype.createFallbackSupervisorDecision=function(){return{strategy:"multiple_concepts",agents:["contentAnalyzer","cardGenerator","questionQuality","validator"],instructions:{contentAnalyzer:"Проанализируй ключевые понятия в тексте",cardGenerator:"Создай карточки для основных понятий",questionQuality:"Проверь качество каждого вопроса",validator:"Проведи финальную проверку"},expectedOutput:"Набор качественных карточек",reasoning:"Fallback strategy - general approach"}},e.prototype.createFallbackContentAnalysis=function(e){return{mainTopic:"Анализ контента",keyPoints:[e.substring(0,100)],concepts:[{name:"Основной концепт",definition:e.substring(0,200),importance:"medium",prerequisites:[],examples:[]}],relationships:[],learningObjectives:["Понять основную идею"],complexity:"medium",estimatedCards:2}},e.prototype.createFallbackCards=function(e){return[{front:"What is discussed in this text?",back:e.substring(0,200)+(e.length>200?"...":""),difficulty:"medium",concept:"Main idea"}]},e.prototype.createFallbackQualityCheck=function(e){return{question:e.front,answer:e.back,qualityScore:7,relevanceScore:7,difficultyScore:7,issues:[],improvements:[],isWorthwhile:!0,reasoning:"Fallback quality check - acceptable card"}},e.prototype.createFallbackValidation=function(e){return{isValid:!0,overallScore:75,cardScores:e.reduce((function(e,t,n){var r;return gl(gl({},e),((r={})[n]=75,r))}),{}),issues:[],suggestions:[],finalRecommendation:"Cards passed basic validation"}},e.prototype.createFallbackContentEnhancement=function(){return{shouldIncludeImages:!1,selectedImages:[],shouldIncludeFormulas:!1,selectedFormulas:[],shouldIncludeCode:!1,selectedCode:[],reasoning:"Fallback - no multimedia content analysis"}},e.prototype.convertToStoredCards=function(e,t){return e.map((function(e,n){var r=gl(gl(gl(gl({id:"ai_agent_".concat(Date.now(),"_").concat(n,"_").concat(Math.random().toString(36).substr(2,9)),mode:_.GeneralTopic,front:e.front,back:e.back,text:t,createdAt:new Date,exportStatus:"not_exported"},e.tags&&{tags:e.tags}),e.difficulty&&{difficulty:e.difficulty}),e.concept&&{concept:e.concept}),e.qualityScore&&{qualityScore:e.qualityScore});if(e.attachedImages&&e.attachedImages.length>0){var o=e.attachedImages[0];o.base64?(r.image=o.base64,console.log("💾 Сохранено изображение в base64 формате для карточки:",r.id)):o.src&&(r.imageUrl=o.src,console.log("💾 Сохранена ссылка на изображение для карточки:",r.id))}return e.image&&(r.image=e.image,console.log("💾 Скопировано изображение из card.image для карточки:",r.id)),e.imageUrl&&(r.imageUrl=e.imageUrl,console.log("💾 Скопирована ссылка из card.imageUrl для карточки:",r.id)),r}))},e}(),vl=function(e,t){return new xl(e,t)},bl=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},wl=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},Sl=function(){function e(){}return e.extractPageContent=function(e,t){return{selectedText:e,pageImages:this.extractImages(e,t),formulas:this.extractFormulas(e,t),codeBlocks:this.extractCodeBlocks(e,t),links:this.extractLinks(e,t),metadata:this.extractMetadata()}},e.extractPageContentAsync=function(e,t){return bl(this,void 0,void 0,(function(){var n,r,o,a,i;return wl(this,(function(s){switch(s.label){case 0:return console.log("🔍 Асинхронно извлекаем контент страницы..."),[4,this.extractImagesAsync(e,t)];case 1:return n=s.sent(),r=this.extractFormulas(e,t),o=this.extractCodeBlocks(e,t),a=this.extractLinks(e,t),i=this.extractMetadata(),console.log("📄 Асинхронная экстракция завершена:",{images:n.length,formulas:r.length,codeBlocks:o.length,links:a.length}),[2,{selectedText:e,pageImages:n,formulas:r,codeBlocks:o,links:a,metadata:i}]}}))}))},e.extractImages=function(e,t){var n=this,r=[],o=document.querySelectorAll("img");console.log("🔍 Найдено ".concat(o.length," изображений на странице")),o.forEach((function(o,a){if(o.width<30||o.height<30)console.log("⏭️ Пропускаем маленькое изображение ".concat(a,": ").concat(o.width,"x").concat(o.height));else if(o.src)if(o.src.startsWith("data:image")&&o.src.length>5e3)console.log("⏭️ Пропускаем изображение ".concat(a,": слишком длинный data URL"));else{var i=n.isElementNearSelection(o,t,e),s=n.calculateImageRelevance(o,e,i);if(console.log("🖼️ Изображение ".concat(a,":"),{src:o.src.substring(0,50)+"...",alt:o.alt,size:"".concat(o.width,"x").concat(o.height),isNearText:i,relevanceScore:s,willInclude:s>.1}),s>.1){var l=n.convertImageToBase64(o);r.push({src:o.src,alt:o.alt||o.title||"",title:o.title,width:o.naturalWidth||o.width,height:o.naturalHeight||o.height,isNearText:i,relevanceScore:s,base64:l}),console.log("✅ Добавлено изображение ".concat(a," (score: ").concat(s,")"))}else console.log("❌ Изображение ".concat(a," не прошло порог (score: ").concat(s,")"))}else console.log("⏭️ Пропускаем изображение ".concat(a,": нет src"))}));var a=document.querySelectorAll("svg");console.log("🔍 Найдено ".concat(a.length," SVG элементов")),a.forEach((function(o,a){var i,s,l=(null===(i=o.width.baseVal)||void 0===i?void 0:i.value)||0,c=(null===(s=o.height.baseVal)||void 0===s?void 0:s.value)||0;if(l<30||c<30)console.log("⏭️ Пропускаем маленький SVG ".concat(a,": ").concat(l,"x").concat(c));else{var u=n.isElementNearSelection(o,t,e),d=n.calculateSvgRelevance(o,e,u);console.log("🎨 SVG ".concat(a,":"),{size:"".concat(l,"x").concat(c),isNearText:u,relevanceScore:d,willInclude:d>.1}),d>.1&&(r.push({src:n.svgToDataUrl(o),alt:o.getAttribute("aria-label")||o.getAttribute("title")||"SVG диаграмма",width:l||200,height:c||200,isNearText:u,relevanceScore:d,base64:n.svgToDataUrl(o)}),console.log("✅ Добавлен SVG ".concat(a," (score: ").concat(d,")")))}}));var i=r.sort((function(e,t){return t.relevanceScore-e.relevanceScore})).slice(0,10);if(0===i.length){console.log("🚨 Не найдено релевантных изображений, применяем аварийную логику");var s=[];o.forEach((function(e,t){if(e.width>=30&&e.height>=30&&e.src){var r=n.convertImageToBase64(e);s.push({src:e.src,alt:e.alt||e.title||"Изображение ".concat(t+1),title:e.title,width:e.naturalWidth||e.width,height:e.naturalHeight||e.height,isNearText:!1,relevanceScore:.5,base64:r})}})),i=s.slice(0,5),console.log("🎯 АВАРИЙНЫЙ РЕЖИМ: Добавлено ".concat(i.length," изображений"))}return console.log("🎯 Финальный результат: ".concat(i.length," изображений из ").concat(r.length," найденных")),i},e.extractImagesAsync=function(e,t){return bl(this,void 0,void 0,(function(){var n,r,o,a=this;return wl(this,(function(i){switch(i.label){case 0:return n=[],r=document.querySelectorAll("img"),o=Array.from(r).map((function(n){return bl(a,void 0,void 0,(function(){var r,o,a;return wl(this,(function(i){switch(i.label){case 0:return n.width<50||n.height<50||(!n.src||n.src.startsWith("data:image")&&n.src.length>1e3)?[2,null]:(r=this.isElementNearSelection(n,t,e),(o=this.calculateImageRelevance(n,e,r))<=.3?[2,null]:!n.src.startsWith("http")||n.src.includes(window.location.origin)?[3,2]:(console.log("🖼️ Загружаем внешнее изображение:",n.src),[4,this.fetchImageAsBase64(n.src)]));case 1:return a=i.sent(),[3,3];case 2:a=this.convertImageToBase64(n),i.label=3;case 3:return[2,{src:n.src,alt:n.alt||n.title||"",title:n.title,width:n.naturalWidth||n.width,height:n.naturalHeight||n.height,isNearText:r,relevanceScore:o,base64:a}]}}))}))})),[4,Promise.all(o)];case 1:return i.sent().forEach((function(e){e&&n.push(e)})),document.querySelectorAll("svg").forEach((function(r){var o,i,s=(null===(o=r.width.baseVal)||void 0===o?void 0:o.value)||0,l=(null===(i=r.height.baseVal)||void 0===i?void 0:i.value)||0;if(!(s<50||l<50)){var c=a.isElementNearSelection(r,t,e),u=a.calculateSvgRelevance(r,e,c);u>.3&&n.push({src:a.svgToDataUrl(r),alt:r.getAttribute("aria-label")||r.getAttribute("title")||"SVG диаграмма",width:s||200,height:l||200,isNearText:c,relevanceScore:u,base64:a.svgToDataUrl(r)})}})),console.log("🖼️ Найдено ".concat(n.length," релевантных изображений (включая ").concat(n.filter((function(e){return e.base64})).length," с base64)")),[2,n.sort((function(e,t){return t.relevanceScore-e.relevanceScore})).slice(0,5)]}}))}))},e.extractFormulas=function(e,t){var n=this,r=[];document.querySelectorAll('.MathJax, .math, [class*="math"]').forEach((function(o){var a=n.extractFormulaText(o);if(a){var i=n.isElementNearSelection(o,t,e);r.push({text:a,type:n.detectFormulaType(o),isNearText:i,relevanceScore:n.calculateFormulaRelevance(a,e,i)})}}));var o=[/\$\$([^$]+)\$\$/g,/\$([^$]+)\$/g,/\\begin\{[^}]+\}[\s\S]*?\\end\{[^}]+\}/g],a=document.body.textContent||"";return o.forEach((function(t){for(var i;null!==(i=t.exec(a));){var s=i[1]||i[0],l=a.toLowerCase().includes(e.toLowerCase());r.push({text:s,type:t===o[0]?"block":"inline",isNearText:l,relevanceScore:n.calculateFormulaRelevance(s,e,l)})}})),r.filter((function(e){return e.relevanceScore>.2})).sort((function(e,t){return t.relevanceScore-e.relevanceScore})).slice(0,3)},e.extractCodeBlocks=function(e,t){var n=this,r=[];return document.querySelectorAll("pre code, .highlight code, .code-block, .codehilite").forEach((function(o){var a,i=null===(a=o.textContent)||void 0===a?void 0:a.trim();if(i&&i.length>10&&i.length<2e3){var s=n.isElementNearSelection(o,t,e),l=n.detectCodeLanguage(o);r.push({code:i,language:l,isNearText:s,relevanceScore:n.calculateCodeRelevance(i,e,s)})}})),document.querySelectorAll("code:not(pre code)").forEach((function(o){var a,i=null===(a=o.textContent)||void 0===a?void 0:a.trim();if(i&&i.length>3&&i.length<100){var s=n.isElementNearSelection(o,t,e);r.push({code:i,language:"inline",isNearText:s,relevanceScore:n.calculateCodeRelevance(i,e,s)})}})),r.filter((function(e){return e.relevanceScore>.3})).sort((function(e,t){return t.relevanceScore-e.relevanceScore})).slice(0,5)},e.extractLinks=function(e,t){var n=this,r=[];return document.querySelectorAll("a[href]").forEach((function(o){var a,i=o.getAttribute("href"),s=null===(a=o.textContent)||void 0===a?void 0:a.trim();if(i&&s&&i.startsWith("http")){var l=n.isElementNearSelection(o,t,e),c=n.calculateLinkRelevance(s,i,e,l);c>.2&&r.push({url:i,text:s,isNearText:l,relevanceScore:c})}})),r.sort((function(e,t){return t.relevanceScore-e.relevanceScore})).slice(0,3)},e.extractMetadata=function(){return{url:window.location.href,title:document.title,domain:window.location.hostname,language:document.documentElement.lang||"en",hasImages:document.querySelectorAll("img").length>0,hasFormulas:document.querySelectorAll('.MathJax, .math, [class*="math"]').length>0||(document.body.textContent||"").includes("$"),hasCode:document.querySelectorAll("pre code, .highlight, .code-block").length>0}},e.isElementNearSelection=function(e,t,n){var r;if(!t){var o=e.textContent||"",a=(null===(r=e.parentElement)||void 0===r?void 0:r.textContent)||"";return o.toLowerCase().includes((n||"").toLowerCase())||a.toLowerCase().includes((n||"").toLowerCase())}var i=e.getBoundingClientRect(),s=t.getBoundingClientRect();return Math.sqrt(Math.pow(i.left-s.left,2)+Math.pow(i.top-s.top,2))<500},e.calculateImageRelevance=function(e,t,n){var r=.3;n&&(r+=.4);var o=(e.alt||"").toLowerCase(),a=t.toLowerCase();(o.includes(a)||a.includes(o))&&(r+=.3);var i=e.naturalWidth||e.width,s=e.naturalHeight||e.height;return i>=50&&s>=50&&(r+=.2),(o.includes("icon")||o.includes("logo")||i<50||s<50)&&(r-=.2),(o.includes("diagram")||o.includes("chart")||o.includes("graph")||o.includes("figure")||o.includes("схема")||o.includes("диаграмма")||o.includes("рисунок")||o.includes("изображение"))&&(r+=.3),console.log("📊 Relevance calculation for image:",{alt:o.substring(0,30),size:"".concat(i,"x").concat(s),isNearText:n,finalScore:Math.max(0,Math.min(1,r))}),Math.max(0,Math.min(1,r))},e.calculateSvgRelevance=function(e,t,n){var r=0;n&&(r+=.5),r+=.3;var o=e.textContent||"";return(o.toLowerCase().includes(t.toLowerCase())||t.toLowerCase().includes(o.toLowerCase()))&&(r+=.2),Math.max(0,Math.min(1,r))},e.calculateFormulaRelevance=function(e,t,n){var r=0;n&&(r+=.4);var o=t.toLowerCase().match(/\b(формула|уравнение|функция|интеграл|производная|матрица|вектор|логарифм|синус|косинус|тангенс|предел|сумма|произведение)\b/g);return o&&o.length>0&&(r+=.4),e.length>20&&(r+=.2),Math.max(0,Math.min(1,r))},e.calculateCodeRelevance=function(e,t,n){var r=0;n&&(r+=.4);var o=t.toLowerCase().match(/\b(алгоритм|функция|метод|класс|переменная|массив|цикл|условие|код|программа|скрипт)\b/g);return o&&o.length>0&&(r+=.4),e.includes("\n")&&e.includes("{")&&e.includes("}")&&(r+=.2),Math.max(0,Math.min(1,r))},e.calculateLinkRelevance=function(e,t,n,r){var o=0;return r&&(o+=.3),(e.toLowerCase().includes(n.toLowerCase())||n.toLowerCase().includes(e.toLowerCase()))&&(o+=.4),(t.includes("wikipedia")||t.includes("edu")||t.includes("documentation"))&&(o+=.3),Math.max(0,Math.min(1,o))},e.convertImageToBase64=function(e){try{if(!e.complete||0===e.naturalWidth)return void console.warn("Image not loaded yet:",e.src);var t=document.createElement("canvas"),n=t.getContext("2d");if(!n)return;return t.width=e.naturalWidth||e.width,t.height=e.naturalHeight||e.height,n.fillStyle="#FFFFFF",n.fillRect(0,0,t.width,t.height),n.drawImage(e,0,0),t.toDataURL("image/png",1)}catch(e){return void console.warn("Could not convert image to base64:",e)}},e.fetchImageAsBase64=function(e){return bl(this,void 0,void 0,(function(){var t;return wl(this,(function(n){try{return console.log("🖼️ Загружаем внешнее изображение:",e),(t=new Image).crossOrigin="anonymous",[2,new Promise((function(n){t.onload=function(){try{var e=document.createElement("canvas"),r=e.getContext("2d");if(!r)return void n(void 0);e.width=t.naturalWidth,e.height=t.naturalHeight,r.fillStyle="#FFFFFF",r.fillRect(0,0,e.width,e.height),r.drawImage(t,0,0);var o=e.toDataURL("image/png",1);console.log("✅ Изображение успешно конвертировано в base64"),n(o)}catch(e){console.warn("Ошибка при конвертации изображения:",e),n(void 0)}},t.onerror=function(){console.warn("Ошибка загрузки изображения:",e),n(void 0)},t.src=e}))]}catch(e){return console.warn("Failed to fetch image as base64:",e),[2,void 0]}return[2]}))}))},e.svgToDataUrl=function(e){var t=(new XMLSerializer).serializeToString(e);return"data:image/svg+xml;base64,".concat(btoa(t))},e.extractFormulaText=function(e){var t=e.querySelector("math");return t?t.textContent||t.innerHTML:e.getAttribute("data-latex")||e.getAttribute("data-math")||e.textContent||null},e.detectFormulaType=function(e){if(e.querySelector("math"))return"mathml";var t=e.className.toLowerCase();return t.includes("display")||t.includes("block")?"block":t.includes("inline")?"inline":"latex"},e.detectCodeLanguage=function(e){var t=e.className.match(/language-(\w+)|lang-(\w+)|highlight-(\w+)/);if(t)return t[1]||t[2]||t[3];var n=e.getAttribute("data-lang")||e.getAttribute("data-language");if(n)return n;var r=e.textContent||"";return r.includes("function")&&r.includes("{")?"javascript":r.includes("def ")&&r.includes(":")?"python":r.includes("#include")||r.includes("int main")?"cpp":r.includes("public class")||r.includes("System.out")?"java":void 0},e}(),Cl=function(){return Cl=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Cl.apply(this,arguments)},El=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},kl=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},Il=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))};const Al=function(){r.useEffect((function(){var e=document.createElement("style");return e.textContent="\n            @keyframes fadeIn {\n                from { opacity: 0; }\n                to { opacity: 1; }\n            }\n            @keyframes slideUp {\n                from { \n                    opacity: 0;\n                    transform: translateY(30px) scale(0.95);\n                }\n                to { \n                    opacity: 1;\n                    transform: translateY(0) scale(1);\n                }\n            }\n            @keyframes slideIn {\n                from { \n                    opacity: 0;\n                    transform: translateX(-20px);\n                }\n                to { \n                    opacity: 1;\n                    transform: translateX(0);\n                }\n            }\n        ",document.head.appendChild(e),function(){document.head.removeChild(e)}}),[]);var e=(0,r.useState)(!1),t=e[0],n=e[1],o=(m((function(e){return e.deck.deckId})),Ue()),i=k(),s=(0,r.useCallback)((function(e){i({type:"SET_SOURCE_LANGUAGE",payload:e}),localStorage.setItem("source_language",e)}),[i]),l=o.text,c=o.translation,u=o.examples,d=o.image,f=o.imageUrl,p=o.front,g=o.back,h=o.currentCardId,y=o.linguisticInfo,x=o.transcription,v=(o.fieldIdPrefix,m((function(e){return e.settings.translateToLanguage}))),b=m((function(e){return e.settings.aiInstructions})),w=m((function(e){return e.settings.imageInstructions})),S=(m((function(e){return e.deck.decks})),m((function(e){return e.settings.mode}))),C=(0,r.useState)(""),E=C[0],I=C[1],A=(0,r.useCallback)((function(){var e=S===_.LanguageLearning?_.GeneralTopic:_.LanguageLearning;i(xt(e)),localStorage.setItem("selected_mode",e),i(Ie("")),i(Oe("")),i(je(null)),i(_e(null)),i(Ae([])),i(Fe(null)),i(Te(null)),i(Ne("")),i(Le("")),i(Re(null)),wt(null),At(""),Ct(!1),n(!1),vt(!1),ut([]),ht(0)}),[S,i]),F=(m((function(e){return e.settings.useAnkiConnect})),m((function(e){return e.settings.ankiConnectUrl})),m((function(e){return e.settings.ankiConnectApiKey})),(0,r.useState)(!1)),T=F[0],j=F[1],O=(0,r.useState)(!1),P=O[0],R=O[1],N=(0,r.useState)(!1),L=N[0],B=N[1],z=(0,r.useState)(!1),D=z[0],M=z[1],U=(0,r.useState)(!1),$=U[0],W=U[1],V=(0,r.useState)(!0),q=V[0],G=V[1],H=(0,r.useState)(!1),K=H[0],Y=H[1],Q=m((function(e){return e.settings.openAiKey})),J=m((function(e){return e.settings.groqApiKey})),X=m((function(e){return e.settings.groqModelName})),Z=m((function(e){return e.settings.modelProvider})),ee=m((function(e){return e.settings.shouldGenerateImage})),te=m((function(e){return e.settings.imageGenerationMode})),ne=(0,r.useState)(!1),re=ne[0],oe=ne[1],ae=(0,r.useState)(!1),ie=ae[0],se=ae[1],le=(0,r.useState)(b),ce=le[0],ue=le[1],de=(0,r.useState)(w),fe=de[0],pe=de[1],ge=As(),he=ge.showError,me=ge.renderErrorNotification,ye=function(e){var t=e.message.toLowerCase();return t.includes("quota")||t.includes("insufficient_quota")||t.includes("billing")||t.includes("exceeded")||t.includes("429")},xe=new Ss({apiKey:Q,dangerouslyAllowBrowser:!0}),ve=(0,r.useState)(""),be=ve[0],we=ve[1],Se=(0,r.useState)(!1),Ce=Se[0],Be=Se[1],ze=(0,r.useState)(!1),De=ze[0],Me=ze[1],$e=(0,r.useState)([]),We=$e[0],Ve=$e[1],Qe=(0,r.useState)(!1),Je=Qe[0],Ze=Qe[1],et=(0,r.useState)(!1),tt=et[0],nt=et[1],ot=(0,r.useState)({}),at=ot[0],it=ot[1],st=(0,r.useState)([]),lt=st[0],ut=st[1],dt=(0,r.useState)(0),gt=dt[0],ht=dt[1],mt=(0,r.useState)(!1),yt=mt[0],vt=mt[1],bt=(0,r.useState)(null),wt=(bt[0],bt[1]),St=(0,r.useState)(!1),Ct=(St[0],St[1]),Et=(0,r.useState)(""),kt=Et[0],At=Et[1],Ft=(0,r.useState)([]),Tt=Ft[0],jt=Ft[1],Ot=(0,r.useState)(!1),Nt=Ot[0],zt=Ot[1],$t=(0,r.useState)(0),Ht=$t[0],Kt=$t[1],Jt=(0,r.useState)(new Set),Xt=Jt[0],en=Jt[1],tn=(0,r.useState)(!1),rn=tn[0],on=tn[1],an=(0,r.useState)(""),sn=an[0],cn=an[1],un=(0,r.useRef)(null),dn=o.storedCards,fn=(0,r.useMemo)((function(){return el(Z)}),[Z]),pn=(0,r.useMemo)((function(){return function(e,t,n){switch(void 0===n&&(n=""),e){case zs.OpenAI:return t;case zs.Groq:return n;default:return t}}(Z,Q,J)}),[Z,Q,J]),gn=(0,r.useState)([]),hn=gn[0],mn=gn[1],yn=(0,r.useCallback)((function(e){return!!e&&hn.includes(e)}),[hn]),xn=(0,r.useMemo)((function(){if(console.log("Calculating isSaved:",{currentCardId:h,explicitlySaved:K,isMultipleCards:yt,currentCardIndex:gt,createdCardsLength:lt.length,explicitlySavedIds:hn}),yt&&lt.length>0){var e=lt[gt];return!!e&&yn(e.id)}return!(!h||!K)}),[h,K,yt,gt,lt,yn]);console.log("Card state details:",{isNewSubmission:q,explicitlySaved:K,isSaved:xn,currentCardId:h,text:l.substring(0,20)+(l.length>20?"...":""),localStorage_explicitly_saved:localStorage.getItem("explicitly_saved")});(0,r.useEffect)((function(){xn&&W(!0)}),[l,c,u,d,f,p,xn]);var vn=(0,r.useCallback)((function(e){if(e&&""!==e.trim()){var t=Ns().find((function(t){return t.text===e}));return!!t&&(console.log("Found existing card with matching text:",(null==t?void 0:t.text)||e,"ID:",t.id),console.log("Setting currentCardId but NOT setting explicitlySaved"),i(Re(t.id)),!0)}}),[i]),bn=function(e){o.setText(e),xn?W(!0):vn(e)},wn=function(e){o.setTranslation(e),xn&&W(!0)},Sn=function(e){o.setExamples(e),xn&&W(!0)},Cn=function(){return El(void 0,void 0,void 0,(function(){var e,t,n,r,a,i,s;return kl(this,(function(c){switch(c.label){case 0:R(!0),c.label=1;case 1:return c.trys.push([1,6,7,8]),(null===(i=un.current)||void 0===i?void 0:i.signal.aborted)?(console.log("New image generation cancelled"),[2]):[4,fn.getDescriptionImage(pn,l,w,null===(s=un.current)||void 0===s?void 0:s.signal)];case 2:return e=c.sent(),Z!==zs.OpenAI?[3,4]:[4,ks(0,xe,Q,e,w)];case 3:return t=c.sent(),n=t.imageUrl,r=t.imageBase64,n&&o.setImageUrl(n),r&&o.setImage(r),[3,5];case 4:he("Image generation is not supported with the selected provider."),c.label=5;case 5:return[3,8];case 6:return(a=c.sent())instanceof Error&&ye(a)?(console.error("Quota error detected in image generation:",a.message),he(a.message),[2]):(console.error("Error generating image:",a),he(a instanceof Error?a.message:"Failed to generate image"),[3,8]);case 7:return R(!1),[7];case 8:return xn&&W(!0),[2]}}))}))},En=function(){return El(void 0,void 0,void 0,(function(){var e,t,n,r,a;return kl(this,(function(i){switch(i.label){case 0:B(!0),i.label=1;case 1:return i.trys.push([1,3,4,5]),(null===(r=un.current)||void 0===r?void 0:r.signal.aborted)?(console.log("New examples generation cancelled"),[2]):[4,nl(fn,pn,l,v,!0,b,(hr?rr:er)||void 0,null===(a=un.current)||void 0===a?void 0:a.signal)];case 2:return(e=i.sent())&&e.length>0&&(t=e.map((function(e){return[e.original,e.translated]})),o.setExamples(t)),[3,5];case 3:return(n=i.sent())instanceof Error&&ye(n)?(console.error("Quota error detected in examples generation:",n.message),he(n.message),[2]):(console.error("Error getting examples:",n),he(n instanceof Error?n.message:"Failed to generate examples"),[3,5]);case 4:return B(!1),[7];case 5:return xn&&W(!0),[2]}}))}))},kn=function(){return El(void 0,void 0,void 0,(function(){var e,t,n,r,a,i,s,c,u;return kl(this,(function(d){switch(d.label){case 0:if(!be.trim()||Ce)return[2];Be(!0),d.label=1;case 1:return d.trys.push([1,15,16,17]),be.toLowerCase().includes("image")||be.toLowerCase().includes("picture")||be.toLowerCase().includes("изображени")||be.toLowerCase().includes("картин")?[4,Xe(Q,l,be)]:[3,4];case 2:return i=d.sent(),[4,ks(0,xe,Q,i,be)];case 3:return e=d.sent(),t=e.imageUrl,n=e.imageBase64,t&&o.setImageUrl(t),n&&o.setImage(n),[3,14];case 4:return be.toLowerCase().includes("example")||be.toLowerCase().includes("sentence")||be.toLowerCase().includes("пример")||be.toLowerCase().includes("предложение")?[4,fn.getExamples(pn,l,v,!0,be)]:[3,6];case 5:return a=d.sent(),o.setExamples(a),[3,14];case 6:return be.toLowerCase().includes("translat")||be.toLowerCase().includes("перевод")?[4,fn.translateText(pn,l,v,be)]:[3,8];case 7:return(r=d.sent())&&o.setTranslation(r),[3,14];case 8:return[4,fn.translateText(pn,l,v,be)];case 9:return r=d.sent(),[4,fn.getExamples(pn,l,v,!0,be)];case 10:return a=d.sent(),ee?[4,fn.getDescriptionImage(pn,l,be)]:[3,13];case 11:return i=d.sent(),[4,null===(u=fn.getImageUrl)||void 0===u?void 0:u.call(fn,pn,i)];case 12:(s=d.sent())&&o.setImageUrl(s),d.label=13;case 13:r&&o.setTranslation(r),o.setExamples(a),d.label=14;case 14:return we(""),[3,17];case 15:return(c=d.sent())instanceof Error&&ye(c)?(console.error("Quota error detected in custom instructions:",c.message),he(c.message),[2]):(console.error("Error applying custom instructions:",c),he(c instanceof Error?c.message:"Failed to apply custom instructions"),[3,17]);case 16:return Be(!1),[7];case 17:return[2]}}))}))},In=function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),kn())},An=function(){return Z!==zs.Groq},_n=function(){return El(void 0,void 0,void 0,(function(){var e,t,n,r,o,a,s,u;return kl(this,(function(p){console.log("*** HANDLE SAVE ALL CARDS: Starting ***"),console.log("Current Redux state at save all cards time:",{text:l,translation:c,image:d,imageUrl:f,hasImage:!!d,hasImageUrl:!!f,imageType:typeof d,imageUrlType:typeof f,shouldGenerateImage:ee,mode:S,createdCardsCount:lt.length}),he(null);try{for(M(!0),Mn(),e=0,t=0,n=0,r=0,o=Il([],hn,!0),console.log("Starting to save cards. Total cards:",lt.length,"Already saved:",hn.length),a=function(a){var s=lt[a];if(hn.includes(s.id))return console.log("Card #".concat(a," (").concat(s.id,") already explicitly saved, skipping")),e++,"continue";try{console.log("Saving card #".concat(a," (").concat(s.id,") from multi-card set")),-1===dn.findIndex((function(e){return e.id===s.id||e.text===s.text&&e.mode===s.mode}))?(i(Ee(s)),n++,o.push(s.id),console.log("Card #".concat(a," (").concat(s.id,") saved as new")),e++):(console.log("Card #".concat(a," (").concat(s.id,") already in storage, updating")),i(Pe(s)),r++,o.push(s.id),e++)}catch(e){console.error("Error saving card #".concat(a," (").concat(s.id,"):"),e),t++}},s=0;s<lt.length;s++)a(s);console.log("Save all complete. Saved:",n,"Updated:",r,"Errors:",t),mn(o),Y(!0),localStorage.setItem("explicitly_saved","true"),(u=lt[gt])&&u.id&&(i(Re(u.id)),localStorage.setItem("current_card_id",u.id)),0===t?n>0&&r>0?"Saved ".concat(n," new cards and updated ").concat(r," existing cards."):n>0?"Saved ".concat(n," cards successfully!"):r>0?"Updated ".concat(r," cards successfully!"):"All ".concat(e," cards are now saved!"):he("Saved ".concat(e," cards, ").concat(t," failed."),"warning"),W(!1),G(!1),i(ke())}catch(e){console.error("Error in save all cards operation:",e),he("Error saving cards. Please try again.")}finally{M(!1)}return[2]}))}))},Fn=function(){return El(void 0,void 0,void 0,(function(){var e,t,n,r,a,s,g;return kl(this,(function(m){console.log("*** HANDLE ACCEPT: Starting to save card ***"),console.log("Current Redux state at save time:",{text:l,translation:c,image:d,imageUrl:f,hasImage:!!d,hasImageUrl:!!f,imageType:typeof d,imageUrlType:typeof f,imageLength:null==d?void 0:d.length,imageUrlLength:null==f?void 0:f.length,shouldGenerateImage:ee,mode:S}),he(null);try{if(M(!0),yt&&lt.length>0)return Mn(),(e=lt[gt])?(console.log("Saving current card from multi-card set:",e.id),-1===dn.findIndex((function(t){return t.id===e.id||t.text===e.text&&t.mode===e.mode}))?(o.saveCardToStorage(e),console.log("Saved new card: ".concat(e.id))):(o.updateStoredCard(e),console.log("Updated existing card: ".concat(e.id))),mn((function(t){if(t.includes(e.id))return t;var n=Il(Il([],t,!0),[e.id],!1);return console.log("Updated explicitly saved IDs:",n),n})),i(ke()),o.setCurrentCardId(e.id),localStorage.setItem("current_card_id",e.id),Y(!0),localStorage.setItem("explicitly_saved","true"),W(!1),[2]):(he("Card data not found"),[2]);if(t=h||Date.now().toString(),console.log("Saving card with data:",{originalSelectedText:E,text:l,translation:c,examples:u.length,mode:S,currentCardId:h,linguisticInfo:y?"present":"absent"}),S===_.LanguageLearning){if(!l&&!E)return console.error("Missing text data for card"),he("Please enter or select some text for your card before saving."),[2];n={id:t,mode:S,text:E||l,translation:c,examples:u,linguisticInfo:y,transcription:x||"",image:d,imageUrl:f,createdAt:new Date,exportStatus:"not_exported"},console.log("*** CREATECARD: Preparing to save card to storage ***"),console.log("Card data being sent to Redux:",{id:n.id,text:n.text,mode:n.mode,hasImage:!!n.image,hasImageUrl:!!n.imageUrl,imageType:typeof n.image,imageUrlType:typeof n.imageUrl,imageLength:null===(r=n.image)||void 0===r?void 0:r.length,imageUrlLength:null===(a=n.imageUrl)||void 0===a?void 0:a.length,imageActualValue:n.image,imageUrlActualValue:n.imageUrl,imagePreview:null===(s=n.image)||void 0===s?void 0:s.substring(0,50),imageUrlPreview:null===(g=n.imageUrl)||void 0===g?void 0:g.substring(0,50)}),h?(console.log("Updating existing card by user action:",t),o.updateStoredCard(n)):(console.log("Saving new card by user action:",t),o.saveCardToStorage(n),o.setCurrentCardId(t))}else if(S===_.GeneralTopic){if(!p)return console.error("Missing front data for general topic card"),he("Please generate card content before saving."),[2];n={id:t,mode:S,front:p,back:c||p,text:E||l||"",linguisticInfo:y,transcription:x||"",image:d,imageUrl:f,createdAt:new Date,exportStatus:"not_exported"},console.log("Saving general topic card to storage:",n),h?(console.log("Updating existing general topic card by user action:",t),o.updateStoredCard(n)):(console.log("Saving new general topic card by user action:",t),o.saveCardToStorage(n),o.setCurrentCardId(t))}Y(!0),localStorage.setItem("explicitly_saved","true"),W(!1),G(!1)}catch(e){console.error("Error saving card:",e),he("Error saving card. Please try again.")}finally{M(!1)}return[2]}))}))},Tn=function(){o.setCurrentPage("storedCards")},jn=(0,r.useCallback)((function(e){console.log("Text selection handled for tab-specific state:",e),Ze(!1),it({}),Ve([]),o.setText(e),console.log("Text set via tabAware.setText:",e)}),[o]);(0,r.useEffect)((function(){var e=function(e){var t,n=document.getElementById("sidebar");if(!n||!n.contains(e.target)){if(e.target&&e.composedPath)for(var r=0,o=e.composedPath();r<o.length;r++){var a=o[r];if(a instanceof Element&&"sidebar"===a.id)return;if(a instanceof ShadowRoot&&a.host&&"sidebar"===a.host.id)return}var i=null===(t=window.getSelection())||void 0===t?void 0:t.toString().trim();i&&i.length>0&&jn(i)}};return document.addEventListener("mouseup",e),function(){document.removeEventListener("mouseup",e)}}),[jn]),(0,r.useEffect)((function(){var e=localStorage.getItem("selected_mode");i(xt(e||_.LanguageLearning)),l&&c&&u.length>0?n(!0):n(!1),i(ke())}),[i]),(0,r.useEffect)((function(){El(void 0,void 0,void 0,(function(){return kl(this,(function(e){return console.log("Running saved cards check on mount"),i(ke()),setTimeout((function(){var e=Ns();console.log("Loaded cards from storage:",e.length);var t=localStorage.getItem("current_card_id"),r=localStorage.getItem("explicitly_saved");if(console.log("localStorage values on mount:",{savedCardId:t,explicitlySavedFlag:r,cardCount:e.length}),t){console.log("Found current card ID in localStorage:",t);var a=e.find((function(e){return e.id===t}));a?(console.log("Restoring card from storage:",a),W(!1),G(!1),"true"===r?(console.log("Setting explicitlySaved to TRUE based on localStorage flag"),Y(!0)):(console.log("Setting explicitlySaved to FALSE based on localStorage flag"),Y(!1)),o.setCurrentCardId(t),o.setText(a.text),a.translation&&o.setTranslation(a.translation),a.examples&&o.setExamples(a.examples),a.image&&o.setImage(a.image),a.imageUrl&&o.setImageUrl(a.imageUrl),a.front&&o.setFront(a.front),a.back&&o.setBack(a.back),a.linguisticInfo&&o.setLinguisticInfo(a.linguisticInfo),a.transcription&&o.setTranscription(a.transcription),I(a.text),n(!0)):(console.log("Card ID from localStorage not found in storage, resetting"),localStorage.removeItem("current_card_id"),localStorage.removeItem("explicitly_saved"),o.setCurrentCardId(null),G(!0),Y(!1))}else console.log("No current card ID in localStorage"),G(!0),Y(!1)}),200),[2]}))}))}),[]),(0,r.useEffect)((function(){l&&!q&&""!==l.trim()&&(!t||h?(h||(console.log("Actively typing new card text - ensuring not marked as saved"),Y(!1),localStorage.removeItem("explicitly_saved")),vn(l)):console.log("New card being created, skipping automatic saved detection"))}),[l,h,q,t,vn]);var On=function(){i({type:ft,payload:ce}),oe(!1)},Pn=function(){i({type:pt,payload:fe}),se(!1)},Rn=function(){console.log("Canceling current card, clearing all state"),un.current&&(console.log("Aborting ongoing AI requests"),un.current.abort(),un.current=null),n(!1),W(!1),i(Re(null)),G(!0),Y(!1),localStorage.removeItem("explicitly_saved"),localStorage.removeItem("current_card_id"),o.setIsGeneratingCard(!1),j(!1),ut([]),vt(!1),ht(0),i(Ie("")),i(_e("")),i(Ae([])),i(Fe(null)),i(Te(null)),i(Oe("")),i(je(null)),i(Ne("")),i(Le("")),I("")},Nn=function(){switch(Z){case zs.OpenAI:return(0,a.jsx)("span",Cl({style:{display:"inline-flex",alignItems:"center",marginLeft:"8px",padding:"2px 6px",borderRadius:"4px",backgroundColor:"#10a37f",color:"white",fontSize:"10px",fontWeight:"600"}},{children:"OpenAI"}));case zs.Groq:return(0,a.jsx)("span",Cl({style:{display:"inline-flex",alignItems:"center",marginLeft:"8px",padding:"2px 6px",borderRadius:"4px",backgroundColor:"#7c3aed",color:"white",fontSize:"10px",fontWeight:"600"}},{children:"Groq"}));default:return null}},Ln=function(){if(console.log("Modal close handler. Card saved status:",xn,"isEdited:",$),yt)return console.log("Closing modal for multiple cards without automatic saving"),void Me(!1);!t||xn||$||!c||yt?xn||(console.log("Card not saved, clearing all data"),i(Ie("")),i(_e("")),i(Ae([])),i(Fe(null)),i(Te(null)),i(Oe("")),i(je(null)),i(Ne("")),i(Le("")),n(!1)):window.confirm("Would you like to save this card to your collection?")?Fn():(console.log("User chose not to save, clearing all card data"),i(Ie("")),i(_e("")),i(Ae([])),i(Fe(null)),i(Te(null)),i(Oe("")),i(je(null)),i(Ne("")),i(Le("")),n(!1));Me(!1)},Bn=function(){return El(void 0,void 0,void 0,(function(){var e,t,r,a,s,l,c,u,d,f,p,g,h,m,y,x,C,E,k,A,_,F,T,O,P,R,N,L,B,z,D,M,U,$,W,V,q,G,H,K;return kl(this,(function(J){switch(J.label){case 0:if(0===(e=Object.keys(at).filter((function(e){return at[e]}))).length)return he("Please select at least one text option","warning"),[2];un.current=new AbortController,t=un.current.signal,console.log("*** MULTIPLE CARDS CREATION STARTED ***"),console.log("Image generation settings:",{imageGenerationMode:te,modelProvider:Z,isImageGenerationAvailable:An(),selectedOptionsCount:e.length}),Ze(!1),j(!0),o.setIsGeneratingCard(!0),J.label=1;case 1:J.trys.push([1,32,33,34]),r=[],a=0,s=e,J.label=2;case 2:if(!(a<s.length))return[3,31];if(l=s[a],t.aborted)return console.log("Multiple cards creation cancelled by user"),[2];i(Ie("")),i(_e("")),i(Ae([])),i(Ne("")),i(Ie(l)),I(l),Y(!1),localStorage.removeItem("explicitly_saved"),J.label=3;case 3:return J.trys.push([3,29,,30]),[4,tl(fn,pn,l,v,b,0,t)];case 4:return c=J.sent(),t.aborted?(console.log("Multiple cards creation cancelled by user after translation"),[2]):(c.translated&&i(_e(c.translated)),[4,nl(fn,pn,l,v,!0,b,(hr?rr:er)||void 0,t)]);case 5:return u=J.sent(),t.aborted?(console.log("Multiple cards creation cancelled by user after examples"),[2]):(u&&u.length>0&&(d=u.map((function(e){return[e.original,e.translated]})),i(Ae(d))),[4,rl(fn,pn,l,t)]);case 6:return f=J.sent(),t.aborted?(console.log("Multiple cards creation cancelled by user after flashcard"),[2]):(f.front&&i(Oe(f.front)),p=hr?rr:er,g="",h="true"===localStorage.getItem("useMultipleValidators"),p?(m=void 0,h?(console.log('Using enhanced validation for "'.concat(l,'"')),[4,pl(fn,pn,l,p,v,3,!0)]):[3,8]):[3,11]);case 7:return m=J.sent(),[3,10];case 8:return[4,fl(fn,pn,l,p,v,3)];case 9:m=J.sent(),J.label=10;case 10:m.linguisticInfo?(g=m.linguisticInfo,i(Ne(m.linguisticInfo)),h&&"confidence"in m&&"number"==typeof m.confidence?(y=Math.round(100*m.confidence),console.log('Enhanced linguistic info for "'.concat(l,'" created with ').concat(y,"% confidence"))):m.wasValidated&&m.attempts>1?console.log('Corrected linguistic info for "'.concat(l,'" after ').concat(m.attempts," attempts")):m.wasValidated||console.warn('Linguistic info for "'.concat(l,'" may contain inaccuracies'))):console.warn('Failed to generate linguistic info for "'.concat(l,'"')),J.label=11;case 11:x="",J.label=12;case 12:return J.trys.push([12,18,,19]),(C=hr?rr:er)?(console.log('Creating transcription for "'.concat(l,'" using source language: ').concat(C,", user language: ").concat(v)),[4,ol(fn,pn,l,C,v)]):[3,16];case 13:return(E=J.sent())?[4,Ir(v)]:[3,15];case 14:k=J.sent(),(A=[E.userLanguageTranscription&&'<div class="transcription-item user-lang">\n                                            <span class="transcription-label">'.concat(k,':</span>\n                                            <span class="transcription-text">').concat(E.userLanguageTranscription,"</span>\n                                        </div>"),E.ipaTranscription&&'<div class="transcription-item ipa">\n                                            <span class="transcription-label">IPA:</span>\n                                            <span class="transcription-text">'.concat(E.ipaTranscription,"</span>\n                                        </div>")].filter(Boolean).join("\n"))&&(x=A,i(Le(A)),console.log('Transcription created successfully for "'.concat(l,'"'))),J.label=15;case 15:return[3,17];case 16:console.warn('No source language available for transcription of "'.concat(l,'"')),J.label=17;case 17:return[3,19];case 18:return _=J.sent(),console.error('Transcription generation failed for "'.concat(l,'":'),_),[3,19];case 19:if(F=null,T=null,"off"===te||!An())return[3,28];J.label=20;case 20:return J.trys.push([20,27,,28]),O="always"===te,P="","smart"!==te?[3,22]:[4,Ar(l)];case 21:R=J.sent(),O=R.shouldGenerate,P=R.reason,console.log('Smart image analysis for "'.concat(l,'": ').concat(O?"YES":"NO"," - ").concat(P)),J.label=22;case 22:return O?(console.log('Generating image for "'.concat(l,'"')),[4,fn.getDescriptionImage(pn,l,w)]):[3,25];case 23:return N=J.sent(),[4,ks(0,xe,Q,N,w)];case 24:return L=J.sent(),B=L.imageUrl,z=L.imageBase64,B&&(F=B,console.log('Image URL generated for "'.concat(l,'": ').concat(B.substring(0,50),"..."))),z&&(T=z,console.log('Image base64 generated for "'.concat(l,'": ').concat(z.substring(0,50),"..."))),[3,26];case 25:"smart"===te&&console.log('No image needed for "'.concat(l,'": ').concat(P)),J.label=26;case 26:return[3,28];case 27:return D=J.sent(),console.error('Image generation failed for "'.concat(l,'":'),D),[3,28];case 28:return M=Date.now().toString()+"_"+r.length,U={id:M,mode:S,text:l,translation:c.translated||"",examples:u.map((function(e){return[e.original,e.translated]})),linguisticInfo:g,transcription:x,front:f.front||"",back:c.translated||"",image:T,imageUrl:F,createdAt:new Date,exportStatus:"not_exported"},console.log("Created card ".concat(U.id," but NOT saving to storage yet. Image info:"),{hasImage:!!U.image,hasImageUrl:!!U.imageUrl,imageLength:null===(q=U.image)||void 0===q?void 0:q.length,imageUrlLength:null===(G=U.imageUrl)||void 0===G?void 0:G.length}),r.push(U),[3,30];case 29:return($=J.sent())instanceof Error&&ye($)?(console.error("Quota error detected, stopping multiple cards creation:",$.message),he($.message),[2]):(console.error('Error creating card for "'.concat(l,'":'),$),he('Failed to create card for "'.concat(l.substring(0,20),'...": ').concat($ instanceof Error?$.message:"Unknown error"),"error"),[3,30]);case 30:return a++,[3,2];case 31:return r.length>0?(ut(r),ht(0),vt(r.length>1),(W=r[0])&&(console.log("Loading first card into Redux state:",{cardId:W.id,hasImage:!!W.image,hasImageUrl:!!W.imageUrl,imageLength:null===(H=W.image)||void 0===H?void 0:H.length,imageUrlLength:null===(K=W.imageUrl)||void 0===K?void 0:K.length}),"string"==typeof W.text&&i(Ie(W.text)),i(_e(void 0===W.translation?null:W.translation)),i(Ae(Array.isArray(W.examples)?W.examples:[])),i(Fe(void 0===W.image?null:W.image)),i(Te(void 0===W.imageUrl?null:W.imageUrl)),"string"==typeof W.front&&i(Oe(W.front)),i(je(void 0===W.back?null:W.back)),i(Ne(W.linguisticInfo||"")),W.transcription?i(Le(W.transcription)):i(Le("")),console.log("First card loaded into Redux state successfully")),Y(!1),mn([]),localStorage.removeItem("explicitly_saved"),console.log("Reset saved status for new multiple cards"),mn([]),localStorage.removeItem("explicitly_saved"),Y(!1),n(!0),Me(!0),console.log("Created new cards, none saved yet. Card IDs:",r.map((function(e){return e.id})))):he("Failed to create cards. Please try again.","error"),[3,34];case 32:return V=J.sent(),t.aborted?(console.log("Multiple cards creation was cancelled by user"),[2]):V instanceof Error&&ye(V)?(console.error("Quota error detected in multiple cards creation:",V.message),he(V.message),[2]):(console.error("Error processing selected options:",V),he(V instanceof Error?V.message:"Failed to create cards. Please try again."),[3,34]);case 33:return j(!1),o.setIsGeneratingCard(!1),it({}),un.current=null,[7];case 34:return[2]}}))}))},zn=function(e){!function(e){it((function(t){var n;return Cl(Cl({},t),((n={})[e]=!t[e],n))}))}(e)},Dn=function(){if(!(lt.length<=1||gt>=lt.length-1)){Mn();var e=gt+1;console.log("Moving from card ".concat(gt," to card ").concat(e));var t=lt[e];t&&(console.log("Loading next card data: ".concat(t.id,", text: ").concat(t.text,", linguistic info: ").concat(t.linguisticInfo?"yes":"no")),Un(t),ht(e))}},Mn=function(){if(lt[gt]){console.log("Saving current card state:",{index:gt,text:l,linguisticInfo:y?y.substring(0,30)+"...":"empty"});var e=Cl(Cl({},lt[gt]),{text:l,translation:c,examples:u,image:d,imageUrl:f,front:p,back:g||null,linguisticInfo:y||"",transcription:x||""}),t=Il([],lt,!0);t[gt]=e,ut(t),console.log("Updated card saved:",e.id)}},Un=function(e){var t,n;console.log("Loading card data for card:",{id:e.id,text:e.text,hasLinguisticInfo:Boolean(e.linguisticInfo),hasImage:!!e.image,hasImageUrl:!!e.imageUrl,imageLength:null===(t=e.image)||void 0===t?void 0:t.length,imageUrlLength:null===(n=e.imageUrl)||void 0===n?void 0:n.length}),i(Ie("")),i(_e(null)),i(Ae([])),i(Fe(null)),i(Te(null)),i(Oe("")),i(je(null)),i(Ne("")),i(Le("")),"string"==typeof e.text&&i(Ie(e.text)),i(_e(void 0===e.translation?null:e.translation)),i(Ae(Array.isArray(e.examples)?e.examples:[])),i(Fe(void 0===e.image?null:e.image)),i(Te(void 0===e.imageUrl?null:e.imageUrl)),"string"==typeof e.front&&i(Oe(e.front)),i(je(void 0===e.back?null:e.back)),e.linguisticInfo?(console.log("Setting linguistic info:",e.linguisticInfo.substring(0,30)+"..."),i(Ne(e.linguisticInfo))):(console.log("No linguistic info found for this card"),i(Ne(""))),e.transcription?(console.log("Setting transcription:",e.transcription.substring(0,30)+"..."),i(Le(e.transcription))):(console.log("No transcription found for this card"),i(Le(""))),console.log("Card data loaded successfully, image status:",{hasImage:!!e.image,hasImageUrl:!!e.imageUrl})},$n=function(){if(!(lt.length<=1||gt<=0)){Mn();var e=gt-1;console.log("Moving from card ".concat(gt," to card ").concat(e));var t=lt[e];t&&(console.log("Loading previous card data: ".concat(t.id,", text: ").concat(t.text,", linguistic info: ").concat(t.linguisticInfo?"yes":"no")),Un(t),ht(e))}},Wn=[{code:"ru",name:"Русский",flag:"🇷🇺",englishName:"Russian"},{code:"en",name:"English",flag:"🇬🇧",englishName:"English"},{code:"es",name:"Español",flag:"🇪🇸",englishName:"Spanish"},{code:"fr",name:"Français",flag:"🇫🇷",englishName:"French"},{code:"de",name:"Deutsch",flag:"🇩🇪",englishName:"German"},{code:"it",name:"Italiano",flag:"🇮🇹",englishName:"Italian"},{code:"pt",name:"Português",flag:"🇵🇹",englishName:"Portuguese"},{code:"ja",name:"日本語",flag:"🇯🇵",englishName:"Japanese"},{code:"ko",name:"한국어",flag:"🇰🇷",englishName:"Korean"},{code:"zh",name:"中文",flag:"🇨🇳",englishName:"Chinese"},{code:"ar",name:"العربية",flag:"🇦🇪",englishName:"Arabic"},{code:"hi",name:"हिंदी",flag:"🇮🇳",englishName:"Hindi"},{code:"bn",name:"বাংলা",flag:"🇧🇩",englishName:"Bengali"},{code:"tr",name:"Türkçe",flag:"🇹🇷",englishName:"Turkish"},{code:"pl",name:"Polski",flag:"🇵🇱",englishName:"Polish"},{code:"nl",name:"Nederlands",flag:"🇳🇱",englishName:"Dutch"},{code:"cs",name:"Čeština",flag:"🇨🇿",englishName:"Czech"},{code:"sv",name:"Svenska",flag:"🇸🇪",englishName:"Swedish"},{code:"vi",name:"Tiếng Việt",flag:"🇻🇳",englishName:"Vietnamese"},{code:"th",name:"ภาษาไทย",flag:"🇹🇭",englishName:"Thai"},{code:"he",name:"עִבְרִית",flag:"🇮🇱",englishName:"Hebrew"},{code:"id",name:"Bahasa Indonesia",flag:"🇮🇩",englishName:"Indonesian"},{code:"uk",name:"Українська",flag:"🇺🇦",englishName:"Ukrainian"},{code:"el",name:"Ελληνικά",flag:"🇬🇷",englishName:"Greek"},{code:"ro",name:"Română",flag:"🇷🇴",englishName:"Romanian"},{code:"hu",name:"Magyar",flag:"🇭🇺",englishName:"Hungarian"},{code:"fi",name:"Suomi",flag:"🇫🇮",englishName:"Finnish"},{code:"da",name:"Dansk",flag:"🇩🇰",englishName:"Danish"},{code:"no",name:"Norsk",flag:"🇳🇴",englishName:"Norwegian"},{code:"sk",name:"Slovenčina",flag:"🇸🇰",englishName:"Slovak"},{code:"lt",name:"Lietuvių",flag:"🇱🇹",englishName:"Lithuanian"},{code:"lv",name:"Latviešu",flag:"🇱🇻",englishName:"Latvian"},{code:"bg",name:"Български",flag:"🇧🇬",englishName:"Bulgarian"},{code:"hr",name:"Hrvatski",flag:"🇭🇷",englishName:"Croatian"},{code:"sr",name:"Српски",flag:"🇷🇸",englishName:"Serbian"},{code:"et",name:"Eesti",flag:"🇪🇪",englishName:"Estonian"},{code:"sl",name:"Slovenščina",flag:"🇸🇮",englishName:"Slovenian"}],Vn=(0,r.useState)(!1),qn=Vn[0],Gn=Vn[1],Hn=(0,r.useState)(""),Kn=Hn[0],Yn=Hn[1],Qn=(0,r.useMemo)((function(){if(!Kn)return Wn;var e=Kn.toLowerCase();return Wn.filter((function(t){return t.name.toLowerCase().includes(e)||t.englishName.toLowerCase().includes(e)||t.code.toLowerCase().includes(e)}))}),[Kn]),Jn=(0,r.useMemo)((function(){return Wn.find((function(e){return e.code===v}))||Wn[0]}),[v]),Xn=function(){return qn?(0,a.jsx)("div",Cl({style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(2px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"16px"},onClick:function(){return Gn(!1)}},{children:(0,a.jsxs)("div",Cl({style:{backgroundColor:"#FFFFFF",borderRadius:"12px",width:"90%",maxWidth:"360px",maxHeight:"80vh",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",overflow:"hidden",display:"flex",flexDirection:"column"},onClick:function(e){return e.stopPropagation()}},{children:[(0,a.jsxs)("div",Cl({style:{padding:"16px",borderBottom:"1px solid #E5E7EB",display:"flex",flexDirection:"column",gap:"12px"}},{children:[(0,a.jsxs)("div",Cl({style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},{children:[(0,a.jsx)("h3",Cl({style:{margin:0,fontSize:"16px",fontWeight:600,color:"#111827"}},{children:"Select Your Language"})),(0,a.jsx)("button",Cl({onClick:function(){return Gn(!1)},style:{background:"none",border:"none",cursor:"pointer",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"6px"}},{children:(0,a.jsx)("svg",Cl({xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"#6B7280",viewBox:"0 0 16 16"},{children:(0,a.jsx)("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})}))}))]})),(0,a.jsxs)("div",Cl({style:{position:"relative",width:"100%"}},{children:[(0,a.jsx)("input",{type:"text",value:Kn,onChange:function(e){return Yn(e.target.value)},placeholder:"Search languages...",style:{width:"100%",padding:"10px 12px 10px 36px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#F9FAFB",fontSize:"14px",color:"#374151",outline:"none"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}}),(0,a.jsx)("svg",Cl({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"#9CA3AF",viewBox:"0 0 16 16",style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)"}},{children:(0,a.jsx)("path",{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"})})),Kn&&(0,a.jsx)("button",Cl({onClick:function(){return Yn("")},style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",backgroundColor:"#E5E7EB"}},{children:(0,a.jsx)("svg",Cl({xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"#6B7280",viewBox:"0 0 16 16"},{children:(0,a.jsx)("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})}))}))]})),(0,a.jsx)("p",Cl({style:{margin:0,fontSize:"12px",color:"#6B7280",lineHeight:1.5}},{children:"This will be used for both the interface language and translations. Your cards will be created in this language."}))]})),(0,a.jsx)("div",Cl({style:{overflowY:"auto",maxHeight:"calc(80vh - 135px)",padding:"8px 0"}},{children:0===Qn.length?(0,a.jsxs)("div",Cl({style:{padding:"16px",textAlign:"center",color:"#6B7280",fontSize:"14px"}},{children:['No languages found matching "',Kn,'"']})):Qn.map((function(e){return(0,a.jsxs)("button",Cl({onClick:function(){i(function(e){return{type:rt,payload:e}}(e.code)),Gn(!1)},style:{display:"flex",alignItems:"center",width:"100%",padding:"12px 16px",backgroundColor:e.code===v?"#EFF6FF":"transparent",border:"none",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s"},onMouseOver:function(t){e.code!==v&&(t.currentTarget.style.backgroundColor="#F3F4F6")},onMouseOut:function(t){e.code!==v&&(t.currentTarget.style.backgroundColor="transparent")}},{children:[(0,a.jsx)("span",Cl({style:{fontSize:"22px",marginRight:"12px",width:"28px",textAlign:"center"}},{children:e.flag})),(0,a.jsxs)("div",Cl({style:{display:"flex",flexDirection:"column",alignItems:"flex-start"}},{children:[(0,a.jsx)("span",Cl({style:{color:e.code===v?"#2563EB":"#111827",fontWeight:e.code===v?"600":"normal",fontSize:"14px"}},{children:e.name})),e.englishName!==e.name&&(0,a.jsx)("span",Cl({style:{color:"#6B7280",fontSize:"12px"}},{children:e.englishName}))]})),e.code===v&&(0,a.jsx)("svg",Cl({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"#2563EB",viewBox:"0 0 16 16",style:{marginLeft:"auto"}},{children:(0,a.jsx)("path",{d:"M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"})}))]}),e.code)}))}))]}))})):(0,a.jsxs)("div",Cl({style:{position:"relative",width:"100%",display:"flex",flexDirection:"column",gap:"8px"}},{children:[(0,a.jsxs)("label",Cl({style:{color:"#111827",fontWeight:"600",fontSize:"14px",margin:0,display:"flex",alignItems:"center",gap:"6px"}},{children:["Your Language",(0,a.jsx)("span",Cl({style:{fontSize:"12px",color:"#6B7280",fontWeight:"normal",fontStyle:"italic"}},{children:"(translations)"}))]})),(0,a.jsxs)("button",Cl({onClick:function(){return Gn(!0)},style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#F9FAFB",color:"#374151",fontSize:"14px",cursor:"pointer",transition:"all 0.2s ease",textAlign:"left"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="#F3F4F6"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="#F9FAFB"}},{children:[(0,a.jsxs)("span",Cl({style:{display:"flex",alignItems:"center",gap:"8px"}},{children:[(0,a.jsx)("span",Cl({style:{fontSize:"18px"}},{children:Jn.flag})),(0,a.jsx)("span",{children:Jn.name})]})),(0,a.jsx)("svg",Cl({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},{children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"})}))]}))]}))},Zn=(0,r.useState)((function(){return localStorage.getItem("source_language")||""})),er=Zn[0],tr=Zn[1],nr=(0,r.useState)((function(){return localStorage.getItem("detected_language")||null})),rr=nr[0],or=nr[1],ar=(0,r.useState)(!1),ir=ar[0],sr=ar[1],lr=(0,r.useState)(!1),cr=lr[0],ur=lr[1],dr=(0,r.useState)(""),fr=dr[0],pr=dr[1],gr=(0,r.useState)((function(){return"false"!==localStorage.getItem("auto_detect_language")})),hr=gr[0],mr=gr[1],yr=(0,r.useMemo)((function(){if(!fr)return Wn;var e=fr.toLowerCase();return Wn.filter((function(t){return t.name.toLowerCase().includes(e)||t.englishName.toLowerCase().includes(e)||t.code.toLowerCase().includes(e)}))}),[fr]),xr=(0,r.useMemo)((function(){return er?Wn.find((function(e){return e.code===er}))||null:rr&&Wn.find((function(e){return e.code===rr}))||null}),[er,rr]),vr=(0,r.useState)(!1),br=(vr[0],vr[1]),wr=(0,r.useCallback)((function(e){return El(void 0,void 0,void 0,(function(){var t,n,r,o,a,i,l,c,u,d,f,p,g,h,m,y,x,v,b,w,S,C,E,k,I,A,_,F,T,j,O,P,R,N;return kl(this,(function(L){switch(L.label){case 0:if(console.log("=== LANGUAGE DETECTION START ==="),console.log("Input text:",e.substring(0,100)+(e.length>100?"...":"")),console.log("Text length:",e.length),console.log("Model provider:",Z),console.log("API key available:",Z===zs.OpenAI?!!Q:!!J),!e||e.trim().length<2)return console.log("Text too short for language detection"),[2];if(t=e.trim().toLowerCase().slice(0,200),n="language_detection_".concat(t),(r=localStorage.getItem(n))&&rr!==r)return console.log("Using cached language detection result:",r),or(r),s(r),[2];if(rr&&r===rr)return console.log("Language already detected for this text:",rr),[2];if(qe())return console.log("Language detection skipped due to cached quota error"),Ke()&&(l=Ye())&&(he(l),He()),[2];sr(!0),L.label=1;case 1:if(L.trys.push([1,14,15,16]),!(Z===zs.OpenAI&&Q||Z===zs.Groq&&J))return[3,12];if(Z!==zs.OpenAI)return[3,6];if(qe()){if(console.log("OpenAI language detection skipped due to cached quota error"),Ke()&&(l=Ye()))throw new Error(l);return[2]}L.label=2;case 2:return L.trys.push([2,4,,5]),[4,xe.chat.completions.create({model:"gpt-3.5-turbo",messages:[{role:"system",content:"You are a language detection assistant. Respond only with the ISO 639-1 language code."},{role:"user",content:"Detect the language of this text and respond only with the ISO 639-1 language code (e.g. 'en', 'ru', 'fr', etc.): \"".concat(e,'"')}],temperature:.3,max_tokens:10})];case 3:return a=L.sent(),o=null===(A=a.choices[0].message.content)||void 0===A?void 0:A.trim().toLowerCase(),console.log("Language detected via OpenAI:",o),[3,5];case 4:throw(i=L.sent())instanceof Error&&((g=i.message).includes("quota")||g.includes("insufficient_quota")||g.includes("billing")||g.includes("exceeded")||g.includes("429"))&&(Ge(g),console.log("Quota error detected and cached in OpenAI language detection")),i;case 5:return[3,11];case 6:if(Z!==zs.Groq)return[3,11];if(qe()){if(console.log("Groq language detection skipped due to cached quota error"),Ke()&&(l=Ye()))throw new Error(l);return[2]}return[4,fetch("https://api.groq.com/openai/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(J)},body:JSON.stringify({model:X,messages:[{role:"system",content:"You are a language detection assistant. Respond only with the ISO 639-1 language code."},{role:"user",content:"Detect the language of this text and respond only with the ISO 639-1 language code (e.g. 'en', 'ru', 'fr', etc.): \"".concat(e,'"')}],temperature:.3,max_tokens:10})})];case 7:return(c=L.sent()).ok?[3,9]:[4,c.json()];case 8:if(u=L.sent(),g="Groq API error: ".concat(c.status," ").concat(c.statusText," - ").concat(JSON.stringify(u)),429===c.status||u&&((null===(F=null===(_=u.error)||void 0===_?void 0:_.includes)||void 0===F?void 0:F.call(_,"quota"))||(null===(j=null===(T=u.error)||void 0===T?void 0:T.includes)||void 0===j?void 0:j.call(T,"limit"))))throw new Error("API rate limit exceeded. Please try again in a few minutes.");throw new Error(g);case 9:return[4,c.json()];case 10:d=L.sent(),o=null===(N=null===(R=null===(P=null===(O=d.choices)||void 0===O?void 0:O[0])||void 0===P?void 0:P.message)||void 0===R?void 0:R.content)||void 0===N?void 0:N.trim().toLowerCase(),console.log("Language detected via Groq:",o),L.label=11;case 11:return o&&Wn.some((function(e){return e.code===o}))?(console.log("Language successfully detected:",o),or(o),localStorage.setItem("detected_language",o),localStorage.setItem(n,o),s(o)):console.log("Invalid or unrecognized language code:",o),[3,13];case 12:f=e.trim().toLowerCase().slice(0,100),y=/[а-яё]/gi,x=/[a-z]/gi,v=/[\u4e00-\u9fff]/gi,b=/[\u3040-\u309f\u30a0-\u30ff]/gi,w=/[\uac00-\ud7af]/gi,S=/[\u0600-\u06ff]/gi,C=/[áéíóúüñ¿¡]/gi,E=["hasta","desde","como","pero","porque","adonde","quien","para","por"].some((function(e){return f===e||f.startsWith(e+" ")||f.includes(" "+e+" ")})),k="",y.test(f)?(console.log("Detected Cyrillic script - setting Russian"),k="ru"):v.test(f)?(console.log("Detected Chinese characters"),k="zh"):b.test(f)?(console.log("Detected Japanese characters"),k="ja"):w.test(f)?(console.log("Detected Korean characters"),k="ko"):S.test(f)?(console.log("Detected Arabic script"),k="ar"):C.test(f)||E?(console.log("Detected Spanish text or common Spanish word"),k="es"):x.test(f)&&(console.log("Detected Latin script, defaulting to English"),k="en"),k&&(console.log("Language detected using fallback method:",k),or(k),localStorage.setItem("detected_language",k),localStorage.setItem(n,k),s(k)),L.label=13;case 13:return[3,16];case 14:return p=L.sent(),console.error("Error detecting language:",p),p instanceof Error&&ye(p)?(console.error("Quota error detected in language detection:",p.message),he(p.message),He(),[2]):(g=p instanceof Error?p.message:String(p),(g.includes("401")||g.includes("Unauthorized")||g.includes("Authentication")||g.includes("Invalid API key")||g.includes("Incorrect API key")||g.includes("API key is missing"))&&(console.warn("API key error detected, disabling auto-detection to prevent infinite retries"),mr(!1),localStorage.setItem("auto_detect_language","false"),h=Z===zs.OpenAI?"OpenAI":Z===zs.Groq?"Groq":"AI","function"==typeof he&&he("Language detection failed: Invalid ".concat(h," API key. Please check your API key in settings."),"error"),m=e.trim().toLowerCase().slice(0,100),y=/[а-яё]/gi,x=/[a-z]/gi,v=/[\u4e00-\u9fff]/gi,b=/[\u3040-\u309f\u30a0-\u30ff]/gi,w=/[\uac00-\ud7af]/gi,S=/[\u0600-\u06ff]/gi,C=/[áéíóúüñ¿¡]/gi,E=["hasta","desde","como","pero","porque","adonde","quien","para","por"].some((function(e){return m===e||m.startsWith(e+" ")||m.includes(" "+e+" ")})),k="",y.test(m)?k="ru":v.test(m)?k="zh":b.test(m)?k="ja":w.test(m)?k="ko":S.test(m)?k="ar":C.test(m)||E?k="es":x.test(m)&&(k="en"),k&&(console.log("Language detected using fallback method in error handler:",k),or(k),localStorage.setItem("detected_language",k),I="language_detection_".concat(e.trim().toLowerCase().slice(0,200)),localStorage.setItem(I,k),s(k))),[3,16]);case 15:return sr(!1),console.log("=== LANGUAGE DETECTION END ==="),[7];case 16:return[2]}}))}))}),[xe,Q,Z,J,X,i,Wn]);(0,r.useEffect)((function(){if(l&&l.trim().length>2&&hr){if(qe()){if(console.log("Language detection skipped in useEffect due to cached quota error"),Ke()){var e=Ye();e&&(he(e),He())}return}var t=setTimeout((function(){console.log("Attempting to detect language for text:",l.substring(0,50)+"..."),wr(l)}),500);return function(){return clearTimeout(t)}}}),[l,wr,hr]);var Sr=function(){var e=!hr;if(mr(e),localStorage.setItem("auto_detect_language",e?"true":"false"),hr)rr&&s(rr);else if(s(""),l){if(qe()){if(console.log("Language detection skipped in toggleAutoDetect due to cached quota error"),Ke()){var t=Ye();t&&(he(t),He())}return}wr(l)}},Cr=function(){return cr?(0,a.jsx)("div",Cl({style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(2px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"16px"},onClick:function(){return ur(!1)}},{children:(0,a.jsxs)("div",Cl({style:{backgroundColor:"#FFFFFF",borderRadius:"12px",width:"90%",maxWidth:"360px",maxHeight:"80vh",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",overflow:"hidden",display:"flex",flexDirection:"column"},onClick:function(e){return e.stopPropagation()}},{children:[(0,a.jsxs)("div",Cl({style:{padding:"16px",borderBottom:"1px solid #E5E7EB",display:"flex",flexDirection:"column",gap:"12px"}},{children:[(0,a.jsxs)("div",Cl({style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},{children:[(0,a.jsxs)("h3",Cl({style:{margin:0,fontSize:"16px",fontWeight:600,color:"#111827",display:"flex",alignItems:"center",gap:"8px"}},{children:[(0,a.jsx)(Wt,{color:"#6366F1",size:18}),(0,a.jsx)("span",{children:"Select Source Language"})]})),(0,a.jsx)("button",Cl({onClick:function(){return ur(!1)},style:{background:"none",border:"none",cursor:"pointer",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"6px"}},{children:(0,a.jsx)("svg",Cl({xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"#6B7280",viewBox:"0 0 16 16"},{children:(0,a.jsx)("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})}))}))]})),(0,a.jsxs)("div",Cl({style:{position:"relative",width:"100%"}},{children:[(0,a.jsx)("input",{type:"text",value:fr,onChange:function(e){return pr(e.target.value)},placeholder:"Search languages...",style:{width:"100%",padding:"10px 12px 10px 36px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#F9FAFB",fontSize:"14px",color:"#374151",outline:"none"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}}),(0,a.jsx)("svg",Cl({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"#9CA3AF",viewBox:"0 0 16 16",style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)"}},{children:(0,a.jsx)("path",{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"})})),fr&&(0,a.jsx)("button",Cl({onClick:function(){return pr("")},style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",backgroundColor:"#E5E7EB"}},{children:(0,a.jsx)("svg",Cl({xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"#6B7280",viewBox:"0 0 16 16"},{children:(0,a.jsx)("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})}))}))]})),(0,a.jsx)("p",Cl({style:{margin:0,fontSize:"12px",color:"#6B7280",lineHeight:1.5}},{children:"Select the language of your text. This helps generate more accurate translations and examples."}))]})),(0,a.jsx)("div",Cl({style:{overflowY:"auto",maxHeight:"calc(80vh - 135px)",padding:"8px 0"}},{children:0===yr.length?(0,a.jsxs)("div",Cl({style:{padding:"16px",textAlign:"center",color:"#6B7280",fontSize:"14px"}},{children:['No languages found matching "',fr,'"']})):yr.map((function(e){return(0,a.jsxs)("button",Cl({onClick:function(){tr(e.code),ur(!1),mr(!1)},style:{display:"flex",alignItems:"center",width:"100%",padding:"12px 16px",backgroundColor:e.code===er?"#EFF6FF":"transparent",border:"none",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s"},onMouseOver:function(t){e.code!==er&&(t.currentTarget.style.backgroundColor="#F3F4F6")},onMouseOut:function(t){e.code!==er&&(t.currentTarget.style.backgroundColor="transparent")}},{children:[(0,a.jsx)("span",Cl({style:{fontSize:"22px",marginRight:"12px",width:"28px",textAlign:"center"}},{children:e.flag})),(0,a.jsxs)("div",Cl({style:{display:"flex",flexDirection:"column",alignItems:"flex-start"}},{children:[(0,a.jsx)("span",Cl({style:{color:e.code===er?"#2563EB":"#111827",fontWeight:e.code===er?"600":"normal",fontSize:"14px"}},{children:e.name})),e.englishName!==e.name&&(0,a.jsx)("span",Cl({style:{color:"#6B7280",fontSize:"12px"}},{children:e.englishName}))]})),e.code===er&&(0,a.jsx)("svg",Cl({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"#2563EB",viewBox:"0 0 16 16",style:{marginLeft:"auto"}},{children:(0,a.jsx)("path",{d:"M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"})}))]}),e.code)}))}))]}))})):(0,a.jsxs)("div",Cl({style:{position:"relative",width:"100%",display:"flex",flexDirection:"column",gap:"8px"}},{children:[(0,a.jsxs)("div",Cl({style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"}},{children:[(0,a.jsxs)("label",Cl({style:{color:"#111827",fontWeight:"600",fontSize:"14px",margin:0,display:"flex",alignItems:"center",gap:"6px"}},{children:[(0,a.jsx)("span",{children:"Source Language"}),(0,a.jsx)("span",Cl({style:{fontSize:"12px",color:"#6B7280",fontWeight:"normal",fontStyle:"italic"}},{children:"(of your text)"}))]})),(0,a.jsxs)("div",Cl({style:{display:"flex",alignItems:"center",gap:"8px"}},{children:[(0,a.jsx)("span",Cl({style:{fontSize:"12px",color:hr?"#10B981":"#9CA3AF",transition:"color 0.2s ease"}},{children:"Auto"})),(0,a.jsx)("button",Cl({onClick:Sr,style:{width:"36px",height:"20px",backgroundColor:hr?"#10B981":"#E5E7EB",border:"none",borderRadius:"10px",position:"relative",cursor:"pointer",transition:"background-color 0.2s ease"}},{children:(0,a.jsx)("span",{style:{position:"absolute",width:"16px",height:"16px",backgroundColor:"white",borderRadius:"50%",top:"2px",left:hr?"18px":"2px",transition:"left 0.2s ease",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.1)"}})}))]}))]})),(0,a.jsxs)("button",Cl({onClick:function(){return ur(!0)},disabled:hr,style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:hr?"#F3F4F6":"#F9FAFB",color:"#374151",fontSize:"14px",cursor:hr?"not-allowed":"pointer",opacity:hr?.7:1,transition:"all 0.2s ease",textAlign:"left"},onMouseOver:function(e){return!hr&&(e.currentTarget.style.backgroundColor="#F3F4F6")},onMouseOut:function(e){return!hr&&(e.currentTarget.style.backgroundColor="#F9FAFB")}},{children:[(0,a.jsx)("span",Cl({style:{display:"flex",alignItems:"center",gap:"8px"}},{children:ir?(0,a.jsx)(nn,{type:"spinner",size:"small",inline:!0,color:"#6B7280"}):xr?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",Cl({style:{fontSize:"18px"}},{children:xr.flag})),(0,a.jsx)("span",{children:xr.name}),hr&&(0,a.jsxs)("span",Cl({style:{fontSize:"12px",color:"#10B981",backgroundColor:"#ECFDF5",padding:"2px 6px",borderRadius:"4px",marginLeft:"4px",display:"flex",alignItems:"center",gap:"3px"}},{children:[(0,a.jsx)(_t,{size:10}),(0,a.jsx)("span",{children:"Detected"})]}))]}):(0,a.jsx)("span",Cl({style:{color:"#9CA3AF"}},{children:hr?"Detecting language...":"Select source language"}))})),!hr&&(0,a.jsx)("svg",Cl({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},{children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"})}))]})),(0,a.jsxs)("div",Cl({style:{display:"flex",alignItems:"center",gap:"8px",padding:"6px 8px",backgroundColor:"#F3F4F6",borderRadius:"6px",marginTop:"4px"}},{children:[(0,a.jsxs)("div",Cl({style:{display:"flex",alignItems:"center",gap:"4px"}},{children:[(0,a.jsx)("span",Cl({style:{fontSize:"14px"}},{children:xr?xr.flag:"🌐"})),(0,a.jsx)(Bt,{size:12,color:"#6B7280"}),(0,a.jsx)("span",Cl({style:{fontSize:"14px"}},{children:Jn.flag}))]})),(0,a.jsxs)("span",Cl({style:{fontSize:"12px",color:"#4B5563"}},{children:["Translating ",xr?"from ".concat(xr.englishName):""," to ",Jn.englishName]})),hr&&(0,a.jsx)("button",Cl({onClick:function(){if(qe()){if(console.log("Language detection reset skipped due to cached quota error"),Ke()){var e=Ye();e&&(he(e),He())}}else l&&(console.log("Manually triggering language detection for:",l.substring(0,50)+"..."),wr(l))},title:"Reset language detection",style:{marginLeft:"auto",background:"none",border:"none",display:"flex",padding:"2px",cursor:"pointer",color:"#6B7280"}},{children:(0,a.jsxs)("svg",Cl({xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",fill:"currentColor",viewBox:"0 0 16 16"},{children:[(0,a.jsx)("path",{d:"M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"}),(0,a.jsx)("path",{d:"M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"})]}))}))]}))]}))},Er=function(e){i(Ne(e)),xn&&W(!0)};(0,r.useEffect)((function(){var e=localStorage.getItem("source_language"),t=localStorage.getItem("detected_language"),n=localStorage.getItem("auto_detect_language");console.log("Initializing language settings from localStorage:",{savedSourceLanguage:e,savedDetectedLanguage:t,savedAutoDetect:n}),e?s(e):t&&"false"!==n&&s(t),"false"===n&&mr(!1)}),[]);var kr=(0,r.useCallback)((function(e){return El(void 0,void 0,void 0,(function(){var t,n,r,o;return kl(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),pn?(t='Return only the native name of the language with ISO 639-1 code "'.concat(e,'".\nExamples: \n- "en" -> "English"\n- "ru" -> "Русский" \n- "es" -> "Español"\n- "fr" -> "Français"\n- "de" -> "Deutsch"\n- "zh" -> "中文"\n- "ja" -> "日本語"\n- "ar" -> "العربية"\n\nRespond with ONLY the native language name, no additional text.'),[4,fn.createChatCompletion(pn,[{role:"user",content:t}])]):[2,e.toUpperCase()];case 1:return(n=a.sent())&&n.content?(r=n.content.trim(),localStorage.setItem("language_name_".concat(e),r),[2,r]):[2,e.toUpperCase()];case 2:return o=a.sent(),console.error("Error getting language name from AI:",o),[2,e.toUpperCase()];case 3:return[2]}}))}))}),[pn,fn]),Ir=(0,r.useCallback)((function(e){return El(void 0,void 0,void 0,(function(){var t;return kl(this,(function(n){switch(n.label){case 0:return(t=localStorage.getItem("language_name_".concat(e)))?[2,t]:[4,kr(e)];case 1:return[2,n.sent()]}}))}))}),[kr]),Ar=(0,r.useCallback)((function(e){return El(void 0,void 0,void 0,(function(){var t,n,r,o,a,i;return kl(this,(function(s){switch(s.label){case 0:if(!e||0===e.trim().length)return[2,{shouldGenerate:!1,reason:"No text provided"}];s.label=1;case 1:return s.trys.push([1,3,,4]),t='Analyze this word/phrase and determine if a visual image would be helpful for language learning: "'.concat(e,'"\n\nConsider these criteria:\n- Concrete objects, animals, places, foods, tools, vehicles = YES\n- Abstract concepts, emotions, actions, grammar terms = NO\n- People, professions, activities that can be visualized = YES\n- Numbers, prepositions, conjunctions, abstract ideas = NO\n\nRespond with ONLY "YES" or "NO" followed by a brief reason (max 10 words).\nFormat: "YES - concrete object that can be visualized" or "NO - abstract concept"'),[4,fn.createChatCompletion(pn,[{role:"user",content:t}])];case 2:return(n=s.sent())&&n.content?(r=n.content.trim(),o=r.toUpperCase().startsWith("YES"),a=r.includes(" - ")?r.split(" - ")[1]:"AI analysis",[2,{shouldGenerate:o,reason:a}]):[2,{shouldGenerate:!1,reason:"AI analysis failed"}];case 3:return i=s.sent(),console.error("Error analyzing text for image generation:",i),[2,{shouldGenerate:!1,reason:"Analysis error"}];case 4:return[2]}}))}))}),[fn,pn]),_r=function(e){i(function(e){return{type:ct,payload:e}}(e)),"always"===e&&l&&An()&&Cn(),"off"===e&&(i(Fe(null)),i(Te(null)))},Fr=(0,r.useCallback)((function(e,t,r){return El(void 0,void 0,void 0,(function(){var o,a,s,l,c,u,d,f,p,g,h,m,y,x,v,b,S,C;return kl(this,(function(E){switch(E.label){case 0:if(!t.trim())return he("Please enter some text to create a card from","error"),[2];E.label=1;case 1:return E.trys.push([1,9,10,11]),o=r||e.prompt,a="".concat(o,'\n\nText: "').concat(t,'"\n\nProvide a clear, educational response that would work well as flashcard content. Be concise but informative.'),[4,fn.translateText(a,"en")];case 2:if(!(s=E.sent()))throw new Error("Failed to generate card content");if(l=e.name,c=s,"qa"===e.id&&s.includes("Q:")&&s.includes("A:")?(u=s.indexOf("Q:"),d=s.indexOf("A:"),-1!==u&&-1!==d&&d>u&&(l=s.substring(u+2,d).trim(),c=s.substring(d+2).trim())):"definition"===e.id?(f=s.split("\n").filter((function(e){return e.trim()}))).length>0&&((p=f[0]).includes(":")?(g=p.split(":"),l=g[0].trim(),c=g.slice(1).join(":").trim(),f.length>1&&(c+="\n"+f.slice(1).join("\n"))):(h=t.split(" ").filter((function(e){return e.length>3})),l=h.slice(0,3).join(" ")+(h.length>3?"...":""),c=s)):(m=t.length>50?t.substring(0,50)+"...":t,l="".concat(e.name,": ").concat(m),c=s),y=null,!ee||"off"===te||!An())return[3,8];E.label=3;case 3:return E.trys.push([3,7,,8]),[4,fn.getDescriptionImage(pn,t,w)];case 4:return(x=E.sent())?[4,null===(C=fn.getImageUrl)||void 0===C?void 0:C.call(fn,pn,x)]:[3,6];case 5:(v=E.sent())&&(y=v),E.label=6;case 6:return[3,8];case 7:return b=E.sent(),console.warn("Failed to generate image:",b),[3,8];case 8:return i(Oe(l)),i(je(c)),i(Ie(t)),y&&i(Te(y)),n(!0),[3,11];case 9:return S=E.sent(),console.error("Error generating general card:",S),he("Failed to generate card: ".concat(S instanceof Error?S.message:"Unknown error"),"error"),[3,11];case 10:return[7];case 11:return[2]}}))}))}),[fn,he,i,ee,te,An,w]),Tr=((0,r.useCallback)((function(e){wt(e),l.trim()&&Fr(e,l),Ct(!1)}),[l,Fr]),(0,r.useCallback)((function(){return El(void 0,void 0,void 0,(function(){return kl(this,(function(e){switch(e.label){case 0:return kt.trim()&&l.trim()?[4,Fr({id:"custom",name:"Custom",description:"Custom prompt",icon:"⚡",prompt:kt},l,kt)]:(he("Please enter both text and a custom prompt","error"),[2]);case 1:return e.sent(),At(""),[2]}}))}))}),[kt,l,Fr,he]),(0,r.useCallback)((function(){return El(void 0,void 0,void 0,(function(){var e,t,n,r,o,a,i,s,c,u;return kl(this,(function(d){switch(d.label){case 0:if(!l.trim())return he("Please enter or select text to create cards","error"),[2];un.current=new AbortController,e=un.current.signal,j(!0),d.label=1;case 1:if(d.trys.push([1,7,8,9]),e.aborted)throw new Error("Generation cancelled by user");t=vl(fn,pn),n=void 0,d.label=2;case 2:return d.trys.push([2,4,,5]),r=window.getSelection(),o=void 0,r&&r.rangeCount>0&&(a=r.getRangeAt(0),o=a.commonAncestorContainer.nodeType===Node.ELEMENT_NODE?a.commonAncestorContainer:a.commonAncestorContainer.parentElement||void 0),[4,Sl.extractPageContentAsync(l,o)];case 3:return n=d.sent(),console.log("📄 Extracted page content:",{images:n.pageImages.length,formulas:n.formulas.length,codeBlocks:n.codeBlocks.length,links:n.links.length,metadata:n.metadata,selectedText:l.substring(0,100)+"..."}),n.pageImages.forEach((function(e,t){console.log("🖼️ Изображение ".concat(t,":"),{src:e.src,alt:e.alt,relevanceScore:e.relevanceScore,isRelevant:e.relevanceScore>.3,hasBase64:!!e.base64})})),[3,5];case 4:return i=d.sent(),console.warn("Failed to extract page content, proceeding without multimedia:",i),n=void 0,[3,5];case 5:return[4,t.createCardsFromText(l,n,e)];case 6:return s=d.sent(),e.aborted?(console.log("AI card creation was cancelled by user"),[2]):(console.log("🎉 AI Agents created ".concat(s.length," cards successfully")),s.forEach((function(e,t){var n;console.log("🃏 Карточка ".concat(t,":"),{front:e.front,backPreview:e.back.substring(0,200)+"...",hasAttachedImages:!!e.attachedImages&&e.attachedImages.length>0,attachedImagesCount:(null===(n=e.attachedImages)||void 0===n?void 0:n.length)||0,multimedia:e.multimedia,hasImageInBack:e.back.includes("[IMAGE:")||e.back.includes("!["),hasFormulaInBack:e.back.includes("[FORMULA:")||e.back.includes("$$"),hasCodeInBack:e.back.includes("[CODE:")||e.back.includes("```")}),0===t&&console.log("🃏 Полный back карточки 0:",e.back)})),jt(s),Kt(0),zt(!0),[3,9]);case 7:return c=d.sent(),e.aborted?(console.log("AI card creation was cancelled by user"),[2]):(console.error("❌ Error in AI agent card creation:",c),u=c instanceof Error?c.message:"Unknown error",he("Card creation error: ".concat(u),"error"),[3,9]);case 8:return j(!1),un.current=null,[7];case 9:return[2]}}))}))}),[l,fn,pn,he])),jr=function(){zt(!1),jt([]),Kt(0),en(new Set),cn("")},Or=function(){return El(void 0,void 0,void 0,(function(){var e;return kl(this,(function(t){M(!0);try{if(!(e=Tt[Ht]))return he("No card to save","error"),[2];i(Ee(e)),en((function(e){return new Set(e).add(Ht)}))}catch(e){console.error("Error saving current card:",e),he("Error saving card","error")}finally{M(!1)}return[2]}))}))},Pr=m((function(e){return e.cards.isGeneratingCard}));return(0,a.jsxs)("div",Cl({style:{display:"flex",flexDirection:"column",flex:1,width:"100%",height:"100%",position:"relative"}},{children:[T&&(0,a.jsxs)("div",Cl({style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.8)",zIndex:10,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"20px",padding:"0 20px"}},{children:[(0,a.jsx)(nn,{type:"spinner",size:"large",color:"#3B82F6",text:S===_.GeneralTopic?"Creating cards with AI agents...":"Creating your Anki card..."}),(0,a.jsx)("div",Cl({style:{backgroundColor:"#F3F4F6",padding:"10px 16px",borderRadius:"8px",fontSize:"13px",color:"#4B5563",maxWidth:"90%",textAlign:"center",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"}},{children:S===_.GeneralTopic?"🤖 Text Analysis → 🔍 Card Creation → ✅ Quality Validation":yt?"We're creating multiple cards from your selected options...":"We're analyzing your text and generating learning materials"})),(0,a.jsxs)("button",Cl({onClick:Rn,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",backgroundColor:"#F3F4F6",color:"#4B5563",border:"1px solid #E5E7EB",borderRadius:"6px",padding:"10px 16px",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",marginTop:"10px"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#E5E7EB",e.currentTarget.style.color="#374151"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.color="#4B5563"},title:"Cancel card generation"},{children:[(0,a.jsx)(Zt,{}),"Cancel Generation"]}))]})),tt&&(0,a.jsxs)("div",Cl({style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.8)",zIndex:5,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"20px",padding:"0 20px"}},{children:[(0,a.jsx)(nn,{type:"spinner",size:"large",color:"#3B82F6",text:"Analyzing selected text..."}),(0,a.jsxs)("button",Cl({onClick:function(){return nt(!1)},style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",backgroundColor:"#F3F4F6",color:"#4B5563",border:"1px solid #E5E7EB",borderRadius:"6px",padding:"10px 16px",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",marginTop:"10px"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#E5E7EB",e.currentTarget.style.color="#374151"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.color="#4B5563"},title:"Cancel text analysis"},{children:[(0,a.jsx)(Zt,{}),"Cancel Analysis"]}))]})),(0,a.jsx)("div",Cl({style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",gap:"12px",width:"100%",padding:"12px",paddingTop:"16px",height:"100%",overflowY:"auto",backgroundColor:"#ffffff",paddingBottom:"16px"}},{children:(0,a.jsxs)("div",Cl({style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"12px",width:"100%",maxWidth:"320px"}},{children:[(0,a.jsxs)("div",Cl({style:{display:"flex",alignItems:"center",gap:"12px",width:"100%",padding:"12px",backgroundColor:"#F8FAFC",border:"1px solid #E2E8F0",borderRadius:"8px",marginBottom:"8px"}},{children:[(0,a.jsxs)("div",Cl({style:{display:"flex",alignItems:"center",gap:"8px",color:S===_.LanguageLearning?"#3B82F6":"#6B7280",fontSize:"14px",fontWeight:"500",transition:"color 0.2s ease"}},{children:[(0,a.jsx)(Mt,{}),"Language Learning"]})),(0,a.jsx)("button",Cl({onClick:A,style:{position:"relative",width:"48px",height:"24px",backgroundColor:S===_.GeneralTopic?"#3B82F6":"#CBD5E1",borderRadius:"12px",border:"none",cursor:"pointer",transition:"background-color 0.2s ease",outline:"none"},title:"Switch to ".concat(S===_.LanguageLearning?"General Cards":"Language Learning")},{children:(0,a.jsx)("div",{style:{position:"absolute",top:"2px",left:S===_.GeneralTopic?"26px":"2px",width:"20px",height:"20px",backgroundColor:"#ffffff",borderRadius:"50%",transition:"left 0.2s ease",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.2)"}})})),(0,a.jsxs)("div",Cl({style:{display:"flex",alignItems:"center",gap:"8px",color:S===_.GeneralTopic?"#3B82F6":"#6B7280",fontSize:"14px",fontWeight:"500",transition:"color 0.2s ease"}},{children:[(0,a.jsx)(It,{}),"General Cards"]}))]})),S===_.LanguageLearning&&(0,a.jsxs)("div",Cl({style:{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%",gap:"8px"}},{children:[Xn(),Cr(),(0,a.jsxs)("div",Cl({style:{display:"flex",flexDirection:"column",width:"100%",gap:"8px",marginTop:"4px"}},{children:[(0,a.jsx)("label",Cl({style:{color:"#111827",fontWeight:"600",fontSize:"14px",margin:0}},{children:"Image Generation:"})),(0,a.jsxs)("div",Cl({style:{display:"flex",width:"100%",backgroundColor:"#F3F4F6",borderRadius:"8px",padding:"4px",gap:"2px",opacity:An()?1:.5}},{children:[(0,a.jsx)("button",Cl({type:"button",onClick:function(){return _r("off")},disabled:!An(),style:{flex:1,whiteSpace:"nowrap",padding:"8px 12px",borderRadius:"6px",border:"none",backgroundColor:"off"===te?"#FFFFFF":"transparent",color:"off"===te?"#111827":"#6B7280",fontSize:"12px",fontWeight:"off"===te?"600":"500",cursor:An()?"pointer":"not-allowed",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",boxShadow:"off"===te?"0 1px 2px rgba(0, 0, 0, 0.05)":"none"}},{children:"🚫 Off"})),(0,a.jsx)("button",Cl({type:"button",onClick:function(){return _r("smart")},disabled:!An(),style:{flex:1,whiteSpace:"nowrap",padding:"8px 12px",borderRadius:"6px",border:"none",backgroundColor:"smart"===te?"#FFFFFF":"transparent",color:"smart"===te?"#111827":"#6B7280",fontSize:"12px",fontWeight:"smart"===te?"600":"500",cursor:An()?"pointer":"not-allowed",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",boxShadow:"smart"===te?"0 1px 2px rgba(0, 0, 0, 0.05)":"none"}},{children:"🧠 Smart"})),(0,a.jsx)("button",Cl({type:"button",onClick:function(){return _r("always")},disabled:!An(),style:{flex:1,whiteSpace:"nowrap",padding:"8px 12px",borderRadius:"6px",border:"none",backgroundColor:"always"===te?"#FFFFFF":"transparent",color:"always"===te?"#111827":"#6B7280",fontSize:"12px",fontWeight:"always"===te?"600":"500",cursor:An()?"pointer":"not-allowed",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",boxShadow:"always"===te?"0 1px 2px rgba(0, 0, 0, 0.05)":"none"}},{children:"🎨 Always"}))]})),(0,a.jsx)("div",Cl({style:{position:"relative",height:"2.8em",marginTop:"2px"}},{children:(0,a.jsxs)("div",Cl({style:{position:"absolute",top:0,left:0,right:0,fontSize:"11px",color:"#6B7280",lineHeight:"1.4",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"}},{children:["off"===te&&"No images will be generated","smart"===te&&"AI decides: Images only for concrete objects, places, and visual concepts. Saves API costs by skipping abstract terms.","always"===te&&"Images generated for all cards"]}))})),!An()&&(0,a.jsx)("div",Cl({style:{fontSize:"12px",color:"#EF4444",backgroundColor:"#FEF2F2",padding:"6px 8px",borderRadius:"6px",border:"1px solid #FECACA"}},{children:"Image generation not available with Groq provider"}))]})),"off"!==te&&An()&&(ee?ie?(0,a.jsxs)("div",Cl({style:{backgroundColor:"#F9FAFB",border:"1px solid #E5E7EB",borderRadius:"8px",padding:"16px",width:"100%",marginBottom:"12px",marginTop:"8px"}},{children:[(0,a.jsxs)("div",Cl({style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"}},{children:[(0,a.jsxs)("h3",Cl({style:{margin:0,fontSize:"16px",fontWeight:600,display:"flex",alignItems:"center",gap:"8px"}},{children:[(0,a.jsx)(Ut,{size:14,color:"#10B981"}),"Image Instructions"]})),(0,a.jsx)("button",Cl({onClick:function(){return se(!1)},style:{background:"transparent",border:"none",cursor:"pointer",color:"#6B7280",fontSize:"13px"}},{children:"Cancel"}))]})),(0,a.jsxs)("div",Cl({style:{marginBottom:"16px"}},{children:[(0,a.jsx)("label",Cl({style:{display:"block",marginBottom:"4px",fontSize:"14px",fontWeight:500,color:"#374151"}},{children:"Image generation style"})),(0,a.jsx)("textarea",{value:fe,onChange:function(e){return pe(e.target.value)},placeholder:"E.g., use anime style, make it minimalist, use pastel colors, make it black and white",style:{width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",fontSize:"14px",minHeight:"100px",resize:"vertical"}}),(0,a.jsxs)("div",Cl({style:{fontSize:"12px",color:"#6B7280",marginTop:"8px",lineHeight:"1.4"}},{children:[(0,a.jsx)("p",Cl({style:{margin:"0 0 6px 0",fontWeight:"500"}},{children:"How to use:"})),(0,a.jsxs)("ul",Cl({style:{margin:0,paddingLeft:"16px"}},{children:[(0,a.jsxs)("li",{children:["These are ",(0,a.jsx)("strong",{children:"style instructions"})," for image generation"]}),(0,a.jsx)("li",{children:"The image will still be related to the word you're learning"}),(0,a.jsx)("li",{children:"Focus on artistic style, mood, colors, composition, etc."}),(0,a.jsx)("li",{children:'Examples: "watercolor style", "dark background", "realistic rendering"'})]}))]}))]})),(0,a.jsxs)("button",Cl({onClick:Pn,style:{backgroundColor:"#10B981",color:"white",border:"none",borderRadius:"6px",padding:"8px 16px",fontSize:"14px",fontWeight:500,cursor:"pointer",width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"}},{children:[(0,a.jsx)(Ut,{size:14}),"Save Image Instructions"]}))]})):(0,a.jsxs)("button",Cl({onClick:function(){return se(!0)},style:{display:"flex",alignItems:"center",gap:"6px",backgroundColor:"#F3F4F6",border:"1px solid #E5E7EB",borderRadius:"6px",padding:"6px 12px",fontSize:"13px",color:"#4B5563",cursor:"pointer",width:"100%",justifyContent:"center",marginTop:"8px"}},{children:[(0,a.jsx)(Ut,{size:14}),"Customize image generation"]})):null)]})),S===_.GeneralTopic&&(0,a.jsxs)("div",Cl({style:{display:"flex",flexDirection:"column",gap:"12px",padding:"16px",backgroundColor:"#F8FAFC",borderRadius:"8px",border:"1px solid #E2E8F0"}},{children:[(0,a.jsxs)("div",Cl({style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"}},{children:[(0,a.jsx)(Yt,{style:{color:"#6366F1"}}),(0,a.jsx)("h4",Cl({style:{fontSize:"16px",fontWeight:"600",color:"#111827",margin:0}},{children:"AI Agent Card Creator"}))]})),(0,a.jsx)("p",Cl({style:{fontSize:"14px",color:"#6B7280",margin:0,lineHeight:"1.4"}},{children:"Select text on any page and AI agents will automatically create optimal cards for learning. The system analyzes content and creates 1 to several cards with quality validation."})),(0,a.jsxs)("div",Cl({style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 12px",backgroundColor:"#FEF3C7",borderRadius:"6px",border:"1px solid #F59E0B"}},{children:[(0,a.jsx)(Vt,{style:{color:"#F59E0B"}}),(0,a.jsx)("span",Cl({style:{fontSize:"12px",color:"#92400E",fontWeight:"500"}},{children:"AI analyzes text, creates cards and validates results"}))]})),!T&&(0,a.jsxs)("button",Cl({onClick:Tr,disabled:!l.trim()||T,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",width:"100%",padding:"8px 10px",backgroundColor:l.trim()&&!T?"#2563EB":"#E5E7EB",color:l.trim()&&!T?"#ffffff":"#9CA3AF",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:"600",cursor:l.trim()&&!T?"pointer":"not-allowed",transition:"all 0.2s ease",marginTop:"4px",opacity:T?.7:1},onMouseOver:function(e){l.trim()&&!T&&(e.currentTarget.style.backgroundColor="#1D4ED8")},onMouseOut:function(e){l.trim()&&!T&&(e.currentTarget.style.backgroundColor="#2563EB")}},{children:[T?(0,a.jsx)(nn,{type:"spinner",size:"small",inline:!0,color:"#ffffff"}):(0,a.jsx)(Yt,{}),"Create Cards with AI"]}))]})),re?(0,a.jsxs)("div",Cl({style:{backgroundColor:"#F9FAFB",border:"1px solid #E5E7EB",borderRadius:"8px",padding:"16px",width:"100%",marginBottom:"12px"}},{children:[(0,a.jsxs)("div",Cl({style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"}},{children:[(0,a.jsxs)("h3",Cl({style:{margin:0,fontSize:"16px",fontWeight:600,display:"flex",alignItems:"center",gap:"8px"}},{children:[(0,a.jsx)(Vt,{size:14,color:"#2563EB"}),"AI Instructions"]})),(0,a.jsx)("button",Cl({onClick:function(){return oe(!1)},style:{background:"transparent",border:"none",cursor:"pointer",color:"#6B7280",fontSize:"13px"}},{children:"Cancel"}))]})),(0,a.jsxs)("div",Cl({style:{marginBottom:"16px"}},{children:[(0,a.jsx)("label",Cl({style:{display:"block",marginBottom:"4px",fontSize:"14px",fontWeight:500,color:"#374151"}},{children:"Additional instructions for AI"})),(0,a.jsx)("textarea",{value:ce,onChange:function(e){return ue(e.target.value)},placeholder:"E.g., Keep specialized terms untranslated. Make examples more advanced. Use formal language.",style:{width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",fontSize:"14px",minHeight:"100px",resize:"vertical"}}),(0,a.jsxs)("div",Cl({style:{fontSize:"12px",color:"#6B7280",marginTop:"8px",lineHeight:"1.4"}},{children:[(0,a.jsx)("p",Cl({style:{margin:"0 0 6px 0",fontWeight:"500"}},{children:"How to use:"})),(0,a.jsxs)("ul",Cl({style:{margin:0,paddingLeft:"16px"}},{children:[(0,a.jsxs)("li",{children:["These are ",(0,a.jsx)("strong",{children:"additional"})," instructions that supplement the basic AI behavior"]}),(0,a.jsx)("li",{children:"The original word will always be used (no need to specify it)"}),(0,a.jsx)("li",{children:"Examples will always be generated for the word you're learning"}),(0,a.jsx)("li",{children:"Use this for style guidance, preferences, or special requirements"})]}))]}))]})),(0,a.jsxs)("button",Cl({onClick:On,style:{backgroundColor:"#2563EB",color:"white",border:"none",borderRadius:"6px",padding:"8px 16px",fontSize:"14px",fontWeight:500,cursor:"pointer",width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",marginBottom:"8px"}},{children:[(0,a.jsx)(Pt,{size:14}),"Save Instructions"]}))]})):(0,a.jsxs)("button",Cl({onClick:function(){return oe(!0)},style:{display:"flex",alignItems:"center",gap:"6px",backgroundColor:"#F3F4F6",border:"1px solid #E5E7EB",borderRadius:"6px",padding:"6px 12px",fontSize:"13px",color:"#4B5563",cursor:"pointer",width:"100%",justifyContent:"center"}},{children:[(0,a.jsx)(Rt,{size:14}),"Customize AI behavior"]})),S===_.LanguageLearning&&(0,a.jsxs)("form",Cl({onSubmit:function(e){return El(void 0,void 0,void 0,(function(){var t,r,a,i,s,c,u,d,f,p,g,h,m,y,x,S,C,k,A,_,F,T,O,P,R,N,L,B,z;return kl(this,(function(D){switch(D.label){case 0:if(e.preventDefault(),!l.trim())return[2];un.current=new AbortController,t=un.current.signal,br(!0),o.setIsGeneratingCard(!0),Y(!1),localStorage.removeItem("explicitly_saved"),ut([]),vt(!1),o.setCurrentCardId(null),ee?E!==l&&(console.log("Text has changed, clearing existing images for new generation"),o.setImage(null),o.setImageUrl(null)):(console.log("Image generation is disabled, clearing existing images"),o.setImage(null),o.setImageUrl(null)),o.setLinguisticInfo(""),o.setTranscription(""),j(!0),I(l),he(null),D.label=1;case 1:if(D.trys.push([1,42,43,44]),console.log("=== DEBUG INFO ==="),console.log("Model Provider:",Z),console.log("API Key available:",Boolean(pn)),console.log("Model Name (if Groq):",Z===zs.Groq?X:"N/A"),console.log("AI Service:",Object.keys(fn)),console.log("Source Language:",hr?rr:er),!pn)throw new Error("API key for ".concat(Z," is missing. Please go to settings and add your API key."));r=hr?rr:er,a={translation:!1,examples:!1,flashcard:!1,image:!1,linguisticInfo:!1},D.label=2;case 2:if(D.trys.push([2,4,,5]),t.aborted)throw new Error("Generation cancelled by user");return[4,tl(fn,pn,l,v,b,0,t)];case 3:if(i=D.sent(),t.aborted)throw new Error("Generation cancelled by user");return i.translated&&(o.setTranslation(i.translated),a.translation=!0),[3,5];case 4:if(s=D.sent(),t.aborted)return console.log("Translation cancelled by user"),[2];if(s instanceof Error&&ye(s))return console.error("Quota error detected, stopping card creation:",s.message),he(s.message),[2];throw console.error("Translation failed:",s),new Error("Translation failed: ".concat(s instanceof Error?s.message:"Unknown error"));case 5:if(D.trys.push([5,7,,8]),t.aborted)throw new Error("Generation cancelled by user");return[4,nl(fn,pn,l,v,!0,b,r||void 0,t)];case 6:if(c=D.sent(),t.aborted)throw new Error("Generation cancelled by user");return c&&c.length>0&&(u=c.map((function(e){return[e.original,e.translated]})),o.setExamples(u),a.examples=!0),[3,8];case 7:if(d=D.sent(),t.aborted)return console.log("Examples generation cancelled by user"),[2];if(d instanceof Error&&ye(d))return console.error("Quota error detected, stopping card creation:",d.message),he(d.message),[2];if(console.error("Examples generation failed:",d),!a.translation)throw new Error("Examples generation failed: ".concat(d instanceof Error?d.message:"Unknown error"));return he("Examples generation failed: ".concat(d instanceof Error?d.message:"Unknown error",". Continuing with translation only."),"warning"),[3,8];case 8:if(D.trys.push([8,10,,11]),t.aborted)throw new Error("Generation cancelled by user");return[4,rl(fn,pn,l,t)];case 9:if(f=D.sent(),t.aborted)throw new Error("Generation cancelled by user");return f.front&&(o.setFront(f.front),a.flashcard=!0),[3,11];case 10:if(p=D.sent(),t.aborted)return console.log("Flashcard creation cancelled by user"),[2];if(p instanceof Error&&ye(p))return console.error("Quota error detected, stopping card creation:",p.message),he(p.message),[2];if(console.error("Flashcard creation failed:",p),!a.translation)throw new Error("Flashcard creation failed: ".concat(p instanceof Error?p.message:"Unknown error"));return he("Flashcard creation failed: ".concat(p instanceof Error?p.message:"Unknown error",". Continuing with available data."),"warning"),[3,11];case 11:return D.trys.push([11,22,,23]),g=hr?rr:er,console.log("Creating validated linguistic info using source language: ".concat(g||"unknown",' for text: "').concat(l.substring(0,20),'...", user language: ').concat(v)),h="true"===localStorage.getItem("useMultipleValidators"),g?(m=void 0,h?(console.log("Using enhanced validation with multiple AI agents"),[4,pl(fn,pn,l,g,v,5,!0)]):[3,13]):[3,16];case 12:return m=D.sent(),[3,15];case 13:return console.log("Using standard validation"),[4,fl(fn,pn,l,g,v,5)];case 14:m=D.sent(),D.label=15;case 15:return m.linguisticInfo?(o.setLinguisticInfo(m.linguisticInfo),a.linguisticInfo=!0,h&&"confidence"in m&&"number"==typeof m.confidence&&(y=Math.round(100*m.confidence),m.wasValidated||he("⚠️ Enhanced grammar reference created but validation uncertain (".concat(y,"% confidence)"),"warning"))):(console.warn("Failed to generate linguistic info after ".concat(m.attempts," attempts")),he("Failed to generate grammar reference","warning")),[3,21];case 16:return console.warn("No source language detected. Using target language (".concat(v,") as fallback for source")),m=void 0,h?[4,pl(fn,pn,l,v,v,3,!0)]:[3,18];case 17:return m=D.sent(),[3,20];case 18:return[4,fl(fn,pn,l,v,v,3)];case 19:m=D.sent(),D.label=20;case 20:m.linguisticInfo&&(o.setLinguisticInfo(m.linguisticInfo),a.linguisticInfo=!0,h&&"confidence"in m&&"number"==typeof m.confidence?(y=Math.round(100*m.confidence),m.wasValidated||he("⚠️ Enhanced grammar reference uncertain (fallback mode, ".concat(y,"% confidence)"),"warning")):m.wasValidated&&m.attempts>1||m.wasValidated||he("⚠️ Grammar reference may contain inaccuracies (fallback mode)","warning")),D.label=21;case 21:return[3,23];case 22:return(x=D.sent())instanceof Error&&ye(x)?(console.error("Quota error detected, stopping card creation:",x.message),he(x.message),[2]):(console.error("Linguistic info generation failed:",x),a.translation&&console.log("Linguistic info generation failed: ".concat(x instanceof Error?x.message:"Unknown error",". Continuing with available data.")),[3,23]);case 23:return D.trys.push([23,29,,30]),(S=hr?rr:er)?(console.log("Creating transcription using source language: ".concat(S,", user language: ").concat(v)),[4,ol(fn,pn,l,S,v)]):[3,27];case 24:return(C=D.sent())?[4,Ir(v)]:[3,26];case 25:k=D.sent(),(A=[C.userLanguageTranscription&&'<div class="transcription-item user-lang">\n                                    <span class="transcription-label">'.concat(k,':</span>\n                                    <span class="transcription-text">').concat(C.userLanguageTranscription,"</span>\n                                </div>"),C.ipaTranscription&&'<div class="transcription-item ipa">\n                                    <span class="transcription-label">IPA:</span>\n                                    <span class="transcription-text">'.concat(C.ipaTranscription,"</span>\n                                </div>")].filter(Boolean).join("\n"))&&(o.setTranscription(A),console.log("Transcription created successfully")),D.label=26;case 26:return[3,28];case 27:console.warn("No source language available for transcription"),D.label=28;case 28:return[3,30];case 29:return(_=D.sent())instanceof Error&&ye(_)?(console.error("Quota error detected, stopping card creation:",_.message),he(_.message),[2]):(console.error("Transcription generation failed:",_),[3,30]);case 30:if("off"===te||!An())return[3,41];D.label=31;case 31:return D.trys.push([31,40,,41]),F="always"===te,T="","smart"!==te?[3,33]:[4,Ar(l)];case 32:O=D.sent(),F=O.shouldGenerate,T=O.reason,console.log('Smart image analysis for "'.concat(l,'": ').concat(F?"YES":"NO"," - ").concat(T)),D.label=33;case 33:return F?[4,fn.getDescriptionImage(pn,l,w)]:[3,38];case 34:return P=D.sent(),Z!==zs.OpenAI?[3,36]:[4,ks(0,xe,Q,P,w)];case 35:return R=D.sent(),N=R.imageUrl,L=R.imageBase64,N&&(console.log("*** HANDLE SUBMIT: Setting imageUrl in Redux:",N.substring(0,50)),o.setImageUrl(N)),L&&(console.log("*** HANDLE SUBMIT: Setting image (base64) in Redux:",L.substring(0,50)),o.setImage(L)),a.image=!0,[3,37];case 36:console.log("Image generation not supported for this provider"),D.label=37;case 37:return[3,39];case 38:D.label=39;case 39:return[3,41];case 40:return(B=D.sent())instanceof Error&&ye(B)?(console.error("Quota error detected, stopping card creation:",B.message),he(B.message),[2]):(console.error("Image generation failed:",B),(a.translation||a.examples)&&he("Image generation failed: ".concat(B instanceof Error?B.message:"Unknown error",". Continuing without image."),"warning"),[3,41]);case 41:if(o.setCurrentCardId(null),Y(!1),mn([]),localStorage.removeItem("explicitly_saved"),localStorage.removeItem("current_card_id"),console.log("Created new single card - reset all saved statuses"),!(a.translation||a.examples||a.flashcard))throw new Error("Failed to create card: No data was successfully generated. Please check your API key and try again.");return n(!0),Me(!0),G(!0),[3,44];case 42:return z=D.sent(),t.aborted?(console.log("Card generation was cancelled by user"),[2]):z instanceof Error&&ye(z)?(console.error("Quota error detected in main catch:",z.message),he(z.message),n(!1),Me(!1),[2]):(console.error("Error processing text:",z),he(z instanceof Error?"".concat(z.message):"Failed to create card. Please check your API key and try again."),n(!1),Me(!1),[3,44]);case 43:return j(!1),o.setIsGeneratingCard(!1),un.current=null,[7];case 44:return[2]}}))}))},style:{width:"100%",display:"flex",flexDirection:"column",gap:"8px",marginTop:"4px",marginBottom:"0"}},{children:[(0,a.jsxs)("div",Cl({style:{display:"flex",flexDirection:"column",gap:"4px",width:"100%"}},{children:[(0,a.jsxs)("label",Cl({htmlFor:"text",style:{color:"#111827",fontWeight:"600",fontSize:"14px",display:"flex",alignItems:"center"}},{children:["Text:",Nn()]})),(0,a.jsx)("textarea",{id:"text",value:l,onChange:function(e){return bn(e.target.value)},placeholder:"Enter text to translate or select text from a webpage",style:{width:"100%",minHeight:"80px",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"14px",resize:"vertical",outline:"none",transition:"all 0.2s ease"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}})]})),(0,a.jsx)("button",Cl({type:"submit",disabled:T,style:{width:"100%",padding:"8px 10px",marginTop:"4px",borderRadius:"6px",backgroundColor:"#2563EB",color:"#ffffff",fontWeight:"600",fontSize:"14px",border:"none",cursor:"pointer",transition:"all 0.2s ease",opacity:T?.7:1},onMouseOver:function(e){return!T&&(e.currentTarget.style.backgroundColor="#1D4ED8")},onMouseOut:function(e){return!T&&(e.currentTarget.style.backgroundColor="#2563EB")}},{children:T?(0,a.jsx)("div",Cl({style:{display:"flex",alignItems:"center",justifyContent:"center"}},{children:(0,a.jsx)(nn,{type:"spinner",size:"small",inline:!0,color:"#ffffff",text:"Creating card"})})):"Create Card"}))]})),S===_.GeneralTopic&&(0,a.jsxs)("div",Cl({style:{width:"100%",display:"flex",flexDirection:"column",gap:"8px",marginTop:"4px"}},{children:[(0,a.jsxs)("label",Cl({htmlFor:"general-text",style:{color:"#111827",fontWeight:"600",fontSize:"14px",display:"flex",alignItems:"center"}},{children:["Text for Analysis:",Nn()]})),(0,a.jsx)("textarea",{id:"general-text",value:l,onChange:function(e){return bn(e.target.value)},placeholder:"Enter or select text from the page to create cards",style:{width:"100%",minHeight:"80px",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"14px",resize:"vertical",outline:"none",transition:"all 0.2s ease"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}})]}))]}))})),function(){if(!Je)return null;var e=Object.values(at).filter(Boolean).length;return(0,a.jsx)("div",Cl({style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(2px)",padding:"16px"},onClick:function(){it({}),Ze(!1)}},{children:(0,a.jsxs)("div",Cl({style:{backgroundColor:"#ffffff",borderRadius:"12px",maxWidth:"360px",width:"100%",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",position:"relative",padding:"16px"},onClick:function(e){return e.stopPropagation()}},{children:[(0,a.jsxs)("div",Cl({style:{position:"sticky",top:0,display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid #E5E7EB",paddingBottom:"12px",marginBottom:"16px",backgroundColor:"#ffffff",zIndex:2}},{children:[(0,a.jsxs)("h3",Cl({style:{margin:0,fontSize:"16px",fontWeight:600,color:"#111827",display:"flex",alignItems:"center",gap:"8px"}},{children:[(0,a.jsx)(Dt,{size:14,color:"#2563EB"}),"Select Terms for Cards"]})),(0,a.jsx)("button",Cl({onClick:function(){it({}),Ve([]),Ze(!1)},style:{background:"none",border:"none",display:"flex",alignItems:"center",justifyContent:"center",padding:"8px",borderRadius:"50%",cursor:"pointer",transition:"background-color 0.2s"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="#F3F4F6"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="transparent"},"aria-label":"Close"},{children:(0,a.jsx)(Zt,{size:16,color:"#6B7280"})}))]})),(0,a.jsxs)("div",Cl({style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"14px"}},{children:[(0,a.jsxs)("p",Cl({style:{fontSize:"14px",color:"#4B5563",margin:0,lineHeight:"1.4"}},{children:["Found ",We.length," key terms"]})),e>0&&(0,a.jsxs)("span",Cl({style:{fontSize:"13px",fontWeight:500,color:"#2563EB",padding:"3px 8px",backgroundColor:"#EFF6FF",borderRadius:"6px"}},{children:[e," selected"]}))]})),(0,a.jsxs)("div",Cl({style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 4px",marginBottom:"12px"}},{children:[(0,a.jsx)("button",Cl({onClick:function(){var t=e<We.length,n={};We.forEach((function(e){n[e]=t})),it(n)},style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"13px",background:"none",border:"none",padding:"4px 8px",borderRadius:"4px",color:"#4B5563",cursor:"pointer"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="#F3F4F6"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="transparent"}},{children:e===We.length?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",Cl({style:{fontSize:"13px"}},{children:"✓"}))," Deselect all"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",Cl({style:{fontSize:"13px"}},{children:"☐"}))," Select all"]})})),(0,a.jsx)("span",Cl({style:{fontSize:"12px",color:"#6B7280",fontStyle:"italic"}},{children:"Tap to select"}))]})),(0,a.jsx)("div",Cl({style:{display:"flex",flexDirection:"column",gap:"8px",marginBottom:"16px",maxHeight:"300px",overflowY:"auto",padding:"4px",listStyle:"none"}},{children:tt?(0,a.jsx)("div",Cl({style:{display:"flex",justifyContent:"center",padding:"20px"}},{children:(0,a.jsx)(nn,{type:"spinner",size:"large",color:"#3B82F6",text:"Analyzing selected text..."})})):We.map((function(e,t){return(0,a.jsxs)("div",Cl({style:{display:"flex",alignItems:"center",padding:"10px 12px",backgroundColor:at[e]?"#EFF6FF":"#F9FAFB",border:"1px solid ".concat(at[e]?"#BFDBFE":"#E5E7EB"),borderRadius:"8px",cursor:"pointer",transition:"all 0.2s ease",position:"relative",listStyleType:"none"},onClick:function(){return zn(e)}},{children:[(0,a.jsx)("input",{type:"checkbox",checked:!!at[e],onChange:function(){return zn(e)},style:{marginRight:"12px",width:"16px",height:"16px",accentColor:"#2563EB",minWidth:"16px"},id:"option-".concat(t)}),(0,a.jsx)("span",Cl({style:{fontSize:"14px",color:"#374151",flex:1,cursor:"pointer",wordBreak:"break-word",textAlign:"left",paddingLeft:"0",marginLeft:"0",display:"inline-block"}},{children:e.replace(/^[-–—•\s]+/,"")})),(0,a.jsx)("span",Cl({style:{position:"absolute",right:"10px",top:"10px",fontSize:"10px",padding:"2px 6px",borderRadius:"10px",backgroundColor:e.split(/\s+/).length>1?"#DBEAFE":"#F3F4F6",color:e.split(/\s+/).length>1?"#1E40AF":"#6B7280",fontWeight:e.split(/\s+/).length>1?"500":"normal"}},{children:e.split(/\s+/).length>1?"phrase":"word"}))]}),t)}))})),(0,a.jsxs)("div",Cl({style:{display:"flex",gap:"8px",marginTop:"12px"}},{children:[(0,a.jsx)("button",Cl({onClick:function(){it({}),Ze(!1)},style:{flex:"1",padding:"10px 12px",backgroundColor:"#F9FAFB",color:"#4B5563",border:"1px solid #E5E7EB",borderRadius:"6px",fontSize:"14px",fontWeight:500,cursor:"pointer",transition:"all 0.2s ease"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#F3F4F6"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#F9FAFB"}},{children:"Cancel"})),(0,a.jsxs)("button",Cl({onClick:Bn,disabled:0===e,style:{flex:"2",padding:"10px 12px",backgroundColor:0===e?"#E5E7EB":"#2563EB",color:0===e?"#9CA3AF":"#FFFFFF",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:500,cursor:0===e?"not-allowed":"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},onMouseOver:function(t){e>0&&(t.currentTarget.style.backgroundColor="#1D4ED8")},onMouseOut:function(t){e>0&&(t.currentTarget.style.backgroundColor="#2563EB")}},{children:[(0,a.jsx)(qt,{size:14}),"Create ",e>0?"".concat(e," Card").concat(e>1?"s":""):"Cards"]}))]}))]}))}))}(),De&&t?(0,a.jsx)("div",Cl({style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(2px)",padding:"16px"},onClick:Ln},{children:(0,a.jsxs)("div",Cl({style:{backgroundColor:"#ffffff",borderRadius:"12px",maxWidth:"340px",width:"100%",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",position:"relative",padding:"16px"},onClick:function(e){return e.stopPropagation()}},{children:[(0,a.jsxs)("div",Cl({style:{position:"sticky",top:0,display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid #E5E7EB",paddingBottom:"12px",marginBottom:"16px",backgroundColor:"#ffffff",zIndex:2}},{children:[(0,a.jsx)("h3",Cl({style:{margin:0,fontSize:"16px",fontWeight:600,color:"#111827"}},{children:yt?"Card ".concat(gt+1," of ").concat(lt.length):"Your Card"})),(0,a.jsx)("button",Cl({onClick:Ln,style:{background:"none",border:"none",display:"flex",alignItems:"center",justifyContent:"center",padding:"8px",borderRadius:"50%",cursor:"pointer",transition:"background-color 0.2s"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="#F3F4F6"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="transparent"},"aria-label":"Close"},{children:(0,a.jsx)(Zt,{size:16,color:"#6B7280"})}))]})),(0,a.jsxs)("div",Cl({style:{width:"100%",marginBottom:"12px"}},{children:[(0,a.jsxs)("div",Cl({style:{position:"relative",width:"100%"}},{children:[(0,a.jsx)("input",{type:"text",value:be,onChange:function(e){return we(e.target.value)},onKeyDown:In,placeholder:"Enter custom instructions (e.g., 'more formal examples', 'change image style')",style:{width:"100%",padding:"10px 12px",paddingRight:"44px",borderRadius:"8px",border:"1px solid #E5E7EB",fontSize:"14px",color:"#374151",backgroundColor:Ce?"#F9FAFB":"#FFFFFF",transition:"all 0.2s ease",boxShadow:Ce?"inset 0 1px 2px rgba(0, 0, 0, 0.05)":"none"},disabled:Ce}),Ce?(0,a.jsx)("div",Cl({style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",padding:"6px",borderRadius:"50%",color:"#4F46E5"}},{children:(0,a.jsx)(nn,{type:"spinner",size:"small",inline:!0,color:"#4F46E5"})})):(0,a.jsx)("button",Cl({onClick:kn,disabled:!be.trim()||Ce,style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",background:be.trim()?"linear-gradient(to right, #4F46E5, #6366F1)":"none",border:"none",color:be.trim()?"#FFFFFF":"#9CA3AF",cursor:be.trim()?"pointer":"not-allowed",display:"flex",alignItems:"center",justifyContent:"center",padding:"6px",borderRadius:"50%",width:"28px",height:"28px",boxShadow:be.trim()?"0 1px 3px rgba(0, 0, 0, 0.1)":"none",transition:"all 0.2s ease"},title:"Apply instructions"},{children:(0,a.jsx)(Gt,{size:14})}))]})),(0,a.jsxs)("div",Cl({style:{fontSize:"12px",color:Ce?"#4F46E5":"#6B7280",marginTop:"6px",display:"flex",alignItems:"center",gap:"6px",fontWeight:Ce?"500":"normal"}},{children:[Ce&&(0,a.jsx)("span",{style:{display:"inline-block",width:"6px",height:"6px",borderRadius:"50%",backgroundColor:"#4F46E5",animation:"pulse 1.5s infinite"}}),Ce?"Applying your instructions...":"Type instructions and press Enter or click the magic wand"]})),(0,a.jsx)("style",{children:"\n                            @keyframes pulse {\n                                0% { opacity: 1; }\n                                50% { opacity: 0.4; }\n                                100% { opacity: 1; }\n                            }\n                        "})]})),yt&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",Cl({style:{marginBottom:"8px",display:"flex",justifyContent:"center",alignItems:"center"}},{children:(0,a.jsxs)("div",Cl({style:{fontSize:"13px",color:"#4B5563",backgroundColor:"#F9FAFB",padding:"4px 10px",borderRadius:"16px",display:"flex",alignItems:"center",gap:"4px"}},{children:["Card ",gt+1," of ",lt.length,lt[gt]&&yn(lt[gt].id)&&(0,a.jsxs)("span",Cl({style:{display:"inline-flex",alignItems:"center",gap:"3px",backgroundColor:"#ECFDF5",color:"#10B981",padding:"2px 6px",borderRadius:"10px",fontSize:"11px",fontWeight:"bold"}},{children:[(0,a.jsx)(_t,{size:8}),"SAVED"]}))]}))})),(0,a.jsxs)("div",Cl({style:{display:"flex",justifyContent:"space-between",gap:"8px",marginBottom:"12px"}},{children:[(0,a.jsxs)("button",Cl({onClick:$n,disabled:0===gt,style:{padding:"8px 16px",backgroundColor:0===gt?"#F3F4F6":"#EFF6FF",color:0===gt?"#9CA3AF":"#2563EB",border:"1px solid ".concat(0===gt?"#E5E7EB":"#BFDBFE"),borderRadius:"6px",fontSize:"14px",fontWeight:500,cursor:0===gt?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"8px",flex:1}},{children:["← Prev",gt>0&&lt[gt-1]&&(yn(lt[gt-1].id)?(0,a.jsx)("span",{style:{width:"6px",height:"6px",borderRadius:"50%",backgroundColor:"#10B981",marginLeft:"auto"}}):null)]})),(0,a.jsxs)("button",Cl({onClick:Dn,disabled:gt===lt.length-1,style:{padding:"8px 16px",backgroundColor:gt===lt.length-1?"#F3F4F6":"#EFF6FF",color:gt===lt.length-1?"#9CA3AF":"#2563EB",border:"1px solid ".concat(gt===lt.length-1?"#E5E7EB":"#BFDBFE"),borderRadius:"6px",fontSize:"14px",fontWeight:500,cursor:gt===lt.length-1?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"8px",flex:1,justifyContent:"flex-end"}},{children:[gt<lt.length-1&&lt[gt+1]&&(yn(lt[gt+1].id)?(0,a.jsx)("span",{style:{width:"6px",height:"6px",borderRadius:"50%",backgroundColor:"#10B981",marginRight:"auto"}}):null),"Next →"]}))]})),(0,a.jsx)("button",Cl({onClick:_n,style:{width:"100%",padding:"10px 12px",backgroundColor:"#10B981",color:"white",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:500,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",marginBottom:"12px",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"},disabled:D},{children:D?(0,a.jsx)(nn,{type:"spinner",size:"small",inline:!0,color:"#ffffff",text:"Saving"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("svg",Cl({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},{children:(0,a.jsx)("path",{d:"M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022Z"})})),hn.length>0?(0,a.jsxs)(a.Fragment,{children:["Save ",lt.length-hn.length," Remaining Cards",(0,a.jsxs)("span",Cl({style:{fontSize:"12px",backgroundColor:"rgba(255,255,255,0.25)",borderRadius:"4px",padding:"1px 6px",marginLeft:"4px"}},{children:[hn.length," saved"]}))]}):(0,a.jsxs)(a.Fragment,{children:["Save All Cards (",lt.length,")"]})]})}))]}),(0,a.jsx)(ln,{mode:S,front:p,translation:c,examples:u,imageUrl:f,image:d,linguisticInfo:y,transcription:x,onNewImage:Cn,onNewExamples:En,onAccept:Fn,onViewSavedCards:Tn,onCancel:Rn,loadingNewImage:P,loadingNewExamples:L,loadingAccept:D,loadingGetResult:T,shouldGenerateImage:ee,isSaved:xn,isEdited:$,isGeneratingCard:Pr,setTranslation:wn,setExamples:Sn,setLinguisticInfo:Er})]}))})):null,cr&&Cr(),qn&&Xn(),Nt&&Tt.length>0&&(0,a.jsx)("div",Cl({style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.8)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px",animation:"fadeIn 0.3s ease-out"}},{children:(0,a.jsxs)("div",Cl({style:{backgroundColor:"#ffffff",borderRadius:"8px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",maxWidth:"640px",width:"100%",maxHeight:"90vh",overflow:"hidden",display:"flex",flexDirection:"column",border:"1px solid #EAEAEA",animation:"slideUp 0.4s ease-out"}},{children:[(0,a.jsx)("div",Cl({style:{padding:"20px 24px 16px 24px",borderBottom:"1px solid #EAEAEA"}},{children:(0,a.jsxs)("div",Cl({style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",Cl({style:{margin:0,fontSize:"18px",fontWeight:"600",color:"#000000",letterSpacing:"-0.025em"}},{children:"Review Cards"})),(0,a.jsxs)("p",Cl({style:{margin:"4px 0 0 0",fontSize:"14px",color:"#666666",fontWeight:"400"}},{children:[Tt.length," cards generated by AI"]}))]}),(0,a.jsx)("button",Cl({onClick:jr,style:{background:"none",border:"none",fontSize:"16px",color:"#999999",cursor:"pointer",padding:"6px",borderRadius:"4px",transition:"all 0.15s ease"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#F5F5F5",e.currentTarget.style.color="#666666"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="#999999"}},{children:(0,a.jsx)(Zt,{})}))]}))})),Tt.length>1&&(0,a.jsx)("div",Cl({style:{padding:"12px 24px",backgroundColor:"#FAFAFA",borderBottom:"1px solid #EAEAEA",display:"flex",alignItems:"center",justifyContent:"center"}},{children:(0,a.jsxs)("div",Cl({style:{display:"flex",alignItems:"center",gap:"12px"}},{children:[(0,a.jsx)("button",Cl({onClick:function(){Ht>0&&Kt(Ht-1)},disabled:0===Ht,style:{backgroundColor:"transparent",color:0===Ht?"#CCCCCC":"#666666",border:"1px solid ".concat(0===Ht?"#EAEAEA":"#DDDDD"),borderRadius:"6px",padding:"6px 10px",fontSize:"13px",fontWeight:"500",cursor:0===Ht?"not-allowed":"pointer",transition:"all 0.15s ease",display:"flex",alignItems:"center",gap:"4px"},onMouseOver:function(e){0!==Ht&&(e.currentTarget.style.borderColor="#999999",e.currentTarget.style.color="#333333")},onMouseOut:function(e){0!==Ht&&(e.currentTarget.style.borderColor="#DDDDDD",e.currentTarget.style.color="#666666")}},{children:"←"})),(0,a.jsxs)("div",Cl({style:{fontSize:"13px",color:"#666666",fontWeight:"500",padding:"0 8px"}},{children:[Ht+1," of ",Tt.length]})),(0,a.jsx)("button",Cl({onClick:function(){Ht<Tt.length-1&&Kt(Ht+1)},disabled:Ht===Tt.length-1,style:{backgroundColor:"transparent",color:Ht===Tt.length-1?"#CCCCCC":"#666666",border:"1px solid ".concat(Ht===Tt.length-1?"#EAEAEA":"#DDDDDD"),borderRadius:"6px",padding:"6px 10px",fontSize:"13px",fontWeight:"500",cursor:Ht===Tt.length-1?"not-allowed":"pointer",transition:"all 0.15s ease",display:"flex",alignItems:"center",gap:"4px"},onMouseOver:function(e){Ht!==Tt.length-1&&(e.currentTarget.style.borderColor="#999999",e.currentTarget.style.color="#333333")},onMouseOut:function(e){Ht!==Tt.length-1&&(e.currentTarget.style.borderColor="#DDDDDD",e.currentTarget.style.color="#666666")}},{children:"→"}))]}))})),(0,a.jsx)("div",Cl({style:{flex:1,overflow:"auto",padding:"16px",backgroundColor:"#ffffff"}},{children:Tt[Ht]&&(0,a.jsx)("div",Cl({style:{animation:"slideIn 0.3s ease-out"}},{children:(0,a.jsx)(ln,{front:Tt[Ht].front||null,back:Tt[Ht].back||null,translation:null,examples:[],imageUrl:Tt[Ht].imageUrl||null,image:Tt[Ht].image||null,linguisticInfo:"",transcription:null,onNewImage:function(){},onNewExamples:function(){},onAccept:Or,onViewSavedCards:function(){},loadingNewImage:!1,loadingNewExamples:!1,loadingAccept:D,mode:_.GeneralTopic,shouldGenerateImage:!1,isSaved:Xt.has(Ht),isEdited:!1,isGeneratingCard:!1,hideActionButtons:!0,setBack:function(e){var t=Il([],Tt,!0);t[Ht]=Cl(Cl({},t[Ht]),{back:e}),jt(t)}})}))})),(0,a.jsxs)("div",Cl({style:{padding:"16px 20px",borderTop:"1px solid #EAEAEA",backgroundColor:"#FAFAFA",display:"flex",flexDirection:"column",gap:"12px"}},{children:[(0,a.jsxs)("div",Cl({style:{display:"flex",justifyContent:"center",gap:"8px"}},{children:[(0,a.jsx)("button",Cl({onClick:Or,disabled:D||Xt.has(Ht),style:{backgroundColor:Xt.has(Ht)?"#10B981":"#ffffff",color:Xt.has(Ht)?"#ffffff":"#374151",border:"1px solid ".concat(Xt.has(Ht)?"#10B981":"#D1D5DB"),borderRadius:"6px",padding:"8px 16px",fontSize:"14px",fontWeight:"500",cursor:D||Xt.has(Ht)?"not-allowed":"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"6px",minWidth:"100px",justifyContent:"center",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",opacity:D||Xt.has(Ht)?.7:1},onMouseOver:function(e){D||Xt.has(Ht)||(e.currentTarget.style.borderColor="#9CA3AF",e.currentTarget.style.boxShadow="0 4px 6px -1px rgba(0, 0, 0, 0.1)")},onMouseOut:function(e){D||Xt.has(Ht)||(e.currentTarget.style.borderColor="#D1D5DB",e.currentTarget.style.boxShadow="0 1px 2px 0 rgba(0, 0, 0, 0.05)")}},{children:Xt.has(Ht)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(_t,{size:14}),"Saved"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Qt,{size:14}),"Save"]})})),(0,a.jsxs)("button",Cl({onClick:function(){on(!0),cn("")},disabled:D,style:{backgroundColor:"#ffffff",color:"#F59E0B",border:"1px solid #F59E0B",borderRadius:"6px",padding:"8px 16px",fontSize:"14px",fontWeight:"500",cursor:D?"not-allowed":"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"6px",minWidth:"100px",justifyContent:"center",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",opacity:D?.7:1},onMouseOver:function(e){D||(e.currentTarget.style.backgroundColor="#F59E0B",e.currentTarget.style.color="#ffffff",e.currentTarget.style.boxShadow="0 4px 6px -1px rgba(0, 0, 0, 0.1)")},onMouseOut:function(e){D||(e.currentTarget.style.backgroundColor="#ffffff",e.currentTarget.style.color="#F59E0B",e.currentTarget.style.boxShadow="0 1px 2px 0 rgba(0, 0, 0, 0.05)")}},{children:[(0,a.jsx)(Lt,{size:14}),"Improve"]}))]})),(0,a.jsxs)("div",Cl({style:{display:"flex",justifyContent:"center",gap:"8px"}},{children:[(0,a.jsx)("button",Cl({onClick:jr,disabled:D,style:{backgroundColor:"#ffffff",color:"#6B7280",border:"1px solid #D1D5DB",borderRadius:"6px",padding:"8px 16px",fontSize:"14px",fontWeight:"500",cursor:D?"not-allowed":"pointer",transition:"all 0.2s ease",minWidth:"100px",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",opacity:D?.7:1},onMouseOver:function(e){D||(e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.boxShadow="0 4px 6px -1px rgba(0, 0, 0, 0.1)")},onMouseOut:function(e){D||(e.currentTarget.style.backgroundColor="#ffffff",e.currentTarget.style.boxShadow="0 1px 2px 0 rgba(0, 0, 0, 0.05)")}},{children:"Cancel"})),(0,a.jsx)("button",Cl({onClick:function(){return El(void 0,void 0,void 0,(function(){var e,t,n;return kl(this,(function(r){M(!0);try{for(e=0,t=Tt;e<t.length;e++)n=t[e],i(Ee(n));zt(!1),jt([]),Kt(0),i(Ie(""))}catch(e){console.error("Error saving preview cards:",e),he("Error saving cards","error")}finally{M(!1)}return[2]}))}))},disabled:D,style:{backgroundColor:D?"#9CA3AF":"#3B82F6",color:"#ffffff",border:"none",borderRadius:"6px",padding:"8px 20px",fontSize:"14px",fontWeight:"600",cursor:D?"not-allowed":"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"6px",minWidth:"140px",justifyContent:"center",boxShadow:"0 4px 6px -1px rgba(59, 130, 246, 0.3)",opacity:D?.7:1},onMouseOver:function(e){D||(e.currentTarget.style.backgroundColor="#2563EB",e.currentTarget.style.boxShadow="0 6px 10px -1px rgba(59, 130, 246, 0.4)",e.currentTarget.style.transform="translateY(-1px)")},onMouseOut:function(e){D||(e.currentTarget.style.backgroundColor="#3B82F6",e.currentTarget.style.boxShadow="0 4px 6px -1px rgba(59, 130, 246, 0.3)",e.currentTarget.style.transform="translateY(0)")}},{children:D?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(nn,{type:"spinner",size:"small",inline:!0,color:"#ffffff"}),"Saving..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(_t,{size:14}),"Save All (",Tt.length,")"]})}))]}))]}))]}))})),rn&&(0,a.jsx)("div",Cl({style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:1e4,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"}},{children:(0,a.jsxs)("div",Cl({style:{backgroundColor:"#ffffff",borderRadius:"8px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",maxWidth:"520px",width:"100%",maxHeight:"80vh",overflow:"hidden",display:"flex",flexDirection:"column",border:"1px solid #EAEAEA"}},{children:[(0,a.jsx)("div",Cl({style:{padding:"20px 24px 16px 24px",borderBottom:"1px solid #EAEAEA"}},{children:(0,a.jsxs)("div",Cl({style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",Cl({style:{margin:0,fontSize:"18px",fontWeight:"600",color:"#000000",letterSpacing:"-0.025em"}},{children:"Improve Card"})),(0,a.jsx)("p",Cl({style:{margin:"4px 0 0 0",fontSize:"14px",color:"#666666",fontWeight:"400"}},{children:"Provide feedback to create a better version"}))]}),(0,a.jsx)("button",Cl({onClick:function(){return on(!1)},style:{background:"none",border:"none",fontSize:"16px",color:"#999999",cursor:"pointer",padding:"6px",borderRadius:"4px",transition:"all 0.15s ease"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#F5F5F5",e.currentTarget.style.color="#666666"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="#999999"}},{children:(0,a.jsx)(Zt,{})}))]}))})),(0,a.jsxs)("div",Cl({style:{padding:"24px",flex:1,overflow:"auto"}},{children:[(0,a.jsx)("textarea",{value:sn,onChange:function(e){return cn(e.target.value)},placeholder:"Example: Make the question more specific, simplify the answer, add more context, focus on practical examples...",style:{width:"100%",minHeight:"140px",padding:"16px",borderRadius:"6px",border:"1px solid #EAEAEA",backgroundColor:"#FAFAFA",fontSize:"14px",lineHeight:"1.6",resize:"vertical",fontFamily:"inherit",outline:"none",transition:"all 0.15s ease"},onFocus:function(e){e.currentTarget.style.borderColor="#0070F3",e.currentTarget.style.backgroundColor="#ffffff"},onBlur:function(e){e.currentTarget.style.borderColor="#EAEAEA",e.currentTarget.style.backgroundColor="#FAFAFA"}}),(0,a.jsx)("div",Cl({style:{marginTop:"16px",padding:"12px 16px",backgroundColor:"#F9F9F9",borderRadius:"6px",border:"1px solid #EAEAEA"}},{children:(0,a.jsxs)("div",Cl({style:{display:"flex",alignItems:"flex-start",gap:"8px",fontSize:"13px",color:"#666666",lineHeight:"1.5"}},{children:[(0,a.jsx)(Vt,{size:14,style:{color:"#999999",marginTop:"1px"}}),(0,a.jsx)("span",{children:"Be specific about what you want to change for better results"})]}))}))]})),(0,a.jsxs)("div",Cl({style:{padding:"20px 24px",borderTop:"1px solid #EAEAEA",backgroundColor:"#FAFAFA",display:"flex",justifyContent:"flex-end",gap:"8px"}},{children:[(0,a.jsx)("button",Cl({onClick:function(){return on(!1)},style:{backgroundColor:"transparent",color:"#999999",border:"none",padding:"8px 12px",fontSize:"13px",fontWeight:"500",cursor:"pointer",transition:"all 0.15s ease",borderRadius:"5px"},onMouseOver:function(e){e.currentTarget.style.color="#666666",e.currentTarget.style.backgroundColor="#F5F5F5"},onMouseOut:function(e){e.currentTarget.style.color="#999999",e.currentTarget.style.backgroundColor="transparent"}},{children:"Cancel"})),(0,a.jsx)("button",Cl({onClick:function(){return El(void 0,void 0,void 0,(function(){var e,t,n,r,o,a,i,s,c,u,d,f;return kl(this,(function(p){switch(p.label){case 0:on(!1),M(!0),p.label=1;case 1:if(p.trys.push([1,7,8,9]),!(e=Tt[Ht]))return he("No card to recreate","error"),[2];t=vl(fn,pn),n="Please recreate this card with improvements. Original card:\nQuestion: ".concat(e.front,"\nAnswer: ").concat(e.back,"\nOriginal text: ").concat(l),sn.trim()&&(n+="\n\nUser feedback: ".concat(sn.trim())),n+="\n\nPlease create an improved version based on the feedback.",r=void 0,p.label=2;case 2:return p.trys.push([2,4,,5]),o=window.getSelection(),a=void 0,o&&o.rangeCount>0&&(i=o.getRangeAt(0),a=i.commonAncestorContainer.nodeType===Node.ELEMENT_NODE?i.commonAncestorContainer:i.commonAncestorContainer.parentElement||void 0),[4,Sl.extractPageContentAsync(l,a)];case 3:return r=p.sent(),[3,5];case 4:return s=p.sent(),console.warn("Failed to extract page content for recreation:",s),r=void 0,[3,5];case 5:return[4,t.createCardsFromText(n,r)];case 6:return(c=p.sent()).length>0?((u=Il([],Tt,!0))[Ht]=c[0],jt(u),en((function(e){var t=new Set(e);return t.delete(Ht),t}))):he("Failed to recreate card","error"),[3,9];case 7:return d=p.sent(),console.error("Error recreating card:",d),f=d instanceof Error?d.message:"Unknown error",he("Card recreation error: ".concat(f),"error"),[3,9];case 8:return M(!1),cn(""),[7];case 9:return[2]}}))}))},disabled:D,style:{backgroundColor:D?"#F5F5F5":"#000000",color:D?"#999999":"#ffffff",border:"none",borderRadius:"5px",padding:"8px 16px",fontSize:"13px",fontWeight:"500",cursor:D?"not-allowed":"pointer",transition:"all 0.15s ease",display:"flex",alignItems:"center",gap:"6px",opacity:D?.6:1},onMouseOver:function(e){D||(e.currentTarget.style.backgroundColor="#333333")},onMouseOut:function(e){D||(e.currentTarget.style.backgroundColor="#000000")}},{children:D?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(nn,{type:"spinner",size:"small",inline:!0,color:"#999999"}),"Improving..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Lt,{size:11}),"Improve Card"]})}))]}))]}))})),(0,a.jsx)("div",Cl({style:{position:"absolute",top:"16px",right:"16px",zIndex:9999,pointerEvents:"none"}},{children:(0,a.jsx)("div",Cl({style:{pointerEvents:"auto"}},{children:me()}))}))]}))},_l=n.p+"assets/img/chat-gpt39f424be38a6852eb2c5.png",Fl=n.p+"assets/img/copy-iconb2b0ec637a2b0fd4ca40.svg";var Tl=function(){return Tl=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Tl.apply(this,arguments)},jl=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},Ol=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}};const Pl=function(e){e.onBackClick,e.popup;var t=k(),n=(0,r.useState)(null),o=n[0],i=n[1],s=m((function(e){return e.settings.openAiKey})),l=(m((function(e){return e.settings.ankiConnectUrl})),m((function(e){return e.settings.ankiConnectApiKey}))),c=m((function(e){return e.settings.groqApiKey})),u=m((function(e){return e.settings.groqModelName})),d=m((function(e){return e.settings.modelProvider})),f=function(e){t(function(e){return{type:tt,payload:e}}(e.target.value))},p=function(e){t(function(e){return{type:ht,payload:e}}(e.target.value))},g=function(e){var n;t((n=e.target.value,{type:mt,payload:n}))},h=chrome.runtime.getURL(_l),y=chrome.runtime.getURL(Fl),x=function(e){return jl(void 0,void 0,void 0,(function(){var t,n,r,o,a,l,d,f;return Ol(this,(function(p){switch(p.label){case 0:i(null),p.label=1;case 1:switch(p.trys.push([1,4,,5]),t="",n={},r={},o="",e){case zs.OpenAI:t="https://api.openai.com/v1/chat/completions",n={"Content-Type":"application/json",Authorization:"Bearer ".concat(o=s)},r={model:"gpt-3.5-turbo",messages:[{role:"user",content:"Say hello"}],max_tokens:10};break;case zs.Groq:t="https://api.groq.com/openai/v1/chat/completions",n={"Content-Type":"application/json",Authorization:"Bearer ".concat(o=c)},r={model:u,messages:[{role:"user",content:"Say hello"}],max_tokens:10}}return o.trim()?[4,fetch(t,{method:"POST",headers:n,body:JSON.stringify(r)})]:(i({success:!1,message:"API key is missing. Please enter your API key."}),[2]);case 2:return[4,(a=p.sent()).json()];case 3:return l=p.sent(),a.ok?(console.log("API test response:",l),i({success:!0,message:"Connection successful! API is working properly."})):(console.error("API test error:",l),i({success:!1,message:"Error: ".concat((null===(f=l.error)||void 0===f?void 0:f.message)||"Unknown error occurred")})),[3,5];case 4:return d=p.sent(),console.error("API connection test error:",d),i({success:!1,message:"Error: ".concat(d instanceof Error?d.message:"Unknown error occurred")}),[3,5];case 5:return[2]}}))}))},v=function(){return o?(0,a.jsx)("div",Tl({style:{padding:"10px",marginTop:"10px",borderRadius:"6px",backgroundColor:o.success?"#ECFDF5":"#FEF2F2",color:o.success?"#065F46":"#B91C1C",fontSize:"14px",borderLeft:"4px solid ".concat(o.success?"#10B981":"#EF4444")}},{children:o.message})):null};return(0,a.jsxs)("div",Tl({style:{padding:"12px",backgroundColor:"#ffffff",height:"100%",width:"100%",maxWidth:"320px",margin:"0 auto",overflowY:"auto",paddingBottom:"16px",marginTop:"20px"}},{children:[(0,a.jsxs)("div",Tl({style:{marginBottom:"20px",backgroundColor:"#F9FAFB",padding:"12px",borderRadius:"8px"}},{children:[(0,a.jsx)("label",Tl({htmlFor:"modelProvider",style:{display:"block",fontWeight:"600",marginBottom:"8px",color:"#111827",fontSize:"14px"}},{children:"AI Provider"})),(0,a.jsx)("p",Tl({style:{fontSize:"12px",marginBottom:"8px",color:"#6B7280"}},{children:"Select which provider to use for generating flashcards"})),(0,a.jsxs)("select",Tl({id:"modelProvider",value:d,onChange:function(e){var n;t((n=e.target.value,{type:gt,payload:n})),i(null)},style:{width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"13px",outline:"none",transition:"all 0.2s ease",cursor:"pointer"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}},{children:[(0,a.jsx)("option",Tl({value:zs.OpenAI},{children:"OpenAI"})),(0,a.jsx)("option",Tl({value:zs.Groq},{children:"Groq"}))]}))]})),(0,a.jsxs)("div",{children:[d!==zs.OpenAI?null:(0,a.jsxs)("div",Tl({style:{marginBottom:"20px"}},{children:[(0,a.jsxs)("div",Tl({style:{display:"flex",alignItems:"center",marginBottom:"8px"}},{children:[(0,a.jsx)("label",Tl({htmlFor:"openAiKey",style:{display:"block",fontWeight:"600",marginBottom:"0",marginRight:"8px",color:"#111827",fontSize:"14px"}},{children:"OpenAI API Key"})),(0,a.jsx)("img",{src:h,alt:"ChatGPT Logo",style:{width:"16px",height:"16px",marginTop:"-2px"}})]})),(0,a.jsxs)("p",Tl({style:{fontSize:"12px",marginBottom:"6px",color:"#6B7280"}},{children:["You can get your OpenAI API key from ",(0,a.jsx)("a",Tl({href:"https://platform.openai.com/account/api-keys",target:"_blank",rel:"noopener noreferrer",style:{color:"#2563EB",textDecoration:"underline"}},{children:"here"})),"."]})),(0,a.jsx)("div",Tl({style:{position:"relative",marginBottom:"16px"}},{children:(0,a.jsx)("input",{type:"text",id:"openAiKey",value:s,onChange:f,style:{width:"100%",padding:"8px 10px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"13px",outline:"none",transition:"all 0.2s ease"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}})})),(0,a.jsx)("button",Tl({onClick:function(){return x(zs.OpenAI)},style:{marginTop:"8px",padding:"6px 12px",backgroundColor:"#10a37f",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px"}},{children:"Test API Connection"})),v()]})),d!==zs.Groq?null:(0,a.jsxs)("div",Tl({style:{marginBottom:"20px"}},{children:[(0,a.jsx)("label",Tl({htmlFor:"groqApiKey",style:{display:"block",fontWeight:"600",marginBottom:"8px",color:"#111827",fontSize:"14px"}},{children:"Groq API Key"})),(0,a.jsxs)("p",Tl({style:{fontSize:"12px",marginBottom:"8px",color:"#6B7280"}},{children:["You can get your Groq API key from ",(0,a.jsx)("a",Tl({href:"https://console.groq.com/keys",target:"_blank",rel:"noopener noreferrer",style:{color:"#2563EB",textDecoration:"underline"}},{children:"here"})),"."]})),(0,a.jsx)("input",{type:"text",id:"groqApiKey",value:c,onChange:p,style:{width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"13px",outline:"none",transition:"all 0.2s ease",marginBottom:"16px"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}}),(0,a.jsx)("div",Tl({style:{padding:"8px",backgroundColor:"#DBEAFE",borderRadius:"6px",marginBottom:"16px"}},{children:(0,a.jsxs)("p",Tl({style:{fontSize:"12px",color:"#1E40AF",margin:0}},{children:[(0,a.jsx)("strong",{children:"Note:"})," Image generation is not available with Groq."]}))})),(0,a.jsx)("label",Tl({htmlFor:"groqModelName",style:{display:"block",fontWeight:"600",marginBottom:"8px",color:"#111827",fontSize:"14px"}},{children:"Groq Model"})),(0,a.jsxs)("select",Tl({id:"groqModelName",value:u,onChange:g,style:{width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"13px",outline:"none",transition:"all 0.2s ease",cursor:"pointer",marginBottom:"16px"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}},{children:[(0,a.jsx)("option",Tl({value:"llama3-8b-8192"},{children:"Llama-3 8B"})),(0,a.jsx)("option",Tl({value:"llama3-70b-8192"},{children:"Llama-3 70B"})),(0,a.jsx)("option",Tl({value:"mixtral-8x7b-32768"},{children:"Mixtral 8x7B"})),(0,a.jsx)("option",Tl({value:"gemma-7b-it"},{children:"Gemma 7B"}))]})),(0,a.jsx)("button",Tl({onClick:function(){return x(zs.Groq)},style:{marginTop:"8px",padding:"6px 12px",backgroundColor:"#7c3aed",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px"}},{children:"Test API Connection"})),v()]})),(0,a.jsx)("div",{style:{marginBottom:"20px"}})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",Tl({htmlFor:"ankiConnectApiKey",style:{display:"block",fontWeight:"600",marginBottom:"8px",color:"#111827",fontSize:"14px"}},{children:"AnkiConnect API Key (optional)"})),(0,a.jsx)("input",{type:"text",id:"ankiConnectApiKey",value:null!==l?l:"",onChange:function(e){var n;t((n=e.target.value,{type:at,payload:n}))},style:{width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"13px",outline:"none",transition:"all 0.2s ease",marginBottom:"20px"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",Tl({style:{fontSize:"13px",marginBottom:"8px",color:"#6B7280"}},{children:["Install the Anki plugin ",(0,a.jsx)("strong",{children:"AnkiConnect"})," and configure it as follows:"]})),(0,a.jsxs)("ul",Tl({style:{fontSize:"13px",listStyle:"disc",paddingLeft:"20px",marginBottom:"8px",color:"#6B7280"}},{children:[(0,a.jsxs)("li",Tl({style:{marginBottom:"4px"}},{children:["Go to ",(0,a.jsx)("strong",{children:"Tools"})," then ",(0,a.jsx)("strong",{children:"Add-ons"})," then ",(0,a.jsx)("strong",{children:"Get Add-ons..."})]})),(0,a.jsxs)("li",Tl({style:{marginBottom:"4px",display:"flex",alignItems:"center"}},{children:["Paste Code  ",(0,a.jsxs)("button",Tl({onClick:function(){return navigator.clipboard.writeText("2055492159")},style:{display:"flex",alignItems:"center",backgroundColor:"#F3F4F6",padding:"4px 6px",borderRadius:"4px",color:"#2563EB",transition:"all 0.2s ease",border:"none",cursor:"pointer"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="#E5E7EB"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="#F3F4F6"}},{children:[(0,a.jsx)("img",{src:y,alt:"Copy Icon",style:{width:"16px",height:"16px",marginRight:"4px"}}),(0,a.jsx)("code",Tl({style:{backgroundColor:"transparent",fontSize:"12px"}},{children:"2055492159"}))]}))]})),(0,a.jsxs)("li",Tl({style:{marginBottom:"4px"}},{children:["Then click ",(0,a.jsx)("strong",{children:"OK"})]})),(0,a.jsx)("li",Tl({style:{marginBottom:"4px"}},{children:"Restart Anki"})),(0,a.jsxs)("li",Tl({style:{marginBottom:"4px"}},{children:["Navigate to ",(0,a.jsx)("strong",{children:"Tools"})," > ",(0,a.jsx)("strong",{children:"Add-ons"})," > ",(0,a.jsx)("strong",{children:"AnkiConnect"})," >",(0,a.jsx)("strong",{children:"Config"})]}))]})),(0,a.jsxs)("div",Tl({style:{position:"relative",backgroundColor:"#F9FAFB",padding:"12px",borderRadius:"6px",marginBottom:"20px"}},{children:[(0,a.jsxs)("p",Tl({style:{fontSize:"13px",marginBottom:"8px",color:"#6B7280"}},{children:["Copy paste the following config, you can change the ",(0,a.jsx)("code",{children:"apiKey"}),":"]})),(0,a.jsx)("pre",Tl({style:{display:"block",overflow:"auto",padding:"10px",backgroundColor:"#F3F4F6",borderRadius:"4px",whiteSpace:"pre-wrap",cursor:"pointer",fontSize:"12px",color:"#374151",margin:0},onClick:function(){return navigator.clipboard.writeText(JSON.stringify({apiKey:l||"your_api_key",webCorsOriginList:["http://localhost","*"],webBindPort:8765},null,2))},title:"Click to copy"},{children:JSON.stringify({apiKey:l||"your_api_key",webCorsOriginList:["http://localhost","*"],webBindPort:8765},null,2)})),(0,a.jsx)("button",Tl({onClick:function(){return navigator.clipboard.writeText(JSON.stringify({apiKey:l||"your_api_key",webCorsOriginList:["http://localhost","*"],webBindPort:8765},null,2))},style:{position:"absolute",top:"8px",right:"8px",background:"transparent",border:"none",cursor:"pointer",padding:"4px"},title:"Copy to clipboard"},{children:(0,a.jsx)("img",{src:y,alt:"Copy Icon",style:{width:"16px",height:"16px"}})}))]}))]})]}))};var Rl="FETCH_DECKS_SUCCESS",Nl="SET_DECK_ID",Ll=function(e){return{type:Nl,payload:e}},Bl=function(){return Bl=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Bl.apply(this,arguments)},zl=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},Dl=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},Ml=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))};const Ul=function(e){e.onBackClick;var t=k(),n=Ue(),o=n.storedCards,i=m((function(e){return e.deck.deckId})),s=m((function(e){return e.deck.decks})),l=m((function(e){return e.settings.useAnkiConnect})),c=m((function(e){return e.settings.ankiConnectUrl})),u=m((function(e){return e.settings.ankiConnectApiKey})),d=m((function(e){return e.settings.openAiKey})),f=m((function(e){return e.settings.imageInstructions})),p=m((function(e){return e.cards})),g=(0,r.useState)([]),h=g[0],y=g[1],x=(0,r.useState)(!1),v=x[0],b=x[1],w=(0,r.useState)(!1),S=w[0],C=w[1],E=(0,r.useState)("not_exported"),I=E[0],A=E[1],F=(0,r.useState)(!1),T=F[0],j=F[1],O=(0,r.useState)(null),P=O[0],R=O[1],N=(0,r.useState)(!1),L=N[0],B=N[1],z=(0,r.useState)(!1),D=(z[0],z[1]),M=(0,r.useState)(""),U=M[0],$=M[1],W=(0,r.useState)(!1),V=W[0],q=W[1],G=(0,r.useState)(null),H=G[0],K=G[1],Y=(0,r.useState)(!1),Q=Y[0],J=Y[1],X=(0,r.useState)(!1),Z=X[0],ee=X[1],te=(0,r.useState)(1),re=te[0],oe=te[1],ae=(0,r.useState)(10),ie=ae[0],se=ae[1],le=(0,r.useState)(1),ce=le[0],ue=le[1],de=(0,r.useState)(!1),fe=de[0],pe=de[1],ge=(0,r.useState)("anki_cards"),he=ge[0],me=ge[1],ye=(0,r.useState)(!1),xe=ye[0],ve=ye[1],be=As(),we=be.showError,Se=be.renderErrorNotification;new Ss({apiKey:d,dangerouslyAllowBrowser:!0});(0,r.useEffect)((function(){zl(void 0,void 0,void 0,(function(){var e,n,r;return Dl(this,(function(a){console.log("StoredCards component mounted, forcing complete reload of cards...");try{if(e=localStorage.getItem("anki_stored_cards"))try{n=JSON.parse(e),console.log("Direct from localStorage, found cards:",n.length)}catch(e){console.error("Failed to parse localStorage data directly:",e)}else console.log("No cards found directly in localStorage")}catch(e){console.error("Error accessing localStorage directly:",e)}return t(ke()),r=setTimeout((function(){if(console.log("Current stored cards after initial load:",o.length),0===o.length){console.log("No cards loaded, trying to load directly from localStorage...");try{var e=localStorage.getItem("anki_stored_cards");if(e){var n=JSON.parse(e);Array.isArray(n)&&n.length>0&&(console.log("Found cards directly in localStorage, manually setting in Redux..."),t({type:"SET_STORED_CARDS",payload:n}))}}catch(e){console.error("Failed to manually load cards:",e)}}if(o.length>0){var r=o.filter((function(e){return"not_exported"===e.exportStatus})).length,a=o.filter((function(e){return"exported_to_anki"===e.exportStatus||"exported_to_file"===e.exportStatus})).length;console.log("Card stats: total=",o.length,"not_exported=",r,"exported=",a),o.forEach((function(e,t){var n,r,o,a;(e.image||e.imageUrl)&&console.log("Card ".concat(t," (").concat(e.id,") has images:"),{hasImage:!!e.image,hasImageUrl:!!e.imageUrl,imageType:typeof e.image,imageUrlType:typeof e.imageUrl,imageLength:null===(n=e.image)||void 0===n?void 0:n.length,imageUrlLength:null===(r=e.imageUrl)||void 0===r?void 0:r.length,imageStart:null===(o=e.image)||void 0===o?void 0:o.substring(0,30),imageUrlStart:null===(a=e.imageUrl)||void 0===a?void 0:a.substring(0,30)})}))}}),500),[2,function(){return clearTimeout(r)}]}))}))}),[t,o.length]),(0,r.useEffect)((function(){console.log("Stored cards updated:",o)}),[o]);var Ee=function(){return zl(void 0,void 0,void 0,(function(){var e,n;return Dl(this,(function(r){switch(r.label){case 0:if(!l)return[2];r.label=1;case 1:return r.trys.push([1,3,4,5]),C(!0),[4,ne(u)];case 2:return(e=r.sent()).result&&(t({type:"FETCH_DECKS_SUCCESS",payload:e.result}),!i&&e.result.length>0&&t(Ll(e.result[0].deckId))),[3,5];case 3:return n=r.sent(),console.error("Error loading decks:",n),l&&we("Failed to load Anki decks. Make sure Anki is running with AnkiConnect plugin."),[3,5];case 4:return C(!1),[7];case 5:return[2]}}))}))};(0,r.useEffect)((function(){l&&0===s.length&&Ee()}),[l]);var Ie=function(){if(console.log("All cards in store:",o.length,"cards"),!Array.isArray(o)||0===o.length)return console.log("No cards to filter"),[];var e,t={not_exported:0,exported_to_anki:0,exported_to_file:0,unknown:0};switch(o.forEach((function(e){"not_exported"===e.exportStatus?t.not_exported++:"exported_to_anki"===e.exportStatus?t.exported_to_anki++:"exported_to_file"===e.exportStatus?t.exported_to_file++:t.unknown++})),console.log("Card status counts:",t),I){case"not_exported":e=o.filter((function(e){return"not_exported"===e.exportStatus})),console.log("Filtered to not_exported cards:",e.length);break;case"exported":e=o.filter((function(e){return"exported_to_anki"===e.exportStatus||"exported_to_file"===e.exportStatus})),console.log("Filtered to exported cards:",e.length);break;default:e=Ml([],o,!0),console.log("Using all cards:",e.length)}var n=e.sort((function(e,t){return new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()}));return console.log("Final filtered and sorted cards:",n.length),n}(),Ae=function(){if(0===Ie.length)return[];var e=(re-1)*ie,t=e+ie;return e>=Ie.length?(oe(1),Ie.slice(0,ie)):(console.log("Pagination debug:",{totalCards:o.length,filteredCards:Ie.length,currentPage:re,itemsPerPage:ie,startIndex:e,endIndex:t,cardsOnThisPage:Ie.slice(e,t).length}),Ie.slice(e,t))}();(0,r.useEffect)((function(){var e=Math.max(1,Math.ceil(Ie.length/ie));ue(e),re>e&&oe(1)}),[Ie.length,ie]);var _e={all:o.length,not_exported:o.filter((function(e){return"not_exported"===e.exportStatus})).length,exported:o.filter((function(e){return"exported_to_anki"===e.exportStatus||"exported_to_file"===e.exportStatus})).length},Fe=function(e){var t=new Date(e),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),o=String(t.getHours()).padStart(2,"0"),a=String(t.getMinutes()).padStart(2,"0");return"".concat(r,"/").concat(n," ").concat(o,":").concat(a)},Te=function(e){switch(e){case"exported_to_anki":return(0,a.jsx)("span",Bl({style:{fontSize:"11px",color:"#10B981",marginLeft:"8px"}},{children:"✓ Anki"}));case"exported_to_file":return(0,a.jsx)("span",Bl({style:{fontSize:"11px",color:"#2563EB",marginLeft:"8px"}},{children:"✓ File"}));default:return null}},je=function(e){return P===e?null:(0,a.jsxs)("div",Bl({style:{padding:"8px"}},{children:[(e.text||e.front)&&(0,a.jsx)("p",Bl({style:{fontWeight:"bold",fontSize:"14px",marginBottom:"4px",color:"#111827",lineHeight:"1.4",wordWrap:"break-word"}},{children:e.mode===_.LanguageLearning?e.text:e.front})),(e.translation||e.back)&&(0,a.jsx)("div",Bl({style:{color:"#374151",fontSize:"13px",marginBottom:"8px",lineHeight:"1.4",wordWrap:"break-word"}},{children:e.mode===_.LanguageLearning?e.translation:e.back&&(0,a.jsx)("div",{dangerouslySetInnerHTML:{__html:(t=e.back.length>150?e.back.substring(0,150)+"...":e.back,n=t,n=(n=(n=(n=(n=n.replace(/!\[([^\]]*)\]\(([^)]+)\)/g,(function(e,t,n){var r=t&&"Изображение"!==t&&"Image"!==t?t:"";return'<div style="text-align: center; margin: 6px 0;">\n            <img src="'.concat(n,'" alt="').concat(r,'" style="max-width: 100%; max-height: 120px; height: auto; border-radius: 3px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); display: block; margin: 0 auto;" />\n            ').concat(r?'<div style="font-size: 9px; color: #6B7280; margin-top: 2px; font-style: italic;">'.concat(r,"</div>"):"","\n        </div>")}))).replace(/\$\$([^$]+)\$\$/g,(function(e,t){return'<div style="text-align: center; margin: 8px 0; padding: 6px; background: #F8FAFC; border-radius: 4px; font-family: serif; font-size: 12px;">\n            <strong>Формула:</strong> '.concat(t,"\n        </div>")}))).replace(/```(\w*)\n([\s\S]*?)\n```/g,(function(e,t,n){return'<div style="margin: 8px 0;">\n            <div style="background: #2D2D2D; color: #F8F8F2; padding: 8px; border-radius: 4px; font-family: monospace; overflow-x: auto; white-space: pre; font-size: 11px;">\n                '.concat(t?'<div style="color: #6B7280; margin-bottom: 4px; font-size: 9px;">'.concat(t,"</div>"):"","\n                ").concat(n,"\n            </div>\n        </div>")}))).replace(/`([^`]+)`/g,'<code style="background: #F3F4F6; padding: 1px 3px; border-radius: 2px; font-family: monospace; font-size: 11px;">$1</code>')).replace(/\n/g,"<br />"))}})})),e.mode===_.LanguageLearning&&e.examples&&e.examples.length>0&&(0,a.jsxs)("div",Bl({style:{marginTop:"8px"}},{children:[(0,a.jsx)("p",Bl({style:{fontSize:"12px",color:"#6B7280",marginBottom:"4px"}},{children:"Examples:"})),e.examples.slice(0,1).map((function(e,t){var n=e[0],r=e[1];return(0,a.jsxs)("div",Bl({style:{fontSize:"12px",marginBottom:"2px"}},{children:[(0,a.jsx)("p",Bl({style:{color:"#111827",marginBottom:"2px",lineHeight:"1.4",wordWrap:"break-word",overflow:"visible",whiteSpace:"normal"}},{children:n})),r&&(0,a.jsx)("p",Bl({style:{color:"#6B7280",fontStyle:"italic",lineHeight:"1.4",wordWrap:"break-word",overflow:"visible",whiteSpace:"normal"}},{children:r}))]}),t)})),e.examples.length>1&&(0,a.jsxs)("p",Bl({style:{fontSize:"11px",color:"#6B7280"}},{children:["+",e.examples.length-1," more examples"]}))]})),(e.image||e.imageUrl)&&(0,a.jsx)("div",Bl({style:{marginTop:"8px",textAlign:"center"}},{children:(0,a.jsx)("img",{src:e.image||e.imageUrl||"",alt:"Card image",style:{maxWidth:"100%",maxHeight:"80px",borderRadius:"4px",border:"1px solid #E5E7EB",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"},onError:function(t){var n,r,o,a,i;console.error("Image failed to load for card:",e.id,"image data:",{hasImage:!!e.image,hasImageUrl:!!e.imageUrl,imageLength:null===(n=e.image)||void 0===n?void 0:n.length,imageUrlLength:null===(r=e.imageUrl)||void 0===r?void 0:r.length,imagePreview:null===(o=e.image)||void 0===o?void 0:o.substring(0,50),imageUrlPreview:null===(a=e.imageUrl)||void 0===a?void 0:a.substring(0,50),imageSrc:(e.image||e.imageUrl||"").substring(0,100),usingType:e.image?"base64 (permanent)":"url (temporary)"});var s=t.target;s.style.display="none";var l=document.createElement("div");l.style.cssText="\n                                    width: 100%;\n                                    height: 60px;\n                                    background-color: #F3F4F6;\n                                    border: 1px dashed #D1D5DB;\n                                    border-radius: 4px;\n                                    display: flex;\n                                    align-items: center;\n                                    justify-content: center;\n                                    color: #6B7280;\n                                    font-size: 12px;\n                                ",l.textContent=e.image?"🖼️ Image error":"🖼️ URL expired",null===(i=s.parentNode)||void 0===i||i.insertBefore(l,s.nextSibling)},onLoad:function(){var t,n;console.log("✅ Image loaded successfully for card:",e.id,{usingType:e.image?"base64 (permanent)":"url (temporary)",imageLength:null===(t=e.image)||void 0===t?void 0:t.length,imageUrlLength:null===(n=e.imageUrl)||void 0===n?void 0:n.length})}})})),(0,a.jsxs)("div",Bl({style:{marginTop:"8px",display:"flex",justifyContent:"space-between",alignItems:"center"}},{children:[(0,a.jsx)("span",Bl({style:{fontSize:"10px",color:"#6B7280",backgroundColor:e.mode===_.LanguageLearning?"#EEF2FF":"#F0FDF4",padding:"2px 6px",borderRadius:"12px",border:"1px solid ".concat(e.mode===_.LanguageLearning?"#C7D2FE":"#BBF7D0"),fontWeight:"500"}},{children:e.mode===_.LanguageLearning?"🗣️ Language":"📚 General"})),(0,a.jsx)("span",Bl({style:{fontSize:"10px",color:"#9CA3AF"}},{children:Fe(e.createdAt)}))]}))]}));var t,n},Oe=function(e){t(Ll(e.target.value))},Pe=function(){j((function(e){return!e}))},Re=function(e){console.log("Starting to edit card:",e.id),console.log("Card data:",e),R(e),K(Bl({},e)),B(!0),D(!0),$(""),q(!1),J(!1),ee(!1),console.log("Modal state set for editing card:",e.id)},Ne=function(){console.log("Canceling edit, resetting modal state..."),R(null),K(null),B(!1),D(!1),$(""),q(!1),J(!1),ee(!1),console.log("Edit canceled, modal should be hidden now.")},Le=function(){return zl(void 0,void 0,void 0,(function(){var e,t;return Dl(this,(function(r){if(!P||!H)return[2];try{if(ee(!0),(e=Bl(Bl({},P),{text:H.text||P.text||"",translation:H.translation||P.translation||"",examples:Array.isArray(H.examples)?H.examples:Array.isArray(P.examples)?P.examples:[],front:H.front||P.front||"",back:H.back||P.back||"",image:H.image||P.image||null,imageUrl:H.imageUrl||P.imageUrl||null,linguisticInfo:H.linguisticInfo||P.linguisticInfo||"",transcription:H.transcription||P.transcription||""})).mode===_.LanguageLearning){if(!e.text||!e.translation)return we("Please provide both text and translation"),[2];e.text=e.text.trim(),e.translation=e.translation.trim()}else{if(!e.front||!e.back)return we("Please provide both front and back content"),[2];e.front=e.front.trim(),e.back=(null===(t=e.back)||void 0===t?void 0:t.trim())||null}console.log("Final data being saved to Redux:",e),n.updateStoredCard(e),Ne()}catch(e){console.error("Error saving card:",e),we("Failed to update card. Please try again.")}finally{ee(!1)}return[2]}))}))},Be=function(){return zl(void 0,void 0,void 0,(function(){var e,t,n,r,o,a,i;return Dl(this,(function(s){switch(s.label){case 0:if(!P)return[2];s.label=1;case 1:if(s.trys.push([1,6,,7]),!d)throw new Error("OpenAI API key is not configured. Please add it in the settings.");return e=(null==H?void 0:H.text)||P.text,console.log("Starting image generation for text:",e),[4,Xe(d,e,f)];case 2:if(t=s.sent(),console.log("Description generated:",t),!t)throw new Error("Failed to generate image description");return n=f?"".concat(t,". ").concat(f):t,[4,fetch("https://api.openai.com/v1/images/generations",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(d)},body:JSON.stringify({prompt:n,n:1,size:"512x512",response_format:"url"})})];case 3:return[4,s.sent().json()];case 4:if(r=s.sent(),console.log("OpenAI direct API response:",r),!r.data||!r.data[0]||!r.data[0].url)throw new Error("OpenAI did not return an image URL");return o=r.data[0].url,console.log("Image URL generated:",o),[4,new Promise((function(e,t){chrome.runtime.sendMessage(o,(function(n){if(chrome.runtime.lastError)return console.error("Error sending message:",chrome.runtime.lastError),void t(chrome.runtime.lastError);console.log("Response from background script:",n),n&&n.status&&n.data?e(n.data):t(new Error("Failed to get image data from background script"))}))}))];case 5:return a=s.sent(),console.log("Image data received from background"),H&&K(Bl(Bl({},H),{imageUrl:a,image:a})),[3,7];case 6:return i=s.sent(),console.error("Error generating image:",i),we("Image generation failed: ".concat((null==i?void 0:i.message)||"Unknown error")),[3,7];case 7:return[2]}}))}))},ze=function(){return zl(void 0,void 0,void 0,(function(){return Dl(this,(function(e){if(!P)return[2];try{J(!0),(null==H?void 0:H.text)||P.text,we("Examples generation would be implemented here","info")}catch(e){console.error("Error generating examples:",e),we("Examples generation failed: ".concat((null==e?void 0:e.message)||"Unknown error"))}finally{J(!1)}return[2]}))}))},De=function(){return zl(void 0,void 0,void 0,(function(){return Dl(this,(function(e){if(!U.trim()||V||!P)return[2];q(!0);try{we('Custom instruction "'.concat(U,'" would be applied here'),"info"),$("")}catch(e){console.error("Error applying custom instructions:",e),we("Failed to apply custom instructions")}finally{q(!1)}return[2]}))}))},Me=function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),De())},$e=function(e){H&&K(Bl(Bl({},H),{translation:e}))},We=function(e){H&&K(Bl(Bl({},H),{examples:e}))},Ve=function(e){H&&K(Bl(Bl({},H),{back:e}))},qe=function(e){H&&K(Bl(Bl({},H),{linguisticInfo:e}))},Ge=function(e){e>=1&&e<=ce&&oe(e)},He=function(e){se(Number(e.target.value)),oe(1)};(0,r.useEffect)((function(){var e,t;console.log("Modal state changed:",{showEditModal:L,editingCard:null==P?void 0:P.id,currentCardData:{text:(null===(e=p.text)||void 0===e?void 0:e.substring(0,20))+"...",translation:(null===(t=p.translation)||void 0===t?void 0:t.substring(0,20))+"..."}})}),[L,P,p.text,p.translation]);var Ke,Ye=function(){return zl(void 0,void 0,void 0,(function(){var e,t,r,a,i,s,l,c;return Dl(this,(function(u){if(0===h.length)return we("Please select at least one card to export"),[2];try{ve(!0),e=o.filter((function(e){return h.includes(e.id)})),t="#separator:tab\n#html:true\n",e.forEach((function(e,n){var r,o,a,i;if(console.log("Processing card ".concat(n," for file export:"),{id:e.id,mode:e.mode,hasImage:!!e.image,hasImageUrl:!!e.imageUrl,imageType:typeof e.image,imageUrlType:typeof e.imageUrl,imageLength:null===(r=e.image)||void 0===r?void 0:r.length,imageUrlLength:null===(o=e.imageUrl)||void 0===o?void 0:o.length,imagePreview:null===(a=e.image)||void 0===a?void 0:a.substring(0,50),imageUrlPreview:null===(i=e.imageUrl)||void 0===i?void 0:i.substring(0,50),hasLinguisticInfo:!!e.linguisticInfo}),e.mode===_.LanguageLearning){var s=e.text.trim(),l="";if(e.translation&&(l+="<b>".concat(e.translation,"</b>")),e.examples&&e.examples.length>0&&(l+="<br><br>",e.examples.forEach((function(e,t){var n=e[0],r=e[1];l+="".concat(t+1,". ").concat(n),r&&(l+="<br><span style='font-size: 0.8em;'><i>".concat(r,"</i></span>")),l+="<br><br>"}))),e.image){var c=e.image;if(c.startsWith("data:")){var u="base64,";if(-1!==(p=c.indexOf(u))){var d=c.substring(p+u.length);l+='<div><img src="data:image/jpeg;base64,'.concat(d,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else l+='<div><img src="'.concat(c,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else l+='<div><img src="data:image/jpeg;base64,'.concat(c,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else if(e.imageUrl){var f=e.imageUrl;if(f.startsWith("data:")){var p;u="base64,";if(-1!==(p=f.indexOf(u))){d=f.substring(p+u.length);l+='<div><img src="data:image/jpeg;base64,'.concat(d,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else l+='<div><img src="'.concat(f,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else f.startsWith("http")?l+='<div><img src="'.concat(f,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>'):l+='<div><img src="data:image/jpeg;base64,'.concat(f,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}if(e.linguisticInfo&&e.linguisticInfo.trim()){var g=e.linguisticInfo.trim().split("\n").filter((function(e){return e.trim()})),h="";g.forEach((function(e){var t=e.trim();if(t.match(/^[А-ЯЁA-Z][^:]*:$/))h+='<div style="color: #2563EB; font-weight: bold; margin-top: 12px; margin-bottom: 4px;">'.concat(t,"</div>");else if(t.startsWith("•")||t.startsWith("-")||t.startsWith("*")){var n=t.replace(/^[•\-*]\s*/,"");h+='<div style="margin-left: 16px; margin-bottom: 2px; color: #374151;">• '.concat(n,"</div>")}else if(t.includes(":")&&!t.endsWith(":")){var r=t.split(":"),o=r[0],a=r.slice(1).join(":").trim();h+='<div style="margin-bottom: 4px;"><span style="color: #6B7280; font-weight: 500;">'.concat(o.trim(),':</span> <span style="color: #111827;">').concat(a,"</span></div>")}else t&&(h+='<div style="margin-bottom: 6px; color: #374151; line-height: 1.4;">'.concat(t,"</div>"))})),h&&(l+='<div style="margin-top: 20px; padding: 12px; background-color: #F8FAFC; border-left: 4px solid #2563EB; border-radius: 0 6px 6px 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1);"><div style="color: #1E40AF; font-weight: bold; font-size: 14px; margin-bottom: 8px; display: flex; align-items: center;"><span style="margin-right: 6px;">📚</span>Grammar & Linguistics</div>'.concat(h,"</div>"))}var m=s.replace(/\t/g," ").replace(/\n/g," ").trim(),y=l.replace(/\t/g," ").replace(/\r?\n/g,"<br>").trim();t+="".concat(m,"\t").concat(y,"\n"),console.log("Exported card ".concat(n,":"),{front:m.substring(0,50),backLength:y.length,hasLinguisticInfo:y.includes("Grammar & Linguistics")})}else if(e.mode===_.GeneralTopic){s=(e.front||"").trim();var x=(e.back||"").trim();m=s.replace(/\t/g," ").replace(/\n/g," ").trim(),y=x.replace(/\t/g," ").replace(/\r?\n/g,"<br>").trim();t+="".concat(m,"\t").concat(y,"\n")}})),(r=he.trim())||(r="anki_cards"),(r=r.replace(/[<>:"/\\|?*]/g,"_")).toLowerCase().endsWith(".txt")||(r+=".txt"),a=new Blob([t],{type:"text/plain;charset=utf-8;"}),i=URL.createObjectURL(a),(s=document.createElement("a")).setAttribute("href",i),s.setAttribute("download",r),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),l=e.length,c=e.filter((function(e){return e.linguisticInfo&&e.linguisticInfo.trim()})).length,console.log("Export complete: ".concat(l," cards exported, ").concat(c," with grammar information")),h.forEach((function(e){n.updateCardExportStatus(e,"exported_to_file"),console.log("Updated card ".concat(e," export status to 'exported_to_file'"))})),pe(!1),setTimeout((function(){try{var e=localStorage.getItem("anki_stored_cards");if(e){var t=JSON.parse(e);console.log("Verified localStorage after file export:",t.filter((function(e){return e.id&&h.includes(e.id)})).map((function(e){return{id:e.id,status:e.exportStatus}})))}}catch(e){console.error("Error verifying localStorage after file export:",e)}}),500)}catch(e){console.error("Error during file export:",e),we("Failed to export cards. Please try again.")}finally{ve(!1)}return[2]}))}))};return(0,a.jsxs)("div",Bl({style:{display:"flex",flexDirection:"column",height:"100%",padding:"12px",paddingBottom:"20px",overflowY:"auto",width:"100%",maxWidth:"320px",margin:"0 auto",position:"relative"}},{children:[(0,a.jsx)("div",Bl({style:{display:"flex",justifyContent:"center",alignItems:"center",marginBottom:"16px",paddingBottom:"12px",borderBottom:"1px solid #E5E7EB",marginTop:"20px"}},{children:(0,a.jsxs)("div",Bl({style:{fontWeight:"600",fontSize:"16px",color:"#111827",background:"linear-gradient(to right, #4F46E5, #2563EB)",backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",padding:"4px 12px",borderRadius:"16px",border:"1px solid #E5E7EB",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"}},{children:["Saved Cards (",o.length,")"]}))})),o.length>0?(0,a.jsxs)(a.Fragment,{children:[(Ke={base:{padding:"8px 16px",fontSize:"14px",fontWeight:"500",borderRadius:"6px 6px 0 0",cursor:"pointer",textAlign:"center",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"6px"},active:{backgroundColor:"#ffffff",color:"#2563EB",borderBottom:"2px solid #2563EB"},inactive:{backgroundColor:"#F3F4F6",color:"#6B7280",borderBottom:"2px solid transparent"}},(0,a.jsxs)("div",Bl({style:{display:"flex",width:"100%",borderBottom:"1px solid #E5E7EB",marginBottom:"16px",backgroundColor:"#F3F4F6"}},{children:[(0,a.jsxs)("div",Bl({onClick:function(){return A("not_exported")},style:Bl(Bl(Bl({},Ke.base),"not_exported"===I?Ke.active:Ke.inactive),{flex:1})},{children:["New",(0,a.jsx)("span",Bl({style:{backgroundColor:"not_exported"===I?"#2563EB":"#9CA3AF",color:"white",borderRadius:"9999px",fontSize:"12px",padding:"1px 6px",minWidth:"20px"}},{children:_e.not_exported}))]})),(0,a.jsxs)("div",Bl({onClick:function(){return A("all")},style:Bl(Bl(Bl({},Ke.base),"all"===I?Ke.active:Ke.inactive),{flex:1})},{children:["All",(0,a.jsx)("span",Bl({style:{backgroundColor:"all"===I?"#2563EB":"#9CA3AF",color:"white",borderRadius:"9999px",fontSize:"12px",padding:"1px 6px",minWidth:"20px"}},{children:_e.all}))]})),(0,a.jsxs)("div",Bl({onClick:function(){return A("exported")},style:Bl(Bl(Bl({},Ke.base),"exported"===I?Ke.active:Ke.inactive),{flex:1})},{children:["Exported",(0,a.jsx)("span",Bl({style:{backgroundColor:"exported"===I?"#2563EB":"#9CA3AF",color:"white",borderRadius:"9999px",fontSize:"12px",padding:"1px 6px",minWidth:"20px"}},{children:_e.exported}))]}))]}))),l&&function(){var e;if(!l)return null;var t={container:{display:"flex",flexDirection:"column",gap:"8px",marginBottom:"16px",backgroundColor:"#F9FAFB",padding:"12px",borderRadius:"8px",border:"1px solid #E5E7EB"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},title:{fontSize:"14px",fontWeight:"600",color:"#111827"},button:{backgroundColor:"transparent",border:"none",cursor:"pointer",color:"#6B7280",display:"flex",alignItems:"center",padding:"0",fontSize:"12px"},selectContainer:{display:"flex",alignItems:"center",gap:"8px",width:"100%"},select:{flex:1,padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"14px",cursor:"pointer"},refreshButton:{backgroundColor:"#F3F4F6",border:"1px solid #E5E7EB",borderRadius:"6px",cursor:"pointer",color:"#6B7280",display:"flex",alignItems:"center",justifyContent:"center",padding:"8px",minWidth:"36px",height:"38px"}};return T?(0,a.jsxs)("div",Bl({style:t.container},{children:[(0,a.jsxs)("div",Bl({style:t.header},{children:[(0,a.jsx)("span",Bl({style:t.title},{children:"Select Anki Deck"})),(0,a.jsx)("button",Bl({onClick:Pe,style:t.button},{children:"Hide"}))]})),(0,a.jsxs)("div",Bl({style:t.selectContainer},{children:[(0,a.jsxs)("select",Bl({value:i,onChange:Oe,style:t.select,disabled:S},{children:[0===s.length&&(0,a.jsx)("option",Bl({value:""},{children:"No decks available"})),s.map((function(e){return(0,a.jsx)("option",Bl({value:e.deckId},{children:e.name}),e.deckId)}))]})),(0,a.jsx)("button",Bl({onClick:Ee,disabled:S,title:"Refresh decks list",style:t.refreshButton,"aria-label":"Refresh decks"},{children:S?(0,a.jsx)("span",Bl({style:{marginLeft:"2px"}},{children:(0,a.jsx)(nn,{type:"spinner",size:"small",color:"#4B5563"})})):(0,a.jsx)(Jt,{size:14})}))]})),(0,a.jsx)("style",{children:"\n                    @keyframes spin {\n                        0% { transform: rotate(0deg); }\n                        100% { transform: rotate(360deg); }\n                    }\n                    "})]})):(0,a.jsxs)("div",Bl({style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",marginBottom:"12px",padding:"8px 12px",backgroundColor:"#F9FAFB",borderRadius:"6px",border:"1px solid #E5E7EB"}},{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",Bl({style:{fontSize:"13px",color:"#6B7280"}},{children:"Anki Deck:"})),(0,a.jsx)("span",Bl({style:{fontSize:"14px",fontWeight:"500",marginLeft:"8px",color:"#111827"}},{children:(null===(e=s.find((function(e){return e.deckId===i})))||void 0===e?void 0:e.name)||"None selected"}))]}),(0,a.jsx)("button",Bl({onClick:Pe,style:{backgroundColor:"transparent",border:"none",cursor:"pointer",color:"#2563EB",fontSize:"13px"}},{children:"Change"}))]}))}(),(0,a.jsxs)("div",Bl({style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"}},{children:[(0,a.jsxs)("div",Bl({style:{display:"flex",alignItems:"center"}},{children:[(0,a.jsx)("input",{type:"checkbox",id:"selectAll",checked:h.length===Ie.length&&Ie.length>0,onChange:function(){P||(h.length===Ie.length?y([]):y(Ie.map((function(e){return e.id}))))},style:{marginRight:"8px"},disabled:null!==P}),(0,a.jsx)("label",Bl({htmlFor:"selectAll",style:{fontSize:"14px",cursor:null!==P?"default":"pointer",opacity:null!==P?.6:1}},{children:h.length===Ie.length&&Ie.length>0?"Deselect All":"Select All"}))]})),(0,a.jsxs)("div",Bl({style:{display:"flex",gap:"8px",flexWrap:"wrap"}},{children:[(0,a.jsx)("button",Bl({onClick:function(){return zl(void 0,void 0,void 0,(function(){var e,r,a,s;return Dl(this,(function(l){switch(l.label){case 0:if(0===h.length)return we("Please select at least one card to save"),[2];b(!0),l.label=1;case 1:return l.trys.push([1,6,7,8]),e="Basic",r=o.filter((function(e){return h.includes(e.id)})),a=[],s=[],r.forEach((function(e){if(e.mode===_.LanguageLearning&&e.translation){var t=null;if(e.image)if(e.image.startsWith("data:")){var n="base64,";t=-1!==(o=e.image.indexOf(n))?e.image.substring(o+n.length):e.image}else t=e.image;var r={text:e.text,translation:e.translation,examples:e.examples||[],image_base64:t,linguisticInfo:e.linguisticInfo};console.log("Adding language learning card to Anki export:",{cardId:e.id,text:e.text,hasImage:!!t,imageLength:null==t?void 0:t.length,imagePreview:null==t?void 0:t.substring(0,30)}),a.push(r)}else if(e.mode===_.GeneralTopic&&e.front&&e.back){t=null;if(e.image)if(e.image.startsWith("data:")){var o;n="base64,";t=-1!==(o=e.image.indexOf(n))?e.image.substring(o+n.length):e.image}else t=e.image;var i={front:e.front,back:e.back,text:e.text,image_base64:t};console.log("Adding general topic card to Anki export:",{cardId:e.id,text:e.text,hasImage:!!t,imageLength:null==t?void 0:t.length,imagePreview:null==t?void 0:t.substring(0,30)}),s.push(i)}})),a.length>0?[4,t(Ce(_.LanguageLearning,c,u,i,e,a))]:[3,3];case 2:l.sent(),l.label=3;case 3:return s.length>0?[4,t(Ce(_.GeneralTopic,c,u,i,e,s))]:[3,5];case 4:l.sent(),l.label=5;case 5:return h.forEach((function(e){n.updateCardExportStatus(e,"exported_to_anki"),console.log("Updated card ".concat(e," export status to 'exported_to_anki'"))})),setTimeout((function(){try{var e=localStorage.getItem("anki_stored_cards");if(e){var t=JSON.parse(e);console.log("Verified localStorage after export:",t.filter((function(e){return e.id&&h.includes(e.id)})).map((function(e){return{id:e.id,status:e.exportStatus}})))}}catch(e){console.error("Error verifying localStorage after export:",e)}}),500),[3,8];case 6:return l.sent(),we("Failed to save cards to Anki. Make sure Anki is running and AnkiConnect is properly configured."),[3,8];case 7:return b(!1),[7];case 8:return[2]}}))}))},disabled:v||0===h.length||!l||!i||null!==P,style:{padding:"6px 10px",borderRadius:"6px",backgroundColor:"#10B981",color:"#ffffff",fontSize:"13px",border:"none",cursor:"pointer",opacity:!v&&0!==h.length&&l&&i&&null===P?1:.6},title:null!==P?"Finish editing first":!i&&l?"Please select a deck first":""},{children:v?(0,a.jsx)("div",Bl({style:{display:"flex",alignItems:"center",justifyContent:"center"}},{children:(0,a.jsx)(nn,{type:"spinner",size:"small",inline:!0,color:"#ffffff",text:"Saving to Anki"})})):"Save to Anki"})),(0,a.jsxs)("button",Bl({onClick:function(){if(0!==h.length){var e=(new Date).toISOString().split("T")[0],t="anki_cards_".concat(e);me(t),pe(!0)}else we("Please select at least one card to export")},disabled:v||0===h.length||null!==P,style:{padding:"6px 10px",borderRadius:"6px",backgroundColor:"#2563EB",color:"#ffffff",fontSize:"13px",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",opacity:v||0===h.length||null!==P?.6:1}},{children:[(0,a.jsx)(Nt,{size:12}),(0,a.jsx)("span",{children:"Export"})]}))]}))]})),(0,a.jsx)("div",Bl({style:{flex:1,overflow:"auto",marginBottom:"16px"}},{children:0===Ie.length?(0,a.jsx)("div",Bl({style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"200px",color:"#6B7280",textAlign:"center",padding:"20px"}},{children:(0,a.jsx)("p",Bl({style:{fontSize:"14px"}},{children:"all"===I?"No cards yet":"not_exported"===I?"No new cards":"No exported cards"}))})):Ae.map((function(e){return(0,a.jsxs)("div",Bl({style:{border:"1px solid #E5E7EB",borderRadius:"6px",marginBottom:"8px",backgroundColor:h.includes(e.id)?"#F3F4F6":"#ffffff"}},{children:[(0,a.jsxs)("div",Bl({style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",borderBottom:P===e?"none":"1px solid #E5E7EB"}},{children:[(0,a.jsxs)("div",Bl({style:{display:"flex",alignItems:"center"}},{children:[(0,a.jsx)("input",{type:"checkbox",checked:h.includes(e.id),onChange:function(){return t=e.id,void(P||(h.includes(t)?y(h.filter((function(e){return e!==t}))):y(Ml(Ml([],h,!0),[t],!1))));var t},style:{marginRight:"8px"},disabled:null!==P}),(0,a.jsx)("div",Bl({style:{flex:1,minWidth:0}},{children:(0,a.jsxs)("div",Bl({style:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:"4px"}},{children:[(0,a.jsx)("span",Bl({style:{fontSize:"12px",color:"#6B7280"}},{children:e.mode===_.LanguageLearning?"Language":"Topic"})),(0,a.jsx)("span",Bl({style:{fontSize:"10px",color:"#9CA3AF"}},{children:Fe(e.createdAt)})),Te(e.exportStatus)]}))}))]})),(0,a.jsx)("div",Bl({style:{display:"flex",alignItems:"center",gap:"4px"}},{children:P!==e&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",Bl({onClick:function(){return Re(e)},style:{backgroundColor:"transparent",border:"1px solid #E5E7EB",borderRadius:"6px",cursor:"pointer",color:"#2563EB",display:"flex",alignItems:"center",justifyContent:"center",padding:"6px 8px",fontSize:"12px",minWidth:"70px",height:"32px",transition:"all 0.2s ease",gap:"4px"},title:"Edit card",onMouseOver:function(e){e.currentTarget.style.backgroundColor="#EFF6FF",e.currentTarget.style.borderColor="#2563EB"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.borderColor="#E5E7EB"}},{children:[(0,a.jsx)(Lt,{size:12}),"Edit"]})),(0,a.jsxs)("button",Bl({onClick:function(){return t=e.id,n.deleteStoredCard(t),void y((function(e){return e.filter((function(e){return e!==t}))}));var t},style:{backgroundColor:"transparent",border:"1px solid #E5E7EB",borderRadius:"6px",cursor:"pointer",color:"#EF4444",display:"flex",alignItems:"center",justifyContent:"center",padding:"6px 8px",fontSize:"12px",minWidth:"70px",height:"32px",transition:"all 0.2s ease",gap:"4px"},title:"Delete card",onMouseOver:function(e){e.currentTarget.style.backgroundColor="#FEF2F2",e.currentTarget.style.borderColor="#EF4444"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.borderColor="#E5E7EB"}},{children:[(0,a.jsx)(en,{size:12}),"Delete"]}))]})}))]})),je(e)]}),e.id)}))})),(0,a.jsxs)("div",Bl({style:{display:"flex",flexDirection:"column",gap:"12px",marginTop:"16px",marginBottom:"16px",padding:"12px",backgroundColor:"#F9FAFB",borderRadius:"8px",border:"1px solid #E5E7EB"}},{children:[(0,a.jsxs)("div",Bl({style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},{children:[(0,a.jsx)("div",Bl({style:{display:"flex",alignItems:"center",gap:"8px"}},{children:(0,a.jsxs)("select",Bl({value:ie,onChange:He,style:{padding:"6px 8px",borderRadius:"6px",border:"1px solid #D1D5DB",fontSize:"13px",backgroundColor:"#FFFFFF",color:"#111827",fontWeight:"500",cursor:"pointer",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)",WebkitAppearance:"none",MozAppearance:"none",appearance:"none",backgroundImage:'url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2212%22%20height%3D%2212%22%20viewBox%3D%220%200%2012%2012%22%3E%3Cpath%20fill%3D%22%23424242%22%20d%3D%22M6%2C9L1.2%2C4.2%20c-0.4-0.4-0.4-1%2C0-1.4s1-0.4%2C1.4%2C0L6%2C6.2l3.4-3.4c0.4-0.4%2C1-0.4%2C1.4%2C0s0.4%2C1%2C0%2C1.4L6%2C9z%22%2F%3E%3C%2Fsvg%3E")',backgroundRepeat:"no-repeat",backgroundPosition:"right 8px center",paddingRight:"28px",minWidth:"90px"},"aria-label":"Cards per page"},{children:[(0,a.jsx)("option",Bl({value:5},{children:"5 per page"})),(0,a.jsx)("option",Bl({value:10},{children:"10 per page"})),(0,a.jsx)("option",Bl({value:20},{children:"20 per page"})),(0,a.jsx)("option",Bl({value:50},{children:"50 per page"}))]}))})),(0,a.jsx)("div",Bl({style:{display:"flex",alignItems:"center",fontSize:"13px",fontWeight:"500",color:"#4B5563"}},{children:Ie.length>0?"".concat(Math.min((re-1)*ie+1,Ie.length),"-").concat(Math.min(re*ie,Ie.length)," of ").concat(Ie.length," cards"):"0 cards"}))]})),(0,a.jsx)("div",Bl({style:{display:"flex",justifyContent:"center",alignItems:"center"}},{children:(0,a.jsxs)("div",Bl({style:{display:"flex",alignItems:"center",border:"1px solid #D1D5DB",borderRadius:"8px",overflow:"hidden",backgroundColor:"#FFFFFF",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"}},{children:[(0,a.jsx)("button",Bl({onClick:function(){return Ge(1)},disabled:1===re,style:{padding:"8px 10px",backgroundColor:"transparent",border:"none",borderRight:"1px solid #E5E7EB",cursor:1===re?"default":"pointer",color:1===re?"#9CA3AF":"#111827",display:"flex",alignItems:"center",justifyContent:"center",transition:"background-color 0.2s"},onMouseOver:function(e){1!==re&&(e.currentTarget.style.backgroundColor="#F9FAFB")},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent"},"aria-label":"Go to first page",title:"First page"},{children:(0,a.jsx)("svg",Bl({width:"14",height:"14",fill:"currentColor",viewBox:"0 0 20 20"},{children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M15.707 15.707a1 1 0 01-1.414 0l-5-5a1 1 0 010-1.414l5-5a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 010 1.414zm-6 0a1 1 0 01-1.414 0l-5-5a1 1 0 010-1.414l5-5a1 1 0 011.414 1.414L5.414 10l4.293 4.293a1 1 0 010 1.414z",clipRule:"evenodd"})}))})),(0,a.jsx)("button",Bl({onClick:function(){return Ge(re-1)},disabled:1===re,style:{padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRight:"1px solid #E5E7EB",cursor:1===re?"default":"pointer",color:1===re?"#9CA3AF":"#111827",display:"flex",alignItems:"center",justifyContent:"center",transition:"background-color 0.2s"},onMouseOver:function(e){1!==re&&(e.currentTarget.style.backgroundColor="#F9FAFB")},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent"},"aria-label":"Previous page",title:"Previous page"},{children:(0,a.jsx)(Tt,{size:14})})),(0,a.jsxs)("div",Bl({style:{padding:"6px 16px",fontSize:"13px",fontWeight:"500",color:"#111827",display:"flex",alignItems:"center",backgroundColor:"transparent",borderRight:"1px solid #E5E7EB",minWidth:"60px",justifyContent:"center"}},{children:[re," / ",ce||1]})),(0,a.jsx)("button",Bl({onClick:function(){return Ge(re+1)},disabled:re===ce||0===ce,style:{padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRight:"1px solid #E5E7EB",cursor:re===ce||0===ce?"default":"pointer",color:re===ce||0===ce?"#9CA3AF":"#111827",display:"flex",alignItems:"center",justifyContent:"center",transition:"background-color 0.2s"},onMouseOver:function(e){re!==ce&&0!==ce&&(e.currentTarget.style.backgroundColor="#F9FAFB")},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent"},"aria-label":"Next page",title:"Next page"},{children:(0,a.jsx)(jt,{size:14})})),(0,a.jsx)("button",Bl({onClick:function(){return Ge(ce)},disabled:re===ce||0===ce,style:{padding:"8px 10px",backgroundColor:"transparent",border:"none",cursor:re===ce||0===ce?"default":"pointer",color:re===ce||0===ce?"#9CA3AF":"#111827",display:"flex",alignItems:"center",justifyContent:"center",transition:"background-color 0.2s"},onMouseOver:function(e){re!==ce&&0!==ce&&(e.currentTarget.style.backgroundColor="#F9FAFB")},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent"},"aria-label":"Go to last page",title:"Last page"},{children:(0,a.jsx)("svg",Bl({width:"14",height:"14",fill:"currentColor",viewBox:"0 0 20 20"},{children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M4.293 15.707a1 1 0 001.414 0l5-5a1 1 0 000-1.414l-5-5a1 1 0 00-1.414 1.414L8.586 10l-4.293 4.293a1 1 0 000 1.414zm6 0a1 1 0 001.414 0l5-5a1 1 0 000-1.414l-5-5a1 1 0 00-1.414 1.414L14.586 10l-4.293 4.293a1 1 0 000 1.414z",clipRule:"evenodd"})}))}))]}))}))]}))]}):(0,a.jsx)("div",Bl({style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"300px",color:"#6B7280",textAlign:"center"}},{children:(0,a.jsx)("p",{children:"No saved cards yet."})})),fe&&(0,a.jsx)("div",Bl({style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(4px)"}},{children:(0,a.jsxs)("div",Bl({style:{backgroundColor:"#ffffff",borderRadius:"12px",padding:"24px",maxWidth:"400px",width:"90%",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",border:"1px solid #E5E7EB"}},{children:[(0,a.jsxs)("div",Bl({style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"20px"}},{children:[(0,a.jsxs)("h3",Bl({style:{margin:0,fontSize:"18px",fontWeight:"600",color:"#111827",display:"flex",alignItems:"center",gap:"8px"}},{children:[(0,a.jsx)(Nt,{size:16,style:{color:"#2563EB"}}),"Export Cards"]})),(0,a.jsx)("button",Bl({onClick:function(){return pe(!1)},disabled:xe,style:{backgroundColor:"transparent",border:"none",cursor:xe?"default":"pointer",padding:"4px",borderRadius:"4px",color:"#6B7280",opacity:xe?.5:1}},{children:(0,a.jsx)(Zt,{size:16})}))]})),(0,a.jsxs)("div",Bl({style:{marginBottom:"20px"}},{children:[(0,a.jsxs)("p",Bl({style:{margin:"0 0 16px 0",fontSize:"14px",color:"#6B7280",lineHeight:"1.5"}},{children:["Export ",h.length," selected cards to a file. Choose a filename or use the default."]})),(0,a.jsx)("label",Bl({style:{display:"block",fontSize:"14px",fontWeight:"500",color:"#374151",marginBottom:"8px"}},{children:"Filename"})),(0,a.jsxs)("div",Bl({style:{position:"relative"}},{children:[(0,a.jsx)("input",{type:"text",value:he,onChange:function(e){return me(e.target.value)},placeholder:"Enter filename (without extension)",disabled:xe,style:{width:"100%",padding:"10px 12px",paddingRight:"48px",border:"1px solid #D1D5DB",borderRadius:"8px",fontSize:"14px",outline:"none",transition:"border-color 0.2s ease",backgroundColor:xe?"#F9FAFB":"#ffffff",opacity:xe?.7:1,boxSizing:"border-box"},onFocus:function(e){xe||(e.target.style.borderColor="#2563EB",e.target.style.boxShadow="0 0 0 3px rgba(37, 99, 235, 0.1)")},onBlur:function(e){e.target.style.borderColor="#D1D5DB",e.target.style.boxShadow="none"},onKeyDown:function(e){"Enter"!==e.key||xe||Ye(),"Escape"===e.key&&pe(!1)}}),(0,a.jsx)("span",Bl({style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",fontSize:"13px",color:"#9CA3AF",pointerEvents:"none"}},{children:".txt"}))]})),(0,a.jsx)("p",Bl({style:{margin:"6px 0 0 0",fontSize:"12px",color:"#6B7280"}},{children:"The .txt extension will be added automatically"}))]})),(0,a.jsxs)("div",Bl({style:{display:"flex",gap:"12px",justifyContent:"flex-end"}},{children:[(0,a.jsx)("button",Bl({onClick:function(){return pe(!1)},disabled:xe,style:{padding:"10px 16px",border:"1px solid #D1D5DB",borderRadius:"8px",backgroundColor:"#ffffff",color:"#374151",fontSize:"14px",fontWeight:"500",cursor:xe?"default":"pointer",transition:"all 0.2s ease",opacity:xe?.5:1},onMouseOver:function(e){xe||(e.currentTarget.style.backgroundColor="#F9FAFB",e.currentTarget.style.borderColor="#9CA3AF")},onMouseOut:function(e){xe||(e.currentTarget.style.backgroundColor="#ffffff",e.currentTarget.style.borderColor="#D1D5DB")}},{children:"Cancel"})),(0,a.jsx)("button",Bl({onClick:Ye,disabled:xe||!he.trim(),style:{padding:"10px 16px",border:"none",borderRadius:"8px",backgroundColor:!he.trim()||xe?"#9CA3AF":"#2563EB",color:"#ffffff",fontSize:"14px",fontWeight:"500",cursor:!he.trim()||xe?"default":"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"8px",minWidth:"100px",justifyContent:"center"},onMouseOver:function(e){!xe&&he.trim()&&(e.currentTarget.style.backgroundColor="#1D4ED8")},onMouseOut:function(e){!xe&&he.trim()&&(e.currentTarget.style.backgroundColor="#2563EB")}},{children:xe?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(nn,{type:"spinner",size:"small",inline:!0,color:"#ffffff"}),(0,a.jsx)("span",{children:"Exporting..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Nt,{size:14}),(0,a.jsx)("span",{children:"Export"})]})}))]}))]}))})),function(){if(console.log("renderEditModal called. showEditModal:",L,"editingCard:",P),!L||!P)return console.log("Modal not showing because showEditModal:",L,"editingCard:",!!P),null;if(!H)return console.log("No local editing card data available"),null;var e=H.text,t=H.translation,n=H.examples,r=H.front,o=H.back,i=H.image,s=H.imageUrl,l=H.linguisticInfo,c=H.transcription;return console.log("Rendering edit modal with local data:",{text:(null==e?void 0:e.substring(0,20))+"...",translation:(null==t?void 0:t.substring(0,20))+"...",examplesCount:null==n?void 0:n.length,hasImage:!!i,hasImageUrl:!!s}),(0,a.jsx)("div",Bl({style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(2px)",padding:"16px"},onClick:Ne},{children:(0,a.jsxs)("div",Bl({style:{backgroundColor:"#ffffff",borderRadius:"12px",maxWidth:"340px",width:"100%",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",position:"relative",padding:"16px"},onClick:function(e){return e.stopPropagation()}},{children:[(0,a.jsxs)("div",Bl({style:{position:"sticky",top:0,display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid #E5E7EB",paddingBottom:"12px",marginBottom:"16px",backgroundColor:"#ffffff",zIndex:2}},{children:[(0,a.jsx)("h3",Bl({style:{margin:0,fontSize:"16px",fontWeight:600,color:"#111827"}},{children:"Edit Card"})),(0,a.jsx)("button",Bl({onClick:Ne,style:{background:"none",border:"none",display:"flex",alignItems:"center",justifyContent:"center",padding:"8px",borderRadius:"50%",cursor:"pointer",transition:"background-color 0.2s"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="#F3F4F6"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="transparent"},"aria-label":"Close"},{children:(0,a.jsx)(Zt,{size:16,color:"#6B7280"})}))]})),(0,a.jsxs)("div",Bl({style:{width:"100%",marginBottom:"12px"}},{children:[(0,a.jsxs)("div",Bl({style:{position:"relative",width:"100%"}},{children:[(0,a.jsx)("input",{type:"text",value:U,onChange:function(e){return $(e.target.value)},onKeyDown:Me,placeholder:"Enter custom instructions for this card (e.g., 'regenerate examples', 'change image style')",style:{width:"100%",padding:"10px 12px",paddingRight:"44px",borderRadius:"8px",border:"1px solid #E5E7EB",fontSize:"14px",color:"#374151",backgroundColor:V?"#F9FAFB":"#FFFFFF",transition:"all 0.2s ease",boxShadow:V?"inset 0 1px 2px rgba(0, 0, 0, 0.05)":"none"},disabled:V}),V?(0,a.jsx)("div",Bl({style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",padding:"6px",borderRadius:"50%",color:"#4F46E5"}},{children:(0,a.jsx)(nn,{type:"spinner",size:"small",inline:!0,color:"#4F46E5"})})):(0,a.jsx)("button",Bl({onClick:De,disabled:!U.trim()||V,style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",background:U.trim()?"linear-gradient(to right, #4F46E5, #6366F1)":"none",border:"none",color:U.trim()?"#FFFFFF":"#9CA3AF",cursor:U.trim()?"pointer":"not-allowed",display:"flex",alignItems:"center",justifyContent:"center",padding:"6px",borderRadius:"50%",width:"28px",height:"28px",boxShadow:U.trim()?"0 1px 3px rgba(0, 0, 0, 0.1)":"none",transition:"all 0.2s ease"},title:"Apply instructions"},{children:(0,a.jsx)(Gt,{size:14})}))]})),(0,a.jsxs)("div",Bl({style:{fontSize:"12px",color:V?"#4F46E5":"#6B7280",marginTop:"6px",display:"flex",alignItems:"center",gap:"6px",fontWeight:V?"500":"normal"}},{children:[V&&(0,a.jsx)("span",{style:{display:"inline-block",width:"6px",height:"6px",borderRadius:"50%",backgroundColor:"#4F46E5",animation:"pulse 1.5s infinite"}}),V?"Applying your instructions...":"Type instructions and press Enter or click the magic wand"]}))]})),(0,a.jsx)(ln,{mode:P.mode,front:r||null,back:o||null,translation:t||null,examples:n||[],imageUrl:s||null,image:i||null,linguisticInfo:l||void 0,transcription:c||null,onNewImage:Be,onNewExamples:ze,onAccept:Le,onViewSavedCards:function(){},onCancel:Ne,loadingNewImage:!1,loadingNewExamples:Q,loadingAccept:Z,shouldGenerateImage:!0,isSaved:!0,isEdited:!0,setTranslation:$e,setBack:Ve,setExamples:We,setLinguisticInfo:qe})]}))}))}(),(0,a.jsx)("div",Bl({style:{position:"absolute",top:"16px",right:"16px",zIndex:9999,pointerEvents:"none"}},{children:(0,a.jsx)("div",Bl({style:{pointerEvents:"auto"}},{children:Se()}))}))]}))};var $l="SET_ANKI_AVAILABILITY",Wl=function(e){return{type:$l,payload:e}},Vl="TOGGLE_SIDEBAR",ql="SET_SIDEBAR_VISIBILITY",Gl="SET_GLOBAL_SIDEBAR_STATE",Hl="INHERIT_SIDEBAR_STATE",Kl="SHOW_NOTIFICATION",Yl="HIDE_NOTIFICATION",Ql=function(e){return{type:Yl,payload:{id:e}}},Jl=function(){return Jl=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Jl.apply(this,arguments)};const Xl=function(){var e=m((function(e){return e.notifications.notifications})),t=k();(0,r.useEffect)((function(){e.forEach((function(e){var n=e.id,r=e.type,o=0;"success"===r||"info"===r?o=5e3:"warning"===r&&(o=6e3),o>0&&setTimeout((function(){t(Ql(n))}),o)}))}),[e,t]);return 0===e.length?null:(0,a.jsx)("div",Jl({style:{position:"absolute",top:"16px",right:"16px",zIndex:9999,maxWidth:"300px",width:"auto",display:"flex",flexDirection:"column",gap:"8px"}},{children:e.map((function(e){var n=function(e){switch(e){case"success":return{icon:(0,a.jsx)(At,{size:16}),color:"#059669",bgColor:"#ECFDF5",borderColor:"#10B981"};case"warning":return{icon:(0,a.jsx)(zt,{size:16}),color:"#D97706",bgColor:"#FFFBEB",borderColor:"#F59E0B"};case"info":return{icon:(0,a.jsx)($t,{size:16}),color:"#2563EB",bgColor:"#EFF6FF",borderColor:"#3B82F6"};default:return{icon:(0,a.jsx)(Xt,{size:16}),color:"#DC2626",bgColor:"#FEF2F2",borderColor:"#EF4444"}}}(e.type),r=n.icon,o=n.color,i=n.bgColor,s=n.borderColor;return(0,a.jsxs)("div",Jl({style:{transform:"translateX(0)",opacity:1,transition:"all 0.3s ease-out",backgroundColor:i,border:"1px solid ".concat(s),borderRadius:"12px",padding:"16px",minWidth:"280px",maxWidth:"320px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",position:"relative",display:"flex",alignItems:"flex-start",gap:"12px"},role:"alert","aria-live":"polite"},{children:[(0,a.jsx)("div",Jl({style:{color:o,marginTop:"2px",flexShrink:0}},{children:r})),(0,a.jsx)("div",Jl({style:{flex:1,paddingRight:"8px"}},{children:(0,a.jsx)("p",Jl({style:{color:"#374151",margin:0,fontSize:"14px",lineHeight:"1.5",fontWeight:500}},{children:e.message}))})),(0,a.jsx)("button",Jl({onClick:function(){return n=e.id,void t(Ql(n));var n},style:{position:"absolute",top:"8px",right:"8px",background:"transparent",border:"none",color:"#9CA3AF",cursor:"pointer",padding:"4px",borderRadius:"4px",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="rgba(0, 0, 0, 0.1)",e.currentTarget.style.color="#374151"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="#9CA3AF"},"aria-label":"Close notification"},{children:(0,a.jsx)(Zt,{size:12})}))]}),e.id)}))}))};var Zl=function(){return Zl=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Zl.apply(this,arguments)},ec=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},tc=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},nc=function(e){var t=e.tabId,n=Ue(),o=n.currentPage,i=n.setCurrentPage,s=(m((function(e){return e.anki.isAnkiAvailable})),(0,r.useState)(!0)),l=s[0],c=s[1],u=k(),d=m((function(e){return e.settings.ankiConnectApiKey})),f=n.storedCards,p=n.isGeneratingCard;(0,r.useEffect)((function(){l&&ec(void 0,void 0,void 0,(function(){var e,n,r;return tc(this,(function(o){switch(o.label){case 0:o.trys.push([0,5,6,7]),u(ke()),console.log("Initial card load from App component for tab:",t),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,ne(d)];case 2:return(e=o.sent()).error?(console.error("Anki returned an error:",e.error),u(Wl(!1))):(u(function(e){return{type:Rl,payload:e}}(e.result)),u(Wl(!0)),console.log("Anki is available")),[3,4];case 3:return n=o.sent(),console.error("Anki is unavailable:",n),u(Wl(!1)),[3,4];case 4:return[3,7];case 5:return r=o.sent(),console.error("Error initializing app:",r),[3,7];case 6:return c(!1),[7];case 7:return[2]}}))}))}),[u,d,l,t]),(0,r.useEffect)((function(){console.log("App: Stored cards count for tab ".concat(t,":"),f.length)}),[f,t]);var g,h=(0,r.useCallback)((function(e){i(e)}),[i]),y=(0,r.useCallback)((function(){u(function(e,t){return void 0===t&&(t=!0),{type:Vl,payload:{tabId:e,persist:t}}}(t)),chrome.runtime.sendMessage({action:"toggleSidebar",tabId:t},(function(e){chrome.runtime.lastError?console.error("Error sending message:",chrome.runtime.lastError.message):console.log("Extension closed:",e)}))}),[u,t]);return(0,a.jsx)("div",Zl({className:"App",style:{backgroundColor:"#ffffff",height:"100vh",display:"flex",flexDirection:"column",position:"absolute",right:0,top:0,width:"350px",fontFamily:"Inter, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, sans-serif",boxShadow:"0 0 0 1px rgba(0, 0, 0, 0.05), 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"}},{children:(0,a.jsxs)("div",Zl({style:{flex:1,width:"100%",height:"100%",position:"relative",display:"flex",flexDirection:"column"}},{children:[(g=f.filter((function(e){return"not_exported"===e.exportStatus})).length,(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",Zl({onClick:y,className:"close-button",style:{position:"absolute",top:"6px",right:"12px",backgroundColor:"transparent",border:"none",cursor:"pointer",padding:"6px",color:"#6B7280",borderRadius:"5px",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",width:"28px",height:"28px",zIndex:200},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.color="#EF4444"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="#6B7280"},title:"Close extension"},{children:(0,a.jsx)(Zt,{size:14})})),"createCard"!==o&&(0,a.jsx)("div",Zl({style:{position:"absolute",top:"6px",left:"12px",right:"50px",zIndex:100}},{children:(0,a.jsxs)("button",Zl({onClick:function(){return h("createCard")},className:"new-card-button",style:{backgroundColor:"#2563EB",border:"none",cursor:"pointer",padding:"6px 14px",color:"#FFFFFF",borderRadius:"7px",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"32px",boxShadow:"0 1px 3px rgba(37, 99, 235, 0.2)",fontSize:"13px",fontWeight:600},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#1D4ED8",e.currentTarget.style.transform="translateY(-0.5px)",e.currentTarget.style.boxShadow="0 2px 6px rgba(37, 99, 235, 0.25)"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#2563EB",e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="0 1px 3px rgba(37, 99, 235, 0.2)"},title:"Create a new card"},{children:[(0,a.jsx)(Kt,{style:{marginRight:"5px"},size:13}),"New Card"]}))})),(0,a.jsxs)("div",Zl({style:{position:"absolute",bottom:"8px",left:"12px",right:"12px",display:"flex",gap:"6px",zIndex:100}},{children:[(0,a.jsxs)("button",Zl({onClick:function(){return h("storedCards")},disabled:p,className:"nav-button",style:{backgroundColor:"storedCards"===o?"#EFF6FF":"#F9FAFB",border:"1px solid ".concat("storedCards"===o?"#BFDBFE":"#E5E7EB"),cursor:p?"not-allowed":"pointer",padding:"10px 14px",color:p?"#9CA3AF":"storedCards"===o?"#2563EB":"#6B7280",borderRadius:"10px",transition:"all 0.2s ease",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flex:1,gap:"3px",fontSize:"11px",fontWeight:"storedCards"===o?600:500,boxShadow:"storedCards"===o?"0 2px 4px rgba(37, 99, 235, 0.1)":"0 1px 2px rgba(0, 0, 0, 0.05)",position:"relative",opacity:p?.6:1},onMouseOver:function(e){"storedCards"===o||p||(e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.borderColor="#D1D5DB",e.currentTarget.style.color="#374151")},onMouseOut:function(e){"storedCards"===o||p||(e.currentTarget.style.backgroundColor="#F9FAFB",e.currentTarget.style.borderColor="#E5E7EB",e.currentTarget.style.color="#6B7280")},title:p?"Please wait while card is being generated":"View your saved cards"},{children:[(0,a.jsxs)("div",Zl({style:{position:"relative",display:"flex",alignItems:"center"}},{children:[(0,a.jsx)(qt,{size:16}),g>0&&(0,a.jsx)("span",Zl({style:{position:"absolute",top:"-6px",right:"-8px",backgroundColor:"#EF4444",color:"white",borderRadius:"10px",fontSize:"10px",fontWeight:"bold",padding:"2px 6px",minWidth:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.1)"}},{children:g>99?"99+":g}))]})),(0,a.jsx)("span",{children:"Cards"})]})),(0,a.jsxs)("button",Zl({onClick:function(){return h("settings")},disabled:p,className:"nav-button",style:{backgroundColor:"settings"===o?"#EFF6FF":"#F9FAFB",border:"1px solid ".concat("settings"===o?"#BFDBFE":"#E5E7EB"),cursor:p?"not-allowed":"pointer",padding:"10px 14px",color:p?"#9CA3AF":"settings"===o?"#2563EB":"#6B7280",borderRadius:"10px",transition:"all 0.2s ease",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flex:1,gap:"3px",fontSize:"11px",fontWeight:"settings"===o?600:500,boxShadow:"settings"===o?"0 2px 4px rgba(37, 99, 235, 0.1)":"0 1px 2px rgba(0, 0, 0, 0.05)",opacity:p?.6:1},onMouseOver:function(e){"settings"===o||p||(e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.borderColor="#D1D5DB",e.currentTarget.style.color="#374151")},onMouseOut:function(e){"settings"===o||p||(e.currentTarget.style.backgroundColor="#F9FAFB",e.currentTarget.style.borderColor="#E5E7EB",e.currentTarget.style.color="#6B7280")},title:p?"Please wait while card is being generated":"App settings and API configuration"},{children:[(0,a.jsx)(Rt,{size:16}),(0,a.jsx)("span",{children:"Settings"})]}))]}))]})),(0,a.jsxs)("header",Zl({className:"App-header",style:{width:"100%",flex:1,display:"flex",flexDirection:"column",backgroundColor:"#ffffff",marginTop:"0px",height:"100%",overflow:"auto"}},{children:[function(){var e="createCard"!==o?"46px":"12px",t="58px",n={width:"100%",height:"100%",paddingTop:e,paddingBottom:t,overflow:"auto",opacity:1,transform:"translateX(0)",transition:"all 0.3s ease-in-out"};switch(o){case"settings":return(0,a.jsx)("div",Zl({style:n},{children:(0,a.jsx)(Pl,{onBackClick:function(){return h("createCard")},popup:!1})}));case"storedCards":return(0,a.jsx)("div",Zl({style:n},{children:(0,a.jsx)(Ul,{onBackClick:function(){return h("createCard")}})}));default:return(0,a.jsx)("div",Zl({style:{width:"100%",flex:1,display:"flex",flexDirection:"column",overflow:"auto",height:"100%",position:"relative",paddingTop:e,paddingBottom:t,opacity:1,transform:"translateX(0)",transition:"all 0.3s ease-in-out"}},{children:(0,a.jsx)(Al,{})}))}}(),(0,a.jsx)("div",Zl({style:{position:"absolute",top:"16px",right:"16px",zIndex:9999,maxWidth:"300px",width:"auto",pointerEvents:"none"}},{children:(0,a.jsxs)("div",Zl({style:{pointerEvents:"auto"}},{children:[" ",(0,a.jsx)(Xl,{})]}))}))]}))]}))}))};const rc=function(e){var t=e.tabId,n=k();return(0,r.useEffect)((function(){n(function(e){return{type:F,payload:e}}(t)),console.log("App initialized for tab:",t)}),[n,t]),(0,a.jsx)(Me,Zl({tabId:t},{children:(0,a.jsx)(nc,{tabId:t})}))};
/**
 * @license
 * ReduxedChromeStorage v3.0.10
 * https://github.com/hindmost/reduxed-chrome-storage
 * Copyright (c) Savr Goryaev aka hindmost
 *
 * This source code is licensed under the MIT license
 * https://github.com/hindmost/reduxed-chrome-storage/blob/master/LICENSE
 *
 * Dependencies:
 *
 * uuid v8.3.2
 */
var oc,ac=new Uint8Array(16);function ic(){if(!oc&&!(oc="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return oc(ac)}var sc=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var lc=[],cc=0;cc<256;++cc)lc.push((cc+256).toString(16).substr(1));function uc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(lc[e[t+0]]+lc[e[t+1]]+lc[e[t+2]]+lc[e[t+3]]+"-"+lc[e[t+4]]+lc[e[t+5]]+"-"+lc[e[t+6]]+lc[e[t+7]]+"-"+lc[e[t+8]]+lc[e[t+9]]+"-"+lc[e[t+10]]+lc[e[t+11]]+lc[e[t+12]]+lc[e[t+13]]+lc[e[t+14]]+lc[e[t+15]]).toLowerCase();if(!function(e){return"string"==typeof e&&sc.test(e)}(n))throw TypeError("Stringified UUID is invalid");return n}function dc(e,t,n){var r=(e=e||{}).random||(e.rng||ic)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var o=0;o<16;++o)t[n+o]=r[o];return t}return uc(r)}function fc(e){return null==e||"object"!=typeof e?e:JSON.parse(JSON.stringify(e))}function pc(e,t){if(e===t)return!0;if(null==e||"object"!=typeof e||null==t||"object"!=typeof t||Array.isArray(e)!==Array.isArray(t))return!1;const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(const o of n)if(r.indexOf(o)<=-1||!pc(e[o],t[o]))return!1;return!0}function gc(e,t){if(e===t)return;if(null==e||"object"!=typeof e||null==t||"object"!=typeof t)return e;if(Array.isArray(e)||Array.isArray(t))return pc(e,t)?void 0:e;const n=Object.keys(e),r=Object.keys(t);let o=!0;const a=n.reduce(((n,a)=>{const i=r.indexOf(a)>-1?gc(e[a],t[a]):e[a];return void 0===i||(o=!1,n[a]=i),n}),{});return r.forEach((e=>{n.indexOf(e)>-1||(o=!1,a[e]=void 0)})),o?void 0:a}function hc(e,t,n){if(Array.isArray(t))return fc(t);if(null==e||"object"!=typeof e||Array.isArray(e)||null==t||"object"!=typeof t)return fc(void 0!==t?t:e);const r=Object.keys(e).concat(Object.keys(t).filter((t=>!(t in e)))).reduce(((r,o)=>(r[o]=hc(e[o],t[o],n),r)),{});if(!n)return r;const o=Object.keys(t);return Object.keys(e).forEach((e=>{o.indexOf(e)>-1||delete r[e]})),r}const mc=e=>{if(void 0===e||!Array.isArray(e)||3!==e.length)return[e,"",0];const[t,n,r]=e;return"string"==typeof t&&"number"==typeof n?[r,t,n]:[e,"",0]};class yc{constructor(e,t,n,r,o,a,i){this.container=e,this.storage=t,this.isolated=n,this.plain=r,this.timeout=o?Math.max(o,500):1e3,this.resetState=i,this.store=this._instantiateStore(),this.state=null,this.id=dc(),this.tmstamp=0,this.outdted=[],"function"==typeof a&&(this.lisner=a),this.lisners=[],this.getState=this.getState.bind(this),this.subscribe=this.subscribe.bind(this),this.dispatch=this.dispatch.bind(this),this.replaceReducer=this.replaceReducer.bind(this),this[Symbol.observable]=this[Symbol.observable].bind(this)}init(){this.tmstamp||this.isolated||this.storage.subscribe(((e,t)=>{const[n,r,o]=mc(e);if(r===this.id||pc(n,this.state))return;const a=o>=this.tmstamp,i=a?hc(this.state,n,!0):hc(n,this.state,!0);!a&&pc(i,this.state)||(this._setState(i,o),this._renewStore(),pc(i,n)||this._send2Storage(),this._callListeners())}));const e=this.store.getState();return new Promise((t=>{this.storage.load((n=>{const[r,,o]=mc(n);let a=r?hc(e,r):e;this.resetState&&(a=hc(a,this.resetState)),this._setState(a,o),this._renewStore(),pc(a,r)||this._send2Storage(),t(this)}))}))}initFrom(e){return this._setState(e,0),this._renewStore(),this}_setState(e,t){this.state=fc(e),(t=void 0!==t?t:Date.now())>this.tmstamp&&(this.tmstamp=t)}_renewStore(){this.plain?this.unsub&&this.unsub():this._clean();const e=this.store=this._instantiateStore(this.state),t=Date.now(),n=this.outdted.length;this.outdted=this.outdted.map((([e,r],o)=>e||o>=n-1?[e,r]:[t,r]));let r=fc(this.state);const o=this.store.subscribe((()=>{const t=e&&e.getState(),n=this.store===e;if(this._clean(),!pc(t,this.state)){if(n)this._setState(t);else{const e=gc(t,r);if(void 0===e)return;this._setState(hc(this.state,e)),this._renewStore()}this._send2Storage(),this._callListeners(!0,r),r=fc(t)}}));this.plain?this.unsub=o:this.outdted.push([0,o])}_clean(){if(this.plain)return;const e=Date.now(),t=this.outdted.length;this.outdted.forEach((([n,r],o)=>{o>=t-1||e-n<this.timeout||(r(),delete this.outdted[o])}))}_instantiateStore(e){const t=this.container(e);if("object"!=typeof t||"function"!=typeof t.getState)throw new Error("Invalid 'storeCreatorContainer' supplied");return t}_send2Storage(){var e,t,n;this.storage.save((e=this.state,t=this.id,n=this.tmstamp,[t,n,e]))}_callListeners(e,t){e&&this.lisner&&this.lisner(this,t);for(const e of this.lisners)e()}getState(){return this.state}subscribe(e){return"function"==typeof e&&this.lisners.push(e),()=>{"function"==typeof e&&(this.lisners=this.lisners.filter((t=>t!==e)))}}dispatch(e){return this.store.dispatch(e)}replaceReducer(e){return"function"==typeof e&&this.store.replaceReducer(e),this}[Symbol.observable](){const e=this.getState,t=this.subscribe;return{subscribe(n){if("object"!=typeof n||null===n)throw new TypeError("Expected the observer to be an object.");function r(){const t=n;t.next&&t.next(e())}r();return{unsubscribe:t(r)}},[Symbol.observable](){return this}}}}var xc;!function(e){e.local="local",e.sync="sync"}(xc||(xc={}));const vc=e=>(new TextEncoder).encode(Object.entries(e).map((([e,t])=>e+JSON.stringify(t))).join("")).length;class bc{constructor({namespace:e,area:t,key:n}){this.ns=e,this.areaName=t===xc.sync?xc.sync:xc.local,this.key=n||"reduxed",this.listeners=[],this.errListeners=[]}regShared(){this.regListener(((e,t)=>{for(const n of this.listeners)n(e,t)}))}regListener(e){this.ns.storage.onChanged.addListener(((t,n)=>{if(n!==this.areaName||!(this.key in t))return;const{newValue:r,oldValue:o}=t[this.key];r&&e(r,o)}))}subscribe(e){"function"==typeof e&&this.listeners.push(e)}subscribeForError(e){"function"==typeof e&&this.errListeners.push(e)}fireErrorListeners(e,t){for(const n of this.errListeners)n(e,t)}callbackOnLoad(e,t,n){t(!this.ns.runtime.lastError&&(n?e:e&&e[this.key]))}callbackOnSave(e,t){if(!this.ns.runtime.lastError)return;const{message:n}=this.ns.runtime.lastError;if(!n||!e||!t)return void this.fireErrorListeners(n||"",!1);this.areaName===xc.sync&&t.QUOTA_BYTES_PER_ITEM&&vc({[this.key]:e})>t.QUOTA_BYTES_PER_ITEM?this.fireErrorListeners(n,!0):this.load((r=>{const o="object"==typeof r&&t.QUOTA_BYTES>0&&vc(Object.assign(Object.assign({},r),{[this.key]:e}))>t.QUOTA_BYTES;this.fireErrorListeners(n,o)}),!0)}}class wc extends bc{constructor({namespace:e,area:t,key:n}){super({namespace:e,area:t,key:n}),this.areaApi=this.ns.storage[this.areaName]}load(e,t){"function"==typeof e&&this.areaApi.get(t?null:this.key,(n=>{this.callbackOnLoad(n,e,t)}))}save(e){this.areaApi.set({[this.key]:e},(()=>{this.callbackOnSave(e,this.areaApi)}))}}class Sc extends bc{constructor({namespace:e,area:t,key:n}){super({namespace:e,area:t,key:n}),this.areaApi=this.ns.storage[this.areaName]}load(e,t){"function"==typeof e&&this.areaApi.get(t?null:this.key).then((t=>{this.callbackOnLoad(t,e)}))}save(e){this.areaApi.set({[this.key]:e}).then((()=>{this.callbackOnSave(e,this.areaApi)}))}}var Cc;function Ec(e){return Ec="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ec(e)}function kc(e){var t=function(e,t){if("object"!=Ec(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Ec(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Ec(t)?t:t+""}function Ic(e,t,n){return(t=kc(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ac(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ac(Object(n),!0).forEach((function(t){Ic(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ac(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Fc(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}!function(e){e.chrome="chrome",e.browser="browser"}(Cc||(Cc={}));var Tc="function"==typeof Symbol&&Symbol.observable||"@@observable",jc=function(){return Math.random().toString(36).substring(7).split("").join(".")},Oc={INIT:"@@redux/INIT"+jc(),REPLACE:"@@redux/REPLACE"+jc(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+jc()}};function Pc(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function Rc(e,t,n){var r;if("function"==typeof t&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw new Error(Fc(0));if("function"==typeof t&&void 0===n&&(n=t,t=void 0),void 0!==n){if("function"!=typeof n)throw new Error(Fc(1));return n(Rc)(e,t)}if("function"!=typeof e)throw new Error(Fc(2));var o=e,a=t,i=[],s=i,l=!1;function c(){s===i&&(s=i.slice())}function u(){if(l)throw new Error(Fc(3));return a}function d(e){if("function"!=typeof e)throw new Error(Fc(4));if(l)throw new Error(Fc(5));var t=!0;return c(),s.push(e),function(){if(t){if(l)throw new Error(Fc(6));t=!1,c();var n=s.indexOf(e);s.splice(n,1),i=null}}}function f(e){if(!Pc(e))throw new Error(Fc(7));if(void 0===e.type)throw new Error(Fc(8));if(l)throw new Error(Fc(9));try{l=!0,a=o(a,e)}finally{l=!1}for(var t=i=s,n=0;n<t.length;n++){(0,t[n])()}return e}return f({type:Oc.INIT}),(r={dispatch:f,subscribe:d,getState:u,replaceReducer:function(e){if("function"!=typeof e)throw new Error(Fc(10));o=e,f({type:Oc.REPLACE})}})[Tc]=function(){var e,t=d;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new Error(Fc(11));function n(){e.next&&e.next(u())}return n(),{unsubscribe:t(n)}}})[Tc]=function(){return this},e},r}function Nc(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}function Lc(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return function(){var n=e.apply(void 0,arguments),r=function(){throw new Error(Fc(15))},o={getState:n.getState,dispatch:function(){return r.apply(void 0,arguments)}},a=t.map((function(e){return e(o)}));return r=Nc.apply(void 0,a)(n.dispatch),_c(_c({},n),{},{dispatch:r})}}}function Bc(e){return function(t){var n=t.dispatch,r=t.getState;return function(t){return function(o){return"function"==typeof o?o(n,r,e):t(o)}}}}var zc=Bc();zc.withExtraArgument=Bc;const Dc=zc;var Mc=function(){return Mc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Mc.apply(this,arguments)},Uc={decks:[],deckId:""};var $c=function(){return $c=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},$c.apply(this,arguments)},Wc=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},Vc=$c({savedCards:[],storedCards:[],text:"",translation:"",examples:[],image:null,imageUrl:null,error:void 0,back:null,front:"",currentCardId:null,linguisticInfo:"",transcription:"",isGeneratingCard:!1});const qc=function(e,t){var n,r,o,a,i,s,l,c,u,d;void 0===e&&(e=Vc);var f=$c({},e);switch(t.type){case ae:f.savedCards=Wc(Wc([],e.savedCards,!0),t.payload,!0);break;case pe:console.log("*** REDUCER: SAVE_CARD_TO_STORAGE action received ***"),console.log("Action payload raw:",t.payload),console.log("Action payload image data:",{hasImage:!!t.payload.image,hasImageUrl:!!t.payload.imageUrl,imageType:typeof t.payload.image,imageUrlType:typeof t.payload.imageUrl,imageValue:t.payload.image,imageUrlValue:t.payload.imageUrl,imageUndefinedCheck:void 0!==t.payload.image,imageUrlUndefinedCheck:void 0!==t.payload.imageUrl});var p=$c($c({},t.payload.id?t.payload:$c($c({},t.payload),{id:Date.now().toString()})),{image:void 0!==t.payload.image?t.payload.image:null,imageUrl:void 0!==t.payload.imageUrl?t.payload.imageUrl:null,exportStatus:t.payload.exportStatus||"not_exported",linguisticInfo:t.payload.linguisticInfo||"",transcription:t.payload.transcription||""});console.log("REDUCER: Final card object created:",{cardId:p.id,hasImage:!!p.image,hasImageUrl:!!p.imageUrl,imageType:typeof p.image,imageUrlType:typeof p.imageUrl,imageLength:null===(n=p.image)||void 0===n?void 0:n.length,imageUrlLength:null===(r=p.imageUrl)||void 0===r?void 0:r.length,imageActualValue:p.image,imageUrlActualValue:p.imageUrl,imagePreview:null===(o=p.image)||void 0===o?void 0:o.substring(0,50),imageUrlPreview:null===(a=p.imageUrl)||void 0===a?void 0:a.substring(0,50)});var g=e.storedCards.find((function(e){return e.text===p.text}));g?(f.storedCards=e.storedCards.map((function(e){return e.id===g.id?$c($c({},p),{id:g.id}):e})),console.log("Updated existing card with text:",p.text)):(f.storedCards=Wc(Wc([],e.storedCards,!0),[p],!1),console.log("Added new card:",p.text));break;case ye:f.storedCards=e.storedCards.map((function(e){return e.id===t.payload.cardId?$c($c({},e),{exportStatus:t.payload.status}):e}));break;case xe:if(console.log("*** REDUCER: UPDATE_STORED_CARD action received ***"),console.log("Update payload image info:",{cardId:t.payload.id,hasImage:!!t.payload.image,hasImageUrl:!!t.payload.imageUrl,imageType:typeof t.payload.image,imageUrlType:typeof t.payload.imageUrl,imageValue:t.payload.image,imageUrlValue:t.payload.imageUrl,imageLength:null===(i=t.payload.image)||void 0===i?void 0:i.length,imageUrlLength:null===(s=t.payload.imageUrl)||void 0===s?void 0:s.length}),!t.payload.id)return console.error("Cannot update card without ID"),e;if(e.storedCards.some((function(e){return e.id===t.payload.id})))f.storedCards=e.storedCards.map((function(e){return e.id===t.payload.id?$c($c({},t.payload),{exportStatus:t.payload.exportStatus||e.exportStatus,linguisticInfo:t.payload.linguisticInfo||e.linguisticInfo,transcription:t.payload.transcription||e.transcription}):e})),console.log("UPDATE_STORED_CARD: Updated existing card with ID:",t.payload.id,"image:",!!t.payload.image);else{var h=$c($c({},t.payload),{exportStatus:t.payload.exportStatus||"not_exported",linguisticInfo:t.payload.linguisticInfo||"",transcription:t.payload.transcription||""});f.storedCards=Wc(Wc([],e.storedCards,!0),[h],!1),console.log("UPDATE_STORED_CARD: Added new card with ID:",t.payload.id,"image:",!!h.image)}break;case ge:break;case me:f.storedCards=t.payload;break;case he:f.storedCards=e.storedCards.filter((function(e){return e.id!==t.payload}));break;case ie:f.text=t.payload,""!==t.payload&&""!==t.payload.trim()||(console.log("Text cleared completely, also clearing images"),f.image=null,f.imageUrl=null);break;case se:f.translation=t.payload;break;case le:f.examples=t.payload;break;case ce:console.log("*** REDUCER: SET_IMAGE called with:",{hasPayload:!!t.payload,payloadType:typeof t.payload,payloadLength:null===(l=t.payload)||void 0===l?void 0:l.length,payloadPreview:null===(c=t.payload)||void 0===c?void 0:c.substring(0,50)}),f.image=t.payload;break;case ue:return console.log("*** REDUCER: SET_IMAGE_URL called with:",{hasPayload:!!t.payload,payloadType:typeof t.payload,payloadLength:null===(u=t.payload)||void 0===u?void 0:u.length,payloadPreview:null===(d=t.payload)||void 0===d?void 0:d.substring(0,50)}),$c($c({},e),{imageUrl:t.payload});case de:return $c($c({},e),{back:t.payload});case fe:return $c($c({},e),{front:t.payload});case ve:return $c($c({},e),{currentCardId:t.payload});case be:return $c($c({},e),{linguisticInfo:t.payload});case we:return $c($c({},e),{transcription:t.payload});case Se:return $c($c({},e),{isGeneratingCard:t.payload});default:return e}return f};const Gc=function(e,t){return void 0===e&&(e="createCard"),"SET_CURRENT_PAGE"===t.type?t.currentPage:e};var Hc=function(){return Hc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Hc.apply(this,arguments)},Kc={isAnkiAvailable:!1};const Yc=function(e,t){return void 0===e&&(e=Kc),t.type===$l?Hc(Hc({},e),{isAnkiAvailable:t.payload}):e};var Qc=function(){return Qc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Qc.apply(this,arguments)},Jc={globalState:{isVisible:!1,lastToggleTime:Date.now()},tabStates:{},inheritanceSettings:{enabled:!0,mode:"lastActive"}},Xc=function(e,t){return e.tabStates[t]||{isVisible:e.globalState.isVisible,lastToggleTime:Date.now()}};const Zc=function(e,t){var n,r,o;switch(void 0===e&&(e=Jc),t.type){case Vl:var a=t.payload||{},i=a.tabId,s=a.persist,l=void 0===s||s,c=Date.now();if(i){var u=!(h=Xc(e,i)).isVisible,d=Qc(Qc({},e),{tabStates:Qc(Qc({},e.tabStates),(n={},n[i]=Qc(Qc({},h),{isVisible:u,lastToggleTime:c}),n))});return l&&(d.globalState=Qc(Qc({},e.globalState),{isVisible:u,lastActiveTabId:i,lastToggleTime:c})),d}return Qc(Qc({},e),{globalState:Qc(Qc({},e.globalState),{isVisible:!e.globalState.isVisible,lastToggleTime:c})});case ql:var f=t.payload,p=f.isVisible,g=(i=f.tabId,f.persist);l=void 0===g||g,c=Date.now();if(i){var h=Xc(e,i);d=Qc(Qc({},e),{tabStates:Qc(Qc({},e.tabStates),(r={},r[i]=Qc(Qc({},h),{isVisible:p,lastToggleTime:c}),r))});return l&&(d.globalState=Qc(Qc({},e.globalState),{isVisible:p,lastActiveTabId:i,lastToggleTime:c})),d}return Qc(Qc({},e),{globalState:Qc(Qc({},e.globalState),{isVisible:p,lastToggleTime:c})});case Gl:var m=t.payload,y=(p=m.isVisible,m.lastActiveTabId);return Qc(Qc({},e),{globalState:Qc(Qc({},e.globalState),{isVisible:p,lastActiveTabId:y||e.globalState.lastActiveTabId,lastToggleTime:Date.now()})});case Hl:var x=t.payload,v=x.fromTabId,b=x.toTabId,w=void 0,S=void 0;return v&&e.tabStates[v]?(w=e.tabStates[v].isVisible,S=v):(w=function(e){return e.globalState.lastActiveTabId&&e.tabStates[e.globalState.lastActiveTabId]?e.tabStates[e.globalState.lastActiveTabId].isVisible:e.globalState.isVisible}(e),S=e.globalState.lastActiveTabId),Qc(Qc({},e),{tabStates:Qc(Qc({},e.tabStates),(o={},o[b]={isVisible:w,inheritedFrom:S,lastToggleTime:Date.now()},o))});default:return e}};var eu=function(){return eu=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},eu.apply(this,arguments)},tu=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},nu={notifications:[]};var ru=function(){return ru=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},ru.apply(this,arguments)},ou=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},au={currentTabId:null,tabStates:{}};const iu=function(e,t){var n,r,o,a,i,s,l,c,u,d;void 0===e&&(e=au);var f=ru({},e);switch(t.type){case F:var p=t.payload;f.currentTabId=p,p&&!f.tabStates[p]&&(f.tabStates=ru(ru({},f.tabStates),((n={})[p]=function(e){return{cardData:{text:"",translation:"",examples:[],image:null,imageUrl:null,front:"",back:null,linguisticInfo:"",transcription:"",isGeneratingCard:!1,currentCardId:null},storedCards:[],fieldIdPrefix:"tab_".concat(e,"_").concat(Date.now(),"_"),currentPage:"createCard"}}(p),n)));break;case T:var g=t.payload,h=g.tabId,m=g.field,y=g.value;h&&f.tabStates[h]&&(f.tabStates=ru(ru({},f.tabStates),((r={})[h]=ru(ru({},f.tabStates[h]),{cardData:ru(ru({},f.tabStates[h].cardData),(o={},o[m]=y,o))}),r)));break;case j:var x=t.payload.tabId;x&&f.tabStates[x]&&(f.tabStates=ru(ru({},f.tabStates),((a={})[x]=ru(ru({},f.tabStates[x]),{cardData:{text:"",translation:"",examples:[],image:null,imageUrl:null,front:"",back:null,linguisticInfo:"",transcription:"",isGeneratingCard:!1,currentCardId:null}}),a)));break;case O:var v=t.payload,b=v.tabId,w=v.card;if(b&&f.tabStates[b]){var S=f.tabStates[b],C=ru(ru({},w),{id:w.id||"".concat(S.fieldIdPrefix).concat(Date.now()),createdAt:w.createdAt||new Date}),E=S.storedCards.findIndex((function(e){return e.text===C.text})),k=void 0;E>=0?(k=ou([],S.storedCards,!0))[E]=ru(ru({},C),{id:S.storedCards[E].id}):k=ou(ou([],S.storedCards,!0),[C],!1),f.tabStates=ru(ru({},f.tabStates),((i={})[b]=ru(ru({},S),{storedCards:k}),i))}break;case P:var I=t.payload,A=I.tabId,_=I.cardId;if(A&&f.tabStates[A]){S=f.tabStates[A];f.tabStates=ru(ru({},f.tabStates),((s={})[A]=ru(ru({},S),{storedCards:S.storedCards.filter((function(e){return e.id!==_}))}),s))}break;case R:var z=t.payload,D=z.tabId,M=z.cards;D&&f.tabStates[D]&&(f.tabStates=ru(ru({},f.tabStates),((l={})[D]=ru(ru({},f.tabStates[D]),{storedCards:M}),l)));break;case N:var U=t.payload,$=U.tabId,W=U.cardId,V=U.status;if($&&f.tabStates[$]){S=f.tabStates[$];f.tabStates=ru(ru({},f.tabStates),((c={})[$]=ru(ru({},S),{storedCards:S.storedCards.map((function(e){return e.id===W?ru(ru({},e),{exportStatus:V}):e}))}),c))}break;case L:var q=t.payload,G=q.tabId,H=q.card;if(G&&f.tabStates[G]&&H.id){var K=(S=f.tabStates[G]).storedCards.some((function(e){return e.id===H.id}));k=void 0;k=K?S.storedCards.map((function(e){return e.id===H.id?ru({},H):e})):ou(ou([],S.storedCards,!0),[H],!1),f.tabStates=ru(ru({},f.tabStates),((u={})[G]=ru(ru({},S),{storedCards:k}),u))}break;case B:var Y=t.payload,Q=Y.tabId,J=Y.currentPage;Q&&f.tabStates[Q]&&(f.tabStates=ru(ru({},f.tabStates),((d={})[Q]=ru(ru({},f.tabStates[Q]),{currentPage:J}),d)))}return f};var su,lu=function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++){var o=t[r];0,"function"==typeof e[o]&&(n[o]=e[o])}var a,i=Object.keys(n);try{!function(e){Object.keys(e).forEach((function(t){var n=e[t];if(void 0===n(void 0,{type:Oc.INIT}))throw new Error(Fc(12));if(void 0===n(void 0,{type:Oc.PROBE_UNKNOWN_ACTION()}))throw new Error(Fc(13))}))}(n)}catch(e){a=e}return function(e,t){if(void 0===e&&(e={}),a)throw a;for(var r=!1,o={},s=0;s<i.length;s++){var l=i[s],c=n[l],u=e[l],d=c(u,t);if(void 0===d){t&&t.type;throw new Error(Fc(14))}o[l]=d,r=r||d!==u}return(r=r||i.length!==Object.keys(e).length)?o:e}}({deck:function(e,t){switch(void 0===e&&(e=Uc),t.type){case Rl:return Mc(Mc({},e),{decks:t.payload});case Nl:return Mc(Mc({},e),{deckId:t.payload});default:return e}},cards:qc,settings:function(e,t){switch(void 0===e&&(e=Us),t.type){case tt:return Ds(Ds({},e),{openAiKey:t.payload});case nt:return Ds(Ds({},e),{mode:t.payload});case rt:return Ds(Ds({},e),{translateToLanguage:t.payload});case ot:return Ds(Ds({},e),{ankiConnectUrl:t.payload});case at:return Ds(Ds({},e),{ankiConnectApiKey:t.payload});case it:return Ds(Ds({},e),{useAnkiConnect:t.payload});case st:return Ds(Ds({},e),{visibleSideBar:t.visible});case ht:return Ds(Ds({},e),{groqApiKey:t.payload});case mt:return Ds(Ds({},e),{groqModelName:t.payload});case lt:return Ds(Ds({},e),{shouldGenerateImage:t.payload});case ut:return Ds(Ds({},e),{translationPrompt:t.payload});case dt:return Ds(Ds({},e),{examplesPrompt:t.payload});case ft:return Ds(Ds({},e),{aiInstructions:t.payload});case pt:return Ds(Ds({},e),{imageInstructions:t.payload});case ct:return Ds(Ds({},e),{imageGenerationMode:t.payload});case gt:return Ds(Ds({},e),{modelProvider:t.payload});case yt:return Ds(Ds({},e),{sourceLanguage:t.payload});default:return e}},currentPage:Gc,anki:Yc,sidebar:Zc,notifications:function(e,t){switch(void 0===e&&(e=nu),t.type){case Kl:return e.notifications.find((function(e){return e.message===t.payload.message&&e.type===t.payload.type}))?e:eu(eu({},e),{notifications:tu(tu([],e.notifications,!0),[t.payload],!1)});case Yl:return eu(eu({},e),{notifications:e.notifications.filter((function(e){return e.id!==t.payload.id}))});default:return e}},tabState:iu}),cu=function(e,t,n){const{namespace:r,chromeNs:o,browserNs:a,storageArea:i,storageKey:s,isolated:l,plainActions:c,outdatedTimeout:u}=t||{},{onGlobalChange:d,onLocalChange:f,onError:p}=n||{};if("function"!=typeof e)throw new Error("Missing argument for 'storeCreatorContainer'");const g=a||r===Cc.browser?new Sc({namespace:a||browser,area:i,key:s}):new wc({namespace:o||chrome,area:i,key:s});return"function"==typeof d&&g.regListener(((t,n)=>{const r=new yc(e,g,!0,c),[o]=mc(t),[a]=mc(n);d(r.initFrom(o),a)})),l||g.regShared(),t=>{p&&g.subscribeForError(p);return new yc(e,g,l,c,u,f,t).init()}}((function(e){return Rc(lu,e,Lc(Dc,Bs))}));console.log("Content script works!"),console.log("Must reload extension for modifications to take effect."),su="Using the 'printLine' function from the Print Module",console.log("===> FROM THE PRINT MODULE:",su);const uu=document.createElement("div");uu.id="sidebar",uu.setAttribute("style","\n  all: initial;\n  position: fixed;\n  top: 0;\n  right: 0;\n  width: 350px;\n  height: 100%;\n  overflow: auto;\n  z-index: 9999;\n  background-color: #ffffff;\n  box-shadow: -2px 0 5px rgba(0, 0, 0, 0.15);\n  transform: translateX(100%); /* по умолчанию скрыто */\n  transition: transform 0.3s ease-in-out;\n");const du=uu.attachShadow({mode:"open"}),fu=document.createElement("link");fu.setAttribute("rel","stylesheet");const pu=chrome.runtime.getURL("tailwind.css");fu.setAttribute("href",pu),du.appendChild(fu),document.body.appendChild(uu);const gu=(0,o.H)(du),hu=()=>r.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",background:"linear-gradient(135deg, #2563EB 0%, #1D4ED8 100%)",fontFamily:"system-ui, -apple-system, sans-serif",color:"#ffffff"}},[r.createElement("div",{key:"logo",style:{width:"48px",height:"48px",background:"rgba(255,255,255,0.2)",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:"24px",animation:"pulse 2s ease-in-out infinite"}},"🧠"),r.createElement("div",{key:"spinner",style:{width:"32px",height:"32px",border:"2px solid rgba(255,255,255,0.3)",borderTop:"2px solid #ffffff",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:"20px"}}),r.createElement("h2",{key:"title",style:{color:"#ffffff",fontSize:"20px",fontWeight:"700",marginBottom:"8px",textAlign:"center",letterSpacing:"-0.025em"}},"Anki Flash Cards"),r.createElement("p",{key:"subtitle",style:{color:"rgba(255,255,255,0.8)",fontSize:"14px",textAlign:"center",fontWeight:"400"}},"Initializing your learning assistant..."),r.createElement("div",{key:"progress-bar",style:{width:"200px",height:"2px",backgroundColor:"rgba(255,255,255,0.3)",borderRadius:"1px",marginTop:"24px",overflow:"hidden"}},r.createElement("div",{style:{width:"100%",height:"100%",backgroundColor:"#ffffff",animation:"progressBar 2s ease-in-out infinite"}})),r.createElement("style",{key:"styles"},"\n      @keyframes spin {\n        0% { transform: rotate(0deg); }\n        100% { transform: rotate(360deg); }\n      }\n      @keyframes pulse {\n        0%, 100% { transform: scale(1); opacity: 1; }\n        50% { transform: scale(1.05); opacity: 0.8; }\n      }\n      @keyframes progressBar {\n        0% { transform: translateX(-100%); }\n        50% { transform: translateX(0%); }\n        100% { transform: translateX(100%); }\n      }\n    ")]);const mu=new class{constructor(){this.storageKeys={globalState:"sidebar_global_state",tabPrefix:"sidebar_tab_"}}getTabKey(e){return`${this.storageKeys.tabPrefix}${e}`}async getInheritanceSettings(){return{enabled:!0,mode:"lastActive"}}async getGlobalState(){return new Promise((e=>{chrome.storage.local.get([this.storageKeys.globalState],(t=>{const n={isVisible:!1,lastActiveTabId:null,lastToggleTime:Date.now()};e(t[this.storageKeys.globalState]||n)}))}))}async getTabState(e){const t=this.getTabKey(e);return new Promise((e=>{chrome.storage.local.get([t],(n=>{e(n[t]||null)}))}))}async saveGlobalState(e){return new Promise((t=>{chrome.storage.local.set({[this.storageKeys.globalState]:e},t)}))}async saveTabState(e,t){const n=this.getTabKey(e);return new Promise((e=>{chrome.storage.local.set({[n]:t},e)}))}async determineInitialState(e){const t=await this.getGlobalState();if(t.lastActiveTabId){const e=await this.getTabState(t.lastActiveTabId);if(e)return{isVisible:e.isVisible,source:"lastActive",inheritedFrom:t.lastActiveTabId}}return{isVisible:t.isVisible,source:"global_fallback",inheritedFrom:null}}async toggleSidebar(e){const t=await this.getTabState(e),n=await this.getGlobalState();let r;if(t)r=t.isVisible;else{r=(await this.determineInitialState(e)).isVisible}const o=!r,a=Date.now(),i={isVisible:o,lastToggleTime:a,...t?.inheritedFrom&&{inheritedFrom:t.inheritedFrom}},s={...n,isVisible:o,lastActiveTabId:e,lastToggleTime:a};return await Promise.all([this.saveTabState(e,i),this.saveGlobalState(s)]),{isVisible:o,wasInherited:!!t?.inheritedFrom}}async getCurrentState(e){const t=await this.getTabState(e);return t?{isVisible:t.isVisible,source:"existing",inheritedFrom:t.inheritedFrom}:await this.determineInitialState(e)}},yu=(e,t,n="unknown")=>{e?(uu.style.transform="translateX(0)",document.body.style.marginRight="350px"):(uu.style.transform="translateX(100%)",document.body.style.marginRight="0"),console.log(`Sidebar state applied for tab ${t}: ${e?"visible":"hidden"} (source: ${n})`)},xu=()=>{const[e,t]=(0,r.useState)(null),[n,o]=(0,r.useState)(!0),[a,i]=(0,r.useState)(null);return(0,r.useEffect)((()=>{(async()=>{try{chrome.runtime.sendMessage({action:"getTabId"},(async e=>{const t=e?.tabId||Math.floor(1e6*Math.random());i(t),console.log("Content script initialized with tab ID:",t);try{const e=await mu.getCurrentState(t);yu(e.isVisible,t,e.source),e.inheritedFrom&&console.log(`Sidebar state inherited from tab ${e.inheritedFrom}`)}catch(e){console.error("Error determining initial sidebar state:",e),yu(!1,t,"error_fallback")}}));const e=await cu();t(e),setTimeout((()=>o(!1)),100)}catch(e){console.error("Error loading state from Chrome storage:",e),o(!1)}})()}),[]),n||!e||null===a?r.createElement(hu):r.createElement(w,{store:e},r.createElement(rc,{tabId:a}))},vu=r.createElement(xu,{});gu.render(vu),chrome.runtime.onMessage.addListener(((e,t,n)=>{if("toggleSidebar"===e.action){const t=e.tabId||"unknown";return"unknown"===t?(console.error("Cannot toggle sidebar: unknown tab ID"),n({status:"error",message:"Unknown tab ID"}),!0):(mu.toggleSidebar(t).then((e=>{yu(e.isVisible,t,"toggle"),n({status:"Sidebar toggled",visible:e.isVisible,tabId:t,wasInherited:e.wasInherited}),console.log(`Sidebar toggled for tab ${t}: ${e.isVisible?"visible":"hidden"}${e.wasInherited?" (was inherited)":""}`)})).catch((e=>{console.error("Error toggling sidebar:",e),n({status:"error",message:e.toString()})})),!0)}}))})();