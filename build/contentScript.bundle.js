(()=>{"use strict";var e={146:(e,t,n)=>{var r=n(363),a={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},o={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},i={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},l={};function s(e){return r.isMemo(e)?i:l[e.$$typeof]||a}l[r.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},l[r.Memo]=i;var c=Object.defineProperty,u=Object.getOwnPropertyNames,d=Object.getOwnPropertySymbols,p=Object.getOwnPropertyDescriptor,f=Object.getPrototypeOf,h=Object.prototype;e.exports=function e(t,n,r){if("string"!=typeof n){if(h){var a=f(n);a&&a!==h&&e(t,a,r)}var i=u(n);d&&(i=i.concat(d(n)));for(var l=s(t),g=s(n),m=0;m<i.length;++m){var v=i[m];if(!(o[v]||r&&r[v]||g&&g[v]||l&&l[v])){var y=p(n,v);try{c(t,v,y)}catch(e){}}}}return t}},551:(e,t,n)=>{
/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var r=n(540),a=n(982);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,l={};function s(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(l[e]=t,e=0;e<t.length;e++)i.add(t[e])}var u=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),d=Object.prototype.hasOwnProperty,p=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},h={};function g(e,t,n,r,a,o,i){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=i}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){m[e]=new g(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];m[t]=new g(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){m[e]=new g(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){m[e]=new g(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){m[e]=new g(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){m[e]=new g(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){m[e]=new g(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){m[e]=new g(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){m[e]=new g(e,5,!1,e.toLowerCase(),null,!1,!1)}));var v=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function b(e,t,n,r){var a=m.hasOwnProperty(t)?m[t]:null;(null!==a?0!==a.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null==t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,a,r)&&(n=null),r||null===a?function(e){return!!d.call(h,e)||!d.call(f,e)&&(p.test(e)?h[e]=!0:(f[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):a.mustUseProperty?e[a.propertyName]=null===n?3!==a.type&&"":n:(t=a.attributeName,r=a.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(a=a.type)||4===a&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(v,y);m[t]=new g(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(v,y);m[t]=new g(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(v,y);m[t]=new g(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){m[e]=new g(e,1,!1,e.toLowerCase(),null,!1,!1)})),m.xlinkHref=new g("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){m[e]=new g(e,1,!1,e.toLowerCase(),null,!0,!0)}));var x=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for("react.element"),S=Symbol.for("react.portal"),k=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),A=Symbol.for("react.provider"),T=Symbol.for("react.context"),I=Symbol.for("react.forward_ref"),z=Symbol.for("react.suspense"),F=Symbol.for("react.suspense_list"),M=Symbol.for("react.memo"),j=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var B=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var R=Symbol.iterator;function O(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=R&&e[R]||e["@@iterator"])?e:null}var L,N=Object.assign;function P(e){if(void 0===L)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);L=t&&t[1]||""}return"\n"+L+e}var _=!1;function D(e,t){if(!e||_)return"";_=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(e){var r=e}Reflect.construct(e,[],t)}else{try{t.call()}catch(e){r=e}e.call(t.prototype)}else{try{throw Error()}catch(e){r=e}e()}}catch(t){if(t&&r&&"string"==typeof t.stack){for(var a=t.stack.split("\n"),o=r.stack.split("\n"),i=a.length-1,l=o.length-1;1<=i&&0<=l&&a[i]!==o[l];)l--;for(;1<=i&&0<=l;i--,l--)if(a[i]!==o[l]){if(1!==i||1!==l)do{if(i--,0>--l||a[i]!==o[l]){var s="\n"+a[i].replace(" at new "," at ");return e.displayName&&s.includes("<anonymous>")&&(s=s.replace("<anonymous>",e.displayName)),s}}while(1<=i&&0<=l);break}}}finally{_=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?P(e):""}function q(e){switch(e.tag){case 5:return P(e.type);case 16:return P("Lazy");case 13:return P("Suspense");case 19:return P("SuspenseList");case 0:case 2:case 15:return e=D(e.type,!1);case 11:return e=D(e.type.render,!1);case 1:return e=D(e.type,!0);default:return""}}function U(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case k:return"Fragment";case S:return"Portal";case E:return"Profiler";case C:return"StrictMode";case z:return"Suspense";case F:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case T:return(e.displayName||"Context")+".Consumer";case A:return(e._context.displayName||"Context")+".Provider";case I:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case M:return null!==(t=e.displayName||null)?t:U(e.type)||"Memo";case j:t=e._payload,e=e._init;try{return U(e(t))}catch(e){}}return null}function $(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return U(t);case 8:return t===C?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t}return null}function H(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function V(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function G(e){e._valueTracker||(e._valueTracker=function(e){var t=V(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var a=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(e){r=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function W(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=V(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function Y(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function K(e,t){var n=t.checked;return N({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function X(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=H(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Q(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function J(e,t){Q(e,t);var n=H(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,H(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&Y(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&r&&(e[n].defaultSelected=!0)}else{for(n=""+H(n),t=null,a=0;a<e.length;a++){if(e[a].value===n)return e[a].selected=!0,void(r&&(e[a].defaultSelected=!0));null!==t||e[a].disabled||(t=e[a])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return N({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ae(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(o(92));if(te(n)){if(1<n.length)throw Error(o(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:H(n)}}function oe(e,t){var n=H(t.value),r=H(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function ie(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function le(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function se(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?le(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,de=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return ue(e,t)}))}:ue);function pe(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var fe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},he=["Webkit","ms","Moz","O"];function ge(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||fe.hasOwnProperty(e)&&fe[e]?(""+t).trim():t+"px"}function me(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),a=ge(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,a):e[n]=a}}Object.keys(fe).forEach((function(e){he.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fe[t]=fe[e]}))}));var ve=N({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ve[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(o(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xe=null;function we(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Se=null,ke=null,Ce=null;function Ee(e){if(e=ba(e)){if("function"!=typeof Se)throw Error(o(280));var t=e.stateNode;t&&(t=wa(t),Se(e.stateNode,e.type,t))}}function Ae(e){ke?Ce?Ce.push(e):Ce=[e]:ke=e}function Te(){if(ke){var e=ke,t=Ce;if(Ce=ke=null,Ee(e),t)for(e=0;e<t.length;e++)Ee(t[e])}}function Ie(e,t){return e(t)}function ze(){}var Fe=!1;function Me(e,t,n){if(Fe)return e(t,n);Fe=!0;try{return Ie(e,t,n)}finally{Fe=!1,(null!==ke||null!==Ce)&&(ze(),Te())}}function je(e,t){var n=e.stateNode;if(null===n)return null;var r=wa(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(o(231,t,typeof n));return n}var Be=!1;if(u)try{var Re={};Object.defineProperty(Re,"passive",{get:function(){Be=!0}}),window.addEventListener("test",Re,Re),window.removeEventListener("test",Re,Re)}catch(ue){Be=!1}function Oe(e,t,n,r,a,o,i,l,s){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(e){this.onError(e)}}var Le=!1,Ne=null,Pe=!1,_e=null,De={onError:function(e){Le=!0,Ne=e}};function qe(e,t,n,r,a,o,i,l,s){Le=!1,Ne=null,Oe.apply(De,arguments)}function Ue(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function $e(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function He(e){if(Ue(e)!==e)throw Error(o(188))}function Ve(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ue(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(null===a)break;var i=a.alternate;if(null===i){if(null!==(r=a.return)){n=r;continue}break}if(a.child===i.child){for(i=a.child;i;){if(i===n)return He(a),e;if(i===r)return He(a),t;i=i.sibling}throw Error(o(188))}if(n.return!==r.return)n=a,r=i;else{for(var l=!1,s=a.child;s;){if(s===n){l=!0,n=a,r=i;break}if(s===r){l=!0,r=a,n=i;break}s=s.sibling}if(!l){for(s=i.child;s;){if(s===n){l=!0,n=i,r=a;break}if(s===r){l=!0,r=i,n=a;break}s=s.sibling}if(!l)throw Error(o(189))}}if(n.alternate!==r)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(e))?Ge(e):null}function Ge(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ge(e);if(null!==t)return t;e=e.sibling}return null}var We=a.unstable_scheduleCallback,Ye=a.unstable_cancelCallback,Ke=a.unstable_shouldYield,Xe=a.unstable_requestPaint,Qe=a.unstable_now,Je=a.unstable_getCurrentPriorityLevel,Ze=a.unstable_ImmediatePriority,et=a.unstable_UserBlockingPriority,tt=a.unstable_NormalPriority,nt=a.unstable_LowPriority,rt=a.unstable_IdlePriority,at=null,ot=null;var it=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(lt(e)/st|0)|0},lt=Math.log,st=Math.LN2;var ct=64,ut=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function pt(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,a=e.suspendedLanes,o=e.pingedLanes,i=268435455&n;if(0!==i){var l=i&~a;0!==l?r=dt(l):0!==(o&=i)&&(r=dt(o))}else 0!==(i=n&~a)?r=dt(i):0!==o&&(r=dt(o));if(0===r)return 0;if(0!==t&&t!==r&&!(t&a)&&((a=r&-r)>=(o=t&-t)||16===a&&4194240&o))return t;if(4&r&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)a=1<<(n=31-it(t)),r|=e[n],t&=~a;return r}function ft(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ht(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function gt(){var e=ct;return!(4194240&(ct<<=1))&&(ct=64),e}function mt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function vt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-it(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-it(n),a=1<<r;a&t|e[r]&t&&(e[r]|=t),n&=~a}}var bt=0;function xt(e){return 1<(e&=-e)?4<e?268435455&e?16:536870912:4:1}var wt,St,kt,Ct,Et,At=!1,Tt=[],It=null,zt=null,Ft=null,Mt=new Map,jt=new Map,Bt=[],Rt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ot(e,t){switch(e){case"focusin":case"focusout":It=null;break;case"dragenter":case"dragleave":zt=null;break;case"mouseover":case"mouseout":Ft=null;break;case"pointerover":case"pointerout":Mt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":jt.delete(t.pointerId)}}function Lt(e,t,n,r,a,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:o,targetContainers:[a]},null!==t&&(null!==(t=ba(t))&&St(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==a&&-1===t.indexOf(a)&&t.push(a),e)}function Nt(e){var t=ya(e.target);if(null!==t){var n=Ue(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=$e(n)))return e.blockedOn=t,void Et(e.priority,(function(){kt(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Pt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Kt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=ba(n))&&St(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);xe=r,n.target.dispatchEvent(r),xe=null,t.shift()}return!0}function _t(e,t,n){Pt(e)&&n.delete(t)}function Dt(){At=!1,null!==It&&Pt(It)&&(It=null),null!==zt&&Pt(zt)&&(zt=null),null!==Ft&&Pt(Ft)&&(Ft=null),Mt.forEach(_t),jt.forEach(_t)}function qt(e,t){e.blockedOn===t&&(e.blockedOn=null,At||(At=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,Dt)))}function Ut(e){function t(t){return qt(t,e)}if(0<Tt.length){qt(Tt[0],e);for(var n=1;n<Tt.length;n++){var r=Tt[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==It&&qt(It,e),null!==zt&&qt(zt,e),null!==Ft&&qt(Ft,e),Mt.forEach(t),jt.forEach(t),n=0;n<Bt.length;n++)(r=Bt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Bt.length&&null===(n=Bt[0]).blockedOn;)Nt(n),null===n.blockedOn&&Bt.shift()}var $t=x.ReactCurrentBatchConfig,Ht=!0;function Vt(e,t,n,r){var a=bt,o=$t.transition;$t.transition=null;try{bt=1,Wt(e,t,n,r)}finally{bt=a,$t.transition=o}}function Gt(e,t,n,r){var a=bt,o=$t.transition;$t.transition=null;try{bt=4,Wt(e,t,n,r)}finally{bt=a,$t.transition=o}}function Wt(e,t,n,r){if(Ht){var a=Kt(e,t,n,r);if(null===a)Hr(e,t,r,Yt,n),Ot(e,r);else if(function(e,t,n,r,a){switch(t){case"focusin":return It=Lt(It,e,t,n,r,a),!0;case"dragenter":return zt=Lt(zt,e,t,n,r,a),!0;case"mouseover":return Ft=Lt(Ft,e,t,n,r,a),!0;case"pointerover":var o=a.pointerId;return Mt.set(o,Lt(Mt.get(o)||null,e,t,n,r,a)),!0;case"gotpointercapture":return o=a.pointerId,jt.set(o,Lt(jt.get(o)||null,e,t,n,r,a)),!0}return!1}(a,e,t,n,r))r.stopPropagation();else if(Ot(e,r),4&t&&-1<Rt.indexOf(e)){for(;null!==a;){var o=ba(a);if(null!==o&&wt(o),null===(o=Kt(e,t,n,r))&&Hr(e,t,r,Yt,n),o===a)break;a=o}null!==a&&r.stopPropagation()}else Hr(e,t,r,null,n)}}var Yt=null;function Kt(e,t,n,r){if(Yt=null,null!==(e=ya(e=we(r))))if(null===(t=Ue(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=$e(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Yt=e,null}function Xt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case Ze:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Qt=null,Jt=null,Zt=null;function en(){if(Zt)return Zt;var e,t,n=Jt,r=n.length,a="value"in Qt?Qt.value:Qt.textContent,o=a.length;for(e=0;e<r&&n[e]===a[e];e++);var i=r-e;for(t=1;t<=i&&n[r-t]===a[o-t];t++);return Zt=a.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function an(e){function t(t,n,r,a,o){for(var i in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=a,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(i)&&(t=e[i],this[i]=t?t(a):a[i]);return this.isDefaultPrevented=(null!=a.defaultPrevented?a.defaultPrevented:!1===a.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return N(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var on,ln,sn,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=an(cn),dn=N({},cn,{view:0,detail:0}),pn=an(dn),fn=N({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:En,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==sn&&(sn&&"mousemove"===e.type?(on=e.screenX-sn.screenX,ln=e.screenY-sn.screenY):ln=on=0,sn=e),on)},movementY:function(e){return"movementY"in e?e.movementY:ln}}),hn=an(fn),gn=an(N({},fn,{dataTransfer:0})),mn=an(N({},dn,{relatedTarget:0})),vn=an(N({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=N({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=an(yn),xn=an(N({},cn,{data:0})),wn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},kn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Cn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=kn[e])&&!!t[e]}function En(){return Cn}var An=N({},dn,{key:function(e){if(e.key){var t=wn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Sn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:En,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Tn=an(An),In=an(N({},fn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),zn=an(N({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:En})),Fn=an(N({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Mn=N({},fn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),jn=an(Mn),Bn=[9,13,27,32],Rn=u&&"CompositionEvent"in window,On=null;u&&"documentMode"in document&&(On=document.documentMode);var Ln=u&&"TextEvent"in window&&!On,Nn=u&&(!Rn||On&&8<On&&11>=On),Pn=String.fromCharCode(32),_n=!1;function Dn(e,t){switch(e){case"keyup":return-1!==Bn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function qn(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Un=!1;var $n={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!$n[e.type]:"textarea"===t}function Vn(e,t,n,r){Ae(r),0<(t=Gr(t,"onChange")).length&&(n=new un("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Gn=null,Wn=null;function Yn(e){Pr(e,0)}function Kn(e){if(W(xa(e)))return e}function Xn(e,t){if("change"===e)return t}var Qn=!1;if(u){var Jn;if(u){var Zn="oninput"in document;if(!Zn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Zn="function"==typeof er.oninput}Jn=Zn}else Jn=!1;Qn=Jn&&(!document.documentMode||9<document.documentMode)}function tr(){Gn&&(Gn.detachEvent("onpropertychange",nr),Wn=Gn=null)}function nr(e){if("value"===e.propertyName&&Kn(Wn)){var t=[];Vn(t,Wn,e,we(e)),Me(Yn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Wn=n,(Gn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ar(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Kn(Wn)}function or(e,t){if("click"===e)return Kn(t)}function ir(e,t){if("input"===e||"change"===e)return Kn(t)}var lr="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function sr(e,t){if(lr(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var a=n[r];if(!d.call(t,a)||!lr(e[a],t[a]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ur(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function dr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?dr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function pr(){for(var e=window,t=Y();t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(e){n=!1}if(!n)break;t=Y((e=t.contentWindow).document)}return t}function fr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function hr(e){var t=pr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&dr(n.ownerDocument.documentElement,n)){if(null!==r&&fr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var a=n.textContent.length,o=Math.min(r.start,a);r=void 0===r.end?o:Math.min(r.end,a),!e.extend&&o>r&&(a=r,r=o,o=a),a=ur(n,o);var i=ur(n,r);a&&i&&(1!==e.rangeCount||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==i.node||e.focusOffset!==i.offset)&&((t=t.createRange()).setStart(a.node,a.offset),e.removeAllRanges(),o>r?(e.addRange(t),e.extend(i.node,i.offset)):(t.setEnd(i.node,i.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"==typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var gr=u&&"documentMode"in document&&11>=document.documentMode,mr=null,vr=null,yr=null,br=!1;function xr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;br||null==mr||mr!==Y(r)||("selectionStart"in(r=mr)&&fr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},yr&&sr(yr,r)||(yr=r,0<(r=Gr(vr,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=mr)))}function wr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Sr={animationend:wr("Animation","AnimationEnd"),animationiteration:wr("Animation","AnimationIteration"),animationstart:wr("Animation","AnimationStart"),transitionend:wr("Transition","TransitionEnd")},kr={},Cr={};function Er(e){if(kr[e])return kr[e];if(!Sr[e])return e;var t,n=Sr[e];for(t in n)if(n.hasOwnProperty(t)&&t in Cr)return kr[e]=n[t];return e}u&&(Cr=document.createElement("div").style,"AnimationEvent"in window||(delete Sr.animationend.animation,delete Sr.animationiteration.animation,delete Sr.animationstart.animation),"TransitionEvent"in window||delete Sr.transitionend.transition);var Ar=Er("animationend"),Tr=Er("animationiteration"),Ir=Er("animationstart"),zr=Er("transitionend"),Fr=new Map,Mr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function jr(e,t){Fr.set(e,t),s(t,[e])}for(var Br=0;Br<Mr.length;Br++){var Rr=Mr[Br];jr(Rr.toLowerCase(),"on"+(Rr[0].toUpperCase()+Rr.slice(1)))}jr(Ar,"onAnimationEnd"),jr(Tr,"onAnimationIteration"),jr(Ir,"onAnimationStart"),jr("dblclick","onDoubleClick"),jr("focusin","onFocus"),jr("focusout","onBlur"),jr(zr,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),s("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),s("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),s("onBeforeInput",["compositionend","keypress","textInput","paste"]),s("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Or="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Lr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Or));function Nr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,a,i,l,s,c){if(qe.apply(this,arguments),Le){if(!Le)throw Error(o(198));var u=Ne;Le=!1,Ne=null,Pe||(Pe=!0,_e=u)}}(r,t,void 0,e),e.currentTarget=null}function Pr(e,t){t=!!(4&t);for(var n=0;n<e.length;n++){var r=e[n],a=r.event;r=r.listeners;e:{var o=void 0;if(t)for(var i=r.length-1;0<=i;i--){var l=r[i],s=l.instance,c=l.currentTarget;if(l=l.listener,s!==o&&a.isPropagationStopped())break e;Nr(a,l,c),o=s}else for(i=0;i<r.length;i++){if(s=(l=r[i]).instance,c=l.currentTarget,l=l.listener,s!==o&&a.isPropagationStopped())break e;Nr(a,l,c),o=s}}}if(Pe)throw e=_e,Pe=!1,_e=null,e}function _r(e,t){var n=t[ga];void 0===n&&(n=t[ga]=new Set);var r=e+"__bubble";n.has(r)||($r(t,e,2,!1),n.add(r))}function Dr(e,t,n){var r=0;t&&(r|=4),$r(n,e,r,t)}var qr="_reactListening"+Math.random().toString(36).slice(2);function Ur(e){if(!e[qr]){e[qr]=!0,i.forEach((function(t){"selectionchange"!==t&&(Lr.has(t)||Dr(t,!1,e),Dr(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[qr]||(t[qr]=!0,Dr("selectionchange",!1,t))}}function $r(e,t,n,r){switch(Xt(t)){case 1:var a=Vt;break;case 4:a=Gt;break;default:a=Wt}n=a.bind(null,t,n,e),a=void 0,!Be||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(a=!0),r?void 0!==a?e.addEventListener(t,n,{capture:!0,passive:a}):e.addEventListener(t,n,!0):void 0!==a?e.addEventListener(t,n,{passive:a}):e.addEventListener(t,n,!1)}function Hr(e,t,n,r,a){var o=r;if(!(1&t||2&t||null===r))e:for(;;){if(null===r)return;var i=r.tag;if(3===i||4===i){var l=r.stateNode.containerInfo;if(l===a||8===l.nodeType&&l.parentNode===a)break;if(4===i)for(i=r.return;null!==i;){var s=i.tag;if((3===s||4===s)&&((s=i.stateNode.containerInfo)===a||8===s.nodeType&&s.parentNode===a))return;i=i.return}for(;null!==l;){if(null===(i=ya(l)))return;if(5===(s=i.tag)||6===s){r=o=i;continue e}l=l.parentNode}}r=r.return}Me((function(){var r=o,a=we(n),i=[];e:{var l=Fr.get(e);if(void 0!==l){var s=un,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":s=Tn;break;case"focusin":c="focus",s=mn;break;case"focusout":c="blur",s=mn;break;case"beforeblur":case"afterblur":s=mn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":s=hn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":s=gn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":s=zn;break;case Ar:case Tr:case Ir:s=vn;break;case zr:s=Fn;break;case"scroll":s=pn;break;case"wheel":s=jn;break;case"copy":case"cut":case"paste":s=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":s=In}var u=!!(4&t),d=!u&&"scroll"===e,p=u?null!==l?l+"Capture":null:l;u=[];for(var f,h=r;null!==h;){var g=(f=h).stateNode;if(5===f.tag&&null!==g&&(f=g,null!==p&&(null!=(g=je(h,p))&&u.push(Vr(h,g,f)))),d)break;h=h.return}0<u.length&&(l=new s(l,c,null,n,a),i.push({event:l,listeners:u}))}}if(!(7&t)){if(s="mouseout"===e||"pointerout"===e,(!(l="mouseover"===e||"pointerover"===e)||n===xe||!(c=n.relatedTarget||n.fromElement)||!ya(c)&&!c[ha])&&(s||l)&&(l=a.window===a?a:(l=a.ownerDocument)?l.defaultView||l.parentWindow:window,s?(s=r,null!==(c=(c=n.relatedTarget||n.toElement)?ya(c):null)&&(c!==(d=Ue(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(s=null,c=r),s!==c)){if(u=hn,g="onMouseLeave",p="onMouseEnter",h="mouse","pointerout"!==e&&"pointerover"!==e||(u=In,g="onPointerLeave",p="onPointerEnter",h="pointer"),d=null==s?l:xa(s),f=null==c?l:xa(c),(l=new u(g,h+"leave",s,n,a)).target=d,l.relatedTarget=f,g=null,ya(a)===r&&((u=new u(p,h+"enter",c,n,a)).target=f,u.relatedTarget=d,g=u),d=g,s&&c)e:{for(p=c,h=0,f=u=s;f;f=Wr(f))h++;for(f=0,g=p;g;g=Wr(g))f++;for(;0<h-f;)u=Wr(u),h--;for(;0<f-h;)p=Wr(p),f--;for(;h--;){if(u===p||null!==p&&u===p.alternate)break e;u=Wr(u),p=Wr(p)}u=null}else u=null;null!==s&&Yr(i,l,s,u,!1),null!==c&&null!==d&&Yr(i,d,c,u,!0)}if("select"===(s=(l=r?xa(r):window).nodeName&&l.nodeName.toLowerCase())||"input"===s&&"file"===l.type)var m=Xn;else if(Hn(l))if(Qn)m=ir;else{m=ar;var v=rr}else(s=l.nodeName)&&"input"===s.toLowerCase()&&("checkbox"===l.type||"radio"===l.type)&&(m=or);switch(m&&(m=m(e,r))?Vn(i,m,n,a):(v&&v(e,l,r),"focusout"===e&&(v=l._wrapperState)&&v.controlled&&"number"===l.type&&ee(l,"number",l.value)),v=r?xa(r):window,e){case"focusin":(Hn(v)||"true"===v.contentEditable)&&(mr=v,vr=r,yr=null);break;case"focusout":yr=vr=mr=null;break;case"mousedown":br=!0;break;case"contextmenu":case"mouseup":case"dragend":br=!1,xr(i,n,a);break;case"selectionchange":if(gr)break;case"keydown":case"keyup":xr(i,n,a)}var y;if(Rn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Un?Dn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(Nn&&"ko"!==n.locale&&(Un||"onCompositionStart"!==b?"onCompositionEnd"===b&&Un&&(y=en()):(Jt="value"in(Qt=a)?Qt.value:Qt.textContent,Un=!0)),0<(v=Gr(r,b)).length&&(b=new xn(b,e,null,n,a),i.push({event:b,listeners:v}),y?b.data=y:null!==(y=qn(n))&&(b.data=y))),(y=Ln?function(e,t){switch(e){case"compositionend":return qn(t);case"keypress":return 32!==t.which?null:(_n=!0,Pn);case"textInput":return(e=t.data)===Pn&&_n?null:e;default:return null}}(e,n):function(e,t){if(Un)return"compositionend"===e||!Rn&&Dn(e,t)?(e=en(),Zt=Jt=Qt=null,Un=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Nn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Gr(r,"onBeforeInput")).length&&(a=new xn("onBeforeInput","beforeinput",null,n,a),i.push({event:a,listeners:r}),a.data=y))}Pr(i,t)}))}function Vr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Gr(e,t){for(var n=t+"Capture",r=[];null!==e;){var a=e,o=a.stateNode;5===a.tag&&null!==o&&(a=o,null!=(o=je(e,n))&&r.unshift(Vr(e,o,a)),null!=(o=je(e,t))&&r.push(Vr(e,o,a))),e=e.return}return r}function Wr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Yr(e,t,n,r,a){for(var o=t._reactName,i=[];null!==n&&n!==r;){var l=n,s=l.alternate,c=l.stateNode;if(null!==s&&s===r)break;5===l.tag&&null!==c&&(l=c,a?null!=(s=je(n,o))&&i.unshift(Vr(n,s,l)):a||null!=(s=je(n,o))&&i.push(Vr(n,s,l))),n=n.return}0!==i.length&&e.push({event:t,listeners:i})}var Kr=/\r\n?/g,Xr=/\u0000|\uFFFD/g;function Qr(e){return("string"==typeof e?e:""+e).replace(Kr,"\n").replace(Xr,"")}function Jr(e,t,n){if(t=Qr(t),Qr(e)!==t&&n)throw Error(o(425))}function Zr(){}var ea=null,ta=null;function na(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ra="function"==typeof setTimeout?setTimeout:void 0,aa="function"==typeof clearTimeout?clearTimeout:void 0,oa="function"==typeof Promise?Promise:void 0,ia="function"==typeof queueMicrotask?queueMicrotask:void 0!==oa?function(e){return oa.resolve(null).then(e).catch(la)}:ra;function la(e){setTimeout((function(){throw e}))}function sa(e,t){var n=t,r=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&8===a.nodeType)if("/$"===(n=a.data)){if(0===r)return e.removeChild(a),void Ut(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=a}while(n);Ut(t)}function ca(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ua(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var da=Math.random().toString(36).slice(2),pa="__reactFiber$"+da,fa="__reactProps$"+da,ha="__reactContainer$"+da,ga="__reactEvents$"+da,ma="__reactListeners$"+da,va="__reactHandles$"+da;function ya(e){var t=e[pa];if(t)return t;for(var n=e.parentNode;n;){if(t=n[ha]||n[pa]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ua(e);null!==e;){if(n=e[pa])return n;e=ua(e)}return t}n=(e=n).parentNode}return null}function ba(e){return!(e=e[pa]||e[ha])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function xa(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function wa(e){return e[fa]||null}var Sa=[],ka=-1;function Ca(e){return{current:e}}function Ea(e){0>ka||(e.current=Sa[ka],Sa[ka]=null,ka--)}function Aa(e,t){ka++,Sa[ka]=e.current,e.current=t}var Ta={},Ia=Ca(Ta),za=Ca(!1),Fa=Ta;function Ma(e,t){var n=e.type.contextTypes;if(!n)return Ta;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a,o={};for(a in n)o[a]=t[a];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function ja(e){return null!=(e=e.childContextTypes)}function Ba(){Ea(za),Ea(Ia)}function Ra(e,t,n){if(Ia.current!==Ta)throw Error(o(168));Aa(Ia,t),Aa(za,n)}function Oa(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!=typeof r.getChildContext)return n;for(var a in r=r.getChildContext())if(!(a in t))throw Error(o(108,$(e)||"Unknown",a));return N({},n,r)}function La(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ta,Fa=Ia.current,Aa(Ia,e),Aa(za,za.current),!0}function Na(e,t,n){var r=e.stateNode;if(!r)throw Error(o(169));n?(e=Oa(e,t,Fa),r.__reactInternalMemoizedMergedChildContext=e,Ea(za),Ea(Ia),Aa(Ia,e)):Ea(za),Aa(za,n)}var Pa=null,_a=!1,Da=!1;function qa(e){null===Pa?Pa=[e]:Pa.push(e)}function Ua(){if(!Da&&null!==Pa){Da=!0;var e=0,t=bt;try{var n=Pa;for(bt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Pa=null,_a=!1}catch(t){throw null!==Pa&&(Pa=Pa.slice(e+1)),We(Ze,Ua),t}finally{bt=t,Da=!1}}return null}var $a=[],Ha=0,Va=null,Ga=0,Wa=[],Ya=0,Ka=null,Xa=1,Qa="";function Ja(e,t){$a[Ha++]=Ga,$a[Ha++]=Va,Va=e,Ga=t}function Za(e,t,n){Wa[Ya++]=Xa,Wa[Ya++]=Qa,Wa[Ya++]=Ka,Ka=e;var r=Xa;e=Qa;var a=32-it(r)-1;r&=~(1<<a),n+=1;var o=32-it(t)+a;if(30<o){var i=a-a%5;o=(r&(1<<i)-1).toString(32),r>>=i,a-=i,Xa=1<<32-it(t)+a|n<<a|r,Qa=o+e}else Xa=1<<o|n<<a|r,Qa=e}function eo(e){null!==e.return&&(Ja(e,1),Za(e,1,0))}function to(e){for(;e===Va;)Va=$a[--Ha],$a[Ha]=null,Ga=$a[--Ha],$a[Ha]=null;for(;e===Ka;)Ka=Wa[--Ya],Wa[Ya]=null,Qa=Wa[--Ya],Wa[Ya]=null,Xa=Wa[--Ya],Wa[Ya]=null}var no=null,ro=null,ao=!1,oo=null;function io(e,t){var n=jc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function lo(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,no=e,ro=ca(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,no=e,ro=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Ka?{id:Xa,overflow:Qa}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=jc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,no=e,ro=null,!0);default:return!1}}function so(e){return!(!(1&e.mode)||128&e.flags)}function co(e){if(ao){var t=ro;if(t){var n=t;if(!lo(e,t)){if(so(e))throw Error(o(418));t=ca(n.nextSibling);var r=no;t&&lo(e,t)?io(r,n):(e.flags=-4097&e.flags|2,ao=!1,no=e)}}else{if(so(e))throw Error(o(418));e.flags=-4097&e.flags|2,ao=!1,no=e}}}function uo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;no=e}function po(e){if(e!==no)return!1;if(!ao)return uo(e),ao=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!na(e.type,e.memoizedProps)),t&&(t=ro)){if(so(e))throw fo(),Error(o(418));for(;t;)io(e,t),t=ca(t.nextSibling)}if(uo(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ro=ca(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ro=null}}else ro=no?ca(e.stateNode.nextSibling):null;return!0}function fo(){for(var e=ro;e;)e=ca(e.nextSibling)}function ho(){ro=no=null,ao=!1}function go(e){null===oo?oo=[e]:oo.push(e)}var mo=x.ReactCurrentBatchConfig;function vo(e,t){if(e&&e.defaultProps){for(var n in t=N({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var yo=Ca(null),bo=null,xo=null,wo=null;function So(){wo=xo=bo=null}function ko(e){var t=yo.current;Ea(yo),e._currentValue=t}function Co(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Eo(e,t){bo=e,wo=xo=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(!!(e.lanes&t)&&(xl=!0),e.firstContext=null)}function Ao(e){var t=e._currentValue;if(wo!==e)if(e={context:e,memoizedValue:t,next:null},null===xo){if(null===bo)throw Error(o(308));xo=e,bo.dependencies={lanes:0,firstContext:e}}else xo=xo.next=e;return t}var To=null;function Io(e){null===To?To=[e]:To.push(e)}function zo(e,t,n,r){var a=t.interleaved;return null===a?(n.next=n,Io(t)):(n.next=a.next,a.next=n),t.interleaved=n,Fo(e,r)}function Fo(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Mo=!1;function jo(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Bo(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ro(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Oo(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,2&zs){var a=r.pending;return null===a?t.next=t:(t.next=a.next,a.next=t),r.pending=t,Fo(e,n)}return null===(a=r.interleaved)?(t.next=t,Io(r)):(t.next=a.next,a.next=t),r.interleaved=t,Fo(e,n)}function Lo(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}function No(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var a=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var i={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===o?a=o=i:o=o.next=i,n=n.next}while(null!==n);null===o?a=o=t:o=o.next=t}else a=o=t;return n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:o,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Po(e,t,n,r){var a=e.updateQueue;Mo=!1;var o=a.firstBaseUpdate,i=a.lastBaseUpdate,l=a.shared.pending;if(null!==l){a.shared.pending=null;var s=l,c=s.next;s.next=null,null===i?o=c:i.next=c,i=s;var u=e.alternate;null!==u&&((l=(u=u.updateQueue).lastBaseUpdate)!==i&&(null===l?u.firstBaseUpdate=c:l.next=c,u.lastBaseUpdate=s))}if(null!==o){var d=a.baseState;for(i=0,u=c=s=null,l=o;;){var p=l.lane,f=l.eventTime;if((r&p)===p){null!==u&&(u=u.next={eventTime:f,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var h=e,g=l;switch(p=t,f=n,g.tag){case 1:if("function"==typeof(h=g.payload)){d=h.call(f,d,p);break e}d=h;break e;case 3:h.flags=-65537&h.flags|128;case 0:if(null==(p="function"==typeof(h=g.payload)?h.call(f,d,p):h))break e;d=N({},d,p);break e;case 2:Mo=!0}}null!==l.callback&&0!==l.lane&&(e.flags|=64,null===(p=a.effects)?a.effects=[l]:p.push(l))}else f={eventTime:f,lane:p,tag:l.tag,payload:l.payload,callback:l.callback,next:null},null===u?(c=u=f,s=d):u=u.next=f,i|=p;if(null===(l=l.next)){if(null===(l=a.shared.pending))break;l=(p=l).next,p.next=null,a.lastBaseUpdate=p,a.shared.pending=null}}if(null===u&&(s=d),a.baseState=s,a.firstBaseUpdate=c,a.lastBaseUpdate=u,null!==(t=a.shared.interleaved)){a=t;do{i|=a.lane,a=a.next}while(a!==t)}else null===o&&(a.shared.lanes=0);Ns|=i,e.lanes=i,e.memoizedState=d}}function _o(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(null!==a){if(r.callback=null,r=n,"function"!=typeof a)throw Error(o(191,a));a.call(r)}}}var Do=(new r.Component).refs;function qo(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:N({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Uo={isMounted:function(e){return!!(e=e._reactInternals)&&Ue(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=tc(),a=nc(e),o=Ro(r,a);o.payload=t,null!=n&&(o.callback=n),null!==(t=Oo(e,o,a))&&(rc(t,e,a,r),Lo(t,e,a))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=tc(),a=nc(e),o=Ro(r,a);o.tag=1,o.payload=t,null!=n&&(o.callback=n),null!==(t=Oo(e,o,a))&&(rc(t,e,a,r),Lo(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tc(),r=nc(e),a=Ro(n,r);a.tag=2,null!=t&&(a.callback=t),null!==(t=Oo(e,a,r))&&(rc(t,e,r,n),Lo(t,e,r))}};function $o(e,t,n,r,a,o,i){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,o,i):!t.prototype||!t.prototype.isPureReactComponent||(!sr(n,r)||!sr(a,o))}function Ho(e,t,n){var r=!1,a=Ta,o=t.contextType;return"object"==typeof o&&null!==o?o=Ao(o):(a=ja(t)?Fa:Ia.current,o=(r=null!=(r=t.contextTypes))?Ma(e,a):Ta),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Uo,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=o),t}function Vo(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Uo.enqueueReplaceState(t,t.state,null)}function Go(e,t,n,r){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs=Do,jo(e);var o=t.contextType;"object"==typeof o&&null!==o?a.context=Ao(o):(o=ja(t)?Fa:Ia.current,a.context=Ma(e,o)),a.state=e.memoizedState,"function"==typeof(o=t.getDerivedStateFromProps)&&(qo(e,t,o,n),a.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof a.getSnapshotBeforeUpdate||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||(t=a.state,"function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),t!==a.state&&Uo.enqueueReplaceState(a,a.state,null),Po(e,n,a,r),a.state=e.memoizedState),"function"==typeof a.componentDidMount&&(e.flags|=4194308)}function Wo(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var r=n.stateNode}if(!r)throw Error(o(147,e));var a=r,i=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===i?t.ref:(t=function(e){var t=a.refs;t===Do&&(t=a.refs={}),null===e?delete t[i]:t[i]=e},t._stringRef=i,t)}if("string"!=typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function Yo(e,t){throw e=Object.prototype.toString.call(t),Error(o(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Ko(e){return(0,e._init)(e._payload)}function Xo(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function a(e,t){return(e=Rc(e,t)).index=0,e.sibling=null,e}function i(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function l(t){return e&&null===t.alternate&&(t.flags|=2),t}function s(e,t,n,r){return null===t||6!==t.tag?((t=Pc(n,e.mode,r)).return=e,t):((t=a(t,n)).return=e,t)}function c(e,t,n,r){var o=n.type;return o===k?d(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===o||"object"==typeof o&&null!==o&&o.$$typeof===j&&Ko(o)===t.type)?((r=a(t,n.props)).ref=Wo(e,t,n),r.return=e,r):((r=Oc(n.type,n.key,n.props,null,e.mode,r)).ref=Wo(e,t,n),r.return=e,r)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=_c(n,e.mode,r)).return=e,t):((t=a(t,n.children||[])).return=e,t)}function d(e,t,n,r,o){return null===t||7!==t.tag?((t=Lc(n,e.mode,r,o)).return=e,t):((t=a(t,n)).return=e,t)}function p(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t)return(t=Pc(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case w:return(n=Oc(t.type,t.key,t.props,null,e.mode,n)).ref=Wo(e,null,t),n.return=e,n;case S:return(t=_c(t,e.mode,n)).return=e,t;case j:return p(e,(0,t._init)(t._payload),n)}if(te(t)||O(t))return(t=Lc(t,e.mode,n,null)).return=e,t;Yo(e,t)}return null}function f(e,t,n,r){var a=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n)return null!==a?null:s(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case w:return n.key===a?c(e,t,n,r):null;case S:return n.key===a?u(e,t,n,r):null;case j:return f(e,t,(a=n._init)(n._payload),r)}if(te(n)||O(n))return null!==a?null:d(e,t,n,r,null);Yo(e,n)}return null}function h(e,t,n,r,a){if("string"==typeof r&&""!==r||"number"==typeof r)return s(t,e=e.get(n)||null,""+r,a);if("object"==typeof r&&null!==r){switch(r.$$typeof){case w:return c(t,e=e.get(null===r.key?n:r.key)||null,r,a);case S:return u(t,e=e.get(null===r.key?n:r.key)||null,r,a);case j:return h(e,t,n,(0,r._init)(r._payload),a)}if(te(r)||O(r))return d(t,e=e.get(n)||null,r,a,null);Yo(t,r)}return null}function g(a,o,l,s){for(var c=null,u=null,d=o,g=o=0,m=null;null!==d&&g<l.length;g++){d.index>g?(m=d,d=null):m=d.sibling;var v=f(a,d,l[g],s);if(null===v){null===d&&(d=m);break}e&&d&&null===v.alternate&&t(a,d),o=i(v,o,g),null===u?c=v:u.sibling=v,u=v,d=m}if(g===l.length)return n(a,d),ao&&Ja(a,g),c;if(null===d){for(;g<l.length;g++)null!==(d=p(a,l[g],s))&&(o=i(d,o,g),null===u?c=d:u.sibling=d,u=d);return ao&&Ja(a,g),c}for(d=r(a,d);g<l.length;g++)null!==(m=h(d,a,g,l[g],s))&&(e&&null!==m.alternate&&d.delete(null===m.key?g:m.key),o=i(m,o,g),null===u?c=m:u.sibling=m,u=m);return e&&d.forEach((function(e){return t(a,e)})),ao&&Ja(a,g),c}function m(a,l,s,c){var u=O(s);if("function"!=typeof u)throw Error(o(150));if(null==(s=u.call(s)))throw Error(o(151));for(var d=u=null,g=l,m=l=0,v=null,y=s.next();null!==g&&!y.done;m++,y=s.next()){g.index>m?(v=g,g=null):v=g.sibling;var b=f(a,g,y.value,c);if(null===b){null===g&&(g=v);break}e&&g&&null===b.alternate&&t(a,g),l=i(b,l,m),null===d?u=b:d.sibling=b,d=b,g=v}if(y.done)return n(a,g),ao&&Ja(a,m),u;if(null===g){for(;!y.done;m++,y=s.next())null!==(y=p(a,y.value,c))&&(l=i(y,l,m),null===d?u=y:d.sibling=y,d=y);return ao&&Ja(a,m),u}for(g=r(a,g);!y.done;m++,y=s.next())null!==(y=h(g,a,m,y.value,c))&&(e&&null!==y.alternate&&g.delete(null===y.key?m:y.key),l=i(y,l,m),null===d?u=y:d.sibling=y,d=y);return e&&g.forEach((function(e){return t(a,e)})),ao&&Ja(a,m),u}return function e(r,o,i,s){if("object"==typeof i&&null!==i&&i.type===k&&null===i.key&&(i=i.props.children),"object"==typeof i&&null!==i){switch(i.$$typeof){case w:e:{for(var c=i.key,u=o;null!==u;){if(u.key===c){if((c=i.type)===k){if(7===u.tag){n(r,u.sibling),(o=a(u,i.props.children)).return=r,r=o;break e}}else if(u.elementType===c||"object"==typeof c&&null!==c&&c.$$typeof===j&&Ko(c)===u.type){n(r,u.sibling),(o=a(u,i.props)).ref=Wo(r,u,i),o.return=r,r=o;break e}n(r,u);break}t(r,u),u=u.sibling}i.type===k?((o=Lc(i.props.children,r.mode,s,i.key)).return=r,r=o):((s=Oc(i.type,i.key,i.props,null,r.mode,s)).ref=Wo(r,o,i),s.return=r,r=s)}return l(r);case S:e:{for(u=i.key;null!==o;){if(o.key===u){if(4===o.tag&&o.stateNode.containerInfo===i.containerInfo&&o.stateNode.implementation===i.implementation){n(r,o.sibling),(o=a(o,i.children||[])).return=r,r=o;break e}n(r,o);break}t(r,o),o=o.sibling}(o=_c(i,r.mode,s)).return=r,r=o}return l(r);case j:return e(r,o,(u=i._init)(i._payload),s)}if(te(i))return g(r,o,i,s);if(O(i))return m(r,o,i,s);Yo(r,i)}return"string"==typeof i&&""!==i||"number"==typeof i?(i=""+i,null!==o&&6===o.tag?(n(r,o.sibling),(o=a(o,i)).return=r,r=o):(n(r,o),(o=Pc(i,r.mode,s)).return=r,r=o),l(r)):n(r,o)}}var Qo=Xo(!0),Jo=Xo(!1),Zo={},ei=Ca(Zo),ti=Ca(Zo),ni=Ca(Zo);function ri(e){if(e===Zo)throw Error(o(174));return e}function ai(e,t){switch(Aa(ni,t),Aa(ti,e),Aa(ei,Zo),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:se(null,"");break;default:t=se(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Ea(ei),Aa(ei,t)}function oi(){Ea(ei),Ea(ti),Ea(ni)}function ii(e){ri(ni.current);var t=ri(ei.current),n=se(t,e.type);t!==n&&(Aa(ti,e),Aa(ei,n))}function li(e){ti.current===e&&(Ea(ei),Ea(ti))}var si=Ca(0);function ci(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(128&t.flags)return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ui=[];function di(){for(var e=0;e<ui.length;e++)ui[e]._workInProgressVersionPrimary=null;ui.length=0}var pi=x.ReactCurrentDispatcher,fi=x.ReactCurrentBatchConfig,hi=0,gi=null,mi=null,vi=null,yi=!1,bi=!1,xi=0,wi=0;function Si(){throw Error(o(321))}function ki(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!lr(e[n],t[n]))return!1;return!0}function Ci(e,t,n,r,a,i){if(hi=i,gi=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,pi.current=null===e||null===e.memoizedState?ll:sl,e=n(r,a),bi){i=0;do{if(bi=!1,xi=0,25<=i)throw Error(o(301));i+=1,vi=mi=null,t.updateQueue=null,pi.current=cl,e=n(r,a)}while(bi)}if(pi.current=il,t=null!==mi&&null!==mi.next,hi=0,vi=mi=gi=null,yi=!1,t)throw Error(o(300));return e}function Ei(){var e=0!==xi;return xi=0,e}function Ai(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===vi?gi.memoizedState=vi=e:vi=vi.next=e,vi}function Ti(){if(null===mi){var e=gi.alternate;e=null!==e?e.memoizedState:null}else e=mi.next;var t=null===vi?gi.memoizedState:vi.next;if(null!==t)vi=t,mi=e;else{if(null===e)throw Error(o(310));e={memoizedState:(mi=e).memoizedState,baseState:mi.baseState,baseQueue:mi.baseQueue,queue:mi.queue,next:null},null===vi?gi.memoizedState=vi=e:vi=vi.next=e}return vi}function Ii(e,t){return"function"==typeof t?t(e):t}function zi(e){var t=Ti(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=mi,a=r.baseQueue,i=n.pending;if(null!==i){if(null!==a){var l=a.next;a.next=i.next,i.next=l}r.baseQueue=a=i,n.pending=null}if(null!==a){i=a.next,r=r.baseState;var s=l=null,c=null,u=i;do{var d=u.lane;if((hi&d)===d)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var p={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(s=c=p,l=r):c=c.next=p,gi.lanes|=d,Ns|=d}u=u.next}while(null!==u&&u!==i);null===c?l=r:c.next=s,lr(r,t.memoizedState)||(xl=!0),t.memoizedState=r,t.baseState=l,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){a=e;do{i=a.lane,gi.lanes|=i,Ns|=i,a=a.next}while(a!==e)}else null===a&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Fi(e){var t=Ti(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,i=t.memoizedState;if(null!==a){n.pending=null;var l=a=a.next;do{i=e(i,l.action),l=l.next}while(l!==a);lr(i,t.memoizedState)||(xl=!0),t.memoizedState=i,null===t.baseQueue&&(t.baseState=i),n.lastRenderedState=i}return[i,r]}function Mi(){}function ji(e,t){var n=gi,r=Ti(),a=t(),i=!lr(r.memoizedState,a);if(i&&(r.memoizedState=a,xl=!0),r=r.queue,Hi(Oi.bind(null,n,r,e),[e]),r.getSnapshot!==t||i||null!==vi&&1&vi.memoizedState.tag){if(n.flags|=2048,_i(9,Ri.bind(null,n,r,a,t),void 0,null),null===Fs)throw Error(o(349));30&hi||Bi(n,t,a)}return a}function Bi(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=gi.updateQueue)?(t={lastEffect:null,stores:null},gi.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Ri(e,t,n,r){t.value=n,t.getSnapshot=r,Li(t)&&Ni(e)}function Oi(e,t,n){return n((function(){Li(t)&&Ni(e)}))}function Li(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!lr(e,n)}catch(e){return!0}}function Ni(e){var t=Fo(e,1);null!==t&&rc(t,e,1,-1)}function Pi(e){var t=Ai();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ii,lastRenderedState:e},t.queue=e,e=e.dispatch=nl.bind(null,gi,e),[t.memoizedState,e]}function _i(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=gi.updateQueue)?(t={lastEffect:null,stores:null},gi.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Di(){return Ti().memoizedState}function qi(e,t,n,r){var a=Ai();gi.flags|=e,a.memoizedState=_i(1|t,n,void 0,void 0===r?null:r)}function Ui(e,t,n,r){var a=Ti();r=void 0===r?null:r;var o=void 0;if(null!==mi){var i=mi.memoizedState;if(o=i.destroy,null!==r&&ki(r,i.deps))return void(a.memoizedState=_i(t,n,o,r))}gi.flags|=e,a.memoizedState=_i(1|t,n,o,r)}function $i(e,t){return qi(8390656,8,e,t)}function Hi(e,t){return Ui(2048,8,e,t)}function Vi(e,t){return Ui(4,2,e,t)}function Gi(e,t){return Ui(4,4,e,t)}function Wi(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Yi(e,t,n){return n=null!=n?n.concat([e]):null,Ui(4,4,Wi.bind(null,t,e),n)}function Ki(){}function Xi(e,t){var n=Ti();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&ki(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Qi(e,t){var n=Ti();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&ki(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Ji(e,t,n){return 21&hi?(lr(n,t)||(n=gt(),gi.lanes|=n,Ns|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,xl=!0),e.memoizedState=n)}function Zi(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var r=fi.transition;fi.transition={};try{e(!1),t()}finally{bt=n,fi.transition=r}}function el(){return Ti().memoizedState}function tl(e,t,n){var r=nc(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},rl(e))al(t,n);else if(null!==(n=zo(e,t,n,r))){rc(n,e,r,tc()),ol(n,t,r)}}function nl(e,t,n){var r=nc(e),a={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(rl(e))al(t,a);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var i=t.lastRenderedState,l=o(i,n);if(a.hasEagerState=!0,a.eagerState=l,lr(l,i)){var s=t.interleaved;return null===s?(a.next=a,Io(t)):(a.next=s.next,s.next=a),void(t.interleaved=a)}}catch(e){}null!==(n=zo(e,t,a,r))&&(rc(n,e,r,a=tc()),ol(n,t,r))}}function rl(e){var t=e.alternate;return e===gi||null!==t&&t===gi}function al(e,t){bi=yi=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function ol(e,t,n){if(4194240&n){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}var il={readContext:Ao,useCallback:Si,useContext:Si,useEffect:Si,useImperativeHandle:Si,useInsertionEffect:Si,useLayoutEffect:Si,useMemo:Si,useReducer:Si,useRef:Si,useState:Si,useDebugValue:Si,useDeferredValue:Si,useTransition:Si,useMutableSource:Si,useSyncExternalStore:Si,useId:Si,unstable_isNewReconciler:!1},ll={readContext:Ao,useCallback:function(e,t){return Ai().memoizedState=[e,void 0===t?null:t],e},useContext:Ao,useEffect:$i,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,qi(4194308,4,Wi.bind(null,t,e),n)},useLayoutEffect:function(e,t){return qi(4194308,4,e,t)},useInsertionEffect:function(e,t){return qi(4,2,e,t)},useMemo:function(e,t){var n=Ai();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Ai();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=tl.bind(null,gi,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Ai().memoizedState=e},useState:Pi,useDebugValue:Ki,useDeferredValue:function(e){return Ai().memoizedState=e},useTransition:function(){var e=Pi(!1),t=e[0];return e=Zi.bind(null,e[1]),Ai().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=gi,a=Ai();if(ao){if(void 0===n)throw Error(o(407));n=n()}else{if(n=t(),null===Fs)throw Error(o(349));30&hi||Bi(r,t,n)}a.memoizedState=n;var i={value:n,getSnapshot:t};return a.queue=i,$i(Oi.bind(null,r,i,e),[e]),r.flags|=2048,_i(9,Ri.bind(null,r,i,n,t),void 0,null),n},useId:function(){var e=Ai(),t=Fs.identifierPrefix;if(ao){var n=Qa;t=":"+t+"R"+(n=(Xa&~(1<<32-it(Xa)-1)).toString(32)+n),0<(n=xi++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=wi++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},sl={readContext:Ao,useCallback:Xi,useContext:Ao,useEffect:Hi,useImperativeHandle:Yi,useInsertionEffect:Vi,useLayoutEffect:Gi,useMemo:Qi,useReducer:zi,useRef:Di,useState:function(){return zi(Ii)},useDebugValue:Ki,useDeferredValue:function(e){return Ji(Ti(),mi.memoizedState,e)},useTransition:function(){return[zi(Ii)[0],Ti().memoizedState]},useMutableSource:Mi,useSyncExternalStore:ji,useId:el,unstable_isNewReconciler:!1},cl={readContext:Ao,useCallback:Xi,useContext:Ao,useEffect:Hi,useImperativeHandle:Yi,useInsertionEffect:Vi,useLayoutEffect:Gi,useMemo:Qi,useReducer:Fi,useRef:Di,useState:function(){return Fi(Ii)},useDebugValue:Ki,useDeferredValue:function(e){var t=Ti();return null===mi?t.memoizedState=e:Ji(t,mi.memoizedState,e)},useTransition:function(){return[Fi(Ii)[0],Ti().memoizedState]},useMutableSource:Mi,useSyncExternalStore:ji,useId:el,unstable_isNewReconciler:!1};function ul(e,t){try{var n="",r=t;do{n+=q(r),r=r.return}while(r);var a=n}catch(e){a="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:t,stack:a,digest:null}}function dl(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function pl(e,t){try{console.error(t.value)}catch(e){setTimeout((function(){throw e}))}}var fl="function"==typeof WeakMap?WeakMap:Map;function hl(e,t,n){(n=Ro(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Vs||(Vs=!0,Gs=r),pl(0,t)},n}function gl(e,t,n){(n=Ro(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"==typeof r){var a=t.value;n.payload=function(){return r(a)},n.callback=function(){pl(0,t)}}var o=e.stateNode;return null!==o&&"function"==typeof o.componentDidCatch&&(n.callback=function(){pl(0,t),"function"!=typeof r&&(null===Ws?Ws=new Set([this]):Ws.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ml(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new fl;var a=new Set;r.set(t,a)}else void 0===(a=r.get(t))&&(a=new Set,r.set(t,a));a.has(n)||(a.add(n),e=Ac.bind(null,e,t,n),t.then(e,e))}function vl(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function yl(e,t,n,r,a){return 1&e.mode?(e.flags|=65536,e.lanes=a,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Ro(-1,1)).tag=2,Oo(n,t,1))),n.lanes|=1),e)}var bl=x.ReactCurrentOwner,xl=!1;function wl(e,t,n,r){t.child=null===e?Jo(t,null,n,r):Qo(t,e.child,n,r)}function Sl(e,t,n,r,a){n=n.render;var o=t.ref;return Eo(t,a),r=Ci(e,t,n,r,o,a),n=Ei(),null===e||xl?(ao&&n&&eo(t),t.flags|=1,wl(e,t,r,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Vl(e,t,a))}function kl(e,t,n,r,a){if(null===e){var o=n.type;return"function"!=typeof o||Bc(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Oc(n.type,null,r,t,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Cl(e,t,o,r,a))}if(o=e.child,!(e.lanes&a)){var i=o.memoizedProps;if((n=null!==(n=n.compare)?n:sr)(i,r)&&e.ref===t.ref)return Vl(e,t,a)}return t.flags|=1,(e=Rc(o,r)).ref=t.ref,e.return=t,t.child=e}function Cl(e,t,n,r,a){if(null!==e){var o=e.memoizedProps;if(sr(o,r)&&e.ref===t.ref){if(xl=!1,t.pendingProps=r=o,!(e.lanes&a))return t.lanes=e.lanes,Vl(e,t,a);131072&e.flags&&(xl=!0)}}return Tl(e,t,n,r,a)}function El(e,t,n){var r=t.pendingProps,a=r.children,o=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(1&t.mode){if(!(1073741824&n))return e=null!==o?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Aa(Rs,Bs),Bs|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==o?o.baseLanes:n,Aa(Rs,Bs),Bs|=r}else t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Aa(Rs,Bs),Bs|=n;else null!==o?(r=o.baseLanes|n,t.memoizedState=null):r=n,Aa(Rs,Bs),Bs|=r;return wl(e,t,a,n),t.child}function Al(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Tl(e,t,n,r,a){var o=ja(n)?Fa:Ia.current;return o=Ma(t,o),Eo(t,a),n=Ci(e,t,n,r,o,a),r=Ei(),null===e||xl?(ao&&r&&eo(t),t.flags|=1,wl(e,t,n,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Vl(e,t,a))}function Il(e,t,n,r,a){if(ja(n)){var o=!0;La(t)}else o=!1;if(Eo(t,a),null===t.stateNode)Hl(e,t),Ho(t,n,r),Go(t,n,r,a),r=!0;else if(null===e){var i=t.stateNode,l=t.memoizedProps;i.props=l;var s=i.context,c=n.contextType;"object"==typeof c&&null!==c?c=Ao(c):c=Ma(t,c=ja(n)?Fa:Ia.current);var u=n.getDerivedStateFromProps,d="function"==typeof u||"function"==typeof i.getSnapshotBeforeUpdate;d||"function"!=typeof i.UNSAFE_componentWillReceiveProps&&"function"!=typeof i.componentWillReceiveProps||(l!==r||s!==c)&&Vo(t,i,r,c),Mo=!1;var p=t.memoizedState;i.state=p,Po(t,r,i,a),s=t.memoizedState,l!==r||p!==s||za.current||Mo?("function"==typeof u&&(qo(t,n,u,r),s=t.memoizedState),(l=Mo||$o(t,n,l,r,p,s,c))?(d||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||("function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount()),"function"==typeof i.componentDidMount&&(t.flags|=4194308)):("function"==typeof i.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=s),i.props=r,i.state=s,i.context=c,r=l):("function"==typeof i.componentDidMount&&(t.flags|=4194308),r=!1)}else{i=t.stateNode,Bo(e,t),l=t.memoizedProps,c=t.type===t.elementType?l:vo(t.type,l),i.props=c,d=t.pendingProps,p=i.context,"object"==typeof(s=n.contextType)&&null!==s?s=Ao(s):s=Ma(t,s=ja(n)?Fa:Ia.current);var f=n.getDerivedStateFromProps;(u="function"==typeof f||"function"==typeof i.getSnapshotBeforeUpdate)||"function"!=typeof i.UNSAFE_componentWillReceiveProps&&"function"!=typeof i.componentWillReceiveProps||(l!==d||p!==s)&&Vo(t,i,r,s),Mo=!1,p=t.memoizedState,i.state=p,Po(t,r,i,a);var h=t.memoizedState;l!==d||p!==h||za.current||Mo?("function"==typeof f&&(qo(t,n,f,r),h=t.memoizedState),(c=Mo||$o(t,n,c,r,p,h,s)||!1)?(u||"function"!=typeof i.UNSAFE_componentWillUpdate&&"function"!=typeof i.componentWillUpdate||("function"==typeof i.componentWillUpdate&&i.componentWillUpdate(r,h,s),"function"==typeof i.UNSAFE_componentWillUpdate&&i.UNSAFE_componentWillUpdate(r,h,s)),"function"==typeof i.componentDidUpdate&&(t.flags|=4),"function"==typeof i.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof i.componentDidUpdate||l===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),"function"!=typeof i.getSnapshotBeforeUpdate||l===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=h),i.props=r,i.state=h,i.context=s,r=c):("function"!=typeof i.componentDidUpdate||l===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),"function"!=typeof i.getSnapshotBeforeUpdate||l===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),r=!1)}return zl(e,t,n,r,o,a)}function zl(e,t,n,r,a,o){Al(e,t);var i=!!(128&t.flags);if(!r&&!i)return a&&Na(t,n,!1),Vl(e,t,o);r=t.stateNode,bl.current=t;var l=i&&"function"!=typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&i?(t.child=Qo(t,e.child,null,o),t.child=Qo(t,null,l,o)):wl(e,t,l,o),t.memoizedState=r.state,a&&Na(t,n,!0),t.child}function Fl(e){var t=e.stateNode;t.pendingContext?Ra(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Ra(0,t.context,!1),ai(e,t.containerInfo)}function Ml(e,t,n,r,a){return ho(),go(a),t.flags|=256,wl(e,t,n,r),t.child}var jl,Bl,Rl,Ol,Ll={dehydrated:null,treeContext:null,retryLane:0};function Nl(e){return{baseLanes:e,cachePool:null,transitions:null}}function Pl(e,t,n){var r,a=t.pendingProps,i=si.current,l=!1,s=!!(128&t.flags);if((r=s)||(r=(null===e||null!==e.memoizedState)&&!!(2&i)),r?(l=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(i|=1),Aa(si,1&i),null===e)return co(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(1&t.mode?"$!"===e.data?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(s=a.children,e=a.fallback,l?(a=t.mode,l=t.child,s={mode:"hidden",children:s},1&a||null===l?l=Nc(s,a,0,null):(l.childLanes=0,l.pendingProps=s),e=Lc(e,a,n,null),l.return=t,e.return=t,l.sibling=e,t.child=l,t.child.memoizedState=Nl(n),t.memoizedState=Ll,e):_l(t,s));if(null!==(i=e.memoizedState)&&null!==(r=i.dehydrated))return function(e,t,n,r,a,i,l){if(n)return 256&t.flags?(t.flags&=-257,Dl(e,t,l,r=dl(Error(o(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(i=r.fallback,a=t.mode,r=Nc({mode:"visible",children:r.children},a,0,null),(i=Lc(i,a,l,null)).flags|=2,r.return=t,i.return=t,r.sibling=i,t.child=r,1&t.mode&&Qo(t,e.child,null,l),t.child.memoizedState=Nl(l),t.memoizedState=Ll,i);if(!(1&t.mode))return Dl(e,t,l,null);if("$!"===a.data){if(r=a.nextSibling&&a.nextSibling.dataset)var s=r.dgst;return r=s,Dl(e,t,l,r=dl(i=Error(o(419)),r,void 0))}if(s=!!(l&e.childLanes),xl||s){if(null!==(r=Fs)){switch(l&-l){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}0!==(a=a&(r.suspendedLanes|l)?0:a)&&a!==i.retryLane&&(i.retryLane=a,Fo(e,a),rc(r,e,a,-1))}return mc(),Dl(e,t,l,r=dl(Error(o(421))))}return"$?"===a.data?(t.flags|=128,t.child=e.child,t=Ic.bind(null,e),a._reactRetry=t,null):(e=i.treeContext,ro=ca(a.nextSibling),no=t,ao=!0,oo=null,null!==e&&(Wa[Ya++]=Xa,Wa[Ya++]=Qa,Wa[Ya++]=Ka,Xa=e.id,Qa=e.overflow,Ka=t),t=_l(t,r.children),t.flags|=4096,t)}(e,t,s,a,r,i,n);if(l){l=a.fallback,s=t.mode,r=(i=e.child).sibling;var c={mode:"hidden",children:a.children};return 1&s||t.child===i?(a=Rc(i,c)).subtreeFlags=14680064&i.subtreeFlags:((a=t.child).childLanes=0,a.pendingProps=c,t.deletions=null),null!==r?l=Rc(r,l):(l=Lc(l,s,n,null)).flags|=2,l.return=t,a.return=t,a.sibling=l,t.child=a,a=l,l=t.child,s=null===(s=e.child.memoizedState)?Nl(n):{baseLanes:s.baseLanes|n,cachePool:null,transitions:s.transitions},l.memoizedState=s,l.childLanes=e.childLanes&~n,t.memoizedState=Ll,a}return e=(l=e.child).sibling,a=Rc(l,{mode:"visible",children:a.children}),!(1&t.mode)&&(a.lanes=n),a.return=t,a.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=a,t.memoizedState=null,a}function _l(e,t){return(t=Nc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Dl(e,t,n,r){return null!==r&&go(r),Qo(t,e.child,null,n),(e=_l(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function ql(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Co(e.return,t,n)}function Ul(e,t,n,r,a){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=a)}function $l(e,t,n){var r=t.pendingProps,a=r.revealOrder,o=r.tail;if(wl(e,t,r.children,n),2&(r=si.current))r=1&r|2,t.flags|=128;else{if(null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&ql(e,n,t);else if(19===e.tag)ql(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Aa(si,r),1&t.mode)switch(a){case"forwards":for(n=t.child,a=null;null!==n;)null!==(e=n.alternate)&&null===ci(e)&&(a=n),n=n.sibling;null===(n=a)?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),Ul(t,!1,a,n,o);break;case"backwards":for(n=null,a=t.child,t.child=null;null!==a;){if(null!==(e=a.alternate)&&null===ci(e)){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}Ul(t,!0,n,null,o);break;case"together":Ul(t,!1,null,null,void 0);break;default:t.memoizedState=null}else t.memoizedState=null;return t.child}function Hl(e,t){!(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Vl(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Ns|=t.lanes,!(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=Rc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Rc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Gl(e,t){if(!ao)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Wl(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=14680064&a.subtreeFlags,r|=14680064&a.flags,a.return=e,a=a.sibling;else for(a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Yl(e,t,n){var r=t.pendingProps;switch(to(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Wl(t),null;case 1:case 17:return ja(t.type)&&Ba(),Wl(t),null;case 3:return r=t.stateNode,oi(),Ea(za),Ea(Ia),di(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(po(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,null!==oo&&(lc(oo),oo=null))),Bl(e,t),Wl(t),null;case 5:li(t);var a=ri(ni.current);if(n=t.type,null!==e&&null!=t.stateNode)Rl(e,t,n,r,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(o(166));return Wl(t),null}if(e=ri(ei.current),po(t)){r=t.stateNode,n=t.type;var i=t.memoizedProps;switch(r[pa]=t,r[fa]=i,e=!!(1&t.mode),n){case"dialog":_r("cancel",r),_r("close",r);break;case"iframe":case"object":case"embed":_r("load",r);break;case"video":case"audio":for(a=0;a<Or.length;a++)_r(Or[a],r);break;case"source":_r("error",r);break;case"img":case"image":case"link":_r("error",r),_r("load",r);break;case"details":_r("toggle",r);break;case"input":X(r,i),_r("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},_r("invalid",r);break;case"textarea":ae(r,i),_r("invalid",r)}for(var s in ye(n,i),a=null,i)if(i.hasOwnProperty(s)){var c=i[s];"children"===s?"string"==typeof c?r.textContent!==c&&(!0!==i.suppressHydrationWarning&&Jr(r.textContent,c,e),a=["children",c]):"number"==typeof c&&r.textContent!==""+c&&(!0!==i.suppressHydrationWarning&&Jr(r.textContent,c,e),a=["children",""+c]):l.hasOwnProperty(s)&&null!=c&&"onScroll"===s&&_r("scroll",r)}switch(n){case"input":G(r),Z(r,i,!0);break;case"textarea":G(r),ie(r);break;case"select":case"option":break;default:"function"==typeof i.onClick&&(r.onclick=Zr)}r=a,t.updateQueue=r,null!==r&&(t.flags|=4)}else{s=9===a.nodeType?a:a.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=le(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=s.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof r.is?e=s.createElement(n,{is:r.is}):(e=s.createElement(n),"select"===n&&(s=e,r.multiple?s.multiple=!0:r.size&&(s.size=r.size))):e=s.createElementNS(e,n),e[pa]=t,e[fa]=r,jl(e,t,!1,!1),t.stateNode=e;e:{switch(s=be(n,r),n){case"dialog":_r("cancel",e),_r("close",e),a=r;break;case"iframe":case"object":case"embed":_r("load",e),a=r;break;case"video":case"audio":for(a=0;a<Or.length;a++)_r(Or[a],e);a=r;break;case"source":_r("error",e),a=r;break;case"img":case"image":case"link":_r("error",e),_r("load",e),a=r;break;case"details":_r("toggle",e),a=r;break;case"input":X(e,r),a=K(e,r),_r("invalid",e);break;case"option":default:a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=N({},r,{value:void 0}),_r("invalid",e);break;case"textarea":ae(e,r),a=re(e,r),_r("invalid",e)}for(i in ye(n,a),c=a)if(c.hasOwnProperty(i)){var u=c[i];"style"===i?me(e,u):"dangerouslySetInnerHTML"===i?null!=(u=u?u.__html:void 0)&&de(e,u):"children"===i?"string"==typeof u?("textarea"!==n||""!==u)&&pe(e,u):"number"==typeof u&&pe(e,""+u):"suppressContentEditableWarning"!==i&&"suppressHydrationWarning"!==i&&"autoFocus"!==i&&(l.hasOwnProperty(i)?null!=u&&"onScroll"===i&&_r("scroll",e):null!=u&&b(e,i,u,s))}switch(n){case"input":G(e),Z(e,r,!1);break;case"textarea":G(e),ie(e);break;case"option":null!=r.value&&e.setAttribute("value",""+H(r.value));break;case"select":e.multiple=!!r.multiple,null!=(i=r.value)?ne(e,!!r.multiple,i,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"==typeof a.onClick&&(e.onclick=Zr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Wl(t),null;case 6:if(e&&null!=t.stateNode)Ol(e,t,e.memoizedProps,r);else{if("string"!=typeof r&&null===t.stateNode)throw Error(o(166));if(n=ri(ni.current),ri(ei.current),po(t)){if(r=t.stateNode,n=t.memoizedProps,r[pa]=t,(i=r.nodeValue!==n)&&null!==(e=no))switch(e.tag){case 3:Jr(r.nodeValue,n,!!(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Jr(r.nodeValue,n,!!(1&e.mode))}i&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[pa]=t,t.stateNode=r}return Wl(t),null;case 13:if(Ea(si),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ao&&null!==ro&&1&t.mode&&!(128&t.flags))fo(),ho(),t.flags|=98560,i=!1;else if(i=po(t),null!==r&&null!==r.dehydrated){if(null===e){if(!i)throw Error(o(318));if(!(i=null!==(i=t.memoizedState)?i.dehydrated:null))throw Error(o(317));i[pa]=t}else ho(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Wl(t),i=!1}else null!==oo&&(lc(oo),oo=null),i=!0;if(!i)return 65536&t.flags?t:null}return 128&t.flags?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,1&t.mode&&(null===e||1&si.current?0===Os&&(Os=3):mc())),null!==t.updateQueue&&(t.flags|=4),Wl(t),null);case 4:return oi(),Bl(e,t),null===e&&Ur(t.stateNode.containerInfo),Wl(t),null;case 10:return ko(t.type._context),Wl(t),null;case 19:if(Ea(si),null===(i=t.memoizedState))return Wl(t),null;if(r=!!(128&t.flags),null===(s=i.rendering))if(r)Gl(i,!1);else{if(0!==Os||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(s=ci(e))){for(t.flags|=128,Gl(i,!1),null!==(r=s.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(i=n).flags&=14680066,null===(s=i.alternate)?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=s.childLanes,i.lanes=s.lanes,i.child=s.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=s.memoizedProps,i.memoizedState=s.memoizedState,i.updateQueue=s.updateQueue,i.type=s.type,e=s.dependencies,i.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Aa(si,1&si.current|2),t.child}e=e.sibling}null!==i.tail&&Qe()>$s&&(t.flags|=128,r=!0,Gl(i,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=ci(s))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Gl(i,!0),null===i.tail&&"hidden"===i.tailMode&&!s.alternate&&!ao)return Wl(t),null}else 2*Qe()-i.renderingStartTime>$s&&1073741824!==n&&(t.flags|=128,r=!0,Gl(i,!1),t.lanes=4194304);i.isBackwards?(s.sibling=t.child,t.child=s):(null!==(n=i.last)?n.sibling=s:t.child=s,i.last=s)}return null!==i.tail?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=Qe(),t.sibling=null,n=si.current,Aa(si,r?1&n|2:1&n),t):(Wl(t),null);case 22:case 23:return pc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&1&t.mode?!!(1073741824&Bs)&&(Wl(t),6&t.subtreeFlags&&(t.flags|=8192)):Wl(t),null;case 24:case 25:return null}throw Error(o(156,t.tag))}function Kl(e,t){switch(to(t),t.tag){case 1:return ja(t.type)&&Ba(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return oi(),Ea(za),Ea(Ia),di(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 5:return li(t),null;case 13:if(Ea(si),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(o(340));ho()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Ea(si),null;case 4:return oi(),null;case 10:return ko(t.type._context),null;case 22:case 23:return pc(),null;default:return null}}jl=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Bl=function(){},Rl=function(e,t,n,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,ri(ei.current);var o,i=null;switch(n){case"input":a=K(e,a),r=K(e,r),i=[];break;case"select":a=N({},a,{value:void 0}),r=N({},r,{value:void 0}),i=[];break;case"textarea":a=re(e,a),r=re(e,r),i=[];break;default:"function"!=typeof a.onClick&&"function"==typeof r.onClick&&(e.onclick=Zr)}for(u in ye(n,r),n=null,a)if(!r.hasOwnProperty(u)&&a.hasOwnProperty(u)&&null!=a[u])if("style"===u){var s=a[u];for(o in s)s.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(l.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var c=r[u];if(s=null!=a?a[u]:void 0,r.hasOwnProperty(u)&&c!==s&&(null!=c||null!=s))if("style"===u)if(s){for(o in s)!s.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&s[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(i||(i=[]),i.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,s=s?s.__html:void 0,null!=c&&s!==c&&(i=i||[]).push(u,c)):"children"===u?"string"!=typeof c&&"number"!=typeof c||(i=i||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(l.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&_r("scroll",e),i||s===c||(i=[])):(i=i||[]).push(u,c))}n&&(i=i||[]).push("style",n);var u=i;(t.updateQueue=u)&&(t.flags|=4)}},Ol=function(e,t,n,r){n!==r&&(t.flags|=4)};var Xl=!1,Ql=!1,Jl="function"==typeof WeakSet?WeakSet:Set,Zl=null;function es(e,t){var n=e.ref;if(null!==n)if("function"==typeof n)try{n(null)}catch(n){Ec(e,t,n)}else n.current=null}function ts(e,t,n){try{n()}catch(n){Ec(e,t,n)}}var ns=!1;function rs(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var a=r=r.next;do{if((a.tag&e)===e){var o=a.destroy;a.destroy=void 0,void 0!==o&&ts(t,n,o)}a=a.next}while(a!==r)}}function as(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function os(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"==typeof t?t(e):t.current=e}}function is(e){var t=e.alternate;null!==t&&(e.alternate=null,is(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[pa],delete t[fa],delete t[ga],delete t[ma],delete t[va])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ls(e){return 5===e.tag||3===e.tag||4===e.tag}function ss(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||ls(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function cs(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=Zr));else if(4!==r&&null!==(e=e.child))for(cs(e,t,n),e=e.sibling;null!==e;)cs(e,t,n),e=e.sibling}function us(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(us(e,t,n),e=e.sibling;null!==e;)us(e,t,n),e=e.sibling}var ds=null,ps=!1;function fs(e,t,n){for(n=n.child;null!==n;)hs(e,t,n),n=n.sibling}function hs(e,t,n){if(ot&&"function"==typeof ot.onCommitFiberUnmount)try{ot.onCommitFiberUnmount(at,n)}catch(e){}switch(n.tag){case 5:Ql||es(n,t);case 6:var r=ds,a=ps;ds=null,fs(e,t,n),ps=a,null!==(ds=r)&&(ps?(e=ds,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):ds.removeChild(n.stateNode));break;case 18:null!==ds&&(ps?(e=ds,n=n.stateNode,8===e.nodeType?sa(e.parentNode,n):1===e.nodeType&&sa(e,n),Ut(e)):sa(ds,n.stateNode));break;case 4:r=ds,a=ps,ds=n.stateNode.containerInfo,ps=!0,fs(e,t,n),ds=r,ps=a;break;case 0:case 11:case 14:case 15:if(!Ql&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){a=r=r.next;do{var o=a,i=o.destroy;o=o.tag,void 0!==i&&(2&o||4&o)&&ts(n,t,i),a=a.next}while(a!==r)}fs(e,t,n);break;case 1:if(!Ql&&(es(n,t),"function"==typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(e){Ec(n,t,e)}fs(e,t,n);break;case 21:fs(e,t,n);break;case 22:1&n.mode?(Ql=(r=Ql)||null!==n.memoizedState,fs(e,t,n),Ql=r):fs(e,t,n);break;default:fs(e,t,n)}}function gs(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Jl),t.forEach((function(t){var r=zc.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function ms(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var a=n[r];try{var i=e,l=t,s=l;e:for(;null!==s;){switch(s.tag){case 5:ds=s.stateNode,ps=!1;break e;case 3:case 4:ds=s.stateNode.containerInfo,ps=!0;break e}s=s.return}if(null===ds)throw Error(o(160));hs(i,l,a),ds=null,ps=!1;var c=a.alternate;null!==c&&(c.return=null),a.return=null}catch(e){Ec(a,t,e)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)vs(t,e),t=t.sibling}function vs(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ms(t,e),ys(e),4&r){try{rs(3,e,e.return),as(3,e)}catch(t){Ec(e,e.return,t)}try{rs(5,e,e.return)}catch(t){Ec(e,e.return,t)}}break;case 1:ms(t,e),ys(e),512&r&&null!==n&&es(n,n.return);break;case 5:if(ms(t,e),ys(e),512&r&&null!==n&&es(n,n.return),32&e.flags){var a=e.stateNode;try{pe(a,"")}catch(t){Ec(e,e.return,t)}}if(4&r&&null!=(a=e.stateNode)){var i=e.memoizedProps,l=null!==n?n.memoizedProps:i,s=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===s&&"radio"===i.type&&null!=i.name&&Q(a,i),be(s,l);var u=be(s,i);for(l=0;l<c.length;l+=2){var d=c[l],p=c[l+1];"style"===d?me(a,p):"dangerouslySetInnerHTML"===d?de(a,p):"children"===d?pe(a,p):b(a,d,p,u)}switch(s){case"input":J(a,i);break;case"textarea":oe(a,i);break;case"select":var f=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!i.multiple;var h=i.value;null!=h?ne(a,!!i.multiple,h,!1):f!==!!i.multiple&&(null!=i.defaultValue?ne(a,!!i.multiple,i.defaultValue,!0):ne(a,!!i.multiple,i.multiple?[]:"",!1))}a[fa]=i}catch(t){Ec(e,e.return,t)}}break;case 6:if(ms(t,e),ys(e),4&r){if(null===e.stateNode)throw Error(o(162));a=e.stateNode,i=e.memoizedProps;try{a.nodeValue=i}catch(t){Ec(e,e.return,t)}}break;case 3:if(ms(t,e),ys(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Ut(t.containerInfo)}catch(t){Ec(e,e.return,t)}break;case 4:default:ms(t,e),ys(e);break;case 13:ms(t,e),ys(e),8192&(a=e.child).flags&&(i=null!==a.memoizedState,a.stateNode.isHidden=i,!i||null!==a.alternate&&null!==a.alternate.memoizedState||(Us=Qe())),4&r&&gs(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?(Ql=(u=Ql)||d,ms(t,e),Ql=u):ms(t,e),ys(e),8192&r){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&1&e.mode)for(Zl=e,d=e.child;null!==d;){for(p=Zl=d;null!==Zl;){switch(h=(f=Zl).child,f.tag){case 0:case 11:case 14:case 15:rs(4,f,f.return);break;case 1:es(f,f.return);var g=f.stateNode;if("function"==typeof g.componentWillUnmount){r=f,n=f.return;try{t=r,g.props=t.memoizedProps,g.state=t.memoizedState,g.componentWillUnmount()}catch(e){Ec(r,n,e)}}break;case 5:es(f,f.return);break;case 22:if(null!==f.memoizedState){Ss(p);continue}}null!==h?(h.return=f,Zl=h):Ss(p)}d=d.sibling}e:for(d=null,p=e;;){if(5===p.tag){if(null===d){d=p;try{a=p.stateNode,u?"function"==typeof(i=a.style).setProperty?i.setProperty("display","none","important"):i.display="none":(s=p.stateNode,l=null!=(c=p.memoizedProps.style)&&c.hasOwnProperty("display")?c.display:null,s.style.display=ge("display",l))}catch(t){Ec(e,e.return,t)}}}else if(6===p.tag){if(null===d)try{p.stateNode.nodeValue=u?"":p.memoizedProps}catch(t){Ec(e,e.return,t)}}else if((22!==p.tag&&23!==p.tag||null===p.memoizedState||p===e)&&null!==p.child){p.child.return=p,p=p.child;continue}if(p===e)break e;for(;null===p.sibling;){if(null===p.return||p.return===e)break e;d===p&&(d=null),p=p.return}d===p&&(d=null),p.sibling.return=p.return,p=p.sibling}}break;case 19:ms(t,e),ys(e),4&r&&gs(e);case 21:}}function ys(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(ls(n)){var r=n;break e}n=n.return}throw Error(o(160))}switch(r.tag){case 5:var a=r.stateNode;32&r.flags&&(pe(a,""),r.flags&=-33),us(e,ss(e),a);break;case 3:case 4:var i=r.stateNode.containerInfo;cs(e,ss(e),i);break;default:throw Error(o(161))}}catch(t){Ec(e,e.return,t)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function bs(e,t,n){Zl=e,xs(e,t,n)}function xs(e,t,n){for(var r=!!(1&e.mode);null!==Zl;){var a=Zl,o=a.child;if(22===a.tag&&r){var i=null!==a.memoizedState||Xl;if(!i){var l=a.alternate,s=null!==l&&null!==l.memoizedState||Ql;l=Xl;var c=Ql;if(Xl=i,(Ql=s)&&!c)for(Zl=a;null!==Zl;)s=(i=Zl).child,22===i.tag&&null!==i.memoizedState?ks(a):null!==s?(s.return=i,Zl=s):ks(a);for(;null!==o;)Zl=o,xs(o,t,n),o=o.sibling;Zl=a,Xl=l,Ql=c}ws(e)}else 8772&a.subtreeFlags&&null!==o?(o.return=a,Zl=o):ws(e)}}function ws(e){for(;null!==Zl;){var t=Zl;if(8772&t.flags){var n=t.alternate;try{if(8772&t.flags)switch(t.tag){case 0:case 11:case 15:Ql||as(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Ql)if(null===n)r.componentDidMount();else{var a=t.elementType===t.type?n.memoizedProps:vo(t.type,n.memoizedProps);r.componentDidUpdate(a,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;null!==i&&_o(t,i,r);break;case 3:var l=t.updateQueue;if(null!==l){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}_o(t,l,n)}break;case 5:var s=t.stateNode;if(null===n&&4&t.flags){n=s;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var p=d.dehydrated;null!==p&&Ut(p)}}}break;default:throw Error(o(163))}Ql||512&t.flags&&os(t)}catch(e){Ec(t,t.return,e)}}if(t===e){Zl=null;break}if(null!==(n=t.sibling)){n.return=t.return,Zl=n;break}Zl=t.return}}function Ss(e){for(;null!==Zl;){var t=Zl;if(t===e){Zl=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Zl=n;break}Zl=t.return}}function ks(e){for(;null!==Zl;){var t=Zl;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{as(4,t)}catch(e){Ec(t,n,e)}break;case 1:var r=t.stateNode;if("function"==typeof r.componentDidMount){var a=t.return;try{r.componentDidMount()}catch(e){Ec(t,a,e)}}var o=t.return;try{os(t)}catch(e){Ec(t,o,e)}break;case 5:var i=t.return;try{os(t)}catch(e){Ec(t,i,e)}}}catch(e){Ec(t,t.return,e)}if(t===e){Zl=null;break}var l=t.sibling;if(null!==l){l.return=t.return,Zl=l;break}Zl=t.return}}var Cs,Es=Math.ceil,As=x.ReactCurrentDispatcher,Ts=x.ReactCurrentOwner,Is=x.ReactCurrentBatchConfig,zs=0,Fs=null,Ms=null,js=0,Bs=0,Rs=Ca(0),Os=0,Ls=null,Ns=0,Ps=0,_s=0,Ds=null,qs=null,Us=0,$s=1/0,Hs=null,Vs=!1,Gs=null,Ws=null,Ys=!1,Ks=null,Xs=0,Qs=0,Js=null,Zs=-1,ec=0;function tc(){return 6&zs?Qe():-1!==Zs?Zs:Zs=Qe()}function nc(e){return 1&e.mode?2&zs&&0!==js?js&-js:null!==mo.transition?(0===ec&&(ec=gt()),ec):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Xt(e.type):1}function rc(e,t,n,r){if(50<Qs)throw Qs=0,Js=null,Error(o(185));vt(e,n,r),2&zs&&e===Fs||(e===Fs&&(!(2&zs)&&(Ps|=n),4===Os&&sc(e,js)),ac(e,r),1===n&&0===zs&&!(1&t.mode)&&($s=Qe()+500,_a&&Ua()))}function ac(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,o=e.pendingLanes;0<o;){var i=31-it(o),l=1<<i,s=a[i];-1===s?l&n&&!(l&r)||(a[i]=ft(l,t)):s<=t&&(e.expiredLanes|=l),o&=~l}}(e,t);var r=pt(e,e===Fs?js:0);if(0===r)null!==n&&Ye(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Ye(n),1===t)0===e.tag?function(e){_a=!0,qa(e)}(cc.bind(null,e)):qa(cc.bind(null,e)),ia((function(){!(6&zs)&&Ua()})),n=null;else{switch(xt(r)){case 1:n=Ze;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Fc(n,oc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function oc(e,t){if(Zs=-1,ec=0,6&zs)throw Error(o(327));var n=e.callbackNode;if(kc()&&e.callbackNode!==n)return null;var r=pt(e,e===Fs?js:0);if(0===r)return null;if(30&r||r&e.expiredLanes||t)t=vc(e,r);else{t=r;var a=zs;zs|=2;var i=gc();for(Fs===e&&js===t||(Hs=null,$s=Qe()+500,fc(e,t));;)try{bc();break}catch(t){hc(e,t)}So(),As.current=i,zs=a,null!==Ms?t=0:(Fs=null,js=0,t=Os)}if(0!==t){if(2===t&&(0!==(a=ht(e))&&(r=a,t=ic(e,a))),1===t)throw n=Ls,fc(e,0),sc(e,r),ac(e,Qe()),n;if(6===t)sc(e,r);else{if(a=e.current.alternate,!(30&r||function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var a=n[r],o=a.getSnapshot;a=a.value;try{if(!lr(o(),a))return!1}catch(e){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(a)||(t=vc(e,r),2===t&&(i=ht(e),0!==i&&(r=i,t=ic(e,i))),1!==t)))throw n=Ls,fc(e,0),sc(e,r),ac(e,Qe()),n;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(o(345));case 2:case 5:Sc(e,qs,Hs);break;case 3:if(sc(e,r),(130023424&r)===r&&10<(t=Us+500-Qe())){if(0!==pt(e,0))break;if(((a=e.suspendedLanes)&r)!==r){tc(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=ra(Sc.bind(null,e,qs,Hs),t);break}Sc(e,qs,Hs);break;case 4:if(sc(e,r),(4194240&r)===r)break;for(t=e.eventTimes,a=-1;0<r;){var l=31-it(r);i=1<<l,(l=t[l])>a&&(a=l),r&=~i}if(r=a,10<(r=(120>(r=Qe()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Es(r/1960))-r)){e.timeoutHandle=ra(Sc.bind(null,e,qs,Hs),r);break}Sc(e,qs,Hs);break;default:throw Error(o(329))}}}return ac(e,Qe()),e.callbackNode===n?oc.bind(null,e):null}function ic(e,t){var n=Ds;return e.current.memoizedState.isDehydrated&&(fc(e,t).flags|=256),2!==(e=vc(e,t))&&(t=qs,qs=n,null!==t&&lc(t)),e}function lc(e){null===qs?qs=e:qs.push.apply(qs,e)}function sc(e,t){for(t&=~_s,t&=~Ps,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-it(t),r=1<<n;e[n]=-1,t&=~r}}function cc(e){if(6&zs)throw Error(o(327));kc();var t=pt(e,0);if(!(1&t))return ac(e,Qe()),null;var n=vc(e,t);if(0!==e.tag&&2===n){var r=ht(e);0!==r&&(t=r,n=ic(e,r))}if(1===n)throw n=Ls,fc(e,0),sc(e,t),ac(e,Qe()),n;if(6===n)throw Error(o(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Sc(e,qs,Hs),ac(e,Qe()),null}function uc(e,t){var n=zs;zs|=1;try{return e(t)}finally{0===(zs=n)&&($s=Qe()+500,_a&&Ua())}}function dc(e){null!==Ks&&0===Ks.tag&&!(6&zs)&&kc();var t=zs;zs|=1;var n=Is.transition,r=bt;try{if(Is.transition=null,bt=1,e)return e()}finally{bt=r,Is.transition=n,!(6&(zs=t))&&Ua()}}function pc(){Bs=Rs.current,Ea(Rs)}function fc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,aa(n)),null!==Ms)for(n=Ms.return;null!==n;){var r=n;switch(to(r),r.tag){case 1:null!=(r=r.type.childContextTypes)&&Ba();break;case 3:oi(),Ea(za),Ea(Ia),di();break;case 5:li(r);break;case 4:oi();break;case 13:case 19:Ea(si);break;case 10:ko(r.type._context);break;case 22:case 23:pc()}n=n.return}if(Fs=e,Ms=e=Rc(e.current,null),js=Bs=t,Os=0,Ls=null,_s=Ps=Ns=0,qs=Ds=null,null!==To){for(t=0;t<To.length;t++)if(null!==(r=(n=To[t]).interleaved)){n.interleaved=null;var a=r.next,o=n.pending;if(null!==o){var i=o.next;o.next=a,r.next=i}n.pending=r}To=null}return e}function hc(e,t){for(;;){var n=Ms;try{if(So(),pi.current=il,yi){for(var r=gi.memoizedState;null!==r;){var a=r.queue;null!==a&&(a.pending=null),r=r.next}yi=!1}if(hi=0,vi=mi=gi=null,bi=!1,xi=0,Ts.current=null,null===n||null===n.return){Os=1,Ls=t,Ms=null;break}e:{var i=e,l=n.return,s=n,c=t;if(t=js,s.flags|=32768,null!==c&&"object"==typeof c&&"function"==typeof c.then){var u=c,d=s,p=d.tag;if(!(1&d.mode||0!==p&&11!==p&&15!==p)){var f=d.alternate;f?(d.updateQueue=f.updateQueue,d.memoizedState=f.memoizedState,d.lanes=f.lanes):(d.updateQueue=null,d.memoizedState=null)}var h=vl(l);if(null!==h){h.flags&=-257,yl(h,l,s,0,t),1&h.mode&&ml(i,u,t),c=u;var g=(t=h).updateQueue;if(null===g){var m=new Set;m.add(c),t.updateQueue=m}else g.add(c);break e}if(!(1&t)){ml(i,u,t),mc();break e}c=Error(o(426))}else if(ao&&1&s.mode){var v=vl(l);if(null!==v){!(65536&v.flags)&&(v.flags|=256),yl(v,l,s,0,t),go(ul(c,s));break e}}i=c=ul(c,s),4!==Os&&(Os=2),null===Ds?Ds=[i]:Ds.push(i),i=l;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t,No(i,hl(0,c,t));break e;case 1:s=c;var y=i.type,b=i.stateNode;if(!(128&i.flags||"function"!=typeof y.getDerivedStateFromError&&(null===b||"function"!=typeof b.componentDidCatch||null!==Ws&&Ws.has(b)))){i.flags|=65536,t&=-t,i.lanes|=t,No(i,gl(i,s,t));break e}}i=i.return}while(null!==i)}wc(n)}catch(e){t=e,Ms===n&&null!==n&&(Ms=n=n.return);continue}break}}function gc(){var e=As.current;return As.current=il,null===e?il:e}function mc(){0!==Os&&3!==Os&&2!==Os||(Os=4),null===Fs||!(268435455&Ns)&&!(268435455&Ps)||sc(Fs,js)}function vc(e,t){var n=zs;zs|=2;var r=gc();for(Fs===e&&js===t||(Hs=null,fc(e,t));;)try{yc();break}catch(t){hc(e,t)}if(So(),zs=n,As.current=r,null!==Ms)throw Error(o(261));return Fs=null,js=0,Os}function yc(){for(;null!==Ms;)xc(Ms)}function bc(){for(;null!==Ms&&!Ke();)xc(Ms)}function xc(e){var t=Cs(e.alternate,e,Bs);e.memoizedProps=e.pendingProps,null===t?wc(e):Ms=t,Ts.current=null}function wc(e){var t=e;do{var n=t.alternate;if(e=t.return,32768&t.flags){if(null!==(n=Kl(n,t)))return n.flags&=32767,void(Ms=n);if(null===e)return Os=6,void(Ms=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}else if(null!==(n=Yl(n,t,Bs)))return void(Ms=n);if(null!==(t=t.sibling))return void(Ms=t);Ms=t=e}while(null!==t);0===Os&&(Os=5)}function Sc(e,t,n){var r=bt,a=Is.transition;try{Is.transition=null,bt=1,function(e,t,n,r){do{kc()}while(null!==Ks);if(6&zs)throw Error(o(327));n=e.finishedWork;var a=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(o(177));e.callbackNode=null,e.callbackPriority=0;var i=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var a=31-it(n),o=1<<a;t[a]=0,r[a]=-1,e[a]=-1,n&=~o}}(e,i),e===Fs&&(Ms=Fs=null,js=0),!(2064&n.subtreeFlags)&&!(2064&n.flags)||Ys||(Ys=!0,Fc(tt,(function(){return kc(),null}))),i=!!(15990&n.flags),!!(15990&n.subtreeFlags)||i){i=Is.transition,Is.transition=null;var l=bt;bt=1;var s=zs;zs|=4,Ts.current=null,function(e,t){if(ea=Ht,fr(e=pr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var a=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch(e){n=null;break e}var l=0,s=-1,c=-1,u=0,d=0,p=e,f=null;t:for(;;){for(var h;p!==n||0!==a&&3!==p.nodeType||(s=l+a),p!==i||0!==r&&3!==p.nodeType||(c=l+r),3===p.nodeType&&(l+=p.nodeValue.length),null!==(h=p.firstChild);)f=p,p=h;for(;;){if(p===e)break t;if(f===n&&++u===a&&(s=l),f===i&&++d===r&&(c=l),null!==(h=p.nextSibling))break;f=(p=f).parentNode}p=h}n=-1===s||-1===c?null:{start:s,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ta={focusedElem:e,selectionRange:n},Ht=!1,Zl=t;null!==Zl;)if(e=(t=Zl).child,1028&t.subtreeFlags&&null!==e)e.return=t,Zl=e;else for(;null!==Zl;){t=Zl;try{var g=t.alternate;if(1024&t.flags)switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==g){var m=g.memoizedProps,v=g.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(t.elementType===t.type?m:vo(t.type,m),v);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var x=t.stateNode.containerInfo;1===x.nodeType?x.textContent="":9===x.nodeType&&x.documentElement&&x.removeChild(x.documentElement);break;default:throw Error(o(163))}}catch(e){Ec(t,t.return,e)}if(null!==(e=t.sibling)){e.return=t.return,Zl=e;break}Zl=t.return}g=ns,ns=!1}(e,n),vs(n,e),hr(ta),Ht=!!ea,ta=ea=null,e.current=n,bs(n,e,a),Xe(),zs=s,bt=l,Is.transition=i}else e.current=n;if(Ys&&(Ys=!1,Ks=e,Xs=a),i=e.pendingLanes,0===i&&(Ws=null),function(e){if(ot&&"function"==typeof ot.onCommitFiberRoot)try{ot.onCommitFiberRoot(at,e,void 0,!(128&~e.current.flags))}catch(e){}}(n.stateNode),ac(e,Qe()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)a=t[n],r(a.value,{componentStack:a.stack,digest:a.digest});if(Vs)throw Vs=!1,e=Gs,Gs=null,e;!!(1&Xs)&&0!==e.tag&&kc(),i=e.pendingLanes,1&i?e===Js?Qs++:(Qs=0,Js=e):Qs=0,Ua()}(e,t,n,r)}finally{Is.transition=a,bt=r}return null}function kc(){if(null!==Ks){var e=xt(Xs),t=Is.transition,n=bt;try{if(Is.transition=null,bt=16>e?16:e,null===Ks)var r=!1;else{if(e=Ks,Ks=null,Xs=0,6&zs)throw Error(o(331));var a=zs;for(zs|=4,Zl=e.current;null!==Zl;){var i=Zl,l=i.child;if(16&Zl.flags){var s=i.deletions;if(null!==s){for(var c=0;c<s.length;c++){var u=s[c];for(Zl=u;null!==Zl;){var d=Zl;switch(d.tag){case 0:case 11:case 15:rs(8,d,i)}var p=d.child;if(null!==p)p.return=d,Zl=p;else for(;null!==Zl;){var f=(d=Zl).sibling,h=d.return;if(is(d),d===u){Zl=null;break}if(null!==f){f.return=h,Zl=f;break}Zl=h}}}var g=i.alternate;if(null!==g){var m=g.child;if(null!==m){g.child=null;do{var v=m.sibling;m.sibling=null,m=v}while(null!==m)}}Zl=i}}if(2064&i.subtreeFlags&&null!==l)l.return=i,Zl=l;else e:for(;null!==Zl;){if(2048&(i=Zl).flags)switch(i.tag){case 0:case 11:case 15:rs(9,i,i.return)}var y=i.sibling;if(null!==y){y.return=i.return,Zl=y;break e}Zl=i.return}}var b=e.current;for(Zl=b;null!==Zl;){var x=(l=Zl).child;if(2064&l.subtreeFlags&&null!==x)x.return=l,Zl=x;else e:for(l=b;null!==Zl;){if(2048&(s=Zl).flags)try{switch(s.tag){case 0:case 11:case 15:as(9,s)}}catch(e){Ec(s,s.return,e)}if(s===l){Zl=null;break e}var w=s.sibling;if(null!==w){w.return=s.return,Zl=w;break e}Zl=s.return}}if(zs=a,Ua(),ot&&"function"==typeof ot.onPostCommitFiberRoot)try{ot.onPostCommitFiberRoot(at,e)}catch(e){}r=!0}return r}finally{bt=n,Is.transition=t}}return!1}function Cc(e,t,n){e=Oo(e,t=hl(0,t=ul(n,t),1),1),t=tc(),null!==e&&(vt(e,1,t),ac(e,t))}function Ec(e,t,n){if(3===e.tag)Cc(e,e,n);else for(;null!==t;){if(3===t.tag){Cc(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===Ws||!Ws.has(r))){t=Oo(t,e=gl(t,e=ul(n,e),1),1),e=tc(),null!==t&&(vt(t,1,e),ac(t,e));break}}t=t.return}}function Ac(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=tc(),e.pingedLanes|=e.suspendedLanes&n,Fs===e&&(js&n)===n&&(4===Os||3===Os&&(130023424&js)===js&&500>Qe()-Us?fc(e,0):_s|=n),ac(e,t)}function Tc(e,t){0===t&&(1&e.mode?(t=ut,!(130023424&(ut<<=1))&&(ut=4194304)):t=1);var n=tc();null!==(e=Fo(e,t))&&(vt(e,t,n),ac(e,n))}function Ic(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Tc(e,n)}function zc(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;null!==a&&(n=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(o(314))}null!==r&&r.delete(t),Tc(e,n)}function Fc(e,t){return We(e,t)}function Mc(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function jc(e,t,n,r){return new Mc(e,t,n,r)}function Bc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Rc(e,t){var n=e.alternate;return null===n?((n=jc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Oc(e,t,n,r,a,i){var l=2;if(r=e,"function"==typeof e)Bc(e)&&(l=1);else if("string"==typeof e)l=5;else e:switch(e){case k:return Lc(n.children,a,i,t);case C:l=8,a|=8;break;case E:return(e=jc(12,n,t,2|a)).elementType=E,e.lanes=i,e;case z:return(e=jc(13,n,t,a)).elementType=z,e.lanes=i,e;case F:return(e=jc(19,n,t,a)).elementType=F,e.lanes=i,e;case B:return Nc(n,a,i,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case A:l=10;break e;case T:l=9;break e;case I:l=11;break e;case M:l=14;break e;case j:l=16,r=null;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=jc(l,n,t,a)).elementType=e,t.type=r,t.lanes=i,t}function Lc(e,t,n,r){return(e=jc(7,e,r,t)).lanes=n,e}function Nc(e,t,n,r){return(e=jc(22,e,r,t)).elementType=B,e.lanes=n,e.stateNode={isHidden:!1},e}function Pc(e,t,n){return(e=jc(6,e,null,t)).lanes=n,e}function _c(e,t,n){return(t=jc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Dc(e,t,n,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mt(0),this.expirationTimes=mt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mt(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function qc(e,t,n,r,a,o,i,l,s){return e=new Dc(e,t,n,l,s),1===t?(t=1,!0===o&&(t|=8)):t=0,o=jc(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},jo(o),e}function Uc(e){if(!e)return Ta;e:{if(Ue(e=e._reactInternals)!==e||1!==e.tag)throw Error(o(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(ja(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(o(171))}if(1===e.tag){var n=e.type;if(ja(n))return Oa(e,n,t)}return t}function $c(e,t,n,r,a,o,i,l,s){return(e=qc(n,r,!0,e,0,o,0,l,s)).context=Uc(null),n=e.current,(o=Ro(r=tc(),a=nc(n))).callback=null!=t?t:null,Oo(n,o,a),e.current.lanes=a,vt(e,a,r),ac(e,r),e}function Hc(e,t,n,r){var a=t.current,o=tc(),i=nc(a);return n=Uc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Ro(o,i)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Oo(a,t,i))&&(rc(e,a,i,o),Lo(e,a,i)),i}function Vc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Gc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Wc(e,t){Gc(e,t),(e=e.alternate)&&Gc(e,t)}Cs=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||za.current)xl=!0;else{if(!(e.lanes&n||128&t.flags))return xl=!1,function(e,t,n){switch(t.tag){case 3:Fl(t),ho();break;case 5:ii(t);break;case 1:ja(t.type)&&La(t);break;case 4:ai(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,a=t.memoizedProps.value;Aa(yo,r._currentValue),r._currentValue=a;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Aa(si,1&si.current),t.flags|=128,null):n&t.child.childLanes?Pl(e,t,n):(Aa(si,1&si.current),null!==(e=Vl(e,t,n))?e.sibling:null);Aa(si,1&si.current);break;case 19:if(r=!!(n&t.childLanes),128&e.flags){if(r)return $l(e,t,n);t.flags|=128}if(null!==(a=t.memoizedState)&&(a.rendering=null,a.tail=null,a.lastEffect=null),Aa(si,si.current),r)break;return null;case 22:case 23:return t.lanes=0,El(e,t,n)}return Vl(e,t,n)}(e,t,n);xl=!!(131072&e.flags)}else xl=!1,ao&&1048576&t.flags&&Za(t,Ga,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Hl(e,t),e=t.pendingProps;var a=Ma(t,Ia.current);Eo(t,n),a=Ci(null,t,r,e,a,n);var i=Ei();return t.flags|=1,"object"==typeof a&&null!==a&&"function"==typeof a.render&&void 0===a.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,ja(r)?(i=!0,La(t)):i=!1,t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,jo(t),a.updater=Uo,t.stateNode=a,a._reactInternals=t,Go(t,r,e,n),t=zl(null,t,r,!0,i,n)):(t.tag=0,ao&&i&&eo(t),wl(null,t,a,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Hl(e,t),e=t.pendingProps,r=(a=r._init)(r._payload),t.type=r,a=t.tag=function(e){if("function"==typeof e)return Bc(e)?1:0;if(null!=e){if((e=e.$$typeof)===I)return 11;if(e===M)return 14}return 2}(r),e=vo(r,e),a){case 0:t=Tl(null,t,r,e,n);break e;case 1:t=Il(null,t,r,e,n);break e;case 11:t=Sl(null,t,r,e,n);break e;case 14:t=kl(null,t,r,vo(r.type,e),n);break e}throw Error(o(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,Tl(e,t,r,a=t.elementType===r?a:vo(r,a),n);case 1:return r=t.type,a=t.pendingProps,Il(e,t,r,a=t.elementType===r?a:vo(r,a),n);case 3:e:{if(Fl(t),null===e)throw Error(o(387));r=t.pendingProps,a=(i=t.memoizedState).element,Bo(e,t),Po(t,r,null,n);var l=t.memoizedState;if(r=l.element,i.isDehydrated){if(i={element:r,isDehydrated:!1,cache:l.cache,pendingSuspenseBoundaries:l.pendingSuspenseBoundaries,transitions:l.transitions},t.updateQueue.baseState=i,t.memoizedState=i,256&t.flags){t=Ml(e,t,r,n,a=ul(Error(o(423)),t));break e}if(r!==a){t=Ml(e,t,r,n,a=ul(Error(o(424)),t));break e}for(ro=ca(t.stateNode.containerInfo.firstChild),no=t,ao=!0,oo=null,n=Jo(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(ho(),r===a){t=Vl(e,t,n);break e}wl(e,t,r,n)}t=t.child}return t;case 5:return ii(t),null===e&&co(t),r=t.type,a=t.pendingProps,i=null!==e?e.memoizedProps:null,l=a.children,na(r,a)?l=null:null!==i&&na(r,i)&&(t.flags|=32),Al(e,t),wl(e,t,l,n),t.child;case 6:return null===e&&co(t),null;case 13:return Pl(e,t,n);case 4:return ai(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Qo(t,null,r,n):wl(e,t,r,n),t.child;case 11:return r=t.type,a=t.pendingProps,Sl(e,t,r,a=t.elementType===r?a:vo(r,a),n);case 7:return wl(e,t,t.pendingProps,n),t.child;case 8:case 12:return wl(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,i=t.memoizedProps,l=a.value,Aa(yo,r._currentValue),r._currentValue=l,null!==i)if(lr(i.value,l)){if(i.children===a.children&&!za.current){t=Vl(e,t,n);break e}}else for(null!==(i=t.child)&&(i.return=t);null!==i;){var s=i.dependencies;if(null!==s){l=i.child;for(var c=s.firstContext;null!==c;){if(c.context===r){if(1===i.tag){(c=Ro(-1,n&-n)).tag=2;var u=i.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}i.lanes|=n,null!==(c=i.alternate)&&(c.lanes|=n),Co(i.return,n,t),s.lanes|=n;break}c=c.next}}else if(10===i.tag)l=i.type===t.type?null:i.child;else if(18===i.tag){if(null===(l=i.return))throw Error(o(341));l.lanes|=n,null!==(s=l.alternate)&&(s.lanes|=n),Co(l,n,t),l=i.sibling}else l=i.child;if(null!==l)l.return=i;else for(l=i;null!==l;){if(l===t){l=null;break}if(null!==(i=l.sibling)){i.return=l.return,l=i;break}l=l.return}i=l}wl(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,Eo(t,n),r=r(a=Ao(a)),t.flags|=1,wl(e,t,r,n),t.child;case 14:return a=vo(r=t.type,t.pendingProps),kl(e,t,r,a=vo(r.type,a),n);case 15:return Cl(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:vo(r,a),Hl(e,t),t.tag=1,ja(r)?(e=!0,La(t)):e=!1,Eo(t,n),Ho(t,r,a),Go(t,r,a,n),zl(null,t,r,!0,e,n);case 19:return $l(e,t,n);case 22:return El(e,t,n)}throw Error(o(156,t.tag))};var Yc="function"==typeof reportError?reportError:function(e){console.error(e)};function Kc(e){this._internalRoot=e}function Xc(e){this._internalRoot=e}function Qc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Jc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Zc(){}function eu(e,t,n,r,a){var o=n._reactRootContainer;if(o){var i=o;if("function"==typeof a){var l=a;a=function(){var e=Vc(i);l.call(e)}}Hc(t,i,e,a)}else i=function(e,t,n,r,a){if(a){if("function"==typeof r){var o=r;r=function(){var e=Vc(i);o.call(e)}}var i=$c(t,r,e,0,null,!1,0,"",Zc);return e._reactRootContainer=i,e[ha]=i.current,Ur(8===e.nodeType?e.parentNode:e),dc(),i}for(;a=e.lastChild;)e.removeChild(a);if("function"==typeof r){var l=r;r=function(){var e=Vc(s);l.call(e)}}var s=qc(e,0,!1,null,0,!1,0,"",Zc);return e._reactRootContainer=s,e[ha]=s.current,Ur(8===e.nodeType?e.parentNode:e),dc((function(){Hc(t,s,n,r)})),s}(n,t,e,a,r);return Vc(i)}Xc.prototype.render=Kc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(o(409));Hc(e,t,null,null)},Xc.prototype.unmount=Kc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;dc((function(){Hc(null,e,null,null)})),t[ha]=null}},Xc.prototype.unstable_scheduleHydration=function(e){if(e){var t=Ct();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Bt.length&&0!==t&&t<Bt[n].priority;n++);Bt.splice(n,0,e),0===n&&Nt(e)}},wt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(yt(t,1|n),ac(t,Qe()),!(6&zs)&&($s=Qe()+500,Ua()))}break;case 13:dc((function(){var t=Fo(e,1);if(null!==t){var n=tc();rc(t,e,1,n)}})),Wc(e,1)}},St=function(e){if(13===e.tag){var t=Fo(e,134217728);if(null!==t)rc(t,e,134217728,tc());Wc(e,134217728)}},kt=function(e){if(13===e.tag){var t=nc(e),n=Fo(e,t);if(null!==n)rc(n,e,t,tc());Wc(e,t)}},Ct=function(){return bt},Et=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},Se=function(e,t,n){switch(t){case"input":if(J(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=wa(r);if(!a)throw Error(o(90));W(r),J(r,a)}}}break;case"textarea":oe(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ie=uc,ze=dc;var tu={usingClientEntryPoint:!1,Events:[ba,xa,wa,Ae,Te,uc]},nu={findFiberByHostInstance:ya,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},ru={bundleType:nu.bundleType,version:nu.version,rendererPackageName:nu.rendererPackageName,rendererConfig:nu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ve(e))?null:e.stateNode},findFiberByHostInstance:nu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var au=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!au.isDisabled&&au.supportsFiber)try{at=au.inject(ru),ot=au}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Qc(t))throw Error(o(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:S,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Qc(e))throw Error(o(299));var n=!1,r="",a=Yc;return null!=t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(a=t.onRecoverableError)),t=qc(e,1,!1,null,0,n,0,r,a),e[ha]=t.current,Ur(8===e.nodeType?e.parentNode:e),new Kc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(o(188));throw e=Object.keys(e).join(","),Error(o(268,e))}return e=null===(e=Ve(t))?null:e.stateNode},t.flushSync=function(e){return dc(e)},t.hydrate=function(e,t,n){if(!Jc(t))throw Error(o(200));return eu(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Qc(e))throw Error(o(405));var r=null!=n&&n.hydratedSources||null,a=!1,i="",l=Yc;if(null!=n&&(!0===n.unstable_strictMode&&(a=!0),void 0!==n.identifierPrefix&&(i=n.identifierPrefix),void 0!==n.onRecoverableError&&(l=n.onRecoverableError)),t=$c(t,null,e,1,null!=n?n:null,a,0,i,l),e[ha]=t.current,Ur(e),r)for(e=0;e<r.length;e++)a=(a=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,a]:t.mutableSourceEagerHydrationData.push(n,a);return new Xc(t)},t.render=function(e,t,n){if(!Jc(t))throw Error(o(200));return eu(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Jc(e))throw Error(o(40));return!!e._reactRootContainer&&(dc((function(){eu(null,null,e,!1,(function(){e._reactRootContainer=null,e[ha]=null}))})),!0)},t.unstable_batchedUpdates=uc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Jc(n))throw Error(o(200));if(null==e||void 0===e._reactInternals)throw Error(o(38));return eu(e,t,n,!1,r)},t.version="18.2.0-next-9e3b772b8-20220608"},338:(e,t,n)=>{var r=n(961);t.H=r.createRoot,r.hydrateRoot},961:(e,t,n)=>{!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=n(551)},799:(e,t)=>{
/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var n="function"==typeof Symbol&&Symbol.for,r=n?Symbol.for("react.element"):60103,a=n?Symbol.for("react.portal"):60106,o=n?Symbol.for("react.fragment"):60107,i=n?Symbol.for("react.strict_mode"):60108,l=n?Symbol.for("react.profiler"):60114,s=n?Symbol.for("react.provider"):60109,c=n?Symbol.for("react.context"):60110,u=n?Symbol.for("react.async_mode"):60111,d=n?Symbol.for("react.concurrent_mode"):60111,p=n?Symbol.for("react.forward_ref"):60112,f=n?Symbol.for("react.suspense"):60113,h=n?Symbol.for("react.suspense_list"):60120,g=n?Symbol.for("react.memo"):60115,m=n?Symbol.for("react.lazy"):60116,v=n?Symbol.for("react.block"):60121,y=n?Symbol.for("react.fundamental"):60117,b=n?Symbol.for("react.responder"):60118,x=n?Symbol.for("react.scope"):60119;function w(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type){case u:case d:case o:case l:case i:case f:return e;default:switch(e=e&&e.$$typeof){case c:case p:case m:case g:case s:return e;default:return t}}case a:return t}}}function S(e){return w(e)===d}t.AsyncMode=u,t.ConcurrentMode=d,t.ContextConsumer=c,t.ContextProvider=s,t.Element=r,t.ForwardRef=p,t.Fragment=o,t.Lazy=m,t.Memo=g,t.Portal=a,t.Profiler=l,t.StrictMode=i,t.Suspense=f,t.isAsyncMode=function(e){return S(e)||w(e)===u},t.isConcurrentMode=S,t.isContextConsumer=function(e){return w(e)===c},t.isContextProvider=function(e){return w(e)===s},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===r},t.isForwardRef=function(e){return w(e)===p},t.isFragment=function(e){return w(e)===o},t.isLazy=function(e){return w(e)===m},t.isMemo=function(e){return w(e)===g},t.isPortal=function(e){return w(e)===a},t.isProfiler=function(e){return w(e)===l},t.isStrictMode=function(e){return w(e)===i},t.isSuspense=function(e){return w(e)===f},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===o||e===d||e===l||e===i||e===f||e===h||"object"==typeof e&&null!==e&&(e.$$typeof===m||e.$$typeof===g||e.$$typeof===s||e.$$typeof===c||e.$$typeof===p||e.$$typeof===y||e.$$typeof===b||e.$$typeof===x||e.$$typeof===v)},t.typeOf=w},363:(e,t,n)=>{e.exports=n(799)},989:(e,t)=>{var n,r=Symbol.for("react.element"),a=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),c=Symbol.for("react.context"),u=Symbol.for("react.server_context"),d=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),f=Symbol.for("react.suspense_list"),h=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),m=Symbol.for("react.offscreen");
/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */function v(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type){case o:case l:case i:case p:case f:return e;default:switch(e=e&&e.$$typeof){case u:case c:case d:case g:case h:case s:return e;default:return t}}case a:return t}}}n=Symbol.for("react.module.reference")},737:(e,t,n)=>{n(989)},20:(e,t,n)=>{
/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var r=n(540),a=Symbol.for("react.element"),o=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,l=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,o={},c=null,u=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)i.call(t,r)&&!s.hasOwnProperty(r)&&(o[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===o[r]&&(o[r]=t[r]);return{$$typeof:a,type:e,key:c,ref:u,props:o,_owner:l.current}}t.Fragment=o,t.jsx=c,t.jsxs=c},287:(e,t)=>{
/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),s=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),f=Symbol.iterator;var h={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,m={};function v(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||h}function y(){}function b(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||h}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=v.prototype;var x=b.prototype=new y;x.constructor=b,g(x,v.prototype),x.isPureReactComponent=!0;var w=Array.isArray,S=Object.prototype.hasOwnProperty,k={current:null},C={key:!0,ref:!0,__self:!0,__source:!0};function E(e,t,r){var a,o={},i=null,l=null;if(null!=t)for(a in void 0!==t.ref&&(l=t.ref),void 0!==t.key&&(i=""+t.key),t)S.call(t,a)&&!C.hasOwnProperty(a)&&(o[a]=t[a]);var s=arguments.length-2;if(1===s)o.children=r;else if(1<s){for(var c=Array(s),u=0;u<s;u++)c[u]=arguments[u+2];o.children=c}if(e&&e.defaultProps)for(a in s=e.defaultProps)void 0===o[a]&&(o[a]=s[a]);return{$$typeof:n,type:e,key:i,ref:l,props:o,_owner:k.current}}function A(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var T=/\/+/g;function I(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function z(e,t,a,o,i){var l=typeof e;"undefined"!==l&&"boolean"!==l||(e=null);var s=!1;if(null===e)s=!0;else switch(l){case"string":case"number":s=!0;break;case"object":switch(e.$$typeof){case n:case r:s=!0}}if(s)return i=i(s=e),e=""===o?"."+I(s,0):o,w(i)?(a="",null!=e&&(a=e.replace(T,"$&/")+"/"),z(i,t,a,"",(function(e){return e}))):null!=i&&(A(i)&&(i=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(i,a+(!i.key||s&&s.key===i.key?"":(""+i.key).replace(T,"$&/")+"/")+e)),t.push(i)),1;if(s=0,o=""===o?".":o+":",w(e))for(var c=0;c<e.length;c++){var u=o+I(l=e[c],c);s+=z(l,t,a,u,i)}else if(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"==typeof u)for(e=u.call(e),c=0;!(l=e.next()).done;)s+=z(l=l.value,t,a,u=o+I(l,c++),i);else if("object"===l)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return s}function F(e,t,n){if(null==e)return e;var r=[],a=0;return z(e,r,"","",(function(e){return t.call(n,e,a++)})),r}function M(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var j={current:null},B={transition:null},R={ReactCurrentDispatcher:j,ReactCurrentBatchConfig:B,ReactCurrentOwner:k};function O(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:F,forEach:function(e,t,n){F(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return F(e,(function(){t++})),t},toArray:function(e){return F(e,(function(e){return e}))||[]},only:function(e){if(!A(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=a,t.Profiler=i,t.PureComponent=b,t.StrictMode=o,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=R,t.act=O,t.cloneElement=function(e,t,r){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var a=g({},e.props),o=e.key,i=e.ref,l=e._owner;if(null!=t){if(void 0!==t.ref&&(i=t.ref,l=k.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(c in t)S.call(t,c)&&!C.hasOwnProperty(c)&&(a[c]=void 0===t[c]&&void 0!==s?s[c]:t[c])}var c=arguments.length-2;if(1===c)a.children=r;else if(1<c){s=Array(c);for(var u=0;u<c;u++)s[u]=arguments[u+2];a.children=s}return{$$typeof:n,type:e.type,key:o,ref:i,props:a,_owner:l}},t.createContext=function(e){return(e={$$typeof:s,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:l,_context:e},e.Consumer=e},t.createElement=E,t.createFactory=function(e){var t=E.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=A,t.lazy=function(e){return{$$typeof:p,_payload:{_status:-1,_result:e},_init:M}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=B.transition;B.transition={};try{e()}finally{B.transition=t}},t.unstable_act=O,t.useCallback=function(e,t){return j.current.useCallback(e,t)},t.useContext=function(e){return j.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return j.current.useDeferredValue(e)},t.useEffect=function(e,t){return j.current.useEffect(e,t)},t.useId=function(){return j.current.useId()},t.useImperativeHandle=function(e,t,n){return j.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return j.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return j.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return j.current.useMemo(e,t)},t.useReducer=function(e,t,n){return j.current.useReducer(e,t,n)},t.useRef=function(e){return j.current.useRef(e)},t.useState=function(e){return j.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return j.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return j.current.useTransition()},t.version="18.3.1"},540:(e,t,n)=>{e.exports=n(287)},848:(e,t,n)=>{e.exports=n(20)},463:(e,t)=>{
/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,a=e[r];if(!(0<o(a,t)))break e;e[r]=t,e[n]=a,n=r}}function r(e){return 0===e.length?null:e[0]}function a(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length,i=a>>>1;r<i;){var l=2*(r+1)-1,s=e[l],c=l+1,u=e[c];if(0>o(s,n))c<a&&0>o(u,s)?(e[r]=u,e[c]=n,r=c):(e[r]=s,e[l]=n,r=l);else{if(!(c<a&&0>o(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var i=performance;t.unstable_now=function(){return i.now()}}else{var l=Date,s=l.now();t.unstable_now=function(){return l.now()-s}}var c=[],u=[],d=1,p=null,f=3,h=!1,g=!1,m=!1,v="function"==typeof setTimeout?setTimeout:null,y="function"==typeof clearTimeout?clearTimeout:null,b="undefined"!=typeof setImmediate?setImmediate:null;function x(e){for(var t=r(u);null!==t;){if(null===t.callback)a(u);else{if(!(t.startTime<=e))break;a(u),t.sortIndex=t.expirationTime,n(c,t)}t=r(u)}}function w(e){if(m=!1,x(e),!g)if(null!==r(c))g=!0,B(S);else{var t=r(u);null!==t&&R(w,t.startTime-e)}}function S(e,n){g=!1,m&&(m=!1,y(A),A=-1),h=!0;var o=f;try{for(x(n),p=r(c);null!==p&&(!(p.expirationTime>n)||e&&!z());){var i=p.callback;if("function"==typeof i){p.callback=null,f=p.priorityLevel;var l=i(p.expirationTime<=n);n=t.unstable_now(),"function"==typeof l?p.callback=l:p===r(c)&&a(c),x(n)}else a(c);p=r(c)}if(null!==p)var s=!0;else{var d=r(u);null!==d&&R(w,d.startTime-n),s=!1}return s}finally{p=null,f=o,h=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var k,C=!1,E=null,A=-1,T=5,I=-1;function z(){return!(t.unstable_now()-I<T)}function F(){if(null!==E){var e=t.unstable_now();I=e;var n=!0;try{n=E(!0,e)}finally{n?k():(C=!1,E=null)}}else C=!1}if("function"==typeof b)k=function(){b(F)};else if("undefined"!=typeof MessageChannel){var M=new MessageChannel,j=M.port2;M.port1.onmessage=F,k=function(){j.postMessage(null)}}else k=function(){v(F,0)};function B(e){E=e,C||(C=!0,k())}function R(e,n){A=v((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){g||h||(g=!0,B(S))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,a,o){var i=t.unstable_now();switch("object"==typeof o&&null!==o?o="number"==typeof(o=o.delay)&&0<o?i+o:i:o=i,e){case 1:var l=-1;break;case 2:l=250;break;case 5:l=1073741823;break;case 4:l=1e4;break;default:l=5e3}return e={id:d++,callback:a,priorityLevel:e,startTime:o,expirationTime:l=o+l,sortIndex:-1},o>i?(e.sortIndex=o,n(u,e),null===r(c)&&e===r(u)&&(m?(y(A),A=-1):m=!0,R(w,o-i))):(e.sortIndex=l,n(c,e),g||h||(g=!0,B(S))),e},t.unstable_shouldYield=z,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},982:(e,t,n)=>{e.exports=n(463)},55:(e,t,n)=>{var r;n.d(t,{d:()=>r}),function(e){e.LanguageLearning="language-learning",e.GeneralTopic="general-topic"}(r||(r={}))},75:(e,t,n)=>{n.r(t),n.d(t,{correctLinguisticInfo:()=>D,createCardComponentsParallel:()=>M,createExamples:()=>I,createFastLinguisticInfo:()=>$,createFlashcard:()=>z,createFormatPreservingTranslationPrompt:()=>R,createLinguisticInfo:()=>j,createOptimizedLinguisticInfo:()=>H,createQualityLinguisticPrompt:()=>B,createTranscription:()=>F,createTranslation:()=>T,createValidatedLinguisticInfo:()=>N,getAIService:()=>E,getApiKeyForProvider:()=>A,runMultipleValidation:()=>U,validateLinguisticInfo:()=>_});var r,a=n(148),o=function(e,t,n){var r="".concat(e," - ");return r+=401===t?"Authentication failed. Please open Settings and add a valid API key.":429===t?"Rate limit exceeded. Please try again later.":500===t||503===t?"Service unavailable. The model might be overloaded or offline.":400===t?"Bad request. The input may be invalid.":"Error code ".concat(t,". ").concat(i(n))},i=function(e){if(!e)return"Unknown error";if(e.error){if("string"==typeof e.error)return e.error;if(e.error.message)return e.error.message;if(e.error.type)return"Error type: ".concat(e.error.type)}if(e.message)return e.message;try{return JSON.stringify(e)}catch(e){return"Unable to parse error details"}},l=n(504),s=n(482),c=n(456),u=(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),d=function(){return d=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},d.apply(this,arguments)},p=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))},f=function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(s){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&l[0]?r.return:l[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,l[1])).done)return a;switch(r=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,r=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],r=0}finally{n=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}},h=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n},g=function(){function e(e,t){void 0===t&&(t=""),this.apiKey=e,this.modelName=t}return e.prototype.extractPlainText=function(e){if(!e)return null;var t=e.replace(/<\/?[^>]+(>|$)/g,"");return t=t.replace(/^#+\s+/gm,"").replace(/\*\*(.*?)\*\*/g,"$1").replace(/\*(.*?)\*/g,"$1").replace(/`(.*?)`/g,"$1").replace(/```[\s\S]*?```/g,"").replace(/\[(.*?)\]\((.*?)\)/g,"$1").trim()},e.prototype.getPrompts=function(){return{translate:function(e,t){return"Translate the following text to ".concat(t,': "').concat(e,'". \nOutput ONLY the direct translation, without any additional text, explanations, quotes, examples, or formatting.\nProvide the most common and appropriate translation. Only include multiple meanings if the word has distinctly different translations that are equally common.\nIf multiple translations are needed, separate them with commas (e.g., "\u043f\u0435\u0440\u0435\u0432\u043e\u04341, \u043f\u0435\u0440\u0435\u0432\u043e\u04342, \u043f\u0435\u0440\u0435\u0432\u043e\u04343").\nDo not include definitions, examples, notes, or part of speech information in English like (noun), (verb), (adjective), etc.\nOnly provide the clean translated word or phrase without any parenthetical information.')},examples:function(e,t){var n=t?"Give me exactly three example sentences using the word '".concat(e,"' in the language with code \"").concat(t,'".'):"Give me exactly three example sentences using the word '".concat(e,"' in its original language.");return"".concat(n,"\nEach sentence should show natural usage of '").concat(e,"' in that language.\nFormat your response as follows:\n1. [First example sentence here]\n2. [Second example sentence here] \n3. [Third example sentence here]\nDo not include definitions, explanations, or translations, ONLY the numbered example sentences as shown above.")},imageDescription:function(e){return'Create a short visual description of the word/concept "'.concat(e,'" for image generation.\nThe description should be concrete, visual, and focus on representational elements.\nKeep the description under 50 words and make sure it is purely descriptive without any formatting.')}}},e.prototype.translateText=function(e,t,n){return void 0===t&&(t="ru"),void 0===n&&(n=""),p(this,void 0,void 0,(function(){var r,a,o,i,s,c,u,d,p,h;return f(this,(function(f){switch(f.label){case 0:r=(0,l.cr)(),a=r.startRequest("Translating text","Converting your text to ".concat(t),"\u{1f30d}","#3B82F6"),f.label=1;case 1:return f.trys.push([1,3,,4]),r.setInProgress(a),o=this.getPrompts().translate(e,t),i=n?"".concat(o,". ").concat(n):o,[4,this.sendRequest(i)];case 2:return(s=f.sent())?(c=this.extractPlainText(s))&&(c=c.replace(/^translation[:\s-]*/i,"").replace(/^["']|["']$/g,"").replace(/^.*?:\s*/i,"").replace(/^\s*-\s*/,"").replace(/^translated\s*as\s*:?\s*/i,"").replace(/^\u043f\u0435\u0440\u0435\u0432\u043e\u0434\s*:?\s*/i,"").replace(/\s*definition:[\s\S]*$/i,"").replace(/\s*examples:[\s\S]*$/i,"").replace(/\s*example:[\s\S]*$/i,"").replace(/\s*example sentences:[\s\S]*$/i,"").replace(/\s*\u043f\u0440\u0438\u043c\u0435\u0440\u044b:[\s\S]*$/i,"").replace(/\s*\u043f\u0440\u0438\u043c\u0435\u0440:[\s\S]*$/i,"").replace(/\s*notes:[\s\S]*$/i,"").replace(/\s*\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435:[\s\S]*$/i,"").replace(/\s*here is the response[\s\S]*$/i,"").replace(/\s*\(adjective\)[\s\S]*$/i,"").replace(/\s*\(noun\)[\s\S]*$/i,"").replace(/\s*\(verb\)[\s\S]*$/i,"").replace(/\s*\(adverb\)[\s\S]*$/i,"").replace(/\s*\(preposition\)[\s\S]*$/i,"").replace(/\s*\(pronoun\)[\s\S]*$/i,"").replace(/\s*\(conjunction\)[\s\S]*$/i,"").replace(/\s*\(interjection\)[\s\S]*$/i,"").replace(/\s*\([^)]*\)[\s\S]*$/i,"").replace(/^the word[\s\S]*translated as[\s:]*/i,"").replace(/^\u0441\u043b\u043e\u0432\u043e\u0441\u043e\u0447\u0435\u0442\u0430\u043d\u0438\u0435[\s\S]*\u043f\u0435\u0440\u0435\u0432\u043e\u0434\u0438\u0442\u0441\u044f \u043a\u0430\u043a[\s:]*/i,"").replace(/^\u0441\u043b\u043e\u0432\u043e[\s\S]*\u043f\u0435\u0440\u0435\u0432\u043e\u0434\u0438\u0442\u0441\u044f \u043a\u0430\u043a[\s:]*/i,"").replace(/^.*?\u044d\u0442\u043e[\s:]*/i,"").replace(/^.*?\u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442[\s:]*/i,"").replace(/^.*?means[\s:]*/i,"").replace(/^the translation is[\s:]*/i,"").split("\n")[0].trim(),u=c.split(/\s+/),c.includes(",")?(d=c.split(",").map((function(e){return e.trim()})).filter((function(e){return e.length>0})).slice(0,3),c=d.join(", ")):u.length>8&&((p=e.split(/\s+/).length)<=5||u.length<=2*p||(console.log("Translation too long, trimming:",c),c=u.slice(0,8).join(" "))),!c&&s)?[2,s.split("\n")[0].trim()]:(console.log("Original translation:",s),console.log("Cleaned translation:",c),r.completeRequest(a),[2,c]):(r.errorRequest(a),[2,null]);case 3:throw h=f.sent(),console.error("Error during translation:",h),r.errorRequest(a),h;case 4:return[2]}}))}))},e.prototype.getExamples=function(e,t,n,r,a){return void 0===n&&(n=!1),void 0===r&&(r=""),p(this,void 0,void 0,(function(){var o,i,s,c,u,d,p,h,g,m,v,y,b,x,w,S,k;return f(this,(function(f){switch(f.label){case 0:o=(0,l.cr)(),i=o.startRequest("Creating example sentences",'Generating helpful examples for "'.concat(e,'"'),"\u{1f4a1}","#F59E0B"),f.label=1;case 1:return f.trys.push([1,10,,11]),o.setInProgress(i),s=this.getPrompts().examples(e,a),c=r?"".concat(s," ").concat(r.replace(/\{word\}/g,e)):s,[4,this.sendRequest(c)];case 2:if(!(u=f.sent()))throw new Error("Failed to generate examples. Please try again with a different word.");for(console.log("Raw examples response:",u),d=this.extractPlainText(u)||"",p=d.replace(/^[\s\S]*?((?:\d+\s*\.\s*|\u2022\s*|[\-\*]\s*).+$)/m,"$1").trim(),h=/(?:^|\n)(?:\d+\s*\.\s*|\u2022\s*|[\-\*]\s*)(.+?)(?=(?:\n+(?:\d+\s*\.\s*|\u2022\s*|[\-\*]\s*)|\n*$))/g,g=[],m=void 0;null!==(m=h.exec(p));)m[1]&&g.push(m[1].trim());0===g.length&&(g=p.split(/\n+/).map((function(e){return e.replace(/^\d+\s*\.\s*|^\s*\u2022\s*|^\s*[\-\*]\s*/,"").trim()})).filter((function(t){return t.length>0&&t.toLowerCase().includes(e.toLowerCase())})).slice(0,3)),0===g.length&&(g=p.split(/\n+/).map((function(e){return e.replace(/^\d+\s*\.\s*|^\s*\u2022\s*|^\s*[\-\*]\s*/,"").trim()})).filter((function(e){return e.length>0})).slice(0,3)),g=g.map((function(e){return e.replace(/^(example|sentence|\u043f\u0440\u0438\u043c\u0435\u0440|\u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u0435)[\s:]*/i,"").replace(/^["']|["']$/g,"")})),console.log("Processed examples:",g),v=[],y=0,b=g,f.label=3;case 3:if(!(y<b.length))return[3,9];if(!(x=b[y]).trim())return[3,8];if(w=null,!n)return[3,7];f.label=4;case 4:return f.trys.push([4,6,,7]),[4,this.translateText(x,t)];case 5:return w=f.sent(),[3,7];case 6:return S=f.sent(),console.error("Error translating example:",S),[3,7];case 7:if(v.push([x,w]),v.length>=3)return[3,9];f.label=8;case 8:return y++,[3,3];case 9:return 0===v.length?(console.warn("No examples were generated, but continuing with card creation"),o.completeRequest(i),[2,[]]):(o.completeRequest(i),[2,v]);case 10:throw k=f.sent(),console.error("Error getting examples:",k),o.errorRequest(i),k;case 11:return[2]}}))}))},e.prototype.getDescriptionImage=function(e,t){return void 0===t&&(t=""),p(this,void 0,void 0,(function(){var n,r,a,o,i,s,c;return f(this,(function(u){switch(u.label){case 0:n=(0,l.cr)(),r=n.startRequest("Crafting image description",'Creating detailed prompt for "'.concat(e,'" visualization'),"\u{1f3a8}","#EC4899"),u.label=1;case 1:return u.trys.push([1,3,,4]),n.setInProgress(r),a=this.getPrompts().imageDescription(e),o=t?"".concat(a," ").concat(t):a,[4,this.sendRequest(o)];case 2:if(!(i=u.sent()))throw n.errorRequest(r),new Error("Failed to generate image description. Please try again.");return s=this.extractPlainText(i),n.completeRequest(r),[2,s||i];case 3:throw c=u.sent(),console.error("Error generating image description:",c),n.errorRequest(r),c;case 4:return[2]}}))}))},e.prototype.generateAnkiFront=function(e){return p(this,void 0,void 0,(function(){var t,n,r,a,o,i;return f(this,(function(s){switch(s.label){case 0:t=(0,l.cr)(),n=t.startRequest("Creating question","Crafting an effective question for your flashcard","\u2753","#10B981"),s.label=1;case 1:return s.trys.push([1,3,,4]),t.setInProgress(n),r='For the word or phrase "'.concat(e,'", provide ONLY the word itself without any pronunciation or additional formatting.\nJust return the clean word/phrase as it should appear on the front of an Anki card.\nFor example: if input is "hello", return "hello"\nIf input is "beautiful", return "beautiful"\nYour response should contain ONLY the word/phrase, no pronunciation, no IPA, no additional text.'),[4,this.sendRequest(r)];case 2:return(a=s.sent())?(o=(o=this.extractPlainText(a)||a).split("\n")[0].replace(/^["']|["']$/g,"").replace(/\/.*?\//g,"").replace(/\[.*?\]/g,"").replace(/\(.*?\)/g,"").replace(/^front:[\s:]*/i,"").replace(/^word:[\s:]*/i,"").trim(),console.log("Front card response:",o),t.completeRequest(n),[2,o||e]):(t.errorRequest(n),[2,e]);case 3:return i=s.sent(),console.error("Error generating Anki front:",i),t.errorRequest(n),[2,e];case 4:return[2]}}))}))},e.prototype.createTranscription=function(e,t,n){return p(this,void 0,void 0,(function(){var r,a,o,i,s,c;return f(this,(function(u){switch(u.label){case 0:r=(0,l.cr)(),a=r.startRequest("Creating transcription",'Generating pronunciation for "'.concat(e,'"'),"\u{1f524}","#8B5CF6"),u.label=1;case 1:return u.trys.push([1,3,,4]),r.setInProgress(a),o=this.createTranscriptionPrompt(e,t,n),[4,this.sendRequest(o)];case 2:return(i=u.sent())?(s=this.parseTranscriptionResponse(i),r.completeRequest(a),[2,s]):(r.errorRequest(a),[2,null]);case 3:return c=u.sent(),console.error("Error creating transcription:",c),r.errorRequest(a),[2,null];case 4:return[2]}}))}))},e.prototype.createTranscriptionPrompt=function(e,t,n){return'Create transcriptions for the word/phrase "'.concat(e,'" (in ').concat(t,"):\n\n1. User language transcription: Show how to pronounce this word using ").concat(n,' phonetics/script\n2. IPA transcription: International Phonetic Alphabet notation\n\nIMPORTANT:\n- For user language: Write how "').concat(e,'" sounds using ').concat(n," pronunciation system\n- For IPA: Use proper IPA symbols [\u02c8 \u02cc \u0259 \u026a \u025b \xe6 \u0251 \u0254 \u028a \u028c \u03b8 \xf0 \u0283 \u0292 \u02a7 \u02a4 \u014b etc.]\n- Format exactly as shown below:\n\nUSER_LANG: [how the word sounds in ").concat(n,']\nIPA: [\u02c8a\u026a.pi.e\u026a notation]\n\nExample for Russian "\u043a\u043e\u0440\u043e\u0442\u043a\u0430\u044f" with Spanish user language:\nUSER_LANG: korotkaya\nIPA: [k\u0259\u02c8rotk\u0259j\u0259]\n\nProvide ONLY the two lines as shown above, no additional text.')},e.prototype.parseTranscriptionResponse=function(e){var t=this.extractPlainText(e)||e,n=null,r=null,a=t.match(/USER_LANG:\s*(.+)/i);a&&(n=a[1].trim());var o=t.match(/IPA:\s*(.+)/i);return o&&(r=o[1].trim().replace(/^\[|\]$/g,"").replace(/^\/|\/$/g,""))&&!r.startsWith("[")&&(r="[".concat(r,"]")),{userLanguageTranscription:n,ipaTranscription:r}},e}(),m=function(e){function t(t,n){void 0===n&&(n="gpt-5-nano");var r=e.call(this,t,n)||this;return r.baseUrl="https://api.openai.com/v1",r}return u(t,e),t.prototype.sendRequest=function(e,t){var n,r,a,o,i;return void 0===t&&(t={}),p(this,void 0,void 0,(function(){var l,u,p,g,m,v,y,b,x,w;return f(this,(function(f){switch(f.label){case 0:if(f.trys.push([0,3,,4]),!this.apiKey)throw new Error("OpenAI API key is missing. Please check your settings.");return u=(l=t||{}).messages,p=l.model,g=l.signal,m=h(l,["messages","model","signal"]),v=d({model:p||this.modelName,messages:null!==(n=u)&&void 0!==n?n:[{role:"user",content:e}]},m),[4,(0,s.H)("".concat(this.baseUrl,"/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)},body:JSON.stringify(v)},g)];case 1:return[4,(y=f.sent()).json()];case 2:if(b=f.sent(),!y.ok){if(null==b?void 0:b.error)throw x=(0,c.formatOpenAIErrorMessage)(b),"insufficient_quota"!==b.error.code&&429!==y.status||(0,c.cacheQuotaExceededError)(x),new Error(x);throw new Error("OpenAI API error: ".concat(y.status," ").concat(y.statusText))}return[2,(null===(i=null===(o=null===(a=null===(r=b.choices)||void 0===r?void 0:r[0])||void 0===a?void 0:a.message)||void 0===o?void 0:o.content)||void 0===i?void 0:i.trim())||null];case 3:throw w=f.sent(),console.error("Error in OpenAI request:",w),w;case 4:return[2]}}))}))},t.prototype.getImageUrl=function(e){var t,n;return p(this,void 0,void 0,(function(){var r,a,o,i,u,d,p;return f(this,(function(f){switch(f.label){case 0:r=(0,l.cr)(),a=r.startRequest("Generating image","Creating beautiful illustration with AI","\u{1f5bc}\ufe0f","#6366F1"),f.label=1;case 1:if(f.trys.push([1,4,,5]),r.setInProgress(a),!this.apiKey)throw new Error("OpenAI API key is missing. Please check your settings.");return[4,(0,s.H)("".concat(this.baseUrl,"/images/generations"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)},body:JSON.stringify({model:"dall-e-3",prompt:e,n:1,size:"1024x1024",response_format:"url"})})];case 2:return[4,(o=f.sent()).json()];case 3:if(i=f.sent(),!o.ok){if(null==i?void 0:i.error)throw u=(0,c.formatOpenAIErrorMessage)(i),"insufficient_quota"!==i.error.code&&429!==o.status||(0,c.cacheQuotaExceededError)(u),r.errorRequest(a),new Error(u);throw r.errorRequest(a),new Error("OpenAI image API error: ".concat(o.status," ").concat(o.statusText))}return(d=(null===(n=null===(t=null==i?void 0:i.data)||void 0===t?void 0:t[0])||void 0===n?void 0:n.url)||null)?r.completeRequest(a):r.errorRequest(a),[2,d];case 4:throw p=f.sent(),console.error("Error generating image with OpenAI:",p),r.errorRequest(a),p;case 5:return[2]}}))}))},t.prototype.getOptimizedImageUrl=function(e,t){return void 0===t&&(t=""),p(this,void 0,void 0,(function(){var r,a;return f(this,(function(o){switch(o.label){case 0:return[4,Promise.resolve().then(n.bind(n,456))];case 1:r=o.sent().getOptimizedImageUrl,o.label=2;case 2:return o.trys.push([2,4,,5]),[4,r(this.apiKey,e,t)];case 3:return[2,o.sent()];case 4:throw a=o.sent(),console.error("Error generating optimized image:",a),a;case 5:return[2]}}))}))},t.prototype.extractKeyTerms=function(e){return p(this,void 0,void 0,(function(){var t,n,r,a;return f(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),t="You are a helpful language learning assistant. Extract key terms from the text that would be useful to learn as flashcards. Limit to 5 most important terms max. Return only the terms, one per line, without any additional text or formatting.",[4,this.sendRequest(t,{messages:[{role:"system",content:t},{role:"user",content:e}]})];case 1:return n=o.sent(),(r=n||"")?[2,r.split("\n").map((function(e){return e.trim()})).filter((function(e){return e.length>0}))]:[2,[]];case 2:return a=o.sent(),console.error("Error extracting key terms with OpenAI:",a),[2,[]];case 3:return[2]}}))}))},t.prototype.createChatCompletion=function(e,t,n){var r,a,o,i;return p(this,void 0,void 0,(function(){var e,u,d,p,h,g,m,v;return f(this,(function(f){switch(f.label){case 0:e=(0,l.cr)(),u=e.startRequest((null==n?void 0:n.title)||"Generating content",(null==n?void 0:n.subtitle)||"AI is processing your request",(null==n?void 0:n.icon)||"\u{1f916}",(null==n?void 0:n.color)||"#3B82F6"),f.label=1;case 1:if(f.trys.push([1,4,,5]),e.setInProgress(u),!this.apiKey)throw new Error("OpenAI API key is missing. Please check your settings.");return d=t.map((function(e){return{role:e.role,content:e.content}})),[4,(0,s.H)("".concat(this.baseUrl,"/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)},body:JSON.stringify({model:this.modelName,messages:d})})];case 2:return[4,(p=f.sent()).json()];case 3:if(h=f.sent(),!p.ok){if(null==h?void 0:h.error)throw g=(0,c.formatOpenAIErrorMessage)(h),"insufficient_quota"!==h.error.code&&429!==p.status||(0,c.cacheQuotaExceededError)(g),e.errorRequest(u),new Error(g);throw e.errorRequest(u),new Error("OpenAI API error: ".concat(p.status," ").concat(p.statusText))}return(m=(null===(i=null===(o=null===(a=null===(r=h.choices)||void 0===r?void 0:r[0])||void 0===a?void 0:a.message)||void 0===o?void 0:o.content)||void 0===i?void 0:i.trim())||"")?(e.completeRequest(u),[2,{content:m}]):(e.errorRequest(u),[2,null]);case 4:throw v=f.sent(),console.error("Error in OpenAI chat completion:",v),e.errorRequest(u),v;case 5:return[2]}}))}))},t}(g),v=function(e){function t(t,n){void 0===n&&(n="llama3-8b-8192");var r=e.call(this,t,n)||this;return r.apiBaseUrl="https://api.groq.com/openai/v1",r}return u(t,e),t.prototype.sendRequest=function(e,t){var n,r,a,i,l;return void 0===t&&(t={}),p(this,void 0,void 0,(function(){var c,u,p;return f(this,(function(f){switch(f.label){case 0:if(f.trys.push([0,3,,4]),!this.apiKey)throw new Error("Groq API key is missing. Please check your settings.");return[4,(0,s.H)("".concat(this.apiBaseUrl,"/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)},body:JSON.stringify(d({model:this.modelName,messages:[{role:"user",content:e}]},t))})];case 1:return[4,(c=f.sent()).json()];case 2:if(u=f.sent(),!c.ok)throw new Error(o("Groq API Error",c.status,u));return[2,null!==(l=null===(i=null===(a=null===(r=null===(n=u.choices)||void 0===n?void 0:n[0])||void 0===r?void 0:r.message)||void 0===a?void 0:a.content)||void 0===i?void 0:i.trim())&&void 0!==l?l:null];case 3:throw p=f.sent(),console.error("Error in Groq API request:",p),p;case 4:return[2]}}))}))},t.prototype.getImageUrl=function(){throw new Error("Image generation is not supported by Groq.")},t.prototype.extractKeyTerms=function(e){return p(this,void 0,void 0,(function(){var t,n,r,a;return f(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),t="You are a helpful language learning assistant. Extract key terms from the text that would be useful to learn as flashcards. Limit to 5 most important terms max. Return only the terms, one per line, without any additional text or formatting.",[4,this.sendRequest(t,{messages:[{role:"system",content:t},{role:"user",content:e}]})];case 1:return n=o.sent(),(r=n||"")?[2,r.split("\n").map((function(e){return e.trim()})).filter((function(e){return e.length>0}))]:[2,[]];case 2:return a=o.sent(),console.error("Error extracting key terms with Groq:",a),[2,[]];case 3:return[2]}}))}))},t.prototype.createChatCompletion=function(e,t,n){var r,a,i,c,u;return p(this,void 0,void 0,(function(){var e,d,p,h,g,m;return f(this,(function(f){switch(f.label){case 0:e=(0,l.cr)(),d=e.startRequest((null==n?void 0:n.title)||"Generating content",(null==n?void 0:n.subtitle)||"AI is processing your request",(null==n?void 0:n.icon)||"\u{1f916}",(null==n?void 0:n.color)||"#3B82F6"),f.label=1;case 1:if(f.trys.push([1,4,,5]),e.setInProgress(d),!this.apiKey)throw new Error("Groq API key is missing. Please check your settings.");return[4,(0,s.H)("".concat(this.apiBaseUrl,"/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)},body:JSON.stringify({model:this.modelName,messages:t})})];case 2:return[4,(p=f.sent()).json()];case 3:if(h=f.sent(),!p.ok)throw new Error(o("Groq API Error",p.status,h));return(g=null!==(u=null===(c=null===(i=null===(a=null===(r=h.choices)||void 0===r?void 0:r[0])||void 0===a?void 0:a.message)||void 0===i?void 0:i.content)||void 0===c?void 0:c.trim())&&void 0!==u?u:"")?(e.completeRequest(d),[2,{content:g}]):(e.errorRequest(d),[2,null]);case 4:throw m=f.sent(),console.error("Error in Groq chat completion:",m),e.errorRequest(d),m;case 5:return[2]}}))}))},t}(g),y=function(e,t,n){switch(void 0===n&&(n=""),e){case a.l.OpenAI:return new m(t,n||"gpt-5-nano");case a.l.Groq:return new v(t,n||"llama3-8b-8192");default:return new m(t,n||"gpt-5-nano")}},b=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),x=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))},w=function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(s){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&l[0]?r.return:l[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,l[1])).done)return a;switch(r=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,r=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],r=0}finally{n=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}},S=function(e){function t(t){var n=e.call(this,t)||this;return n.name="ApiKeyAuthorizationError",n}return b(t,e),t}(Error),k=["401","unauthorized","forbidden","invalid api key","incorrect api key","authentication failed","api key is missing","api key provided is incorrect","bearer token is invalid","invalid credentials","invalid token","access was denied","invalid api_key"],C=function(e){if(!e)return!1;var t=e.toLowerCase();return k.some((function(e){return t.includes(e)}))},E=function(e){return function(e){return{translateText:function(t,n,r,a,o){return void 0===r&&(r="ru"),void 0===a&&(a=""),x(void 0,void 0,void 0,(function(){return w(this,(function(i){if(null==o?void 0:o.aborted)throw new Error("Request cancelled");return[2,y(e,t).translateText(n,r,a)]}))}))},getExamples:function(t,n,r,a,o,i,l){return void 0===a&&(a=!1),void 0===o&&(o=""),x(void 0,void 0,void 0,(function(){return w(this,(function(s){if(null==l?void 0:l.aborted)throw new Error("Request cancelled");return[2,y(e,t).getExamples(n,r,a,o,i)]}))}))},getDescriptionImage:function(t,n,r,a){return void 0===r&&(r=""),x(void 0,void 0,void 0,(function(){return w(this,(function(o){if(null==a?void 0:a.aborted)throw new Error("Request cancelled");return[2,y(e,t).getDescriptionImage(n,r)]}))}))},getImageUrl:function(t,n){return x(void 0,void 0,void 0,(function(){var r;return w(this,(function(a){return[2,(r=y(e,t)).getImageUrl?r.getImageUrl(n):null]}))}))},getOptimizedImageUrl:function(t,n,r){return x(void 0,void 0,void 0,(function(){var a;return w(this,(function(o){return[2,(a=y(e,t)).getOptimizedImageUrl?a.getOptimizedImageUrl(n,r):null]}))}))},generateAnkiFront:function(t,n,r){return x(void 0,void 0,void 0,(function(){return w(this,(function(a){if(null==r?void 0:r.aborted)throw new Error("Request cancelled");return[2,y(e,t).generateAnkiFront(n)]}))}))},extractKeyTerms:function(t,n){return x(void 0,void 0,void 0,(function(){return w(this,(function(r){return[2,y(e,t).extractKeyTerms(n)]}))}))},createChatCompletion:function(t,n,r){return x(void 0,void 0,void 0,(function(){var a;return w(this,(function(o){return(a=y(e,t)).createChatCompletion?[2,a.createChatCompletion(t,n,r)]:(console.error("createChatCompletion not implemented in the provider"),[2,null])}))}))},createTranscription:function(t,n,r,a){return x(void 0,void 0,void 0,(function(){return w(this,(function(o){return[2,y(e,t).createTranscription(n,r,a)]}))}))}}}(e)},A=function(e,t,n){switch(void 0===n&&(n=""),e){case a.l.OpenAI:return t;case a.l.Groq:return n;default:return t}},T=function(e,t,n,r,a,o,i){return x(void 0,void 0,void 0,(function(){var o,l;return w(this,(function(s){switch(s.label){case 0:if(s.trys.push([0,2,,3]),!t)throw new Error("API key is missing. Please check your settings.");return[4,e.translateText(t,n,r,a,i)];case 1:return o=s.sent(),[2,{original:n,translated:o}];case 2:throw l=s.sent(),console.error("Error in unified translation:",l),l instanceof Error?l:new Error("Failed to translate text. Please check your API key and settings.");case 3:return[2]}}))}))},I=function(e,t,n,r,a,o,i,l){return void 0===a&&(a=!1),x(void 0,void 0,void 0,(function(){var s;return w(this,(function(c){switch(c.label){case 0:if(c.trys.push([0,2,,3]),!t)throw new Error("API key is missing. Please check your settings.");return[4,e.getExamples(t,n,r,a,o,i,l)];case 1:return[2,c.sent().map((function(e){return{original:e[0],translated:e[1]}}))];case 2:throw s=c.sent(),console.error("Error in unified examples generation:",s),s instanceof Error?s:new Error("Failed to generate examples. Please check your API key and settings.");case 3:return[2]}}))}))},z=function(e,t,n,r){return x(void 0,void 0,void 0,(function(){var a,o;return w(this,(function(i){switch(i.label){case 0:if(i.trys.push([0,2,,3]),!t)throw new Error("API key is missing. Please check your settings.");return[4,e.generateAnkiFront(t,n,r)];case 1:if(!(a=i.sent()))throw new Error("Failed to generate flashcard content. Please try again or check your API key.");return[2,{front:a}];case 2:throw o=i.sent(),console.error("Error in unified flashcard creation:",o),o instanceof Error?o:new Error("Failed to create flashcard. Please check your API key and settings.");case 3:return[2]}}))}))},F=function(e,t,n,r,a){return void 0===a&&(a="ru"),x(void 0,void 0,void 0,(function(){var o,i;return w(this,(function(l){switch(l.label){case 0:if(l.trys.push([0,2,,3]),!t)throw new Error("API key is missing. Please check your settings.");return[4,e.createTranscription(t,n,r,a)];case 1:if(!(o=l.sent()))throw new Error("Failed to generate transcription. Please try again or check your API key.");return[2,o];case 2:throw i=l.sent(),console.error("Error in unified transcription creation:",i),i instanceof Error?i:new Error("Failed to create transcription. Please check your API key and settings.");case 3:return[2]}}))}))},M=function(e,t,n,r,a,o,i,l,s){return void 0===i&&(i=!1),x(void 0,void 0,void 0,(function(){var c,u,d,p,f,h,g,m,v,y,b,k;return w(this,(function(E){switch(E.label){case 0:c=Date.now(),console.log("\u{1f680} Starting parallel card component creation..."),u=[],(d=[]).push((A=function(){return T(e,t,n,r,a,o,l)},void 0===F&&(F=2),void 0===M&&(M=1e3),x(void 0,void 0,void 0,(function(){var e,t,n,r;return w(this,(function(a){switch(a.label){case 0:t=function(t){var n,r,a;return w(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,4]),n={},[4,A()];case 1:return[2,(n.value=o.sent(),n)];case 2:if(r=o.sent(),(e=r).message.includes("quota")||e.message.includes("cancelled")||e.message.includes("aborted"))throw e;if(t===F)throw e;return a=M*Math.pow(2,t),console.log("Retry attempt ".concat(t+1,"/").concat(F," after ").concat(a,"ms delay")),[4,new Promise((function(e){return setTimeout(e,a)}))];case 3:return o.sent(),[3,4];case 4:return[2]}}))},n=0,a.label=1;case 1:return n<=F?[5,t(n)]:[3,4];case 2:if("object"==typeof(r=a.sent()))return[2,r.value];a.label=3;case 3:return n++,[3,1];case 4:throw e}}))}))).then((function(e){return{type:"translation",result:e}})).catch((function(e){var t=e instanceof Error?e.message:String(e);if(C(t))throw new S(t);return{type:"translation",error:t}}))),d.push(I(e,t,n,r,!0,a,o,l).then((function(e){return{type:"examples",result:e}})).catch((function(e){var t=e instanceof Error?e.message:String(e);if(C(t))throw new S(t);return{type:"examples",error:t}}))),d.push(z(e,t,n,l).then((function(e){return{type:"flashcard",result:e}})).catch((function(e){var t=e instanceof Error?e.message:String(e);if(C(t))throw new S(t);return{type:"flashcard",error:t}}))),o&&d.push(e.createTranscription(t,n,o,r).then((function(e){return{type:"transcription",result:e}})).catch((function(e){var t=e instanceof Error?e.message:String(e);if(C(t))throw new S(t);return{type:"transcription",error:t}}))),o&&d.push($(e,t,n,o,r).then((function(e){return{type:"linguisticInfo",result:e.linguisticInfo}})).catch((function(e){var t=e instanceof Error?e.message:String(e);if(C(t))throw new S(t);return{type:"linguisticInfo",error:t}}))),i&&"off"!==s&&(p=function(n){return x(void 0,void 0,void 0,(function(){var r,a,o,i,l,s;return w(this,(function(c){switch(c.label){case 0:if(!n||0===n.trim().length)return[2,{shouldGenerate:!1,reason:"No text provided"}];c.label=1;case 1:return c.trys.push([1,3,,4]),r='Analyze this word/phrase and determine if a visual image would be helpful for language learning: "'.concat(n,'"\n\nConsider these criteria:\n- Concrete objects, animals, places, foods, tools, vehicles = YES\n- Abstract concepts, emotions, actions, grammar terms = NO\n- People, professions, activities that can be visualized = YES\n- Numbers, prepositions, conjunctions, abstract ideas = NO\n\nRespond with ONLY "YES" or "NO" followed by a brief reason (max 10 words).\nFormat: "YES - concrete object that can be visualized" or "NO - abstract concept"'),[4,e.createChatCompletion(t,[{role:"user",content:r}])];case 2:return(a=c.sent())&&a.content?(o=a.content.trim(),i=o.toUpperCase().startsWith("YES"),l=o.includes(" - ")?o.split(" - ")[1]:"AI analysis",console.log('\u{1f916} Smart image analysis for "'.concat(n,'": ').concat(i?"YES":"NO"," - ").concat(l)),[2,{shouldGenerate:i,reason:l}]):[2,{shouldGenerate:!1,reason:"AI analysis failed"}];case 3:return s=c.sent(),console.error("Error analyzing text for image generation:",s),[2,{shouldGenerate:!1,reason:"Analysis error"}];case 4:return[2]}}))}))},f=function(){return x(void 0,void 0,void 0,(function(){var r,a,o,i;return w(this,(function(l){switch(l.label){case 0:if(r="always"===s,a="","smart"!==s)return[3,4];l.label=1;case 1:return l.trys.push([1,3,,4]),[4,p(n)];case 2:return o=l.sent(),r=o.shouldGenerate,a=o.reason,[3,4];case 3:return i=l.sent(),console.error("Error in Smart analysis:",i),r=!1,a="Analysis failed",[3,4];case 4:return r?e.getOptimizedImageUrl?[4,e.getOptimizedImageUrl(t,n)]:[3,6]:[3,9];case 5:return[2,l.sent()];case 6:return e.getImageUrl?[4,e.getImageUrl(t,n)]:[3,8];case 7:return[2,l.sent()];case 8:return[3,10];case 9:"smart"===s&&console.log('\u{1f6ab} No image needed for "'.concat(n,'": ').concat(a)),l.label=10;case 10:return[2,null]}}))}))},d.push(f().then((function(e){return{type:"imageUrl",result:e}})).catch((function(e){var t=e instanceof Error?e.message:String(e);if(C(t))throw new S(t);return{type:"imageUrl",error:t}})))),E.label=1;case 1:return E.trys.push([1,3,,4]),[4,Promise.all(d)];case 2:return h=E.sent(),[3,4];case 3:if((g=E.sent())instanceof S)throw g;throw g;case 4:for(m={errors:u},v=0,y=h;v<y.length;v++){if(b=y[v],null==l?void 0:l.aborted)throw new Error("Card creation was cancelled by user");"error"in b?u.push({component:b.type,error:b.error}):m[b.type]=b.result}return k=Date.now()-c,console.log("\u26a1 Parallel card creation completed in ".concat(k,"ms")),console.log("\u{1f4ca} Success: ".concat(Object.keys(m).length-1,"/").concat(d.length,", Errors: ").concat(u.length)),[2,m]}var A,F,M}))}))};function j(e,t,n,r,a){return void 0===a&&(a="ru"),x(this,void 0,void 0,(function(){var o,i;return w(this,(function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),console.log('Creating validated linguistic info for "'.concat(n,'" in ').concat(r,", interface: ").concat(a)),[4,N(e,t,n,r,a)];case 1:return(o=l.sent())?(console.log('Generated and validated linguistic info for "'.concat(n,'"')),[2,o]):[2,null];case 2:return i=l.sent(),console.error("Error creating linguistic info:",i),[2,null];case 3:return[2]}}))}))}function B(e,t){return'TASK: Produce a VERY SHORT grammar brief for the expression "'.concat(e,'".\nThe brief MUST be written entirely in: ').concat(t,'.\n\nCONSTRAINTS:\n- 1\u20132 bullet points only (2 max).\n- Each bullet: unique emoji + 1\u20132 words (no sentences).\n- Include ONLY essential information that is clearly applicable.\n\nMANDATORY:\n1) First bullet is ALWAYS: "\u{1f4da} Part of speech".\n2) Add AT MOST ONE extra characteristic IF relevant to "').concat(e,'".\n\nALLOWED EXTRA EMOJIS (pick at most one that really applies):\n- \u26a5 Gender | \u{1f4cb} Number | \u{1f3af} Case | \u23f0 Tense\n\nOUTPUT LANGUAGE:\n- All labels and values must be in ').concat(t,' (not transliterated, no translations to other languages).\n\nFORMAT (exactly this HTML structure):\n<div class="grammar-item">\n  <span class="icon-pos">[emoji]</span> <strong>[label]:</strong> <span class="grammar-tag">[value]</span>\n</div>\n\nRULES:\n- If an extra characteristic is not applicable or uncertain, OMIT it (do not guess).\n- Keep values as concise tags (e.g., \u201c\u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0435\u201d, \u201c\u0436\u0435\u043d\u0441\u043a\u0438\u0439\u201d, \u201c\u043c\u043d\u043e\u0436\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0435\u201d, \u201c\u0440\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439\u201d, \u201c\u043f\u0440\u043e\u0448\u0435\u0434\u0448\u0435\u0435\u201d).\n- No additional text before or after the HTML blocks.\n\nCreate the brief for "').concat(e,'":')}function R(e,t,n){return"TASK: Translate the content into ".concat(t).concat(n?" from ".concat(n):"",".\n\nHARD REQUIREMENTS (DO NOT VIOLATE):\n- Preserve ALL original formatting EXACTLY (tags, attributes, classes, Markdown syntax, code blocks, inline code, links, whitespace, line breaks, punctuation, emojis).\n- Translate ONLY human-readable text nodes (labels/values/paragraphs), DO NOT modify:\n  * HTML/Markdown syntax\n  * Tag and attribute names/values\n  * Backticked/ fenced code\n  * URLs and IDs\n- Keep the same number of characters for all non-text syntax parts.\n- No extra comments or text before/after.\n\nINPUT:\n").concat(e,"\n\nOUTPUT:\nReturn ONLY the translated content with formatting 100% unchanged, except for translated human-readable text.")}function O(e,t,n){return'\u041f\u0440\u043e\u0432\u0435\u0440\u044c \u0441\u043f\u0440\u0430\u0432\u043a\u0443 \u0434\u043b\u044f "'.concat(t,'" \u0438 \u0438\u0441\u043f\u0440\u0430\u0432\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0435 \u043e\u0448\u0438\u0431\u043a\u0438:\n\n\u0421\u041f\u0420\u0410\u0412\u041a\u0410:\n').concat(e,"\n\n\u041f\u0420\u041e\u0412\u0415\u0420\u042c \u0422\u041e\u041b\u042c\u041a\u041e:\n1. \u0415\u0441\u0442\u044c \u043b\u0438 \u043f\u043e\u0432\u0442\u043e\u0440\u044f\u044e\u0449\u0438\u0435\u0441\u044f \u044d\u043c\u043e\u0434\u0436\u0438? (\u{1f4da} \u{1f4da} - \u043f\u043b\u043e\u0445\u043e)\n2. \u041d\u0430 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u043c \u043b\u0438 \u044f\u0437\u044b\u043a\u0435 \u0442\u0435\u0440\u043c\u0438\u043d\u044b? (\u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c ").concat(n,')\n3. \u0415\u0441\u0442\u044c \u043b\u0438 \u043b\u0438\u0448\u043d\u044f\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f? (\u0443\u0431\u0435\u0440\u0438 lemma, degree, notes, examples)\n\n\u0415\u0441\u043b\u0438 \u0441\u043f\u0440\u0430\u0432\u043a\u0430 \u0432 \u0446\u0435\u043b\u043e\u043c \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u0430 \u2192 \u043e\u0442\u0432\u0435\u0442\u044c "\u0421\u041f\u0420\u0410\u0412\u041a\u0410 \u041a\u041e\u0420\u0420\u0415\u041a\u0422\u041d\u0410"\n\u0415\u0441\u043b\u0438 \u0435\u0441\u0442\u044c \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0435 \u043e\u0448\u0438\u0431\u043a\u0438 \u2192 \u0441\u043e\u0437\u0434\u0430\u0439 \u0438\u0441\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043d\u0443\u044e \u0432\u0435\u0440\u0441\u0438\u044e\n\n\u0418\u0421\u041f\u0420\u0410\u0412\u042c \u0435\u0441\u043b\u0438 \u043d\u0443\u0436\u043d\u043e:')}function L(e,t,n,r,a){return void 0===a&&(a="ru"),x(this,void 0,void 0,(function(){var o,i,l,s;return w(this,(function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),console.log('Validating linguistic reference for "'.concat(r,'"')),o=O(n,r,a),[4,e.createChatCompletion(t,[{role:"user",content:o}])];case 1:return(i=c.sent())&&i.content?(l=i.content.trim()).includes("\u0421\u041f\u0420\u0410\u0412\u041a\u0410 \u041a\u041e\u0420\u0420\u0415\u041a\u0422\u041d\u0410")||l.includes("\u041a\u041e\u0420\u0420\u0415\u041a\u0422\u041d\u0410")?(console.log("Reference validated as correct"),[2,n]):(console.log("Reference corrected by validator"),[2,l]):(console.log("Validator failed, returning original reference"),[2,n]);case 2:return s=c.sent(),console.error("Error in validator:",s),[2,n];case 3:return[2]}}))}))}function N(e,t,n,r,a){return void 0===a&&(a="ru"),x(this,void 0,void 0,(function(){var o,i,l,s,c;return w(this,(function(u){switch(u.label){case 0:return u.trys.push([0,3,,4]),console.log('Creating validated linguistic info for "'.concat(n,'"')),o=B(n,r),[4,e.createChatCompletion(t,[{role:"user",content:o}])];case 1:return(i=u.sent())&&i.content?(l=i.content.trim(),[4,L(e,t,l,n,a)]):[2,null];case 2:return s=u.sent(),console.log('Final linguistic info for "'.concat(n,'" created')),[2,s];case 3:return c=u.sent(),console.error("Error creating validated linguistic info:",c),[2,null];case 4:return[2]}}))}))}function P(e,t,n,r){return'You are an expert linguist specializing in grammar validation. Your task is to verify the grammatical accuracy of a linguistic reference.\n\nANALYSIS TARGET:\n- Word/Phrase: "'.concat(e,'"\n- Source Language: ').concat(n,"\n- Interface Language: ").concat(r,"\n\nLINGUISTIC REFERENCE TO VALIDATE:\n").concat(t,'\n\nVALIDATION INSTRUCTIONS:\n1. **Analyze the source word "').concat(e,'" in ').concat(n," language ONLY**\n2. **DO NOT analyze translations** - focus only on the original word\n3. **Check grammatical consistency** according to ").concat(n," language rules\n4. **Verify logical compatibility** of grammatical characteristics\n\nSPECIFIC CHECKS FOR ").concat(n.toUpperCase(),' LANGUAGE:\n\u2022 **Part of Speech**: Verify the word classification is correct\n\u2022 **Gender**: Check if gender is appropriate (singular forms only for most languages)\n\u2022 **Number**: Ensure number is correctly identified\n\u2022 **Case**: Validate case forms match the language\'s case system\n\u2022 **Tense/Aspect**: For verbs, check tense and aspect accuracy\n\u2022 **Degree**: Comparison degrees should only apply to adjectives/adverbs, NOT nouns\n\u2022 **Morphological Features**: Verify all features are linguistically valid\n\nCOMMON ERRORS TO DETECT:\n\u274c Gender specified for plural forms (where not applicable)\n\u274c Comparison degrees assigned to nouns\n\u274c Incorrect case systems for the language\n\u274c Wrong tense/aspect combinations\n\u274c Analysis of translation instead of source word\n\u274c Inconsistent grammatical categories\n\nRESPONSE FORMAT:\nVALIDATION: [VALID/INVALID]\n\nERRORS:\n[List specific errors found, or "None"]\n\nCORRECTIONS:\n[Suggest specific corrections, or "None"]\n\nBe thorough and precise. Focus on grammatical accuracy for ').concat(n," language rules.")}function _(e,t,n,r,a,o){return void 0===o&&(o="ru"),x(this,void 0,void 0,(function(){var i,l,s,c,u,d,p,f,h,g,m;return w(this,(function(v){switch(v.label){case 0:return v.trys.push([0,2,,3]),console.log('Validating linguistic info for "'.concat(n,'" in ').concat(a)),i=P(n,r,a,o),[4,e.createChatCompletion(t,[{role:"user",content:i}])];case 1:return(l=v.sent())&&l.content?(s=l.content.trim(),console.log("Validation response:",s),c=s.includes("VALIDATION: VALID")||s.includes("\u2705 VALID"),u=s.match(/ERRORS?:([\s\S]*?)(?:CORRECTIONS?:|$)/),d=s.match(/CORRECTIONS?:([\s\S]*?)$/),p=[],f=[],u&&u[1]&&(h=u[1].trim())&&"None"!==h&&"\u041d\u0435\u0442"!==h&&p.push.apply(p,h.split("\n").filter((function(e){return e.trim()})).map((function(e){return e.replace(/^[\u2022\-*]\s*/,"").trim()}))),d&&d[1]&&(g=d[1].trim())&&"None"!==g&&"\u041d\u0435\u0442"!==g&&f.push.apply(f,g.split("\n").filter((function(e){return e.trim()})).map((function(e){return e.replace(/^[\u2022\-*]\s*/,"").trim()}))),[2,{isValid:c,errors:p,corrections:f.length>0?f:void 0}]):[2,{isValid:!1,errors:["Failed to validate linguistic information"]}];case 2:return m=v.sent(),console.error("Error validating linguistic info:",m),[2,{isValid:!1,errors:["Validation service unavailable"]}];case 3:return[2]}}))}))}function D(e,t,n,r,a,o,i,l){return void 0===l&&(l="ru"),x(this,void 0,void 0,(function(){var s,c,u;return w(this,(function(d){switch(d.label){case 0:return d.trys.push([0,2,,3]),console.log('Correcting linguistic info for "'.concat(n,'" based on validation errors')),s=function(e,t,n,r,a,o){var i=n.map((function(e){return"\u2022 ".concat(e)})).join("\n"),l=r.map((function(e){return"\u2022 ".concat(e)})).join("\n");return'\u0422\u044b \u044d\u043a\u0441\u043f\u0435\u0440\u0442-\u043b\u0438\u043d\u0433\u0432\u0438\u0441\u0442. \u0418\u0441\u043f\u0440\u0430\u0432\u044c \u0433\u0440\u0430\u043c\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u0441\u043f\u0440\u0430\u0432\u043a\u0443 \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043d\u044b\u0445 \u043e\u0448\u0438\u0431\u043e\u043a.\n\n\u0421\u041b\u041e\u0412\u041e \u0414\u041b\u042f \u0410\u041d\u0410\u041b\u0418\u0417\u0410: "'.concat(e,'" (\u044f\u0437\u044b\u043a: ').concat(a,")\n\n\u0418\u0421\u0425\u041e\u0414\u041d\u0410\u042f \u0421\u041f\u0420\u0410\u0412\u041a\u0410:\n").concat(t,"\n\n\u041d\u0410\u0419\u0414\u0415\u041d\u041d\u042b\u0415 \u041e\u0428\u0418\u0411\u041a\u0418:\n").concat(i,"\n\n\u0420\u0415\u041a\u041e\u041c\u0415\u041d\u0414\u0410\u0426\u0418\u0418 \u041f\u041e \u0418\u0421\u041f\u0420\u0410\u0412\u041b\u0415\u041d\u0418\u042e:\n").concat(l,'\n\n\u0417\u0410\u0414\u0410\u0427\u0410: \u0421\u043e\u0437\u0434\u0430\u0439 \u0438\u0441\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043d\u0443\u044e \u0432\u0435\u0440\u0441\u0438\u044e \u0433\u0440\u0430\u043c\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0439 \u0441\u043f\u0440\u0430\u0432\u043a\u0438, \u0443\u0441\u0442\u0440\u0430\u043d\u0438\u0432 \u0432\u0441\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0435 \u043e\u0448\u0438\u0431\u043a\u0438.\n\n\u0422\u0420\u0415\u0411\u041e\u0412\u0410\u041d\u0418\u042f:\n1. \u0421\u043e\u0445\u0440\u0430\u043d\u0438 \u0438\u0441\u0445\u043e\u0434\u043d\u043e\u0435 HTML-\u0444\u043e\u0440\u043c\u0430\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435\n2. \u0418\u0441\u043f\u0440\u0430\u0432\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0433\u0440\u0430\u043c\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u043e\u0448\u0438\u0431\u043a\u0438\n3. \u0423\u0431\u0435\u0440\u0438 \u043d\u0435\u043f\u0440\u0438\u043c\u0435\u043d\u0438\u043c\u044b\u0435 \u0445\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043a\u0438 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u0440\u043e\u0434 \u0434\u043b\u044f \u043c\u043d.\u0447., \u0441\u0442\u0435\u043f\u0435\u043d\u0438 \u0441\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u044f \u0434\u043b\u044f \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0445)\n4. \u0412\u0441\u0435 \u0442\u0435\u0440\u043c\u0438\u043d\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c \u043d\u0430 \u044f\u0437\u044b\u043a\u0435 "').concat(o,'"\n5. \u0410\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 \u0442\u043e\u043b\u044c\u043a\u043e \u0438\u0441\u0445\u043e\u0434\u043d\u043e\u0435 \u0441\u043b\u043e\u0432\u043e "').concat(e,'", \u043d\u0435 \u0435\u0433\u043e \u043f\u0435\u0440\u0435\u0432\u043e\u0434\n\n\u0412\u044b\u0432\u0435\u0434\u0438 \u0422\u041e\u041b\u042c\u041a\u041e \u0438\u0441\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043d\u0443\u044e \u0441\u043f\u0440\u0430\u0432\u043a\u0443 \u0431\u0435\u0437 \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0435\u0432:')}(n,r,a,o,i,l),[4,e.createChatCompletion(t,[{role:"user",content:s}])];case 1:return(c=d.sent())&&c.content?[2,c.content.trim()]:[2,null];case 2:return u=d.sent(),console.error("Error correcting linguistic info:",u),[2,null];case 3:return[2]}}))}))}function q(e,t,n,r,a,o,i){return x(this,void 0,void 0,(function(){var l,s,c,u,d,p,f,h,g,m,v,y,b;return w(this,(function(x){switch(x.label){case 0:return x.trys.push([0,2,,3]),console.log("Running ".concat(i,' validator for "').concat(n,'"')),l=function(e,t,n,r,a){var o='\nANALYSIS TARGET:\n- Word/Phrase: "'.concat(e,'"\n- Source Language: ').concat(n,"\n- Interface Language: ").concat(r,"\n\nLINGUISTIC REFERENCE TO VALIDATE:\n").concat(t);switch(a){case"morphology":return"".concat(o,"\n\n\u{1f52c} MORPHOLOGY SPECIALIST VALIDATION\n\nYou are a specialist in morphological analysis. Focus EXCLUSIVELY on word formation and morphological features:\n\nPRIMARY CHECKS:\n\u2022 **Part of Speech**: Is the word classification accurate?\n\u2022 **Morphological Form**: Are inflectional forms correctly identified?\n\u2022 **Gender/Number/Case**: Are these consistent with ").concat(n," morphology?\n\u2022 **Base Form**: Is the root/lemma correctly identified?\n\u2022 **Morphological Categories**: Do the features match the word class?\n\nCRITICAL ERROR DETECTION for ").concat(n.toUpperCase(),":\n\u274c **Gender for plural forms**: In most languages (Russian, English, etc.), gender should NOT be specified for plural forms\n\u274c **Impossible morphological combinations**: Check if all features can coexist\n\u274c **Missing essential features**: Ensure number, case (where applicable) are present\n\u274c **Wrong part of speech**: Verify the word actually belongs to the stated category\n\nSPECIFIC ").concat(n.toUpperCase(),' RULES:\n\u2022 If word ends in -\u0438, -\u044b, -\u0430 (plural markers), check if it\'s truly plural\n\u2022 Plural nouns typically don\'t have gender specification\n\u2022 Adjectives in plural may have gender only in specific contexts\n\u2022 Verify case markers match the word form\n\nIGNORE: Syntax, semantics, context - focus ONLY on morphology.\n\nRESPONSE FORMAT:\nVALIDATION: [VALID/INVALID]\nCONFIDENCE: [0.0-1.0]\nERRORS: [morphological errors only, or "None"]\nCORRECTIONS: [morphological corrections only, or "None"]');case"syntax":return"".concat(o,"\n\n\u{1f3d7}\ufe0f SYNTAX SPECIALIST VALIDATION\n\nYou are a specialist in syntactic analysis. Focus EXCLUSIVELY on grammatical structure:\n\nPRIMARY CHECKS:\n\u2022 **Grammatical Role**: Does the word fit its syntactic position?\n\u2022 **Agreement**: Are agreement patterns consistent?\n\u2022 **Case Assignment**: Is case marking appropriate for syntax?\n\u2022 **Tense/Aspect**: Are verbal categories syntactically coherent?\n\u2022 **Syntactic Features**: Do features match syntactic requirements?\n\nCRITICAL SYNTAX VALIDATION for ").concat(n.toUpperCase(),':\n\u274c **Agreement violations**: Check subject-verb, noun-adjective agreement\n\u274c **Case mismatches**: Ensure case reflects syntactic role\n\u274c **Tense inconsistencies**: Verify temporal features make syntactic sense\n\u274c **Feature conflicts**: Look for syntactically impossible combinations\n\nIGNORE: Word-internal morphology, meaning - focus ONLY on syntax.\n\nRESPONSE FORMAT:\nVALIDATION: [VALID/INVALID]\nCONFIDENCE: [0.0-1.0]\nERRORS: [syntactic errors only, or "None"]\nCORRECTIONS: [syntactic corrections only, or "None"]');case"semantics":return"".concat(o,'\n\n\u{1f4ad} SEMANTICS SPECIALIST VALIDATION\n\nYou are a specialist in semantic analysis. Focus EXCLUSIVELY on meaning and usage:\n\nPRIMARY CHECKS:\n\u2022 **Semantic Category**: Does the classification match the word\'s meaning?\n\u2022 **Usage Context**: Are grammatical features appropriate for the word\'s usage?\n\u2022 **Semantic Agreement**: Do features align with semantic properties?\n\u2022 **Register/Style**: Are formal features appropriate for the word type?\n\u2022 **Semantic Coherence**: Do all features make sense together semantically?\n\nSEMANTIC VALIDATION PRIORITIES:\n\u274c **Meaning mismatches**: Ensure part of speech matches actual meaning\n\u274c **Register conflicts**: Check if formality level matches word type\n\u274c **Usage inconsistencies**: Verify features match how word is actually used\n\u274c **Semantic impossibilities**: Look for logically impossible feature combinations\n\nIGNORE: Pure morphological/syntactic technicalities - focus on meaning-based validation.\n\nRESPONSE FORMAT:\nVALIDATION: [VALID/INVALID]\nCONFIDENCE: [0.0-1.0]\nERRORS: [semantic errors only, or "None"]\nCORRECTIONS: [semantic corrections only, or "None"]');case"consistency":return"".concat(o,"\n\n\u2696\ufe0f CONSISTENCY SPECIALIST VALIDATION\n\nYou are a specialist in logical consistency. Focus EXCLUSIVELY on internal coherence:\n\nPRIMARY CHECKS:\n\u2022 **Feature Compatibility**: Are all features mutually compatible?\n\u2022 **Language Rules**: Does everything follow ").concat(n," rules?\n\u2022 **Logical Contradictions**: Are there any impossible combinations?\n\u2022 **Completeness**: Are required features present/absent appropriately?\n\u2022 **Cross-feature Validation**: Do different features support each other?\n\nCONSISTENCY CRITICAL CHECKS for ").concat(n.toUpperCase(),":\n\u274c **GENDER + PLURAL**: Major error - gender should NOT be specified for plural forms in ").concat(n,"\n\u274c **Part of speech conflicts**: Ensure all features match the stated part of speech\n\u274c **Missing essential info**: Check if number, case, or other required features are missing\n\u274c **Redundant information**: Remove features that don't apply to this word form\n\u274c **Language-specific violations**: Apply ").concat(n,' grammatical rules strictly\n\nEXAMPLE VIOLATIONS TO CATCH:\n\u2022 "\u0437\u0430\u0441\u043b\u0443\u0433\u0438" (plural) + "Gender: Masculine" \u2192 INVALID (plural has no gender)\n\u2022 "Noun" + "Degree of comparison" \u2192 INVALID (nouns don\'t have degrees)\n\u2022 "Singular" + plural word ending \u2192 INVALID (form/feature mismatch)\n\nIGNORE: Individual feature accuracy - focus ONLY on overall consistency.\n\nRESPONSE FORMAT:\nVALIDATION: [VALID/INVALID]\nCONFIDENCE: [0.0-1.0]\nERRORS: [consistency errors only, or "None"]\nCORRECTIONS: [consistency corrections only, or "None"]');case"completeness":return"".concat(o,"\n\n\u{1f4cb} COMPLETENESS SPECIALIST VALIDATION\n\nYou are a specialist in checking completeness of grammar information. Focus EXCLUSIVELY on whether essential information is provided:\n\nPRIMARY CHECKS:\n\u2022 **Essential Categories**: Are the most important grammatical features included?\n\u2022 **Missing Information**: What crucial details are missing for learners?\n\u2022 **Usefulness**: Is this enough for language learners to understand the word?\n\u2022 **Context Appropriateness**: Does this match the learner's needs?\n\nCOMPLETENESS REQUIREMENTS for ").concat(n.toUpperCase(),':\n\u2022 Part of Speech: MANDATORY for all words\n\u2022 For Nouns: Gender (if applicable), number if not obvious\n\u2022 For Verbs: Tense/form if not infinitive  \n\u2022 For Adjectives: Degree if comparative/superlative\n\u2022 For English: Usually part of speech is sufficient\n\u2022 For inflected languages: More morphological detail needed\n\nSPECIFIC CHECKS:\n\u2705 "another" (English) + "\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u0435\u043b\u044c" \u2192 INCOMPLETE (should add "\u043d\u0435\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0439" or usage info)\n\u2705 "book" (English) + "\u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0435" \u2192 COMPLETE (sufficient for English)\n\u2705 "\u043a\u0440\u0430\u0441\u0438\u0432\u044b\u0439" (Russian) + "\u043f\u0440\u0438\u043b\u0430\u0433\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435, \u043c\u0443\u0436\u0441\u043a\u043e\u0439 \u0440\u043e\u0434" \u2192 COMPLETE\n\u274c "books" (English) + "\u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0435" \u2192 INCOMPLETE (missing plural form info)\n\nCRITICAL EVALUATION:\n\u2022 Is this TOO brief to be helpful?\n\u2022 Are learners missing crucial information?\n\u2022 Should additional categories be included?\n\nIGNORE: Technical accuracy of provided info - focus ONLY on completeness.\n\nRESPONSE FORMAT:\nVALIDATION: [VALID/INVALID]\nCONFIDENCE: [0.0-1.0]\nERRORS: [completeness issues only, or "None"]\nCORRECTIONS: [suggestions for missing info, or "None"]');default:return P(e,t,n,r)}}(n,r,a,o,i),[4,e.createChatCompletion(t,[{role:"user",content:l}])];case 1:return(s=x.sent())&&s.content?(c=s.content.trim(),console.log("".concat(i," validator response:"),c),u=c.includes("VALIDATION: VALID"),d=c.match(/CONFIDENCE:\s*([\d.]+)/),p=d?parseFloat(d[1]):.5,f=c.match(/ERRORS?:([\s\S]*?)(?:CORRECTIONS?:|$)/),h=c.match(/CORRECTIONS?:([\s\S]*?)$/),g=[],m=[],f&&f[1]&&(v=f[1].trim())&&"None"!==v&&"\u041d\u0435\u0442"!==v&&g.push.apply(g,v.split("\n").filter((function(e){return e.trim()})).map((function(e){return e.replace(/^[\u2022\-*]\s*/,"").trim()})).filter((function(e){return e.length>0}))),h&&h[1]&&(y=h[1].trim())&&"None"!==y&&"\u041d\u0435\u0442"!==y&&m.push.apply(m,y.split("\n").filter((function(e){return e.trim()})).map((function(e){return e.replace(/^[\u2022\-*]\s*/,"").trim()})).filter((function(e){return e.length>0}))),[2,{isValid:u,errors:g,corrections:m.length>0?m:void 0,confidence:p,validatorType:i}]):[2,{isValid:!1,errors:["".concat(i," validation failed - no response")],confidence:0,validatorType:i}];case 2:return b=x.sent(),console.error("Error in ".concat(i," validator:"),b),[2,{isValid:!1,errors:["".concat(i," validator error: ").concat(b instanceof Error?b.message:"Unknown error")],confidence:0,validatorType:i}];case 3:return[2]}}))}))}function U(e,t,n,r,a,o){return void 0===o&&(o="ru"),x(this,void 0,void 0,(function(){var i,l,s,c,u,d,p,f,h;return w(this,(function(g){switch(g.label){case 0:return console.log('Running multiple validation for "'.concat(n,'"')),i=["morphology","syntax","semantics","consistency","completeness"].map((function(i){return q(e,t,n,r,a,o,i)})),[4,Promise.all(i)];case 1:return l=g.sent(),s=l.filter((function(e){return e.isValid})),c=l.filter((function(e){return!e.isValid})),u=l.reduce((function(e,t){return e+t.confidence}),0)/l.length,d=s.length/l.length,p=d>=.75,f=[],h=[],c.forEach((function(e){e.errors.forEach((function(t){f.includes(t)||f.push("[".concat(e.validatorType,"] ").concat(t))})),e.corrections&&e.corrections.forEach((function(t){h.includes(t)||h.push("[".concat(e.validatorType,"] ").concat(t))}))})),console.log("Multiple validation complete: ".concat(s.length,"/").concat(l.length," passed, confidence: ").concat(u.toFixed(2))),[2,{overallValid:p,confidence:u,validations:l,finalErrors:f,finalCorrections:h,attempts:1}]}}))}))}function $(e,t,n,r,a){return void 0===a&&(a="ru"),x(this,void 0,void 0,(function(){var a,o,i,l,s;return w(this,(function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),console.log('Creating fast linguistic info for "'.concat(n,'" (1 request only)')),a=B(n,r),o=R(a,r),[4,e.createChatCompletion(t,[{role:"user",content:o}])];case 1:return(i=c.sent())&&i.content?(l=i.content.trim(),console.log("Fast linguistic info created successfully"),[2,{linguisticInfo:l,wasValidated:!1,attempts:1}]):(console.log("Failed to generate linguistic info"),[2,{linguisticInfo:null,wasValidated:!1,attempts:1}]);case 2:return s=c.sent(),console.error("Error creating fast linguistic info:",s),[2,{linguisticInfo:null,wasValidated:!1,attempts:1}];case 3:return[2]}}))}))}function H(e,t,n,r,a){return void 0===a&&(a="ru"),x(this,void 0,void 0,(function(){var o,i,l,s,c,u,d;return w(this,(function(p){switch(p.label){case 0:return p.trys.push([0,3,,4]),console.log('Creating optimized linguistic info for "'.concat(n,'" (max 2 requests)')),o=B(n,r),[4,e.createChatCompletion(t,[{role:"user",content:o}],{title:"Creating grammar reference",subtitle:"Generating detailed grammar and linguistic information",icon:"\u{1f4da}",color:"#9C27B0"})];case 1:return(i=p.sent())&&i.content?(l=i.content.trim(),console.log("Initial reference created"),s=O(l,n,a),[4,e.createChatCompletion(t,[{role:"user",content:s}],{title:"Validating grammar reference",subtitle:"Checking and improving linguistic information",icon:"\u{1f50d}",color:"#9C27B0"})]):(console.log("Failed to generate initial linguistic info"),[2,{linguisticInfo:null,wasValidated:!1,attempts:1}]);case 2:return(c=p.sent())&&c.content?(u=c.content.trim()).includes("\u0421\u041f\u0420\u0410\u0412\u041a\u0410 \u041a\u041e\u0420\u0420\u0415\u041a\u0422\u041d\u0410")||u.includes("\u041a\u041e\u0420\u0420\u0415\u041a\u0422\u041d\u0410")?(console.log("Reference validated as correct"),[2,{linguisticInfo:l,wasValidated:!0,attempts:2}]):(console.log("Reference was corrected by validator"),[2,{linguisticInfo:u,wasValidated:!0,attempts:2}]):(console.log("Validator failed, returning initial reference"),[2,{linguisticInfo:l,wasValidated:!1,attempts:2}]);case 3:return d=p.sent(),console.error("Error in optimized linguistic info creation:",d),[2,{linguisticInfo:null,wasValidated:!1,attempts:1}];case 4:return[2]}}))}))}},504:(e,t,n)=>{n.d(t,{$_:()=>l,Y3:()=>i,cr:()=>o});var r=function(){function e(e){this.requests=new Map,this.activeRequests=new Set,this.requestCounter=0,this.startTime=Date.now(),this.onProgressUpdate=e}return e.prototype.startRequest=function(e,t,n,r){var a="request_".concat(++this.requestCounter,"_").concat(Date.now()),o={id:a,operation:e,description:t,startTime:Date.now(),status:"pending",icon:n,color:r||this.getDefaultColor(e)};return this.requests.set(a,o),this.activeRequests.add(a),this.notifyProgressUpdate(),a},e.prototype.setInProgress=function(e){var t=this.requests.get(e);t&&(t.status="in-progress",this.notifyProgressUpdate())},e.prototype.completeRequest=function(e){var t=this.requests.get(e);t&&(t.status="completed",t.endTime=Date.now(),this.activeRequests.delete(e),this.notifyProgressUpdate())},e.prototype.errorRequest=function(e){var t=this.requests.get(e);t&&(t.status="error",t.endTime=Date.now(),this.activeRequests.delete(e),this.notifyProgressUpdate())},e.prototype.getCurrentProgress=function(){var e=this,t=Array.from(this.requests.values()),n=t.filter((function(e){return"completed"===e.status||"error"===e.status})).length,r=t.length,a=Array.from(this.activeRequests).map((function(t){return e.requests.get(t)})).find((function(e){return"in-progress"===(null==e?void 0:e.status)}));return{completed:n,total:r,currentRequest:a,progress:r>0?n/r*100:0,message:a?{title:a.operation,subtitle:a.description,icon:a.icon,color:a.color,currentStep:n+1,totalSteps:r,currentStepTitle:a.operation,currentStepSubtitle:a.description}:0===r?{title:"Ready",subtitle:"No active requests",icon:"\u2705",color:"#10B981"}:n===r&&r>0?{title:"Completed!",subtitle:"All ".concat(r," requests finished"),icon:"\u2705",color:"#10B981",currentStep:n,totalSteps:r,currentStepTitle:"Completed!",currentStepSubtitle:"All ".concat(r," requests finished")}:{title:"Processing...",subtitle:"".concat(n," of ").concat(r," requests completed"),icon:"\u26a1",color:"#3B82F6",currentStep:n,totalSteps:r,currentStepTitle:"Processing...",currentStepSubtitle:"".concat(n," of ").concat(r," requests completed")}}},e.prototype.getStats=function(){var e=Array.from(this.requests.values());return{total:e.length,completed:e.filter((function(e){return"completed"===e.status})).length,pending:e.filter((function(e){return"pending"===e.status})).length,inProgress:e.filter((function(e){return"in-progress"===e.status})).length,errors:e.filter((function(e){return"error"===e.status})).length,elapsedTime:Date.now()-this.startTime}},e.prototype.reset=function(){this.requests.clear(),this.activeRequests.clear(),this.requestCounter=0,this.startTime=Date.now(),this.notifyProgressUpdate()},e.prototype.getDefaultColor=function(e){for(var t=0,n=Object.entries({translate:"#3B82F6","generate-examples":"#F59E0B","analyze-word":"#8B5CF6","create-image-description":"#EC4899","generate-image":"#6366F1","create-card":"#10B981","save-card":"#EF4444",connect:"#6366F1"});t<n.length;t++){var r=n[t],a=r[0],o=r[1];if(e.toLowerCase().includes(a))return o}return"#6B7280"},e.prototype.getDefaultIcon=function(e){for(var t=0,n=Object.entries({translate:"\u{1f30d}","generate-examples":"\u{1f4a1}","analyze-word":"\u{1f50d}","create-image-description":"\u{1f3a8}","generate-image":"\u{1f5bc}\ufe0f","create-card":"\u{1f9e0}","save-card":"\u{1f4be}",connect:"\u{1f517}"});t<n.length;t++){var r=n[t],a=r[0],o=r[1];if(e.toLowerCase().includes(a))return o}return"\u26a1"},e.prototype.notifyProgressUpdate=function(){if(this.onProgressUpdate){var e=this.getCurrentProgress();this.onProgressUpdate(e)}},e}(),a=null,o=function(){return a||(a=new r),a},i=function(e){o().onProgressUpdate=e},l=function(){o().reset()}},482:(e,t,n)=>{n.d(t,{H:()=>c});var r=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))},a=function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(s){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&l[0]?r.return:l[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,l[1])).done)return a;switch(r=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,r=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],r=0}finally{n=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}},o="proxyFetch",i="proxyFetchAbort",l=function(){function e(e){this.payload=e}return Object.defineProperty(e.prototype,"ok",{get:function(){return this.payload.ok},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this.payload.status},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"statusText",{get:function(){return this.payload.statusText},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"headers",{get:function(){return this.payload.headers},enumerable:!1,configurable:!0}),e.prototype.text=function(){return r(this,void 0,void 0,(function(){return a(this,(function(e){return[2,this.payload.body]}))}))},e.prototype.json=function(){return r(this,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return[4,this.text()];case 1:return(e=t.sent())?[2,JSON.parse(e)]:[2,{}]}}))}))},e}(),s=function(){return new DOMException("The user aborted a request.","AbortError")};function c(e,t,n){return void 0===t&&(t={}),r(this,void 0,void 0,(function(){var r;return a(this,(function(a){if(null==n?void 0:n.aborted)throw s();return r="fetch_".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2)),[2,new Promise((function(a,c){var u,d=function(){n&&n.removeEventListener("abort",p)},p=function(){chrome.runtime.sendMessage({action:i,requestId:r}),d(),c(s())};n&&n.addEventListener("abort",p,{once:!0}),chrome.runtime.sendMessage({action:o,requestId:r,url:e,options:{method:t.method||"GET",headers:t.headers||{},body:null!==(u=t.body)&&void 0!==u?u:null,redirect:t.redirect,credentials:t.credentials}},(function(e){if(d(),chrome.runtime.lastError)c(new Error(chrome.runtime.lastError.message));else{if(e)return e.error&&!e.ok?e.aborted?void c(s()):void c(new Error(e.error)):void a(new l(e));c(new Error("No response from background fetch"))}}))}))]}))}))}},456:(e,t,n)=>{n.r(t),n.d(t,{cacheQuotaExceededError:()=>c,formatOpenAIErrorMessage:()=>f,generateAnkiBack:()=>k,generateAnkiFront:()=>S,getCachedQuotaError:()=>p,getDescriptionImage:()=>v,getExamples:()=>g,getOpenAiImageUrl:()=>b,getOptimizedImageUrl:()=>x,isAbstract:()=>m,isQuotaExceededCached:()=>s,markQuotaNotificationShown:()=>u,shouldShowQuotaNotification:()=>d,translateText:()=>h});var r=n(482),a=n(504),o=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))},i=function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(s){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&l[0]?r.return:l[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,l[1])).done)return a;switch(r=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,r=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],r=0}finally{n=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}},l=null,s=function(){return!!l&&(!(Date.now()-l.timestamp>3e5)||(l=null,!1))},c=function(e){l={timestamp:Date.now(),message:e,notificationShown:!1}},u=function(){l&&(l.notificationShown=!0)},d=function(){return null!==l&&!l.notificationShown},p=function(){return(null==l?void 0:l.message)||null},f=function(e){if(!e||!e.error)return"Unknown OpenAI API error";var t=e.error,n=t.message,r=t.type,a=t.code,o="string"==typeof n?n.toLowerCase():"",i="";return i="insufficient_quota"===a?"Your OpenAI account has exceeded its quota.\n\nPlease check your billing details or use a different API key.":"invalid_api_key"===a||o.includes("invalid api key")||o.includes("incorrect api key")||o.includes("api key provided is incorrect")||o.includes("api key is invalid")?"Authentication failed: Your OpenAI API key is invalid or revoked.\n\nOpen Settings and paste a valid key to continue.":"invalid_request_error"===r?"Invalid request to OpenAI.\n\nPlease review your API key and request settings.":"rate_limit_exceeded"===r?"OpenAI rate limit exceeded.\n\nPlease try again in a few minutes.":"OpenAI API Error: ".concat(n||"Unknown error"),i+="\n\nDetails:\n- Type: ".concat(r||"unknown","\n- Code: ").concat(a||"none")},h=function(e,t,n,u,d){return void 0===n&&(n="ru"),void 0===u&&(u=""),o(void 0,void 0,void 0,(function(){var o,p,h,g,m,v,y,b,x,w,S,k,C,E;return i(this,(function(i){switch(i.label){case 0:o=(0,a.cr)(),p=o.startRequest("Translating text","Converting your text to ".concat(n),"\u{1f30d}","#3B82F6"),i.label=1;case 1:if(i.trys.push([1,6,,7]),!e)throw o.errorRequest(p),new Error("OpenAI API key is missing. Please check your settings.");if(o.setInProgress(p),s())throw o.errorRequest(p),new Error(l.message);return h="Translate the following text to ".concat(n),g=u?"".concat(h,". ").concat(u):h,m={model:"gpt-3.5-turbo",messages:[{role:"system",content:g},{role:"user",content:"".concat(t)}]},[4,(0,r.H)("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(m)},d)];case 2:return(v=i.sent()).ok?[3,4]:[4,v.json()];case 3:if((y=i.sent())&&y.error)throw b=f(y),"insufficient_quota"!==y.error.code&&429!==v.status||c(b),new Error(b);throw new Error("OpenAI API error: ".concat(v.status," ").concat(v.statusText));case 4:return[4,v.json()];case 5:return x=i.sent(),o.completeRequest(p),[2,null!==(E=null===(C=null===(k=null===(S=x.choices[0])||void 0===S?void 0:S.message)||void 0===k?void 0:k.content)||void 0===C?void 0:C.trim())&&void 0!==E?E:null];case 6:if(w=i.sent(),console.error("Error during translation:",w),o.errorRequest(p),w instanceof Error){if(null==d?void 0:d.aborted)throw new Error("Translation cancelled by user");if(w.message.includes("quota")||w.message.includes("insufficient_quota"))throw new Error(w.message);throw new Error("Translation failed: ".concat(w.message))}throw w;case 7:return[2]}}))}))},g=function(e,t,n,u,d,p){return void 0===u&&(u=!1),void 0===d&&(d=""),o(void 0,void 0,void 0,(function(){var o,g,m,v,y,b,x,w,S,k,C,E,A,T,I,z,F,M,j,B,R,O;return i(this,(function(i){switch(i.label){case 0:o=(0,a.cr)(),g=o.startRequest("Creating example sentences",'Generating helpful examples for "'.concat(t,'"'),"\u{1f4a1}","#F59E0B"),i.label=1;case 1:if(i.trys.push([1,14,,15]),!e)throw o.errorRequest(g),new Error("OpenAI API key is missing. Please check your settings.");if(o.setInProgress(g),s())throw o.errorRequest(g),new Error(l.message);return m=d.replace(/\{word\}/g,t),v="Give me three example sentences using the word '".concat(t,"' in the original language (the language of this word). \nEach example should show natural usage of '").concat(t,"' in its native language context.\nReturn ONLY the examples, one per line, without any numbering, explanations, or translations."),y=d?"".concat(v," ").concat(m):v,b={model:"gpt-3.5-turbo",messages:[{role:"system",content:y}]},[4,(0,r.H)("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(b)},p)];case 2:return(x=i.sent()).ok?[3,4]:[4,x.json()];case 3:if((w=i.sent())&&w.error)throw S=f(w),"insufficient_quota"!==w.error.code&&429!==x.status||c(S),new Error(S);throw new Error("Could not generate examples. OpenAI API error: ".concat(x.status," ").concat(x.statusText));case 4:return[4,x.json()];case 5:k=i.sent(),C=null===(R=null===(B=k.choices[0])||void 0===B?void 0:B.message)||void 0===R?void 0:R.content,E=null!==(O=null==C?void 0:C.trim().split("\n"))&&void 0!==O?O:[],A=[],T=0,I=E,i.label=6;case 6:if(!(T<I.length))return[3,13];if(!(z=I[T]).trim())return[3,12];if(F=null,!u)return[3,11];i.label=7;case 7:return i.trys.push([7,9,10,11]),[4,h(e,z,n)];case 8:return F=i.sent(),[3,11];case 9:return M=i.sent(),console.error("Error translating example:",M),[3,11];case 10:return[7];case 11:A.push([z,F]),i.label=12;case 12:return T++,[3,6];case 13:if(0===A.length)throw o.errorRequest(g),new Error("Could not generate examples. Please try again with a different word or check your API key.");return o.completeRequest(g),[2,A];case 14:throw j=i.sent(),console.error("Error during getting examples:",j),o.errorRequest(g),j;case 15:return[2]}}))}))},m=function(e,t){return o(void 0,void 0,void 0,(function(){var n,o,u,d,p,h,g,m,v,y,b,x,w,S;return i(this,(function(i){switch(i.label){case 0:n=(0,a.cr)(),o=n.startRequest("Analyzing word type",'Determining if "'.concat(t,'" can be visualized'),"\u{1f50d}","#8B5CF6"),i.label=1;case 1:if(i.trys.push([1,6,,7]),!e)throw n.errorRequest(o),new Error("OpenAI API key is missing. Please check your settings.");if(n.setInProgress(o),s())throw n.errorRequest(o),new Error(l.message);return u=[{role:"system",content:"Is the word '".concat(t,"' an abstract concept or a concrete object? Answer 'abstract' or 'concrete':")}],d={model:"gpt-3.5-turbo",messages:u},[4,(0,r.H)("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(d)})];case 2:return(p=i.sent()).ok?[3,4]:[4,p.json()];case 3:if((h=i.sent())&&h.error)throw g=f(h),"insufficient_quota"!==h.error.code&&429!==p.status||c(g),new Error(g);throw new Error("OpenAI API error: ".concat(p.status," ").concat(p.statusText));case 4:return[4,p.json()];case 5:return m=i.sent(),v=null!==(S=null===(w=null===(x=null===(b=m.choices[0])||void 0===b?void 0:b.message)||void 0===x?void 0:x.content)||void 0===w?void 0:w.trim().toLowerCase())&&void 0!==S?S:"",n.completeRequest(o),[2,"abstract"===v];case 6:return y=i.sent(),console.error("Error during determining abstractness:",y),n.errorRequest(o),[2,!1];case 7:return[2]}}))}))},v=function(e,t,n,u){return void 0===n&&(n=""),o(void 0,void 0,void 0,(function(){var o,d,p,h,g,m,v,y,b,x,w,S,k,C,E;return i(this,(function(i){switch(i.label){case 0:o=(0,a.cr)(),d=o.startRequest("Crafting image description",'Creating detailed prompt for "'.concat(t,'" visualization'),"\u{1f3a8}","#EC4899"),i.label=1;case 1:if(i.trys.push([1,6,,7]),!e)throw o.errorRequest(d),new Error("OpenAI API key is missing. Please check your settings.");if(o.setInProgress(d),s())throw o.errorRequest(d),new Error(l.message);return p="Provide a detailed description for an image that represents the concept of '".concat(t,"'"),h=n?"".concat(p,". ").concat(n):p,g={model:"gpt-3.5-turbo",messages:[{role:"system",content:h}]},[4,(0,r.H)("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(g)},u)];case 2:return(m=i.sent()).ok?[3,4]:[4,m.json()];case 3:if((v=i.sent())&&v.error)throw y=f(v),"insufficient_quota"!==v.error.code&&429!==m.status||c(y),o.errorRequest(d),new Error(y);throw o.errorRequest(d),new Error("Could not generate image description. OpenAI API error: ".concat(m.status," ").concat(m.statusText));case 4:return[4,m.json()];case 5:if(b=i.sent(),!(x=null!==(E=null===(C=null===(k=null===(S=b.choices[0])||void 0===S?void 0:S.message)||void 0===k?void 0:k.content)||void 0===C?void 0:C.trim())&&void 0!==E?E:""))throw o.errorRequest(d),new Error("Could not generate a valid image description. Please try again.");return o.completeRequest(d),[2,x];case 6:throw w=i.sent(),console.error("Error during getting description image:",w),o.errorRequest(d),w;case 7:return[2]}}))}))},y=function(e,t,n){return void 0===n&&(n=""),o(void 0,void 0,void 0,(function(){var o,l,s,u,d,p,h,g,m,v,y,b;return i(this,(function(i){switch(i.label){case 0:o=(0,a.cr)(),l=o.startRequest("Generating image","Creating beautiful illustration with AI","\u{1f5bc}\ufe0f","#6366F1"),i.label=1;case 1:return i.trys.push([1,4,,5]),o.setInProgress(l),s=n?"".concat(t,". ").concat(n):t,[4,(0,r.H)("https://api.openai.com/v1/images/generations",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({model:"dall-e-2",prompt:s,n:1,size:"512x512",response_format:"url"})})];case 2:return[4,(u=i.sent()).json()];case 3:if(d=i.sent(),!u.ok){if(d&&d.error)throw p=f(d),"insufficient_quota"!==d.error.code&&429!==u.status||c(p),new Error(p);throw new Error("OpenAI image API error: ".concat(u.status," ").concat(u.statusText))}if(!(null===(b=null===(y=null==d?void 0:d.data)||void 0===y?void 0:y[0])||void 0===b?void 0:b.url))throw o.errorRequest(l),new Error("OpenAI did not return an image URL. Please try again.");return o.completeRequest(l),[2,d.data[0].url];case 4:if(h=i.sent(),console.error("Error during image generation:",h),o.errorRequest(l),h instanceof Error){if(g=h.message||"",(m=g.toLowerCase()).includes("quota")||m.includes("billing"))throw c(v="Your OpenAI account has exceeded its quota.\n\nPlease check your billing details or use a different API key."),new Error(v);if(m.includes("rate limit"))throw new Error("OpenAI rate limit exceeded.\n\nPlease try again in a few minutes.");if(m.includes("invalid api key")||m.includes("incorrect api key")||m.includes("api key provided is incorrect")||m.includes("api key is invalid"))throw new Error("Authentication failed: Your OpenAI API key is invalid or revoked.\n\nOpen Settings and paste a valid key to continue.");if(m.includes("moderation")||m.includes("policy"))throw new Error("OpenAI content policy violation.\n\nThe image request was flagged for content policy violation. Please modify your request.")}throw h instanceof Error?h:new Error("Failed to generate image.\n\nPlease check your OpenAI API key and try again.");case 5:return[2]}}))}))},b=function(e,t,n){return void 0===n&&(n=""),o(void 0,void 0,void 0,(function(){var r,o,c,u,d,p;return i(this,(function(i){switch(i.label){case 0:r=(0,a.cr)(),o=r.startRequest("Creating custom image",'Generating visual for "'.concat(t,'"'),"\u{1f5bc}\ufe0f","#6366F1"),i.label=1;case 1:if(i.trys.push([1,8,,9]),!e)throw r.errorRequest(o),new Error("OpenAI API key is missing. Please check your settings.");if(r.setInProgress(o),s())throw r.errorRequest(o),new Error(l.message);return[4,m(e,t)];case 2:return i.sent()?[4,v(e,t,n)]:[3,5];case 3:return c=i.sent(),[4,y(e,"Create a vivid, high-quality illustration representing the concept of '".concat(c,"'"),n)];case 4:return d=i.sent(),r.completeRequest(o),[2,d];case 5:return u="Create a high-quality, photorealistic image of a ".concat(t," with a neutral expression and clear features"),[4,y(e,u,n)];case 6:return d=i.sent(),r.completeRequest(o),[2,d];case 7:return[3,9];case 8:throw p=i.sent(),console.error("Error during getting image for word:",p),r.errorRequest(o),p;case 9:return[2]}}))}))},x=function(e,t,n){return void 0===n&&(n=""),o(void 0,void 0,void 0,(function(){var r,o,c,u,d;return i(this,(function(i){switch(i.label){case 0:r=(0,a.cr)(),o=r.startRequest("Creating optimized image",'Fast generation for "'.concat(t,'"'),"\u{1f5bc}\ufe0f","#6366F1"),i.label=1;case 1:if(i.trys.push([1,3,,4]),!e)throw r.errorRequest(o),new Error("OpenAI API key is missing. Please check your settings.");if(r.setInProgress(o),s())throw r.errorRequest(o),new Error(l.message);return c='Create a high-quality, clear image representing "'.concat(t,'".'),c=/^[A-Z]/.test(t)||t.length>15?'Create a symbolic, artistic illustration that clearly represents the concept of "'.concat(t,'". Use clear visual metaphors and symbols.'):'Create a photorealistic image of "'.concat(t,'" with good lighting and clear details on a neutral background.'),n&&(c+=" ".concat(n)),[4,y(e,c,"")];case 2:return u=i.sent(),r.completeRequest(o),[2,u];case 3:throw d=i.sent(),console.error("Error during optimized image generation:",d),r.errorRequest(o),d;case 4:return[2]}}))}))},w=function(e,t){return o(void 0,void 0,void 0,(function(){var n,o,u,d,p,h,g,m,v,y,b,x;return i(this,(function(i){switch(i.label){case 0:n=(0,a.cr)(),o=n.startRequest("Detecting language","Identifying the language of your text","\u{1f524}","#8B5CF6"),i.label=1;case 1:if(i.trys.push([1,6,,7]),!e)throw n.errorRequest(o),new Error("OpenAI API key is missing. Please check your settings.");if(n.setInProgress(o),s())throw n.errorRequest(o),new Error(l.message);return u={model:"gpt-3.5-turbo",messages:[{role:"system",content:"You are langauage expert"},{role:"user",content:"What is the name of this language: ".concat(t,". Give only name of this language in one word")}]},[4,(0,r.H)("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(u)})];case 2:return(d=i.sent()).ok?[3,4]:[4,d.json()];case 3:if((p=i.sent())&&p.error)throw h=f(p),"insufficient_quota"!==p.error.code&&429!==d.status||c(h),new Error(h);throw new Error("OpenAI API error: ".concat(d.status," ").concat(d.statusText));case 4:return[4,d.json()];case 5:return g=i.sent(),n.completeRequest(o),[2,null!==(x=null===(b=null===(y=null===(v=g.choices[0])||void 0===v?void 0:v.message)||void 0===y?void 0:y.content)||void 0===b?void 0:b.trim())&&void 0!==x?x:null];case 6:throw m=i.sent(),console.error("Error during language name detection:",m),n.errorRequest(o),m;case 7:return[2]}}))}))},S=function(e,t,n){return o(void 0,void 0,void 0,(function(){var o,c,u,d,p,f,h,g,m,v;return i(this,(function(i){switch(i.label){case 0:o=(0,a.cr)(),c=o.startRequest("Creating question","Crafting an effective question for your flashcard","\u2753","#10B981"),i.label=1;case 1:if(i.trys.push([1,5,,6]),!e)throw o.errorRequest(c),new Error("OpenAI API key is missing. Please check your settings.");if(o.setInProgress(c),s())throw o.errorRequest(c),new Error(l.message);return[4,w(e,t)];case 2:return u=i.sent(),d={model:"gpt-3.5-turbo",messages:[{role:"system",content:"You generate a question based on the text entered. You answer should be in ".concat(u)},{role:"user",content:"Give a main question of this text: ".concat(t,"'. You answer should be in ").concat(u)}]},[4,(0,r.H)("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(d)},n)];case 3:return[4,i.sent().json()];case 4:return p=i.sent(),o.completeRequest(c),[2,null!==(v=null===(m=null===(g=null===(h=p.choices[0])||void 0===h?void 0:h.message)||void 0===g?void 0:g.content)||void 0===m?void 0:m.trim())&&void 0!==v?v:null];case 5:return f=i.sent(),console.error("Error during generating front side of the Anki card:",f),o.errorRequest(c),[2,null];case 6:return[2]}}))}))},k=function(e,t){return o(void 0,void 0,void 0,(function(){var n,o,c,u,d,p,f,h,g,m;return i(this,(function(i){switch(i.label){case 0:n=(0,a.cr)(),o=n.startRequest("Creating answer","Developing comprehensive answer for your card","\u{1f4d6}","#F59E0B"),i.label=1;case 1:if(i.trys.push([1,5,,6]),!e)throw n.errorRequest(o),new Error("OpenAI API key is missing. Please check your settings.");if(n.setInProgress(o),s())throw n.errorRequest(o),new Error(l.message);return[4,w(e,t)];case 2:return c=i.sent(),u={model:"gpt-3.5-turbo",messages:[{role:"system",content:"You generate a key point based on the text entered. For back of flash card. You answer should be in ".concat(c)},{role:"user",content:"Anilize text. Highlight the key points from this text. Put them in a list of senteses with dash points.\n                                Text: '".concat(t,"'. You answer should be in ").concat(c,". Key points should be competed and make sence")}]},[4,(0,r.H)("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(u)})];case 3:return[4,i.sent().json()];case 4:return d=i.sent(),n.completeRequest(o),[2,null!==(m=null===(g=null===(h=null===(f=d.choices[0])||void 0===f?void 0:f.message)||void 0===h?void 0:h.content)||void 0===g?void 0:g.trim())&&void 0!==m?m:null];case 5:return p=i.sent(),console.error("Error during generating back side of the Anki card:",p),n.errorRequest(o),[2,null];case 6:return[2]}}))}))}},736:(e,t,n)=>{n.r(t),n.d(t,{PageContentExtractor:()=>o});var r=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))},a=function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(s){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&l[0]?r.return:l[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,l[1])).done)return a;switch(r=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,r=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],r=0}finally{n=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}},o=function(){function e(){}return e.extractPageContent=function(e,t){return{selectedText:e,pageImages:this.extractImages(e,t),formulas:this.extractFormulas(e,t),codeBlocks:this.extractCodeBlocks(e,t),links:this.extractLinks(e,t),metadata:this.extractMetadata()}},e.extractPageContentAsync=function(e,t){return r(this,void 0,void 0,(function(){var n,r,o,i,l;return a(this,(function(a){switch(a.label){case 0:return console.log("\u{1f50d} \u0410\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u043e \u0438\u0437\u0432\u043b\u0435\u043a\u0430\u0435\u043c \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b..."),[4,this.extractImagesAsync(e,t)];case 1:return n=a.sent(),r=this.extractFormulas(e,t),o=this.extractCodeBlocks(e,t),i=this.extractLinks(e,t),l=this.extractMetadata(),console.log("\u{1f4c4} \u0410\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u0430\u044f \u044d\u043a\u0441\u0442\u0440\u0430\u043a\u0446\u0438\u044f \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0430:",{images:n.length,formulas:r.length,codeBlocks:o.length,links:i.length}),[2,{selectedText:e,pageImages:n,formulas:r,codeBlocks:o,links:i,metadata:l}]}}))}))},e.extractImages=function(e,t){var n=this,r=[],a=document.querySelectorAll("img");console.log("\u{1f50d} \u041d\u0430\u0439\u0434\u0435\u043d\u043e ".concat(a.length," \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0439 \u043d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435")),a.forEach((function(a,o){if(a.width<30||a.height<30)console.log("\u23ed\ufe0f \u041f\u0440\u043e\u043f\u0443\u0441\u043a\u0430\u0435\u043c \u043c\u0430\u043b\u0435\u043d\u044c\u043a\u043e\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 ".concat(o,": ").concat(a.width,"x").concat(a.height));else if(a.src)if(a.src.startsWith("data:image")&&a.src.length>5e3)console.log("\u23ed\ufe0f \u041f\u0440\u043e\u043f\u0443\u0441\u043a\u0430\u0435\u043c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 ".concat(o,": \u0441\u043b\u0438\u0448\u043a\u043e\u043c \u0434\u043b\u0438\u043d\u043d\u044b\u0439 data URL"));else{var i=n.isElementNearSelection(a,t,e),l=n.calculateImageRelevance(a,e,i);if(console.log("\u{1f5bc}\ufe0f \u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 ".concat(o,":"),{src:a.src.substring(0,50)+"...",alt:a.alt,size:"".concat(a.width,"x").concat(a.height),isNearText:i,relevanceScore:l,willInclude:l>.1}),l>.1){var s=n.convertImageToBase64(a);r.push({src:a.src,alt:a.alt||a.title||"",title:a.title,width:a.naturalWidth||a.width,height:a.naturalHeight||a.height,isNearText:i,relevanceScore:l,base64:s}),console.log("\u2705 \u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u043e \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 ".concat(o," (score: ").concat(l,")"))}else console.log("\u274c \u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 ".concat(o," \u043d\u0435 \u043f\u0440\u043e\u0448\u043b\u043e \u043f\u043e\u0440\u043e\u0433 (score: ").concat(l,")"))}else console.log("\u23ed\ufe0f \u041f\u0440\u043e\u043f\u0443\u0441\u043a\u0430\u0435\u043c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 ".concat(o,": \u043d\u0435\u0442 src"))}));var o=document.querySelectorAll("svg");console.log("\u{1f50d} \u041d\u0430\u0439\u0434\u0435\u043d\u043e ".concat(o.length," SVG \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432")),o.forEach((function(a,o){var i,l,s=(null===(i=a.width.baseVal)||void 0===i?void 0:i.value)||0,c=(null===(l=a.height.baseVal)||void 0===l?void 0:l.value)||0;if(s<30||c<30)console.log("\u23ed\ufe0f \u041f\u0440\u043e\u043f\u0443\u0441\u043a\u0430\u0435\u043c \u043c\u0430\u043b\u0435\u043d\u044c\u043a\u0438\u0439 SVG ".concat(o,": ").concat(s,"x").concat(c));else{var u=n.isElementNearSelection(a,t,e),d=n.calculateSvgRelevance(a,e,u);console.log("\u{1f3a8} SVG ".concat(o,":"),{size:"".concat(s,"x").concat(c),isNearText:u,relevanceScore:d,willInclude:d>.1}),d>.1&&(r.push({src:n.svgToDataUrl(a),alt:a.getAttribute("aria-label")||a.getAttribute("title")||"SVG \u0434\u0438\u0430\u0433\u0440\u0430\u043c\u043c\u0430",width:s||200,height:c||200,isNearText:u,relevanceScore:d,base64:n.svgToDataUrl(a)}),console.log("\u2705 \u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d SVG ".concat(o," (score: ").concat(d,")")))}}));var i=r.sort((function(e,t){return t.relevanceScore-e.relevanceScore})).slice(0,10);if(0===i.length){console.log("\u{1f6a8} \u041d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e \u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u044b\u0445 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0439, \u043f\u0440\u0438\u043c\u0435\u043d\u044f\u0435\u043c \u0430\u0432\u0430\u0440\u0438\u0439\u043d\u0443\u044e \u043b\u043e\u0433\u0438\u043a\u0443");var l=[];a.forEach((function(e,t){if(e.width>=30&&e.height>=30&&e.src){var r=n.convertImageToBase64(e);l.push({src:e.src,alt:e.alt||e.title||"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 ".concat(t+1),title:e.title,width:e.naturalWidth||e.width,height:e.naturalHeight||e.height,isNearText:!1,relevanceScore:.5,base64:r})}})),i=l.slice(0,5),console.log("\u{1f3af} \u0410\u0412\u0410\u0420\u0418\u0419\u041d\u042b\u0419 \u0420\u0415\u0416\u0418\u041c: \u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u043e ".concat(i.length," \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0439"))}return console.log("\u{1f3af} \u0424\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442: ".concat(i.length," \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0439 \u0438\u0437 ").concat(r.length," \u043d\u0430\u0439\u0434\u0435\u043d\u043d\u044b\u0445")),i},e.extractImagesAsync=function(e,t){return r(this,void 0,void 0,(function(){var n,o,i,l=this;return a(this,(function(s){switch(s.label){case 0:return n=[],o=document.querySelectorAll("img"),i=Array.from(o).map((function(n){return r(l,void 0,void 0,(function(){var r,o,i;return a(this,(function(a){switch(a.label){case 0:return n.width<50||n.height<50||(!n.src||n.src.startsWith("data:image")&&n.src.length>1e3)?[2,null]:(r=this.isElementNearSelection(n,t,e),(o=this.calculateImageRelevance(n,e,r))<=.3?[2,null]:!n.src.startsWith("http")||n.src.includes(window.location.origin)?[3,2]:(console.log("\u{1f5bc}\ufe0f \u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043c \u0432\u043d\u0435\u0448\u043d\u0435\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435:",n.src),[4,this.fetchImageAsBase64(n.src)]));case 1:return i=a.sent(),[3,3];case 2:i=this.convertImageToBase64(n),a.label=3;case 3:return[2,{src:n.src,alt:n.alt||n.title||"",title:n.title,width:n.naturalWidth||n.width,height:n.naturalHeight||n.height,isNearText:r,relevanceScore:o,base64:i}]}}))}))})),[4,Promise.all(i)];case 1:return s.sent().forEach((function(e){e&&n.push(e)})),document.querySelectorAll("svg").forEach((function(r){var a,o,i=(null===(a=r.width.baseVal)||void 0===a?void 0:a.value)||0,s=(null===(o=r.height.baseVal)||void 0===o?void 0:o.value)||0;if(!(i<50||s<50)){var c=l.isElementNearSelection(r,t,e),u=l.calculateSvgRelevance(r,e,c);u>.3&&n.push({src:l.svgToDataUrl(r),alt:r.getAttribute("aria-label")||r.getAttribute("title")||"SVG \u0434\u0438\u0430\u0433\u0440\u0430\u043c\u043c\u0430",width:i||200,height:s||200,isNearText:c,relevanceScore:u,base64:l.svgToDataUrl(r)})}})),console.log("\u{1f5bc}\ufe0f \u041d\u0430\u0439\u0434\u0435\u043d\u043e ".concat(n.length," \u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u044b\u0445 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0439 (\u0432\u043a\u043b\u044e\u0447\u0430\u044f ").concat(n.filter((function(e){return e.base64})).length," \u0441 base64)")),[2,n.sort((function(e,t){return t.relevanceScore-e.relevanceScore})).slice(0,5)]}}))}))},e.extractFormulas=function(e,t){var n=this,r=[];document.querySelectorAll('.MathJax, .math, [class*="math"]').forEach((function(a){var o=n.extractFormulaText(a);if(o){var i=n.isElementNearSelection(a,t,e);r.push({text:o,type:n.detectFormulaType(a),isNearText:i,relevanceScore:n.calculateFormulaRelevance(o,e,i)})}}));var a=[/\$\$([^$]+)\$\$/g,/\$([^$]+)\$/g,/\\begin\{[^}]+\}[\s\S]*?\\end\{[^}]+\}/g],o=document.body.textContent||"";return a.forEach((function(t){for(var i;null!==(i=t.exec(o));){var l=i[1]||i[0],s=o.toLowerCase().includes(e.toLowerCase());r.push({text:l,type:t===a[0]?"block":"inline",isNearText:s,relevanceScore:n.calculateFormulaRelevance(l,e,s)})}})),r.filter((function(e){return e.relevanceScore>.2})).sort((function(e,t){return t.relevanceScore-e.relevanceScore})).slice(0,3)},e.extractCodeBlocks=function(e,t){var n=this,r=[];return document.querySelectorAll("pre code, .highlight code, .code-block, .codehilite").forEach((function(a){var o,i=null===(o=a.textContent)||void 0===o?void 0:o.trim();if(i&&i.length>10&&i.length<2e3){var l=n.isElementNearSelection(a,t,e),s=n.detectCodeLanguage(a);r.push({code:i,language:s,isNearText:l,relevanceScore:n.calculateCodeRelevance(i,e,l)})}})),document.querySelectorAll("code:not(pre code)").forEach((function(a){var o,i=null===(o=a.textContent)||void 0===o?void 0:o.trim();if(i&&i.length>3&&i.length<100){var l=n.isElementNearSelection(a,t,e);r.push({code:i,language:"inline",isNearText:l,relevanceScore:n.calculateCodeRelevance(i,e,l)})}})),r.filter((function(e){return e.relevanceScore>.3})).sort((function(e,t){return t.relevanceScore-e.relevanceScore})).slice(0,5)},e.extractLinks=function(e,t){var n=this,r=[];return document.querySelectorAll("a[href]").forEach((function(a){var o,i=a.getAttribute("href"),l=null===(o=a.textContent)||void 0===o?void 0:o.trim();if(i&&l&&i.startsWith("http")){var s=n.isElementNearSelection(a,t,e),c=n.calculateLinkRelevance(l,i,e,s);c>.2&&r.push({url:i,text:l,isNearText:s,relevanceScore:c})}})),r.sort((function(e,t){return t.relevanceScore-e.relevanceScore})).slice(0,3)},e.extractMetadata=function(){return{url:window.location.href,title:document.title,domain:window.location.hostname,language:document.documentElement.lang||"en",hasImages:document.querySelectorAll("img").length>0,hasFormulas:document.querySelectorAll('.MathJax, .math, [class*="math"]').length>0||(document.body.textContent||"").includes("$"),hasCode:document.querySelectorAll("pre code, .highlight, .code-block").length>0}},e.isElementNearSelection=function(e,t,n){var r;if(!t){var a=e.textContent||"",o=(null===(r=e.parentElement)||void 0===r?void 0:r.textContent)||"";return a.toLowerCase().includes((n||"").toLowerCase())||o.toLowerCase().includes((n||"").toLowerCase())}var i=e.getBoundingClientRect(),l=t.getBoundingClientRect();return Math.sqrt(Math.pow(i.left-l.left,2)+Math.pow(i.top-l.top,2))<500},e.calculateImageRelevance=function(e,t,n){var r=.3;n&&(r+=.4);var a=(e.alt||"").toLowerCase(),o=t.toLowerCase();(a.includes(o)||o.includes(a))&&(r+=.3);var i=e.naturalWidth||e.width,l=e.naturalHeight||e.height;return i>=50&&l>=50&&(r+=.2),(a.includes("icon")||a.includes("logo")||i<50||l<50)&&(r-=.2),(a.includes("diagram")||a.includes("chart")||a.includes("graph")||a.includes("figure")||a.includes("\u0441\u0445\u0435\u043c\u0430")||a.includes("\u0434\u0438\u0430\u0433\u0440\u0430\u043c\u043c\u0430")||a.includes("\u0440\u0438\u0441\u0443\u043d\u043e\u043a")||a.includes("\u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435"))&&(r+=.3),console.log("\u{1f4ca} Relevance calculation for image:",{alt:a.substring(0,30),size:"".concat(i,"x").concat(l),isNearText:n,finalScore:Math.max(0,Math.min(1,r))}),Math.max(0,Math.min(1,r))},e.calculateSvgRelevance=function(e,t,n){var r=0;n&&(r+=.5),r+=.3;var a=e.textContent||"";return(a.toLowerCase().includes(t.toLowerCase())||t.toLowerCase().includes(a.toLowerCase()))&&(r+=.2),Math.max(0,Math.min(1,r))},e.calculateFormulaRelevance=function(e,t,n){var r=0;n&&(r+=.4);var a=t.toLowerCase().match(/\b(\u0444\u043e\u0440\u043c\u0443\u043b\u0430|\u0443\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u0435|\u0444\u0443\u043d\u043a\u0446\u0438\u044f|\u0438\u043d\u0442\u0435\u0433\u0440\u0430\u043b|\u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u043d\u0430\u044f|\u043c\u0430\u0442\u0440\u0438\u0446\u0430|\u0432\u0435\u043a\u0442\u043e\u0440|\u043b\u043e\u0433\u0430\u0440\u0438\u0444\u043c|\u0441\u0438\u043d\u0443\u0441|\u043a\u043e\u0441\u0438\u043d\u0443\u0441|\u0442\u0430\u043d\u0433\u0435\u043d\u0441|\u043f\u0440\u0435\u0434\u0435\u043b|\u0441\u0443\u043c\u043c\u0430|\u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0434\u0435\u043d\u0438\u0435)\b/g);return a&&a.length>0&&(r+=.4),e.length>20&&(r+=.2),Math.max(0,Math.min(1,r))},e.calculateCodeRelevance=function(e,t,n){var r=0;n&&(r+=.4);var a=t.toLowerCase().match(/\b(\u0430\u043b\u0433\u043e\u0440\u0438\u0442\u043c|\u0444\u0443\u043d\u043a\u0446\u0438\u044f|\u043c\u0435\u0442\u043e\u0434|\u043a\u043b\u0430\u0441\u0441|\u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0430\u044f|\u043c\u0430\u0441\u0441\u0438\u0432|\u0446\u0438\u043a\u043b|\u0443\u0441\u043b\u043e\u0432\u0438\u0435|\u043a\u043e\u0434|\u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0430|\u0441\u043a\u0440\u0438\u043f\u0442)\b/g);return a&&a.length>0&&(r+=.4),e.includes("\n")&&e.includes("{")&&e.includes("}")&&(r+=.2),Math.max(0,Math.min(1,r))},e.calculateLinkRelevance=function(e,t,n,r){var a=0;return r&&(a+=.3),(e.toLowerCase().includes(n.toLowerCase())||n.toLowerCase().includes(e.toLowerCase()))&&(a+=.4),(t.includes("wikipedia")||t.includes("edu")||t.includes("documentation"))&&(a+=.3),Math.max(0,Math.min(1,a))},e.convertImageToBase64=function(e){try{if(!e.complete||0===e.naturalWidth)return void console.warn("Image not loaded yet:",e.src);var t=document.createElement("canvas"),n=t.getContext("2d");if(!n)return;return t.width=e.naturalWidth||e.width,t.height=e.naturalHeight||e.height,n.fillStyle="#FFFFFF",n.fillRect(0,0,t.width,t.height),n.drawImage(e,0,0),t.toDataURL("image/png",1)}catch(e){return void console.warn("Could not convert image to base64:",e)}},e.fetchImageAsBase64=function(e){return r(this,void 0,void 0,(function(){var t;return a(this,(function(n){try{return console.log("\u{1f5bc}\ufe0f \u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043c \u0432\u043d\u0435\u0448\u043d\u0435\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435:",e),(t=new Image).crossOrigin="anonymous",[2,new Promise((function(n){t.onload=function(){try{var e=document.createElement("canvas"),r=e.getContext("2d");if(!r)return void n(void 0);e.width=t.naturalWidth,e.height=t.naturalHeight,r.fillStyle="#FFFFFF",r.fillRect(0,0,e.width,e.height),r.drawImage(t,0,0);var a=e.toDataURL("image/png",1);console.log("\u2705 \u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u043e \u0432 base64"),n(a)}catch(e){console.warn("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u0438 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f:",e),n(void 0)}},t.onerror=function(){console.warn("\u041e\u0448\u0438\u0431\u043a\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f:",e),n(void 0)},t.src=e}))]}catch(e){return console.warn("Failed to fetch image as base64:",e),[2,void 0]}return[2]}))}))},e.svgToDataUrl=function(e){var t=(new XMLSerializer).serializeToString(e);return"data:image/svg+xml;base64,".concat(btoa(t))},e.extractFormulaText=function(e){var t=e.querySelector("math");return t?t.textContent||t.innerHTML:e.getAttribute("data-latex")||e.getAttribute("data-math")||e.textContent||null},e.detectFormulaType=function(e){if(e.querySelector("math"))return"mathml";var t=e.className.toLowerCase();return t.includes("display")||t.includes("block")?"block":t.includes("inline")?"inline":"latex"},e.detectCodeLanguage=function(e){var t=e.className.match(/language-(\w+)|lang-(\w+)|highlight-(\w+)/);if(t)return t[1]||t[2]||t[3];var n=e.getAttribute("data-lang")||e.getAttribute("data-language");if(n)return n;var r=e.textContent||"";return r.includes("function")&&r.includes("{")?"javascript":r.includes("def ")&&r.includes(":")?"python":r.includes("#include")||r.includes("int main")?"cpp":r.includes("public class")||r.includes("System.out")?"java":void 0},e}()},78:(e,t,n)=>{n.d(t,{BE:()=>I,Br:()=>y,Fo:()=>T,GN:()=>d,H1:()=>F,K$:()=>v,KS:()=>M,OD:()=>h,R6:()=>u,Sv:()=>s,VM:()=>o,Wf:()=>f,Wy:()=>x,Xn:()=>c,ZJ:()=>k,Zm:()=>C,_W:()=>S,a0:()=>b,d$:()=>g,dU:()=>z,h9:()=>m,iY:()=>w,j9:()=>a,oV:()=>i,ow:()=>p,qM:()=>A,r:()=>r,x0:()=>l,yo:()=>E});var r="SET_OPEN_AI_KEY",a="SET_SELECTED_MODE",o="SET_TRANSLATE_TO_LANGUAGE",i="SET_ANKI_CONNECT_URL",l="SET_ANKI_CONNECT_API_KEY",s="SET_USE_ANKI_CONNECT",c="SET_VISIBLE_SIDEBAR",u="SET_SHOULD_GENERATE_IMAGE",d="SET_IMAGE_GENERATION_MODE",p="SET_TRANSLATION_PROMPT",f="SET_EXAMPLES_PROMPT",h="SET_AI_INSTRUCTIONS",g="SET_IMAGE_INSTRUCTIONS",m="SET_MODEL_PROVIDER",v="SET_GROQ_API_KEY",y="SET_GROQ_MODEL_NAME",b="SET_SOURCE_LANGUAGE",x=function(e){return{type:r,payload:e}},w=function(e){return{type:a,payload:e}},S=function(e){return{type:o,payload:e}},k=function(e){return{type:i,payload:e}},C=function(e){return{type:l,payload:e}},E=function(e){return{type:u,payload:e}},A=function(e){return{type:h,payload:e}},T=function(e){return{type:g,payload:e}},I=function(e){return{type:d,payload:e}},z=function(e){return{type:m,payload:e}},F=function(e){return{type:v,payload:e}},M=function(e){return{type:y,payload:e}}},148:(e,t,n)=>{n.d(t,{W:()=>s,l:()=>r});var r,a=n(78),o=n(55),i=function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},i.apply(this,arguments)};!function(e){e.OpenAI="openai",e.Groq="groq"}(r||(r={}));var l={openAiKey:"",mode:o.d.LanguageLearning,translateToLanguage:"ru",ankiConnectUrl:"http://127.0.0.1:8765",ankiConnectApiKey:null,useAnkiConnect:!1,visibleSideBar:!0,groqApiKey:"",groqModelName:"llama3-8b-8192",shouldGenerateImage:!0,imageGenerationMode:"smart",translationPrompt:"",examplesPrompt:"",aiInstructions:"",imageInstructions:"",modelProvider:r.OpenAI,sourceLanguage:"en"},s=function(e,t){switch(void 0===e&&(e=l),t.type){case a.r:return i(i({},e),{openAiKey:t.payload});case a.j9:return i(i({},e),{mode:o.d.LanguageLearning});case a.VM:return i(i({},e),{translateToLanguage:t.payload});case a.oV:return i(i({},e),{ankiConnectUrl:t.payload});case a.x0:return i(i({},e),{ankiConnectApiKey:t.payload});case a.Sv:return i(i({},e),{useAnkiConnect:t.payload});case a.Xn:return i(i({},e),{visibleSideBar:t.visible});case a.K$:return i(i({},e),{groqApiKey:t.payload});case a.Br:return i(i({},e),{groqModelName:t.payload});case a.R6:return i(i({},e),{shouldGenerateImage:t.payload});case a.ow:return i(i({},e),{translationPrompt:t.payload});case a.Wf:return i(i({},e),{examplesPrompt:t.payload});case a.OD:return i(i({},e),{aiInstructions:t.payload});case a.d$:return i(i({},e),{imageInstructions:t.payload});case a.GN:return i(i({},e),{imageGenerationMode:t.payload});case a.h9:return i(i({},e),{modelProvider:t.payload});case a.a0:return i(i({},e),{sourceLanguage:t.payload});default:return e}}},984:(e,t,n)=>{n.r(t),n.d(t,{processLatexInContent:()=>la,processLatexInContentAsync:()=>sa,renderLatexFormula:()=>oa,renderLatexFormulaSync:()=>ia,testKaTeXRendering:()=>ca});class r{constructor(e,t,n){this.lexer=void 0,this.start=void 0,this.end=void 0,this.lexer=e,this.start=t,this.end=n}static range(e,t){return t?e&&e.loc&&t.loc&&e.loc.lexer===t.loc.lexer?new r(e.loc.lexer,e.loc.start,t.loc.end):null:e&&e.loc}}class a{constructor(e,t){this.text=void 0,this.loc=void 0,this.noexpand=void 0,this.treatAsRelax=void 0,this.text=e,this.loc=t}range(e,t){return new a(t,r.range(this,e))}}class o{constructor(e,t){this.name=void 0,this.position=void 0,this.length=void 0,this.rawMessage=void 0;var n,r,a="KaTeX parse error: "+e,i=t&&t.loc;if(i&&i.start<=i.end){var l=i.lexer.input;n=i.start,r=i.end,n===l.length?a+=" at end of input: ":a+=" at position "+(n+1)+": ";var s=l.slice(n,r).replace(/[^]/g,"$&\u0332");a+=(n>15?"\u2026"+l.slice(n-15,n):l.slice(0,n))+s+(r+15<l.length?l.slice(r,r+15)+"\u2026":l.slice(r))}var c=new Error(a);return c.name="ParseError",c.__proto__=o.prototype,c.position=n,null!=n&&null!=r&&(c.length=r-n),c.rawMessage=e,c}}o.prototype.__proto__=Error.prototype;var i=/([A-Z])/g,l={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"},s=/[&><"']/g;var c=function e(t){return"ordgroup"===t.type||"color"===t.type?1===t.body.length?e(t.body[0]):t:"font"===t.type?e(t.body):t},u={contains:function(e,t){return-1!==e.indexOf(t)},deflt:function(e,t){return void 0===e?t:e},escape:function(e){return String(e).replace(s,(e=>l[e]))},hyphenate:function(e){return e.replace(i,"-$1").toLowerCase()},getBaseElem:c,isCharacterBox:function(e){var t=c(e);return"mathord"===t.type||"textord"===t.type||"atom"===t.type},protocolFromUrl:function(e){var t=/^[\x00-\x20]*([^\\/#?]*?)(:|&#0*58|&#x0*3a|&colon)/i.exec(e);return t?":"!==t[2]?null:/^[a-zA-Z][a-zA-Z0-9+\-.]*$/.test(t[1])?t[1].toLowerCase():null:"_relative"}},d={displayMode:{type:"boolean",description:"Render math in display mode, which puts the math in display style (so \\int and \\sum are large, for example), and centers the math on the page on its own line.",cli:"-d, --display-mode"},output:{type:{enum:["htmlAndMathml","html","mathml"]},description:"Determines the markup language of the output.",cli:"-F, --format <type>"},leqno:{type:"boolean",description:"Render display math in leqno style (left-justified tags)."},fleqn:{type:"boolean",description:"Render display math flush left."},throwOnError:{type:"boolean",default:!0,cli:"-t, --no-throw-on-error",cliDescription:"Render errors (in the color given by --error-color) instead of throwing a ParseError exception when encountering an error."},errorColor:{type:"string",default:"#cc0000",cli:"-c, --error-color <color>",cliDescription:"A color string given in the format 'rgb' or 'rrggbb' (no #). This option determines the color of errors rendered by the -t option.",cliProcessor:e=>"#"+e},macros:{type:"object",cli:"-m, --macro <def>",cliDescription:"Define custom macro of the form '\\foo:expansion' (use multiple -m arguments for multiple macros).",cliDefault:[],cliProcessor:(e,t)=>(t.push(e),t)},minRuleThickness:{type:"number",description:"Specifies a minimum thickness, in ems, for fraction lines, `\\sqrt` top lines, `{array}` vertical lines, `\\hline`, `\\hdashline`, `\\underline`, `\\overline`, and the borders of `\\fbox`, `\\boxed`, and `\\fcolorbox`.",processor:e=>Math.max(0,e),cli:"--min-rule-thickness <size>",cliProcessor:parseFloat},colorIsTextColor:{type:"boolean",description:"Makes \\color behave like LaTeX's 2-argument \\textcolor, instead of LaTeX's one-argument \\color mode change.",cli:"-b, --color-is-text-color"},strict:{type:[{enum:["warn","ignore","error"]},"boolean","function"],description:"Turn on strict / LaTeX faithfulness mode, which throws an error if the input uses features that are not supported by LaTeX.",cli:"-S, --strict",cliDefault:!1},trust:{type:["boolean","function"],description:"Trust the input, enabling all HTML features such as \\url.",cli:"-T, --trust"},maxSize:{type:"number",default:1/0,description:"If non-zero, all user-specified sizes, e.g. in \\rule{500em}{500em}, will be capped to maxSize ems. Otherwise, elements and spaces can be arbitrarily large",processor:e=>Math.max(0,e),cli:"-s, --max-size <n>",cliProcessor:parseInt},maxExpand:{type:"number",default:1e3,description:"Limit the number of macro expansions to the specified number, to prevent e.g. infinite macro loops. If set to Infinity, the macro expander will try to fully expand as in LaTeX.",processor:e=>Math.max(0,e),cli:"-e, --max-expand <n>",cliProcessor:e=>"Infinity"===e?1/0:parseInt(e)},globalGroup:{type:"boolean",cli:!1}};function p(e){if(e.default)return e.default;var t=e.type,n=Array.isArray(t)?t[0]:t;if("string"!=typeof n)return n.enum[0];switch(n){case"boolean":return!1;case"string":return"";case"number":return 0;case"object":return{}}}class f{constructor(e){for(var t in this.displayMode=void 0,this.output=void 0,this.leqno=void 0,this.fleqn=void 0,this.throwOnError=void 0,this.errorColor=void 0,this.macros=void 0,this.minRuleThickness=void 0,this.colorIsTextColor=void 0,this.strict=void 0,this.trust=void 0,this.maxSize=void 0,this.maxExpand=void 0,this.globalGroup=void 0,e=e||{},d)if(d.hasOwnProperty(t)){var n=d[t];this[t]=void 0!==e[t]?n.processor?n.processor(e[t]):e[t]:p(n)}}reportNonstrict(e,t,n){var r=this.strict;if("function"==typeof r&&(r=r(e,t,n)),r&&"ignore"!==r){if(!0===r||"error"===r)throw new o("LaTeX-incompatible input and strict mode is set to 'error': "+t+" ["+e+"]",n);"warn"===r?"undefined"!=typeof console&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+t+" ["+e+"]"):"undefined"!=typeof console&&console.warn("LaTeX-incompatible input and strict mode is set to unrecognized '"+r+"': "+t+" ["+e+"]")}}useStrictBehavior(e,t,n){var r=this.strict;if("function"==typeof r)try{r=r(e,t,n)}catch(e){r="error"}return!(!r||"ignore"===r)&&(!0===r||"error"===r||("warn"===r?("undefined"!=typeof console&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+t+" ["+e+"]"),!1):("undefined"!=typeof console&&console.warn("LaTeX-incompatible input and strict mode is set to unrecognized '"+r+"': "+t+" ["+e+"]"),!1)))}isTrusted(e){if(e.url&&!e.protocol){var t=u.protocolFromUrl(e.url);if(null==t)return!1;e.protocol=t}var n="function"==typeof this.trust?this.trust(e):this.trust;return Boolean(n)}}class h{constructor(e,t,n){this.id=void 0,this.size=void 0,this.cramped=void 0,this.id=e,this.size=t,this.cramped=n}sup(){return g[m[this.id]]}sub(){return g[v[this.id]]}fracNum(){return g[y[this.id]]}fracDen(){return g[b[this.id]]}cramp(){return g[x[this.id]]}text(){return g[w[this.id]]}isTight(){return this.size>=2}}var g=[new h(0,0,!1),new h(1,0,!0),new h(2,1,!1),new h(3,1,!0),new h(4,2,!1),new h(5,2,!0),new h(6,3,!1),new h(7,3,!0)],m=[4,5,4,5,6,7,6,7],v=[5,5,5,5,7,7,7,7],y=[2,3,4,5,6,7,6,7],b=[3,3,5,5,7,7,7,7],x=[1,1,3,3,5,5,7,7],w=[0,1,2,3,2,3,2,3],S={DISPLAY:g[0],TEXT:g[2],SCRIPT:g[4],SCRIPTSCRIPT:g[6]},k=[{name:"latin",blocks:[[256,591],[768,879]]},{name:"cyrillic",blocks:[[1024,1279]]},{name:"armenian",blocks:[[1328,1423]]},{name:"brahmic",blocks:[[2304,4255]]},{name:"georgian",blocks:[[4256,4351]]},{name:"cjk",blocks:[[12288,12543],[19968,40879],[65280,65376]]},{name:"hangul",blocks:[[44032,55215]]}];var C=[];function E(e){for(var t=0;t<C.length;t+=2)if(e>=C[t]&&e<=C[t+1])return!0;return!1}k.forEach((e=>e.blocks.forEach((e=>C.push(...e)))));var A=80,T={doubleleftarrow:"M262 157\nl10-10c34-36 62.7-77 86-123 3.3-8 5-13.3 5-16 0-5.3-6.7-8-20-8-7.3\n 0-12.2.5-14.5 1.5-2.3 1-4.8 4.5-7.5 10.5-49.3 97.3-121.7 169.3-217 216-28\n 14-57.3 25-88 33-6.7 2-11 3.8-13 5.5-2 1.7-3 4.2-3 7.5s1 5.8 3 7.5\nc2 1.7 6.3 3.5 13 5.5 68 17.3 128.2 47.8 180.5 91.5 52.3 43.7 93.8 96.2 124.5\n 157.5 9.3 8 15.3 12.3 18 13h6c12-.7 18-4 18-10 0-2-1.7-7-5-15-23.3-46-52-87\n-86-123l-10-10h399738v-40H218c328 0 0 0 0 0l-10-8c-26.7-20-65.7-43-117-69 2.7\n-2 6-3.7 10-5 36.7-16 72.3-37.3 107-64l10-8h399782v-40z\nm8 0v40h399730v-40zm0 194v40h399730v-40z",doublerightarrow:"M399738 392l\n-10 10c-34 36-62.7 77-86 123-3.3 8-5 13.3-5 16 0 5.3 6.7 8 20 8 7.3 0 12.2-.5\n 14.5-1.5 2.3-1 4.8-4.5 7.5-10.5 49.3-97.3 121.7-169.3 217-216 28-14 57.3-25 88\n-33 6.7-2 11-3.8 13-5.5 2-1.7 3-4.2 3-7.5s-1-5.8-3-7.5c-2-1.7-6.3-3.5-13-5.5-68\n-17.3-128.2-47.8-180.5-91.5-52.3-43.7-93.8-96.2-124.5-157.5-9.3-8-15.3-12.3-18\n-13h-6c-12 .7-18 4-18 10 0 2 1.7 7 5 15 23.3 46 52 87 86 123l10 10H0v40h399782\nc-328 0 0 0 0 0l10 8c26.7 20 65.7 43 117 69-2.7 2-6 3.7-10 5-36.7 16-72.3 37.3\n-107 64l-10 8H0v40zM0 157v40h399730v-40zm0 194v40h399730v-40z",leftarrow:"M400000 241H110l3-3c68.7-52.7 113.7-120\n 135-202 4-14.7 6-23 6-25 0-7.3-7-11-21-11-8 0-13.2.8-15.5 2.5-2.3 1.7-4.2 5.8\n-5.5 12.5-1.3 4.7-2.7 10.3-4 17-12 48.7-34.8 92-68.5 130S65.3 228.3 18 247\nc-10 4-16 7.7-18 11 0 8.7 6 14.3 18 17 47.3 18.7 87.8 47 121.5 85S196 441.3 208\n 490c.7 2 1.3 5 2 9s1.2 6.7 1.5 8c.3 1.3 1 3.3 2 6s2.2 4.5 3.5 5.5c1.3 1 3.3\n 1.8 6 2.5s6 1 10 1c14 0 21-3.7 21-11 0-2-2-10.3-6-25-20-79.3-65-146.7-135-202\n l-3-3h399890zM100 241v40h399900v-40z",leftbrace:"M6 548l-6-6v-35l6-11c56-104 135.3-181.3 238-232 57.3-28.7 117\n-45 179-50h399577v120H403c-43.3 7-81 15-113 26-100.7 33-179.7 91-237 174-2.7\n 5-6 9-10 13-.7 1-7.3 1-20 1H6z",leftbraceunder:"M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13\n 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688\n 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7\n-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z",leftgroup:"M400000 80\nH435C64 80 168.3 229.4 21 260c-5.9 1.2-18 0-18 0-2 0-3-1-3-3v-38C76 61 257 0\n 435 0h399565z",leftgroupunder:"M400000 262\nH435C64 262 168.3 112.6 21 82c-5.9-1.2-18 0-18 0-2 0-3 1-3 3v38c76 158 257 219\n 435 219h399565z",leftharpoon:"M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3\n-3.3 10.2-9.5 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5\n-18.3 3-21-1.3-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7\n-196 228-6.7 4.7-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40z",leftharpoonplus:"M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3-3.3 10.2-9.5\n 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5-18.3 3-21-1.3\n-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7-196 228-6.7 4.7\n-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40zM0 435v40h400000v-40z\nm0 0v40h400000v-40z",leftharpoondown:"M7 241c-4 4-6.333 8.667-7 14 0 5.333.667 9 2 11s5.333\n 5.333 12 10c90.667 54 156 130 196 228 3.333 10.667 6.333 16.333 9 17 2 .667 5\n 1 9 1h5c10.667 0 16.667-2 18-6 2-2.667 1-9.667-3-21-32-87.333-82.667-157.667\n-152-211l-3-3h399907v-40zM93 281 H400000 v-40L7 241z",leftharpoondownplus:"M7 435c-4 4-6.3 8.7-7 14 0 5.3.7 9 2 11s5.3 5.3 12\n 10c90.7 54 156 130 196 228 3.3 10.7 6.3 16.3 9 17 2 .7 5 1 9 1h5c10.7 0 16.7\n-2 18-6 2-2.7 1-9.7-3-21-32-87.3-82.7-157.7-152-211l-3-3h399907v-40H7zm93 0\nv40h399900v-40zM0 241v40h399900v-40zm0 0v40h399900v-40z",lefthook:"M400000 281 H103s-33-11.2-61-33.5S0 197.3 0 164s14.2-61.2 42.5\n-83.5C70.8 58.2 104 47 142 47 c16.7 0 25 6.7 25 20 0 12-8.7 18.7-26 20-40 3.3\n-68.7 15.7-86 37-10 12-15 25.3-15 40 0 22.7 9.8 40.7 29.5 54 19.7 13.3 43.5 21\n 71.5 23h399859zM103 281v-40h399897v40z",leftlinesegment:"M40 281 V428 H0 V94 H40 V241 H400000 v40z\nM40 281 V428 H0 V94 H40 V241 H400000 v40z",leftmapsto:"M40 281 V448H0V74H40V241H400000v40z\nM40 281 V448H0V74H40V241H400000v40z",leftToFrom:"M0 147h400000v40H0zm0 214c68 40 115.7 95.7 143 167h22c15.3 0 23\n-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69-70-101l-7-8h399905v-40H95l7-8\nc28.7-32 52-65.7 70-101 10.7-23.3 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 265.3\n 68 321 0 361zm0-174v-40h399900v40zm100 154v40h399900v-40z",longequal:"M0 50 h400000 v40H0z m0 194h40000v40H0z\nM0 50 h400000 v40H0z m0 194h40000v40H0z",midbrace:"M200428 334\nc-100.7-8.3-195.3-44-280-108-55.3-42-101.7-93-139-153l-9-14c-2.7 4-5.7 8.7-9 14\n-53.3 86.7-123.7 153-211 199-66.7 36-137.3 56.3-212 62H0V214h199568c178.3-11.7\n 311.7-78.3 403-201 6-8 9.7-12 11-12 .7-.7 6.7-1 18-1s17.3.3 18 1c1.3 0 5 4 11\n 12 44.7 59.3 101.3 106.3 170 141s145.3 54.3 229 60h199572v120z",midbraceunder:"M199572 214\nc100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14\n 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3\n 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0\n-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z",oiintSize1:"M512.6 71.6c272.6 0 320.3 106.8 320.3 178.2 0 70.8-47.7 177.6\n-320.3 177.6S193.1 320.6 193.1 249.8c0-71.4 46.9-178.2 319.5-178.2z\nm368.1 178.2c0-86.4-60.9-215.4-368.1-215.4-306.4 0-367.3 129-367.3 215.4 0 85.8\n60.9 214.8 367.3 214.8 307.2 0 368.1-129 368.1-214.8z",oiintSize2:"M757.8 100.1c384.7 0 451.1 137.6 451.1 230 0 91.3-66.4 228.8\n-451.1 228.8-386.3 0-452.7-137.5-452.7-228.8 0-92.4 66.4-230 452.7-230z\nm502.4 230c0-111.2-82.4-277.2-502.4-277.2s-504 166-504 277.2\nc0 110 84 276 504 276s502.4-166 502.4-276z",oiiintSize1:"M681.4 71.6c408.9 0 480.5 106.8 480.5 178.2 0 70.8-71.6 177.6\n-480.5 177.6S202.1 320.6 202.1 249.8c0-71.4 70.5-178.2 479.3-178.2z\nm525.8 178.2c0-86.4-86.8-215.4-525.7-215.4-437.9 0-524.7 129-524.7 215.4 0\n85.8 86.8 214.8 524.7 214.8 438.9 0 525.7-129 525.7-214.8z",oiiintSize2:"M1021.2 53c603.6 0 707.8 165.8 707.8 277.2 0 110-104.2 275.8\n-707.8 275.8-606 0-710.2-165.8-710.2-275.8C311 218.8 415.2 53 1021.2 53z\nm770.4 277.1c0-131.2-126.4-327.6-770.5-327.6S248.4 198.9 248.4 330.1\nc0 130 128.8 326.4 772.7 326.4s770.5-196.4 770.5-326.4z",rightarrow:"M0 241v40h399891c-47.3 35.3-84 78-110 128\n-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20\n 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7\n 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85\n-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5\n-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67\n 151.7 139 205zm0 0v40h399900v-40z",rightbrace:"M400000 542l\n-6 6h-17c-12.7 0-19.3-.3-20-1-4-4-7.3-8.3-10-13-35.3-51.3-80.8-93.8-136.5-127.5\ns-117.2-55.8-184.5-66.5c-.7 0-2-.3-4-1-18.7-2.7-76-4.3-172-5H0V214h399571l6 1\nc124.7 8 235 61.7 331 161 31.3 33.3 59.7 72.7 85 118l7 13v35z",rightbraceunder:"M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3\n 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237\n-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z",rightgroup:"M0 80h399565c371 0 266.7 149.4 414 180 5.9 1.2 18 0 18 0 2 0\n 3-1 3-3v-38c-76-158-257-219-435-219H0z",rightgroupunder:"M0 262h399565c371 0 266.7-149.4 414-180 5.9-1.2 18 0 18\n 0 2 0 3 1 3 3v38c-76 158-257 219-435 219H0z",rightharpoon:"M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3\n-3.7-15.3-11-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2\n-10.7 0-16.7 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58\n 69.2 92 94.5zm0 0v40h399900v-40z",rightharpoonplus:"M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3-3.7-15.3-11\n-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2-10.7 0-16.7\n 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58 69.2 92 94.5z\nm0 0v40h399900v-40z m100 194v40h399900v-40zm0 0v40h399900v-40z",rightharpoondown:"M399747 511c0 7.3 6.7 11 20 11 8 0 13-.8 15-2.5s4.7-6.8\n 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3 8.5-5.8 9.5\n-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3-64.7 57-92 95\n-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 241v40h399900v-40z",rightharpoondownplus:"M399747 705c0 7.3 6.7 11 20 11 8 0 13-.8\n 15-2.5s4.7-6.8 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3\n 8.5-5.8 9.5-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3\n-64.7 57-92 95-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 435v40h399900v-40z\nm0-194v40h400000v-40zm0 0v40h400000v-40z",righthook:"M399859 241c-764 0 0 0 0 0 40-3.3 68.7-15.7 86-37 10-12 15-25.3\n 15-40 0-22.7-9.8-40.7-29.5-54-19.7-13.3-43.5-21-71.5-23-17.3-1.3-26-8-26-20 0\n-13.3 8.7-20 26-20 38 0 71 11.2 99 33.5 0 0 7 5.6 21 16.7 14 11.2 21 33.5 21\n 66.8s-14 61.2-42 83.5c-28 22.3-61 33.5-99 33.5L0 241z M0 281v-40h399859v40z",rightlinesegment:"M399960 241 V94 h40 V428 h-40 V281 H0 v-40z\nM399960 241 V94 h40 V428 h-40 V281 H0 v-40z",rightToFrom:"M400000 167c-70.7-42-118-97.7-142-167h-23c-15.3 0-23 .3-23\n 1 0 1.3 5.3 13.7 16 37 18 35.3 41.3 69 70 101l7 8H0v40h399905l-7 8c-28.7 32\n-52 65.7-70 101-10.7 23.3-16 35.7-16 37 0 .7 7.7 1 23 1h23c24-69.3 71.3-125 142\n-167z M100 147v40h399900v-40zM0 341v40h399900v-40z",twoheadleftarrow:"M0 167c68 40\n 115.7 95.7 143 167h22c15.3 0 23-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69\n-70-101l-7-8h125l9 7c50.7 39.3 85 86 103 140h46c0-4.7-6.3-18.7-19-42-18-35.3\n-40-67.3-66-96l-9-9h399716v-40H284l9-9c26-28.7 48-60.7 66-96 12.7-23.333 19\n-37.333 19-42h-46c-18 54-52.3 100.7-103 140l-9 7H95l7-8c28.7-32 52-65.7 70-101\n 10.7-23.333 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 71.3 68 127 0 167z",twoheadrightarrow:"M400000 167\nc-68-40-115.7-95.7-143-167h-22c-15.3 0-23 .3-23 1 0 1.3 5.3 13.7 16 37 18 35.3\n 41.3 69 70 101l7 8h-125l-9-7c-50.7-39.3-85-86-103-140h-46c0 4.7 6.3 18.7 19 42\n 18 35.3 40 67.3 66 96l9 9H0v40h399716l-9 9c-26 28.7-48 60.7-66 96-12.7 23.333\n-19 37.333-19 42h46c18-54 52.3-100.7 103-140l9-7h125l-7 8c-28.7 32-52 65.7-70\n 101-10.7 23.333-16 35.7-16 37 0 .7 7.7 1 23 1h22c27.3-71.3 75-127 143-167z",tilde1:"M200 55.538c-77 0-168 73.953-177 73.953-3 0-7\n-2.175-9-5.437L2 97c-1-2-2-4-2-6 0-4 2-7 5-9l20-12C116 12 171 0 207 0c86 0\n 114 68 191 68 78 0 168-68 177-68 4 0 7 2 9 5l12 19c1 2.175 2 4.35 2 6.525 0\n 4.35-2 7.613-5 9.788l-19 13.05c-92 63.077-116.937 75.308-183 76.128\n-68.267.847-113-73.952-191-73.952z",tilde2:"M344 55.266c-142 0-300.638 81.316-311.5 86.418\n-8.01 3.762-22.5 10.91-23.5 5.562L1 120c-1-2-1-3-1-4 0-5 3-9 8-10l18.4-9C160.9\n 31.9 283 0 358 0c148 0 188 122 331 122s314-97 326-97c4 0 8 2 10 7l7 21.114\nc1 2.14 1 3.21 1 4.28 0 5.347-3 9.626-7 10.696l-22.3 12.622C852.6 158.372 751\n 181.476 676 181.476c-149 0-189-126.21-332-126.21z",tilde3:"M786 59C457 59 32 175.242 13 175.242c-6 0-10-3.457\n-11-10.37L.15 138c-1-7 3-12 10-13l19.2-6.4C378.4 40.7 634.3 0 804.3 0c337 0\n 411.8 157 746.8 157 328 0 754-112 773-112 5 0 10 3 11 9l1 14.075c1 8.066-.697\n 16.595-6.697 17.492l-21.052 7.31c-367.9 98.146-609.15 122.696-778.15 122.696\n -338 0-409-156.573-744-156.573z",tilde4:"M786 58C457 58 32 177.487 13 177.487c-6 0-10-3.345\n-11-10.035L.15 143c-1-7 3-12 10-13l22-6.7C381.2 35 637.15 0 807.15 0c337 0 409\n 177 744 177 328 0 754-127 773-127 5 0 10 3 11 9l1 14.794c1 7.805-3 13.38-9\n 14.495l-20.7 5.574c-366.85 99.79-607.3 139.372-776.3 139.372-338 0-409\n -175.236-744-175.236z",vec:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z",widehat1:"M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22\nc-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z",widehat2:"M1181 0h2l1171 176c6 0 10 5 10 11l-2 23c-1 6-5 10\n-11 10h-1L1182 67 15 220h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z",widehat3:"M1181 0h2l1171 236c6 0 10 5 10 11l-2 23c-1 6-5 10\n-11 10h-1L1182 67 15 280h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z",widehat4:"M1181 0h2l1171 296c6 0 10 5 10 11l-2 23c-1 6-5 10\n-11 10h-1L1182 67 15 340h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z",widecheck1:"M529,159h5l519,-115c5,-1,9,-5,9,-10c0,-1,-1,-2,-1,-3l-4,-22c-1,\n-5,-5,-9,-11,-9h-2l-512,92l-513,-92h-2c-5,0,-9,4,-11,9l-5,22c-1,6,2,12,8,13z",widecheck2:"M1181,220h2l1171,-176c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,\n-11,-10h-1l-1168,153l-1167,-153h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z",widecheck3:"M1181,280h2l1171,-236c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,\n-11,-10h-1l-1168,213l-1167,-213h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z",widecheck4:"M1181,340h2l1171,-296c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,\n-11,-10h-1l-1168,273l-1167,-273h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z",baraboveleftarrow:"M400000 620h-399890l3 -3c68.7 -52.7 113.7 -120 135 -202\nc4 -14.7 6 -23 6 -25c0 -7.3 -7 -11 -21 -11c-8 0 -13.2 0.8 -15.5 2.5\nc-2.3 1.7 -4.2 5.8 -5.5 12.5c-1.3 4.7 -2.7 10.3 -4 17c-12 48.7 -34.8 92 -68.5 130\ns-74.2 66.3 -121.5 85c-10 4 -16 7.7 -18 11c0 8.7 6 14.3 18 17c47.3 18.7 87.8 47\n121.5 85s56.5 81.3 68.5 130c0.7 2 1.3 5 2 9s1.2 6.7 1.5 8c0.3 1.3 1 3.3 2 6\ns2.2 4.5 3.5 5.5c1.3 1 3.3 1.8 6 2.5s6 1 10 1c14 0 21 -3.7 21 -11\nc0 -2 -2 -10.3 -6 -25c-20 -79.3 -65 -146.7 -135 -202l-3 -3h399890z\nM100 620v40h399900v-40z M0 241v40h399900v-40zM0 241v40h399900v-40z",rightarrowabovebar:"M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32\n-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0\n13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39\n-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5\n-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5\n-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67\n151.7 139 205zm96 379h399894v40H0zm0 0h399904v40H0z",baraboveshortleftharpoon:"M507,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11\nc1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17\nc2,0.7,5,1,9,1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21\nc-32,-87.3,-82.7,-157.7,-152,-211c0,0,-3,-3,-3,-3l399351,0l0,-40\nc-398570,0,-399437,0,-399437,0z M593 435 v40 H399500 v-40z\nM0 281 v-40 H399908 v40z M0 281 v-40 H399908 v40z",rightharpoonaboveshortbar:"M0,241 l0,40c399126,0,399993,0,399993,0\nc4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,\n-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6\nc-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z\nM0 241 v40 H399908 v-40z M0 475 v-40 H399500 v40z M0 475 v-40 H399500 v40z",shortbaraboveleftharpoon:"M7,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11\nc1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17c2,0.7,5,1,9,\n1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21c-32,-87.3,-82.7,-157.7,\n-152,-211c0,0,-3,-3,-3,-3l399907,0l0,-40c-399126,0,-399993,0,-399993,0z\nM93 435 v40 H400000 v-40z M500 241 v40 H400000 v-40z M500 241 v40 H400000 v-40z",shortrightharpoonabovebar:"M53,241l0,40c398570,0,399437,0,399437,0\nc4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,\n-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6\nc-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z\nM500 241 v40 H399408 v-40z M500 435 v40 H400000 v-40z"};class I{constructor(e){this.children=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.children=e,this.classes=[],this.height=0,this.depth=0,this.maxFontSize=0,this.style={}}hasClass(e){return u.contains(this.classes,e)}toNode(){for(var e=document.createDocumentFragment(),t=0;t<this.children.length;t++)e.appendChild(this.children[t].toNode());return e}toMarkup(){for(var e="",t=0;t<this.children.length;t++)e+=this.children[t].toMarkup();return e}toText(){return this.children.map((e=>e.toText())).join("")}}var z={"AMS-Regular":{32:[0,0,0,0,.25],65:[0,.68889,0,0,.72222],66:[0,.68889,0,0,.66667],67:[0,.68889,0,0,.72222],68:[0,.68889,0,0,.72222],69:[0,.68889,0,0,.66667],70:[0,.68889,0,0,.61111],71:[0,.68889,0,0,.77778],72:[0,.68889,0,0,.77778],73:[0,.68889,0,0,.38889],74:[.16667,.68889,0,0,.5],75:[0,.68889,0,0,.77778],76:[0,.68889,0,0,.66667],77:[0,.68889,0,0,.94445],78:[0,.68889,0,0,.72222],79:[.16667,.68889,0,0,.77778],80:[0,.68889,0,0,.61111],81:[.16667,.68889,0,0,.77778],82:[0,.68889,0,0,.72222],83:[0,.68889,0,0,.55556],84:[0,.68889,0,0,.66667],85:[0,.68889,0,0,.72222],86:[0,.68889,0,0,.72222],87:[0,.68889,0,0,1],88:[0,.68889,0,0,.72222],89:[0,.68889,0,0,.72222],90:[0,.68889,0,0,.66667],107:[0,.68889,0,0,.55556],160:[0,0,0,0,.25],165:[0,.675,.025,0,.75],174:[.15559,.69224,0,0,.94666],240:[0,.68889,0,0,.55556],295:[0,.68889,0,0,.54028],710:[0,.825,0,0,2.33334],732:[0,.9,0,0,2.33334],770:[0,.825,0,0,2.33334],771:[0,.9,0,0,2.33334],989:[.08167,.58167,0,0,.77778],1008:[0,.43056,.04028,0,.66667],8245:[0,.54986,0,0,.275],8463:[0,.68889,0,0,.54028],8487:[0,.68889,0,0,.72222],8498:[0,.68889,0,0,.55556],8502:[0,.68889,0,0,.66667],8503:[0,.68889,0,0,.44445],8504:[0,.68889,0,0,.66667],8513:[0,.68889,0,0,.63889],8592:[-.03598,.46402,0,0,.5],8594:[-.03598,.46402,0,0,.5],8602:[-.13313,.36687,0,0,1],8603:[-.13313,.36687,0,0,1],8606:[.01354,.52239,0,0,1],8608:[.01354,.52239,0,0,1],8610:[.01354,.52239,0,0,1.11111],8611:[.01354,.52239,0,0,1.11111],8619:[0,.54986,0,0,1],8620:[0,.54986,0,0,1],8621:[-.13313,.37788,0,0,1.38889],8622:[-.13313,.36687,0,0,1],8624:[0,.69224,0,0,.5],8625:[0,.69224,0,0,.5],8630:[0,.43056,0,0,1],8631:[0,.43056,0,0,1],8634:[.08198,.58198,0,0,.77778],8635:[.08198,.58198,0,0,.77778],8638:[.19444,.69224,0,0,.41667],8639:[.19444,.69224,0,0,.41667],8642:[.19444,.69224,0,0,.41667],8643:[.19444,.69224,0,0,.41667],8644:[.1808,.675,0,0,1],8646:[.1808,.675,0,0,1],8647:[.1808,.675,0,0,1],8648:[.19444,.69224,0,0,.83334],8649:[.1808,.675,0,0,1],8650:[.19444,.69224,0,0,.83334],8651:[.01354,.52239,0,0,1],8652:[.01354,.52239,0,0,1],8653:[-.13313,.36687,0,0,1],8654:[-.13313,.36687,0,0,1],8655:[-.13313,.36687,0,0,1],8666:[.13667,.63667,0,0,1],8667:[.13667,.63667,0,0,1],8669:[-.13313,.37788,0,0,1],8672:[-.064,.437,0,0,1.334],8674:[-.064,.437,0,0,1.334],8705:[0,.825,0,0,.5],8708:[0,.68889,0,0,.55556],8709:[.08167,.58167,0,0,.77778],8717:[0,.43056,0,0,.42917],8722:[-.03598,.46402,0,0,.5],8724:[.08198,.69224,0,0,.77778],8726:[.08167,.58167,0,0,.77778],8733:[0,.69224,0,0,.77778],8736:[0,.69224,0,0,.72222],8737:[0,.69224,0,0,.72222],8738:[.03517,.52239,0,0,.72222],8739:[.08167,.58167,0,0,.22222],8740:[.25142,.74111,0,0,.27778],8741:[.08167,.58167,0,0,.38889],8742:[.25142,.74111,0,0,.5],8756:[0,.69224,0,0,.66667],8757:[0,.69224,0,0,.66667],8764:[-.13313,.36687,0,0,.77778],8765:[-.13313,.37788,0,0,.77778],8769:[-.13313,.36687,0,0,.77778],8770:[-.03625,.46375,0,0,.77778],8774:[.30274,.79383,0,0,.77778],8776:[-.01688,.48312,0,0,.77778],8778:[.08167,.58167,0,0,.77778],8782:[.06062,.54986,0,0,.77778],8783:[.06062,.54986,0,0,.77778],8785:[.08198,.58198,0,0,.77778],8786:[.08198,.58198,0,0,.77778],8787:[.08198,.58198,0,0,.77778],8790:[0,.69224,0,0,.77778],8791:[.22958,.72958,0,0,.77778],8796:[.08198,.91667,0,0,.77778],8806:[.25583,.75583,0,0,.77778],8807:[.25583,.75583,0,0,.77778],8808:[.25142,.75726,0,0,.77778],8809:[.25142,.75726,0,0,.77778],8812:[.25583,.75583,0,0,.5],8814:[.20576,.70576,0,0,.77778],8815:[.20576,.70576,0,0,.77778],8816:[.30274,.79383,0,0,.77778],8817:[.30274,.79383,0,0,.77778],8818:[.22958,.72958,0,0,.77778],8819:[.22958,.72958,0,0,.77778],8822:[.1808,.675,0,0,.77778],8823:[.1808,.675,0,0,.77778],8828:[.13667,.63667,0,0,.77778],8829:[.13667,.63667,0,0,.77778],8830:[.22958,.72958,0,0,.77778],8831:[.22958,.72958,0,0,.77778],8832:[.20576,.70576,0,0,.77778],8833:[.20576,.70576,0,0,.77778],8840:[.30274,.79383,0,0,.77778],8841:[.30274,.79383,0,0,.77778],8842:[.13597,.63597,0,0,.77778],8843:[.13597,.63597,0,0,.77778],8847:[.03517,.54986,0,0,.77778],8848:[.03517,.54986,0,0,.77778],8858:[.08198,.58198,0,0,.77778],8859:[.08198,.58198,0,0,.77778],8861:[.08198,.58198,0,0,.77778],8862:[0,.675,0,0,.77778],8863:[0,.675,0,0,.77778],8864:[0,.675,0,0,.77778],8865:[0,.675,0,0,.77778],8872:[0,.69224,0,0,.61111],8873:[0,.69224,0,0,.72222],8874:[0,.69224,0,0,.88889],8876:[0,.68889,0,0,.61111],8877:[0,.68889,0,0,.61111],8878:[0,.68889,0,0,.72222],8879:[0,.68889,0,0,.72222],8882:[.03517,.54986,0,0,.77778],8883:[.03517,.54986,0,0,.77778],8884:[.13667,.63667,0,0,.77778],8885:[.13667,.63667,0,0,.77778],8888:[0,.54986,0,0,1.11111],8890:[.19444,.43056,0,0,.55556],8891:[.19444,.69224,0,0,.61111],8892:[.19444,.69224,0,0,.61111],8901:[0,.54986,0,0,.27778],8903:[.08167,.58167,0,0,.77778],8905:[.08167,.58167,0,0,.77778],8906:[.08167,.58167,0,0,.77778],8907:[0,.69224,0,0,.77778],8908:[0,.69224,0,0,.77778],8909:[-.03598,.46402,0,0,.77778],8910:[0,.54986,0,0,.76042],8911:[0,.54986,0,0,.76042],8912:[.03517,.54986,0,0,.77778],8913:[.03517,.54986,0,0,.77778],8914:[0,.54986,0,0,.66667],8915:[0,.54986,0,0,.66667],8916:[0,.69224,0,0,.66667],8918:[.0391,.5391,0,0,.77778],8919:[.0391,.5391,0,0,.77778],8920:[.03517,.54986,0,0,1.33334],8921:[.03517,.54986,0,0,1.33334],8922:[.38569,.88569,0,0,.77778],8923:[.38569,.88569,0,0,.77778],8926:[.13667,.63667,0,0,.77778],8927:[.13667,.63667,0,0,.77778],8928:[.30274,.79383,0,0,.77778],8929:[.30274,.79383,0,0,.77778],8934:[.23222,.74111,0,0,.77778],8935:[.23222,.74111,0,0,.77778],8936:[.23222,.74111,0,0,.77778],8937:[.23222,.74111,0,0,.77778],8938:[.20576,.70576,0,0,.77778],8939:[.20576,.70576,0,0,.77778],8940:[.30274,.79383,0,0,.77778],8941:[.30274,.79383,0,0,.77778],8994:[.19444,.69224,0,0,.77778],8995:[.19444,.69224,0,0,.77778],9416:[.15559,.69224,0,0,.90222],9484:[0,.69224,0,0,.5],9488:[0,.69224,0,0,.5],9492:[0,.37788,0,0,.5],9496:[0,.37788,0,0,.5],9585:[.19444,.68889,0,0,.88889],9586:[.19444,.74111,0,0,.88889],9632:[0,.675,0,0,.77778],9633:[0,.675,0,0,.77778],9650:[0,.54986,0,0,.72222],9651:[0,.54986,0,0,.72222],9654:[.03517,.54986,0,0,.77778],9660:[0,.54986,0,0,.72222],9661:[0,.54986,0,0,.72222],9664:[.03517,.54986,0,0,.77778],9674:[.11111,.69224,0,0,.66667],9733:[.19444,.69224,0,0,.94445],10003:[0,.69224,0,0,.83334],10016:[0,.69224,0,0,.83334],10731:[.11111,.69224,0,0,.66667],10846:[.19444,.75583,0,0,.61111],10877:[.13667,.63667,0,0,.77778],10878:[.13667,.63667,0,0,.77778],10885:[.25583,.75583,0,0,.77778],10886:[.25583,.75583,0,0,.77778],10887:[.13597,.63597,0,0,.77778],10888:[.13597,.63597,0,0,.77778],10889:[.26167,.75726,0,0,.77778],10890:[.26167,.75726,0,0,.77778],10891:[.48256,.98256,0,0,.77778],10892:[.48256,.98256,0,0,.77778],10901:[.13667,.63667,0,0,.77778],10902:[.13667,.63667,0,0,.77778],10933:[.25142,.75726,0,0,.77778],10934:[.25142,.75726,0,0,.77778],10935:[.26167,.75726,0,0,.77778],10936:[.26167,.75726,0,0,.77778],10937:[.26167,.75726,0,0,.77778],10938:[.26167,.75726,0,0,.77778],10949:[.25583,.75583,0,0,.77778],10950:[.25583,.75583,0,0,.77778],10955:[.28481,.79383,0,0,.77778],10956:[.28481,.79383,0,0,.77778],57350:[.08167,.58167,0,0,.22222],57351:[.08167,.58167,0,0,.38889],57352:[.08167,.58167,0,0,.77778],57353:[0,.43056,.04028,0,.66667],57356:[.25142,.75726,0,0,.77778],57357:[.25142,.75726,0,0,.77778],57358:[.41951,.91951,0,0,.77778],57359:[.30274,.79383,0,0,.77778],57360:[.30274,.79383,0,0,.77778],57361:[.41951,.91951,0,0,.77778],57366:[.25142,.75726,0,0,.77778],57367:[.25142,.75726,0,0,.77778],57368:[.25142,.75726,0,0,.77778],57369:[.25142,.75726,0,0,.77778],57370:[.13597,.63597,0,0,.77778],57371:[.13597,.63597,0,0,.77778]},"Caligraphic-Regular":{32:[0,0,0,0,.25],65:[0,.68333,0,.19445,.79847],66:[0,.68333,.03041,.13889,.65681],67:[0,.68333,.05834,.13889,.52653],68:[0,.68333,.02778,.08334,.77139],69:[0,.68333,.08944,.11111,.52778],70:[0,.68333,.09931,.11111,.71875],71:[.09722,.68333,.0593,.11111,.59487],72:[0,.68333,.00965,.11111,.84452],73:[0,.68333,.07382,0,.54452],74:[.09722,.68333,.18472,.16667,.67778],75:[0,.68333,.01445,.05556,.76195],76:[0,.68333,0,.13889,.68972],77:[0,.68333,0,.13889,1.2009],78:[0,.68333,.14736,.08334,.82049],79:[0,.68333,.02778,.11111,.79611],80:[0,.68333,.08222,.08334,.69556],81:[.09722,.68333,0,.11111,.81667],82:[0,.68333,0,.08334,.8475],83:[0,.68333,.075,.13889,.60556],84:[0,.68333,.25417,0,.54464],85:[0,.68333,.09931,.08334,.62583],86:[0,.68333,.08222,0,.61278],87:[0,.68333,.08222,.08334,.98778],88:[0,.68333,.14643,.13889,.7133],89:[.09722,.68333,.08222,.08334,.66834],90:[0,.68333,.07944,.13889,.72473],160:[0,0,0,0,.25]},"Fraktur-Regular":{32:[0,0,0,0,.25],33:[0,.69141,0,0,.29574],34:[0,.69141,0,0,.21471],38:[0,.69141,0,0,.73786],39:[0,.69141,0,0,.21201],40:[.24982,.74947,0,0,.38865],41:[.24982,.74947,0,0,.38865],42:[0,.62119,0,0,.27764],43:[.08319,.58283,0,0,.75623],44:[0,.10803,0,0,.27764],45:[.08319,.58283,0,0,.75623],46:[0,.10803,0,0,.27764],47:[.24982,.74947,0,0,.50181],48:[0,.47534,0,0,.50181],49:[0,.47534,0,0,.50181],50:[0,.47534,0,0,.50181],51:[.18906,.47534,0,0,.50181],52:[.18906,.47534,0,0,.50181],53:[.18906,.47534,0,0,.50181],54:[0,.69141,0,0,.50181],55:[.18906,.47534,0,0,.50181],56:[0,.69141,0,0,.50181],57:[.18906,.47534,0,0,.50181],58:[0,.47534,0,0,.21606],59:[.12604,.47534,0,0,.21606],61:[-.13099,.36866,0,0,.75623],63:[0,.69141,0,0,.36245],65:[0,.69141,0,0,.7176],66:[0,.69141,0,0,.88397],67:[0,.69141,0,0,.61254],68:[0,.69141,0,0,.83158],69:[0,.69141,0,0,.66278],70:[.12604,.69141,0,0,.61119],71:[0,.69141,0,0,.78539],72:[.06302,.69141,0,0,.7203],73:[0,.69141,0,0,.55448],74:[.12604,.69141,0,0,.55231],75:[0,.69141,0,0,.66845],76:[0,.69141,0,0,.66602],77:[0,.69141,0,0,1.04953],78:[0,.69141,0,0,.83212],79:[0,.69141,0,0,.82699],80:[.18906,.69141,0,0,.82753],81:[.03781,.69141,0,0,.82699],82:[0,.69141,0,0,.82807],83:[0,.69141,0,0,.82861],84:[0,.69141,0,0,.66899],85:[0,.69141,0,0,.64576],86:[0,.69141,0,0,.83131],87:[0,.69141,0,0,1.04602],88:[0,.69141,0,0,.71922],89:[.18906,.69141,0,0,.83293],90:[.12604,.69141,0,0,.60201],91:[.24982,.74947,0,0,.27764],93:[.24982,.74947,0,0,.27764],94:[0,.69141,0,0,.49965],97:[0,.47534,0,0,.50046],98:[0,.69141,0,0,.51315],99:[0,.47534,0,0,.38946],100:[0,.62119,0,0,.49857],101:[0,.47534,0,0,.40053],102:[.18906,.69141,0,0,.32626],103:[.18906,.47534,0,0,.5037],104:[.18906,.69141,0,0,.52126],105:[0,.69141,0,0,.27899],106:[0,.69141,0,0,.28088],107:[0,.69141,0,0,.38946],108:[0,.69141,0,0,.27953],109:[0,.47534,0,0,.76676],110:[0,.47534,0,0,.52666],111:[0,.47534,0,0,.48885],112:[.18906,.52396,0,0,.50046],113:[.18906,.47534,0,0,.48912],114:[0,.47534,0,0,.38919],115:[0,.47534,0,0,.44266],116:[0,.62119,0,0,.33301],117:[0,.47534,0,0,.5172],118:[0,.52396,0,0,.5118],119:[0,.52396,0,0,.77351],120:[.18906,.47534,0,0,.38865],121:[.18906,.47534,0,0,.49884],122:[.18906,.47534,0,0,.39054],160:[0,0,0,0,.25],8216:[0,.69141,0,0,.21471],8217:[0,.69141,0,0,.21471],58112:[0,.62119,0,0,.49749],58113:[0,.62119,0,0,.4983],58114:[.18906,.69141,0,0,.33328],58115:[.18906,.69141,0,0,.32923],58116:[.18906,.47534,0,0,.50343],58117:[0,.69141,0,0,.33301],58118:[0,.62119,0,0,.33409],58119:[0,.47534,0,0,.50073]},"Main-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.35],34:[0,.69444,0,0,.60278],35:[.19444,.69444,0,0,.95833],36:[.05556,.75,0,0,.575],37:[.05556,.75,0,0,.95833],38:[0,.69444,0,0,.89444],39:[0,.69444,0,0,.31944],40:[.25,.75,0,0,.44722],41:[.25,.75,0,0,.44722],42:[0,.75,0,0,.575],43:[.13333,.63333,0,0,.89444],44:[.19444,.15556,0,0,.31944],45:[0,.44444,0,0,.38333],46:[0,.15556,0,0,.31944],47:[.25,.75,0,0,.575],48:[0,.64444,0,0,.575],49:[0,.64444,0,0,.575],50:[0,.64444,0,0,.575],51:[0,.64444,0,0,.575],52:[0,.64444,0,0,.575],53:[0,.64444,0,0,.575],54:[0,.64444,0,0,.575],55:[0,.64444,0,0,.575],56:[0,.64444,0,0,.575],57:[0,.64444,0,0,.575],58:[0,.44444,0,0,.31944],59:[.19444,.44444,0,0,.31944],60:[.08556,.58556,0,0,.89444],61:[-.10889,.39111,0,0,.89444],62:[.08556,.58556,0,0,.89444],63:[0,.69444,0,0,.54305],64:[0,.69444,0,0,.89444],65:[0,.68611,0,0,.86944],66:[0,.68611,0,0,.81805],67:[0,.68611,0,0,.83055],68:[0,.68611,0,0,.88194],69:[0,.68611,0,0,.75555],70:[0,.68611,0,0,.72361],71:[0,.68611,0,0,.90416],72:[0,.68611,0,0,.9],73:[0,.68611,0,0,.43611],74:[0,.68611,0,0,.59444],75:[0,.68611,0,0,.90138],76:[0,.68611,0,0,.69166],77:[0,.68611,0,0,1.09166],78:[0,.68611,0,0,.9],79:[0,.68611,0,0,.86388],80:[0,.68611,0,0,.78611],81:[.19444,.68611,0,0,.86388],82:[0,.68611,0,0,.8625],83:[0,.68611,0,0,.63889],84:[0,.68611,0,0,.8],85:[0,.68611,0,0,.88472],86:[0,.68611,.01597,0,.86944],87:[0,.68611,.01597,0,1.18888],88:[0,.68611,0,0,.86944],89:[0,.68611,.02875,0,.86944],90:[0,.68611,0,0,.70277],91:[.25,.75,0,0,.31944],92:[.25,.75,0,0,.575],93:[.25,.75,0,0,.31944],94:[0,.69444,0,0,.575],95:[.31,.13444,.03194,0,.575],97:[0,.44444,0,0,.55902],98:[0,.69444,0,0,.63889],99:[0,.44444,0,0,.51111],100:[0,.69444,0,0,.63889],101:[0,.44444,0,0,.52708],102:[0,.69444,.10903,0,.35139],103:[.19444,.44444,.01597,0,.575],104:[0,.69444,0,0,.63889],105:[0,.69444,0,0,.31944],106:[.19444,.69444,0,0,.35139],107:[0,.69444,0,0,.60694],108:[0,.69444,0,0,.31944],109:[0,.44444,0,0,.95833],110:[0,.44444,0,0,.63889],111:[0,.44444,0,0,.575],112:[.19444,.44444,0,0,.63889],113:[.19444,.44444,0,0,.60694],114:[0,.44444,0,0,.47361],115:[0,.44444,0,0,.45361],116:[0,.63492,0,0,.44722],117:[0,.44444,0,0,.63889],118:[0,.44444,.01597,0,.60694],119:[0,.44444,.01597,0,.83055],120:[0,.44444,0,0,.60694],121:[.19444,.44444,.01597,0,.60694],122:[0,.44444,0,0,.51111],123:[.25,.75,0,0,.575],124:[.25,.75,0,0,.31944],125:[.25,.75,0,0,.575],126:[.35,.34444,0,0,.575],160:[0,0,0,0,.25],163:[0,.69444,0,0,.86853],168:[0,.69444,0,0,.575],172:[0,.44444,0,0,.76666],176:[0,.69444,0,0,.86944],177:[.13333,.63333,0,0,.89444],184:[.17014,0,0,0,.51111],198:[0,.68611,0,0,1.04166],215:[.13333,.63333,0,0,.89444],216:[.04861,.73472,0,0,.89444],223:[0,.69444,0,0,.59722],230:[0,.44444,0,0,.83055],247:[.13333,.63333,0,0,.89444],248:[.09722,.54167,0,0,.575],305:[0,.44444,0,0,.31944],338:[0,.68611,0,0,1.16944],339:[0,.44444,0,0,.89444],567:[.19444,.44444,0,0,.35139],710:[0,.69444,0,0,.575],711:[0,.63194,0,0,.575],713:[0,.59611,0,0,.575],714:[0,.69444,0,0,.575],715:[0,.69444,0,0,.575],728:[0,.69444,0,0,.575],729:[0,.69444,0,0,.31944],730:[0,.69444,0,0,.86944],732:[0,.69444,0,0,.575],733:[0,.69444,0,0,.575],915:[0,.68611,0,0,.69166],916:[0,.68611,0,0,.95833],920:[0,.68611,0,0,.89444],923:[0,.68611,0,0,.80555],926:[0,.68611,0,0,.76666],928:[0,.68611,0,0,.9],931:[0,.68611,0,0,.83055],933:[0,.68611,0,0,.89444],934:[0,.68611,0,0,.83055],936:[0,.68611,0,0,.89444],937:[0,.68611,0,0,.83055],8211:[0,.44444,.03194,0,.575],8212:[0,.44444,.03194,0,1.14999],8216:[0,.69444,0,0,.31944],8217:[0,.69444,0,0,.31944],8220:[0,.69444,0,0,.60278],8221:[0,.69444,0,0,.60278],8224:[.19444,.69444,0,0,.51111],8225:[.19444,.69444,0,0,.51111],8242:[0,.55556,0,0,.34444],8407:[0,.72444,.15486,0,.575],8463:[0,.69444,0,0,.66759],8465:[0,.69444,0,0,.83055],8467:[0,.69444,0,0,.47361],8472:[.19444,.44444,0,0,.74027],8476:[0,.69444,0,0,.83055],8501:[0,.69444,0,0,.70277],8592:[-.10889,.39111,0,0,1.14999],8593:[.19444,.69444,0,0,.575],8594:[-.10889,.39111,0,0,1.14999],8595:[.19444,.69444,0,0,.575],8596:[-.10889,.39111,0,0,1.14999],8597:[.25,.75,0,0,.575],8598:[.19444,.69444,0,0,1.14999],8599:[.19444,.69444,0,0,1.14999],8600:[.19444,.69444,0,0,1.14999],8601:[.19444,.69444,0,0,1.14999],8636:[-.10889,.39111,0,0,1.14999],8637:[-.10889,.39111,0,0,1.14999],8640:[-.10889,.39111,0,0,1.14999],8641:[-.10889,.39111,0,0,1.14999],8656:[-.10889,.39111,0,0,1.14999],8657:[.19444,.69444,0,0,.70277],8658:[-.10889,.39111,0,0,1.14999],8659:[.19444,.69444,0,0,.70277],8660:[-.10889,.39111,0,0,1.14999],8661:[.25,.75,0,0,.70277],8704:[0,.69444,0,0,.63889],8706:[0,.69444,.06389,0,.62847],8707:[0,.69444,0,0,.63889],8709:[.05556,.75,0,0,.575],8711:[0,.68611,0,0,.95833],8712:[.08556,.58556,0,0,.76666],8715:[.08556,.58556,0,0,.76666],8722:[.13333,.63333,0,0,.89444],8723:[.13333,.63333,0,0,.89444],8725:[.25,.75,0,0,.575],8726:[.25,.75,0,0,.575],8727:[-.02778,.47222,0,0,.575],8728:[-.02639,.47361,0,0,.575],8729:[-.02639,.47361,0,0,.575],8730:[.18,.82,0,0,.95833],8733:[0,.44444,0,0,.89444],8734:[0,.44444,0,0,1.14999],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.31944],8741:[.25,.75,0,0,.575],8743:[0,.55556,0,0,.76666],8744:[0,.55556,0,0,.76666],8745:[0,.55556,0,0,.76666],8746:[0,.55556,0,0,.76666],8747:[.19444,.69444,.12778,0,.56875],8764:[-.10889,.39111,0,0,.89444],8768:[.19444,.69444,0,0,.31944],8771:[.00222,.50222,0,0,.89444],8773:[.027,.638,0,0,.894],8776:[.02444,.52444,0,0,.89444],8781:[.00222,.50222,0,0,.89444],8801:[.00222,.50222,0,0,.89444],8804:[.19667,.69667,0,0,.89444],8805:[.19667,.69667,0,0,.89444],8810:[.08556,.58556,0,0,1.14999],8811:[.08556,.58556,0,0,1.14999],8826:[.08556,.58556,0,0,.89444],8827:[.08556,.58556,0,0,.89444],8834:[.08556,.58556,0,0,.89444],8835:[.08556,.58556,0,0,.89444],8838:[.19667,.69667,0,0,.89444],8839:[.19667,.69667,0,0,.89444],8846:[0,.55556,0,0,.76666],8849:[.19667,.69667,0,0,.89444],8850:[.19667,.69667,0,0,.89444],8851:[0,.55556,0,0,.76666],8852:[0,.55556,0,0,.76666],8853:[.13333,.63333,0,0,.89444],8854:[.13333,.63333,0,0,.89444],8855:[.13333,.63333,0,0,.89444],8856:[.13333,.63333,0,0,.89444],8857:[.13333,.63333,0,0,.89444],8866:[0,.69444,0,0,.70277],8867:[0,.69444,0,0,.70277],8868:[0,.69444,0,0,.89444],8869:[0,.69444,0,0,.89444],8900:[-.02639,.47361,0,0,.575],8901:[-.02639,.47361,0,0,.31944],8902:[-.02778,.47222,0,0,.575],8968:[.25,.75,0,0,.51111],8969:[.25,.75,0,0,.51111],8970:[.25,.75,0,0,.51111],8971:[.25,.75,0,0,.51111],8994:[-.13889,.36111,0,0,1.14999],8995:[-.13889,.36111,0,0,1.14999],9651:[.19444,.69444,0,0,1.02222],9657:[-.02778,.47222,0,0,.575],9661:[.19444,.69444,0,0,1.02222],9667:[-.02778,.47222,0,0,.575],9711:[.19444,.69444,0,0,1.14999],9824:[.12963,.69444,0,0,.89444],9825:[.12963,.69444,0,0,.89444],9826:[.12963,.69444,0,0,.89444],9827:[.12963,.69444,0,0,.89444],9837:[0,.75,0,0,.44722],9838:[.19444,.69444,0,0,.44722],9839:[.19444,.69444,0,0,.44722],10216:[.25,.75,0,0,.44722],10217:[.25,.75,0,0,.44722],10815:[0,.68611,0,0,.9],10927:[.19667,.69667,0,0,.89444],10928:[.19667,.69667,0,0,.89444],57376:[.19444,.69444,0,0,0]},"Main-BoldItalic":{32:[0,0,0,0,.25],33:[0,.69444,.11417,0,.38611],34:[0,.69444,.07939,0,.62055],35:[.19444,.69444,.06833,0,.94444],37:[.05556,.75,.12861,0,.94444],38:[0,.69444,.08528,0,.88555],39:[0,.69444,.12945,0,.35555],40:[.25,.75,.15806,0,.47333],41:[.25,.75,.03306,0,.47333],42:[0,.75,.14333,0,.59111],43:[.10333,.60333,.03306,0,.88555],44:[.19444,.14722,0,0,.35555],45:[0,.44444,.02611,0,.41444],46:[0,.14722,0,0,.35555],47:[.25,.75,.15806,0,.59111],48:[0,.64444,.13167,0,.59111],49:[0,.64444,.13167,0,.59111],50:[0,.64444,.13167,0,.59111],51:[0,.64444,.13167,0,.59111],52:[.19444,.64444,.13167,0,.59111],53:[0,.64444,.13167,0,.59111],54:[0,.64444,.13167,0,.59111],55:[.19444,.64444,.13167,0,.59111],56:[0,.64444,.13167,0,.59111],57:[0,.64444,.13167,0,.59111],58:[0,.44444,.06695,0,.35555],59:[.19444,.44444,.06695,0,.35555],61:[-.10889,.39111,.06833,0,.88555],63:[0,.69444,.11472,0,.59111],64:[0,.69444,.09208,0,.88555],65:[0,.68611,0,0,.86555],66:[0,.68611,.0992,0,.81666],67:[0,.68611,.14208,0,.82666],68:[0,.68611,.09062,0,.87555],69:[0,.68611,.11431,0,.75666],70:[0,.68611,.12903,0,.72722],71:[0,.68611,.07347,0,.89527],72:[0,.68611,.17208,0,.8961],73:[0,.68611,.15681,0,.47166],74:[0,.68611,.145,0,.61055],75:[0,.68611,.14208,0,.89499],76:[0,.68611,0,0,.69777],77:[0,.68611,.17208,0,1.07277],78:[0,.68611,.17208,0,.8961],79:[0,.68611,.09062,0,.85499],80:[0,.68611,.0992,0,.78721],81:[.19444,.68611,.09062,0,.85499],82:[0,.68611,.02559,0,.85944],83:[0,.68611,.11264,0,.64999],84:[0,.68611,.12903,0,.7961],85:[0,.68611,.17208,0,.88083],86:[0,.68611,.18625,0,.86555],87:[0,.68611,.18625,0,1.15999],88:[0,.68611,.15681,0,.86555],89:[0,.68611,.19803,0,.86555],90:[0,.68611,.14208,0,.70888],91:[.25,.75,.1875,0,.35611],93:[.25,.75,.09972,0,.35611],94:[0,.69444,.06709,0,.59111],95:[.31,.13444,.09811,0,.59111],97:[0,.44444,.09426,0,.59111],98:[0,.69444,.07861,0,.53222],99:[0,.44444,.05222,0,.53222],100:[0,.69444,.10861,0,.59111],101:[0,.44444,.085,0,.53222],102:[.19444,.69444,.21778,0,.4],103:[.19444,.44444,.105,0,.53222],104:[0,.69444,.09426,0,.59111],105:[0,.69326,.11387,0,.35555],106:[.19444,.69326,.1672,0,.35555],107:[0,.69444,.11111,0,.53222],108:[0,.69444,.10861,0,.29666],109:[0,.44444,.09426,0,.94444],110:[0,.44444,.09426,0,.64999],111:[0,.44444,.07861,0,.59111],112:[.19444,.44444,.07861,0,.59111],113:[.19444,.44444,.105,0,.53222],114:[0,.44444,.11111,0,.50167],115:[0,.44444,.08167,0,.48694],116:[0,.63492,.09639,0,.385],117:[0,.44444,.09426,0,.62055],118:[0,.44444,.11111,0,.53222],119:[0,.44444,.11111,0,.76777],120:[0,.44444,.12583,0,.56055],121:[.19444,.44444,.105,0,.56166],122:[0,.44444,.13889,0,.49055],126:[.35,.34444,.11472,0,.59111],160:[0,0,0,0,.25],168:[0,.69444,.11473,0,.59111],176:[0,.69444,0,0,.94888],184:[.17014,0,0,0,.53222],198:[0,.68611,.11431,0,1.02277],216:[.04861,.73472,.09062,0,.88555],223:[.19444,.69444,.09736,0,.665],230:[0,.44444,.085,0,.82666],248:[.09722,.54167,.09458,0,.59111],305:[0,.44444,.09426,0,.35555],338:[0,.68611,.11431,0,1.14054],339:[0,.44444,.085,0,.82666],567:[.19444,.44444,.04611,0,.385],710:[0,.69444,.06709,0,.59111],711:[0,.63194,.08271,0,.59111],713:[0,.59444,.10444,0,.59111],714:[0,.69444,.08528,0,.59111],715:[0,.69444,0,0,.59111],728:[0,.69444,.10333,0,.59111],729:[0,.69444,.12945,0,.35555],730:[0,.69444,0,0,.94888],732:[0,.69444,.11472,0,.59111],733:[0,.69444,.11472,0,.59111],915:[0,.68611,.12903,0,.69777],916:[0,.68611,0,0,.94444],920:[0,.68611,.09062,0,.88555],923:[0,.68611,0,0,.80666],926:[0,.68611,.15092,0,.76777],928:[0,.68611,.17208,0,.8961],931:[0,.68611,.11431,0,.82666],933:[0,.68611,.10778,0,.88555],934:[0,.68611,.05632,0,.82666],936:[0,.68611,.10778,0,.88555],937:[0,.68611,.0992,0,.82666],8211:[0,.44444,.09811,0,.59111],8212:[0,.44444,.09811,0,1.18221],8216:[0,.69444,.12945,0,.35555],8217:[0,.69444,.12945,0,.35555],8220:[0,.69444,.16772,0,.62055],8221:[0,.69444,.07939,0,.62055]},"Main-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.12417,0,.30667],34:[0,.69444,.06961,0,.51444],35:[.19444,.69444,.06616,0,.81777],37:[.05556,.75,.13639,0,.81777],38:[0,.69444,.09694,0,.76666],39:[0,.69444,.12417,0,.30667],40:[.25,.75,.16194,0,.40889],41:[.25,.75,.03694,0,.40889],42:[0,.75,.14917,0,.51111],43:[.05667,.56167,.03694,0,.76666],44:[.19444,.10556,0,0,.30667],45:[0,.43056,.02826,0,.35778],46:[0,.10556,0,0,.30667],47:[.25,.75,.16194,0,.51111],48:[0,.64444,.13556,0,.51111],49:[0,.64444,.13556,0,.51111],50:[0,.64444,.13556,0,.51111],51:[0,.64444,.13556,0,.51111],52:[.19444,.64444,.13556,0,.51111],53:[0,.64444,.13556,0,.51111],54:[0,.64444,.13556,0,.51111],55:[.19444,.64444,.13556,0,.51111],56:[0,.64444,.13556,0,.51111],57:[0,.64444,.13556,0,.51111],58:[0,.43056,.0582,0,.30667],59:[.19444,.43056,.0582,0,.30667],61:[-.13313,.36687,.06616,0,.76666],63:[0,.69444,.1225,0,.51111],64:[0,.69444,.09597,0,.76666],65:[0,.68333,0,0,.74333],66:[0,.68333,.10257,0,.70389],67:[0,.68333,.14528,0,.71555],68:[0,.68333,.09403,0,.755],69:[0,.68333,.12028,0,.67833],70:[0,.68333,.13305,0,.65277],71:[0,.68333,.08722,0,.77361],72:[0,.68333,.16389,0,.74333],73:[0,.68333,.15806,0,.38555],74:[0,.68333,.14028,0,.525],75:[0,.68333,.14528,0,.76888],76:[0,.68333,0,0,.62722],77:[0,.68333,.16389,0,.89666],78:[0,.68333,.16389,0,.74333],79:[0,.68333,.09403,0,.76666],80:[0,.68333,.10257,0,.67833],81:[.19444,.68333,.09403,0,.76666],82:[0,.68333,.03868,0,.72944],83:[0,.68333,.11972,0,.56222],84:[0,.68333,.13305,0,.71555],85:[0,.68333,.16389,0,.74333],86:[0,.68333,.18361,0,.74333],87:[0,.68333,.18361,0,.99888],88:[0,.68333,.15806,0,.74333],89:[0,.68333,.19383,0,.74333],90:[0,.68333,.14528,0,.61333],91:[.25,.75,.1875,0,.30667],93:[.25,.75,.10528,0,.30667],94:[0,.69444,.06646,0,.51111],95:[.31,.12056,.09208,0,.51111],97:[0,.43056,.07671,0,.51111],98:[0,.69444,.06312,0,.46],99:[0,.43056,.05653,0,.46],100:[0,.69444,.10333,0,.51111],101:[0,.43056,.07514,0,.46],102:[.19444,.69444,.21194,0,.30667],103:[.19444,.43056,.08847,0,.46],104:[0,.69444,.07671,0,.51111],105:[0,.65536,.1019,0,.30667],106:[.19444,.65536,.14467,0,.30667],107:[0,.69444,.10764,0,.46],108:[0,.69444,.10333,0,.25555],109:[0,.43056,.07671,0,.81777],110:[0,.43056,.07671,0,.56222],111:[0,.43056,.06312,0,.51111],112:[.19444,.43056,.06312,0,.51111],113:[.19444,.43056,.08847,0,.46],114:[0,.43056,.10764,0,.42166],115:[0,.43056,.08208,0,.40889],116:[0,.61508,.09486,0,.33222],117:[0,.43056,.07671,0,.53666],118:[0,.43056,.10764,0,.46],119:[0,.43056,.10764,0,.66444],120:[0,.43056,.12042,0,.46389],121:[.19444,.43056,.08847,0,.48555],122:[0,.43056,.12292,0,.40889],126:[.35,.31786,.11585,0,.51111],160:[0,0,0,0,.25],168:[0,.66786,.10474,0,.51111],176:[0,.69444,0,0,.83129],184:[.17014,0,0,0,.46],198:[0,.68333,.12028,0,.88277],216:[.04861,.73194,.09403,0,.76666],223:[.19444,.69444,.10514,0,.53666],230:[0,.43056,.07514,0,.71555],248:[.09722,.52778,.09194,0,.51111],338:[0,.68333,.12028,0,.98499],339:[0,.43056,.07514,0,.71555],710:[0,.69444,.06646,0,.51111],711:[0,.62847,.08295,0,.51111],713:[0,.56167,.10333,0,.51111],714:[0,.69444,.09694,0,.51111],715:[0,.69444,0,0,.51111],728:[0,.69444,.10806,0,.51111],729:[0,.66786,.11752,0,.30667],730:[0,.69444,0,0,.83129],732:[0,.66786,.11585,0,.51111],733:[0,.69444,.1225,0,.51111],915:[0,.68333,.13305,0,.62722],916:[0,.68333,0,0,.81777],920:[0,.68333,.09403,0,.76666],923:[0,.68333,0,0,.69222],926:[0,.68333,.15294,0,.66444],928:[0,.68333,.16389,0,.74333],931:[0,.68333,.12028,0,.71555],933:[0,.68333,.11111,0,.76666],934:[0,.68333,.05986,0,.71555],936:[0,.68333,.11111,0,.76666],937:[0,.68333,.10257,0,.71555],8211:[0,.43056,.09208,0,.51111],8212:[0,.43056,.09208,0,1.02222],8216:[0,.69444,.12417,0,.30667],8217:[0,.69444,.12417,0,.30667],8220:[0,.69444,.1685,0,.51444],8221:[0,.69444,.06961,0,.51444],8463:[0,.68889,0,0,.54028]},"Main-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.27778],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.77778],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.19444,.10556,0,0,.27778],45:[0,.43056,0,0,.33333],46:[0,.10556,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.64444,0,0,.5],49:[0,.64444,0,0,.5],50:[0,.64444,0,0,.5],51:[0,.64444,0,0,.5],52:[0,.64444,0,0,.5],53:[0,.64444,0,0,.5],54:[0,.64444,0,0,.5],55:[0,.64444,0,0,.5],56:[0,.64444,0,0,.5],57:[0,.64444,0,0,.5],58:[0,.43056,0,0,.27778],59:[.19444,.43056,0,0,.27778],60:[.0391,.5391,0,0,.77778],61:[-.13313,.36687,0,0,.77778],62:[.0391,.5391,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.77778],65:[0,.68333,0,0,.75],66:[0,.68333,0,0,.70834],67:[0,.68333,0,0,.72222],68:[0,.68333,0,0,.76389],69:[0,.68333,0,0,.68056],70:[0,.68333,0,0,.65278],71:[0,.68333,0,0,.78472],72:[0,.68333,0,0,.75],73:[0,.68333,0,0,.36111],74:[0,.68333,0,0,.51389],75:[0,.68333,0,0,.77778],76:[0,.68333,0,0,.625],77:[0,.68333,0,0,.91667],78:[0,.68333,0,0,.75],79:[0,.68333,0,0,.77778],80:[0,.68333,0,0,.68056],81:[.19444,.68333,0,0,.77778],82:[0,.68333,0,0,.73611],83:[0,.68333,0,0,.55556],84:[0,.68333,0,0,.72222],85:[0,.68333,0,0,.75],86:[0,.68333,.01389,0,.75],87:[0,.68333,.01389,0,1.02778],88:[0,.68333,0,0,.75],89:[0,.68333,.025,0,.75],90:[0,.68333,0,0,.61111],91:[.25,.75,0,0,.27778],92:[.25,.75,0,0,.5],93:[.25,.75,0,0,.27778],94:[0,.69444,0,0,.5],95:[.31,.12056,.02778,0,.5],97:[0,.43056,0,0,.5],98:[0,.69444,0,0,.55556],99:[0,.43056,0,0,.44445],100:[0,.69444,0,0,.55556],101:[0,.43056,0,0,.44445],102:[0,.69444,.07778,0,.30556],103:[.19444,.43056,.01389,0,.5],104:[0,.69444,0,0,.55556],105:[0,.66786,0,0,.27778],106:[.19444,.66786,0,0,.30556],107:[0,.69444,0,0,.52778],108:[0,.69444,0,0,.27778],109:[0,.43056,0,0,.83334],110:[0,.43056,0,0,.55556],111:[0,.43056,0,0,.5],112:[.19444,.43056,0,0,.55556],113:[.19444,.43056,0,0,.52778],114:[0,.43056,0,0,.39167],115:[0,.43056,0,0,.39445],116:[0,.61508,0,0,.38889],117:[0,.43056,0,0,.55556],118:[0,.43056,.01389,0,.52778],119:[0,.43056,.01389,0,.72222],120:[0,.43056,0,0,.52778],121:[.19444,.43056,.01389,0,.52778],122:[0,.43056,0,0,.44445],123:[.25,.75,0,0,.5],124:[.25,.75,0,0,.27778],125:[.25,.75,0,0,.5],126:[.35,.31786,0,0,.5],160:[0,0,0,0,.25],163:[0,.69444,0,0,.76909],167:[.19444,.69444,0,0,.44445],168:[0,.66786,0,0,.5],172:[0,.43056,0,0,.66667],176:[0,.69444,0,0,.75],177:[.08333,.58333,0,0,.77778],182:[.19444,.69444,0,0,.61111],184:[.17014,0,0,0,.44445],198:[0,.68333,0,0,.90278],215:[.08333,.58333,0,0,.77778],216:[.04861,.73194,0,0,.77778],223:[0,.69444,0,0,.5],230:[0,.43056,0,0,.72222],247:[.08333,.58333,0,0,.77778],248:[.09722,.52778,0,0,.5],305:[0,.43056,0,0,.27778],338:[0,.68333,0,0,1.01389],339:[0,.43056,0,0,.77778],567:[.19444,.43056,0,0,.30556],710:[0,.69444,0,0,.5],711:[0,.62847,0,0,.5],713:[0,.56778,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.66786,0,0,.27778],730:[0,.69444,0,0,.75],732:[0,.66786,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.68333,0,0,.625],916:[0,.68333,0,0,.83334],920:[0,.68333,0,0,.77778],923:[0,.68333,0,0,.69445],926:[0,.68333,0,0,.66667],928:[0,.68333,0,0,.75],931:[0,.68333,0,0,.72222],933:[0,.68333,0,0,.77778],934:[0,.68333,0,0,.72222],936:[0,.68333,0,0,.77778],937:[0,.68333,0,0,.72222],8211:[0,.43056,.02778,0,.5],8212:[0,.43056,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5],8224:[.19444,.69444,0,0,.44445],8225:[.19444,.69444,0,0,.44445],8230:[0,.123,0,0,1.172],8242:[0,.55556,0,0,.275],8407:[0,.71444,.15382,0,.5],8463:[0,.68889,0,0,.54028],8465:[0,.69444,0,0,.72222],8467:[0,.69444,0,.11111,.41667],8472:[.19444,.43056,0,.11111,.63646],8476:[0,.69444,0,0,.72222],8501:[0,.69444,0,0,.61111],8592:[-.13313,.36687,0,0,1],8593:[.19444,.69444,0,0,.5],8594:[-.13313,.36687,0,0,1],8595:[.19444,.69444,0,0,.5],8596:[-.13313,.36687,0,0,1],8597:[.25,.75,0,0,.5],8598:[.19444,.69444,0,0,1],8599:[.19444,.69444,0,0,1],8600:[.19444,.69444,0,0,1],8601:[.19444,.69444,0,0,1],8614:[.011,.511,0,0,1],8617:[.011,.511,0,0,1.126],8618:[.011,.511,0,0,1.126],8636:[-.13313,.36687,0,0,1],8637:[-.13313,.36687,0,0,1],8640:[-.13313,.36687,0,0,1],8641:[-.13313,.36687,0,0,1],8652:[.011,.671,0,0,1],8656:[-.13313,.36687,0,0,1],8657:[.19444,.69444,0,0,.61111],8658:[-.13313,.36687,0,0,1],8659:[.19444,.69444,0,0,.61111],8660:[-.13313,.36687,0,0,1],8661:[.25,.75,0,0,.61111],8704:[0,.69444,0,0,.55556],8706:[0,.69444,.05556,.08334,.5309],8707:[0,.69444,0,0,.55556],8709:[.05556,.75,0,0,.5],8711:[0,.68333,0,0,.83334],8712:[.0391,.5391,0,0,.66667],8715:[.0391,.5391,0,0,.66667],8722:[.08333,.58333,0,0,.77778],8723:[.08333,.58333,0,0,.77778],8725:[.25,.75,0,0,.5],8726:[.25,.75,0,0,.5],8727:[-.03472,.46528,0,0,.5],8728:[-.05555,.44445,0,0,.5],8729:[-.05555,.44445,0,0,.5],8730:[.2,.8,0,0,.83334],8733:[0,.43056,0,0,.77778],8734:[0,.43056,0,0,1],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.27778],8741:[.25,.75,0,0,.5],8743:[0,.55556,0,0,.66667],8744:[0,.55556,0,0,.66667],8745:[0,.55556,0,0,.66667],8746:[0,.55556,0,0,.66667],8747:[.19444,.69444,.11111,0,.41667],8764:[-.13313,.36687,0,0,.77778],8768:[.19444,.69444,0,0,.27778],8771:[-.03625,.46375,0,0,.77778],8773:[-.022,.589,0,0,.778],8776:[-.01688,.48312,0,0,.77778],8781:[-.03625,.46375,0,0,.77778],8784:[-.133,.673,0,0,.778],8801:[-.03625,.46375,0,0,.77778],8804:[.13597,.63597,0,0,.77778],8805:[.13597,.63597,0,0,.77778],8810:[.0391,.5391,0,0,1],8811:[.0391,.5391,0,0,1],8826:[.0391,.5391,0,0,.77778],8827:[.0391,.5391,0,0,.77778],8834:[.0391,.5391,0,0,.77778],8835:[.0391,.5391,0,0,.77778],8838:[.13597,.63597,0,0,.77778],8839:[.13597,.63597,0,0,.77778],8846:[0,.55556,0,0,.66667],8849:[.13597,.63597,0,0,.77778],8850:[.13597,.63597,0,0,.77778],8851:[0,.55556,0,0,.66667],8852:[0,.55556,0,0,.66667],8853:[.08333,.58333,0,0,.77778],8854:[.08333,.58333,0,0,.77778],8855:[.08333,.58333,0,0,.77778],8856:[.08333,.58333,0,0,.77778],8857:[.08333,.58333,0,0,.77778],8866:[0,.69444,0,0,.61111],8867:[0,.69444,0,0,.61111],8868:[0,.69444,0,0,.77778],8869:[0,.69444,0,0,.77778],8872:[.249,.75,0,0,.867],8900:[-.05555,.44445,0,0,.5],8901:[-.05555,.44445,0,0,.27778],8902:[-.03472,.46528,0,0,.5],8904:[.005,.505,0,0,.9],8942:[.03,.903,0,0,.278],8943:[-.19,.313,0,0,1.172],8945:[-.1,.823,0,0,1.282],8968:[.25,.75,0,0,.44445],8969:[.25,.75,0,0,.44445],8970:[.25,.75,0,0,.44445],8971:[.25,.75,0,0,.44445],8994:[-.14236,.35764,0,0,1],8995:[-.14236,.35764,0,0,1],9136:[.244,.744,0,0,.412],9137:[.244,.745,0,0,.412],9651:[.19444,.69444,0,0,.88889],9657:[-.03472,.46528,0,0,.5],9661:[.19444,.69444,0,0,.88889],9667:[-.03472,.46528,0,0,.5],9711:[.19444,.69444,0,0,1],9824:[.12963,.69444,0,0,.77778],9825:[.12963,.69444,0,0,.77778],9826:[.12963,.69444,0,0,.77778],9827:[.12963,.69444,0,0,.77778],9837:[0,.75,0,0,.38889],9838:[.19444,.69444,0,0,.38889],9839:[.19444,.69444,0,0,.38889],10216:[.25,.75,0,0,.38889],10217:[.25,.75,0,0,.38889],10222:[.244,.744,0,0,.412],10223:[.244,.745,0,0,.412],10229:[.011,.511,0,0,1.609],10230:[.011,.511,0,0,1.638],10231:[.011,.511,0,0,1.859],10232:[.024,.525,0,0,1.609],10233:[.024,.525,0,0,1.638],10234:[.024,.525,0,0,1.858],10236:[.011,.511,0,0,1.638],10815:[0,.68333,0,0,.75],10927:[.13597,.63597,0,0,.77778],10928:[.13597,.63597,0,0,.77778],57376:[.19444,.69444,0,0,0]},"Math-BoldItalic":{32:[0,0,0,0,.25],48:[0,.44444,0,0,.575],49:[0,.44444,0,0,.575],50:[0,.44444,0,0,.575],51:[.19444,.44444,0,0,.575],52:[.19444,.44444,0,0,.575],53:[.19444,.44444,0,0,.575],54:[0,.64444,0,0,.575],55:[.19444,.44444,0,0,.575],56:[0,.64444,0,0,.575],57:[.19444,.44444,0,0,.575],65:[0,.68611,0,0,.86944],66:[0,.68611,.04835,0,.8664],67:[0,.68611,.06979,0,.81694],68:[0,.68611,.03194,0,.93812],69:[0,.68611,.05451,0,.81007],70:[0,.68611,.15972,0,.68889],71:[0,.68611,0,0,.88673],72:[0,.68611,.08229,0,.98229],73:[0,.68611,.07778,0,.51111],74:[0,.68611,.10069,0,.63125],75:[0,.68611,.06979,0,.97118],76:[0,.68611,0,0,.75555],77:[0,.68611,.11424,0,1.14201],78:[0,.68611,.11424,0,.95034],79:[0,.68611,.03194,0,.83666],80:[0,.68611,.15972,0,.72309],81:[.19444,.68611,0,0,.86861],82:[0,.68611,.00421,0,.87235],83:[0,.68611,.05382,0,.69271],84:[0,.68611,.15972,0,.63663],85:[0,.68611,.11424,0,.80027],86:[0,.68611,.25555,0,.67778],87:[0,.68611,.15972,0,1.09305],88:[0,.68611,.07778,0,.94722],89:[0,.68611,.25555,0,.67458],90:[0,.68611,.06979,0,.77257],97:[0,.44444,0,0,.63287],98:[0,.69444,0,0,.52083],99:[0,.44444,0,0,.51342],100:[0,.69444,0,0,.60972],101:[0,.44444,0,0,.55361],102:[.19444,.69444,.11042,0,.56806],103:[.19444,.44444,.03704,0,.5449],104:[0,.69444,0,0,.66759],105:[0,.69326,0,0,.4048],106:[.19444,.69326,.0622,0,.47083],107:[0,.69444,.01852,0,.6037],108:[0,.69444,.0088,0,.34815],109:[0,.44444,0,0,1.0324],110:[0,.44444,0,0,.71296],111:[0,.44444,0,0,.58472],112:[.19444,.44444,0,0,.60092],113:[.19444,.44444,.03704,0,.54213],114:[0,.44444,.03194,0,.5287],115:[0,.44444,0,0,.53125],116:[0,.63492,0,0,.41528],117:[0,.44444,0,0,.68102],118:[0,.44444,.03704,0,.56666],119:[0,.44444,.02778,0,.83148],120:[0,.44444,0,0,.65903],121:[.19444,.44444,.03704,0,.59028],122:[0,.44444,.04213,0,.55509],160:[0,0,0,0,.25],915:[0,.68611,.15972,0,.65694],916:[0,.68611,0,0,.95833],920:[0,.68611,.03194,0,.86722],923:[0,.68611,0,0,.80555],926:[0,.68611,.07458,0,.84125],928:[0,.68611,.08229,0,.98229],931:[0,.68611,.05451,0,.88507],933:[0,.68611,.15972,0,.67083],934:[0,.68611,0,0,.76666],936:[0,.68611,.11653,0,.71402],937:[0,.68611,.04835,0,.8789],945:[0,.44444,0,0,.76064],946:[.19444,.69444,.03403,0,.65972],947:[.19444,.44444,.06389,0,.59003],948:[0,.69444,.03819,0,.52222],949:[0,.44444,0,0,.52882],950:[.19444,.69444,.06215,0,.50833],951:[.19444,.44444,.03704,0,.6],952:[0,.69444,.03194,0,.5618],953:[0,.44444,0,0,.41204],954:[0,.44444,0,0,.66759],955:[0,.69444,0,0,.67083],956:[.19444,.44444,0,0,.70787],957:[0,.44444,.06898,0,.57685],958:[.19444,.69444,.03021,0,.50833],959:[0,.44444,0,0,.58472],960:[0,.44444,.03704,0,.68241],961:[.19444,.44444,0,0,.6118],962:[.09722,.44444,.07917,0,.42361],963:[0,.44444,.03704,0,.68588],964:[0,.44444,.13472,0,.52083],965:[0,.44444,.03704,0,.63055],966:[.19444,.44444,0,0,.74722],967:[.19444,.44444,0,0,.71805],968:[.19444,.69444,.03704,0,.75833],969:[0,.44444,.03704,0,.71782],977:[0,.69444,0,0,.69155],981:[.19444,.69444,0,0,.7125],982:[0,.44444,.03194,0,.975],1009:[.19444,.44444,0,0,.6118],1013:[0,.44444,0,0,.48333],57649:[0,.44444,0,0,.39352],57911:[.19444,.44444,0,0,.43889]},"Math-Italic":{32:[0,0,0,0,.25],48:[0,.43056,0,0,.5],49:[0,.43056,0,0,.5],50:[0,.43056,0,0,.5],51:[.19444,.43056,0,0,.5],52:[.19444,.43056,0,0,.5],53:[.19444,.43056,0,0,.5],54:[0,.64444,0,0,.5],55:[.19444,.43056,0,0,.5],56:[0,.64444,0,0,.5],57:[.19444,.43056,0,0,.5],65:[0,.68333,0,.13889,.75],66:[0,.68333,.05017,.08334,.75851],67:[0,.68333,.07153,.08334,.71472],68:[0,.68333,.02778,.05556,.82792],69:[0,.68333,.05764,.08334,.7382],70:[0,.68333,.13889,.08334,.64306],71:[0,.68333,0,.08334,.78625],72:[0,.68333,.08125,.05556,.83125],73:[0,.68333,.07847,.11111,.43958],74:[0,.68333,.09618,.16667,.55451],75:[0,.68333,.07153,.05556,.84931],76:[0,.68333,0,.02778,.68056],77:[0,.68333,.10903,.08334,.97014],78:[0,.68333,.10903,.08334,.80347],79:[0,.68333,.02778,.08334,.76278],80:[0,.68333,.13889,.08334,.64201],81:[.19444,.68333,0,.08334,.79056],82:[0,.68333,.00773,.08334,.75929],83:[0,.68333,.05764,.08334,.6132],84:[0,.68333,.13889,.08334,.58438],85:[0,.68333,.10903,.02778,.68278],86:[0,.68333,.22222,0,.58333],87:[0,.68333,.13889,0,.94445],88:[0,.68333,.07847,.08334,.82847],89:[0,.68333,.22222,0,.58056],90:[0,.68333,.07153,.08334,.68264],97:[0,.43056,0,0,.52859],98:[0,.69444,0,0,.42917],99:[0,.43056,0,.05556,.43276],100:[0,.69444,0,.16667,.52049],101:[0,.43056,0,.05556,.46563],102:[.19444,.69444,.10764,.16667,.48959],103:[.19444,.43056,.03588,.02778,.47697],104:[0,.69444,0,0,.57616],105:[0,.65952,0,0,.34451],106:[.19444,.65952,.05724,0,.41181],107:[0,.69444,.03148,0,.5206],108:[0,.69444,.01968,.08334,.29838],109:[0,.43056,0,0,.87801],110:[0,.43056,0,0,.60023],111:[0,.43056,0,.05556,.48472],112:[.19444,.43056,0,.08334,.50313],113:[.19444,.43056,.03588,.08334,.44641],114:[0,.43056,.02778,.05556,.45116],115:[0,.43056,0,.05556,.46875],116:[0,.61508,0,.08334,.36111],117:[0,.43056,0,.02778,.57246],118:[0,.43056,.03588,.02778,.48472],119:[0,.43056,.02691,.08334,.71592],120:[0,.43056,0,.02778,.57153],121:[.19444,.43056,.03588,.05556,.49028],122:[0,.43056,.04398,.05556,.46505],160:[0,0,0,0,.25],915:[0,.68333,.13889,.08334,.61528],916:[0,.68333,0,.16667,.83334],920:[0,.68333,.02778,.08334,.76278],923:[0,.68333,0,.16667,.69445],926:[0,.68333,.07569,.08334,.74236],928:[0,.68333,.08125,.05556,.83125],931:[0,.68333,.05764,.08334,.77986],933:[0,.68333,.13889,.05556,.58333],934:[0,.68333,0,.08334,.66667],936:[0,.68333,.11,.05556,.61222],937:[0,.68333,.05017,.08334,.7724],945:[0,.43056,.0037,.02778,.6397],946:[.19444,.69444,.05278,.08334,.56563],947:[.19444,.43056,.05556,0,.51773],948:[0,.69444,.03785,.05556,.44444],949:[0,.43056,0,.08334,.46632],950:[.19444,.69444,.07378,.08334,.4375],951:[.19444,.43056,.03588,.05556,.49653],952:[0,.69444,.02778,.08334,.46944],953:[0,.43056,0,.05556,.35394],954:[0,.43056,0,0,.57616],955:[0,.69444,0,0,.58334],956:[.19444,.43056,0,.02778,.60255],957:[0,.43056,.06366,.02778,.49398],958:[.19444,.69444,.04601,.11111,.4375],959:[0,.43056,0,.05556,.48472],960:[0,.43056,.03588,0,.57003],961:[.19444,.43056,0,.08334,.51702],962:[.09722,.43056,.07986,.08334,.36285],963:[0,.43056,.03588,0,.57141],964:[0,.43056,.1132,.02778,.43715],965:[0,.43056,.03588,.02778,.54028],966:[.19444,.43056,0,.08334,.65417],967:[.19444,.43056,0,.05556,.62569],968:[.19444,.69444,.03588,.11111,.65139],969:[0,.43056,.03588,0,.62245],977:[0,.69444,0,.08334,.59144],981:[.19444,.69444,0,.08334,.59583],982:[0,.43056,.02778,0,.82813],1009:[.19444,.43056,0,.08334,.51702],1013:[0,.43056,0,.05556,.4059],57649:[0,.43056,0,.02778,.32246],57911:[.19444,.43056,0,.08334,.38403]},"SansSerif-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.36667],34:[0,.69444,0,0,.55834],35:[.19444,.69444,0,0,.91667],36:[.05556,.75,0,0,.55],37:[.05556,.75,0,0,1.02912],38:[0,.69444,0,0,.83056],39:[0,.69444,0,0,.30556],40:[.25,.75,0,0,.42778],41:[.25,.75,0,0,.42778],42:[0,.75,0,0,.55],43:[.11667,.61667,0,0,.85556],44:[.10556,.13056,0,0,.30556],45:[0,.45833,0,0,.36667],46:[0,.13056,0,0,.30556],47:[.25,.75,0,0,.55],48:[0,.69444,0,0,.55],49:[0,.69444,0,0,.55],50:[0,.69444,0,0,.55],51:[0,.69444,0,0,.55],52:[0,.69444,0,0,.55],53:[0,.69444,0,0,.55],54:[0,.69444,0,0,.55],55:[0,.69444,0,0,.55],56:[0,.69444,0,0,.55],57:[0,.69444,0,0,.55],58:[0,.45833,0,0,.30556],59:[.10556,.45833,0,0,.30556],61:[-.09375,.40625,0,0,.85556],63:[0,.69444,0,0,.51945],64:[0,.69444,0,0,.73334],65:[0,.69444,0,0,.73334],66:[0,.69444,0,0,.73334],67:[0,.69444,0,0,.70278],68:[0,.69444,0,0,.79445],69:[0,.69444,0,0,.64167],70:[0,.69444,0,0,.61111],71:[0,.69444,0,0,.73334],72:[0,.69444,0,0,.79445],73:[0,.69444,0,0,.33056],74:[0,.69444,0,0,.51945],75:[0,.69444,0,0,.76389],76:[0,.69444,0,0,.58056],77:[0,.69444,0,0,.97778],78:[0,.69444,0,0,.79445],79:[0,.69444,0,0,.79445],80:[0,.69444,0,0,.70278],81:[.10556,.69444,0,0,.79445],82:[0,.69444,0,0,.70278],83:[0,.69444,0,0,.61111],84:[0,.69444,0,0,.73334],85:[0,.69444,0,0,.76389],86:[0,.69444,.01528,0,.73334],87:[0,.69444,.01528,0,1.03889],88:[0,.69444,0,0,.73334],89:[0,.69444,.0275,0,.73334],90:[0,.69444,0,0,.67223],91:[.25,.75,0,0,.34306],93:[.25,.75,0,0,.34306],94:[0,.69444,0,0,.55],95:[.35,.10833,.03056,0,.55],97:[0,.45833,0,0,.525],98:[0,.69444,0,0,.56111],99:[0,.45833,0,0,.48889],100:[0,.69444,0,0,.56111],101:[0,.45833,0,0,.51111],102:[0,.69444,.07639,0,.33611],103:[.19444,.45833,.01528,0,.55],104:[0,.69444,0,0,.56111],105:[0,.69444,0,0,.25556],106:[.19444,.69444,0,0,.28611],107:[0,.69444,0,0,.53056],108:[0,.69444,0,0,.25556],109:[0,.45833,0,0,.86667],110:[0,.45833,0,0,.56111],111:[0,.45833,0,0,.55],112:[.19444,.45833,0,0,.56111],113:[.19444,.45833,0,0,.56111],114:[0,.45833,.01528,0,.37222],115:[0,.45833,0,0,.42167],116:[0,.58929,0,0,.40417],117:[0,.45833,0,0,.56111],118:[0,.45833,.01528,0,.5],119:[0,.45833,.01528,0,.74445],120:[0,.45833,0,0,.5],121:[.19444,.45833,.01528,0,.5],122:[0,.45833,0,0,.47639],126:[.35,.34444,0,0,.55],160:[0,0,0,0,.25],168:[0,.69444,0,0,.55],176:[0,.69444,0,0,.73334],180:[0,.69444,0,0,.55],184:[.17014,0,0,0,.48889],305:[0,.45833,0,0,.25556],567:[.19444,.45833,0,0,.28611],710:[0,.69444,0,0,.55],711:[0,.63542,0,0,.55],713:[0,.63778,0,0,.55],728:[0,.69444,0,0,.55],729:[0,.69444,0,0,.30556],730:[0,.69444,0,0,.73334],732:[0,.69444,0,0,.55],733:[0,.69444,0,0,.55],915:[0,.69444,0,0,.58056],916:[0,.69444,0,0,.91667],920:[0,.69444,0,0,.85556],923:[0,.69444,0,0,.67223],926:[0,.69444,0,0,.73334],928:[0,.69444,0,0,.79445],931:[0,.69444,0,0,.79445],933:[0,.69444,0,0,.85556],934:[0,.69444,0,0,.79445],936:[0,.69444,0,0,.85556],937:[0,.69444,0,0,.79445],8211:[0,.45833,.03056,0,.55],8212:[0,.45833,.03056,0,1.10001],8216:[0,.69444,0,0,.30556],8217:[0,.69444,0,0,.30556],8220:[0,.69444,0,0,.55834],8221:[0,.69444,0,0,.55834]},"SansSerif-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.05733,0,.31945],34:[0,.69444,.00316,0,.5],35:[.19444,.69444,.05087,0,.83334],36:[.05556,.75,.11156,0,.5],37:[.05556,.75,.03126,0,.83334],38:[0,.69444,.03058,0,.75834],39:[0,.69444,.07816,0,.27778],40:[.25,.75,.13164,0,.38889],41:[.25,.75,.02536,0,.38889],42:[0,.75,.11775,0,.5],43:[.08333,.58333,.02536,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,.01946,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,.13164,0,.5],48:[0,.65556,.11156,0,.5],49:[0,.65556,.11156,0,.5],50:[0,.65556,.11156,0,.5],51:[0,.65556,.11156,0,.5],52:[0,.65556,.11156,0,.5],53:[0,.65556,.11156,0,.5],54:[0,.65556,.11156,0,.5],55:[0,.65556,.11156,0,.5],56:[0,.65556,.11156,0,.5],57:[0,.65556,.11156,0,.5],58:[0,.44444,.02502,0,.27778],59:[.125,.44444,.02502,0,.27778],61:[-.13,.37,.05087,0,.77778],63:[0,.69444,.11809,0,.47222],64:[0,.69444,.07555,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,.08293,0,.66667],67:[0,.69444,.11983,0,.63889],68:[0,.69444,.07555,0,.72223],69:[0,.69444,.11983,0,.59722],70:[0,.69444,.13372,0,.56945],71:[0,.69444,.11983,0,.66667],72:[0,.69444,.08094,0,.70834],73:[0,.69444,.13372,0,.27778],74:[0,.69444,.08094,0,.47222],75:[0,.69444,.11983,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,.08094,0,.875],78:[0,.69444,.08094,0,.70834],79:[0,.69444,.07555,0,.73611],80:[0,.69444,.08293,0,.63889],81:[.125,.69444,.07555,0,.73611],82:[0,.69444,.08293,0,.64584],83:[0,.69444,.09205,0,.55556],84:[0,.69444,.13372,0,.68056],85:[0,.69444,.08094,0,.6875],86:[0,.69444,.1615,0,.66667],87:[0,.69444,.1615,0,.94445],88:[0,.69444,.13372,0,.66667],89:[0,.69444,.17261,0,.66667],90:[0,.69444,.11983,0,.61111],91:[.25,.75,.15942,0,.28889],93:[.25,.75,.08719,0,.28889],94:[0,.69444,.0799,0,.5],95:[.35,.09444,.08616,0,.5],97:[0,.44444,.00981,0,.48056],98:[0,.69444,.03057,0,.51667],99:[0,.44444,.08336,0,.44445],100:[0,.69444,.09483,0,.51667],101:[0,.44444,.06778,0,.44445],102:[0,.69444,.21705,0,.30556],103:[.19444,.44444,.10836,0,.5],104:[0,.69444,.01778,0,.51667],105:[0,.67937,.09718,0,.23889],106:[.19444,.67937,.09162,0,.26667],107:[0,.69444,.08336,0,.48889],108:[0,.69444,.09483,0,.23889],109:[0,.44444,.01778,0,.79445],110:[0,.44444,.01778,0,.51667],111:[0,.44444,.06613,0,.5],112:[.19444,.44444,.0389,0,.51667],113:[.19444,.44444,.04169,0,.51667],114:[0,.44444,.10836,0,.34167],115:[0,.44444,.0778,0,.38333],116:[0,.57143,.07225,0,.36111],117:[0,.44444,.04169,0,.51667],118:[0,.44444,.10836,0,.46111],119:[0,.44444,.10836,0,.68334],120:[0,.44444,.09169,0,.46111],121:[.19444,.44444,.10836,0,.46111],122:[0,.44444,.08752,0,.43472],126:[.35,.32659,.08826,0,.5],160:[0,0,0,0,.25],168:[0,.67937,.06385,0,.5],176:[0,.69444,0,0,.73752],184:[.17014,0,0,0,.44445],305:[0,.44444,.04169,0,.23889],567:[.19444,.44444,.04169,0,.26667],710:[0,.69444,.0799,0,.5],711:[0,.63194,.08432,0,.5],713:[0,.60889,.08776,0,.5],714:[0,.69444,.09205,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,.09483,0,.5],729:[0,.67937,.07774,0,.27778],730:[0,.69444,0,0,.73752],732:[0,.67659,.08826,0,.5],733:[0,.69444,.09205,0,.5],915:[0,.69444,.13372,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,.07555,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,.12816,0,.66667],928:[0,.69444,.08094,0,.70834],931:[0,.69444,.11983,0,.72222],933:[0,.69444,.09031,0,.77778],934:[0,.69444,.04603,0,.72222],936:[0,.69444,.09031,0,.77778],937:[0,.69444,.08293,0,.72222],8211:[0,.44444,.08616,0,.5],8212:[0,.44444,.08616,0,1],8216:[0,.69444,.07816,0,.27778],8217:[0,.69444,.07816,0,.27778],8220:[0,.69444,.14205,0,.5],8221:[0,.69444,.00316,0,.5]},"SansSerif-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.31945],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.75834],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,0,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.65556,0,0,.5],49:[0,.65556,0,0,.5],50:[0,.65556,0,0,.5],51:[0,.65556,0,0,.5],52:[0,.65556,0,0,.5],53:[0,.65556,0,0,.5],54:[0,.65556,0,0,.5],55:[0,.65556,0,0,.5],56:[0,.65556,0,0,.5],57:[0,.65556,0,0,.5],58:[0,.44444,0,0,.27778],59:[.125,.44444,0,0,.27778],61:[-.13,.37,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,0,0,.66667],67:[0,.69444,0,0,.63889],68:[0,.69444,0,0,.72223],69:[0,.69444,0,0,.59722],70:[0,.69444,0,0,.56945],71:[0,.69444,0,0,.66667],72:[0,.69444,0,0,.70834],73:[0,.69444,0,0,.27778],74:[0,.69444,0,0,.47222],75:[0,.69444,0,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,0,0,.875],78:[0,.69444,0,0,.70834],79:[0,.69444,0,0,.73611],80:[0,.69444,0,0,.63889],81:[.125,.69444,0,0,.73611],82:[0,.69444,0,0,.64584],83:[0,.69444,0,0,.55556],84:[0,.69444,0,0,.68056],85:[0,.69444,0,0,.6875],86:[0,.69444,.01389,0,.66667],87:[0,.69444,.01389,0,.94445],88:[0,.69444,0,0,.66667],89:[0,.69444,.025,0,.66667],90:[0,.69444,0,0,.61111],91:[.25,.75,0,0,.28889],93:[.25,.75,0,0,.28889],94:[0,.69444,0,0,.5],95:[.35,.09444,.02778,0,.5],97:[0,.44444,0,0,.48056],98:[0,.69444,0,0,.51667],99:[0,.44444,0,0,.44445],100:[0,.69444,0,0,.51667],101:[0,.44444,0,0,.44445],102:[0,.69444,.06944,0,.30556],103:[.19444,.44444,.01389,0,.5],104:[0,.69444,0,0,.51667],105:[0,.67937,0,0,.23889],106:[.19444,.67937,0,0,.26667],107:[0,.69444,0,0,.48889],108:[0,.69444,0,0,.23889],109:[0,.44444,0,0,.79445],110:[0,.44444,0,0,.51667],111:[0,.44444,0,0,.5],112:[.19444,.44444,0,0,.51667],113:[.19444,.44444,0,0,.51667],114:[0,.44444,.01389,0,.34167],115:[0,.44444,0,0,.38333],116:[0,.57143,0,0,.36111],117:[0,.44444,0,0,.51667],118:[0,.44444,.01389,0,.46111],119:[0,.44444,.01389,0,.68334],120:[0,.44444,0,0,.46111],121:[.19444,.44444,.01389,0,.46111],122:[0,.44444,0,0,.43472],126:[.35,.32659,0,0,.5],160:[0,0,0,0,.25],168:[0,.67937,0,0,.5],176:[0,.69444,0,0,.66667],184:[.17014,0,0,0,.44445],305:[0,.44444,0,0,.23889],567:[.19444,.44444,0,0,.26667],710:[0,.69444,0,0,.5],711:[0,.63194,0,0,.5],713:[0,.60889,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.67937,0,0,.27778],730:[0,.69444,0,0,.66667],732:[0,.67659,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.69444,0,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,0,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,0,0,.66667],928:[0,.69444,0,0,.70834],931:[0,.69444,0,0,.72222],933:[0,.69444,0,0,.77778],934:[0,.69444,0,0,.72222],936:[0,.69444,0,0,.77778],937:[0,.69444,0,0,.72222],8211:[0,.44444,.02778,0,.5],8212:[0,.44444,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5]},"Script-Regular":{32:[0,0,0,0,.25],65:[0,.7,.22925,0,.80253],66:[0,.7,.04087,0,.90757],67:[0,.7,.1689,0,.66619],68:[0,.7,.09371,0,.77443],69:[0,.7,.18583,0,.56162],70:[0,.7,.13634,0,.89544],71:[0,.7,.17322,0,.60961],72:[0,.7,.29694,0,.96919],73:[0,.7,.19189,0,.80907],74:[.27778,.7,.19189,0,1.05159],75:[0,.7,.31259,0,.91364],76:[0,.7,.19189,0,.87373],77:[0,.7,.15981,0,1.08031],78:[0,.7,.3525,0,.9015],79:[0,.7,.08078,0,.73787],80:[0,.7,.08078,0,1.01262],81:[0,.7,.03305,0,.88282],82:[0,.7,.06259,0,.85],83:[0,.7,.19189,0,.86767],84:[0,.7,.29087,0,.74697],85:[0,.7,.25815,0,.79996],86:[0,.7,.27523,0,.62204],87:[0,.7,.27523,0,.80532],88:[0,.7,.26006,0,.94445],89:[0,.7,.2939,0,.70961],90:[0,.7,.24037,0,.8212],160:[0,0,0,0,.25]},"Size1-Regular":{32:[0,0,0,0,.25],40:[.35001,.85,0,0,.45834],41:[.35001,.85,0,0,.45834],47:[.35001,.85,0,0,.57778],91:[.35001,.85,0,0,.41667],92:[.35001,.85,0,0,.57778],93:[.35001,.85,0,0,.41667],123:[.35001,.85,0,0,.58334],125:[.35001,.85,0,0,.58334],160:[0,0,0,0,.25],710:[0,.72222,0,0,.55556],732:[0,.72222,0,0,.55556],770:[0,.72222,0,0,.55556],771:[0,.72222,0,0,.55556],8214:[-99e-5,.601,0,0,.77778],8593:[1e-5,.6,0,0,.66667],8595:[1e-5,.6,0,0,.66667],8657:[1e-5,.6,0,0,.77778],8659:[1e-5,.6,0,0,.77778],8719:[.25001,.75,0,0,.94445],8720:[.25001,.75,0,0,.94445],8721:[.25001,.75,0,0,1.05556],8730:[.35001,.85,0,0,1],8739:[-.00599,.606,0,0,.33333],8741:[-.00599,.606,0,0,.55556],8747:[.30612,.805,.19445,0,.47222],8748:[.306,.805,.19445,0,.47222],8749:[.306,.805,.19445,0,.47222],8750:[.30612,.805,.19445,0,.47222],8896:[.25001,.75,0,0,.83334],8897:[.25001,.75,0,0,.83334],8898:[.25001,.75,0,0,.83334],8899:[.25001,.75,0,0,.83334],8968:[.35001,.85,0,0,.47222],8969:[.35001,.85,0,0,.47222],8970:[.35001,.85,0,0,.47222],8971:[.35001,.85,0,0,.47222],9168:[-99e-5,.601,0,0,.66667],10216:[.35001,.85,0,0,.47222],10217:[.35001,.85,0,0,.47222],10752:[.25001,.75,0,0,1.11111],10753:[.25001,.75,0,0,1.11111],10754:[.25001,.75,0,0,1.11111],10756:[.25001,.75,0,0,.83334],10758:[.25001,.75,0,0,.83334]},"Size2-Regular":{32:[0,0,0,0,.25],40:[.65002,1.15,0,0,.59722],41:[.65002,1.15,0,0,.59722],47:[.65002,1.15,0,0,.81111],91:[.65002,1.15,0,0,.47222],92:[.65002,1.15,0,0,.81111],93:[.65002,1.15,0,0,.47222],123:[.65002,1.15,0,0,.66667],125:[.65002,1.15,0,0,.66667],160:[0,0,0,0,.25],710:[0,.75,0,0,1],732:[0,.75,0,0,1],770:[0,.75,0,0,1],771:[0,.75,0,0,1],8719:[.55001,1.05,0,0,1.27778],8720:[.55001,1.05,0,0,1.27778],8721:[.55001,1.05,0,0,1.44445],8730:[.65002,1.15,0,0,1],8747:[.86225,1.36,.44445,0,.55556],8748:[.862,1.36,.44445,0,.55556],8749:[.862,1.36,.44445,0,.55556],8750:[.86225,1.36,.44445,0,.55556],8896:[.55001,1.05,0,0,1.11111],8897:[.55001,1.05,0,0,1.11111],8898:[.55001,1.05,0,0,1.11111],8899:[.55001,1.05,0,0,1.11111],8968:[.65002,1.15,0,0,.52778],8969:[.65002,1.15,0,0,.52778],8970:[.65002,1.15,0,0,.52778],8971:[.65002,1.15,0,0,.52778],10216:[.65002,1.15,0,0,.61111],10217:[.65002,1.15,0,0,.61111],10752:[.55001,1.05,0,0,1.51112],10753:[.55001,1.05,0,0,1.51112],10754:[.55001,1.05,0,0,1.51112],10756:[.55001,1.05,0,0,1.11111],10758:[.55001,1.05,0,0,1.11111]},"Size3-Regular":{32:[0,0,0,0,.25],40:[.95003,1.45,0,0,.73611],41:[.95003,1.45,0,0,.73611],47:[.95003,1.45,0,0,1.04445],91:[.95003,1.45,0,0,.52778],92:[.95003,1.45,0,0,1.04445],93:[.95003,1.45,0,0,.52778],123:[.95003,1.45,0,0,.75],125:[.95003,1.45,0,0,.75],160:[0,0,0,0,.25],710:[0,.75,0,0,1.44445],732:[0,.75,0,0,1.44445],770:[0,.75,0,0,1.44445],771:[0,.75,0,0,1.44445],8730:[.95003,1.45,0,0,1],8968:[.95003,1.45,0,0,.58334],8969:[.95003,1.45,0,0,.58334],8970:[.95003,1.45,0,0,.58334],8971:[.95003,1.45,0,0,.58334],10216:[.95003,1.45,0,0,.75],10217:[.95003,1.45,0,0,.75]},"Size4-Regular":{32:[0,0,0,0,.25],40:[1.25003,1.75,0,0,.79167],41:[1.25003,1.75,0,0,.79167],47:[1.25003,1.75,0,0,1.27778],91:[1.25003,1.75,0,0,.58334],92:[1.25003,1.75,0,0,1.27778],93:[1.25003,1.75,0,0,.58334],123:[1.25003,1.75,0,0,.80556],125:[1.25003,1.75,0,0,.80556],160:[0,0,0,0,.25],710:[0,.825,0,0,1.8889],732:[0,.825,0,0,1.8889],770:[0,.825,0,0,1.8889],771:[0,.825,0,0,1.8889],8730:[1.25003,1.75,0,0,1],8968:[1.25003,1.75,0,0,.63889],8969:[1.25003,1.75,0,0,.63889],8970:[1.25003,1.75,0,0,.63889],8971:[1.25003,1.75,0,0,.63889],9115:[.64502,1.155,0,0,.875],9116:[1e-5,.6,0,0,.875],9117:[.64502,1.155,0,0,.875],9118:[.64502,1.155,0,0,.875],9119:[1e-5,.6,0,0,.875],9120:[.64502,1.155,0,0,.875],9121:[.64502,1.155,0,0,.66667],9122:[-99e-5,.601,0,0,.66667],9123:[.64502,1.155,0,0,.66667],9124:[.64502,1.155,0,0,.66667],9125:[-99e-5,.601,0,0,.66667],9126:[.64502,1.155,0,0,.66667],9127:[1e-5,.9,0,0,.88889],9128:[.65002,1.15,0,0,.88889],9129:[.90001,0,0,0,.88889],9130:[0,.3,0,0,.88889],9131:[1e-5,.9,0,0,.88889],9132:[.65002,1.15,0,0,.88889],9133:[.90001,0,0,0,.88889],9143:[.88502,.915,0,0,1.05556],10216:[1.25003,1.75,0,0,.80556],10217:[1.25003,1.75,0,0,.80556],57344:[-.00499,.605,0,0,1.05556],57345:[-.00499,.605,0,0,1.05556],57680:[0,.12,0,0,.45],57681:[0,.12,0,0,.45],57682:[0,.12,0,0,.45],57683:[0,.12,0,0,.45]},"Typewriter-Regular":{32:[0,0,0,0,.525],33:[0,.61111,0,0,.525],34:[0,.61111,0,0,.525],35:[0,.61111,0,0,.525],36:[.08333,.69444,0,0,.525],37:[.08333,.69444,0,0,.525],38:[0,.61111,0,0,.525],39:[0,.61111,0,0,.525],40:[.08333,.69444,0,0,.525],41:[.08333,.69444,0,0,.525],42:[0,.52083,0,0,.525],43:[-.08056,.53055,0,0,.525],44:[.13889,.125,0,0,.525],45:[-.08056,.53055,0,0,.525],46:[0,.125,0,0,.525],47:[.08333,.69444,0,0,.525],48:[0,.61111,0,0,.525],49:[0,.61111,0,0,.525],50:[0,.61111,0,0,.525],51:[0,.61111,0,0,.525],52:[0,.61111,0,0,.525],53:[0,.61111,0,0,.525],54:[0,.61111,0,0,.525],55:[0,.61111,0,0,.525],56:[0,.61111,0,0,.525],57:[0,.61111,0,0,.525],58:[0,.43056,0,0,.525],59:[.13889,.43056,0,0,.525],60:[-.05556,.55556,0,0,.525],61:[-.19549,.41562,0,0,.525],62:[-.05556,.55556,0,0,.525],63:[0,.61111,0,0,.525],64:[0,.61111,0,0,.525],65:[0,.61111,0,0,.525],66:[0,.61111,0,0,.525],67:[0,.61111,0,0,.525],68:[0,.61111,0,0,.525],69:[0,.61111,0,0,.525],70:[0,.61111,0,0,.525],71:[0,.61111,0,0,.525],72:[0,.61111,0,0,.525],73:[0,.61111,0,0,.525],74:[0,.61111,0,0,.525],75:[0,.61111,0,0,.525],76:[0,.61111,0,0,.525],77:[0,.61111,0,0,.525],78:[0,.61111,0,0,.525],79:[0,.61111,0,0,.525],80:[0,.61111,0,0,.525],81:[.13889,.61111,0,0,.525],82:[0,.61111,0,0,.525],83:[0,.61111,0,0,.525],84:[0,.61111,0,0,.525],85:[0,.61111,0,0,.525],86:[0,.61111,0,0,.525],87:[0,.61111,0,0,.525],88:[0,.61111,0,0,.525],89:[0,.61111,0,0,.525],90:[0,.61111,0,0,.525],91:[.08333,.69444,0,0,.525],92:[.08333,.69444,0,0,.525],93:[.08333,.69444,0,0,.525],94:[0,.61111,0,0,.525],95:[.09514,0,0,0,.525],96:[0,.61111,0,0,.525],97:[0,.43056,0,0,.525],98:[0,.61111,0,0,.525],99:[0,.43056,0,0,.525],100:[0,.61111,0,0,.525],101:[0,.43056,0,0,.525],102:[0,.61111,0,0,.525],103:[.22222,.43056,0,0,.525],104:[0,.61111,0,0,.525],105:[0,.61111,0,0,.525],106:[.22222,.61111,0,0,.525],107:[0,.61111,0,0,.525],108:[0,.61111,0,0,.525],109:[0,.43056,0,0,.525],110:[0,.43056,0,0,.525],111:[0,.43056,0,0,.525],112:[.22222,.43056,0,0,.525],113:[.22222,.43056,0,0,.525],114:[0,.43056,0,0,.525],115:[0,.43056,0,0,.525],116:[0,.55358,0,0,.525],117:[0,.43056,0,0,.525],118:[0,.43056,0,0,.525],119:[0,.43056,0,0,.525],120:[0,.43056,0,0,.525],121:[.22222,.43056,0,0,.525],122:[0,.43056,0,0,.525],123:[.08333,.69444,0,0,.525],124:[.08333,.69444,0,0,.525],125:[.08333,.69444,0,0,.525],126:[0,.61111,0,0,.525],127:[0,.61111,0,0,.525],160:[0,0,0,0,.525],176:[0,.61111,0,0,.525],184:[.19445,0,0,0,.525],305:[0,.43056,0,0,.525],567:[.22222,.43056,0,0,.525],711:[0,.56597,0,0,.525],713:[0,.56555,0,0,.525],714:[0,.61111,0,0,.525],715:[0,.61111,0,0,.525],728:[0,.61111,0,0,.525],730:[0,.61111,0,0,.525],770:[0,.61111,0,0,.525],771:[0,.61111,0,0,.525],776:[0,.61111,0,0,.525],915:[0,.61111,0,0,.525],916:[0,.61111,0,0,.525],920:[0,.61111,0,0,.525],923:[0,.61111,0,0,.525],926:[0,.61111,0,0,.525],928:[0,.61111,0,0,.525],931:[0,.61111,0,0,.525],933:[0,.61111,0,0,.525],934:[0,.61111,0,0,.525],936:[0,.61111,0,0,.525],937:[0,.61111,0,0,.525],8216:[0,.61111,0,0,.525],8217:[0,.61111,0,0,.525],8242:[0,.61111,0,0,.525],9251:[.11111,.21944,0,0,.525]}},F={slant:[.25,.25,.25],space:[0,0,0],stretch:[0,0,0],shrink:[0,0,0],xHeight:[.431,.431,.431],quad:[1,1.171,1.472],extraSpace:[0,0,0],num1:[.677,.732,.925],num2:[.394,.384,.387],num3:[.444,.471,.504],denom1:[.686,.752,1.025],denom2:[.345,.344,.532],sup1:[.413,.503,.504],sup2:[.363,.431,.404],sup3:[.289,.286,.294],sub1:[.15,.143,.2],sub2:[.247,.286,.4],supDrop:[.386,.353,.494],subDrop:[.05,.071,.1],delim1:[2.39,1.7,1.98],delim2:[1.01,1.157,1.42],axisHeight:[.25,.25,.25],defaultRuleThickness:[.04,.049,.049],bigOpSpacing1:[.111,.111,.111],bigOpSpacing2:[.166,.166,.166],bigOpSpacing3:[.2,.2,.2],bigOpSpacing4:[.6,.611,.611],bigOpSpacing5:[.1,.143,.143],sqrtRuleThickness:[.04,.04,.04],ptPerEm:[10,10,10],doubleRuleSep:[.2,.2,.2],arrayRuleWidth:[.04,.04,.04],fboxsep:[.3,.3,.3],fboxrule:[.04,.04,.04]},M={\u00c5:"A",\u00d0:"D",\u00de:"o",\u00e5:"a",\u00f0:"d",\u00fe:"o",\u0410:"A",\u0411:"B",\u0412:"B",\u0413:"F",\u0414:"A",\u0415:"E",\u0416:"K",\u0417:"3",\u0418:"N",\u0419:"N",\u041a:"K",\u041b:"N",\u041c:"M",\u041d:"H",\u041e:"O",\u041f:"N",\u0420:"P",\u0421:"C",\u0422:"T",\u0423:"y",\u0424:"O",\u0425:"X",\u0426:"U",\u0427:"h",\u0428:"W",\u0429:"W",\u042a:"B",\u042b:"X",\u042c:"B",\u042d:"3",\u042e:"X",\u042f:"R",\u0430:"a",\u0431:"b",\u0432:"a",\u0433:"r",\u0434:"y",\u0435:"e",\u0436:"m",\u0437:"e",\u0438:"n",\u0439:"n",\u043a:"n",\u043b:"n",\u043c:"m",\u043d:"n",\u043e:"o",\u043f:"n",\u0440:"p",\u0441:"c",\u0442:"o",\u0443:"y",\u0444:"b",\u0445:"x",\u0446:"n",\u0447:"n",\u0448:"w",\u0449:"w",\u044a:"a",\u044b:"m",\u044c:"a",\u044d:"e",\u044e:"m",\u044f:"r"};function j(e,t,n){if(!z[t])throw new Error("Font metrics not found for font: "+t+".");var r=e.charCodeAt(0),a=z[t][r];if(!a&&e[0]in M&&(r=M[e[0]].charCodeAt(0),a=z[t][r]),a||"text"!==n||E(r)&&(a=z[t][77]),a)return{depth:a[0],height:a[1],italic:a[2],skew:a[3],width:a[4]}}var B={};var R=[[1,1,1],[2,1,1],[3,1,1],[4,2,1],[5,2,1],[6,3,1],[7,4,2],[8,6,3],[9,7,6],[10,8,7],[11,10,9]],O=[.5,.6,.7,.8,.9,1,1.2,1.44,1.728,2.074,2.488],L=function(e,t){return t.size<2?e:R[e-1][t.size-1]};class N{constructor(e){this.style=void 0,this.color=void 0,this.size=void 0,this.textSize=void 0,this.phantom=void 0,this.font=void 0,this.fontFamily=void 0,this.fontWeight=void 0,this.fontShape=void 0,this.sizeMultiplier=void 0,this.maxSize=void 0,this.minRuleThickness=void 0,this._fontMetrics=void 0,this.style=e.style,this.color=e.color,this.size=e.size||N.BASESIZE,this.textSize=e.textSize||this.size,this.phantom=!!e.phantom,this.font=e.font||"",this.fontFamily=e.fontFamily||"",this.fontWeight=e.fontWeight||"",this.fontShape=e.fontShape||"",this.sizeMultiplier=O[this.size-1],this.maxSize=e.maxSize,this.minRuleThickness=e.minRuleThickness,this._fontMetrics=void 0}extend(e){var t={style:this.style,size:this.size,textSize:this.textSize,color:this.color,phantom:this.phantom,font:this.font,fontFamily:this.fontFamily,fontWeight:this.fontWeight,fontShape:this.fontShape,maxSize:this.maxSize,minRuleThickness:this.minRuleThickness};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return new N(t)}havingStyle(e){return this.style===e?this:this.extend({style:e,size:L(this.textSize,e)})}havingCrampedStyle(){return this.havingStyle(this.style.cramp())}havingSize(e){return this.size===e&&this.textSize===e?this:this.extend({style:this.style.text(),size:e,textSize:e,sizeMultiplier:O[e-1]})}havingBaseStyle(e){e=e||this.style.text();var t=L(N.BASESIZE,e);return this.size===t&&this.textSize===N.BASESIZE&&this.style===e?this:this.extend({style:e,size:t})}havingBaseSizing(){var e;switch(this.style.id){case 4:case 5:e=3;break;case 6:case 7:e=1;break;default:e=6}return this.extend({style:this.style.text(),size:e})}withColor(e){return this.extend({color:e})}withPhantom(){return this.extend({phantom:!0})}withFont(e){return this.extend({font:e})}withTextFontFamily(e){return this.extend({fontFamily:e,font:""})}withTextFontWeight(e){return this.extend({fontWeight:e,font:""})}withTextFontShape(e){return this.extend({fontShape:e,font:""})}sizingClasses(e){return e.size!==this.size?["sizing","reset-size"+e.size,"size"+this.size]:[]}baseSizingClasses(){return this.size!==N.BASESIZE?["sizing","reset-size"+this.size,"size"+N.BASESIZE]:[]}fontMetrics(){return this._fontMetrics||(this._fontMetrics=function(e){var t;if(!B[t=e>=5?0:e>=3?1:2]){var n=B[t]={cssEmPerMu:F.quad[t]/18};for(var r in F)F.hasOwnProperty(r)&&(n[r]=F[r][t])}return B[t]}(this.size)),this._fontMetrics}getColor(){return this.phantom?"transparent":this.color}}N.BASESIZE=6;var P={pt:1,mm:7227/2540,cm:7227/254,in:72.27,bp:1.00375,pc:12,dd:1238/1157,cc:14856/1157,nd:685/642,nc:1370/107,sp:1/65536,px:1.00375},_={ex:!0,em:!0,mu:!0},D=function(e){return"string"!=typeof e&&(e=e.unit),e in P||e in _||"ex"===e},q=function(e,t){var n;if(e.unit in P)n=P[e.unit]/t.fontMetrics().ptPerEm/t.sizeMultiplier;else if("mu"===e.unit)n=t.fontMetrics().cssEmPerMu;else{var r;if(r=t.style.isTight()?t.havingStyle(t.style.text()):t,"ex"===e.unit)n=r.fontMetrics().xHeight;else{if("em"!==e.unit)throw new o("Invalid unit: '"+e.unit+"'");n=r.fontMetrics().quad}r!==t&&(n*=r.sizeMultiplier/t.sizeMultiplier)}return Math.min(e.number*n,t.maxSize)},U=function(e){return+e.toFixed(4)+"em"},$=function(e){return e.filter((e=>e)).join(" ")},H=function(e,t,n){if(this.classes=e||[],this.attributes={},this.height=0,this.depth=0,this.maxFontSize=0,this.style=n||{},t){t.style.isTight()&&this.classes.push("mtight");var r=t.getColor();r&&(this.style.color=r)}},V=function(e){var t=document.createElement(e);for(var n in t.className=$(this.classes),this.style)this.style.hasOwnProperty(n)&&(t.style[n]=this.style[n]);for(var r in this.attributes)this.attributes.hasOwnProperty(r)&&t.setAttribute(r,this.attributes[r]);for(var a=0;a<this.children.length;a++)t.appendChild(this.children[a].toNode());return t},G=/[\s"'>/=\x00-\x1f]/,W=function(e){var t="<"+e;this.classes.length&&(t+=' class="'+u.escape($(this.classes))+'"');var n="";for(var r in this.style)this.style.hasOwnProperty(r)&&(n+=u.hyphenate(r)+":"+this.style[r]+";");for(var a in n&&(t+=' style="'+u.escape(n)+'"'),this.attributes)if(this.attributes.hasOwnProperty(a)){if(G.test(a))throw new o("Invalid attribute name '"+a+"'");t+=" "+a+'="'+u.escape(this.attributes[a])+'"'}t+=">";for(var i=0;i<this.children.length;i++)t+=this.children[i].toMarkup();return t+="</"+e+">"};class Y{constructor(e,t,n,r){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.width=void 0,this.maxFontSize=void 0,this.style=void 0,H.call(this,e,n,r),this.children=t||[]}setAttribute(e,t){this.attributes[e]=t}hasClass(e){return u.contains(this.classes,e)}toNode(){return V.call(this,"span")}toMarkup(){return W.call(this,"span")}}class K{constructor(e,t,n,r){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,H.call(this,t,r),this.children=n||[],this.setAttribute("href",e)}setAttribute(e,t){this.attributes[e]=t}hasClass(e){return u.contains(this.classes,e)}toNode(){return V.call(this,"a")}toMarkup(){return W.call(this,"a")}}class X{constructor(e,t,n){this.src=void 0,this.alt=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.alt=t,this.src=e,this.classes=["mord"],this.style=n}hasClass(e){return u.contains(this.classes,e)}toNode(){var e=document.createElement("img");for(var t in e.src=this.src,e.alt=this.alt,e.className="mord",this.style)this.style.hasOwnProperty(t)&&(e.style[t]=this.style[t]);return e}toMarkup(){var e='<img src="'+u.escape(this.src)+'" alt="'+u.escape(this.alt)+'"',t="";for(var n in this.style)this.style.hasOwnProperty(n)&&(t+=u.hyphenate(n)+":"+this.style[n]+";");return t&&(e+=' style="'+u.escape(t)+'"'),e+="'/>"}}var Q={\u00ee:"\u0131\u0302",\u00ef:"\u0131\u0308",\u00ed:"\u0131\u0301",\u00ec:"\u0131\u0300"};class J{constructor(e,t,n,r,a,o,i,l){this.text=void 0,this.height=void 0,this.depth=void 0,this.italic=void 0,this.skew=void 0,this.width=void 0,this.maxFontSize=void 0,this.classes=void 0,this.style=void 0,this.text=e,this.height=t||0,this.depth=n||0,this.italic=r||0,this.skew=a||0,this.width=o||0,this.classes=i||[],this.style=l||{},this.maxFontSize=0;var s=function(e){for(var t=0;t<k.length;t++)for(var n=k[t],r=0;r<n.blocks.length;r++){var a=n.blocks[r];if(e>=a[0]&&e<=a[1])return n.name}return null}(this.text.charCodeAt(0));s&&this.classes.push(s+"_fallback"),/[\xee\xef\xed\xec]/.test(this.text)&&(this.text=Q[this.text])}hasClass(e){return u.contains(this.classes,e)}toNode(){var e=document.createTextNode(this.text),t=null;for(var n in this.italic>0&&((t=document.createElement("span")).style.marginRight=U(this.italic)),this.classes.length>0&&((t=t||document.createElement("span")).className=$(this.classes)),this.style)this.style.hasOwnProperty(n)&&((t=t||document.createElement("span")).style[n]=this.style[n]);return t?(t.appendChild(e),t):e}toMarkup(){var e=!1,t="<span";this.classes.length&&(e=!0,t+=' class="',t+=u.escape($(this.classes)),t+='"');var n="";for(var r in this.italic>0&&(n+="margin-right:"+this.italic+"em;"),this.style)this.style.hasOwnProperty(r)&&(n+=u.hyphenate(r)+":"+this.style[r]+";");n&&(e=!0,t+=' style="'+u.escape(n)+'"');var a=u.escape(this.text);return e?(t+=">",t+=a,t+="</span>"):a}}class Z{constructor(e,t){this.children=void 0,this.attributes=void 0,this.children=e||[],this.attributes=t||{}}toNode(){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&e.setAttribute(t,this.attributes[t]);for(var n=0;n<this.children.length;n++)e.appendChild(this.children[n].toNode());return e}toMarkup(){var e='<svg xmlns="http://www.w3.org/2000/svg"';for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&(e+=" "+t+'="'+u.escape(this.attributes[t])+'"');e+=">";for(var n=0;n<this.children.length;n++)e+=this.children[n].toMarkup();return e+="</svg>"}}class ee{constructor(e,t){this.pathName=void 0,this.alternate=void 0,this.pathName=e,this.alternate=t}toNode(){var e=document.createElementNS("http://www.w3.org/2000/svg","path");return this.alternate?e.setAttribute("d",this.alternate):e.setAttribute("d",T[this.pathName]),e}toMarkup(){return this.alternate?'<path d="'+u.escape(this.alternate)+'"/>':'<path d="'+u.escape(T[this.pathName])+'"/>'}}class te{constructor(e){this.attributes=void 0,this.attributes=e||{}}toNode(){var e=document.createElementNS("http://www.w3.org/2000/svg","line");for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&e.setAttribute(t,this.attributes[t]);return e}toMarkup(){var e="<line";for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&(e+=" "+t+'="'+u.escape(this.attributes[t])+'"');return e+="/>"}}function ne(e){if(e instanceof J)return e;throw new Error("Expected symbolNode but got "+String(e)+".")}var re={bin:1,close:1,inner:1,open:1,punct:1,rel:1},ae={"accent-token":1,mathord:1,"op-token":1,spacing:1,textord:1},oe={math:{},text:{}};function ie(e,t,n,r,a,o){oe[e][a]={font:t,group:n,replace:r},o&&r&&(oe[e][r]=oe[e][a])}var le="math",se="text",ce="main",ue="ams",de="accent-token",pe="bin",fe="close",he="inner",ge="mathord",me="op-token",ve="open",ye="punct",be="rel",xe="spacing",we="textord";ie(le,ce,be,"\u2261","\\equiv",!0),ie(le,ce,be,"\u227a","\\prec",!0),ie(le,ce,be,"\u227b","\\succ",!0),ie(le,ce,be,"\u223c","\\sim",!0),ie(le,ce,be,"\u22a5","\\perp"),ie(le,ce,be,"\u2aaf","\\preceq",!0),ie(le,ce,be,"\u2ab0","\\succeq",!0),ie(le,ce,be,"\u2243","\\simeq",!0),ie(le,ce,be,"\u2223","\\mid",!0),ie(le,ce,be,"\u226a","\\ll",!0),ie(le,ce,be,"\u226b","\\gg",!0),ie(le,ce,be,"\u224d","\\asymp",!0),ie(le,ce,be,"\u2225","\\parallel"),ie(le,ce,be,"\u22c8","\\bowtie",!0),ie(le,ce,be,"\u2323","\\smile",!0),ie(le,ce,be,"\u2291","\\sqsubseteq",!0),ie(le,ce,be,"\u2292","\\sqsupseteq",!0),ie(le,ce,be,"\u2250","\\doteq",!0),ie(le,ce,be,"\u2322","\\frown",!0),ie(le,ce,be,"\u220b","\\ni",!0),ie(le,ce,be,"\u221d","\\propto",!0),ie(le,ce,be,"\u22a2","\\vdash",!0),ie(le,ce,be,"\u22a3","\\dashv",!0),ie(le,ce,be,"\u220b","\\owns"),ie(le,ce,ye,".","\\ldotp"),ie(le,ce,ye,"\u22c5","\\cdotp"),ie(le,ce,we,"#","\\#"),ie(se,ce,we,"#","\\#"),ie(le,ce,we,"&","\\&"),ie(se,ce,we,"&","\\&"),ie(le,ce,we,"\u2135","\\aleph",!0),ie(le,ce,we,"\u2200","\\forall",!0),ie(le,ce,we,"\u210f","\\hbar",!0),ie(le,ce,we,"\u2203","\\exists",!0),ie(le,ce,we,"\u2207","\\nabla",!0),ie(le,ce,we,"\u266d","\\flat",!0),ie(le,ce,we,"\u2113","\\ell",!0),ie(le,ce,we,"\u266e","\\natural",!0),ie(le,ce,we,"\u2663","\\clubsuit",!0),ie(le,ce,we,"\u2118","\\wp",!0),ie(le,ce,we,"\u266f","\\sharp",!0),ie(le,ce,we,"\u2662","\\diamondsuit",!0),ie(le,ce,we,"\u211c","\\Re",!0),ie(le,ce,we,"\u2661","\\heartsuit",!0),ie(le,ce,we,"\u2111","\\Im",!0),ie(le,ce,we,"\u2660","\\spadesuit",!0),ie(le,ce,we,"\xa7","\\S",!0),ie(se,ce,we,"\xa7","\\S"),ie(le,ce,we,"\xb6","\\P",!0),ie(se,ce,we,"\xb6","\\P"),ie(le,ce,we,"\u2020","\\dag"),ie(se,ce,we,"\u2020","\\dag"),ie(se,ce,we,"\u2020","\\textdagger"),ie(le,ce,we,"\u2021","\\ddag"),ie(se,ce,we,"\u2021","\\ddag"),ie(se,ce,we,"\u2021","\\textdaggerdbl"),ie(le,ce,fe,"\u23b1","\\rmoustache",!0),ie(le,ce,ve,"\u23b0","\\lmoustache",!0),ie(le,ce,fe,"\u27ef","\\rgroup",!0),ie(le,ce,ve,"\u27ee","\\lgroup",!0),ie(le,ce,pe,"\u2213","\\mp",!0),ie(le,ce,pe,"\u2296","\\ominus",!0),ie(le,ce,pe,"\u228e","\\uplus",!0),ie(le,ce,pe,"\u2293","\\sqcap",!0),ie(le,ce,pe,"\u2217","\\ast"),ie(le,ce,pe,"\u2294","\\sqcup",!0),ie(le,ce,pe,"\u25ef","\\bigcirc",!0),ie(le,ce,pe,"\u2219","\\bullet",!0),ie(le,ce,pe,"\u2021","\\ddagger"),ie(le,ce,pe,"\u2240","\\wr",!0),ie(le,ce,pe,"\u2a3f","\\amalg"),ie(le,ce,pe,"&","\\And"),ie(le,ce,be,"\u27f5","\\longleftarrow",!0),ie(le,ce,be,"\u21d0","\\Leftarrow",!0),ie(le,ce,be,"\u27f8","\\Longleftarrow",!0),ie(le,ce,be,"\u27f6","\\longrightarrow",!0),ie(le,ce,be,"\u21d2","\\Rightarrow",!0),ie(le,ce,be,"\u27f9","\\Longrightarrow",!0),ie(le,ce,be,"\u2194","\\leftrightarrow",!0),ie(le,ce,be,"\u27f7","\\longleftrightarrow",!0),ie(le,ce,be,"\u21d4","\\Leftrightarrow",!0),ie(le,ce,be,"\u27fa","\\Longleftrightarrow",!0),ie(le,ce,be,"\u21a6","\\mapsto",!0),ie(le,ce,be,"\u27fc","\\longmapsto",!0),ie(le,ce,be,"\u2197","\\nearrow",!0),ie(le,ce,be,"\u21a9","\\hookleftarrow",!0),ie(le,ce,be,"\u21aa","\\hookrightarrow",!0),ie(le,ce,be,"\u2198","\\searrow",!0),ie(le,ce,be,"\u21bc","\\leftharpoonup",!0),ie(le,ce,be,"\u21c0","\\rightharpoonup",!0),ie(le,ce,be,"\u2199","\\swarrow",!0),ie(le,ce,be,"\u21bd","\\leftharpoondown",!0),ie(le,ce,be,"\u21c1","\\rightharpoondown",!0),ie(le,ce,be,"\u2196","\\nwarrow",!0),ie(le,ce,be,"\u21cc","\\rightleftharpoons",!0),ie(le,ue,be,"\u226e","\\nless",!0),ie(le,ue,be,"\ue010","\\@nleqslant"),ie(le,ue,be,"\ue011","\\@nleqq"),ie(le,ue,be,"\u2a87","\\lneq",!0),ie(le,ue,be,"\u2268","\\lneqq",!0),ie(le,ue,be,"\ue00c","\\@lvertneqq"),ie(le,ue,be,"\u22e6","\\lnsim",!0),ie(le,ue,be,"\u2a89","\\lnapprox",!0),ie(le,ue,be,"\u2280","\\nprec",!0),ie(le,ue,be,"\u22e0","\\npreceq",!0),ie(le,ue,be,"\u22e8","\\precnsim",!0),ie(le,ue,be,"\u2ab9","\\precnapprox",!0),ie(le,ue,be,"\u2241","\\nsim",!0),ie(le,ue,be,"\ue006","\\@nshortmid"),ie(le,ue,be,"\u2224","\\nmid",!0),ie(le,ue,be,"\u22ac","\\nvdash",!0),ie(le,ue,be,"\u22ad","\\nvDash",!0),ie(le,ue,be,"\u22ea","\\ntriangleleft"),ie(le,ue,be,"\u22ec","\\ntrianglelefteq",!0),ie(le,ue,be,"\u228a","\\subsetneq",!0),ie(le,ue,be,"\ue01a","\\@varsubsetneq"),ie(le,ue,be,"\u2acb","\\subsetneqq",!0),ie(le,ue,be,"\ue017","\\@varsubsetneqq"),ie(le,ue,be,"\u226f","\\ngtr",!0),ie(le,ue,be,"\ue00f","\\@ngeqslant"),ie(le,ue,be,"\ue00e","\\@ngeqq"),ie(le,ue,be,"\u2a88","\\gneq",!0),ie(le,ue,be,"\u2269","\\gneqq",!0),ie(le,ue,be,"\ue00d","\\@gvertneqq"),ie(le,ue,be,"\u22e7","\\gnsim",!0),ie(le,ue,be,"\u2a8a","\\gnapprox",!0),ie(le,ue,be,"\u2281","\\nsucc",!0),ie(le,ue,be,"\u22e1","\\nsucceq",!0),ie(le,ue,be,"\u22e9","\\succnsim",!0),ie(le,ue,be,"\u2aba","\\succnapprox",!0),ie(le,ue,be,"\u2246","\\ncong",!0),ie(le,ue,be,"\ue007","\\@nshortparallel"),ie(le,ue,be,"\u2226","\\nparallel",!0),ie(le,ue,be,"\u22af","\\nVDash",!0),ie(le,ue,be,"\u22eb","\\ntriangleright"),ie(le,ue,be,"\u22ed","\\ntrianglerighteq",!0),ie(le,ue,be,"\ue018","\\@nsupseteqq"),ie(le,ue,be,"\u228b","\\supsetneq",!0),ie(le,ue,be,"\ue01b","\\@varsupsetneq"),ie(le,ue,be,"\u2acc","\\supsetneqq",!0),ie(le,ue,be,"\ue019","\\@varsupsetneqq"),ie(le,ue,be,"\u22ae","\\nVdash",!0),ie(le,ue,be,"\u2ab5","\\precneqq",!0),ie(le,ue,be,"\u2ab6","\\succneqq",!0),ie(le,ue,be,"\ue016","\\@nsubseteqq"),ie(le,ue,pe,"\u22b4","\\unlhd"),ie(le,ue,pe,"\u22b5","\\unrhd"),ie(le,ue,be,"\u219a","\\nleftarrow",!0),ie(le,ue,be,"\u219b","\\nrightarrow",!0),ie(le,ue,be,"\u21cd","\\nLeftarrow",!0),ie(le,ue,be,"\u21cf","\\nRightarrow",!0),ie(le,ue,be,"\u21ae","\\nleftrightarrow",!0),ie(le,ue,be,"\u21ce","\\nLeftrightarrow",!0),ie(le,ue,be,"\u25b3","\\vartriangle"),ie(le,ue,we,"\u210f","\\hslash"),ie(le,ue,we,"\u25bd","\\triangledown"),ie(le,ue,we,"\u25ca","\\lozenge"),ie(le,ue,we,"\u24c8","\\circledS"),ie(le,ue,we,"\xae","\\circledR"),ie(se,ue,we,"\xae","\\circledR"),ie(le,ue,we,"\u2221","\\measuredangle",!0),ie(le,ue,we,"\u2204","\\nexists"),ie(le,ue,we,"\u2127","\\mho"),ie(le,ue,we,"\u2132","\\Finv",!0),ie(le,ue,we,"\u2141","\\Game",!0),ie(le,ue,we,"\u2035","\\backprime"),ie(le,ue,we,"\u25b2","\\blacktriangle"),ie(le,ue,we,"\u25bc","\\blacktriangledown"),ie(le,ue,we,"\u25a0","\\blacksquare"),ie(le,ue,we,"\u29eb","\\blacklozenge"),ie(le,ue,we,"\u2605","\\bigstar"),ie(le,ue,we,"\u2222","\\sphericalangle",!0),ie(le,ue,we,"\u2201","\\complement",!0),ie(le,ue,we,"\xf0","\\eth",!0),ie(se,ce,we,"\xf0","\xf0"),ie(le,ue,we,"\u2571","\\diagup"),ie(le,ue,we,"\u2572","\\diagdown"),ie(le,ue,we,"\u25a1","\\square"),ie(le,ue,we,"\u25a1","\\Box"),ie(le,ue,we,"\u25ca","\\Diamond"),ie(le,ue,we,"\xa5","\\yen",!0),ie(se,ue,we,"\xa5","\\yen",!0),ie(le,ue,we,"\u2713","\\checkmark",!0),ie(se,ue,we,"\u2713","\\checkmark"),ie(le,ue,we,"\u2136","\\beth",!0),ie(le,ue,we,"\u2138","\\daleth",!0),ie(le,ue,we,"\u2137","\\gimel",!0),ie(le,ue,we,"\u03dd","\\digamma",!0),ie(le,ue,we,"\u03f0","\\varkappa"),ie(le,ue,ve,"\u250c","\\@ulcorner",!0),ie(le,ue,fe,"\u2510","\\@urcorner",!0),ie(le,ue,ve,"\u2514","\\@llcorner",!0),ie(le,ue,fe,"\u2518","\\@lrcorner",!0),ie(le,ue,be,"\u2266","\\leqq",!0),ie(le,ue,be,"\u2a7d","\\leqslant",!0),ie(le,ue,be,"\u2a95","\\eqslantless",!0),ie(le,ue,be,"\u2272","\\lesssim",!0),ie(le,ue,be,"\u2a85","\\lessapprox",!0),ie(le,ue,be,"\u224a","\\approxeq",!0),ie(le,ue,pe,"\u22d6","\\lessdot"),ie(le,ue,be,"\u22d8","\\lll",!0),ie(le,ue,be,"\u2276","\\lessgtr",!0),ie(le,ue,be,"\u22da","\\lesseqgtr",!0),ie(le,ue,be,"\u2a8b","\\lesseqqgtr",!0),ie(le,ue,be,"\u2251","\\doteqdot"),ie(le,ue,be,"\u2253","\\risingdotseq",!0),ie(le,ue,be,"\u2252","\\fallingdotseq",!0),ie(le,ue,be,"\u223d","\\backsim",!0),ie(le,ue,be,"\u22cd","\\backsimeq",!0),ie(le,ue,be,"\u2ac5","\\subseteqq",!0),ie(le,ue,be,"\u22d0","\\Subset",!0),ie(le,ue,be,"\u228f","\\sqsubset",!0),ie(le,ue,be,"\u227c","\\preccurlyeq",!0),ie(le,ue,be,"\u22de","\\curlyeqprec",!0),ie(le,ue,be,"\u227e","\\precsim",!0),ie(le,ue,be,"\u2ab7","\\precapprox",!0),ie(le,ue,be,"\u22b2","\\vartriangleleft"),ie(le,ue,be,"\u22b4","\\trianglelefteq"),ie(le,ue,be,"\u22a8","\\vDash",!0),ie(le,ue,be,"\u22aa","\\Vvdash",!0),ie(le,ue,be,"\u2323","\\smallsmile"),ie(le,ue,be,"\u2322","\\smallfrown"),ie(le,ue,be,"\u224f","\\bumpeq",!0),ie(le,ue,be,"\u224e","\\Bumpeq",!0),ie(le,ue,be,"\u2267","\\geqq",!0),ie(le,ue,be,"\u2a7e","\\geqslant",!0),ie(le,ue,be,"\u2a96","\\eqslantgtr",!0),ie(le,ue,be,"\u2273","\\gtrsim",!0),ie(le,ue,be,"\u2a86","\\gtrapprox",!0),ie(le,ue,pe,"\u22d7","\\gtrdot"),ie(le,ue,be,"\u22d9","\\ggg",!0),ie(le,ue,be,"\u2277","\\gtrless",!0),ie(le,ue,be,"\u22db","\\gtreqless",!0),ie(le,ue,be,"\u2a8c","\\gtreqqless",!0),ie(le,ue,be,"\u2256","\\eqcirc",!0),ie(le,ue,be,"\u2257","\\circeq",!0),ie(le,ue,be,"\u225c","\\triangleq",!0),ie(le,ue,be,"\u223c","\\thicksim"),ie(le,ue,be,"\u2248","\\thickapprox"),ie(le,ue,be,"\u2ac6","\\supseteqq",!0),ie(le,ue,be,"\u22d1","\\Supset",!0),ie(le,ue,be,"\u2290","\\sqsupset",!0),ie(le,ue,be,"\u227d","\\succcurlyeq",!0),ie(le,ue,be,"\u22df","\\curlyeqsucc",!0),ie(le,ue,be,"\u227f","\\succsim",!0),ie(le,ue,be,"\u2ab8","\\succapprox",!0),ie(le,ue,be,"\u22b3","\\vartriangleright"),ie(le,ue,be,"\u22b5","\\trianglerighteq"),ie(le,ue,be,"\u22a9","\\Vdash",!0),ie(le,ue,be,"\u2223","\\shortmid"),ie(le,ue,be,"\u2225","\\shortparallel"),ie(le,ue,be,"\u226c","\\between",!0),ie(le,ue,be,"\u22d4","\\pitchfork",!0),ie(le,ue,be,"\u221d","\\varpropto"),ie(le,ue,be,"\u25c0","\\blacktriangleleft"),ie(le,ue,be,"\u2234","\\therefore",!0),ie(le,ue,be,"\u220d","\\backepsilon"),ie(le,ue,be,"\u25b6","\\blacktriangleright"),ie(le,ue,be,"\u2235","\\because",!0),ie(le,ue,be,"\u22d8","\\llless"),ie(le,ue,be,"\u22d9","\\gggtr"),ie(le,ue,pe,"\u22b2","\\lhd"),ie(le,ue,pe,"\u22b3","\\rhd"),ie(le,ue,be,"\u2242","\\eqsim",!0),ie(le,ce,be,"\u22c8","\\Join"),ie(le,ue,be,"\u2251","\\Doteq",!0),ie(le,ue,pe,"\u2214","\\dotplus",!0),ie(le,ue,pe,"\u2216","\\smallsetminus"),ie(le,ue,pe,"\u22d2","\\Cap",!0),ie(le,ue,pe,"\u22d3","\\Cup",!0),ie(le,ue,pe,"\u2a5e","\\doublebarwedge",!0),ie(le,ue,pe,"\u229f","\\boxminus",!0),ie(le,ue,pe,"\u229e","\\boxplus",!0),ie(le,ue,pe,"\u22c7","\\divideontimes",!0),ie(le,ue,pe,"\u22c9","\\ltimes",!0),ie(le,ue,pe,"\u22ca","\\rtimes",!0),ie(le,ue,pe,"\u22cb","\\leftthreetimes",!0),ie(le,ue,pe,"\u22cc","\\rightthreetimes",!0),ie(le,ue,pe,"\u22cf","\\curlywedge",!0),ie(le,ue,pe,"\u22ce","\\curlyvee",!0),ie(le,ue,pe,"\u229d","\\circleddash",!0),ie(le,ue,pe,"\u229b","\\circledast",!0),ie(le,ue,pe,"\u22c5","\\centerdot"),ie(le,ue,pe,"\u22ba","\\intercal",!0),ie(le,ue,pe,"\u22d2","\\doublecap"),ie(le,ue,pe,"\u22d3","\\doublecup"),ie(le,ue,pe,"\u22a0","\\boxtimes",!0),ie(le,ue,be,"\u21e2","\\dashrightarrow",!0),ie(le,ue,be,"\u21e0","\\dashleftarrow",!0),ie(le,ue,be,"\u21c7","\\leftleftarrows",!0),ie(le,ue,be,"\u21c6","\\leftrightarrows",!0),ie(le,ue,be,"\u21da","\\Lleftarrow",!0),ie(le,ue,be,"\u219e","\\twoheadleftarrow",!0),ie(le,ue,be,"\u21a2","\\leftarrowtail",!0),ie(le,ue,be,"\u21ab","\\looparrowleft",!0),ie(le,ue,be,"\u21cb","\\leftrightharpoons",!0),ie(le,ue,be,"\u21b6","\\curvearrowleft",!0),ie(le,ue,be,"\u21ba","\\circlearrowleft",!0),ie(le,ue,be,"\u21b0","\\Lsh",!0),ie(le,ue,be,"\u21c8","\\upuparrows",!0),ie(le,ue,be,"\u21bf","\\upharpoonleft",!0),ie(le,ue,be,"\u21c3","\\downharpoonleft",!0),ie(le,ce,be,"\u22b6","\\origof",!0),ie(le,ce,be,"\u22b7","\\imageof",!0),ie(le,ue,be,"\u22b8","\\multimap",!0),ie(le,ue,be,"\u21ad","\\leftrightsquigarrow",!0),ie(le,ue,be,"\u21c9","\\rightrightarrows",!0),ie(le,ue,be,"\u21c4","\\rightleftarrows",!0),ie(le,ue,be,"\u21a0","\\twoheadrightarrow",!0),ie(le,ue,be,"\u21a3","\\rightarrowtail",!0),ie(le,ue,be,"\u21ac","\\looparrowright",!0),ie(le,ue,be,"\u21b7","\\curvearrowright",!0),ie(le,ue,be,"\u21bb","\\circlearrowright",!0),ie(le,ue,be,"\u21b1","\\Rsh",!0),ie(le,ue,be,"\u21ca","\\downdownarrows",!0),ie(le,ue,be,"\u21be","\\upharpoonright",!0),ie(le,ue,be,"\u21c2","\\downharpoonright",!0),ie(le,ue,be,"\u21dd","\\rightsquigarrow",!0),ie(le,ue,be,"\u21dd","\\leadsto"),ie(le,ue,be,"\u21db","\\Rrightarrow",!0),ie(le,ue,be,"\u21be","\\restriction"),ie(le,ce,we,"\u2018","`"),ie(le,ce,we,"$","\\$"),ie(se,ce,we,"$","\\$"),ie(se,ce,we,"$","\\textdollar"),ie(le,ce,we,"%","\\%"),ie(se,ce,we,"%","\\%"),ie(le,ce,we,"_","\\_"),ie(se,ce,we,"_","\\_"),ie(se,ce,we,"_","\\textunderscore"),ie(le,ce,we,"\u2220","\\angle",!0),ie(le,ce,we,"\u221e","\\infty",!0),ie(le,ce,we,"\u2032","\\prime"),ie(le,ce,we,"\u25b3","\\triangle"),ie(le,ce,we,"\u0393","\\Gamma",!0),ie(le,ce,we,"\u0394","\\Delta",!0),ie(le,ce,we,"\u0398","\\Theta",!0),ie(le,ce,we,"\u039b","\\Lambda",!0),ie(le,ce,we,"\u039e","\\Xi",!0),ie(le,ce,we,"\u03a0","\\Pi",!0),ie(le,ce,we,"\u03a3","\\Sigma",!0),ie(le,ce,we,"\u03a5","\\Upsilon",!0),ie(le,ce,we,"\u03a6","\\Phi",!0),ie(le,ce,we,"\u03a8","\\Psi",!0),ie(le,ce,we,"\u03a9","\\Omega",!0),ie(le,ce,we,"A","\u0391"),ie(le,ce,we,"B","\u0392"),ie(le,ce,we,"E","\u0395"),ie(le,ce,we,"Z","\u0396"),ie(le,ce,we,"H","\u0397"),ie(le,ce,we,"I","\u0399"),ie(le,ce,we,"K","\u039a"),ie(le,ce,we,"M","\u039c"),ie(le,ce,we,"N","\u039d"),ie(le,ce,we,"O","\u039f"),ie(le,ce,we,"P","\u03a1"),ie(le,ce,we,"T","\u03a4"),ie(le,ce,we,"X","\u03a7"),ie(le,ce,we,"\xac","\\neg",!0),ie(le,ce,we,"\xac","\\lnot"),ie(le,ce,we,"\u22a4","\\top"),ie(le,ce,we,"\u22a5","\\bot"),ie(le,ce,we,"\u2205","\\emptyset"),ie(le,ue,we,"\u2205","\\varnothing"),ie(le,ce,ge,"\u03b1","\\alpha",!0),ie(le,ce,ge,"\u03b2","\\beta",!0),ie(le,ce,ge,"\u03b3","\\gamma",!0),ie(le,ce,ge,"\u03b4","\\delta",!0),ie(le,ce,ge,"\u03f5","\\epsilon",!0),ie(le,ce,ge,"\u03b6","\\zeta",!0),ie(le,ce,ge,"\u03b7","\\eta",!0),ie(le,ce,ge,"\u03b8","\\theta",!0),ie(le,ce,ge,"\u03b9","\\iota",!0),ie(le,ce,ge,"\u03ba","\\kappa",!0),ie(le,ce,ge,"\u03bb","\\lambda",!0),ie(le,ce,ge,"\u03bc","\\mu",!0),ie(le,ce,ge,"\u03bd","\\nu",!0),ie(le,ce,ge,"\u03be","\\xi",!0),ie(le,ce,ge,"\u03bf","\\omicron",!0),ie(le,ce,ge,"\u03c0","\\pi",!0),ie(le,ce,ge,"\u03c1","\\rho",!0),ie(le,ce,ge,"\u03c3","\\sigma",!0),ie(le,ce,ge,"\u03c4","\\tau",!0),ie(le,ce,ge,"\u03c5","\\upsilon",!0),ie(le,ce,ge,"\u03d5","\\phi",!0),ie(le,ce,ge,"\u03c7","\\chi",!0),ie(le,ce,ge,"\u03c8","\\psi",!0),ie(le,ce,ge,"\u03c9","\\omega",!0),ie(le,ce,ge,"\u03b5","\\varepsilon",!0),ie(le,ce,ge,"\u03d1","\\vartheta",!0),ie(le,ce,ge,"\u03d6","\\varpi",!0),ie(le,ce,ge,"\u03f1","\\varrho",!0),ie(le,ce,ge,"\u03c2","\\varsigma",!0),ie(le,ce,ge,"\u03c6","\\varphi",!0),ie(le,ce,pe,"\u2217","*",!0),ie(le,ce,pe,"+","+"),ie(le,ce,pe,"\u2212","-",!0),ie(le,ce,pe,"\u22c5","\\cdot",!0),ie(le,ce,pe,"\u2218","\\circ",!0),ie(le,ce,pe,"\xf7","\\div",!0),ie(le,ce,pe,"\xb1","\\pm",!0),ie(le,ce,pe,"\xd7","\\times",!0),ie(le,ce,pe,"\u2229","\\cap",!0),ie(le,ce,pe,"\u222a","\\cup",!0),ie(le,ce,pe,"\u2216","\\setminus",!0),ie(le,ce,pe,"\u2227","\\land"),ie(le,ce,pe,"\u2228","\\lor"),ie(le,ce,pe,"\u2227","\\wedge",!0),ie(le,ce,pe,"\u2228","\\vee",!0),ie(le,ce,we,"\u221a","\\surd"),ie(le,ce,ve,"\u27e8","\\langle",!0),ie(le,ce,ve,"\u2223","\\lvert"),ie(le,ce,ve,"\u2225","\\lVert"),ie(le,ce,fe,"?","?"),ie(le,ce,fe,"!","!"),ie(le,ce,fe,"\u27e9","\\rangle",!0),ie(le,ce,fe,"\u2223","\\rvert"),ie(le,ce,fe,"\u2225","\\rVert"),ie(le,ce,be,"=","="),ie(le,ce,be,":",":"),ie(le,ce,be,"\u2248","\\approx",!0),ie(le,ce,be,"\u2245","\\cong",!0),ie(le,ce,be,"\u2265","\\ge"),ie(le,ce,be,"\u2265","\\geq",!0),ie(le,ce,be,"\u2190","\\gets"),ie(le,ce,be,">","\\gt",!0),ie(le,ce,be,"\u2208","\\in",!0),ie(le,ce,be,"\ue020","\\@not"),ie(le,ce,be,"\u2282","\\subset",!0),ie(le,ce,be,"\u2283","\\supset",!0),ie(le,ce,be,"\u2286","\\subseteq",!0),ie(le,ce,be,"\u2287","\\supseteq",!0),ie(le,ue,be,"\u2288","\\nsubseteq",!0),ie(le,ue,be,"\u2289","\\nsupseteq",!0),ie(le,ce,be,"\u22a8","\\models"),ie(le,ce,be,"\u2190","\\leftarrow",!0),ie(le,ce,be,"\u2264","\\le"),ie(le,ce,be,"\u2264","\\leq",!0),ie(le,ce,be,"<","\\lt",!0),ie(le,ce,be,"\u2192","\\rightarrow",!0),ie(le,ce,be,"\u2192","\\to"),ie(le,ue,be,"\u2271","\\ngeq",!0),ie(le,ue,be,"\u2270","\\nleq",!0),ie(le,ce,xe,"\xa0","\\ "),ie(le,ce,xe,"\xa0","\\space"),ie(le,ce,xe,"\xa0","\\nobreakspace"),ie(se,ce,xe,"\xa0","\\ "),ie(se,ce,xe,"\xa0"," "),ie(se,ce,xe,"\xa0","\\space"),ie(se,ce,xe,"\xa0","\\nobreakspace"),ie(le,ce,xe,null,"\\nobreak"),ie(le,ce,xe,null,"\\allowbreak"),ie(le,ce,ye,",",","),ie(le,ce,ye,";",";"),ie(le,ue,pe,"\u22bc","\\barwedge",!0),ie(le,ue,pe,"\u22bb","\\veebar",!0),ie(le,ce,pe,"\u2299","\\odot",!0),ie(le,ce,pe,"\u2295","\\oplus",!0),ie(le,ce,pe,"\u2297","\\otimes",!0),ie(le,ce,we,"\u2202","\\partial",!0),ie(le,ce,pe,"\u2298","\\oslash",!0),ie(le,ue,pe,"\u229a","\\circledcirc",!0),ie(le,ue,pe,"\u22a1","\\boxdot",!0),ie(le,ce,pe,"\u25b3","\\bigtriangleup"),ie(le,ce,pe,"\u25bd","\\bigtriangledown"),ie(le,ce,pe,"\u2020","\\dagger"),ie(le,ce,pe,"\u22c4","\\diamond"),ie(le,ce,pe,"\u22c6","\\star"),ie(le,ce,pe,"\u25c3","\\triangleleft"),ie(le,ce,pe,"\u25b9","\\triangleright"),ie(le,ce,ve,"{","\\{"),ie(se,ce,we,"{","\\{"),ie(se,ce,we,"{","\\textbraceleft"),ie(le,ce,fe,"}","\\}"),ie(se,ce,we,"}","\\}"),ie(se,ce,we,"}","\\textbraceright"),ie(le,ce,ve,"{","\\lbrace"),ie(le,ce,fe,"}","\\rbrace"),ie(le,ce,ve,"[","\\lbrack",!0),ie(se,ce,we,"[","\\lbrack",!0),ie(le,ce,fe,"]","\\rbrack",!0),ie(se,ce,we,"]","\\rbrack",!0),ie(le,ce,ve,"(","\\lparen",!0),ie(le,ce,fe,")","\\rparen",!0),ie(se,ce,we,"<","\\textless",!0),ie(se,ce,we,">","\\textgreater",!0),ie(le,ce,ve,"\u230a","\\lfloor",!0),ie(le,ce,fe,"\u230b","\\rfloor",!0),ie(le,ce,ve,"\u2308","\\lceil",!0),ie(le,ce,fe,"\u2309","\\rceil",!0),ie(le,ce,we,"\\","\\backslash"),ie(le,ce,we,"\u2223","|"),ie(le,ce,we,"\u2223","\\vert"),ie(se,ce,we,"|","\\textbar",!0),ie(le,ce,we,"\u2225","\\|"),ie(le,ce,we,"\u2225","\\Vert"),ie(se,ce,we,"\u2225","\\textbardbl"),ie(se,ce,we,"~","\\textasciitilde"),ie(se,ce,we,"\\","\\textbackslash"),ie(se,ce,we,"^","\\textasciicircum"),ie(le,ce,be,"\u2191","\\uparrow",!0),ie(le,ce,be,"\u21d1","\\Uparrow",!0),ie(le,ce,be,"\u2193","\\downarrow",!0),ie(le,ce,be,"\u21d3","\\Downarrow",!0),ie(le,ce,be,"\u2195","\\updownarrow",!0),ie(le,ce,be,"\u21d5","\\Updownarrow",!0),ie(le,ce,me,"\u2210","\\coprod"),ie(le,ce,me,"\u22c1","\\bigvee"),ie(le,ce,me,"\u22c0","\\bigwedge"),ie(le,ce,me,"\u2a04","\\biguplus"),ie(le,ce,me,"\u22c2","\\bigcap"),ie(le,ce,me,"\u22c3","\\bigcup"),ie(le,ce,me,"\u222b","\\int"),ie(le,ce,me,"\u222b","\\intop"),ie(le,ce,me,"\u222c","\\iint"),ie(le,ce,me,"\u222d","\\iiint"),ie(le,ce,me,"\u220f","\\prod"),ie(le,ce,me,"\u2211","\\sum"),ie(le,ce,me,"\u2a02","\\bigotimes"),ie(le,ce,me,"\u2a01","\\bigoplus"),ie(le,ce,me,"\u2a00","\\bigodot"),ie(le,ce,me,"\u222e","\\oint"),ie(le,ce,me,"\u222f","\\oiint"),ie(le,ce,me,"\u2230","\\oiiint"),ie(le,ce,me,"\u2a06","\\bigsqcup"),ie(le,ce,me,"\u222b","\\smallint"),ie(se,ce,he,"\u2026","\\textellipsis"),ie(le,ce,he,"\u2026","\\mathellipsis"),ie(se,ce,he,"\u2026","\\ldots",!0),ie(le,ce,he,"\u2026","\\ldots",!0),ie(le,ce,he,"\u22ef","\\@cdots",!0),ie(le,ce,he,"\u22f1","\\ddots",!0),ie(le,ce,we,"\u22ee","\\varvdots"),ie(se,ce,we,"\u22ee","\\varvdots"),ie(le,ce,de,"\u02ca","\\acute"),ie(le,ce,de,"\u02cb","\\grave"),ie(le,ce,de,"\xa8","\\ddot"),ie(le,ce,de,"~","\\tilde"),ie(le,ce,de,"\u02c9","\\bar"),ie(le,ce,de,"\u02d8","\\breve"),ie(le,ce,de,"\u02c7","\\check"),ie(le,ce,de,"^","\\hat"),ie(le,ce,de,"\u20d7","\\vec"),ie(le,ce,de,"\u02d9","\\dot"),ie(le,ce,de,"\u02da","\\mathring"),ie(le,ce,ge,"\ue131","\\@imath"),ie(le,ce,ge,"\ue237","\\@jmath"),ie(le,ce,we,"\u0131","\u0131"),ie(le,ce,we,"\u0237","\u0237"),ie(se,ce,we,"\u0131","\\i",!0),ie(se,ce,we,"\u0237","\\j",!0),ie(se,ce,we,"\xdf","\\ss",!0),ie(se,ce,we,"\xe6","\\ae",!0),ie(se,ce,we,"\u0153","\\oe",!0),ie(se,ce,we,"\xf8","\\o",!0),ie(se,ce,we,"\xc6","\\AE",!0),ie(se,ce,we,"\u0152","\\OE",!0),ie(se,ce,we,"\xd8","\\O",!0),ie(se,ce,de,"\u02ca","\\'"),ie(se,ce,de,"\u02cb","\\`"),ie(se,ce,de,"\u02c6","\\^"),ie(se,ce,de,"\u02dc","\\~"),ie(se,ce,de,"\u02c9","\\="),ie(se,ce,de,"\u02d8","\\u"),ie(se,ce,de,"\u02d9","\\."),ie(se,ce,de,"\xb8","\\c"),ie(se,ce,de,"\u02da","\\r"),ie(se,ce,de,"\u02c7","\\v"),ie(se,ce,de,"\xa8",'\\"'),ie(se,ce,de,"\u02dd","\\H"),ie(se,ce,de,"\u25ef","\\textcircled");var Se={"--":!0,"---":!0,"``":!0,"''":!0};ie(se,ce,we,"\u2013","--",!0),ie(se,ce,we,"\u2013","\\textendash"),ie(se,ce,we,"\u2014","---",!0),ie(se,ce,we,"\u2014","\\textemdash"),ie(se,ce,we,"\u2018","`",!0),ie(se,ce,we,"\u2018","\\textquoteleft"),ie(se,ce,we,"\u2019","'",!0),ie(se,ce,we,"\u2019","\\textquoteright"),ie(se,ce,we,"\u201c","``",!0),ie(se,ce,we,"\u201c","\\textquotedblleft"),ie(se,ce,we,"\u201d","''",!0),ie(se,ce,we,"\u201d","\\textquotedblright"),ie(le,ce,we,"\xb0","\\degree",!0),ie(se,ce,we,"\xb0","\\degree"),ie(se,ce,we,"\xb0","\\textdegree",!0),ie(le,ce,we,"\xa3","\\pounds"),ie(le,ce,we,"\xa3","\\mathsterling",!0),ie(se,ce,we,"\xa3","\\pounds"),ie(se,ce,we,"\xa3","\\textsterling",!0),ie(le,ue,we,"\u2720","\\maltese"),ie(se,ue,we,"\u2720","\\maltese");for(var ke='0123456789/@."',Ce=0;Ce<14;Ce++){var Ee=ke.charAt(Ce);ie(le,ce,we,Ee,Ee)}for(var Ae='0123456789!@*()-=+";:?/.,',Te=0;Te<25;Te++){var Ie=Ae.charAt(Te);ie(se,ce,we,Ie,Ie)}for(var ze="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",Fe=0;Fe<52;Fe++){var Me=ze.charAt(Fe);ie(le,ce,ge,Me,Me),ie(se,ce,we,Me,Me)}ie(le,ue,we,"C","\u2102"),ie(se,ue,we,"C","\u2102"),ie(le,ue,we,"H","\u210d"),ie(se,ue,we,"H","\u210d"),ie(le,ue,we,"N","\u2115"),ie(se,ue,we,"N","\u2115"),ie(le,ue,we,"P","\u2119"),ie(se,ue,we,"P","\u2119"),ie(le,ue,we,"Q","\u211a"),ie(se,ue,we,"Q","\u211a"),ie(le,ue,we,"R","\u211d"),ie(se,ue,we,"R","\u211d"),ie(le,ue,we,"Z","\u2124"),ie(se,ue,we,"Z","\u2124"),ie(le,ce,ge,"h","\u210e"),ie(se,ce,ge,"h","\u210e");for(var je="",Be=0;Be<52;Be++){var Re=ze.charAt(Be);ie(le,ce,ge,Re,je=String.fromCharCode(55349,56320+Be)),ie(se,ce,we,Re,je),ie(le,ce,ge,Re,je=String.fromCharCode(55349,56372+Be)),ie(se,ce,we,Re,je),ie(le,ce,ge,Re,je=String.fromCharCode(55349,56424+Be)),ie(se,ce,we,Re,je),ie(le,ce,ge,Re,je=String.fromCharCode(55349,56580+Be)),ie(se,ce,we,Re,je),ie(le,ce,ge,Re,je=String.fromCharCode(55349,56684+Be)),ie(se,ce,we,Re,je),ie(le,ce,ge,Re,je=String.fromCharCode(55349,56736+Be)),ie(se,ce,we,Re,je),ie(le,ce,ge,Re,je=String.fromCharCode(55349,56788+Be)),ie(se,ce,we,Re,je),ie(le,ce,ge,Re,je=String.fromCharCode(55349,56840+Be)),ie(se,ce,we,Re,je),ie(le,ce,ge,Re,je=String.fromCharCode(55349,56944+Be)),ie(se,ce,we,Re,je),Be<26&&(ie(le,ce,ge,Re,je=String.fromCharCode(55349,56632+Be)),ie(se,ce,we,Re,je),ie(le,ce,ge,Re,je=String.fromCharCode(55349,56476+Be)),ie(se,ce,we,Re,je))}ie(le,ce,ge,"k",je=String.fromCharCode(55349,56668)),ie(se,ce,we,"k",je);for(var Oe=0;Oe<10;Oe++){var Le=Oe.toString();ie(le,ce,ge,Le,je=String.fromCharCode(55349,57294+Oe)),ie(se,ce,we,Le,je),ie(le,ce,ge,Le,je=String.fromCharCode(55349,57314+Oe)),ie(se,ce,we,Le,je),ie(le,ce,ge,Le,je=String.fromCharCode(55349,57324+Oe)),ie(se,ce,we,Le,je),ie(le,ce,ge,Le,je=String.fromCharCode(55349,57334+Oe)),ie(se,ce,we,Le,je)}for(var Ne="\xd0\xde\xfe",Pe=0;Pe<3;Pe++){var _e=Ne.charAt(Pe);ie(le,ce,ge,_e,_e),ie(se,ce,we,_e,_e)}var De=[["mathbf","textbf","Main-Bold"],["mathbf","textbf","Main-Bold"],["mathnormal","textit","Math-Italic"],["mathnormal","textit","Math-Italic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["mathscr","textscr","Script-Regular"],["","",""],["","",""],["","",""],["mathfrak","textfrak","Fraktur-Regular"],["mathfrak","textfrak","Fraktur-Regular"],["mathbb","textbb","AMS-Regular"],["mathbb","textbb","AMS-Regular"],["mathboldfrak","textboldfrak","Fraktur-Regular"],["mathboldfrak","textboldfrak","Fraktur-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathitsf","textitsf","SansSerif-Italic"],["mathitsf","textitsf","SansSerif-Italic"],["","",""],["","",""],["mathtt","texttt","Typewriter-Regular"],["mathtt","texttt","Typewriter-Regular"]],qe=[["mathbf","textbf","Main-Bold"],["","",""],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathtt","texttt","Typewriter-Regular"]],Ue=function(e,t,n){return oe[n][e]&&oe[n][e].replace&&(e=oe[n][e].replace),{value:e,metrics:j(e,t,n)}},$e=function(e,t,n,r,a){var o,i=Ue(e,t,n),l=i.metrics;if(e=i.value,l){var s=l.italic;("text"===n||r&&"mathit"===r.font)&&(s=0),o=new J(e,l.height,l.depth,s,l.skew,l.width,a)}else"undefined"!=typeof console&&console.warn("No character metrics for '"+e+"' in style '"+t+"' and mode '"+n+"'"),o=new J(e,0,0,0,0,0,a);if(r){o.maxFontSize=r.sizeMultiplier,r.style.isTight()&&o.classes.push("mtight");var c=r.getColor();c&&(o.style.color=c)}return o},He=(e,t)=>{if($(e.classes)!==$(t.classes)||e.skew!==t.skew||e.maxFontSize!==t.maxFontSize)return!1;if(1===e.classes.length){var n=e.classes[0];if("mbin"===n||"mord"===n)return!1}for(var r in e.style)if(e.style.hasOwnProperty(r)&&e.style[r]!==t.style[r])return!1;for(var a in t.style)if(t.style.hasOwnProperty(a)&&e.style[a]!==t.style[a])return!1;return!0},Ve=function(e){for(var t=0,n=0,r=0,a=0;a<e.children.length;a++){var o=e.children[a];o.height>t&&(t=o.height),o.depth>n&&(n=o.depth),o.maxFontSize>r&&(r=o.maxFontSize)}e.height=t,e.depth=n,e.maxFontSize=r},Ge=function(e,t,n,r){var a=new Y(e,t,n,r);return Ve(a),a},We=(e,t,n,r)=>new Y(e,t,n,r),Ye=function(e){var t=new I(e);return Ve(t),t},Ke=function(e,t,n){var r="";switch(e){case"amsrm":r="AMS";break;case"textrm":r="Main";break;case"textsf":r="SansSerif";break;case"texttt":r="Typewriter";break;default:r=e}return r+"-"+("textbf"===t&&"textit"===n?"BoldItalic":"textbf"===t?"Bold":"textit"===t?"Italic":"Regular")},Xe={mathbf:{variant:"bold",fontName:"Main-Bold"},mathrm:{variant:"normal",fontName:"Main-Regular"},textit:{variant:"italic",fontName:"Main-Italic"},mathit:{variant:"italic",fontName:"Main-Italic"},mathnormal:{variant:"italic",fontName:"Math-Italic"},mathsfit:{variant:"sans-serif-italic",fontName:"SansSerif-Italic"},mathbb:{variant:"double-struck",fontName:"AMS-Regular"},mathcal:{variant:"script",fontName:"Caligraphic-Regular"},mathfrak:{variant:"fraktur",fontName:"Fraktur-Regular"},mathscr:{variant:"script",fontName:"Script-Regular"},mathsf:{variant:"sans-serif",fontName:"SansSerif-Regular"},mathtt:{variant:"monospace",fontName:"Typewriter-Regular"}},Qe={vec:["vec",.471,.714],oiintSize1:["oiintSize1",.957,.499],oiintSize2:["oiintSize2",1.472,.659],oiiintSize1:["oiiintSize1",1.304,.499],oiiintSize2:["oiiintSize2",1.98,.659]},Je={fontMap:Xe,makeSymbol:$e,mathsym:function(e,t,n,r){return void 0===r&&(r=[]),"boldsymbol"===n.font&&Ue(e,"Main-Bold",t).metrics?$e(e,"Main-Bold",t,n,r.concat(["mathbf"])):"\\"===e||"main"===oe[t][e].font?$e(e,"Main-Regular",t,n,r):$e(e,"AMS-Regular",t,n,r.concat(["amsrm"]))},makeSpan:Ge,makeSvgSpan:We,makeLineSpan:function(e,t,n){var r=Ge([e],[],t);return r.height=Math.max(n||t.fontMetrics().defaultRuleThickness,t.minRuleThickness),r.style.borderBottomWidth=U(r.height),r.maxFontSize=1,r},makeAnchor:function(e,t,n,r){var a=new K(e,t,n,r);return Ve(a),a},makeFragment:Ye,wrapFragment:function(e,t){return e instanceof I?Ge([],[e],t):e},makeVList:function(e,t){for(var{children:n,depth:r}=function(e){if("individualShift"===e.positionType){for(var t=e.children,n=[t[0]],r=-t[0].shift-t[0].elem.depth,a=r,o=1;o<t.length;o++){var i=-t[o].shift-a-t[o].elem.depth,l=i-(t[o-1].elem.height+t[o-1].elem.depth);a+=i,n.push({type:"kern",size:l}),n.push(t[o])}return{children:n,depth:r}}var s;if("top"===e.positionType){for(var c=e.positionData,u=0;u<e.children.length;u++){var d=e.children[u];c-="kern"===d.type?d.size:d.elem.height+d.elem.depth}s=c}else if("bottom"===e.positionType)s=-e.positionData;else{var p=e.children[0];if("elem"!==p.type)throw new Error('First child must have type "elem".');if("shift"===e.positionType)s=-p.elem.depth-e.positionData;else{if("firstBaseline"!==e.positionType)throw new Error("Invalid positionType "+e.positionType+".");s=-p.elem.depth}}return{children:e.children,depth:s}}(e),a=0,o=0;o<n.length;o++){var i=n[o];if("elem"===i.type){var l=i.elem;a=Math.max(a,l.maxFontSize,l.height)}}a+=2;var s=Ge(["pstrut"],[]);s.style.height=U(a);for(var c=[],u=r,d=r,p=r,f=0;f<n.length;f++){var h=n[f];if("kern"===h.type)p+=h.size;else{var g=h.elem,m=h.wrapperClasses||[],v=h.wrapperStyle||{},y=Ge(m,[s,g],void 0,v);y.style.top=U(-a-p-g.depth),h.marginLeft&&(y.style.marginLeft=h.marginLeft),h.marginRight&&(y.style.marginRight=h.marginRight),c.push(y),p+=g.height+g.depth}u=Math.min(u,p),d=Math.max(d,p)}var b,x=Ge(["vlist"],c);if(x.style.height=U(d),u<0){var w=Ge([],[]),S=Ge(["vlist"],[w]);S.style.height=U(-u);var k=Ge(["vlist-s"],[new J("\u200b")]);b=[Ge(["vlist-r"],[x,k]),Ge(["vlist-r"],[S])]}else b=[Ge(["vlist-r"],[x])];var C=Ge(["vlist-t"],b);return 2===b.length&&C.classes.push("vlist-t2"),C.height=d,C.depth=-u,C},makeOrd:function(e,t,n){var r=e.mode,a=e.text,i=["mord"],l="math"===r||"text"===r&&t.font,s=l?t.font:t.fontFamily,c="",u="";if(55349===a.charCodeAt(0)&&([c,u]=function(e,t){var n=1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536,r="math"===t?0:1;if(119808<=n&&n<120484){var a=Math.floor((n-119808)/26);return[De[a][2],De[a][r]]}if(120782<=n&&n<=120831){var i=Math.floor((n-120782)/10);return[qe[i][2],qe[i][r]]}if(120485===n||120486===n)return[De[0][2],De[0][r]];if(120486<n&&n<120782)return["",""];throw new o("Unsupported character: "+e)}(a,r)),c.length>0)return $e(a,c,r,t,i.concat(u));if(s){var d,p;if("boldsymbol"===s){var f=function(e,t,n,r,a){return"textord"!==a&&Ue(e,"Math-BoldItalic",t).metrics?{fontName:"Math-BoldItalic",fontClass:"boldsymbol"}:{fontName:"Main-Bold",fontClass:"mathbf"}}(a,r,0,0,n);d=f.fontName,p=[f.fontClass]}else l?(d=Xe[s].fontName,p=[s]):(d=Ke(s,t.fontWeight,t.fontShape),p=[s,t.fontWeight,t.fontShape]);if(Ue(a,d,r).metrics)return $e(a,d,r,t,i.concat(p));if(Se.hasOwnProperty(a)&&"Typewriter"===d.slice(0,10)){for(var h=[],g=0;g<a.length;g++)h.push($e(a[g],d,r,t,i.concat(p)));return Ye(h)}}if("mathord"===n)return $e(a,"Math-Italic",r,t,i.concat(["mathnormal"]));if("textord"===n){var m=oe[r][a]&&oe[r][a].font;if("ams"===m){var v=Ke("amsrm",t.fontWeight,t.fontShape);return $e(a,v,r,t,i.concat("amsrm",t.fontWeight,t.fontShape))}if("main"!==m&&m){var y=Ke(m,t.fontWeight,t.fontShape);return $e(a,y,r,t,i.concat(y,t.fontWeight,t.fontShape))}var b=Ke("textrm",t.fontWeight,t.fontShape);return $e(a,b,r,t,i.concat(t.fontWeight,t.fontShape))}throw new Error("unexpected type: "+n+" in makeOrd")},makeGlue:(e,t)=>{var n=Ge(["mspace"],[],t),r=q(e,t);return n.style.marginRight=U(r),n},staticSvg:function(e,t){var[n,r,a]=Qe[e],o=new ee(n),i=new Z([o],{width:U(r),height:U(a),style:"width:"+U(r),viewBox:"0 0 "+1e3*r+" "+1e3*a,preserveAspectRatio:"xMinYMin"}),l=We(["overlay"],[i],t);return l.height=a,l.style.height=U(a),l.style.width=U(r),l},svgData:Qe,tryCombineChars:e=>{for(var t=0;t<e.length-1;t++){var n=e[t],r=e[t+1];n instanceof J&&r instanceof J&&He(n,r)&&(n.text+=r.text,n.height=Math.max(n.height,r.height),n.depth=Math.max(n.depth,r.depth),n.italic=r.italic,e.splice(t+1,1),t--)}return e}},Ze={number:3,unit:"mu"},et={number:4,unit:"mu"},tt={number:5,unit:"mu"},nt={mord:{mop:Ze,mbin:et,mrel:tt,minner:Ze},mop:{mord:Ze,mop:Ze,mrel:tt,minner:Ze},mbin:{mord:et,mop:et,mopen:et,minner:et},mrel:{mord:tt,mop:tt,mopen:tt,minner:tt},mopen:{},mclose:{mop:Ze,mbin:et,mrel:tt,minner:Ze},mpunct:{mord:Ze,mop:Ze,mrel:tt,mopen:Ze,mclose:Ze,mpunct:Ze,minner:Ze},minner:{mord:Ze,mop:Ze,mbin:et,mrel:tt,mopen:Ze,mpunct:Ze,minner:Ze}},rt={mord:{mop:Ze},mop:{mord:Ze,mop:Ze},mbin:{},mrel:{},mopen:{},mclose:{mop:Ze},mpunct:{},minner:{mop:Ze}},at={},ot={},it={};function lt(e){for(var{type:t,names:n,props:r,handler:a,htmlBuilder:o,mathmlBuilder:i}=e,l={type:t,numArgs:r.numArgs,argTypes:r.argTypes,allowedInArgument:!!r.allowedInArgument,allowedInText:!!r.allowedInText,allowedInMath:void 0===r.allowedInMath||r.allowedInMath,numOptionalArgs:r.numOptionalArgs||0,infix:!!r.infix,primitive:!!r.primitive,handler:a},s=0;s<n.length;++s)at[n[s]]=l;t&&(o&&(ot[t]=o),i&&(it[t]=i))}function st(e){var{type:t,htmlBuilder:n,mathmlBuilder:r}=e;lt({type:t,names:[],props:{numArgs:0},handler(){throw new Error("Should never be called.")},htmlBuilder:n,mathmlBuilder:r})}var ct=function(e){return"ordgroup"===e.type&&1===e.body.length?e.body[0]:e},ut=function(e){return"ordgroup"===e.type?e.body:[e]},dt=Je.makeSpan,pt=["leftmost","mbin","mopen","mrel","mop","mpunct"],ft=["rightmost","mrel","mclose","mpunct"],ht={display:S.DISPLAY,text:S.TEXT,script:S.SCRIPT,scriptscript:S.SCRIPTSCRIPT},gt={mord:"mord",mop:"mop",mbin:"mbin",mrel:"mrel",mopen:"mopen",mclose:"mclose",mpunct:"mpunct",minner:"minner"},mt=function(e,t,n,r){void 0===r&&(r=[null,null]);for(var a=[],o=0;o<e.length;o++){var i=St(e[o],t);if(i instanceof I){var l=i.children;a.push(...l)}else a.push(i)}if(Je.tryCombineChars(a),!n)return a;var s=t;if(1===e.length){var c=e[0];"sizing"===c.type?s=t.havingSize(c.size):"styling"===c.type&&(s=t.havingStyle(ht[c.style]))}var d=dt([r[0]||"leftmost"],[],t),p=dt([r[1]||"rightmost"],[],t),f="root"===n;return vt(a,((e,t)=>{var n=t.classes[0],r=e.classes[0];"mbin"===n&&u.contains(ft,r)?t.classes[0]="mord":"mbin"===r&&u.contains(pt,n)&&(e.classes[0]="mord")}),{node:d},p,f),vt(a,((e,t)=>{var n=xt(t),r=xt(e),a=n&&r?e.hasClass("mtight")?rt[n][r]:nt[n][r]:null;if(a)return Je.makeGlue(a,s)}),{node:d},p,f),a},vt=function e(t,n,r,a,o){a&&t.push(a);for(var i=0;i<t.length;i++){var l=t[i],s=yt(l);if(s)e(s.children,n,r,null,o);else{var c=!l.hasClass("mspace");if(c){var u=n(l,r.node);u&&(r.insertAfter?r.insertAfter(u):(t.unshift(u),i++))}c?r.node=l:o&&l.hasClass("newline")&&(r.node=dt(["leftmost"])),r.insertAfter=(e=>n=>{t.splice(e+1,0,n),i++})(i)}}a&&t.pop()},yt=function(e){return e instanceof I||e instanceof K||e instanceof Y&&e.hasClass("enclosing")?e:null},bt=function e(t,n){var r=yt(t);if(r){var a=r.children;if(a.length){if("right"===n)return e(a[a.length-1],"right");if("left"===n)return e(a[0],"left")}}return t},xt=function(e,t){return e?(t&&(e=bt(e,t)),gt[e.classes[0]]||null):null},wt=function(e,t){var n=["nulldelimiter"].concat(e.baseSizingClasses());return dt(t.concat(n))},St=function(e,t,n){if(!e)return dt();if(ot[e.type]){var r=ot[e.type](e,t);if(n&&t.size!==n.size){r=dt(t.sizingClasses(n),[r],t);var a=t.sizeMultiplier/n.sizeMultiplier;r.height*=a,r.depth*=a}return r}throw new o("Got group of unknown type: '"+e.type+"'")};function kt(e,t){var n=dt(["base"],e,t),r=dt(["strut"]);return r.style.height=U(n.height+n.depth),n.depth&&(r.style.verticalAlign=U(-n.depth)),n.children.unshift(r),n}function Ct(e,t){var n=null;1===e.length&&"tag"===e[0].type&&(n=e[0].tag,e=e[0].body);var r,a=mt(e,t,"root");2===a.length&&a[1].hasClass("tag")&&(r=a.pop());for(var o,i=[],l=[],s=0;s<a.length;s++)if(l.push(a[s]),a[s].hasClass("mbin")||a[s].hasClass("mrel")||a[s].hasClass("allowbreak")){for(var c=!1;s<a.length-1&&a[s+1].hasClass("mspace")&&!a[s+1].hasClass("newline");)s++,l.push(a[s]),a[s].hasClass("nobreak")&&(c=!0);c||(i.push(kt(l,t)),l=[])}else a[s].hasClass("newline")&&(l.pop(),l.length>0&&(i.push(kt(l,t)),l=[]),i.push(a[s]));l.length>0&&i.push(kt(l,t)),n?((o=kt(mt(n,t,!0))).classes=["tag"],i.push(o)):r&&i.push(r);var u=dt(["katex-html"],i);if(u.setAttribute("aria-hidden","true"),o){var d=o.children[0];d.style.height=U(u.height+u.depth),u.depth&&(d.style.verticalAlign=U(-u.depth))}return u}function Et(e){return new I(e)}class At{constructor(e,t,n){this.type=void 0,this.attributes=void 0,this.children=void 0,this.classes=void 0,this.type=e,this.attributes={},this.children=t||[],this.classes=n||[]}setAttribute(e,t){this.attributes[e]=t}getAttribute(e){return this.attributes[e]}toNode(){var e=document.createElementNS("http://www.w3.org/1998/Math/MathML",this.type);for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&e.setAttribute(t,this.attributes[t]);this.classes.length>0&&(e.className=$(this.classes));for(var n=0;n<this.children.length;n++)if(this.children[n]instanceof Tt&&this.children[n+1]instanceof Tt){for(var r=this.children[n].toText()+this.children[++n].toText();this.children[n+1]instanceof Tt;)r+=this.children[++n].toText();e.appendChild(new Tt(r).toNode())}else e.appendChild(this.children[n].toNode());return e}toMarkup(){var e="<"+this.type;for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&(e+=" "+t+'="',e+=u.escape(this.attributes[t]),e+='"');this.classes.length>0&&(e+=' class ="'+u.escape($(this.classes))+'"'),e+=">";for(var n=0;n<this.children.length;n++)e+=this.children[n].toMarkup();return e+="</"+this.type+">"}toText(){return this.children.map((e=>e.toText())).join("")}}class Tt{constructor(e){this.text=void 0,this.text=e}toNode(){return document.createTextNode(this.text)}toMarkup(){return u.escape(this.toText())}toText(){return this.text}}var It={MathNode:At,TextNode:Tt,SpaceNode:class{constructor(e){this.width=void 0,this.character=void 0,this.width=e,this.character=e>=.05555&&e<=.05556?"\u200a":e>=.1666&&e<=.1667?"\u2009":e>=.2222&&e<=.2223?"\u2005":e>=.2777&&e<=.2778?"\u2005\u200a":e>=-.05556&&e<=-.05555?"\u200a\u2063":e>=-.1667&&e<=-.1666?"\u2009\u2063":e>=-.2223&&e<=-.2222?"\u205f\u2063":e>=-.2778&&e<=-.2777?"\u2005\u2063":null}toNode(){if(this.character)return document.createTextNode(this.character);var e=document.createElementNS("http://www.w3.org/1998/Math/MathML","mspace");return e.setAttribute("width",U(this.width)),e}toMarkup(){return this.character?"<mtext>"+this.character+"</mtext>":'<mspace width="'+U(this.width)+'"/>'}toText(){return this.character?this.character:" "}},newDocumentFragment:Et},zt=function(e,t,n){return!oe[t][e]||!oe[t][e].replace||55349===e.charCodeAt(0)||Se.hasOwnProperty(e)&&n&&(n.fontFamily&&"tt"===n.fontFamily.slice(4,6)||n.font&&"tt"===n.font.slice(4,6))||(e=oe[t][e].replace),new It.TextNode(e)},Ft=function(e){return 1===e.length?e[0]:new It.MathNode("mrow",e)},Mt=function(e,t){if("texttt"===t.fontFamily)return"monospace";if("textsf"===t.fontFamily)return"textit"===t.fontShape&&"textbf"===t.fontWeight?"sans-serif-bold-italic":"textit"===t.fontShape?"sans-serif-italic":"textbf"===t.fontWeight?"bold-sans-serif":"sans-serif";if("textit"===t.fontShape&&"textbf"===t.fontWeight)return"bold-italic";if("textit"===t.fontShape)return"italic";if("textbf"===t.fontWeight)return"bold";var n=t.font;if(!n||"mathnormal"===n)return null;var r=e.mode;if("mathit"===n)return"italic";if("boldsymbol"===n)return"textord"===e.type?"bold":"bold-italic";if("mathbf"===n)return"bold";if("mathbb"===n)return"double-struck";if("mathsfit"===n)return"sans-serif-italic";if("mathfrak"===n)return"fraktur";if("mathscr"===n||"mathcal"===n)return"script";if("mathsf"===n)return"sans-serif";if("mathtt"===n)return"monospace";var a=e.text;return u.contains(["\\imath","\\jmath"],a)?null:(oe[r][a]&&oe[r][a].replace&&(a=oe[r][a].replace),j(a,Je.fontMap[n].fontName,r)?Je.fontMap[n].variant:null)};function jt(e){if(!e)return!1;if("mi"===e.type&&1===e.children.length){var t=e.children[0];return t instanceof Tt&&"."===t.text}if("mo"===e.type&&1===e.children.length&&"true"===e.getAttribute("separator")&&"0em"===e.getAttribute("lspace")&&"0em"===e.getAttribute("rspace")){var n=e.children[0];return n instanceof Tt&&","===n.text}return!1}var Bt=function(e,t,n){if(1===e.length){var r=Ot(e[0],t);return n&&r instanceof At&&"mo"===r.type&&(r.setAttribute("lspace","0em"),r.setAttribute("rspace","0em")),[r]}for(var a,o=[],i=0;i<e.length;i++){var l=Ot(e[i],t);if(l instanceof At&&a instanceof At){if("mtext"===l.type&&"mtext"===a.type&&l.getAttribute("mathvariant")===a.getAttribute("mathvariant")){a.children.push(...l.children);continue}if("mn"===l.type&&"mn"===a.type){a.children.push(...l.children);continue}if(jt(l)&&"mn"===a.type){a.children.push(...l.children);continue}if("mn"===l.type&&jt(a))l.children=[...a.children,...l.children],o.pop();else if(("msup"===l.type||"msub"===l.type)&&l.children.length>=1&&("mn"===a.type||jt(a))){var s=l.children[0];s instanceof At&&"mn"===s.type&&(s.children=[...a.children,...s.children],o.pop())}else if("mi"===a.type&&1===a.children.length){var c=a.children[0];if(c instanceof Tt&&"\u0338"===c.text&&("mo"===l.type||"mi"===l.type||"mn"===l.type)){var u=l.children[0];u instanceof Tt&&u.text.length>0&&(u.text=u.text.slice(0,1)+"\u0338"+u.text.slice(1),o.pop())}}}o.push(l),a=l}return o},Rt=function(e,t,n){return Ft(Bt(e,t,n))},Ot=function(e,t){if(!e)return new It.MathNode("mrow");if(it[e.type])return it[e.type](e,t);throw new o("Got group of unknown type: '"+e.type+"'")};function Lt(e,t,n,r,a){var o,i=Bt(e,n);o=1===i.length&&i[0]instanceof At&&u.contains(["mrow","mtable"],i[0].type)?i[0]:new It.MathNode("mrow",i);var l=new It.MathNode("annotation",[new It.TextNode(t)]);l.setAttribute("encoding","application/x-tex");var s=new It.MathNode("semantics",[o,l]),c=new It.MathNode("math",[s]);c.setAttribute("xmlns","http://www.w3.org/1998/Math/MathML"),r&&c.setAttribute("display","block");var d=a?"katex":"katex-mathml";return Je.makeSpan([d],[c])}var Nt=function(e){return new N({style:e.displayMode?S.DISPLAY:S.TEXT,maxSize:e.maxSize,minRuleThickness:e.minRuleThickness})},Pt=function(e,t){if(t.displayMode){var n=["katex-display"];t.leqno&&n.push("leqno"),t.fleqn&&n.push("fleqn"),e=Je.makeSpan(n,[e])}return e},_t={widehat:"^",widecheck:"\u02c7",widetilde:"~",utilde:"~",overleftarrow:"\u2190",underleftarrow:"\u2190",xleftarrow:"\u2190",overrightarrow:"\u2192",underrightarrow:"\u2192",xrightarrow:"\u2192",underbrace:"\u23df",overbrace:"\u23de",overgroup:"\u23e0",undergroup:"\u23e1",overleftrightarrow:"\u2194",underleftrightarrow:"\u2194",xleftrightarrow:"\u2194",Overrightarrow:"\u21d2",xRightarrow:"\u21d2",overleftharpoon:"\u21bc",xleftharpoonup:"\u21bc",overrightharpoon:"\u21c0",xrightharpoonup:"\u21c0",xLeftarrow:"\u21d0",xLeftrightarrow:"\u21d4",xhookleftarrow:"\u21a9",xhookrightarrow:"\u21aa",xmapsto:"\u21a6",xrightharpoondown:"\u21c1",xleftharpoondown:"\u21bd",xrightleftharpoons:"\u21cc",xleftrightharpoons:"\u21cb",xtwoheadleftarrow:"\u219e",xtwoheadrightarrow:"\u21a0",xlongequal:"=",xtofrom:"\u21c4",xrightleftarrows:"\u21c4",xrightequilibrium:"\u21cc",xleftequilibrium:"\u21cb","\\cdrightarrow":"\u2192","\\cdleftarrow":"\u2190","\\cdlongequal":"="},Dt={overrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],overleftarrow:[["leftarrow"],.888,522,"xMinYMin"],underrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],underleftarrow:[["leftarrow"],.888,522,"xMinYMin"],xrightarrow:[["rightarrow"],1.469,522,"xMaxYMin"],"\\cdrightarrow":[["rightarrow"],3,522,"xMaxYMin"],xleftarrow:[["leftarrow"],1.469,522,"xMinYMin"],"\\cdleftarrow":[["leftarrow"],3,522,"xMinYMin"],Overrightarrow:[["doublerightarrow"],.888,560,"xMaxYMin"],xRightarrow:[["doublerightarrow"],1.526,560,"xMaxYMin"],xLeftarrow:[["doubleleftarrow"],1.526,560,"xMinYMin"],overleftharpoon:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoonup:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoondown:[["leftharpoondown"],.888,522,"xMinYMin"],overrightharpoon:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoonup:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoondown:[["rightharpoondown"],.888,522,"xMaxYMin"],xlongequal:[["longequal"],.888,334,"xMinYMin"],"\\cdlongequal":[["longequal"],3,334,"xMinYMin"],xtwoheadleftarrow:[["twoheadleftarrow"],.888,334,"xMinYMin"],xtwoheadrightarrow:[["twoheadrightarrow"],.888,334,"xMaxYMin"],overleftrightarrow:[["leftarrow","rightarrow"],.888,522],overbrace:[["leftbrace","midbrace","rightbrace"],1.6,548],underbrace:[["leftbraceunder","midbraceunder","rightbraceunder"],1.6,548],underleftrightarrow:[["leftarrow","rightarrow"],.888,522],xleftrightarrow:[["leftarrow","rightarrow"],1.75,522],xLeftrightarrow:[["doubleleftarrow","doublerightarrow"],1.75,560],xrightleftharpoons:[["leftharpoondownplus","rightharpoonplus"],1.75,716],xleftrightharpoons:[["leftharpoonplus","rightharpoondownplus"],1.75,716],xhookleftarrow:[["leftarrow","righthook"],1.08,522],xhookrightarrow:[["lefthook","rightarrow"],1.08,522],overlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],underlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],overgroup:[["leftgroup","rightgroup"],.888,342],undergroup:[["leftgroupunder","rightgroupunder"],.888,342],xmapsto:[["leftmapsto","rightarrow"],1.5,522],xtofrom:[["leftToFrom","rightToFrom"],1.75,528],xrightleftarrows:[["baraboveleftarrow","rightarrowabovebar"],1.75,901],xrightequilibrium:[["baraboveshortleftharpoon","rightharpoonaboveshortbar"],1.75,716],xleftequilibrium:[["shortbaraboveleftharpoon","shortrightharpoonabovebar"],1.75,716]},qt=function(e,t,n,r,a){var o,i=e.height+e.depth+n+r;if(/fbox|color|angl/.test(t)){if(o=Je.makeSpan(["stretchy",t],[],a),"fbox"===t){var l=a.color&&a.getColor();l&&(o.style.borderColor=l)}}else{var s=[];/^[bx]cancel$/.test(t)&&s.push(new te({x1:"0",y1:"0",x2:"100%",y2:"100%","stroke-width":"0.046em"})),/^x?cancel$/.test(t)&&s.push(new te({x1:"0",y1:"100%",x2:"100%",y2:"0","stroke-width":"0.046em"}));var c=new Z(s,{width:"100%",height:U(i)});o=Je.makeSvgSpan([],[c],a)}return o.height=i,o.style.height=U(i),o},Ut=function(e){var t=new It.MathNode("mo",[new It.TextNode(_t[e.replace(/^\\/,"")])]);return t.setAttribute("stretchy","true"),t},$t=function(e,t){var{span:n,minWidth:r,height:a}=function(){var n=4e5,r=e.label.slice(1);if(u.contains(["widehat","widecheck","widetilde","utilde"],r)){var a,o,i,l="ordgroup"===(h=e.base).type?h.body.length:1;if(l>5)"widehat"===r||"widecheck"===r?(a=420,n=2364,i=.42,o=r+"4"):(a=312,n=2340,i=.34,o="tilde4");else{var s=[1,1,2,2,3,3][l];"widehat"===r||"widecheck"===r?(n=[0,1062,2364,2364,2364][s],a=[0,239,300,360,420][s],i=[0,.24,.3,.3,.36,.42][s],o=r+s):(n=[0,600,1033,2339,2340][s],a=[0,260,286,306,312][s],i=[0,.26,.286,.3,.306,.34][s],o="tilde"+s)}var c=new ee(o),d=new Z([c],{width:"100%",height:U(i),viewBox:"0 0 "+n+" "+a,preserveAspectRatio:"none"});return{span:Je.makeSvgSpan([],[d],t),minWidth:0,height:i}}var p,f,h,g=[],m=Dt[r],[v,y,b]=m,x=b/1e3,w=v.length;if(1===w)p=["hide-tail"],f=[m[3]];else if(2===w)p=["halfarrow-left","halfarrow-right"],f=["xMinYMin","xMaxYMin"];else{if(3!==w)throw new Error("Correct katexImagesData or update code here to support\n                    "+w+" children.");p=["brace-left","brace-center","brace-right"],f=["xMinYMin","xMidYMin","xMaxYMin"]}for(var S=0;S<w;S++){var k=new ee(v[S]),C=new Z([k],{width:"400em",height:U(x),viewBox:"0 0 "+n+" "+b,preserveAspectRatio:f[S]+" slice"}),E=Je.makeSvgSpan([p[S]],[C],t);if(1===w)return{span:E,minWidth:y,height:x};E.style.height=U(x),g.push(E)}return{span:Je.makeSpan(["stretchy"],g,t),minWidth:y,height:x}}();return n.height=a,n.style.height=U(a),r>0&&(n.style.minWidth=U(r)),n};function Ht(e,t){if(!e||e.type!==t)throw new Error("Expected node of type "+t+", but got "+(e?"node of type "+e.type:String(e)));return e}function Vt(e){var t=Gt(e);if(!t)throw new Error("Expected node of symbol group type, but got "+(e?"node of type "+e.type:String(e)));return t}function Gt(e){return e&&("atom"===e.type||ae.hasOwnProperty(e.type))?e:null}var Wt=(e,t)=>{var n,r,a;e&&"supsub"===e.type?(n=(r=Ht(e.base,"accent")).base,e.base=n,a=function(e){if(e instanceof Y)return e;throw new Error("Expected span<HtmlDomNode> but got "+String(e)+".")}(St(e,t)),e.base=r):n=(r=Ht(e,"accent")).base;var o=St(n,t.havingCrampedStyle()),i=0;if(r.isShifty&&u.isCharacterBox(n)){var l=u.getBaseElem(n);i=ne(St(l,t.havingCrampedStyle())).skew}var s,c="\\c"===r.label,d=c?o.height+o.depth:Math.min(o.height,t.fontMetrics().xHeight);if(r.isStretchy)s=$t(r,t),s=Je.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:o},{type:"elem",elem:s,wrapperClasses:["svg-align"],wrapperStyle:i>0?{width:"calc(100% - "+U(2*i)+")",marginLeft:U(2*i)}:void 0}]},t);else{var p,f;"\\vec"===r.label?(p=Je.staticSvg("vec",t),f=Je.svgData.vec[1]):((p=ne(p=Je.makeOrd({mode:r.mode,text:r.label},t,"textord"))).italic=0,f=p.width,c&&(d+=p.depth)),s=Je.makeSpan(["accent-body"],[p]);var h="\\textcircled"===r.label;h&&(s.classes.push("accent-full"),d=o.height);var g=i;h||(g-=f/2),s.style.left=U(g),"\\textcircled"===r.label&&(s.style.top=".2em"),s=Je.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:o},{type:"kern",size:-d},{type:"elem",elem:s}]},t)}var m=Je.makeSpan(["mord","accent"],[s],t);return a?(a.children[0]=m,a.height=Math.max(m.height,a.height),a.classes[0]="mord",a):m},Yt=(e,t)=>{var n=e.isStretchy?Ut(e.label):new It.MathNode("mo",[zt(e.label,e.mode)]),r=new It.MathNode("mover",[Ot(e.base,t),n]);return r.setAttribute("accent","true"),r},Kt=new RegExp(["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring"].map((e=>"\\"+e)).join("|"));lt({type:"accent",names:["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring","\\widecheck","\\widehat","\\widetilde","\\overrightarrow","\\overleftarrow","\\Overrightarrow","\\overleftrightarrow","\\overgroup","\\overlinesegment","\\overleftharpoon","\\overrightharpoon"],props:{numArgs:1},handler:(e,t)=>{var n=ct(t[0]),r=!Kt.test(e.funcName),a=!r||"\\widehat"===e.funcName||"\\widetilde"===e.funcName||"\\widecheck"===e.funcName;return{type:"accent",mode:e.parser.mode,label:e.funcName,isStretchy:r,isShifty:a,base:n}},htmlBuilder:Wt,mathmlBuilder:Yt}),lt({type:"accent",names:["\\'","\\`","\\^","\\~","\\=","\\u","\\.",'\\"',"\\c","\\r","\\H","\\v","\\textcircled"],props:{numArgs:1,allowedInText:!0,allowedInMath:!0,argTypes:["primitive"]},handler:(e,t)=>{var n=t[0],r=e.parser.mode;return"math"===r&&(e.parser.settings.reportNonstrict("mathVsTextAccents","LaTeX's accent "+e.funcName+" works only in text mode"),r="text"),{type:"accent",mode:r,label:e.funcName,isStretchy:!1,isShifty:!0,base:n}},htmlBuilder:Wt,mathmlBuilder:Yt}),lt({type:"accentUnder",names:["\\underleftarrow","\\underrightarrow","\\underleftrightarrow","\\undergroup","\\underlinesegment","\\utilde"],props:{numArgs:1},handler:(e,t)=>{var{parser:n,funcName:r}=e,a=t[0];return{type:"accentUnder",mode:n.mode,label:r,base:a}},htmlBuilder:(e,t)=>{var n=St(e.base,t),r=$t(e,t),a="\\utilde"===e.label?.12:0,o=Je.makeVList({positionType:"top",positionData:n.height,children:[{type:"elem",elem:r,wrapperClasses:["svg-align"]},{type:"kern",size:a},{type:"elem",elem:n}]},t);return Je.makeSpan(["mord","accentunder"],[o],t)},mathmlBuilder:(e,t)=>{var n=Ut(e.label),r=new It.MathNode("munder",[Ot(e.base,t),n]);return r.setAttribute("accentunder","true"),r}});var Xt=e=>{var t=new It.MathNode("mpadded",e?[e]:[]);return t.setAttribute("width","+0.6em"),t.setAttribute("lspace","0.3em"),t};lt({type:"xArrow",names:["\\xleftarrow","\\xrightarrow","\\xLeftarrow","\\xRightarrow","\\xleftrightarrow","\\xLeftrightarrow","\\xhookleftarrow","\\xhookrightarrow","\\xmapsto","\\xrightharpoondown","\\xrightharpoonup","\\xleftharpoondown","\\xleftharpoonup","\\xrightleftharpoons","\\xleftrightharpoons","\\xlongequal","\\xtwoheadrightarrow","\\xtwoheadleftarrow","\\xtofrom","\\xrightleftarrows","\\xrightequilibrium","\\xleftequilibrium","\\\\cdrightarrow","\\\\cdleftarrow","\\\\cdlongequal"],props:{numArgs:1,numOptionalArgs:1},handler(e,t,n){var{parser:r,funcName:a}=e;return{type:"xArrow",mode:r.mode,label:a,body:t[0],below:n[0]}},htmlBuilder(e,t){var n,r=t.style,a=t.havingStyle(r.sup()),o=Je.wrapFragment(St(e.body,a,t),t),i="\\x"===e.label.slice(0,2)?"x":"cd";o.classes.push(i+"-arrow-pad"),e.below&&(a=t.havingStyle(r.sub()),(n=Je.wrapFragment(St(e.below,a,t),t)).classes.push(i+"-arrow-pad"));var l,s=$t(e,t),c=-t.fontMetrics().axisHeight+.5*s.height,u=-t.fontMetrics().axisHeight-.5*s.height-.111;if((o.depth>.25||"\\xleftequilibrium"===e.label)&&(u-=o.depth),n){var d=-t.fontMetrics().axisHeight+n.height+.5*s.height+.111;l=Je.makeVList({positionType:"individualShift",children:[{type:"elem",elem:o,shift:u},{type:"elem",elem:s,shift:c},{type:"elem",elem:n,shift:d}]},t)}else l=Je.makeVList({positionType:"individualShift",children:[{type:"elem",elem:o,shift:u},{type:"elem",elem:s,shift:c}]},t);return l.children[0].children[0].children[1].classes.push("svg-align"),Je.makeSpan(["mrel","x-arrow"],[l],t)},mathmlBuilder(e,t){var n,r=Ut(e.label);if(r.setAttribute("minsize","x"===e.label.charAt(0)?"1.75em":"3.0em"),e.body){var a=Xt(Ot(e.body,t));if(e.below){var o=Xt(Ot(e.below,t));n=new It.MathNode("munderover",[r,o,a])}else n=new It.MathNode("mover",[r,a])}else if(e.below){var i=Xt(Ot(e.below,t));n=new It.MathNode("munder",[r,i])}else n=Xt(),n=new It.MathNode("mover",[r,n]);return n}});var Qt=Je.makeSpan;function Jt(e,t){var n=mt(e.body,t,!0);return Qt([e.mclass],n,t)}function Zt(e,t){var n,r=Bt(e.body,t);return"minner"===e.mclass?n=new It.MathNode("mpadded",r):"mord"===e.mclass?e.isCharacterBox?(n=r[0]).type="mi":n=new It.MathNode("mi",r):(e.isCharacterBox?(n=r[0]).type="mo":n=new It.MathNode("mo",r),"mbin"===e.mclass?(n.attributes.lspace="0.22em",n.attributes.rspace="0.22em"):"mpunct"===e.mclass?(n.attributes.lspace="0em",n.attributes.rspace="0.17em"):"mopen"===e.mclass||"mclose"===e.mclass?(n.attributes.lspace="0em",n.attributes.rspace="0em"):"minner"===e.mclass&&(n.attributes.lspace="0.0556em",n.attributes.width="+0.1111em")),n}lt({type:"mclass",names:["\\mathord","\\mathbin","\\mathrel","\\mathopen","\\mathclose","\\mathpunct","\\mathinner"],props:{numArgs:1,primitive:!0},handler(e,t){var{parser:n,funcName:r}=e,a=t[0];return{type:"mclass",mode:n.mode,mclass:"m"+r.slice(5),body:ut(a),isCharacterBox:u.isCharacterBox(a)}},htmlBuilder:Jt,mathmlBuilder:Zt});var en=e=>{var t="ordgroup"===e.type&&e.body.length?e.body[0]:e;return"atom"!==t.type||"bin"!==t.family&&"rel"!==t.family?"mord":"m"+t.family};lt({type:"mclass",names:["\\@binrel"],props:{numArgs:2},handler(e,t){var{parser:n}=e;return{type:"mclass",mode:n.mode,mclass:en(t[0]),body:ut(t[1]),isCharacterBox:u.isCharacterBox(t[1])}}}),lt({type:"mclass",names:["\\stackrel","\\overset","\\underset"],props:{numArgs:2},handler(e,t){var n,{parser:r,funcName:a}=e,o=t[1],i=t[0];n="\\stackrel"!==a?en(o):"mrel";var l={type:"op",mode:o.mode,limits:!0,alwaysHandleSupSub:!0,parentIsSupSub:!1,symbol:!1,suppressBaseShift:"\\stackrel"!==a,body:ut(o)},s={type:"supsub",mode:i.mode,base:l,sup:"\\underset"===a?null:i,sub:"\\underset"===a?i:null};return{type:"mclass",mode:r.mode,mclass:n,body:[s],isCharacterBox:u.isCharacterBox(s)}},htmlBuilder:Jt,mathmlBuilder:Zt}),lt({type:"pmb",names:["\\pmb"],props:{numArgs:1,allowedInText:!0},handler(e,t){var{parser:n}=e;return{type:"pmb",mode:n.mode,mclass:en(t[0]),body:ut(t[0])}},htmlBuilder(e,t){var n=mt(e.body,t,!0),r=Je.makeSpan([e.mclass],n,t);return r.style.textShadow="0.02em 0.01em 0.04px",r},mathmlBuilder(e,t){var n=Bt(e.body,t),r=new It.MathNode("mstyle",n);return r.setAttribute("style","text-shadow: 0.02em 0.01em 0.04px"),r}});var tn={">":"\\\\cdrightarrow","<":"\\\\cdleftarrow","=":"\\\\cdlongequal",A:"\\uparrow",V:"\\downarrow","|":"\\Vert",".":"no arrow"},nn=e=>"textord"===e.type&&"@"===e.text;function rn(e,t,n){var r=tn[e];switch(r){case"\\\\cdrightarrow":case"\\\\cdleftarrow":return n.callFunction(r,[t[0]],[t[1]]);case"\\uparrow":case"\\downarrow":var a={type:"atom",text:r,mode:"math",family:"rel"},o={type:"ordgroup",mode:"math",body:[n.callFunction("\\\\cdleft",[t[0]],[]),n.callFunction("\\Big",[a],[]),n.callFunction("\\\\cdright",[t[1]],[])]};return n.callFunction("\\\\cdparent",[o],[]);case"\\\\cdlongequal":return n.callFunction("\\\\cdlongequal",[],[]);case"\\Vert":return n.callFunction("\\Big",[{type:"textord",text:"\\Vert",mode:"math"}],[]);default:return{type:"textord",text:" ",mode:"math"}}}lt({type:"cdlabel",names:["\\\\cdleft","\\\\cdright"],props:{numArgs:1},handler(e,t){var{parser:n,funcName:r}=e;return{type:"cdlabel",mode:n.mode,side:r.slice(4),label:t[0]}},htmlBuilder(e,t){var n=t.havingStyle(t.style.sup()),r=Je.wrapFragment(St(e.label,n,t),t);return r.classes.push("cd-label-"+e.side),r.style.bottom=U(.8-r.depth),r.height=0,r.depth=0,r},mathmlBuilder(e,t){var n=new It.MathNode("mrow",[Ot(e.label,t)]);return(n=new It.MathNode("mpadded",[n])).setAttribute("width","0"),"left"===e.side&&n.setAttribute("lspace","-1width"),n.setAttribute("voffset","0.7em"),(n=new It.MathNode("mstyle",[n])).setAttribute("displaystyle","false"),n.setAttribute("scriptlevel","1"),n}}),lt({type:"cdlabelparent",names:["\\\\cdparent"],props:{numArgs:1},handler(e,t){var{parser:n}=e;return{type:"cdlabelparent",mode:n.mode,fragment:t[0]}},htmlBuilder(e,t){var n=Je.wrapFragment(St(e.fragment,t),t);return n.classes.push("cd-vert-arrow"),n},mathmlBuilder:(e,t)=>new It.MathNode("mrow",[Ot(e.fragment,t)])}),lt({type:"textord",names:["\\@char"],props:{numArgs:1,allowedInText:!0},handler(e,t){for(var{parser:n}=e,r=Ht(t[0],"ordgroup").body,a="",i=0;i<r.length;i++){a+=Ht(r[i],"textord").text}var l,s=parseInt(a);if(isNaN(s))throw new o("\\@char has non-numeric argument "+a);if(s<0||s>=1114111)throw new o("\\@char with invalid code point "+a);return s<=65535?l=String.fromCharCode(s):(s-=65536,l=String.fromCharCode(55296+(s>>10),56320+(1023&s))),{type:"textord",mode:n.mode,text:l}}});var an=(e,t)=>{var n=mt(e.body,t.withColor(e.color),!1);return Je.makeFragment(n)},on=(e,t)=>{var n=Bt(e.body,t.withColor(e.color)),r=new It.MathNode("mstyle",n);return r.setAttribute("mathcolor",e.color),r};lt({type:"color",names:["\\textcolor"],props:{numArgs:2,allowedInText:!0,argTypes:["color","original"]},handler(e,t){var{parser:n}=e,r=Ht(t[0],"color-token").color,a=t[1];return{type:"color",mode:n.mode,color:r,body:ut(a)}},htmlBuilder:an,mathmlBuilder:on}),lt({type:"color",names:["\\color"],props:{numArgs:1,allowedInText:!0,argTypes:["color"]},handler(e,t){var{parser:n,breakOnTokenText:r}=e,a=Ht(t[0],"color-token").color;n.gullet.macros.set("\\current@color",a);var o=n.parseExpression(!0,r);return{type:"color",mode:n.mode,color:a,body:o}},htmlBuilder:an,mathmlBuilder:on}),lt({type:"cr",names:["\\\\"],props:{numArgs:0,numOptionalArgs:0,allowedInText:!0},handler(e,t,n){var{parser:r}=e,a="["===r.gullet.future().text?r.parseSizeGroup(!0):null,o=!r.settings.displayMode||!r.settings.useStrictBehavior("newLineInDisplayMode","In LaTeX, \\\\ or \\newline does nothing in display mode");return{type:"cr",mode:r.mode,newLine:o,size:a&&Ht(a,"size").value}},htmlBuilder(e,t){var n=Je.makeSpan(["mspace"],[],t);return e.newLine&&(n.classes.push("newline"),e.size&&(n.style.marginTop=U(q(e.size,t)))),n},mathmlBuilder(e,t){var n=new It.MathNode("mspace");return e.newLine&&(n.setAttribute("linebreak","newline"),e.size&&n.setAttribute("height",U(q(e.size,t)))),n}});var ln={"\\global":"\\global","\\long":"\\\\globallong","\\\\globallong":"\\\\globallong","\\def":"\\gdef","\\gdef":"\\gdef","\\edef":"\\xdef","\\xdef":"\\xdef","\\let":"\\\\globallet","\\futurelet":"\\\\globalfuture"},sn=e=>{var t=e.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(t))throw new o("Expected a control sequence",e);return t},cn=(e,t,n,r)=>{var a=e.gullet.macros.get(n.text);null==a&&(n.noexpand=!0,a={tokens:[n],numArgs:0,unexpandable:!e.gullet.isExpandable(n.text)}),e.gullet.macros.set(t,a,r)};lt({type:"internal",names:["\\global","\\long","\\\\globallong"],props:{numArgs:0,allowedInText:!0},handler(e){var{parser:t,funcName:n}=e;t.consumeSpaces();var r=t.fetch();if(ln[r.text])return"\\global"!==n&&"\\\\globallong"!==n||(r.text=ln[r.text]),Ht(t.parseFunction(),"internal");throw new o("Invalid token after macro prefix",r)}}),lt({type:"internal",names:["\\def","\\gdef","\\edef","\\xdef"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(e){var{parser:t,funcName:n}=e,r=t.gullet.popToken(),a=r.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(a))throw new o("Expected a control sequence",r);for(var i,l=0,s=[[]];"{"!==t.gullet.future().text;)if("#"===(r=t.gullet.popToken()).text){if("{"===t.gullet.future().text){i=t.gullet.future(),s[l].push("{");break}if(r=t.gullet.popToken(),!/^[1-9]$/.test(r.text))throw new o('Invalid argument number "'+r.text+'"');if(parseInt(r.text)!==l+1)throw new o('Argument number "'+r.text+'" out of order');l++,s.push([])}else{if("EOF"===r.text)throw new o("Expected a macro definition");s[l].push(r.text)}var{tokens:c}=t.gullet.consumeArg();return i&&c.unshift(i),"\\edef"!==n&&"\\xdef"!==n||(c=t.gullet.expandTokens(c)).reverse(),t.gullet.macros.set(a,{tokens:c,numArgs:l,delimiters:s},n===ln[n]),{type:"internal",mode:t.mode}}}),lt({type:"internal",names:["\\let","\\\\globallet"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(e){var{parser:t,funcName:n}=e,r=sn(t.gullet.popToken());t.gullet.consumeSpaces();var a=(e=>{var t=e.gullet.popToken();return"="===t.text&&" "===(t=e.gullet.popToken()).text&&(t=e.gullet.popToken()),t})(t);return cn(t,r,a,"\\\\globallet"===n),{type:"internal",mode:t.mode}}}),lt({type:"internal",names:["\\futurelet","\\\\globalfuture"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(e){var{parser:t,funcName:n}=e,r=sn(t.gullet.popToken()),a=t.gullet.popToken(),o=t.gullet.popToken();return cn(t,r,o,"\\\\globalfuture"===n),t.gullet.pushToken(o),t.gullet.pushToken(a),{type:"internal",mode:t.mode}}});var un=function(e,t,n){var r=j(oe.math[e]&&oe.math[e].replace||e,t,n);if(!r)throw new Error("Unsupported symbol "+e+" and font size "+t+".");return r},dn=function(e,t,n,r){var a=n.havingBaseStyle(t),o=Je.makeSpan(r.concat(a.sizingClasses(n)),[e],n),i=a.sizeMultiplier/n.sizeMultiplier;return o.height*=i,o.depth*=i,o.maxFontSize=a.sizeMultiplier,o},pn=function(e,t,n){var r=t.havingBaseStyle(n),a=(1-t.sizeMultiplier/r.sizeMultiplier)*t.fontMetrics().axisHeight;e.classes.push("delimcenter"),e.style.top=U(a),e.height-=a,e.depth+=a},fn=function(e,t,n,r,a,o){var i=function(e,t,n,r){return Je.makeSymbol(e,"Size"+t+"-Regular",n,r)}(e,t,a,r),l=dn(Je.makeSpan(["delimsizing","size"+t],[i],r),S.TEXT,r,o);return n&&pn(l,r,S.TEXT),l},hn=function(e,t,n){var r;return r="Size1-Regular"===t?"delim-size1":"delim-size4",{type:"elem",elem:Je.makeSpan(["delimsizinginner",r],[Je.makeSpan([],[Je.makeSymbol(e,t,n)])])}},gn=function(e,t,n){var r=z["Size4-Regular"][e.charCodeAt(0)]?z["Size4-Regular"][e.charCodeAt(0)][4]:z["Size1-Regular"][e.charCodeAt(0)][4],a=new ee("inner",function(e,t){switch(e){case"\u239c":return"M291 0 H417 V"+t+" H291z M291 0 H417 V"+t+" H291z";case"\u2223":return"M145 0 H188 V"+t+" H145z M145 0 H188 V"+t+" H145z";case"\u2225":return"M145 0 H188 V"+t+" H145z M145 0 H188 V"+t+" H145zM367 0 H410 V"+t+" H367z M367 0 H410 V"+t+" H367z";case"\u239f":return"M457 0 H583 V"+t+" H457z M457 0 H583 V"+t+" H457z";case"\u23a2":return"M319 0 H403 V"+t+" H319z M319 0 H403 V"+t+" H319z";case"\u23a5":return"M263 0 H347 V"+t+" H263z M263 0 H347 V"+t+" H263z";case"\u23aa":return"M384 0 H504 V"+t+" H384z M384 0 H504 V"+t+" H384z";case"\u23d0":return"M312 0 H355 V"+t+" H312z M312 0 H355 V"+t+" H312z";case"\u2016":return"M257 0 H300 V"+t+" H257z M257 0 H300 V"+t+" H257zM478 0 H521 V"+t+" H478z M478 0 H521 V"+t+" H478z";default:return""}}(e,Math.round(1e3*t))),o=new Z([a],{width:U(r),height:U(t),style:"width:"+U(r),viewBox:"0 0 "+1e3*r+" "+Math.round(1e3*t),preserveAspectRatio:"xMinYMin"}),i=Je.makeSvgSpan([],[o],n);return i.height=t,i.style.height=U(t),i.style.width=U(r),{type:"elem",elem:i}},mn={type:"kern",size:-.008},vn=["|","\\lvert","\\rvert","\\vert"],yn=["\\|","\\lVert","\\rVert","\\Vert"],bn=function(e,t,n,r,a,o){var i,l,s,c,d="",p=0;i=s=c=e,l=null;var f="Size1-Regular";"\\uparrow"===e?s=c="\u23d0":"\\Uparrow"===e?s=c="\u2016":"\\downarrow"===e?i=s="\u23d0":"\\Downarrow"===e?i=s="\u2016":"\\updownarrow"===e?(i="\\uparrow",s="\u23d0",c="\\downarrow"):"\\Updownarrow"===e?(i="\\Uparrow",s="\u2016",c="\\Downarrow"):u.contains(vn,e)?(s="\u2223",d="vert",p=333):u.contains(yn,e)?(s="\u2225",d="doublevert",p=556):"["===e||"\\lbrack"===e?(i="\u23a1",s="\u23a2",c="\u23a3",f="Size4-Regular",d="lbrack",p=667):"]"===e||"\\rbrack"===e?(i="\u23a4",s="\u23a5",c="\u23a6",f="Size4-Regular",d="rbrack",p=667):"\\lfloor"===e||"\u230a"===e?(s=i="\u23a2",c="\u23a3",f="Size4-Regular",d="lfloor",p=667):"\\lceil"===e||"\u2308"===e?(i="\u23a1",s=c="\u23a2",f="Size4-Regular",d="lceil",p=667):"\\rfloor"===e||"\u230b"===e?(s=i="\u23a5",c="\u23a6",f="Size4-Regular",d="rfloor",p=667):"\\rceil"===e||"\u2309"===e?(i="\u23a4",s=c="\u23a5",f="Size4-Regular",d="rceil",p=667):"("===e||"\\lparen"===e?(i="\u239b",s="\u239c",c="\u239d",f="Size4-Regular",d="lparen",p=875):")"===e||"\\rparen"===e?(i="\u239e",s="\u239f",c="\u23a0",f="Size4-Regular",d="rparen",p=875):"\\{"===e||"\\lbrace"===e?(i="\u23a7",l="\u23a8",c="\u23a9",s="\u23aa",f="Size4-Regular"):"\\}"===e||"\\rbrace"===e?(i="\u23ab",l="\u23ac",c="\u23ad",s="\u23aa",f="Size4-Regular"):"\\lgroup"===e||"\u27ee"===e?(i="\u23a7",c="\u23a9",s="\u23aa",f="Size4-Regular"):"\\rgroup"===e||"\u27ef"===e?(i="\u23ab",c="\u23ad",s="\u23aa",f="Size4-Regular"):"\\lmoustache"===e||"\u23b0"===e?(i="\u23a7",c="\u23ad",s="\u23aa",f="Size4-Regular"):"\\rmoustache"!==e&&"\u23b1"!==e||(i="\u23ab",c="\u23a9",s="\u23aa",f="Size4-Regular");var h=un(i,f,a),g=h.height+h.depth,m=un(s,f,a),v=m.height+m.depth,y=un(c,f,a),b=y.height+y.depth,x=0,w=1;if(null!==l){var k=un(l,f,a);x=k.height+k.depth,w=2}var C=g+b+x,E=C+Math.max(0,Math.ceil((t-C)/(w*v)))*w*v,A=r.fontMetrics().axisHeight;n&&(A*=r.sizeMultiplier);var T=E/2-A,I=[];if(d.length>0){var z=E-g-b,F=Math.round(1e3*E),M=function(e,t){switch(e){case"lbrack":return"M403 1759 V84 H666 V0 H319 V1759 v"+t+" v1759 h347 v-84\nH403z M403 1759 V0 H319 V1759 v"+t+" v1759 h84z";case"rbrack":return"M347 1759 V0 H0 V84 H263 V1759 v"+t+" v1759 H0 v84 H347z\nM347 1759 V0 H263 V1759 v"+t+" v1759 h84z";case"vert":return"M145 15 v585 v"+t+" v585 c2.667,10,9.667,15,21,15\nc10,0,16.667,-5,20,-15 v-585 v"+-t+" v-585 c-2.667,-10,-9.667,-15,-21,-15\nc-10,0,-16.667,5,-20,15z M188 15 H145 v585 v"+t+" v585 h43z";case"doublevert":return"M145 15 v585 v"+t+" v585 c2.667,10,9.667,15,21,15\nc10,0,16.667,-5,20,-15 v-585 v"+-t+" v-585 c-2.667,-10,-9.667,-15,-21,-15\nc-10,0,-16.667,5,-20,15z M188 15 H145 v585 v"+t+" v585 h43z\nM367 15 v585 v"+t+" v585 c2.667,10,9.667,15,21,15\nc10,0,16.667,-5,20,-15 v-585 v"+-t+" v-585 c-2.667,-10,-9.667,-15,-21,-15\nc-10,0,-16.667,5,-20,15z M410 15 H367 v585 v"+t+" v585 h43z";case"lfloor":return"M319 602 V0 H403 V602 v"+t+" v1715 h263 v84 H319z\nMM319 602 V0 H403 V602 v"+t+" v1715 H319z";case"rfloor":return"M319 602 V0 H403 V602 v"+t+" v1799 H0 v-84 H319z\nMM319 602 V0 H403 V602 v"+t+" v1715 H319z";case"lceil":return"M403 1759 V84 H666 V0 H319 V1759 v"+t+" v602 h84z\nM403 1759 V0 H319 V1759 v"+t+" v602 h84z";case"rceil":return"M347 1759 V0 H0 V84 H263 V1759 v"+t+" v602 h84z\nM347 1759 V0 h-84 V1759 v"+t+" v602 h84z";case"lparen":return"M863,9c0,-2,-2,-5,-6,-9c0,0,-17,0,-17,0c-12.7,0,-19.3,0.3,-20,1\nc-5.3,5.3,-10.3,11,-15,17c-242.7,294.7,-395.3,682,-458,1162c-21.3,163.3,-33.3,349,\n-36,557 l0,"+(t+84)+"c0.2,6,0,26,0,60c2,159.3,10,310.7,24,454c53.3,528,210,\n949.7,470,1265c4.7,6,9.7,11.7,15,17c0.7,0.7,7,1,19,1c0,0,18,0,18,0c4,-4,6,-7,6,-9\nc0,-2.7,-3.3,-8.7,-10,-18c-135.3,-192.7,-235.5,-414.3,-300.5,-665c-65,-250.7,-102.5,\n-544.7,-112.5,-882c-2,-104,-3,-167,-3,-189\nl0,-"+(t+92)+"c0,-162.7,5.7,-314,17,-454c20.7,-272,63.7,-513,129,-723c65.3,\n-210,155.3,-396.3,270,-559c6.7,-9.3,10,-15.3,10,-18z";case"rparen":return"M76,0c-16.7,0,-25,3,-25,9c0,2,2,6.3,6,13c21.3,28.7,42.3,60.3,\n63,95c96.7,156.7,172.8,332.5,228.5,527.5c55.7,195,92.8,416.5,111.5,664.5\nc11.3,139.3,17,290.7,17,454c0,28,1.7,43,3.3,45l0,"+(t+9)+"\nc-3,4,-3.3,16.7,-3.3,38c0,162,-5.7,313.7,-17,455c-18.7,248,-55.8,469.3,-111.5,664\nc-55.7,194.7,-131.8,370.3,-228.5,527c-20.7,34.7,-41.7,66.3,-63,95c-2,3.3,-4,7,-6,11\nc0,7.3,5.7,11,17,11c0,0,11,0,11,0c9.3,0,14.3,-0.3,15,-1c5.3,-5.3,10.3,-11,15,-17\nc242.7,-294.7,395.3,-681.7,458,-1161c21.3,-164.7,33.3,-350.7,36,-558\nl0,-"+(t+144)+"c-2,-159.3,-10,-310.7,-24,-454c-53.3,-528,-210,-949.7,\n-470,-1265c-4.7,-6,-9.7,-11.7,-15,-17c-0.7,-0.7,-6.7,-1,-18,-1z";default:throw new Error("Unknown stretchy delimiter.")}}(d,Math.round(1e3*z)),j=new ee(d,M),B=(p/1e3).toFixed(3)+"em",R=(F/1e3).toFixed(3)+"em",O=new Z([j],{width:B,height:R,viewBox:"0 0 "+p+" "+F}),L=Je.makeSvgSpan([],[O],r);L.height=F/1e3,L.style.width=B,L.style.height=R,I.push({type:"elem",elem:L})}else{if(I.push(hn(c,f,a)),I.push(mn),null===l){var N=E-g-b+.016;I.push(gn(s,N,r))}else{var P=(E-g-b-x)/2+.016;I.push(gn(s,P,r)),I.push(mn),I.push(hn(l,f,a)),I.push(mn),I.push(gn(s,P,r))}I.push(mn),I.push(hn(i,f,a))}var _=r.havingBaseStyle(S.TEXT),D=Je.makeVList({positionType:"bottom",positionData:T,children:I},_);return dn(Je.makeSpan(["delimsizing","mult"],[D],_),S.TEXT,r,o)},xn=.08,wn=function(e,t,n,r,a){var o=function(e,t,n){t*=1e3;var r="";switch(e){case"sqrtMain":r=function(e,t){return"M95,"+(622+e+t)+"\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl"+e/2.075+" -"+e+"\nc5.3,-9.3,12,-14,20,-14\nH400000v"+(40+e)+"H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM"+(834+e)+" "+t+"h400000v"+(40+e)+"h-400000z"}(t,A);break;case"sqrtSize1":r=function(e,t){return"M263,"+(601+e+t)+"c0.7,0,18,39.7,52,119\nc34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120\nc340,-704.7,510.7,-1060.3,512,-1067\nl"+e/2.084+" -"+e+"\nc4.7,-7.3,11,-11,19,-11\nH40000v"+(40+e)+"H1012.3\ns-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232\nc-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1\ns-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26\nc-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z\nM"+(1001+e)+" "+t+"h400000v"+(40+e)+"h-400000z"}(t,A);break;case"sqrtSize2":r=function(e,t){return"M983 "+(10+e+t)+"\nl"+e/3.13+" -"+e+"\nc4,-6.7,10,-10,18,-10 H400000v"+(40+e)+"\nH1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7\ns-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744\nc-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30\nc26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722\nc56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5\nc53.7,-170.3,84.5,-266.8,92.5,-289.5z\nM"+(1001+e)+" "+t+"h400000v"+(40+e)+"h-400000z"}(t,A);break;case"sqrtSize3":r=function(e,t){return"M424,"+(2398+e+t)+"\nc-1.3,-0.7,-38.5,-172,-111.5,-514c-73,-342,-109.8,-513.3,-110.5,-514\nc0,-2,-10.7,14.3,-32,49c-4.7,7.3,-9.8,15.7,-15.5,25c-5.7,9.3,-9.8,16,-12.5,20\ns-5,7,-5,7c-4,-3.3,-8.3,-7.7,-13,-13s-13,-13,-13,-13s76,-122,76,-122s77,-121,77,-121\ns209,968,209,968c0,-2,84.7,-361.7,254,-1079c169.3,-717.3,254.7,-1077.7,256,-1081\nl"+e/4.223+" -"+e+"c4,-6.7,10,-10,18,-10 H400000\nv"+(40+e)+"H1014.6\ns-87.3,378.7,-272.6,1166c-185.3,787.3,-279.3,1182.3,-282,1185\nc-2,6,-10,9,-24,9\nc-8,0,-12,-0.7,-12,-2z M"+(1001+e)+" "+t+"\nh400000v"+(40+e)+"h-400000z"}(t,A);break;case"sqrtSize4":r=function(e,t){return"M473,"+(2713+e+t)+"\nc339.3,-1799.3,509.3,-2700,510,-2702 l"+e/5.298+" -"+e+"\nc3.3,-7.3,9.3,-11,18,-11 H400000v"+(40+e)+"H1017.7\ns-90.5,478,-276.2,1466c-185.7,988,-279.5,1483,-281.5,1485c-2,6,-10,9,-24,9\nc-8,0,-12,-0.7,-12,-2c0,-1.3,-5.3,-32,-16,-92c-50.7,-293.3,-119.7,-693.3,-207,-1200\nc0,-1.3,-5.3,8.7,-16,30c-10.7,21.3,-21.3,42.7,-32,64s-16,33,-16,33s-26,-26,-26,-26\ns76,-153,76,-153s77,-151,77,-151c0.7,0.7,35.7,202,105,604c67.3,400.7,102,602.7,104,\n606zM"+(1001+e)+" "+t+"h400000v"+(40+e)+"H1017.7z"}(t,A);break;case"sqrtTall":r=function(e,t,n){return"M702 "+(e+t)+"H400000"+(40+e)+"\nH742v"+(n-54-t-e)+"l-4 4-4 4c-.667.7 -2 1.5-4 2.5s-4.167 1.833-6.5 2.5-5.5 1-9.5 1\nh-12l-28-84c-16.667-52-96.667 -294.333-240-727l-212 -643 -85 170\nc-4-3.333-8.333-7.667-13 -13l-13-13l77-155 77-156c66 199.333 139 419.667\n219 661 l218 661zM702 "+t+"H400000v"+(40+e)+"H742z"}(t,A,n)}return r}(e,r,n),i=new ee(e,o),l=new Z([i],{width:"400em",height:U(t),viewBox:"0 0 400000 "+n,preserveAspectRatio:"xMinYMin slice"});return Je.makeSvgSpan(["hide-tail"],[l],a)},Sn=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","\u230a","\u230b","\\lceil","\\rceil","\u2308","\u2309","\\surd"],kn=["\\uparrow","\\downarrow","\\updownarrow","\\Uparrow","\\Downarrow","\\Updownarrow","|","\\|","\\vert","\\Vert","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","\u27ee","\u27ef","\\lmoustache","\\rmoustache","\u23b0","\u23b1"],Cn=["<",">","\\langle","\\rangle","/","\\backslash","\\lt","\\gt"],En=[0,1.2,1.8,2.4,3],An=[{type:"small",style:S.SCRIPTSCRIPT},{type:"small",style:S.SCRIPT},{type:"small",style:S.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4}],Tn=[{type:"small",style:S.SCRIPTSCRIPT},{type:"small",style:S.SCRIPT},{type:"small",style:S.TEXT},{type:"stack"}],In=[{type:"small",style:S.SCRIPTSCRIPT},{type:"small",style:S.SCRIPT},{type:"small",style:S.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4},{type:"stack"}],zn=function(e){if("small"===e.type)return"Main-Regular";if("large"===e.type)return"Size"+e.size+"-Regular";if("stack"===e.type)return"Size4-Regular";throw new Error("Add support for delim type '"+e.type+"' here.")},Fn=function(e,t,n,r){for(var a=Math.min(2,3-r.style.size);a<n.length&&"stack"!==n[a].type;a++){var o=un(e,zn(n[a]),"math"),i=o.height+o.depth;if("small"===n[a].type&&(i*=r.havingBaseStyle(n[a].style).sizeMultiplier),i>t)return n[a]}return n[n.length-1]},Mn=function(e,t,n,r,a,o){var i;"<"===e||"\\lt"===e||"\u27e8"===e?e="\\langle":">"!==e&&"\\gt"!==e&&"\u27e9"!==e||(e="\\rangle"),i=u.contains(Cn,e)?An:u.contains(Sn,e)?In:Tn;var l=Fn(e,t,i,r);return"small"===l.type?function(e,t,n,r,a,o){var i=Je.makeSymbol(e,"Main-Regular",a,r),l=dn(i,t,r,o);return n&&pn(l,r,t),l}(e,l.style,n,r,a,o):"large"===l.type?fn(e,l.size,n,r,a,o):bn(e,t,n,r,a,o)},jn={sqrtImage:function(e,t){var n,r,a=t.havingBaseSizing(),o=Fn("\\surd",e*a.sizeMultiplier,In,a),i=a.sizeMultiplier,l=Math.max(0,t.minRuleThickness-t.fontMetrics().sqrtRuleThickness),s=0,c=0,u=0;return"small"===o.type?(e<1?i=1:e<1.4&&(i=.7),c=(1+l)/i,(n=wn("sqrtMain",s=(1+l+xn)/i,u=1e3+1e3*l+80,l,t)).style.minWidth="0.853em",r=.833/i):"large"===o.type?(u=1080*En[o.size],c=(En[o.size]+l)/i,s=(En[o.size]+l+xn)/i,(n=wn("sqrtSize"+o.size,s,u,l,t)).style.minWidth="1.02em",r=1/i):(s=e+l+xn,c=e+l,u=Math.floor(1e3*e+l)+80,(n=wn("sqrtTall",s,u,l,t)).style.minWidth="0.742em",r=1.056),n.height=c,n.style.height=U(s),{span:n,advanceWidth:r,ruleWidth:(t.fontMetrics().sqrtRuleThickness+l)*i}},sizedDelim:function(e,t,n,r,a){if("<"===e||"\\lt"===e||"\u27e8"===e?e="\\langle":">"!==e&&"\\gt"!==e&&"\u27e9"!==e||(e="\\rangle"),u.contains(Sn,e)||u.contains(Cn,e))return fn(e,t,!1,n,r,a);if(u.contains(kn,e))return bn(e,En[t],!1,n,r,a);throw new o("Illegal delimiter: '"+e+"'")},sizeToMaxHeight:En,customSizedDelim:Mn,leftRightDelim:function(e,t,n,r,a,o){var i=r.fontMetrics().axisHeight*r.sizeMultiplier,l=5/r.fontMetrics().ptPerEm,s=Math.max(t-i,n+i),c=Math.max(s/500*901,2*s-l);return Mn(e,c,!0,r,a,o)}},Bn={"\\bigl":{mclass:"mopen",size:1},"\\Bigl":{mclass:"mopen",size:2},"\\biggl":{mclass:"mopen",size:3},"\\Biggl":{mclass:"mopen",size:4},"\\bigr":{mclass:"mclose",size:1},"\\Bigr":{mclass:"mclose",size:2},"\\biggr":{mclass:"mclose",size:3},"\\Biggr":{mclass:"mclose",size:4},"\\bigm":{mclass:"mrel",size:1},"\\Bigm":{mclass:"mrel",size:2},"\\biggm":{mclass:"mrel",size:3},"\\Biggm":{mclass:"mrel",size:4},"\\big":{mclass:"mord",size:1},"\\Big":{mclass:"mord",size:2},"\\bigg":{mclass:"mord",size:3},"\\Bigg":{mclass:"mord",size:4}},Rn=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","\u230a","\u230b","\\lceil","\\rceil","\u2308","\u2309","<",">","\\langle","\u27e8","\\rangle","\u27e9","\\lt","\\gt","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","\u27ee","\u27ef","\\lmoustache","\\rmoustache","\u23b0","\u23b1","/","\\backslash","|","\\vert","\\|","\\Vert","\\uparrow","\\Uparrow","\\downarrow","\\Downarrow","\\updownarrow","\\Updownarrow","."];function On(e,t){var n=Gt(e);if(n&&u.contains(Rn,n.text))return n;throw new o(n?"Invalid delimiter '"+n.text+"' after '"+t.funcName+"'":"Invalid delimiter type '"+e.type+"'",e)}function Ln(e){if(!e.body)throw new Error("Bug: The leftright ParseNode wasn't fully parsed.")}lt({type:"delimsizing",names:["\\bigl","\\Bigl","\\biggl","\\Biggl","\\bigr","\\Bigr","\\biggr","\\Biggr","\\bigm","\\Bigm","\\biggm","\\Biggm","\\big","\\Big","\\bigg","\\Bigg"],props:{numArgs:1,argTypes:["primitive"]},handler:(e,t)=>{var n=On(t[0],e);return{type:"delimsizing",mode:e.parser.mode,size:Bn[e.funcName].size,mclass:Bn[e.funcName].mclass,delim:n.text}},htmlBuilder:(e,t)=>"."===e.delim?Je.makeSpan([e.mclass]):jn.sizedDelim(e.delim,e.size,t,e.mode,[e.mclass]),mathmlBuilder:e=>{var t=[];"."!==e.delim&&t.push(zt(e.delim,e.mode));var n=new It.MathNode("mo",t);"mopen"===e.mclass||"mclose"===e.mclass?n.setAttribute("fence","true"):n.setAttribute("fence","false"),n.setAttribute("stretchy","true");var r=U(jn.sizeToMaxHeight[e.size]);return n.setAttribute("minsize",r),n.setAttribute("maxsize",r),n}}),lt({type:"leftright-right",names:["\\right"],props:{numArgs:1,primitive:!0},handler:(e,t)=>{var n=e.parser.gullet.macros.get("\\current@color");if(n&&"string"!=typeof n)throw new o("\\current@color set to non-string in \\right");return{type:"leftright-right",mode:e.parser.mode,delim:On(t[0],e).text,color:n}}}),lt({type:"leftright",names:["\\left"],props:{numArgs:1,primitive:!0},handler:(e,t)=>{var n=On(t[0],e),r=e.parser;++r.leftrightDepth;var a=r.parseExpression(!1);--r.leftrightDepth,r.expect("\\right",!1);var o=Ht(r.parseFunction(),"leftright-right");return{type:"leftright",mode:r.mode,body:a,left:n.text,right:o.delim,rightColor:o.color}},htmlBuilder:(e,t)=>{Ln(e);for(var n,r,a=mt(e.body,t,!0,["mopen","mclose"]),o=0,i=0,l=!1,s=0;s<a.length;s++)a[s].isMiddle?l=!0:(o=Math.max(a[s].height,o),i=Math.max(a[s].depth,i));if(o*=t.sizeMultiplier,i*=t.sizeMultiplier,n="."===e.left?wt(t,["mopen"]):jn.leftRightDelim(e.left,o,i,t,e.mode,["mopen"]),a.unshift(n),l)for(var c=1;c<a.length;c++){var u=a[c].isMiddle;u&&(a[c]=jn.leftRightDelim(u.delim,o,i,u.options,e.mode,[]))}if("."===e.right)r=wt(t,["mclose"]);else{var d=e.rightColor?t.withColor(e.rightColor):t;r=jn.leftRightDelim(e.right,o,i,d,e.mode,["mclose"])}return a.push(r),Je.makeSpan(["minner"],a,t)},mathmlBuilder:(e,t)=>{Ln(e);var n=Bt(e.body,t);if("."!==e.left){var r=new It.MathNode("mo",[zt(e.left,e.mode)]);r.setAttribute("fence","true"),n.unshift(r)}if("."!==e.right){var a=new It.MathNode("mo",[zt(e.right,e.mode)]);a.setAttribute("fence","true"),e.rightColor&&a.setAttribute("mathcolor",e.rightColor),n.push(a)}return Ft(n)}}),lt({type:"middle",names:["\\middle"],props:{numArgs:1,primitive:!0},handler:(e,t)=>{var n=On(t[0],e);if(!e.parser.leftrightDepth)throw new o("\\middle without preceding \\left",n);return{type:"middle",mode:e.parser.mode,delim:n.text}},htmlBuilder:(e,t)=>{var n;if("."===e.delim)n=wt(t,[]);else{n=jn.sizedDelim(e.delim,1,t,e.mode,[]);var r={delim:e.delim,options:t};n.isMiddle=r}return n},mathmlBuilder:(e,t)=>{var n="\\vert"===e.delim||"|"===e.delim?zt("|","text"):zt(e.delim,e.mode),r=new It.MathNode("mo",[n]);return r.setAttribute("fence","true"),r.setAttribute("lspace","0.05em"),r.setAttribute("rspace","0.05em"),r}});var Nn=(e,t)=>{var n,r,a,o=Je.wrapFragment(St(e.body,t),t),i=e.label.slice(1),l=t.sizeMultiplier,s=0,c=u.isCharacterBox(e.body);if("sout"===i)(n=Je.makeSpan(["stretchy","sout"])).height=t.fontMetrics().defaultRuleThickness/l,s=-.5*t.fontMetrics().xHeight;else if("phase"===i){var d=q({number:.6,unit:"pt"},t),p=q({number:.35,unit:"ex"},t);l/=t.havingBaseSizing().sizeMultiplier;var f=o.height+o.depth+d+p;o.style.paddingLeft=U(f/2+d);var h=Math.floor(1e3*f*l),g="M400000 "+(r=h)+" H0 L"+r/2+" 0 l65 45 L145 "+(r-80)+" H400000z",m=new Z([new ee("phase",g)],{width:"400em",height:U(h/1e3),viewBox:"0 0 400000 "+h,preserveAspectRatio:"xMinYMin slice"});(n=Je.makeSvgSpan(["hide-tail"],[m],t)).style.height=U(f),s=o.depth+d+p}else{/cancel/.test(i)?c||o.classes.push("cancel-pad"):"angl"===i?o.classes.push("anglpad"):o.classes.push("boxpad");var v=0,y=0,b=0;/box/.test(i)?(b=Math.max(t.fontMetrics().fboxrule,t.minRuleThickness),y=v=t.fontMetrics().fboxsep+("colorbox"===i?0:b)):"angl"===i?(v=4*(b=Math.max(t.fontMetrics().defaultRuleThickness,t.minRuleThickness)),y=Math.max(0,.25-o.depth)):y=v=c?.2:0,n=qt(o,i,v,y,t),/fbox|boxed|fcolorbox/.test(i)?(n.style.borderStyle="solid",n.style.borderWidth=U(b)):"angl"===i&&.049!==b&&(n.style.borderTopWidth=U(b),n.style.borderRightWidth=U(b)),s=o.depth+y,e.backgroundColor&&(n.style.backgroundColor=e.backgroundColor,e.borderColor&&(n.style.borderColor=e.borderColor))}if(e.backgroundColor)a=Je.makeVList({positionType:"individualShift",children:[{type:"elem",elem:n,shift:s},{type:"elem",elem:o,shift:0}]},t);else{var x=/cancel|phase/.test(i)?["svg-align"]:[];a=Je.makeVList({positionType:"individualShift",children:[{type:"elem",elem:o,shift:0},{type:"elem",elem:n,shift:s,wrapperClasses:x}]},t)}return/cancel/.test(i)&&(a.height=o.height,a.depth=o.depth),/cancel/.test(i)&&!c?Je.makeSpan(["mord","cancel-lap"],[a],t):Je.makeSpan(["mord"],[a],t)},Pn=(e,t)=>{var n=0,r=new It.MathNode(e.label.indexOf("colorbox")>-1?"mpadded":"menclose",[Ot(e.body,t)]);switch(e.label){case"\\cancel":r.setAttribute("notation","updiagonalstrike");break;case"\\bcancel":r.setAttribute("notation","downdiagonalstrike");break;case"\\phase":r.setAttribute("notation","phasorangle");break;case"\\sout":r.setAttribute("notation","horizontalstrike");break;case"\\fbox":r.setAttribute("notation","box");break;case"\\angl":r.setAttribute("notation","actuarial");break;case"\\fcolorbox":case"\\colorbox":if(n=t.fontMetrics().fboxsep*t.fontMetrics().ptPerEm,r.setAttribute("width","+"+2*n+"pt"),r.setAttribute("height","+"+2*n+"pt"),r.setAttribute("lspace",n+"pt"),r.setAttribute("voffset",n+"pt"),"\\fcolorbox"===e.label){var a=Math.max(t.fontMetrics().fboxrule,t.minRuleThickness);r.setAttribute("style","border: "+a+"em solid "+String(e.borderColor))}break;case"\\xcancel":r.setAttribute("notation","updiagonalstrike downdiagonalstrike")}return e.backgroundColor&&r.setAttribute("mathbackground",e.backgroundColor),r};lt({type:"enclose",names:["\\colorbox"],props:{numArgs:2,allowedInText:!0,argTypes:["color","text"]},handler(e,t,n){var{parser:r,funcName:a}=e,o=Ht(t[0],"color-token").color,i=t[1];return{type:"enclose",mode:r.mode,label:a,backgroundColor:o,body:i}},htmlBuilder:Nn,mathmlBuilder:Pn}),lt({type:"enclose",names:["\\fcolorbox"],props:{numArgs:3,allowedInText:!0,argTypes:["color","color","text"]},handler(e,t,n){var{parser:r,funcName:a}=e,o=Ht(t[0],"color-token").color,i=Ht(t[1],"color-token").color,l=t[2];return{type:"enclose",mode:r.mode,label:a,backgroundColor:i,borderColor:o,body:l}},htmlBuilder:Nn,mathmlBuilder:Pn}),lt({type:"enclose",names:["\\fbox"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!0},handler(e,t){var{parser:n}=e;return{type:"enclose",mode:n.mode,label:"\\fbox",body:t[0]}}}),lt({type:"enclose",names:["\\cancel","\\bcancel","\\xcancel","\\sout","\\phase"],props:{numArgs:1},handler(e,t){var{parser:n,funcName:r}=e,a=t[0];return{type:"enclose",mode:n.mode,label:r,body:a}},htmlBuilder:Nn,mathmlBuilder:Pn}),lt({type:"enclose",names:["\\angl"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!1},handler(e,t){var{parser:n}=e;return{type:"enclose",mode:n.mode,label:"\\angl",body:t[0]}}});var _n={};function Dn(e){for(var{type:t,names:n,props:r,handler:a,htmlBuilder:o,mathmlBuilder:i}=e,l={type:t,numArgs:r.numArgs||0,allowedInText:!1,numOptionalArgs:0,handler:a},s=0;s<n.length;++s)_n[n[s]]=l;o&&(ot[t]=o),i&&(it[t]=i)}var qn={};function Un(e,t){qn[e]=t}function $n(e){var t=[];e.consumeSpaces();var n=e.fetch().text;for("\\relax"===n&&(e.consume(),e.consumeSpaces(),n=e.fetch().text);"\\hline"===n||"\\hdashline"===n;)e.consume(),t.push("\\hdashline"===n),e.consumeSpaces(),n=e.fetch().text;return t}var Hn=e=>{if(!e.parser.settings.displayMode)throw new o("{"+e.envName+"} can be used only in display mode.")};function Vn(e){if(-1===e.indexOf("ed"))return-1===e.indexOf("*")}function Gn(e,t,n){var{hskipBeforeAndAfter:r,addJot:i,cols:l,arraystretch:s,colSeparationType:c,autoTag:u,singleRow:d,emptySingleRow:p,maxNumCols:f,leqno:h}=t;if(e.gullet.beginGroup(),d||e.gullet.macros.set("\\cr","\\\\\\relax"),!s){var g=e.gullet.expandMacroAsText("\\arraystretch");if(null==g)s=1;else if(!(s=parseFloat(g))||s<0)throw new o("Invalid \\arraystretch: "+g)}e.gullet.beginGroup();var m=[],v=[m],y=[],b=[],x=null!=u?[]:void 0;function w(){u&&e.gullet.macros.set("\\@eqnsw","1",!0)}function S(){x&&(e.gullet.macros.get("\\df@tag")?(x.push(e.subparse([new a("\\df@tag")])),e.gullet.macros.set("\\df@tag",void 0,!0)):x.push(Boolean(u)&&"1"===e.gullet.macros.get("\\@eqnsw")))}for(w(),b.push($n(e));;){var k=e.parseExpression(!1,d?"\\end":"\\\\");e.gullet.endGroup(),e.gullet.beginGroup(),k={type:"ordgroup",mode:e.mode,body:k},n&&(k={type:"styling",mode:e.mode,style:n,body:[k]}),m.push(k);var C=e.fetch().text;if("&"===C){if(f&&m.length===f){if(d||c)throw new o("Too many tab characters: &",e.nextToken);e.settings.reportNonstrict("textEnv","Too few columns specified in the {array} column argument.")}e.consume()}else{if("\\end"===C){S(),1===m.length&&"styling"===k.type&&0===k.body[0].body.length&&(v.length>1||!p)&&v.pop(),b.length<v.length+1&&b.push([]);break}if("\\\\"!==C)throw new o("Expected & or \\\\ or \\cr or \\end",e.nextToken);e.consume();var E=void 0;" "!==e.gullet.future().text&&(E=e.parseSizeGroup(!0)),y.push(E?E.value:null),S(),b.push($n(e)),m=[],v.push(m),w()}}return e.gullet.endGroup(),e.gullet.endGroup(),{type:"array",mode:e.mode,addJot:i,arraystretch:s,body:v,cols:l,rowGaps:y,hskipBeforeAndAfter:r,hLinesBeforeRow:b,colSeparationType:c,tags:x,leqno:h}}function Wn(e){return"d"===e.slice(0,1)?"display":"text"}var Yn=function(e,t){var n,r,a=e.body.length,i=e.hLinesBeforeRow,l=0,s=new Array(a),c=[],d=Math.max(t.fontMetrics().arrayRuleWidth,t.minRuleThickness),p=1/t.fontMetrics().ptPerEm,f=5*p;e.colSeparationType&&"small"===e.colSeparationType&&(f=t.havingStyle(S.SCRIPT).sizeMultiplier/t.sizeMultiplier*.2778);var h="CD"===e.colSeparationType?q({number:3,unit:"ex"},t):12*p,g=3*p,m=e.arraystretch*h,v=.7*m,y=.3*m,b=0;function x(e){for(var t=0;t<e.length;++t)t>0&&(b+=.25),c.push({pos:b,isDashed:e[t]})}for(x(i[0]),n=0;n<e.body.length;++n){var w=e.body[n],k=v,C=y;l<w.length&&(l=w.length);var E=new Array(w.length);for(r=0;r<w.length;++r){var A=St(w[r],t);C<A.depth&&(C=A.depth),k<A.height&&(k=A.height),E[r]=A}var T=e.rowGaps[n],I=0;T&&(I=q(T,t))>0&&(C<(I+=y)&&(C=I),I=0),e.addJot&&(C+=g),E.height=k,E.depth=C,b+=k,E.pos=b,b+=C+I,s[n]=E,x(i[n+1])}var z,F,M=b/2+t.fontMetrics().axisHeight,j=e.cols||[],B=[],R=[];if(e.tags&&e.tags.some((e=>e)))for(n=0;n<a;++n){var O=s[n],L=O.pos-M,N=e.tags[n],P=void 0;(P=!0===N?Je.makeSpan(["eqn-num"],[],t):!1===N?Je.makeSpan([],[],t):Je.makeSpan([],mt(N,t,!0),t)).depth=O.depth,P.height=O.height,R.push({type:"elem",elem:P,shift:L})}for(r=0,F=0;r<l||F<j.length;++r,++F){for(var _=j[F]||{},D=!0;"separator"===_.type;){if(D||((z=Je.makeSpan(["arraycolsep"],[])).style.width=U(t.fontMetrics().doubleRuleSep),B.push(z)),"|"!==_.separator&&":"!==_.separator)throw new o("Invalid separator type: "+_.separator);var $="|"===_.separator?"solid":"dashed",H=Je.makeSpan(["vertical-separator"],[],t);H.style.height=U(b),H.style.borderRightWidth=U(d),H.style.borderRightStyle=$,H.style.margin="0 "+U(-d/2);var V=b-M;V&&(H.style.verticalAlign=U(-V)),B.push(H),_=j[++F]||{},D=!1}if(!(r>=l)){var G=void 0;(r>0||e.hskipBeforeAndAfter)&&0!==(G=u.deflt(_.pregap,f))&&((z=Je.makeSpan(["arraycolsep"],[])).style.width=U(G),B.push(z));var W=[];for(n=0;n<a;++n){var Y=s[n],K=Y[r];if(K){var X=Y.pos-M;K.depth=Y.depth,K.height=Y.height,W.push({type:"elem",elem:K,shift:X})}}W=Je.makeVList({positionType:"individualShift",children:W},t),W=Je.makeSpan(["col-align-"+(_.align||"c")],[W]),B.push(W),(r<l-1||e.hskipBeforeAndAfter)&&0!==(G=u.deflt(_.postgap,f))&&((z=Je.makeSpan(["arraycolsep"],[])).style.width=U(G),B.push(z))}}if(s=Je.makeSpan(["mtable"],B),c.length>0){for(var Q=Je.makeLineSpan("hline",t,d),J=Je.makeLineSpan("hdashline",t,d),Z=[{type:"elem",elem:s,shift:0}];c.length>0;){var ee=c.pop(),te=ee.pos-M;ee.isDashed?Z.push({type:"elem",elem:J,shift:te}):Z.push({type:"elem",elem:Q,shift:te})}s=Je.makeVList({positionType:"individualShift",children:Z},t)}if(0===R.length)return Je.makeSpan(["mord"],[s],t);var ne=Je.makeVList({positionType:"individualShift",children:R},t);return ne=Je.makeSpan(["tag"],[ne],t),Je.makeFragment([s,ne])},Kn={c:"center ",l:"left ",r:"right "},Xn=function(e,t){for(var n=[],r=new It.MathNode("mtd",[],["mtr-glue"]),a=new It.MathNode("mtd",[],["mml-eqn-num"]),o=0;o<e.body.length;o++){for(var i=e.body[o],l=[],s=0;s<i.length;s++)l.push(new It.MathNode("mtd",[Ot(i[s],t)]));e.tags&&e.tags[o]&&(l.unshift(r),l.push(r),e.leqno?l.unshift(a):l.push(a)),n.push(new It.MathNode("mtr",l))}var c=new It.MathNode("mtable",n),u=.5===e.arraystretch?.1:.16+e.arraystretch-1+(e.addJot?.09:0);c.setAttribute("rowspacing",U(u));var d="",p="";if(e.cols&&e.cols.length>0){var f=e.cols,h="",g=!1,m=0,v=f.length;"separator"===f[0].type&&(d+="top ",m=1),"separator"===f[f.length-1].type&&(d+="bottom ",v-=1);for(var y=m;y<v;y++)"align"===f[y].type?(p+=Kn[f[y].align],g&&(h+="none "),g=!0):"separator"===f[y].type&&g&&(h+="|"===f[y].separator?"solid ":"dashed ",g=!1);c.setAttribute("columnalign",p.trim()),/[sd]/.test(h)&&c.setAttribute("columnlines",h.trim())}if("align"===e.colSeparationType){for(var b=e.cols||[],x="",w=1;w<b.length;w++)x+=w%2?"0em ":"1em ";c.setAttribute("columnspacing",x.trim())}else"alignat"===e.colSeparationType||"gather"===e.colSeparationType?c.setAttribute("columnspacing","0em"):"small"===e.colSeparationType?c.setAttribute("columnspacing","0.2778em"):"CD"===e.colSeparationType?c.setAttribute("columnspacing","0.5em"):c.setAttribute("columnspacing","1em");var S="",k=e.hLinesBeforeRow;d+=k[0].length>0?"left ":"",d+=k[k.length-1].length>0?"right ":"";for(var C=1;C<k.length-1;C++)S+=0===k[C].length?"none ":k[C][0]?"dashed ":"solid ";return/[sd]/.test(S)&&c.setAttribute("rowlines",S.trim()),""!==d&&(c=new It.MathNode("menclose",[c])).setAttribute("notation",d.trim()),e.arraystretch&&e.arraystretch<1&&(c=new It.MathNode("mstyle",[c])).setAttribute("scriptlevel","1"),c},Qn=function(e,t){-1===e.envName.indexOf("ed")&&Hn(e);var n,r=[],a=e.envName.indexOf("at")>-1?"alignat":"align",i="split"===e.envName,l=Gn(e.parser,{cols:r,addJot:!0,autoTag:i?void 0:Vn(e.envName),emptySingleRow:!0,colSeparationType:a,maxNumCols:i?2:void 0,leqno:e.parser.settings.leqno},"display"),s=0,c={type:"ordgroup",mode:e.mode,body:[]};if(t[0]&&"ordgroup"===t[0].type){for(var u="",d=0;d<t[0].body.length;d++){u+=Ht(t[0].body[d],"textord").text}n=Number(u),s=2*n}var p=!s;l.body.forEach((function(e){for(var t=1;t<e.length;t+=2){var r=Ht(e[t],"styling");Ht(r.body[0],"ordgroup").body.unshift(c)}if(p)s<e.length&&(s=e.length);else{var a=e.length/2;if(n<a)throw new o("Too many math in a row: expected "+n+", but got "+a,e[0])}}));for(var f=0;f<s;++f){var h="r",g=0;f%2==1?h="l":f>0&&p&&(g=1),r[f]={type:"align",align:h,pregap:g,postgap:0}}return l.colSeparationType=p?"align":"alignat",l};Dn({type:"array",names:["array","darray"],props:{numArgs:1},handler(e,t){var n=(Gt(t[0])?[t[0]]:Ht(t[0],"ordgroup").body).map((function(e){var t=Vt(e).text;if(-1!=="lcr".indexOf(t))return{type:"align",align:t};if("|"===t)return{type:"separator",separator:"|"};if(":"===t)return{type:"separator",separator:":"};throw new o("Unknown column alignment: "+t,e)})),r={cols:n,hskipBeforeAndAfter:!0,maxNumCols:n.length};return Gn(e.parser,r,Wn(e.envName))},htmlBuilder:Yn,mathmlBuilder:Xn}),Dn({type:"array",names:["matrix","pmatrix","bmatrix","Bmatrix","vmatrix","Vmatrix","matrix*","pmatrix*","bmatrix*","Bmatrix*","vmatrix*","Vmatrix*"],props:{numArgs:0},handler(e){var t={matrix:null,pmatrix:["(",")"],bmatrix:["[","]"],Bmatrix:["\\{","\\}"],vmatrix:["|","|"],Vmatrix:["\\Vert","\\Vert"]}[e.envName.replace("*","")],n="c",r={hskipBeforeAndAfter:!1,cols:[{type:"align",align:n}]};if("*"===e.envName.charAt(e.envName.length-1)){var a=e.parser;if(a.consumeSpaces(),"["===a.fetch().text){if(a.consume(),a.consumeSpaces(),n=a.fetch().text,-1==="lcr".indexOf(n))throw new o("Expected l or c or r",a.nextToken);a.consume(),a.consumeSpaces(),a.expect("]"),a.consume(),r.cols=[{type:"align",align:n}]}}var i=Gn(e.parser,r,Wn(e.envName)),l=Math.max(0,...i.body.map((e=>e.length)));return i.cols=new Array(l).fill({type:"align",align:n}),t?{type:"leftright",mode:e.mode,body:[i],left:t[0],right:t[1],rightColor:void 0}:i},htmlBuilder:Yn,mathmlBuilder:Xn}),Dn({type:"array",names:["smallmatrix"],props:{numArgs:0},handler(e){var t=Gn(e.parser,{arraystretch:.5},"script");return t.colSeparationType="small",t},htmlBuilder:Yn,mathmlBuilder:Xn}),Dn({type:"array",names:["subarray"],props:{numArgs:1},handler(e,t){var n=(Gt(t[0])?[t[0]]:Ht(t[0],"ordgroup").body).map((function(e){var t=Vt(e).text;if(-1!=="lc".indexOf(t))return{type:"align",align:t};throw new o("Unknown column alignment: "+t,e)}));if(n.length>1)throw new o("{subarray} can contain only one column");var r={cols:n,hskipBeforeAndAfter:!1,arraystretch:.5};if((r=Gn(e.parser,r,"script")).body.length>0&&r.body[0].length>1)throw new o("{subarray} can contain only one column");return r},htmlBuilder:Yn,mathmlBuilder:Xn}),Dn({type:"array",names:["cases","dcases","rcases","drcases"],props:{numArgs:0},handler(e){var t=Gn(e.parser,{arraystretch:1.2,cols:[{type:"align",align:"l",pregap:0,postgap:1},{type:"align",align:"l",pregap:0,postgap:0}]},Wn(e.envName));return{type:"leftright",mode:e.mode,body:[t],left:e.envName.indexOf("r")>-1?".":"\\{",right:e.envName.indexOf("r")>-1?"\\}":".",rightColor:void 0}},htmlBuilder:Yn,mathmlBuilder:Xn}),Dn({type:"array",names:["align","align*","aligned","split"],props:{numArgs:0},handler:Qn,htmlBuilder:Yn,mathmlBuilder:Xn}),Dn({type:"array",names:["gathered","gather","gather*"],props:{numArgs:0},handler(e){u.contains(["gather","gather*"],e.envName)&&Hn(e);var t={cols:[{type:"align",align:"c"}],addJot:!0,colSeparationType:"gather",autoTag:Vn(e.envName),emptySingleRow:!0,leqno:e.parser.settings.leqno};return Gn(e.parser,t,"display")},htmlBuilder:Yn,mathmlBuilder:Xn}),Dn({type:"array",names:["alignat","alignat*","alignedat"],props:{numArgs:1},handler:Qn,htmlBuilder:Yn,mathmlBuilder:Xn}),Dn({type:"array",names:["equation","equation*"],props:{numArgs:0},handler(e){Hn(e);var t={autoTag:Vn(e.envName),emptySingleRow:!0,singleRow:!0,maxNumCols:1,leqno:e.parser.settings.leqno};return Gn(e.parser,t,"display")},htmlBuilder:Yn,mathmlBuilder:Xn}),Dn({type:"array",names:["CD"],props:{numArgs:0},handler:e=>(Hn(e),function(e){var t=[];for(e.gullet.beginGroup(),e.gullet.macros.set("\\cr","\\\\\\relax"),e.gullet.beginGroup();;){t.push(e.parseExpression(!1,"\\\\")),e.gullet.endGroup(),e.gullet.beginGroup();var n=e.fetch().text;if("&"!==n&&"\\\\"!==n){if("\\end"===n){0===t[t.length-1].length&&t.pop();break}throw new o("Expected \\\\ or \\cr or \\end",e.nextToken)}e.consume()}for(var r,a,i=[],l=[i],s=0;s<t.length;s++){for(var c=t[s],u={type:"styling",body:[],mode:"math",style:"display"},d=0;d<c.length;d++)if(nn(c[d])){i.push(u);var p=Vt(c[d+=1]).text,f=new Array(2);if(f[0]={type:"ordgroup",mode:"math",body:[]},f[1]={type:"ordgroup",mode:"math",body:[]},"=|.".indexOf(p)>-1);else{if(!("<>AV".indexOf(p)>-1))throw new o('Expected one of "<>AV=|." after @',c[d]);for(var h=0;h<2;h++){for(var g=!0,m=d+1;m<c.length;m++){if(a=p,("mathord"===(r=c[m]).type||"atom"===r.type)&&r.text===a){g=!1,d=m;break}if(nn(c[m]))throw new o("Missing a "+p+" character to complete a CD arrow.",c[m]);f[h].body.push(c[m])}if(g)throw new o("Missing a "+p+" character to complete a CD arrow.",c[d])}}var v={type:"styling",body:[rn(p,f,e)],mode:"math",style:"display"};i.push(v),u={type:"styling",body:[],mode:"math",style:"display"}}else u.body.push(c[d]);s%2==0?i.push(u):i.shift(),i=[],l.push(i)}return e.gullet.endGroup(),e.gullet.endGroup(),{type:"array",mode:"math",body:l,arraystretch:1,addJot:!0,rowGaps:[null],cols:new Array(l[0].length).fill({type:"align",align:"c",pregap:.25,postgap:.25}),colSeparationType:"CD",hLinesBeforeRow:new Array(l.length+1).fill([])}}(e.parser)),htmlBuilder:Yn,mathmlBuilder:Xn}),Un("\\nonumber","\\gdef\\@eqnsw{0}"),Un("\\notag","\\nonumber"),lt({type:"text",names:["\\hline","\\hdashline"],props:{numArgs:0,allowedInText:!0,allowedInMath:!0},handler(e,t){throw new o(e.funcName+" valid only within array environment")}});var Jn=_n;lt({type:"environment",names:["\\begin","\\end"],props:{numArgs:1,argTypes:["text"]},handler(e,t){var{parser:n,funcName:r}=e,a=t[0];if("ordgroup"!==a.type)throw new o("Invalid environment name",a);for(var i="",l=0;l<a.body.length;++l)i+=Ht(a.body[l],"textord").text;if("\\begin"===r){if(!Jn.hasOwnProperty(i))throw new o("No such environment: "+i,a);var s=Jn[i],{args:c,optArgs:u}=n.parseArguments("\\begin{"+i+"}",s),d={mode:n.mode,envName:i,parser:n},p=s.handler(d,c,u);n.expect("\\end",!1);var f=n.nextToken,h=Ht(n.parseFunction(),"environment");if(h.name!==i)throw new o("Mismatch: \\begin{"+i+"} matched by \\end{"+h.name+"}",f);return p}return{type:"environment",mode:n.mode,name:i,nameGroup:a}}});var Zn=(e,t)=>{var n=e.font,r=t.withFont(n);return St(e.body,r)},er=(e,t)=>{var n=e.font,r=t.withFont(n);return Ot(e.body,r)},tr={"\\Bbb":"\\mathbb","\\bold":"\\mathbf","\\frak":"\\mathfrak","\\bm":"\\boldsymbol"};lt({type:"font",names:["\\mathrm","\\mathit","\\mathbf","\\mathnormal","\\mathsfit","\\mathbb","\\mathcal","\\mathfrak","\\mathscr","\\mathsf","\\mathtt","\\Bbb","\\bold","\\frak"],props:{numArgs:1,allowedInArgument:!0},handler:(e,t)=>{var{parser:n,funcName:r}=e,a=ct(t[0]),o=r;return o in tr&&(o=tr[o]),{type:"font",mode:n.mode,font:o.slice(1),body:a}},htmlBuilder:Zn,mathmlBuilder:er}),lt({type:"mclass",names:["\\boldsymbol","\\bm"],props:{numArgs:1},handler:(e,t)=>{var{parser:n}=e,r=t[0],a=u.isCharacterBox(r);return{type:"mclass",mode:n.mode,mclass:en(r),body:[{type:"font",mode:n.mode,font:"boldsymbol",body:r}],isCharacterBox:a}}}),lt({type:"font",names:["\\rm","\\sf","\\tt","\\bf","\\it","\\cal"],props:{numArgs:0,allowedInText:!0},handler:(e,t)=>{var{parser:n,funcName:r,breakOnTokenText:a}=e,{mode:o}=n,i=n.parseExpression(!0,a);return{type:"font",mode:o,font:"math"+r.slice(1),body:{type:"ordgroup",mode:n.mode,body:i}}},htmlBuilder:Zn,mathmlBuilder:er});var nr=(e,t)=>{var n=t;return"display"===e?n=n.id>=S.SCRIPT.id?n.text():S.DISPLAY:"text"===e&&n.size===S.DISPLAY.size?n=S.TEXT:"script"===e?n=S.SCRIPT:"scriptscript"===e&&(n=S.SCRIPTSCRIPT),n},rr=(e,t)=>{var n,r=nr(e.size,t.style),a=r.fracNum(),o=r.fracDen();n=t.havingStyle(a);var i=St(e.numer,n,t);if(e.continued){var l=8.5/t.fontMetrics().ptPerEm,s=3.5/t.fontMetrics().ptPerEm;i.height=i.height<l?l:i.height,i.depth=i.depth<s?s:i.depth}n=t.havingStyle(o);var c,u,d,p,f,h,g,m,v,y,b=St(e.denom,n,t);if(e.hasBarLine?(e.barSize?(u=q(e.barSize,t),c=Je.makeLineSpan("frac-line",t,u)):c=Je.makeLineSpan("frac-line",t),u=c.height,d=c.height):(c=null,u=0,d=t.fontMetrics().defaultRuleThickness),r.size===S.DISPLAY.size||"display"===e.size?(p=t.fontMetrics().num1,f=u>0?3*d:7*d,h=t.fontMetrics().denom1):(u>0?(p=t.fontMetrics().num2,f=d):(p=t.fontMetrics().num3,f=3*d),h=t.fontMetrics().denom2),c){var x=t.fontMetrics().axisHeight;p-i.depth-(x+.5*u)<f&&(p+=f-(p-i.depth-(x+.5*u))),x-.5*u-(b.height-h)<f&&(h+=f-(x-.5*u-(b.height-h)));var w=-(x-.5*u);g=Je.makeVList({positionType:"individualShift",children:[{type:"elem",elem:b,shift:h},{type:"elem",elem:c,shift:w},{type:"elem",elem:i,shift:-p}]},t)}else{var k=p-i.depth-(b.height-h);k<f&&(p+=.5*(f-k),h+=.5*(f-k)),g=Je.makeVList({positionType:"individualShift",children:[{type:"elem",elem:b,shift:h},{type:"elem",elem:i,shift:-p}]},t)}return n=t.havingStyle(r),g.height*=n.sizeMultiplier/t.sizeMultiplier,g.depth*=n.sizeMultiplier/t.sizeMultiplier,m=r.size===S.DISPLAY.size?t.fontMetrics().delim1:r.size===S.SCRIPTSCRIPT.size?t.havingStyle(S.SCRIPT).fontMetrics().delim2:t.fontMetrics().delim2,v=null==e.leftDelim?wt(t,["mopen"]):jn.customSizedDelim(e.leftDelim,m,!0,t.havingStyle(r),e.mode,["mopen"]),y=e.continued?Je.makeSpan([]):null==e.rightDelim?wt(t,["mclose"]):jn.customSizedDelim(e.rightDelim,m,!0,t.havingStyle(r),e.mode,["mclose"]),Je.makeSpan(["mord"].concat(n.sizingClasses(t)),[v,Je.makeSpan(["mfrac"],[g]),y],t)},ar=(e,t)=>{var n=new It.MathNode("mfrac",[Ot(e.numer,t),Ot(e.denom,t)]);if(e.hasBarLine){if(e.barSize){var r=q(e.barSize,t);n.setAttribute("linethickness",U(r))}}else n.setAttribute("linethickness","0px");var a=nr(e.size,t.style);if(a.size!==t.style.size){n=new It.MathNode("mstyle",[n]);var o=a.size===S.DISPLAY.size?"true":"false";n.setAttribute("displaystyle",o),n.setAttribute("scriptlevel","0")}if(null!=e.leftDelim||null!=e.rightDelim){var i=[];if(null!=e.leftDelim){var l=new It.MathNode("mo",[new It.TextNode(e.leftDelim.replace("\\",""))]);l.setAttribute("fence","true"),i.push(l)}if(i.push(n),null!=e.rightDelim){var s=new It.MathNode("mo",[new It.TextNode(e.rightDelim.replace("\\",""))]);s.setAttribute("fence","true"),i.push(s)}return Ft(i)}return n};lt({type:"genfrac",names:["\\dfrac","\\frac","\\tfrac","\\dbinom","\\binom","\\tbinom","\\\\atopfrac","\\\\bracefrac","\\\\brackfrac"],props:{numArgs:2,allowedInArgument:!0},handler:(e,t)=>{var n,{parser:r,funcName:a}=e,o=t[0],i=t[1],l=null,s=null,c="auto";switch(a){case"\\dfrac":case"\\frac":case"\\tfrac":n=!0;break;case"\\\\atopfrac":n=!1;break;case"\\dbinom":case"\\binom":case"\\tbinom":n=!1,l="(",s=")";break;case"\\\\bracefrac":n=!1,l="\\{",s="\\}";break;case"\\\\brackfrac":n=!1,l="[",s="]";break;default:throw new Error("Unrecognized genfrac command")}switch(a){case"\\dfrac":case"\\dbinom":c="display";break;case"\\tfrac":case"\\tbinom":c="text"}return{type:"genfrac",mode:r.mode,continued:!1,numer:o,denom:i,hasBarLine:n,leftDelim:l,rightDelim:s,size:c,barSize:null}},htmlBuilder:rr,mathmlBuilder:ar}),lt({type:"genfrac",names:["\\cfrac"],props:{numArgs:2},handler:(e,t)=>{var{parser:n,funcName:r}=e,a=t[0],o=t[1];return{type:"genfrac",mode:n.mode,continued:!0,numer:a,denom:o,hasBarLine:!0,leftDelim:null,rightDelim:null,size:"display",barSize:null}}}),lt({type:"infix",names:["\\over","\\choose","\\atop","\\brace","\\brack"],props:{numArgs:0,infix:!0},handler(e){var t,{parser:n,funcName:r,token:a}=e;switch(r){case"\\over":t="\\frac";break;case"\\choose":t="\\binom";break;case"\\atop":t="\\\\atopfrac";break;case"\\brace":t="\\\\bracefrac";break;case"\\brack":t="\\\\brackfrac";break;default:throw new Error("Unrecognized infix genfrac command")}return{type:"infix",mode:n.mode,replaceWith:t,token:a}}});var or=["display","text","script","scriptscript"],ir=function(e){var t=null;return e.length>0&&(t="."===(t=e)?null:t),t};lt({type:"genfrac",names:["\\genfrac"],props:{numArgs:6,allowedInArgument:!0,argTypes:["math","math","size","text","math","math"]},handler(e,t){var n,{parser:r}=e,a=t[4],o=t[5],i=ct(t[0]),l="atom"===i.type&&"open"===i.family?ir(i.text):null,s=ct(t[1]),c="atom"===s.type&&"close"===s.family?ir(s.text):null,u=Ht(t[2],"size"),d=null;n=!!u.isBlank||(d=u.value).number>0;var p="auto",f=t[3];if("ordgroup"===f.type){if(f.body.length>0){var h=Ht(f.body[0],"textord");p=or[Number(h.text)]}}else f=Ht(f,"textord"),p=or[Number(f.text)];return{type:"genfrac",mode:r.mode,numer:a,denom:o,continued:!1,hasBarLine:n,barSize:d,leftDelim:l,rightDelim:c,size:p}},htmlBuilder:rr,mathmlBuilder:ar}),lt({type:"infix",names:["\\above"],props:{numArgs:1,argTypes:["size"],infix:!0},handler(e,t){var{parser:n,funcName:r,token:a}=e;return{type:"infix",mode:n.mode,replaceWith:"\\\\abovefrac",size:Ht(t[0],"size").value,token:a}}}),lt({type:"genfrac",names:["\\\\abovefrac"],props:{numArgs:3,argTypes:["math","size","math"]},handler:(e,t)=>{var{parser:n,funcName:r}=e,a=t[0],o=function(e){if(!e)throw new Error("Expected non-null, but got "+String(e));return e}(Ht(t[1],"infix").size),i=t[2],l=o.number>0;return{type:"genfrac",mode:n.mode,numer:a,denom:i,continued:!1,hasBarLine:l,barSize:o,leftDelim:null,rightDelim:null,size:"auto"}},htmlBuilder:rr,mathmlBuilder:ar});var lr=(e,t)=>{var n,r,a=t.style;"supsub"===e.type?(n=e.sup?St(e.sup,t.havingStyle(a.sup()),t):St(e.sub,t.havingStyle(a.sub()),t),r=Ht(e.base,"horizBrace")):r=Ht(e,"horizBrace");var o,i=St(r.base,t.havingBaseStyle(S.DISPLAY)),l=$t(r,t);if(r.isOver?(o=Je.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:i},{type:"kern",size:.1},{type:"elem",elem:l}]},t)).children[0].children[0].children[1].classes.push("svg-align"):(o=Je.makeVList({positionType:"bottom",positionData:i.depth+.1+l.height,children:[{type:"elem",elem:l},{type:"kern",size:.1},{type:"elem",elem:i}]},t)).children[0].children[0].children[0].classes.push("svg-align"),n){var s=Je.makeSpan(["mord",r.isOver?"mover":"munder"],[o],t);o=r.isOver?Je.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:s},{type:"kern",size:.2},{type:"elem",elem:n}]},t):Je.makeVList({positionType:"bottom",positionData:s.depth+.2+n.height+n.depth,children:[{type:"elem",elem:n},{type:"kern",size:.2},{type:"elem",elem:s}]},t)}return Je.makeSpan(["mord",r.isOver?"mover":"munder"],[o],t)};lt({type:"horizBrace",names:["\\overbrace","\\underbrace"],props:{numArgs:1},handler(e,t){var{parser:n,funcName:r}=e;return{type:"horizBrace",mode:n.mode,label:r,isOver:/^\\over/.test(r),base:t[0]}},htmlBuilder:lr,mathmlBuilder:(e,t)=>{var n=Ut(e.label);return new It.MathNode(e.isOver?"mover":"munder",[Ot(e.base,t),n])}}),lt({type:"href",names:["\\href"],props:{numArgs:2,argTypes:["url","original"],allowedInText:!0},handler:(e,t)=>{var{parser:n}=e,r=t[1],a=Ht(t[0],"url").url;return n.settings.isTrusted({command:"\\href",url:a})?{type:"href",mode:n.mode,href:a,body:ut(r)}:n.formatUnsupportedCmd("\\href")},htmlBuilder:(e,t)=>{var n=mt(e.body,t,!1);return Je.makeAnchor(e.href,[],n,t)},mathmlBuilder:(e,t)=>{var n=Rt(e.body,t);return n instanceof At||(n=new At("mrow",[n])),n.setAttribute("href",e.href),n}}),lt({type:"href",names:["\\url"],props:{numArgs:1,argTypes:["url"],allowedInText:!0},handler:(e,t)=>{var{parser:n}=e,r=Ht(t[0],"url").url;if(!n.settings.isTrusted({command:"\\url",url:r}))return n.formatUnsupportedCmd("\\url");for(var a=[],o=0;o<r.length;o++){var i=r[o];"~"===i&&(i="\\textasciitilde"),a.push({type:"textord",mode:"text",text:i})}var l={type:"text",mode:n.mode,font:"\\texttt",body:a};return{type:"href",mode:n.mode,href:r,body:ut(l)}}}),lt({type:"hbox",names:["\\hbox"],props:{numArgs:1,argTypes:["text"],allowedInText:!0,primitive:!0},handler(e,t){var{parser:n}=e;return{type:"hbox",mode:n.mode,body:ut(t[0])}},htmlBuilder(e,t){var n=mt(e.body,t,!1);return Je.makeFragment(n)},mathmlBuilder:(e,t)=>new It.MathNode("mrow",Bt(e.body,t))}),lt({type:"html",names:["\\htmlClass","\\htmlId","\\htmlStyle","\\htmlData"],props:{numArgs:2,argTypes:["raw","original"],allowedInText:!0},handler:(e,t)=>{var n,{parser:r,funcName:a,token:i}=e,l=Ht(t[0],"raw").string,s=t[1];r.settings.strict&&r.settings.reportNonstrict("htmlExtension","HTML extension is disabled on strict mode");var c={};switch(a){case"\\htmlClass":c.class=l,n={command:"\\htmlClass",class:l};break;case"\\htmlId":c.id=l,n={command:"\\htmlId",id:l};break;case"\\htmlStyle":c.style=l,n={command:"\\htmlStyle",style:l};break;case"\\htmlData":for(var u=l.split(","),d=0;d<u.length;d++){var p=u[d].split("=");if(2!==p.length)throw new o("Error parsing key-value for \\htmlData");c["data-"+p[0].trim()]=p[1].trim()}n={command:"\\htmlData",attributes:c};break;default:throw new Error("Unrecognized html command")}return r.settings.isTrusted(n)?{type:"html",mode:r.mode,attributes:c,body:ut(s)}:r.formatUnsupportedCmd(a)},htmlBuilder:(e,t)=>{var n=mt(e.body,t,!1),r=["enclosing"];e.attributes.class&&r.push(...e.attributes.class.trim().split(/\s+/));var a=Je.makeSpan(r,n,t);for(var o in e.attributes)"class"!==o&&e.attributes.hasOwnProperty(o)&&a.setAttribute(o,e.attributes[o]);return a},mathmlBuilder:(e,t)=>Rt(e.body,t)}),lt({type:"htmlmathml",names:["\\html@mathml"],props:{numArgs:2,allowedInText:!0},handler:(e,t)=>{var{parser:n}=e;return{type:"htmlmathml",mode:n.mode,html:ut(t[0]),mathml:ut(t[1])}},htmlBuilder:(e,t)=>{var n=mt(e.html,t,!1);return Je.makeFragment(n)},mathmlBuilder:(e,t)=>Rt(e.mathml,t)});var sr=function(e){if(/^[-+]? *(\d+(\.\d*)?|\.\d+)$/.test(e))return{number:+e,unit:"bp"};var t=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(e);if(!t)throw new o("Invalid size: '"+e+"' in \\includegraphics");var n={number:+(t[1]+t[2]),unit:t[3]};if(!D(n))throw new o("Invalid unit: '"+n.unit+"' in \\includegraphics.");return n};lt({type:"includegraphics",names:["\\includegraphics"],props:{numArgs:1,numOptionalArgs:1,argTypes:["raw","url"],allowedInText:!1},handler:(e,t,n)=>{var{parser:r}=e,a={number:0,unit:"em"},i={number:.9,unit:"em"},l={number:0,unit:"em"},s="";if(n[0])for(var c=Ht(n[0],"raw").string.split(","),u=0;u<c.length;u++){var d=c[u].split("=");if(2===d.length){var p=d[1].trim();switch(d[0].trim()){case"alt":s=p;break;case"width":a=sr(p);break;case"height":i=sr(p);break;case"totalheight":l=sr(p);break;default:throw new o("Invalid key: '"+d[0]+"' in \\includegraphics.")}}}var f=Ht(t[0],"url").url;return""===s&&(s=(s=(s=f).replace(/^.*[\\/]/,"")).substring(0,s.lastIndexOf("."))),r.settings.isTrusted({command:"\\includegraphics",url:f})?{type:"includegraphics",mode:r.mode,alt:s,width:a,height:i,totalheight:l,src:f}:r.formatUnsupportedCmd("\\includegraphics")},htmlBuilder:(e,t)=>{var n=q(e.height,t),r=0;e.totalheight.number>0&&(r=q(e.totalheight,t)-n);var a=0;e.width.number>0&&(a=q(e.width,t));var o={height:U(n+r)};a>0&&(o.width=U(a)),r>0&&(o.verticalAlign=U(-r));var i=new X(e.src,e.alt,o);return i.height=n,i.depth=r,i},mathmlBuilder:(e,t)=>{var n=new It.MathNode("mglyph",[]);n.setAttribute("alt",e.alt);var r=q(e.height,t),a=0;if(e.totalheight.number>0&&(a=q(e.totalheight,t)-r,n.setAttribute("valign",U(-a))),n.setAttribute("height",U(r+a)),e.width.number>0){var o=q(e.width,t);n.setAttribute("width",U(o))}return n.setAttribute("src",e.src),n}}),lt({type:"kern",names:["\\kern","\\mkern","\\hskip","\\mskip"],props:{numArgs:1,argTypes:["size"],primitive:!0,allowedInText:!0},handler(e,t){var{parser:n,funcName:r}=e,a=Ht(t[0],"size");if(n.settings.strict){var o="m"===r[1],i="mu"===a.value.unit;o?(i||n.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" supports only mu units, not "+a.value.unit+" units"),"math"!==n.mode&&n.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" works only in math mode")):i&&n.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" doesn't support mu units")}return{type:"kern",mode:n.mode,dimension:a.value}},htmlBuilder:(e,t)=>Je.makeGlue(e.dimension,t),mathmlBuilder(e,t){var n=q(e.dimension,t);return new It.SpaceNode(n)}}),lt({type:"lap",names:["\\mathllap","\\mathrlap","\\mathclap"],props:{numArgs:1,allowedInText:!0},handler:(e,t)=>{var{parser:n,funcName:r}=e,a=t[0];return{type:"lap",mode:n.mode,alignment:r.slice(5),body:a}},htmlBuilder:(e,t)=>{var n;"clap"===e.alignment?(n=Je.makeSpan([],[St(e.body,t)]),n=Je.makeSpan(["inner"],[n],t)):n=Je.makeSpan(["inner"],[St(e.body,t)]);var r=Je.makeSpan(["fix"],[]),a=Je.makeSpan([e.alignment],[n,r],t),o=Je.makeSpan(["strut"]);return o.style.height=U(a.height+a.depth),a.depth&&(o.style.verticalAlign=U(-a.depth)),a.children.unshift(o),a=Je.makeSpan(["thinbox"],[a],t),Je.makeSpan(["mord","vbox"],[a],t)},mathmlBuilder:(e,t)=>{var n=new It.MathNode("mpadded",[Ot(e.body,t)]);if("rlap"!==e.alignment){var r="llap"===e.alignment?"-1":"-0.5";n.setAttribute("lspace",r+"width")}return n.setAttribute("width","0px"),n}}),lt({type:"styling",names:["\\(","$"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(e,t){var{funcName:n,parser:r}=e,a=r.mode;r.switchMode("math");var o="\\("===n?"\\)":"$",i=r.parseExpression(!1,o);return r.expect(o),r.switchMode(a),{type:"styling",mode:r.mode,style:"text",body:i}}}),lt({type:"text",names:["\\)","\\]"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(e,t){throw new o("Mismatched "+e.funcName)}});var cr=(e,t)=>{switch(t.style.size){case S.DISPLAY.size:return e.display;case S.TEXT.size:return e.text;case S.SCRIPT.size:return e.script;case S.SCRIPTSCRIPT.size:return e.scriptscript;default:return e.text}};lt({type:"mathchoice",names:["\\mathchoice"],props:{numArgs:4,primitive:!0},handler:(e,t)=>{var{parser:n}=e;return{type:"mathchoice",mode:n.mode,display:ut(t[0]),text:ut(t[1]),script:ut(t[2]),scriptscript:ut(t[3])}},htmlBuilder:(e,t)=>{var n=cr(e,t),r=mt(n,t,!1);return Je.makeFragment(r)},mathmlBuilder:(e,t)=>{var n=cr(e,t);return Rt(n,t)}});var ur=(e,t,n,r,a,o,i)=>{e=Je.makeSpan([],[e]);var l,s,c,d=n&&u.isCharacterBox(n);if(t){var p=St(t,r.havingStyle(a.sup()),r);s={elem:p,kern:Math.max(r.fontMetrics().bigOpSpacing1,r.fontMetrics().bigOpSpacing3-p.depth)}}if(n){var f=St(n,r.havingStyle(a.sub()),r);l={elem:f,kern:Math.max(r.fontMetrics().bigOpSpacing2,r.fontMetrics().bigOpSpacing4-f.height)}}if(s&&l){var h=r.fontMetrics().bigOpSpacing5+l.elem.height+l.elem.depth+l.kern+e.depth+i;c=Je.makeVList({positionType:"bottom",positionData:h,children:[{type:"kern",size:r.fontMetrics().bigOpSpacing5},{type:"elem",elem:l.elem,marginLeft:U(-o)},{type:"kern",size:l.kern},{type:"elem",elem:e},{type:"kern",size:s.kern},{type:"elem",elem:s.elem,marginLeft:U(o)},{type:"kern",size:r.fontMetrics().bigOpSpacing5}]},r)}else if(l){var g=e.height-i;c=Je.makeVList({positionType:"top",positionData:g,children:[{type:"kern",size:r.fontMetrics().bigOpSpacing5},{type:"elem",elem:l.elem,marginLeft:U(-o)},{type:"kern",size:l.kern},{type:"elem",elem:e}]},r)}else{if(!s)return e;var m=e.depth+i;c=Je.makeVList({positionType:"bottom",positionData:m,children:[{type:"elem",elem:e},{type:"kern",size:s.kern},{type:"elem",elem:s.elem,marginLeft:U(o)},{type:"kern",size:r.fontMetrics().bigOpSpacing5}]},r)}var v=[c];if(l&&0!==o&&!d){var y=Je.makeSpan(["mspace"],[],r);y.style.marginRight=U(o),v.unshift(y)}return Je.makeSpan(["mop","op-limits"],v,r)},dr=["\\smallint"],pr=(e,t)=>{var n,r,a,o=!1;"supsub"===e.type?(n=e.sup,r=e.sub,a=Ht(e.base,"op"),o=!0):a=Ht(e,"op");var i,l=t.style,s=!1;if(l.size===S.DISPLAY.size&&a.symbol&&!u.contains(dr,a.name)&&(s=!0),a.symbol){var c=s?"Size2-Regular":"Size1-Regular",d="";if("\\oiint"!==a.name&&"\\oiiint"!==a.name||(d=a.name.slice(1),a.name="oiint"===d?"\\iint":"\\iiint"),i=Je.makeSymbol(a.name,c,"math",t,["mop","op-symbol",s?"large-op":"small-op"]),d.length>0){var p=i.italic,f=Je.staticSvg(d+"Size"+(s?"2":"1"),t);i=Je.makeVList({positionType:"individualShift",children:[{type:"elem",elem:i,shift:0},{type:"elem",elem:f,shift:s?.08:0}]},t),a.name="\\"+d,i.classes.unshift("mop"),i.italic=p}}else if(a.body){var h=mt(a.body,t,!0);1===h.length&&h[0]instanceof J?(i=h[0]).classes[0]="mop":i=Je.makeSpan(["mop"],h,t)}else{for(var g=[],m=1;m<a.name.length;m++)g.push(Je.mathsym(a.name[m],a.mode,t));i=Je.makeSpan(["mop"],g,t)}var v=0,y=0;return(i instanceof J||"\\oiint"===a.name||"\\oiiint"===a.name)&&!a.suppressBaseShift&&(v=(i.height-i.depth)/2-t.fontMetrics().axisHeight,y=i.italic),o?ur(i,n,r,t,l,y,v):(v&&(i.style.position="relative",i.style.top=U(v)),i)},fr=(e,t)=>{var n;if(e.symbol)n=new At("mo",[zt(e.name,e.mode)]),u.contains(dr,e.name)&&n.setAttribute("largeop","false");else if(e.body)n=new At("mo",Bt(e.body,t));else{n=new At("mi",[new Tt(e.name.slice(1))]);var r=new At("mo",[zt("\u2061","text")]);n=e.parentIsSupSub?new At("mrow",[n,r]):Et([n,r])}return n},hr={"\u220f":"\\prod","\u2210":"\\coprod","\u2211":"\\sum","\u22c0":"\\bigwedge","\u22c1":"\\bigvee","\u22c2":"\\bigcap","\u22c3":"\\bigcup","\u2a00":"\\bigodot","\u2a01":"\\bigoplus","\u2a02":"\\bigotimes","\u2a04":"\\biguplus","\u2a06":"\\bigsqcup"};lt({type:"op",names:["\\coprod","\\bigvee","\\bigwedge","\\biguplus","\\bigcap","\\bigcup","\\intop","\\prod","\\sum","\\bigotimes","\\bigoplus","\\bigodot","\\bigsqcup","\\smallint","\u220f","\u2210","\u2211","\u22c0","\u22c1","\u22c2","\u22c3","\u2a00","\u2a01","\u2a02","\u2a04","\u2a06"],props:{numArgs:0},handler:(e,t)=>{var{parser:n,funcName:r}=e,a=r;return 1===a.length&&(a=hr[a]),{type:"op",mode:n.mode,limits:!0,parentIsSupSub:!1,symbol:!0,name:a}},htmlBuilder:pr,mathmlBuilder:fr}),lt({type:"op",names:["\\mathop"],props:{numArgs:1,primitive:!0},handler:(e,t)=>{var{parser:n}=e,r=t[0];return{type:"op",mode:n.mode,limits:!1,parentIsSupSub:!1,symbol:!1,body:ut(r)}},htmlBuilder:pr,mathmlBuilder:fr});var gr={"\u222b":"\\int","\u222c":"\\iint","\u222d":"\\iiint","\u222e":"\\oint","\u222f":"\\oiint","\u2230":"\\oiiint"};lt({type:"op",names:["\\arcsin","\\arccos","\\arctan","\\arctg","\\arcctg","\\arg","\\ch","\\cos","\\cosec","\\cosh","\\cot","\\cotg","\\coth","\\csc","\\ctg","\\cth","\\deg","\\dim","\\exp","\\hom","\\ker","\\lg","\\ln","\\log","\\sec","\\sin","\\sinh","\\sh","\\tan","\\tanh","\\tg","\\th"],props:{numArgs:0},handler(e){var{parser:t,funcName:n}=e;return{type:"op",mode:t.mode,limits:!1,parentIsSupSub:!1,symbol:!1,name:n}},htmlBuilder:pr,mathmlBuilder:fr}),lt({type:"op",names:["\\det","\\gcd","\\inf","\\lim","\\max","\\min","\\Pr","\\sup"],props:{numArgs:0},handler(e){var{parser:t,funcName:n}=e;return{type:"op",mode:t.mode,limits:!0,parentIsSupSub:!1,symbol:!1,name:n}},htmlBuilder:pr,mathmlBuilder:fr}),lt({type:"op",names:["\\int","\\iint","\\iiint","\\oint","\\oiint","\\oiiint","\u222b","\u222c","\u222d","\u222e","\u222f","\u2230"],props:{numArgs:0},handler(e){var{parser:t,funcName:n}=e,r=n;return 1===r.length&&(r=gr[r]),{type:"op",mode:t.mode,limits:!1,parentIsSupSub:!1,symbol:!0,name:r}},htmlBuilder:pr,mathmlBuilder:fr});var mr=(e,t)=>{var n,r,a,o,i=!1;if("supsub"===e.type?(n=e.sup,r=e.sub,a=Ht(e.base,"operatorname"),i=!0):a=Ht(e,"operatorname"),a.body.length>0){for(var l=a.body.map((e=>{var t=e.text;return"string"==typeof t?{type:"textord",mode:e.mode,text:t}:e})),s=mt(l,t.withFont("mathrm"),!0),c=0;c<s.length;c++){var u=s[c];u instanceof J&&(u.text=u.text.replace(/\u2212/,"-").replace(/\u2217/,"*"))}o=Je.makeSpan(["mop"],s,t)}else o=Je.makeSpan(["mop"],[],t);return i?ur(o,n,r,t,t.style,0,0):o};function vr(e,t,n){for(var r=mt(e,t,!1),a=t.sizeMultiplier/n.sizeMultiplier,o=0;o<r.length;o++){var i=r[o].classes.indexOf("sizing");i<0?Array.prototype.push.apply(r[o].classes,t.sizingClasses(n)):r[o].classes[i+1]==="reset-size"+t.size&&(r[o].classes[i+1]="reset-size"+n.size),r[o].height*=a,r[o].depth*=a}return Je.makeFragment(r)}lt({type:"operatorname",names:["\\operatorname@","\\operatornamewithlimits"],props:{numArgs:1},handler:(e,t)=>{var{parser:n,funcName:r}=e,a=t[0];return{type:"operatorname",mode:n.mode,body:ut(a),alwaysHandleSupSub:"\\operatornamewithlimits"===r,limits:!1,parentIsSupSub:!1}},htmlBuilder:mr,mathmlBuilder:(e,t)=>{for(var n=Bt(e.body,t.withFont("mathrm")),r=!0,a=0;a<n.length;a++){var o=n[a];if(o instanceof It.SpaceNode);else if(o instanceof It.MathNode)switch(o.type){case"mi":case"mn":case"ms":case"mspace":case"mtext":break;case"mo":var i=o.children[0];1===o.children.length&&i instanceof It.TextNode?i.text=i.text.replace(/\u2212/,"-").replace(/\u2217/,"*"):r=!1;break;default:r=!1}else r=!1}if(r){var l=n.map((e=>e.toText())).join("");n=[new It.TextNode(l)]}var s=new It.MathNode("mi",n);s.setAttribute("mathvariant","normal");var c=new It.MathNode("mo",[zt("\u2061","text")]);return e.parentIsSupSub?new It.MathNode("mrow",[s,c]):It.newDocumentFragment([s,c])}}),Un("\\operatorname","\\@ifstar\\operatornamewithlimits\\operatorname@"),st({type:"ordgroup",htmlBuilder:(e,t)=>e.semisimple?Je.makeFragment(mt(e.body,t,!1)):Je.makeSpan(["mord"],mt(e.body,t,!0),t),mathmlBuilder:(e,t)=>Rt(e.body,t,!0)}),lt({type:"overline",names:["\\overline"],props:{numArgs:1},handler(e,t){var{parser:n}=e,r=t[0];return{type:"overline",mode:n.mode,body:r}},htmlBuilder(e,t){var n=St(e.body,t.havingCrampedStyle()),r=Je.makeLineSpan("overline-line",t),a=t.fontMetrics().defaultRuleThickness,o=Je.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n},{type:"kern",size:3*a},{type:"elem",elem:r},{type:"kern",size:a}]},t);return Je.makeSpan(["mord","overline"],[o],t)},mathmlBuilder(e,t){var n=new It.MathNode("mo",[new It.TextNode("\u203e")]);n.setAttribute("stretchy","true");var r=new It.MathNode("mover",[Ot(e.body,t),n]);return r.setAttribute("accent","true"),r}}),lt({type:"phantom",names:["\\phantom"],props:{numArgs:1,allowedInText:!0},handler:(e,t)=>{var{parser:n}=e,r=t[0];return{type:"phantom",mode:n.mode,body:ut(r)}},htmlBuilder:(e,t)=>{var n=mt(e.body,t.withPhantom(),!1);return Je.makeFragment(n)},mathmlBuilder:(e,t)=>{var n=Bt(e.body,t);return new It.MathNode("mphantom",n)}}),lt({type:"hphantom",names:["\\hphantom"],props:{numArgs:1,allowedInText:!0},handler:(e,t)=>{var{parser:n}=e,r=t[0];return{type:"hphantom",mode:n.mode,body:r}},htmlBuilder:(e,t)=>{var n=Je.makeSpan([],[St(e.body,t.withPhantom())]);if(n.height=0,n.depth=0,n.children)for(var r=0;r<n.children.length;r++)n.children[r].height=0,n.children[r].depth=0;return n=Je.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n}]},t),Je.makeSpan(["mord"],[n],t)},mathmlBuilder:(e,t)=>{var n=Bt(ut(e.body),t),r=new It.MathNode("mphantom",n),a=new It.MathNode("mpadded",[r]);return a.setAttribute("height","0px"),a.setAttribute("depth","0px"),a}}),lt({type:"vphantom",names:["\\vphantom"],props:{numArgs:1,allowedInText:!0},handler:(e,t)=>{var{parser:n}=e,r=t[0];return{type:"vphantom",mode:n.mode,body:r}},htmlBuilder:(e,t)=>{var n=Je.makeSpan(["inner"],[St(e.body,t.withPhantom())]),r=Je.makeSpan(["fix"],[]);return Je.makeSpan(["mord","rlap"],[n,r],t)},mathmlBuilder:(e,t)=>{var n=Bt(ut(e.body),t),r=new It.MathNode("mphantom",n),a=new It.MathNode("mpadded",[r]);return a.setAttribute("width","0px"),a}}),lt({type:"raisebox",names:["\\raisebox"],props:{numArgs:2,argTypes:["size","hbox"],allowedInText:!0},handler(e,t){var{parser:n}=e,r=Ht(t[0],"size").value,a=t[1];return{type:"raisebox",mode:n.mode,dy:r,body:a}},htmlBuilder(e,t){var n=St(e.body,t),r=q(e.dy,t);return Je.makeVList({positionType:"shift",positionData:-r,children:[{type:"elem",elem:n}]},t)},mathmlBuilder(e,t){var n=new It.MathNode("mpadded",[Ot(e.body,t)]),r=e.dy.number+e.dy.unit;return n.setAttribute("voffset",r),n}}),lt({type:"internal",names:["\\relax"],props:{numArgs:0,allowedInText:!0,allowedInArgument:!0},handler(e){var{parser:t}=e;return{type:"internal",mode:t.mode}}}),lt({type:"rule",names:["\\rule"],props:{numArgs:2,numOptionalArgs:1,allowedInText:!0,allowedInMath:!0,argTypes:["size","size","size"]},handler(e,t,n){var{parser:r}=e,a=n[0],o=Ht(t[0],"size"),i=Ht(t[1],"size");return{type:"rule",mode:r.mode,shift:a&&Ht(a,"size").value,width:o.value,height:i.value}},htmlBuilder(e,t){var n=Je.makeSpan(["mord","rule"],[],t),r=q(e.width,t),a=q(e.height,t),o=e.shift?q(e.shift,t):0;return n.style.borderRightWidth=U(r),n.style.borderTopWidth=U(a),n.style.bottom=U(o),n.width=r,n.height=a+o,n.depth=-o,n.maxFontSize=1.125*a*t.sizeMultiplier,n},mathmlBuilder(e,t){var n=q(e.width,t),r=q(e.height,t),a=e.shift?q(e.shift,t):0,o=t.color&&t.getColor()||"black",i=new It.MathNode("mspace");i.setAttribute("mathbackground",o),i.setAttribute("width",U(n)),i.setAttribute("height",U(r));var l=new It.MathNode("mpadded",[i]);return a>=0?l.setAttribute("height",U(a)):(l.setAttribute("height",U(a)),l.setAttribute("depth",U(-a))),l.setAttribute("voffset",U(a)),l}});var yr=["\\tiny","\\sixptsize","\\scriptsize","\\footnotesize","\\small","\\normalsize","\\large","\\Large","\\LARGE","\\huge","\\Huge"];lt({type:"sizing",names:yr,props:{numArgs:0,allowedInText:!0},handler:(e,t)=>{var{breakOnTokenText:n,funcName:r,parser:a}=e,o=a.parseExpression(!1,n);return{type:"sizing",mode:a.mode,size:yr.indexOf(r)+1,body:o}},htmlBuilder:(e,t)=>{var n=t.havingSize(e.size);return vr(e.body,n,t)},mathmlBuilder:(e,t)=>{var n=t.havingSize(e.size),r=Bt(e.body,n),a=new It.MathNode("mstyle",r);return a.setAttribute("mathsize",U(n.sizeMultiplier)),a}}),lt({type:"smash",names:["\\smash"],props:{numArgs:1,numOptionalArgs:1,allowedInText:!0},handler:(e,t,n)=>{var{parser:r}=e,a=!1,o=!1,i=n[0]&&Ht(n[0],"ordgroup");if(i)for(var l="",s=0;s<i.body.length;++s){if("t"===(l=i.body[s].text))a=!0;else{if("b"!==l){a=!1,o=!1;break}o=!0}}else a=!0,o=!0;var c=t[0];return{type:"smash",mode:r.mode,body:c,smashHeight:a,smashDepth:o}},htmlBuilder:(e,t)=>{var n=Je.makeSpan([],[St(e.body,t)]);if(!e.smashHeight&&!e.smashDepth)return n;if(e.smashHeight&&(n.height=0,n.children))for(var r=0;r<n.children.length;r++)n.children[r].height=0;if(e.smashDepth&&(n.depth=0,n.children))for(var a=0;a<n.children.length;a++)n.children[a].depth=0;var o=Je.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n}]},t);return Je.makeSpan(["mord"],[o],t)},mathmlBuilder:(e,t)=>{var n=new It.MathNode("mpadded",[Ot(e.body,t)]);return e.smashHeight&&n.setAttribute("height","0px"),e.smashDepth&&n.setAttribute("depth","0px"),n}}),lt({type:"sqrt",names:["\\sqrt"],props:{numArgs:1,numOptionalArgs:1},handler(e,t,n){var{parser:r}=e,a=n[0],o=t[0];return{type:"sqrt",mode:r.mode,body:o,index:a}},htmlBuilder(e,t){var n=St(e.body,t.havingCrampedStyle());0===n.height&&(n.height=t.fontMetrics().xHeight),n=Je.wrapFragment(n,t);var r=t.fontMetrics().defaultRuleThickness,a=r;t.style.id<S.TEXT.id&&(a=t.fontMetrics().xHeight);var o=r+a/4,i=n.height+n.depth+o+r,{span:l,ruleWidth:s,advanceWidth:c}=jn.sqrtImage(i,t),u=l.height-s;u>n.height+n.depth+o&&(o=(o+u-n.height-n.depth)/2);var d=l.height-n.height-o-s;n.style.paddingLeft=U(c);var p=Je.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n,wrapperClasses:["svg-align"]},{type:"kern",size:-(n.height+d)},{type:"elem",elem:l},{type:"kern",size:s}]},t);if(e.index){var f=t.havingStyle(S.SCRIPTSCRIPT),h=St(e.index,f,t),g=.6*(p.height-p.depth),m=Je.makeVList({positionType:"shift",positionData:-g,children:[{type:"elem",elem:h}]},t),v=Je.makeSpan(["root"],[m]);return Je.makeSpan(["mord","sqrt"],[v,p],t)}return Je.makeSpan(["mord","sqrt"],[p],t)},mathmlBuilder(e,t){var{body:n,index:r}=e;return r?new It.MathNode("mroot",[Ot(n,t),Ot(r,t)]):new It.MathNode("msqrt",[Ot(n,t)])}});var br={display:S.DISPLAY,text:S.TEXT,script:S.SCRIPT,scriptscript:S.SCRIPTSCRIPT};lt({type:"styling",names:["\\displaystyle","\\textstyle","\\scriptstyle","\\scriptscriptstyle"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(e,t){var{breakOnTokenText:n,funcName:r,parser:a}=e,o=a.parseExpression(!0,n),i=r.slice(1,r.length-5);return{type:"styling",mode:a.mode,style:i,body:o}},htmlBuilder(e,t){var n=br[e.style],r=t.havingStyle(n).withFont("");return vr(e.body,r,t)},mathmlBuilder(e,t){var n=br[e.style],r=t.havingStyle(n),a=Bt(e.body,r),o=new It.MathNode("mstyle",a),i={display:["0","true"],text:["0","false"],script:["1","false"],scriptscript:["2","false"]}[e.style];return o.setAttribute("scriptlevel",i[0]),o.setAttribute("displaystyle",i[1]),o}});st({type:"supsub",htmlBuilder(e,t){var n=function(e,t){var n=e.base;return n?"op"===n.type?n.limits&&(t.style.size===S.DISPLAY.size||n.alwaysHandleSupSub)?pr:null:"operatorname"===n.type?n.alwaysHandleSupSub&&(t.style.size===S.DISPLAY.size||n.limits)?mr:null:"accent"===n.type?u.isCharacterBox(n.base)?Wt:null:"horizBrace"===n.type&&!e.sub===n.isOver?lr:null:null}(e,t);if(n)return n(e,t);var r,a,o,{base:i,sup:l,sub:s}=e,c=St(i,t),d=t.fontMetrics(),p=0,f=0,h=i&&u.isCharacterBox(i);if(l){var g=t.havingStyle(t.style.sup());r=St(l,g,t),h||(p=c.height-g.fontMetrics().supDrop*g.sizeMultiplier/t.sizeMultiplier)}if(s){var m=t.havingStyle(t.style.sub());a=St(s,m,t),h||(f=c.depth+m.fontMetrics().subDrop*m.sizeMultiplier/t.sizeMultiplier)}o=t.style===S.DISPLAY?d.sup1:t.style.cramped?d.sup3:d.sup2;var v,y=t.sizeMultiplier,b=U(.5/d.ptPerEm/y),x=null;if(a){var w=e.base&&"op"===e.base.type&&e.base.name&&("\\oiint"===e.base.name||"\\oiiint"===e.base.name);(c instanceof J||w)&&(x=U(-c.italic))}if(r&&a){p=Math.max(p,o,r.depth+.25*d.xHeight),f=Math.max(f,d.sub2);var k=4*d.defaultRuleThickness;if(p-r.depth-(a.height-f)<k){f=k-(p-r.depth)+a.height;var C=.8*d.xHeight-(p-r.depth);C>0&&(p+=C,f-=C)}var E=[{type:"elem",elem:a,shift:f,marginRight:b,marginLeft:x},{type:"elem",elem:r,shift:-p,marginRight:b}];v=Je.makeVList({positionType:"individualShift",children:E},t)}else if(a){f=Math.max(f,d.sub1,a.height-.8*d.xHeight);var A=[{type:"elem",elem:a,marginLeft:x,marginRight:b}];v=Je.makeVList({positionType:"shift",positionData:f,children:A},t)}else{if(!r)throw new Error("supsub must have either sup or sub.");p=Math.max(p,o,r.depth+.25*d.xHeight),v=Je.makeVList({positionType:"shift",positionData:-p,children:[{type:"elem",elem:r,marginRight:b}]},t)}var T=xt(c,"right")||"mord";return Je.makeSpan([T],[c,Je.makeSpan(["msupsub"],[v])],t)},mathmlBuilder(e,t){var n,r=!1;e.base&&"horizBrace"===e.base.type&&!!e.sup===e.base.isOver&&(r=!0,n=e.base.isOver),!e.base||"op"!==e.base.type&&"operatorname"!==e.base.type||(e.base.parentIsSupSub=!0);var a,o=[Ot(e.base,t)];if(e.sub&&o.push(Ot(e.sub,t)),e.sup&&o.push(Ot(e.sup,t)),r)a=n?"mover":"munder";else if(e.sub)if(e.sup){var i=e.base;a=i&&"op"===i.type&&i.limits&&t.style===S.DISPLAY||i&&"operatorname"===i.type&&i.alwaysHandleSupSub&&(t.style===S.DISPLAY||i.limits)?"munderover":"msubsup"}else{var l=e.base;a=l&&"op"===l.type&&l.limits&&(t.style===S.DISPLAY||l.alwaysHandleSupSub)||l&&"operatorname"===l.type&&l.alwaysHandleSupSub&&(l.limits||t.style===S.DISPLAY)?"munder":"msub"}else{var s=e.base;a=s&&"op"===s.type&&s.limits&&(t.style===S.DISPLAY||s.alwaysHandleSupSub)||s&&"operatorname"===s.type&&s.alwaysHandleSupSub&&(s.limits||t.style===S.DISPLAY)?"mover":"msup"}return new It.MathNode(a,o)}}),st({type:"atom",htmlBuilder:(e,t)=>Je.mathsym(e.text,e.mode,t,["m"+e.family]),mathmlBuilder(e,t){var n=new It.MathNode("mo",[zt(e.text,e.mode)]);if("bin"===e.family){var r=Mt(e,t);"bold-italic"===r&&n.setAttribute("mathvariant",r)}else"punct"===e.family?n.setAttribute("separator","true"):"open"!==e.family&&"close"!==e.family||n.setAttribute("stretchy","false");return n}});var xr={mi:"italic",mn:"normal",mtext:"normal"};st({type:"mathord",htmlBuilder:(e,t)=>Je.makeOrd(e,t,"mathord"),mathmlBuilder(e,t){var n=new It.MathNode("mi",[zt(e.text,e.mode,t)]),r=Mt(e,t)||"italic";return r!==xr[n.type]&&n.setAttribute("mathvariant",r),n}}),st({type:"textord",htmlBuilder:(e,t)=>Je.makeOrd(e,t,"textord"),mathmlBuilder(e,t){var n,r=zt(e.text,e.mode,t),a=Mt(e,t)||"normal";return n="text"===e.mode?new It.MathNode("mtext",[r]):/[0-9]/.test(e.text)?new It.MathNode("mn",[r]):"\\prime"===e.text?new It.MathNode("mo",[r]):new It.MathNode("mi",[r]),a!==xr[n.type]&&n.setAttribute("mathvariant",a),n}});var wr={"\\nobreak":"nobreak","\\allowbreak":"allowbreak"},Sr={" ":{},"\\ ":{},"~":{className:"nobreak"},"\\space":{},"\\nobreakspace":{className:"nobreak"}};st({type:"spacing",htmlBuilder(e,t){if(Sr.hasOwnProperty(e.text)){var n=Sr[e.text].className||"";if("text"===e.mode){var r=Je.makeOrd(e,t,"textord");return r.classes.push(n),r}return Je.makeSpan(["mspace",n],[Je.mathsym(e.text,e.mode,t)],t)}if(wr.hasOwnProperty(e.text))return Je.makeSpan(["mspace",wr[e.text]],[],t);throw new o('Unknown type of space "'+e.text+'"')},mathmlBuilder(e,t){if(!Sr.hasOwnProperty(e.text)){if(wr.hasOwnProperty(e.text))return new It.MathNode("mspace");throw new o('Unknown type of space "'+e.text+'"')}return new It.MathNode("mtext",[new It.TextNode("\xa0")])}});var kr=()=>{var e=new It.MathNode("mtd",[]);return e.setAttribute("width","50%"),e};st({type:"tag",mathmlBuilder(e,t){var n=new It.MathNode("mtable",[new It.MathNode("mtr",[kr(),new It.MathNode("mtd",[Rt(e.body,t)]),kr(),new It.MathNode("mtd",[Rt(e.tag,t)])])]);return n.setAttribute("width","100%"),n}});var Cr={"\\text":void 0,"\\textrm":"textrm","\\textsf":"textsf","\\texttt":"texttt","\\textnormal":"textrm"},Er={"\\textbf":"textbf","\\textmd":"textmd"},Ar={"\\textit":"textit","\\textup":"textup"},Tr=(e,t)=>{var n=e.font;return n?Cr[n]?t.withTextFontFamily(Cr[n]):Er[n]?t.withTextFontWeight(Er[n]):"\\emph"===n?"textit"===t.fontShape?t.withTextFontShape("textup"):t.withTextFontShape("textit"):t.withTextFontShape(Ar[n]):t};lt({type:"text",names:["\\text","\\textrm","\\textsf","\\texttt","\\textnormal","\\textbf","\\textmd","\\textit","\\textup","\\emph"],props:{numArgs:1,argTypes:["text"],allowedInArgument:!0,allowedInText:!0},handler(e,t){var{parser:n,funcName:r}=e,a=t[0];return{type:"text",mode:n.mode,body:ut(a),font:r}},htmlBuilder(e,t){var n=Tr(e,t),r=mt(e.body,n,!0);return Je.makeSpan(["mord","text"],r,n)},mathmlBuilder(e,t){var n=Tr(e,t);return Rt(e.body,n)}}),lt({type:"underline",names:["\\underline"],props:{numArgs:1,allowedInText:!0},handler(e,t){var{parser:n}=e;return{type:"underline",mode:n.mode,body:t[0]}},htmlBuilder(e,t){var n=St(e.body,t),r=Je.makeLineSpan("underline-line",t),a=t.fontMetrics().defaultRuleThickness,o=Je.makeVList({positionType:"top",positionData:n.height,children:[{type:"kern",size:a},{type:"elem",elem:r},{type:"kern",size:3*a},{type:"elem",elem:n}]},t);return Je.makeSpan(["mord","underline"],[o],t)},mathmlBuilder(e,t){var n=new It.MathNode("mo",[new It.TextNode("\u203e")]);n.setAttribute("stretchy","true");var r=new It.MathNode("munder",[Ot(e.body,t),n]);return r.setAttribute("accentunder","true"),r}}),lt({type:"vcenter",names:["\\vcenter"],props:{numArgs:1,argTypes:["original"],allowedInText:!1},handler(e,t){var{parser:n}=e;return{type:"vcenter",mode:n.mode,body:t[0]}},htmlBuilder(e,t){var n=St(e.body,t),r=t.fontMetrics().axisHeight,a=.5*(n.height-r-(n.depth+r));return Je.makeVList({positionType:"shift",positionData:a,children:[{type:"elem",elem:n}]},t)},mathmlBuilder:(e,t)=>new It.MathNode("mpadded",[Ot(e.body,t)],["vcenter"])}),lt({type:"verb",names:["\\verb"],props:{numArgs:0,allowedInText:!0},handler(e,t,n){throw new o("\\verb ended by end of line instead of matching delimiter")},htmlBuilder(e,t){for(var n=Ir(e),r=[],a=t.havingStyle(t.style.text()),o=0;o<n.length;o++){var i=n[o];"~"===i&&(i="\\textasciitilde"),r.push(Je.makeSymbol(i,"Typewriter-Regular",e.mode,a,["mord","texttt"]))}return Je.makeSpan(["mord","text"].concat(a.sizingClasses(t)),Je.tryCombineChars(r),a)},mathmlBuilder(e,t){var n=new It.TextNode(Ir(e)),r=new It.MathNode("mtext",[n]);return r.setAttribute("mathvariant","monospace"),r}});var Ir=e=>e.body.replace(/ /g,e.star?"\u2423":"\xa0"),zr=at,Fr="[ \r\n\t]",Mr="(\\\\[a-zA-Z@]+)"+Fr+"*",jr="[\u0300-\u036f]",Br=new RegExp(jr+"+$"),Rr="("+Fr+"+)|\\\\(\n|[ \r\t]+\n?)[ \r\t]*|([!-\\[\\]-\u2027\u202a-\ud7ff\uf900-\uffff]"+jr+"*|[\ud800-\udbff][\udc00-\udfff]"+jr+"*|\\\\verb\\*([^]).*?\\4|\\\\verb([^*a-zA-Z]).*?\\5|"+Mr+"|\\\\[^\ud800-\udfff])";class Or{constructor(e,t){this.input=void 0,this.settings=void 0,this.tokenRegex=void 0,this.catcodes=void 0,this.input=e,this.settings=t,this.tokenRegex=new RegExp(Rr,"g"),this.catcodes={"%":14,"~":13}}setCatcode(e,t){this.catcodes[e]=t}lex(){var e=this.input,t=this.tokenRegex.lastIndex;if(t===e.length)return new a("EOF",new r(this,t,t));var n=this.tokenRegex.exec(e);if(null===n||n.index!==t)throw new o("Unexpected character: '"+e[t]+"'",new a(e[t],new r(this,t,t+1)));var i=n[6]||n[3]||(n[2]?"\\ ":" ");if(14===this.catcodes[i]){var l=e.indexOf("\n",this.tokenRegex.lastIndex);return-1===l?(this.tokenRegex.lastIndex=e.length,this.settings.reportNonstrict("commentAtEnd","% comment has no terminating newline; LaTeX would fail because of commenting the end of math mode (e.g. $)")):this.tokenRegex.lastIndex=l+1,this.lex()}return new a(i,new r(this,t,this.tokenRegex.lastIndex))}}class Lr{constructor(e,t){void 0===e&&(e={}),void 0===t&&(t={}),this.current=void 0,this.builtins=void 0,this.undefStack=void 0,this.current=t,this.builtins=e,this.undefStack=[]}beginGroup(){this.undefStack.push({})}endGroup(){if(0===this.undefStack.length)throw new o("Unbalanced namespace destruction: attempt to pop global namespace; please report this as a bug");var e=this.undefStack.pop();for(var t in e)e.hasOwnProperty(t)&&(null==e[t]?delete this.current[t]:this.current[t]=e[t])}endGroups(){for(;this.undefStack.length>0;)this.endGroup()}has(e){return this.current.hasOwnProperty(e)||this.builtins.hasOwnProperty(e)}get(e){return this.current.hasOwnProperty(e)?this.current[e]:this.builtins[e]}set(e,t,n){if(void 0===n&&(n=!1),n){for(var r=0;r<this.undefStack.length;r++)delete this.undefStack[r][e];this.undefStack.length>0&&(this.undefStack[this.undefStack.length-1][e]=t)}else{var a=this.undefStack[this.undefStack.length-1];a&&!a.hasOwnProperty(e)&&(a[e]=this.current[e])}null==t?delete this.current[e]:this.current[e]=t}}var Nr=qn;Un("\\noexpand",(function(e){var t=e.popToken();return e.isExpandable(t.text)&&(t.noexpand=!0,t.treatAsRelax=!0),{tokens:[t],numArgs:0}})),Un("\\expandafter",(function(e){var t=e.popToken();return e.expandOnce(!0),{tokens:[t],numArgs:0}})),Un("\\@firstoftwo",(function(e){return{tokens:e.consumeArgs(2)[0],numArgs:0}})),Un("\\@secondoftwo",(function(e){return{tokens:e.consumeArgs(2)[1],numArgs:0}})),Un("\\@ifnextchar",(function(e){var t=e.consumeArgs(3);e.consumeSpaces();var n=e.future();return 1===t[0].length&&t[0][0].text===n.text?{tokens:t[1],numArgs:0}:{tokens:t[2],numArgs:0}})),Un("\\@ifstar","\\@ifnextchar *{\\@firstoftwo{#1}}"),Un("\\TextOrMath",(function(e){var t=e.consumeArgs(2);return"text"===e.mode?{tokens:t[0],numArgs:0}:{tokens:t[1],numArgs:0}}));var Pr={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15};Un("\\char",(function(e){var t,n=e.popToken(),r="";if("'"===n.text)t=8,n=e.popToken();else if('"'===n.text)t=16,n=e.popToken();else if("`"===n.text)if("\\"===(n=e.popToken()).text[0])r=n.text.charCodeAt(1);else{if("EOF"===n.text)throw new o("\\char` missing argument");r=n.text.charCodeAt(0)}else t=10;if(t){if(null==(r=Pr[n.text])||r>=t)throw new o("Invalid base-"+t+" digit "+n.text);for(var a;null!=(a=Pr[e.future().text])&&a<t;)r*=t,r+=a,e.popToken()}return"\\@char{"+r+"}"}));var _r=(e,t,n,r)=>{var a=e.consumeArg().tokens;if(1!==a.length)throw new o("\\newcommand's first argument must be a macro name");var i=a[0].text,l=e.isDefined(i);if(l&&!t)throw new o("\\newcommand{"+i+"} attempting to redefine "+i+"; use \\renewcommand");if(!l&&!n)throw new o("\\renewcommand{"+i+"} when command "+i+" does not yet exist; use \\newcommand");var s=0;if(1===(a=e.consumeArg().tokens).length&&"["===a[0].text){for(var c="",u=e.expandNextToken();"]"!==u.text&&"EOF"!==u.text;)c+=u.text,u=e.expandNextToken();if(!c.match(/^\s*[0-9]+\s*$/))throw new o("Invalid number of arguments: "+c);s=parseInt(c),a=e.consumeArg().tokens}return l&&r||e.macros.set(i,{tokens:a,numArgs:s}),""};Un("\\newcommand",(e=>_r(e,!1,!0,!1))),Un("\\renewcommand",(e=>_r(e,!0,!1,!1))),Un("\\providecommand",(e=>_r(e,!0,!0,!0))),Un("\\message",(e=>{var t=e.consumeArgs(1)[0];return console.log(t.reverse().map((e=>e.text)).join("")),""})),Un("\\errmessage",(e=>{var t=e.consumeArgs(1)[0];return console.error(t.reverse().map((e=>e.text)).join("")),""})),Un("\\show",(e=>{var t=e.popToken(),n=t.text;return console.log(t,e.macros.get(n),zr[n],oe.math[n],oe.text[n]),""})),Un("\\bgroup","{"),Un("\\egroup","}"),Un("~","\\nobreakspace"),Un("\\lq","`"),Un("\\rq","'"),Un("\\aa","\\r a"),Un("\\AA","\\r A"),Un("\\textcopyright","\\html@mathml{\\textcircled{c}}{\\char`\xa9}"),Un("\\copyright","\\TextOrMath{\\textcopyright}{\\text{\\textcopyright}}"),Un("\\textregistered","\\html@mathml{\\textcircled{\\scriptsize R}}{\\char`\xae}"),Un("\u212c","\\mathscr{B}"),Un("\u2130","\\mathscr{E}"),Un("\u2131","\\mathscr{F}"),Un("\u210b","\\mathscr{H}"),Un("\u2110","\\mathscr{I}"),Un("\u2112","\\mathscr{L}"),Un("\u2133","\\mathscr{M}"),Un("\u211b","\\mathscr{R}"),Un("\u212d","\\mathfrak{C}"),Un("\u210c","\\mathfrak{H}"),Un("\u2128","\\mathfrak{Z}"),Un("\\Bbbk","\\Bbb{k}"),Un("\xb7","\\cdotp"),Un("\\llap","\\mathllap{\\textrm{#1}}"),Un("\\rlap","\\mathrlap{\\textrm{#1}}"),Un("\\clap","\\mathclap{\\textrm{#1}}"),Un("\\mathstrut","\\vphantom{(}"),Un("\\underbar","\\underline{\\text{#1}}"),Un("\\not",'\\html@mathml{\\mathrel{\\mathrlap\\@not}}{\\char"338}'),Un("\\neq","\\html@mathml{\\mathrel{\\not=}}{\\mathrel{\\char`\u2260}}"),Un("\\ne","\\neq"),Un("\u2260","\\neq"),Un("\\notin","\\html@mathml{\\mathrel{{\\in}\\mathllap{/\\mskip1mu}}}{\\mathrel{\\char`\u2209}}"),Un("\u2209","\\notin"),Un("\u2258","\\html@mathml{\\mathrel{=\\kern{-1em}\\raisebox{0.4em}{$\\scriptsize\\frown$}}}{\\mathrel{\\char`\u2258}}"),Un("\u2259","\\html@mathml{\\stackrel{\\tiny\\wedge}{=}}{\\mathrel{\\char`\u2258}}"),Un("\u225a","\\html@mathml{\\stackrel{\\tiny\\vee}{=}}{\\mathrel{\\char`\u225a}}"),Un("\u225b","\\html@mathml{\\stackrel{\\scriptsize\\star}{=}}{\\mathrel{\\char`\u225b}}"),Un("\u225d","\\html@mathml{\\stackrel{\\tiny\\mathrm{def}}{=}}{\\mathrel{\\char`\u225d}}"),Un("\u225e","\\html@mathml{\\stackrel{\\tiny\\mathrm{m}}{=}}{\\mathrel{\\char`\u225e}}"),Un("\u225f","\\html@mathml{\\stackrel{\\tiny?}{=}}{\\mathrel{\\char`\u225f}}"),Un("\u27c2","\\perp"),Un("\u203c","\\mathclose{!\\mkern-0.8mu!}"),Un("\u220c","\\notni"),Un("\u231c","\\ulcorner"),Un("\u231d","\\urcorner"),Un("\u231e","\\llcorner"),Un("\u231f","\\lrcorner"),Un("\xa9","\\copyright"),Un("\xae","\\textregistered"),Un("\ufe0f","\\textregistered"),Un("\\ulcorner",'\\html@mathml{\\@ulcorner}{\\mathop{\\char"231c}}'),Un("\\urcorner",'\\html@mathml{\\@urcorner}{\\mathop{\\char"231d}}'),Un("\\llcorner",'\\html@mathml{\\@llcorner}{\\mathop{\\char"231e}}'),Un("\\lrcorner",'\\html@mathml{\\@lrcorner}{\\mathop{\\char"231f}}'),Un("\\vdots","{\\varvdots\\rule{0pt}{15pt}}"),Un("\u22ee","\\vdots"),Un("\\varGamma","\\mathit{\\Gamma}"),Un("\\varDelta","\\mathit{\\Delta}"),Un("\\varTheta","\\mathit{\\Theta}"),Un("\\varLambda","\\mathit{\\Lambda}"),Un("\\varXi","\\mathit{\\Xi}"),Un("\\varPi","\\mathit{\\Pi}"),Un("\\varSigma","\\mathit{\\Sigma}"),Un("\\varUpsilon","\\mathit{\\Upsilon}"),Un("\\varPhi","\\mathit{\\Phi}"),Un("\\varPsi","\\mathit{\\Psi}"),Un("\\varOmega","\\mathit{\\Omega}"),Un("\\substack","\\begin{subarray}{c}#1\\end{subarray}"),Un("\\colon","\\nobreak\\mskip2mu\\mathpunct{}\\mathchoice{\\mkern-3mu}{\\mkern-3mu}{}{}{:}\\mskip6mu\\relax"),Un("\\boxed","\\fbox{$\\displaystyle{#1}$}"),Un("\\iff","\\DOTSB\\;\\Longleftrightarrow\\;"),Un("\\implies","\\DOTSB\\;\\Longrightarrow\\;"),Un("\\impliedby","\\DOTSB\\;\\Longleftarrow\\;"),Un("\\dddot","{\\overset{\\raisebox{-0.1ex}{\\normalsize ...}}{#1}}"),Un("\\ddddot","{\\overset{\\raisebox{-0.1ex}{\\normalsize ....}}{#1}}");var Dr={",":"\\dotsc","\\not":"\\dotsb","+":"\\dotsb","=":"\\dotsb","<":"\\dotsb",">":"\\dotsb","-":"\\dotsb","*":"\\dotsb",":":"\\dotsb","\\DOTSB":"\\dotsb","\\coprod":"\\dotsb","\\bigvee":"\\dotsb","\\bigwedge":"\\dotsb","\\biguplus":"\\dotsb","\\bigcap":"\\dotsb","\\bigcup":"\\dotsb","\\prod":"\\dotsb","\\sum":"\\dotsb","\\bigotimes":"\\dotsb","\\bigoplus":"\\dotsb","\\bigodot":"\\dotsb","\\bigsqcup":"\\dotsb","\\And":"\\dotsb","\\longrightarrow":"\\dotsb","\\Longrightarrow":"\\dotsb","\\longleftarrow":"\\dotsb","\\Longleftarrow":"\\dotsb","\\longleftrightarrow":"\\dotsb","\\Longleftrightarrow":"\\dotsb","\\mapsto":"\\dotsb","\\longmapsto":"\\dotsb","\\hookrightarrow":"\\dotsb","\\doteq":"\\dotsb","\\mathbin":"\\dotsb","\\mathrel":"\\dotsb","\\relbar":"\\dotsb","\\Relbar":"\\dotsb","\\xrightarrow":"\\dotsb","\\xleftarrow":"\\dotsb","\\DOTSI":"\\dotsi","\\int":"\\dotsi","\\oint":"\\dotsi","\\iint":"\\dotsi","\\iiint":"\\dotsi","\\iiiint":"\\dotsi","\\idotsint":"\\dotsi","\\DOTSX":"\\dotsx"};Un("\\dots",(function(e){var t="\\dotso",n=e.expandAfterFuture().text;return n in Dr?t=Dr[n]:("\\not"===n.slice(0,4)||n in oe.math&&u.contains(["bin","rel"],oe.math[n].group))&&(t="\\dotsb"),t}));var qr={")":!0,"]":!0,"\\rbrack":!0,"\\}":!0,"\\rbrace":!0,"\\rangle":!0,"\\rceil":!0,"\\rfloor":!0,"\\rgroup":!0,"\\rmoustache":!0,"\\right":!0,"\\bigr":!0,"\\biggr":!0,"\\Bigr":!0,"\\Biggr":!0,$:!0,";":!0,".":!0,",":!0};Un("\\dotso",(function(e){return e.future().text in qr?"\\ldots\\,":"\\ldots"})),Un("\\dotsc",(function(e){var t=e.future().text;return t in qr&&","!==t?"\\ldots\\,":"\\ldots"})),Un("\\cdots",(function(e){return e.future().text in qr?"\\@cdots\\,":"\\@cdots"})),Un("\\dotsb","\\cdots"),Un("\\dotsm","\\cdots"),Un("\\dotsi","\\!\\cdots"),Un("\\dotsx","\\ldots\\,"),Un("\\DOTSI","\\relax"),Un("\\DOTSB","\\relax"),Un("\\DOTSX","\\relax"),Un("\\tmspace","\\TextOrMath{\\kern#1#3}{\\mskip#1#2}\\relax"),Un("\\,","\\tmspace+{3mu}{.1667em}"),Un("\\thinspace","\\,"),Un("\\>","\\mskip{4mu}"),Un("\\:","\\tmspace+{4mu}{.2222em}"),Un("\\medspace","\\:"),Un("\\;","\\tmspace+{5mu}{.2777em}"),Un("\\thickspace","\\;"),Un("\\!","\\tmspace-{3mu}{.1667em}"),Un("\\negthinspace","\\!"),Un("\\negmedspace","\\tmspace-{4mu}{.2222em}"),Un("\\negthickspace","\\tmspace-{5mu}{.277em}"),Un("\\enspace","\\kern.5em "),Un("\\enskip","\\hskip.5em\\relax"),Un("\\quad","\\hskip1em\\relax"),Un("\\qquad","\\hskip2em\\relax"),Un("\\tag","\\@ifstar\\tag@literal\\tag@paren"),Un("\\tag@paren","\\tag@literal{({#1})}"),Un("\\tag@literal",(e=>{if(e.macros.get("\\df@tag"))throw new o("Multiple \\tag");return"\\gdef\\df@tag{\\text{#1}}"})),Un("\\bmod","\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}\\mathbin{\\rm mod}\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}"),Un("\\pod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern8mu}{\\mkern8mu}{\\mkern8mu}(#1)"),Un("\\pmod","\\pod{{\\rm mod}\\mkern6mu#1}"),Un("\\mod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern12mu}{\\mkern12mu}{\\mkern12mu}{\\rm mod}\\,\\,#1"),Un("\\newline","\\\\\\relax"),Un("\\TeX","\\textrm{\\html@mathml{T\\kern-.1667em\\raisebox{-.5ex}{E}\\kern-.125emX}{TeX}}");var Ur=U(z["Main-Regular"]["T".charCodeAt(0)][1]-.7*z["Main-Regular"]["A".charCodeAt(0)][1]);Un("\\LaTeX","\\textrm{\\html@mathml{L\\kern-.36em\\raisebox{"+Ur+"}{\\scriptstyle A}\\kern-.15em\\TeX}{LaTeX}}"),Un("\\KaTeX","\\textrm{\\html@mathml{K\\kern-.17em\\raisebox{"+Ur+"}{\\scriptstyle A}\\kern-.15em\\TeX}{KaTeX}}"),Un("\\hspace","\\@ifstar\\@hspacer\\@hspace"),Un("\\@hspace","\\hskip #1\\relax"),Un("\\@hspacer","\\rule{0pt}{0pt}\\hskip #1\\relax"),Un("\\ordinarycolon",":"),Un("\\vcentcolon","\\mathrel{\\mathop\\ordinarycolon}"),Un("\\dblcolon",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-.9mu}\\vcentcolon}}{\\mathop{\\char"2237}}'),Un("\\coloneqq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2254}}'),Un("\\Coloneqq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2237\\char"3d}}'),Un("\\coloneq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"3a\\char"2212}}'),Un("\\Coloneq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"2237\\char"2212}}'),Un("\\eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2255}}'),Un("\\Eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"3d\\char"2237}}'),Un("\\eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2239}}'),Un("\\Eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"2212\\char"2237}}'),Un("\\colonapprox",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"3a\\char"2248}}'),Un("\\Colonapprox",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"2237\\char"2248}}'),Un("\\colonsim",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"3a\\char"223c}}'),Un("\\Colonsim",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"2237\\char"223c}}'),Un("\u2237","\\dblcolon"),Un("\u2239","\\eqcolon"),Un("\u2254","\\coloneqq"),Un("\u2255","\\eqqcolon"),Un("\u2a74","\\Coloneqq"),Un("\\ratio","\\vcentcolon"),Un("\\coloncolon","\\dblcolon"),Un("\\colonequals","\\coloneqq"),Un("\\coloncolonequals","\\Coloneqq"),Un("\\equalscolon","\\eqqcolon"),Un("\\equalscoloncolon","\\Eqqcolon"),Un("\\colonminus","\\coloneq"),Un("\\coloncolonminus","\\Coloneq"),Un("\\minuscolon","\\eqcolon"),Un("\\minuscoloncolon","\\Eqcolon"),Un("\\coloncolonapprox","\\Colonapprox"),Un("\\coloncolonsim","\\Colonsim"),Un("\\simcolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\vcentcolon}"),Un("\\simcoloncolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\dblcolon}"),Un("\\approxcolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\vcentcolon}"),Un("\\approxcoloncolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\dblcolon}"),Un("\\notni","\\html@mathml{\\not\\ni}{\\mathrel{\\char`\u220c}}"),Un("\\limsup","\\DOTSB\\operatorname*{lim\\,sup}"),Un("\\liminf","\\DOTSB\\operatorname*{lim\\,inf}"),Un("\\injlim","\\DOTSB\\operatorname*{inj\\,lim}"),Un("\\projlim","\\DOTSB\\operatorname*{proj\\,lim}"),Un("\\varlimsup","\\DOTSB\\operatorname*{\\overline{lim}}"),Un("\\varliminf","\\DOTSB\\operatorname*{\\underline{lim}}"),Un("\\varinjlim","\\DOTSB\\operatorname*{\\underrightarrow{lim}}"),Un("\\varprojlim","\\DOTSB\\operatorname*{\\underleftarrow{lim}}"),Un("\\gvertneqq","\\html@mathml{\\@gvertneqq}{\u2269}"),Un("\\lvertneqq","\\html@mathml{\\@lvertneqq}{\u2268}"),Un("\\ngeqq","\\html@mathml{\\@ngeqq}{\u2271}"),Un("\\ngeqslant","\\html@mathml{\\@ngeqslant}{\u2271}"),Un("\\nleqq","\\html@mathml{\\@nleqq}{\u2270}"),Un("\\nleqslant","\\html@mathml{\\@nleqslant}{\u2270}"),Un("\\nshortmid","\\html@mathml{\\@nshortmid}{\u2224}"),Un("\\nshortparallel","\\html@mathml{\\@nshortparallel}{\u2226}"),Un("\\nsubseteqq","\\html@mathml{\\@nsubseteqq}{\u2288}"),Un("\\nsupseteqq","\\html@mathml{\\@nsupseteqq}{\u2289}"),Un("\\varsubsetneq","\\html@mathml{\\@varsubsetneq}{\u228a}"),Un("\\varsubsetneqq","\\html@mathml{\\@varsubsetneqq}{\u2acb}"),Un("\\varsupsetneq","\\html@mathml{\\@varsupsetneq}{\u228b}"),Un("\\varsupsetneqq","\\html@mathml{\\@varsupsetneqq}{\u2acc}"),Un("\\imath","\\html@mathml{\\@imath}{\u0131}"),Un("\\jmath","\\html@mathml{\\@jmath}{\u0237}"),Un("\\llbracket","\\html@mathml{\\mathopen{[\\mkern-3.2mu[}}{\\mathopen{\\char`\u27e6}}"),Un("\\rrbracket","\\html@mathml{\\mathclose{]\\mkern-3.2mu]}}{\\mathclose{\\char`\u27e7}}"),Un("\u27e6","\\llbracket"),Un("\u27e7","\\rrbracket"),Un("\\lBrace","\\html@mathml{\\mathopen{\\{\\mkern-3.2mu[}}{\\mathopen{\\char`\u2983}}"),Un("\\rBrace","\\html@mathml{\\mathclose{]\\mkern-3.2mu\\}}}{\\mathclose{\\char`\u2984}}"),Un("\u2983","\\lBrace"),Un("\u2984","\\rBrace"),Un("\\minuso","\\mathbin{\\html@mathml{{\\mathrlap{\\mathchoice{\\kern{0.145em}}{\\kern{0.145em}}{\\kern{0.1015em}}{\\kern{0.0725em}}\\circ}{-}}}{\\char`\u29b5}}"),Un("\u29b5","\\minuso"),Un("\\darr","\\downarrow"),Un("\\dArr","\\Downarrow"),Un("\\Darr","\\Downarrow"),Un("\\lang","\\langle"),Un("\\rang","\\rangle"),Un("\\uarr","\\uparrow"),Un("\\uArr","\\Uparrow"),Un("\\Uarr","\\Uparrow"),Un("\\N","\\mathbb{N}"),Un("\\R","\\mathbb{R}"),Un("\\Z","\\mathbb{Z}"),Un("\\alef","\\aleph"),Un("\\alefsym","\\aleph"),Un("\\Alpha","\\mathrm{A}"),Un("\\Beta","\\mathrm{B}"),Un("\\bull","\\bullet"),Un("\\Chi","\\mathrm{X}"),Un("\\clubs","\\clubsuit"),Un("\\cnums","\\mathbb{C}"),Un("\\Complex","\\mathbb{C}"),Un("\\Dagger","\\ddagger"),Un("\\diamonds","\\diamondsuit"),Un("\\empty","\\emptyset"),Un("\\Epsilon","\\mathrm{E}"),Un("\\Eta","\\mathrm{H}"),Un("\\exist","\\exists"),Un("\\harr","\\leftrightarrow"),Un("\\hArr","\\Leftrightarrow"),Un("\\Harr","\\Leftrightarrow"),Un("\\hearts","\\heartsuit"),Un("\\image","\\Im"),Un("\\infin","\\infty"),Un("\\Iota","\\mathrm{I}"),Un("\\isin","\\in"),Un("\\Kappa","\\mathrm{K}"),Un("\\larr","\\leftarrow"),Un("\\lArr","\\Leftarrow"),Un("\\Larr","\\Leftarrow"),Un("\\lrarr","\\leftrightarrow"),Un("\\lrArr","\\Leftrightarrow"),Un("\\Lrarr","\\Leftrightarrow"),Un("\\Mu","\\mathrm{M}"),Un("\\natnums","\\mathbb{N}"),Un("\\Nu","\\mathrm{N}"),Un("\\Omicron","\\mathrm{O}"),Un("\\plusmn","\\pm"),Un("\\rarr","\\rightarrow"),Un("\\rArr","\\Rightarrow"),Un("\\Rarr","\\Rightarrow"),Un("\\real","\\Re"),Un("\\reals","\\mathbb{R}"),Un("\\Reals","\\mathbb{R}"),Un("\\Rho","\\mathrm{P}"),Un("\\sdot","\\cdot"),Un("\\sect","\\S"),Un("\\spades","\\spadesuit"),Un("\\sub","\\subset"),Un("\\sube","\\subseteq"),Un("\\supe","\\supseteq"),Un("\\Tau","\\mathrm{T}"),Un("\\thetasym","\\vartheta"),Un("\\weierp","\\wp"),Un("\\Zeta","\\mathrm{Z}"),Un("\\argmin","\\DOTSB\\operatorname*{arg\\,min}"),Un("\\argmax","\\DOTSB\\operatorname*{arg\\,max}"),Un("\\plim","\\DOTSB\\mathop{\\operatorname{plim}}\\limits"),Un("\\bra","\\mathinner{\\langle{#1}|}"),Un("\\ket","\\mathinner{|{#1}\\rangle}"),Un("\\braket","\\mathinner{\\langle{#1}\\rangle}"),Un("\\Bra","\\left\\langle#1\\right|"),Un("\\Ket","\\left|#1\\right\\rangle");var $r=e=>t=>{var n=t.consumeArg().tokens,r=t.consumeArg().tokens,a=t.consumeArg().tokens,o=t.consumeArg().tokens,i=t.macros.get("|"),l=t.macros.get("\\|");t.macros.beginGroup();var s=t=>n=>{e&&(n.macros.set("|",i),a.length&&n.macros.set("\\|",l));var o=t;!t&&a.length&&("|"===n.future().text&&(n.popToken(),o=!0));return{tokens:o?a:r,numArgs:0}};t.macros.set("|",s(!1)),a.length&&t.macros.set("\\|",s(!0));var c=t.consumeArg().tokens,u=t.expandTokens([...o,...c,...n]);return t.macros.endGroup(),{tokens:u.reverse(),numArgs:0}};Un("\\bra@ket",$r(!1)),Un("\\bra@set",$r(!0)),Un("\\Braket","\\bra@ket{\\left\\langle}{\\,\\middle\\vert\\,}{\\,\\middle\\vert\\,}{\\right\\rangle}"),Un("\\Set","\\bra@set{\\left\\{\\:}{\\;\\middle\\vert\\;}{\\;\\middle\\Vert\\;}{\\:\\right\\}}"),Un("\\set","\\bra@set{\\{\\,}{\\mid}{}{\\,\\}}"),Un("\\angln","{\\angl n}"),Un("\\blue","\\textcolor{##6495ed}{#1}"),Un("\\orange","\\textcolor{##ffa500}{#1}"),Un("\\pink","\\textcolor{##ff00af}{#1}"),Un("\\red","\\textcolor{##df0030}{#1}"),Un("\\green","\\textcolor{##28ae7b}{#1}"),Un("\\gray","\\textcolor{gray}{#1}"),Un("\\purple","\\textcolor{##9d38bd}{#1}"),Un("\\blueA","\\textcolor{##ccfaff}{#1}"),Un("\\blueB","\\textcolor{##80f6ff}{#1}"),Un("\\blueC","\\textcolor{##63d9ea}{#1}"),Un("\\blueD","\\textcolor{##11accd}{#1}"),Un("\\blueE","\\textcolor{##0c7f99}{#1}"),Un("\\tealA","\\textcolor{##94fff5}{#1}"),Un("\\tealB","\\textcolor{##26edd5}{#1}"),Un("\\tealC","\\textcolor{##01d1c1}{#1}"),Un("\\tealD","\\textcolor{##01a995}{#1}"),Un("\\tealE","\\textcolor{##208170}{#1}"),Un("\\greenA","\\textcolor{##b6ffb0}{#1}"),Un("\\greenB","\\textcolor{##8af281}{#1}"),Un("\\greenC","\\textcolor{##74cf70}{#1}"),Un("\\greenD","\\textcolor{##1fab54}{#1}"),Un("\\greenE","\\textcolor{##0d923f}{#1}"),Un("\\goldA","\\textcolor{##ffd0a9}{#1}"),Un("\\goldB","\\textcolor{##ffbb71}{#1}"),Un("\\goldC","\\textcolor{##ff9c39}{#1}"),Un("\\goldD","\\textcolor{##e07d10}{#1}"),Un("\\goldE","\\textcolor{##a75a05}{#1}"),Un("\\redA","\\textcolor{##fca9a9}{#1}"),Un("\\redB","\\textcolor{##ff8482}{#1}"),Un("\\redC","\\textcolor{##f9685d}{#1}"),Un("\\redD","\\textcolor{##e84d39}{#1}"),Un("\\redE","\\textcolor{##bc2612}{#1}"),Un("\\maroonA","\\textcolor{##ffbde0}{#1}"),Un("\\maroonB","\\textcolor{##ff92c6}{#1}"),Un("\\maroonC","\\textcolor{##ed5fa6}{#1}"),Un("\\maroonD","\\textcolor{##ca337c}{#1}"),Un("\\maroonE","\\textcolor{##9e034e}{#1}"),Un("\\purpleA","\\textcolor{##ddd7ff}{#1}"),Un("\\purpleB","\\textcolor{##c6b9fc}{#1}"),Un("\\purpleC","\\textcolor{##aa87ff}{#1}"),Un("\\purpleD","\\textcolor{##7854ab}{#1}"),Un("\\purpleE","\\textcolor{##543b78}{#1}"),Un("\\mintA","\\textcolor{##f5f9e8}{#1}"),Un("\\mintB","\\textcolor{##edf2df}{#1}"),Un("\\mintC","\\textcolor{##e0e5cc}{#1}"),Un("\\grayA","\\textcolor{##f6f7f7}{#1}"),Un("\\grayB","\\textcolor{##f0f1f2}{#1}"),Un("\\grayC","\\textcolor{##e3e5e6}{#1}"),Un("\\grayD","\\textcolor{##d6d8da}{#1}"),Un("\\grayE","\\textcolor{##babec2}{#1}"),Un("\\grayF","\\textcolor{##888d93}{#1}"),Un("\\grayG","\\textcolor{##626569}{#1}"),Un("\\grayH","\\textcolor{##3b3e40}{#1}"),Un("\\grayI","\\textcolor{##21242c}{#1}"),Un("\\kaBlue","\\textcolor{##314453}{#1}"),Un("\\kaGreen","\\textcolor{##71B307}{#1}");var Hr={"^":!0,_:!0,"\\limits":!0,"\\nolimits":!0};class Vr{constructor(e,t,n){this.settings=void 0,this.expansionCount=void 0,this.lexer=void 0,this.macros=void 0,this.stack=void 0,this.mode=void 0,this.settings=t,this.expansionCount=0,this.feed(e),this.macros=new Lr(Nr,t.macros),this.mode=n,this.stack=[]}feed(e){this.lexer=new Or(e,this.settings)}switchMode(e){this.mode=e}beginGroup(){this.macros.beginGroup()}endGroup(){this.macros.endGroup()}endGroups(){this.macros.endGroups()}future(){return 0===this.stack.length&&this.pushToken(this.lexer.lex()),this.stack[this.stack.length-1]}popToken(){return this.future(),this.stack.pop()}pushToken(e){this.stack.push(e)}pushTokens(e){this.stack.push(...e)}scanArgument(e){var t,n,r;if(e){if(this.consumeSpaces(),"["!==this.future().text)return null;t=this.popToken(),({tokens:r,end:n}=this.consumeArg(["]"]))}else({tokens:r,start:t,end:n}=this.consumeArg());return this.pushToken(new a("EOF",n.loc)),this.pushTokens(r),t.range(n,"")}consumeSpaces(){for(;;){if(" "!==this.future().text)break;this.stack.pop()}}consumeArg(e){var t=[],n=e&&e.length>0;n||this.consumeSpaces();var r,a=this.future(),i=0,l=0;do{if(r=this.popToken(),t.push(r),"{"===r.text)++i;else if("}"===r.text){if(-1===--i)throw new o("Extra }",r)}else if("EOF"===r.text)throw new o("Unexpected end of input in a macro argument, expected '"+(e&&n?e[l]:"}")+"'",r);if(e&&n)if((0===i||1===i&&"{"===e[l])&&r.text===e[l]){if(++l===e.length){t.splice(-l,l);break}}else l=0}while(0!==i||n);return"{"===a.text&&"}"===t[t.length-1].text&&(t.pop(),t.shift()),t.reverse(),{tokens:t,start:a,end:r}}consumeArgs(e,t){if(t){if(t.length!==e+1)throw new o("The length of delimiters doesn't match the number of args!");for(var n=t[0],r=0;r<n.length;r++){var a=this.popToken();if(n[r]!==a.text)throw new o("Use of the macro doesn't match its definition",a)}}for(var i=[],l=0;l<e;l++)i.push(this.consumeArg(t&&t[l+1]).tokens);return i}countExpansion(e){if(this.expansionCount+=e,this.expansionCount>this.settings.maxExpand)throw new o("Too many expansions: infinite loop or need to increase maxExpand setting")}expandOnce(e){var t=this.popToken(),n=t.text,r=t.noexpand?null:this._getExpansion(n);if(null==r||e&&r.unexpandable){if(e&&null==r&&"\\"===n[0]&&!this.isDefined(n))throw new o("Undefined control sequence: "+n);return this.pushToken(t),!1}this.countExpansion(1);var a=r.tokens,i=this.consumeArgs(r.numArgs,r.delimiters);if(r.numArgs)for(var l=(a=a.slice()).length-1;l>=0;--l){var s=a[l];if("#"===s.text){if(0===l)throw new o("Incomplete placeholder at end of macro body",s);if("#"===(s=a[--l]).text)a.splice(l+1,1);else{if(!/^[1-9]$/.test(s.text))throw new o("Not a valid argument number",s);a.splice(l,2,...i[+s.text-1])}}}return this.pushTokens(a),a.length}expandAfterFuture(){return this.expandOnce(),this.future()}expandNextToken(){for(;;)if(!1===this.expandOnce()){var e=this.stack.pop();return e.treatAsRelax&&(e.text="\\relax"),e}throw new Error}expandMacro(e){return this.macros.has(e)?this.expandTokens([new a(e)]):void 0}expandTokens(e){var t=[],n=this.stack.length;for(this.pushTokens(e);this.stack.length>n;)if(!1===this.expandOnce(!0)){var r=this.stack.pop();r.treatAsRelax&&(r.noexpand=!1,r.treatAsRelax=!1),t.push(r)}return this.countExpansion(t.length),t}expandMacroAsText(e){var t=this.expandMacro(e);return t?t.map((e=>e.text)).join(""):t}_getExpansion(e){var t=this.macros.get(e);if(null==t)return t;if(1===e.length){var n=this.lexer.catcodes[e];if(null!=n&&13!==n)return}var r="function"==typeof t?t(this):t;if("string"==typeof r){var a=0;if(-1!==r.indexOf("#"))for(var o=r.replace(/##/g,"");-1!==o.indexOf("#"+(a+1));)++a;for(var i=new Or(r,this.settings),l=[],s=i.lex();"EOF"!==s.text;)l.push(s),s=i.lex();return l.reverse(),{tokens:l,numArgs:a}}return r}isDefined(e){return this.macros.has(e)||zr.hasOwnProperty(e)||oe.math.hasOwnProperty(e)||oe.text.hasOwnProperty(e)||Hr.hasOwnProperty(e)}isExpandable(e){var t=this.macros.get(e);return null!=t?"string"==typeof t||"function"==typeof t||!t.unexpandable:zr.hasOwnProperty(e)&&!zr[e].primitive}}var Gr=/^[\u208a\u208b\u208c\u208d\u208e\u2080\u2081\u2082\u2083\u2084\u2085\u2086\u2087\u2088\u2089\u2090\u2091\u2095\u1d62\u2c7c\u2096\u2097\u2098\u2099\u2092\u209a\u1d63\u209b\u209c\u1d64\u1d65\u2093\u1d66\u1d67\u1d68\u1d69\u1d6a]/,Wr=Object.freeze({"\u208a":"+","\u208b":"-","\u208c":"=","\u208d":"(","\u208e":")","\u2080":"0","\u2081":"1","\u2082":"2","\u2083":"3","\u2084":"4","\u2085":"5","\u2086":"6","\u2087":"7","\u2088":"8","\u2089":"9",\u2090:"a",\u2091:"e",\u2095:"h",\u1d62:"i",\u2c7c:"j",\u2096:"k",\u2097:"l",\u2098:"m",\u2099:"n",\u2092:"o",\u209a:"p",\u1d63:"r",\u209b:"s",\u209c:"t",\u1d64:"u",\u1d65:"v",\u2093:"x",\u1d66:"\u03b2",\u1d67:"\u03b3",\u1d68:"\u03c1",\u1d69:"\u03d5",\u1d6a:"\u03c7","\u207a":"+","\u207b":"-","\u207c":"=","\u207d":"(","\u207e":")","\u2070":"0","\xb9":"1","\xb2":"2","\xb3":"3","\u2074":"4","\u2075":"5","\u2076":"6","\u2077":"7","\u2078":"8","\u2079":"9",\u1d2c:"A",\u1d2e:"B",\u1d30:"D",\u1d31:"E",\u1d33:"G",\u1d34:"H",\u1d35:"I",\u1d36:"J",\u1d37:"K",\u1d38:"L",\u1d39:"M",\u1d3a:"N",\u1d3c:"O",\u1d3e:"P",\u1d3f:"R",\u1d40:"T",\u1d41:"U",\u2c7d:"V",\u1d42:"W",\u1d43:"a",\u1d47:"b",\u1d9c:"c",\u1d48:"d",\u1d49:"e",\u1da0:"f",\u1d4d:"g",\u02b0:"h",\u2071:"i",\u02b2:"j",\u1d4f:"k",\u02e1:"l",\u1d50:"m",\u207f:"n",\u1d52:"o",\u1d56:"p",\u02b3:"r",\u02e2:"s",\u1d57:"t",\u1d58:"u",\u1d5b:"v",\u02b7:"w",\u02e3:"x",\u02b8:"y",\u1dbb:"z",\u1d5d:"\u03b2",\u1d5e:"\u03b3",\u1d5f:"\u03b4",\u1d60:"\u03d5",\u1d61:"\u03c7",\u1dbf:"\u03b8"}),Yr={"\u0301":{text:"\\'",math:"\\acute"},"\u0300":{text:"\\`",math:"\\grave"},"\u0308":{text:'\\"',math:"\\ddot"},"\u0303":{text:"\\~",math:"\\tilde"},"\u0304":{text:"\\=",math:"\\bar"},"\u0306":{text:"\\u",math:"\\breve"},"\u030c":{text:"\\v",math:"\\check"},"\u0302":{text:"\\^",math:"\\hat"},"\u0307":{text:"\\.",math:"\\dot"},"\u030a":{text:"\\r",math:"\\mathring"},"\u030b":{text:"\\H"},"\u0327":{text:"\\c"}},Kr={\u00e1:"a\u0301",\u00e0:"a\u0300",\u00e4:"a\u0308",\u01df:"a\u0308\u0304",\u00e3:"a\u0303",\u0101:"a\u0304",\u0103:"a\u0306",\u1eaf:"a\u0306\u0301",\u1eb1:"a\u0306\u0300",\u1eb5:"a\u0306\u0303",\u01ce:"a\u030c",\u00e2:"a\u0302",\u1ea5:"a\u0302\u0301",\u1ea7:"a\u0302\u0300",\u1eab:"a\u0302\u0303",\u0227:"a\u0307",\u01e1:"a\u0307\u0304",\u00e5:"a\u030a",\u01fb:"a\u030a\u0301",\u1e03:"b\u0307",\u0107:"c\u0301",\u1e09:"c\u0327\u0301",\u010d:"c\u030c",\u0109:"c\u0302",\u010b:"c\u0307",\u00e7:"c\u0327",\u010f:"d\u030c",\u1e0b:"d\u0307",\u1e11:"d\u0327",\u00e9:"e\u0301",\u00e8:"e\u0300",\u00eb:"e\u0308",\u1ebd:"e\u0303",\u0113:"e\u0304",\u1e17:"e\u0304\u0301",\u1e15:"e\u0304\u0300",\u0115:"e\u0306",\u1e1d:"e\u0327\u0306",\u011b:"e\u030c",\u00ea:"e\u0302",\u1ebf:"e\u0302\u0301",\u1ec1:"e\u0302\u0300",\u1ec5:"e\u0302\u0303",\u0117:"e\u0307",\u0229:"e\u0327",\u1e1f:"f\u0307",\u01f5:"g\u0301",\u1e21:"g\u0304",\u011f:"g\u0306",\u01e7:"g\u030c",\u011d:"g\u0302",\u0121:"g\u0307",\u0123:"g\u0327",\u1e27:"h\u0308",\u021f:"h\u030c",\u0125:"h\u0302",\u1e23:"h\u0307",\u1e29:"h\u0327",\u00ed:"i\u0301",\u00ec:"i\u0300",\u00ef:"i\u0308",\u1e2f:"i\u0308\u0301",\u0129:"i\u0303",\u012b:"i\u0304",\u012d:"i\u0306",\u01d0:"i\u030c",\u00ee:"i\u0302",\u01f0:"j\u030c",\u0135:"j\u0302",\u1e31:"k\u0301",\u01e9:"k\u030c",\u0137:"k\u0327",\u013a:"l\u0301",\u013e:"l\u030c",\u013c:"l\u0327",\u1e3f:"m\u0301",\u1e41:"m\u0307",\u0144:"n\u0301",\u01f9:"n\u0300",\u00f1:"n\u0303",\u0148:"n\u030c",\u1e45:"n\u0307",\u0146:"n\u0327",\u00f3:"o\u0301",\u00f2:"o\u0300",\u00f6:"o\u0308",\u022b:"o\u0308\u0304",\u00f5:"o\u0303",\u1e4d:"o\u0303\u0301",\u1e4f:"o\u0303\u0308",\u022d:"o\u0303\u0304",\u014d:"o\u0304",\u1e53:"o\u0304\u0301",\u1e51:"o\u0304\u0300",\u014f:"o\u0306",\u01d2:"o\u030c",\u00f4:"o\u0302",\u1ed1:"o\u0302\u0301",\u1ed3:"o\u0302\u0300",\u1ed7:"o\u0302\u0303",\u022f:"o\u0307",\u0231:"o\u0307\u0304",\u0151:"o\u030b",\u1e55:"p\u0301",\u1e57:"p\u0307",\u0155:"r\u0301",\u0159:"r\u030c",\u1e59:"r\u0307",\u0157:"r\u0327",\u015b:"s\u0301",\u1e65:"s\u0301\u0307",\u0161:"s\u030c",\u1e67:"s\u030c\u0307",\u015d:"s\u0302",\u1e61:"s\u0307",\u015f:"s\u0327",\u1e97:"t\u0308",\u0165:"t\u030c",\u1e6b:"t\u0307",\u0163:"t\u0327",\u00fa:"u\u0301",\u00f9:"u\u0300",\u00fc:"u\u0308",\u01d8:"u\u0308\u0301",\u01dc:"u\u0308\u0300",\u01d6:"u\u0308\u0304",\u01da:"u\u0308\u030c",\u0169:"u\u0303",\u1e79:"u\u0303\u0301",\u016b:"u\u0304",\u1e7b:"u\u0304\u0308",\u016d:"u\u0306",\u01d4:"u\u030c",\u00fb:"u\u0302",\u016f:"u\u030a",\u0171:"u\u030b",\u1e7d:"v\u0303",\u1e83:"w\u0301",\u1e81:"w\u0300",\u1e85:"w\u0308",\u0175:"w\u0302",\u1e87:"w\u0307",\u1e98:"w\u030a",\u1e8d:"x\u0308",\u1e8b:"x\u0307",\u00fd:"y\u0301",\u1ef3:"y\u0300",\u00ff:"y\u0308",\u1ef9:"y\u0303",\u0233:"y\u0304",\u0177:"y\u0302",\u1e8f:"y\u0307",\u1e99:"y\u030a",\u017a:"z\u0301",\u017e:"z\u030c",\u1e91:"z\u0302",\u017c:"z\u0307",\u00c1:"A\u0301",\u00c0:"A\u0300",\u00c4:"A\u0308",\u01de:"A\u0308\u0304",\u00c3:"A\u0303",\u0100:"A\u0304",\u0102:"A\u0306",\u1eae:"A\u0306\u0301",\u1eb0:"A\u0306\u0300",\u1eb4:"A\u0306\u0303",\u01cd:"A\u030c",\u00c2:"A\u0302",\u1ea4:"A\u0302\u0301",\u1ea6:"A\u0302\u0300",\u1eaa:"A\u0302\u0303",\u0226:"A\u0307",\u01e0:"A\u0307\u0304",\u00c5:"A\u030a",\u01fa:"A\u030a\u0301",\u1e02:"B\u0307",\u0106:"C\u0301",\u1e08:"C\u0327\u0301",\u010c:"C\u030c",\u0108:"C\u0302",\u010a:"C\u0307",\u00c7:"C\u0327",\u010e:"D\u030c",\u1e0a:"D\u0307",\u1e10:"D\u0327",\u00c9:"E\u0301",\u00c8:"E\u0300",\u00cb:"E\u0308",\u1ebc:"E\u0303",\u0112:"E\u0304",\u1e16:"E\u0304\u0301",\u1e14:"E\u0304\u0300",\u0114:"E\u0306",\u1e1c:"E\u0327\u0306",\u011a:"E\u030c",\u00ca:"E\u0302",\u1ebe:"E\u0302\u0301",\u1ec0:"E\u0302\u0300",\u1ec4:"E\u0302\u0303",\u0116:"E\u0307",\u0228:"E\u0327",\u1e1e:"F\u0307",\u01f4:"G\u0301",\u1e20:"G\u0304",\u011e:"G\u0306",\u01e6:"G\u030c",\u011c:"G\u0302",\u0120:"G\u0307",\u0122:"G\u0327",\u1e26:"H\u0308",\u021e:"H\u030c",\u0124:"H\u0302",\u1e22:"H\u0307",\u1e28:"H\u0327",\u00cd:"I\u0301",\u00cc:"I\u0300",\u00cf:"I\u0308",\u1e2e:"I\u0308\u0301",\u0128:"I\u0303",\u012a:"I\u0304",\u012c:"I\u0306",\u01cf:"I\u030c",\u00ce:"I\u0302",\u0130:"I\u0307",\u0134:"J\u0302",\u1e30:"K\u0301",\u01e8:"K\u030c",\u0136:"K\u0327",\u0139:"L\u0301",\u013d:"L\u030c",\u013b:"L\u0327",\u1e3e:"M\u0301",\u1e40:"M\u0307",\u0143:"N\u0301",\u01f8:"N\u0300",\u00d1:"N\u0303",\u0147:"N\u030c",\u1e44:"N\u0307",\u0145:"N\u0327",\u00d3:"O\u0301",\u00d2:"O\u0300",\u00d6:"O\u0308",\u022a:"O\u0308\u0304",\u00d5:"O\u0303",\u1e4c:"O\u0303\u0301",\u1e4e:"O\u0303\u0308",\u022c:"O\u0303\u0304",\u014c:"O\u0304",\u1e52:"O\u0304\u0301",\u1e50:"O\u0304\u0300",\u014e:"O\u0306",\u01d1:"O\u030c",\u00d4:"O\u0302",\u1ed0:"O\u0302\u0301",\u1ed2:"O\u0302\u0300",\u1ed6:"O\u0302\u0303",\u022e:"O\u0307",\u0230:"O\u0307\u0304",\u0150:"O\u030b",\u1e54:"P\u0301",\u1e56:"P\u0307",\u0154:"R\u0301",\u0158:"R\u030c",\u1e58:"R\u0307",\u0156:"R\u0327",\u015a:"S\u0301",\u1e64:"S\u0301\u0307",\u0160:"S\u030c",\u1e66:"S\u030c\u0307",\u015c:"S\u0302",\u1e60:"S\u0307",\u015e:"S\u0327",\u0164:"T\u030c",\u1e6a:"T\u0307",\u0162:"T\u0327",\u00da:"U\u0301",\u00d9:"U\u0300",\u00dc:"U\u0308",\u01d7:"U\u0308\u0301",\u01db:"U\u0308\u0300",\u01d5:"U\u0308\u0304",\u01d9:"U\u0308\u030c",\u0168:"U\u0303",\u1e78:"U\u0303\u0301",\u016a:"U\u0304",\u1e7a:"U\u0304\u0308",\u016c:"U\u0306",\u01d3:"U\u030c",\u00db:"U\u0302",\u016e:"U\u030a",\u0170:"U\u030b",\u1e7c:"V\u0303",\u1e82:"W\u0301",\u1e80:"W\u0300",\u1e84:"W\u0308",\u0174:"W\u0302",\u1e86:"W\u0307",\u1e8c:"X\u0308",\u1e8a:"X\u0307",\u00dd:"Y\u0301",\u1ef2:"Y\u0300",\u0178:"Y\u0308",\u1ef8:"Y\u0303",\u0232:"Y\u0304",\u0176:"Y\u0302",\u1e8e:"Y\u0307",\u0179:"Z\u0301",\u017d:"Z\u030c",\u1e90:"Z\u0302",\u017b:"Z\u0307",\u03ac:"\u03b1\u0301",\u1f70:"\u03b1\u0300",\u1fb1:"\u03b1\u0304",\u1fb0:"\u03b1\u0306",\u03ad:"\u03b5\u0301",\u1f72:"\u03b5\u0300",\u03ae:"\u03b7\u0301",\u1f74:"\u03b7\u0300",\u03af:"\u03b9\u0301",\u1f76:"\u03b9\u0300",\u03ca:"\u03b9\u0308",\u0390:"\u03b9\u0308\u0301",\u1fd2:"\u03b9\u0308\u0300",\u1fd1:"\u03b9\u0304",\u1fd0:"\u03b9\u0306",\u03cc:"\u03bf\u0301",\u1f78:"\u03bf\u0300",\u03cd:"\u03c5\u0301",\u1f7a:"\u03c5\u0300",\u03cb:"\u03c5\u0308",\u03b0:"\u03c5\u0308\u0301",\u1fe2:"\u03c5\u0308\u0300",\u1fe1:"\u03c5\u0304",\u1fe0:"\u03c5\u0306",\u03ce:"\u03c9\u0301",\u1f7c:"\u03c9\u0300",\u038e:"\u03a5\u0301",\u1fea:"\u03a5\u0300",\u03ab:"\u03a5\u0308",\u1fe9:"\u03a5\u0304",\u1fe8:"\u03a5\u0306",\u038f:"\u03a9\u0301",\u1ffa:"\u03a9\u0300"};class Xr{constructor(e,t){this.mode=void 0,this.gullet=void 0,this.settings=void 0,this.leftrightDepth=void 0,this.nextToken=void 0,this.mode="math",this.gullet=new Vr(e,t,this.mode),this.settings=t,this.leftrightDepth=0}expect(e,t){if(void 0===t&&(t=!0),this.fetch().text!==e)throw new o("Expected '"+e+"', got '"+this.fetch().text+"'",this.fetch());t&&this.consume()}consume(){this.nextToken=null}fetch(){return null==this.nextToken&&(this.nextToken=this.gullet.expandNextToken()),this.nextToken}switchMode(e){this.mode=e,this.gullet.switchMode(e)}parse(){this.settings.globalGroup||this.gullet.beginGroup(),this.settings.colorIsTextColor&&this.gullet.macros.set("\\color","\\textcolor");try{var e=this.parseExpression(!1);return this.expect("EOF"),this.settings.globalGroup||this.gullet.endGroup(),e}finally{this.gullet.endGroups()}}subparse(e){var t=this.nextToken;this.consume(),this.gullet.pushToken(new a("}")),this.gullet.pushTokens(e);var n=this.parseExpression(!1);return this.expect("}"),this.nextToken=t,n}parseExpression(e,t){for(var n=[];;){"math"===this.mode&&this.consumeSpaces();var r=this.fetch();if(-1!==Xr.endOfExpression.indexOf(r.text))break;if(t&&r.text===t)break;if(e&&zr[r.text]&&zr[r.text].infix)break;var a=this.parseAtom(t);if(!a)break;"internal"!==a.type&&n.push(a)}return"text"===this.mode&&this.formLigatures(n),this.handleInfixNodes(n)}handleInfixNodes(e){for(var t,n=-1,r=0;r<e.length;r++)if("infix"===e[r].type){if(-1!==n)throw new o("only one infix operator per group",e[r].token);n=r,t=e[r].replaceWith}if(-1!==n&&t){var a,i,l=e.slice(0,n),s=e.slice(n+1);return a=1===l.length&&"ordgroup"===l[0].type?l[0]:{type:"ordgroup",mode:this.mode,body:l},i=1===s.length&&"ordgroup"===s[0].type?s[0]:{type:"ordgroup",mode:this.mode,body:s},["\\\\abovefrac"===t?this.callFunction(t,[a,e[n],i],[]):this.callFunction(t,[a,i],[])]}return e}handleSupSubscript(e){var t,n=this.fetch(),r=n.text;this.consume(),this.consumeSpaces();do{var a;t=this.parseGroup(e)}while("internal"===(null==(a=t)?void 0:a.type));if(!t)throw new o("Expected group after '"+r+"'",n);return t}formatUnsupportedCmd(e){for(var t=[],n=0;n<e.length;n++)t.push({type:"textord",mode:"text",text:e[n]});var r={type:"text",mode:this.mode,body:t};return{type:"color",mode:this.mode,color:this.settings.errorColor,body:[r]}}parseAtom(e){var t,n,r=this.parseGroup("atom",e);if("internal"===(null==r?void 0:r.type))return r;if("text"===this.mode)return r;for(;;){this.consumeSpaces();var i=this.fetch();if("\\limits"===i.text||"\\nolimits"===i.text){if(r&&"op"===r.type){var l="\\limits"===i.text;r.limits=l,r.alwaysHandleSupSub=!0}else{if(!r||"operatorname"!==r.type)throw new o("Limit controls must follow a math operator",i);r.alwaysHandleSupSub&&(r.limits="\\limits"===i.text)}this.consume()}else if("^"===i.text){if(t)throw new o("Double superscript",i);t=this.handleSupSubscript("superscript")}else if("_"===i.text){if(n)throw new o("Double subscript",i);n=this.handleSupSubscript("subscript")}else if("'"===i.text){if(t)throw new o("Double superscript",i);var s={type:"textord",mode:this.mode,text:"\\prime"},c=[s];for(this.consume();"'"===this.fetch().text;)c.push(s),this.consume();"^"===this.fetch().text&&c.push(this.handleSupSubscript("superscript")),t={type:"ordgroup",mode:this.mode,body:c}}else{if(!Wr[i.text])break;var u=Gr.test(i.text),d=[];for(d.push(new a(Wr[i.text])),this.consume();;){var p=this.fetch().text;if(!Wr[p])break;if(Gr.test(p)!==u)break;d.unshift(new a(Wr[p])),this.consume()}var f=this.subparse(d);u?n={type:"ordgroup",mode:"math",body:f}:t={type:"ordgroup",mode:"math",body:f}}}return t||n?{type:"supsub",mode:this.mode,base:r,sup:t,sub:n}:r}parseFunction(e,t){var n=this.fetch(),r=n.text,a=zr[r];if(!a)return null;if(this.consume(),t&&"atom"!==t&&!a.allowedInArgument)throw new o("Got function '"+r+"' with no arguments"+(t?" as "+t:""),n);if("text"===this.mode&&!a.allowedInText)throw new o("Can't use function '"+r+"' in text mode",n);if("math"===this.mode&&!1===a.allowedInMath)throw new o("Can't use function '"+r+"' in math mode",n);var{args:i,optArgs:l}=this.parseArguments(r,a);return this.callFunction(r,i,l,n,e)}callFunction(e,t,n,r,a){var i={funcName:e,parser:this,token:r,breakOnTokenText:a},l=zr[e];if(l&&l.handler)return l.handler(i,t,n);throw new o("No function handler for "+e)}parseArguments(e,t){var n=t.numArgs+t.numOptionalArgs;if(0===n)return{args:[],optArgs:[]};for(var r=[],a=[],i=0;i<n;i++){var l=t.argTypes&&t.argTypes[i],s=i<t.numOptionalArgs;(t.primitive&&null==l||"sqrt"===t.type&&1===i&&null==a[0])&&(l="primitive");var c=this.parseGroupOfType("argument to '"+e+"'",l,s);if(s)a.push(c);else{if(null==c)throw new o("Null argument, please report this as a bug");r.push(c)}}return{args:r,optArgs:a}}parseGroupOfType(e,t,n){switch(t){case"color":return this.parseColorGroup(n);case"size":return this.parseSizeGroup(n);case"url":return this.parseUrlGroup(n);case"math":case"text":return this.parseArgumentGroup(n,t);case"hbox":var r=this.parseArgumentGroup(n,"text");return null!=r?{type:"styling",mode:r.mode,body:[r],style:"text"}:null;case"raw":var a=this.parseStringGroup("raw",n);return null!=a?{type:"raw",mode:"text",string:a.text}:null;case"primitive":if(n)throw new o("A primitive argument cannot be optional");var i=this.parseGroup(e);if(null==i)throw new o("Expected group as "+e,this.fetch());return i;case"original":case null:case void 0:return this.parseArgumentGroup(n);default:throw new o("Unknown group type as "+e,this.fetch())}}consumeSpaces(){for(;" "===this.fetch().text;)this.consume()}parseStringGroup(e,t){var n=this.gullet.scanArgument(t);if(null==n)return null;for(var r,a="";"EOF"!==(r=this.fetch()).text;)a+=r.text,this.consume();return this.consume(),n.text=a,n}parseRegexGroup(e,t){for(var n,r=this.fetch(),a=r,i="";"EOF"!==(n=this.fetch()).text&&e.test(i+n.text);)i+=(a=n).text,this.consume();if(""===i)throw new o("Invalid "+t+": '"+r.text+"'",r);return r.range(a,i)}parseColorGroup(e){var t=this.parseStringGroup("color",e);if(null==t)return null;var n=/^(#[a-f0-9]{3}|#?[a-f0-9]{6}|[a-z]+)$/i.exec(t.text);if(!n)throw new o("Invalid color: '"+t.text+"'",t);var r=n[0];return/^[0-9a-f]{6}$/i.test(r)&&(r="#"+r),{type:"color-token",mode:this.mode,color:r}}parseSizeGroup(e){var t,n=!1;if(this.gullet.consumeSpaces(),!(t=e||"{"===this.gullet.future().text?this.parseStringGroup("size",e):this.parseRegexGroup(/^[-+]? *(?:$|\d+|\d+\.\d*|\.\d*) *[a-z]{0,2} *$/,"size")))return null;e||0!==t.text.length||(t.text="0pt",n=!0);var r=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(t.text);if(!r)throw new o("Invalid size: '"+t.text+"'",t);var a={number:+(r[1]+r[2]),unit:r[3]};if(!D(a))throw new o("Invalid unit: '"+a.unit+"'",t);return{type:"size",mode:this.mode,value:a,isBlank:n}}parseUrlGroup(e){this.gullet.lexer.setCatcode("%",13),this.gullet.lexer.setCatcode("~",12);var t=this.parseStringGroup("url",e);if(this.gullet.lexer.setCatcode("%",14),this.gullet.lexer.setCatcode("~",13),null==t)return null;var n=t.text.replace(/\\([#$%&~_^{}])/g,"$1");return{type:"url",mode:this.mode,url:n}}parseArgumentGroup(e,t){var n=this.gullet.scanArgument(e);if(null==n)return null;var r=this.mode;t&&this.switchMode(t),this.gullet.beginGroup();var a=this.parseExpression(!1,"EOF");this.expect("EOF"),this.gullet.endGroup();var o={type:"ordgroup",mode:this.mode,loc:n.loc,body:a};return t&&this.switchMode(r),o}parseGroup(e,t){var n,a=this.fetch(),i=a.text;if("{"===i||"\\begingroup"===i){this.consume();var l="{"===i?"}":"\\endgroup";this.gullet.beginGroup();var s=this.parseExpression(!1,l),c=this.fetch();this.expect(l),this.gullet.endGroup(),n={type:"ordgroup",mode:this.mode,loc:r.range(a,c),body:s,semisimple:"\\begingroup"===i||void 0}}else if(null==(n=this.parseFunction(t,e)||this.parseSymbol())&&"\\"===i[0]&&!Hr.hasOwnProperty(i)){if(this.settings.throwOnError)throw new o("Undefined control sequence: "+i,a);n=this.formatUnsupportedCmd(i),this.consume()}return n}formLigatures(e){for(var t=e.length-1,n=0;n<t;++n){var a=e[n],o=a.text;"-"===o&&"-"===e[n+1].text&&(n+1<t&&"-"===e[n+2].text?(e.splice(n,3,{type:"textord",mode:"text",loc:r.range(a,e[n+2]),text:"---"}),t-=2):(e.splice(n,2,{type:"textord",mode:"text",loc:r.range(a,e[n+1]),text:"--"}),t-=1)),"'"!==o&&"`"!==o||e[n+1].text!==o||(e.splice(n,2,{type:"textord",mode:"text",loc:r.range(a,e[n+1]),text:o+o}),t-=1)}}parseSymbol(){var e=this.fetch(),t=e.text;if(/^\\verb[^a-zA-Z]/.test(t)){this.consume();var n=t.slice(5),a="*"===n.charAt(0);if(a&&(n=n.slice(1)),n.length<2||n.charAt(0)!==n.slice(-1))throw new o("\\verb assertion failed --\n                    please report what input caused this bug");return{type:"verb",mode:"text",body:n=n.slice(1,-1),star:a}}Kr.hasOwnProperty(t[0])&&!oe[this.mode][t[0]]&&(this.settings.strict&&"math"===this.mode&&this.settings.reportNonstrict("unicodeTextInMathMode",'Accented Unicode text character "'+t[0]+'" used in math mode',e),t=Kr[t[0]]+t.slice(1));var i,l=Br.exec(t);if(l&&("i"===(t=t.substring(0,l.index))?t="\u0131":"j"===t&&(t="\u0237")),oe[this.mode][t]){this.settings.strict&&"math"===this.mode&&Ne.indexOf(t)>=0&&this.settings.reportNonstrict("unicodeTextInMathMode",'Latin-1/Unicode text character "'+t[0]+'" used in math mode',e);var s,c=oe[this.mode][t].group,u=r.range(e);if(re.hasOwnProperty(c)){var d=c;s={type:"atom",mode:this.mode,family:d,loc:u,text:t}}else s={type:c,mode:this.mode,loc:u,text:t};i=s}else{if(!(t.charCodeAt(0)>=128))return null;this.settings.strict&&(E(t.charCodeAt(0))?"math"===this.mode&&this.settings.reportNonstrict("unicodeTextInMathMode",'Unicode text character "'+t[0]+'" used in math mode',e):this.settings.reportNonstrict("unknownSymbol",'Unrecognized Unicode character "'+t[0]+'" ('+t.charCodeAt(0)+")",e)),i={type:"textord",mode:"text",loc:r.range(e),text:t}}if(this.consume(),l)for(var p=0;p<l[0].length;p++){var f=l[0][p];if(!Yr[f])throw new o("Unknown accent ' "+f+"'",e);var h=Yr[f][this.mode]||Yr[f].text;if(!h)throw new o("Accent "+f+" unsupported in "+this.mode+" mode",e);i={type:"accent",mode:this.mode,loc:r.range(e),label:h,isStretchy:!1,isShifty:!0,base:i}}return i}}Xr.endOfExpression=["}","\\endgroup","\\end","\\right","&"];var Qr=function(e,t){if(!("string"==typeof e||e instanceof String))throw new TypeError("KaTeX can only parse string typed expression");var n=new Xr(e,t);delete n.gullet.macros.current["\\df@tag"];var r=n.parse();if(delete n.gullet.macros.current["\\current@color"],delete n.gullet.macros.current["\\color"],n.gullet.macros.get("\\df@tag")){if(!t.displayMode)throw new o("\\tag works only in display equations");r=[{type:"tag",mode:"text",body:r,tag:n.subparse([new a("\\df@tag")])}]}return r},Jr=function(e,t,n){t.textContent="";var r=ea(e,n).toNode();t.appendChild(r)};"undefined"!=typeof document&&"CSS1Compat"!==document.compatMode&&("undefined"!=typeof console&&console.warn("Warning: KaTeX doesn't work in quirks mode. Make sure your website has a suitable doctype."),Jr=function(){throw new o("KaTeX doesn't work in quirks mode.")});var Zr=function(e,t,n){if(n.throwOnError||!(e instanceof o))throw e;var r=Je.makeSpan(["katex-error"],[new J(t)]);return r.setAttribute("title",e.toString()),r.setAttribute("style","color:"+n.errorColor),r},ea=function(e,t){var n=new f(t);try{return function(e,t,n){var r,a=Nt(n);if("mathml"===n.output)return Lt(e,t,a,n.displayMode,!0);if("html"===n.output){var o=Ct(e,a);r=Je.makeSpan(["katex"],[o])}else{var i=Lt(e,t,a,n.displayMode,!1),l=Ct(e,a);r=Je.makeSpan(["katex"],[i,l])}return Pt(r,n)}(Qr(e,n),e,n)}catch(t){return Zr(t,e,n)}},ta={version:"0.16.22",render:Jr,renderToString:function(e,t){return ea(e,t).toMarkup()},ParseError:o,SETTINGS_SCHEMA:d,__parse:function(e,t){var n=new f(t);return Qr(e,n)},__renderToDomTree:ea,__renderToHTMLTree:function(e,t){var n=new f(t);try{return function(e,t,n){var r=Ct(e,Nt(n)),a=Je.makeSpan(["katex"],[r]);return Pt(a,n)}(Qr(e,n),0,n)}catch(t){return Zr(t,e,n)}},__setFontMetrics:function(e,t){z[e]=t},__defineSymbol:ie,__defineFunction:lt,__defineMacro:Un,__domTree:{Span:Y,Anchor:K,SymbolNode:J,SvgNode:Z,PathNode:ee,LineNode:te}},na=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))},ra=function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(s){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&l[0]?r.return:l[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,l[1])).done)return a;switch(r=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,r=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],r=0}finally{n=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}},aa=!1,oa=function(e,t){return void 0===t&&(t=!1),na(void 0,void 0,void 0,(function(){var n,r,a,o,i;return ra(this,(function(l){switch(l.label){case 0:if(l.trys.push([0,5,,6]),!(n=e.trim()))return[2,""];l.label=1;case 1:return l.trys.push([1,3,,4]),[4,na(void 0,void 0,void 0,(function(){var e;return ra(this,(function(t){if(aa)return[2,window.katex];try{return e=ta||window.katex,window.katex=e,aa=!0,[2,e]}catch(e){throw console.warn("KaTeX static import failed:",e),e}return[2]}))}))];case 2:return r=l.sent(),a=r.renderToString(n,{displayMode:t,throwOnError:!1,errorColor:"#cc0000",strict:"ignore",trust:!1,macros:{"\\R":"\\mathbb{R}","\\N":"\\mathbb{N}","\\Z":"\\mathbb{Z}","\\Q":"\\mathbb{Q}","\\C":"\\mathbb{C}"}}),t?[2,'<div class="katex-display">'.concat(a,"</div>")]:[2,'<span class="katex-inline">'.concat(a,"</span>")];case 3:return o=l.sent(),console.warn("\u274c KaTeX loading/render failed, falling back to simple display:",o),t?[2,"<div style=\"text-align: center; margin: 12px 0; padding: 10px; background: #F1F5F9; border-radius: 6px; font-family: 'Times New Roman', serif;\">".concat(n,"</div>")]:[2,"<span style=\"background: #F1F5F9; padding: 2px 4px; border-radius: 3px; font-family: 'Times New Roman', serif;\">".concat(n,"</span>")];case 4:return[3,6];case 5:return i=l.sent(),console.warn("Formula rendering error:",i),t?[2,"<div style=\"text-align: center; margin: 12px 0; padding: 10px; background: #F1F5F9; border-radius: 6px; font-family: 'Times New Roman', serif;\">".concat(e,"</div>")]:[2,"<span style=\"background: #F1F5F9; padding: 2px 4px; border-radius: 3px; font-family: 'Times New Roman', serif;\">".concat(e,"</span>")];case 6:return[2]}}))}))},ia=function(e,t){void 0===t&&(t=!1);var n=e.trim();return n?t?'<div style="text-align: center; margin: 16px 0; padding: 12px 16px; background: linear-gradient(135deg, #F8FAFC 0%, #E2E8F0 100%); border: 1px solid #CBD5E1; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">\n            <div style="font-family: \'Times New Roman\', serif; font-size: 16px; color: #1E293B; font-weight: 500; letter-spacing: 0.5px;">\n                '.concat(n,"\n            </div>\n        </div>"):"<span style=\"display: inline-block; margin: 0 4px; padding: 4px 8px; background: linear-gradient(135deg, #F1F5F9 0%, #E2E8F0 100%); border: 1px solid #CBD5E1; border-radius: 6px; font-family: 'Times New Roman', serif; font-size: 14px; color: #334155; font-weight: 500; box-shadow: 0 1px 2px rgba(0,0,0,0.05);\">\n            ".concat(n,"\n        </span>"):""},la=function(e){var t=e;return t=(t=(t=(t=ua(t=da(t))).replace(/(^|\n)\s*(\u0424\u043e\u0440\u043c\u0443\u043b\u0430:)?\s*g\s*=\s*([^\n<]+)(?=\n|$)/gi,(function(e,t,n,r){var a=r.trim().replace(/\^(\d+)/g,"^{$1}").replace(/\xb7/g,"\\cdot").replace(/\|/g," \\mid ");return"".concat(t,"$$g = ").concat(a,"$$")}))).replace(/\$\$([^$]+)\$\$/g,(function(e,t){return ia(t,!0)}))).replace(/\(([^()]+)\)/g,(function(e,t,n,r){var a=r.slice(Math.max(0,n-1),n),o=r.slice(n+e.length,n+e.length+1);if("$"===a||"$"===o)return e;if(!(/_[{]?\d+|\\{1,2}(ldots|sum|frac)|\^[{]?\d+/.test(t)||/[a-zA-Z]\s*[+\-]/.test(t)))return e;var i=t.replace(/\\{2,}([A-Za-z])/g,"\\$1").replace(/\^(\d+)/g,"^{$1}").replace(/\xb7/g,"\\cdot").replace(/\|/g," \\mid ");return"$(".concat(i,")$")})),t=t.replace(/(?<!\$)\$([^$\n]+)\$(?!\$)/g,(function(e,t){return ia(t,!1)}))},sa=function(e){return na(void 0,void 0,void 0,(function(){var t,n,r,a,o,i,l,s,c,u,d,p;return ra(this,(function(f){switch(f.label){case 0:t=ua(da(e)),n=Array.from(t.matchAll(/\$\$([^$]+)\$\$/g)),r=Array.from(t.matchAll(/(?<!\$)\$([^$\n]+)\$(?!\$)/g)),console.log("\u{1f3af} Processing ".concat(n.length," block formulas and ").concat(r.length," inline formulas")),a=0,o=n,f.label=1;case 1:if(!(a<o.length))return[3,6];c=o[a],f.label=2;case 2:return f.trys.push([2,4,,5]),[4,oa(c[1],!0)];case 3:return u=f.sent(),t=t.replace(c[0],u),console.log("\u2705 Processed block formula: ".concat(c[1].substring(0,30),"...")),[3,5];case 4:return i=f.sent(),console.warn("\u274c Failed to process block formula: ".concat(c[1]),i),p=ia(c[1],!0),t=t.replace(c[0],p),[3,5];case 5:return a++,[3,1];case 6:l=0,s=r,f.label=7;case 7:if(!(l<s.length))return[3,12];c=s[l],f.label=8;case 8:return f.trys.push([8,10,,11]),[4,oa(c[1],!1)];case 9:return u=f.sent(),t=t.replace(c[0],u),console.log("\u2705 Processed inline formula: ".concat(c[1].substring(0,30),"...")),[3,11];case 10:return d=f.sent(),console.warn("\u274c Failed to process inline formula: ".concat(c[1]),d),p=ia(c[1],!1),t=t.replace(c[0],p),[3,11];case 11:return l++,[3,7];case 12:return[2,t]}}))}))},ca=function(e){return void 0===e&&(e="m_{a}^{2} + m_{b}^{2} + m_{c}^{2} = \\frac{3}{4} S"),na(void 0,void 0,void 0,(function(){var t,n,r,a;return ra(this,(function(o){switch(o.label){case 0:return console.log("\u{1f9ea} Testing KaTeX rendering with formula:",e),[4,oa(e,!0)];case 1:return t=o.sent(),[4,oa(e,!1)];case 2:return n=o.sent(),r=ia(e,!0),a=ia(e,!1),console.log("\u{1f4ca} Test results:"),console.log("Block (async):",t.substring(0,100)+"..."),console.log("Inline (async):",n.substring(0,100)+"..."),console.log("Block (sync):",r.substring(0,100)+"..."),console.log("Inline (sync):",a.substring(0,100)+"..."),[2,{original:e,blockResult:t,inlineResult:n,syncBlockResult:r,syncInlineResult:a}]}}))}))};function ua(e){var t=e;return t=(t=t.replace(/\barctg\s*(?=\(|\[)/gi,"\\arctan").replace(/\btg\s*(?=\(|\[)/gi,"\\tan").replace(/\bctg\s*(?=\(|\[)/gi,"\\cot").replace(/\bsh\s*(?=\(|\[)/gi,"\\sinh").replace(/\bch\s*(?=\(|\[)/gi,"\\cosh").replace(/\bth\s*(?=\(|\[)/gi,"\\tanh").replace(/\blg\s*(?=\(|\[)/gi,"\\log").replace(/\bln\s*(?=\(|\[)/gi,"\\ln")).replace(/(?<!\$)(\\(?:tan|cot|arctan|arcsin|arccos|sinh|cosh|tanh|sin|cos|log|ln))\s*\[([^\]\n]+)\](?!\$)/gi,(function(e,t,n){return"$\\".concat(t,"\\left[").concat(n,"\\right]$")})),t=t.replace(/(?<!\$)\b(sin|cos|tan|cot|arctan|arcsin|arccos|sinh|cosh|tanh|log|ln)\s*\(([^()\n]+)\)(?!\$)/gi,(function(e,t,n){return"$\\".concat(t,"(").concat(n,")$")})),t=(t=(t=(t=(t=t.replace(/(?<!\$)(\\frac\{[^}]+\}\{[^}]+\})(?!\$)/g,"$$$1$")).replace(/(?<!\$)(\\sqrt\{[^}]+\})(?!\$)/g,"$$$1$")).replace(/(?<!\$)(\\(?:alpha|beta|gamma|delta|epsilon|pi|sigma|theta|omega|mu|lambda|phi))(?![a-zA-Z])(?!\$)/g,"$$$1$")).replace(/\(\s*([^()]+?)\s*\)\s*\/\s*\(\s*([^()]+?)\s*\)/g,(function(e,t,n){return"$$\\frac{".concat(t,"}{").concat(n,"}$$")}))).replace(/(?<!\$)\b(tan|cot)\s*\[([^\]\n]+)\](?!\$)/gi,(function(e,t,n){return"$\\".concat(t.toLowerCase(),"\\left[").concat(n,"\\right]$")})),t=(t=(t=(t=(t=t.replace(/\\tan\\left\[\s*1\s+2\s*(\([^\)]+\))\s*\]/gi,(function(e,t){return"$\\tan\\left[\\tfrac{1}{2}".concat(t,"\\right]$")}))).replace(/\b1\s*2\s*2\s*1\b/g,"1 2")).replace(/\b1\s*2\b(?=\s*\()/g,"\\tfrac{1}{2}")).replace(/(\$\$[^$]+\$\$)\s*\1/g,"$1")).replace(/(?<!\$)(\$[^$]+\$)\s*\1(?!\$)/g,"$1")}function da(e){var t=e;return t=function(e){for(var t="",n=0;n<e.length;){var r=e.codePointAt(n),a=String.fromCodePoint(r),o=null;r>=119808&&r<=119833?o=String.fromCharCode(r-119808+65):r>=119834&&r<=119859?o=String.fromCharCode(r-119834+97):r>=119860&&r<=119885?o=String.fromCharCode(r-119860+65):r>=119886&&r<=119911?o=String.fromCharCode(r-119886+97):r>=119912&&r<=119937?o=String.fromCharCode(r-119912+65):r>=119938&&r<=119963?o=String.fromCharCode(r-119938+97):r>=120782&&r<=120791?o=String.fromCharCode(r-120782+48):8462===r&&(o="h"),t+=null!=o?o:a,n+=a.length}return t}(t=(t=(t=(t=t.replace(/[\u200B-\u200D\u2060\u2061\uFEFF\u00A0]/g," ")).replace(/<annotation[\s\S]*?<\/annotation>/gi,"").replace(/application[^a-zA-Z]*x?[^a-zA-Z]*tex/gi,"")).replace(/<[^>]*>/g," ")).replace(/https?:\/\/\s*w\s*3\s*\.\s*o\s*r\s*g\s*\/\s*1998\s*\/\s*Math\s*\/\s*MathML/gi,"").replace(/\bw\s*3\s*\.\s*o\s*r\s*g\b/gi,"").replace(/\b1998\s*org\s*\/?/gi,"").replace(/\borg\s*1998\b/gi,"").replace(/\b1998\s*\/\s*Math\s*\/\s*MathML\b/gi,"").replace(/MathMLMath/gi,"").replace(/\bMathML\b/gi,"")),t=(t=t.replace(/\b([A-Za-z])(?:\s+[A-Za-z])+\b/g,(function(e){return e.replace(/\s+/g,"")}))).replace(/\s+/g," ").trim()}},63:(e,t,n)=>{
/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var r=n(540);var a="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},o=r.useState,i=r.useEffect,l=r.useLayoutEffect,s=r.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!a(e,n)}catch(e){return!0}}var u="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),r=o({inst:{value:n,getSnapshot:t}}),a=r[0].inst,u=r[1];return l((function(){a.value=n,a.getSnapshot=t,c(a)&&u({inst:a})}),[e,n,t]),i((function(){return c(a)&&u({inst:a}),e((function(){c(a)&&u({inst:a})}))}),[e]),s(n),n};t.useSyncExternalStore=void 0!==r.useSyncExternalStore?r.useSyncExternalStore:u},940:(e,t,n)=>{
/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var r=n(540),a=n(888);var o="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},i=a.useSyncExternalStore,l=r.useRef,s=r.useEffect,c=r.useMemo,u=r.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,n,r,a){var d=l(null);if(null===d.current){var p={hasValue:!1,value:null};d.current=p}else p=d.current;d=c((function(){function e(e){if(!s){if(s=!0,i=e,e=r(e),void 0!==a&&p.hasValue){var t=p.value;if(a(t,e))return l=t}return l=e}if(t=l,o(i,e))return t;var n=r(e);return void 0!==a&&a(t,n)?t:(i=e,l=n)}var i,l,s=!1,c=void 0===n?null:n;return[function(){return e(t())},null===c?void 0:function(){return e(c())}]}),[t,n,r,a]);var f=i(e,d[0],d[1]);return s((function(){p.hasValue=!0,p.value=f}),[f]),u(f),f}},888:(e,t,n)=>{e.exports=n(63)},242:(e,t,n)=>{e.exports=n(940)}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/";var r=n(540),a=n(338),o=n(848),i=n(961),l=n(888),s=n(242);let c=function(e){e()};const u=()=>c,d=(0,r.createContext)(null);function p(){return(0,r.useContext)(d)}let f=()=>{throw new Error("uSES not initialized!")};const h=(e,t)=>e===t;function g(e=d){const t=e===d?p:()=>(0,r.useContext)(e);return function(e,n=h){const{store:a,subscription:o,getServerState:i}=t(),l=f(o.addNestedSub,a.getState,i||a.getState,e,n);return(0,r.useDebugValue)(l),l}}const m=g();n(146),n(737);const v={notify(){},get:()=>[]};function y(e,t){let n,r=v;function a(){i.onStateChange&&i.onStateChange()}function o(){n||(n=t?t.addNestedSub(a):e.subscribe(a),r=function(){const e=u();let t=null,n=null;return{clear(){t=null,n=null},notify(){e((()=>{let e=t;for(;e;)e.callback(),e=e.next}))},get(){let e=[],n=t;for(;n;)e.push(n),n=n.next;return e},subscribe(e){let r=!0,a=n={callback:e,next:null,prev:n};return a.prev?a.prev.next=a:t=a,function(){r&&null!==t&&(r=!1,a.next?a.next.prev=a.prev:n=a.prev,a.prev?a.prev.next=a.next:t=a.next)}}}}())}const i={addNestedSub:function(e){return o(),r.subscribe(e)},notifyNestedSubs:function(){r.notify()},handleChangeWrapper:a,isSubscribed:function(){return Boolean(n)},trySubscribe:o,tryUnsubscribe:function(){n&&(n(),n=void 0,r.clear(),r=v)},getListeners:()=>r};return i}const b=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement)?r.useLayoutEffect:r.useEffect;let x=null;const w=function({store:e,context:t,children:n,serverState:a}){const o=(0,r.useMemo)((()=>{const t=y(e);return{store:e,subscription:t,getServerState:a?()=>a:void 0}}),[e,a]),i=(0,r.useMemo)((()=>e.getState()),[e]);b((()=>{const{subscription:t}=o;return t.onStateChange=t.notifyNestedSubs,t.trySubscribe(),i!==e.getState()&&t.notifyNestedSubs(),()=>{t.tryUnsubscribe(),t.onStateChange=void 0}}),[o,i]);const l=t||d;return r.createElement(l.Provider,{value:o},n)};function S(e=d){const t=e===d?p:()=>(0,r.useContext)(e);return function(){const{store:e}=t();return e}}const k=S();function C(e=d){const t=e===d?k:S(e);return function(){return t().dispatch}}const E=C();function A(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}function T(e,t){if(A(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(let r=0;r<n.length;r++)if(!Object.prototype.hasOwnProperty.call(t,n[r])||!A(e[n[r]],t[n[r]]))return!1;return!0}var I,z;I=s.useSyncExternalStoreWithSelector,f=I,(e=>{x=e})(l.useSyncExternalStore),z=i.unstable_batchedUpdates,c=z;var F="SET_CURRENT_TAB_ID",M="SET_TAB_CARD_FIELD",j="CLEAR_TAB_CARD_DATA",B="SAVE_TAB_CARD",R="DELETE_TAB_CARD",O="SET_TAB_STORED_CARDS",L="UPDATE_TAB_CARD_EXPORT_STATUS",N="UPDATE_TAB_STORED_CARD",P="SET_TAB_CURRENT_PAGE",_=function(e,t,n){return{type:M,payload:{tabId:e,field:t,value:n}}},D=function(e,t){return _(e,"text",t)},q=function(e,t){return _(e,"translation",t)},U=function(e,t){return _(e,"examples",t)},$=function(e,t){return _(e,"image",t)},H=function(e,t){return _(e,"imageUrl",t)},V=function(e,t){return _(e,"front",t)},G=function(e,t){return _(e,"back",t)},W=function(e,t){return _(e,"linguisticInfo",t)},Y=function(e,t){return _(e,"transcription",t)},K=function(e,t){return _(e,"isGeneratingCard",t)},X=function(e,t){return _(e,"currentCardId",t)},Q=n(55),J=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))},Z=function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(s){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&l[0]?r.return:l[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,l[1])).done)return a;switch(r=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,r=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],r=0}finally{n=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}};function ee(e){var t=e.examples.map((function(t){return function(e,t,n,r){void 0===n&&(n=null),void 0===r&&(r="0.8em");var a=e.replace(t,"<b>".concat(t,"</b>"));if(n){var o=n.split(" ").slice(1).join(" ");return"".concat(a,"<br><span style='font-size: ").concat(r,";'><i>").concat(o,"</i></span>")}return a}(t[0],e.text,t[1])})).join("<br><br>"),n="";if(e.image_base64){var r=e.image_base64;if(r.startsWith("data:")){var a="base64,",o=r.indexOf(a);if(-1!==o){var i=r.substring(o+7);n='<div><img src="data:image/jpeg;base64,'.concat(i,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else n='<div><img src="'.concat(r,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else n='<div><img src="data:image/jpeg;base64,'.concat(r,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}var l="";if(e.linguisticInfo&&e.linguisticInfo.trim()){var s=e.linguisticInfo.trim().split("\n").filter((function(e){return e.trim()})),c="";s.forEach((function(e){var t=e.trim();if(t.match(/^[\u0410-\u042f\u0401A-Z][^:]*:$/))c+='<div style="color: #2563EB; font-weight: bold; margin-top: 12px; margin-bottom: 4px;">'.concat(t,"</div>");else if(t.startsWith("\u2022")||t.startsWith("-")||t.startsWith("*")){var n=t.replace(/^[\u2022\-*]\s*/,"");c+='<div style="margin-left: 16px; margin-bottom: 2px; color: #374151;">\u2022 '.concat(n,"</div>")}else if(t.includes(":")&&!t.endsWith(":")){var r=t.split(":"),a=r[0],o=r.slice(1).join(":").trim();c+='<div style="margin-bottom: 4px;"><span style="color: #6B7280; font-weight: 500;">'.concat(a.trim(),':</span> <span style="color: #111827;">').concat(o,"</span></div>")}else t&&(c+='<div style="margin-bottom: 6px; color: #374151; line-height: 1.4;">'.concat(t,"</div>"))})),c&&(l='\n                <div style="margin-top: 20px; padding: 12px; background-color: #F8FAFC; border-left: 4px solid #2563EB; border-radius: 0 6px 6px 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">\n                    <div style="color: #1E40AF; font-weight: bold; font-size: 14px; margin-bottom: 8px; display: flex; align-items: center;">\n                        <span style="margin-right: 6px;">\u{1f4da}</span>\n                        Grammar & Linguistics\n                    </div>\n                    '.concat(c,"\n                </div>\n            "))}var u=function(e){var t=e.transcription;if(!t||!t.trim())return"";var n=function(e){if(!e)return{};try{var t=e.match(/transcription-item\s+user-lang[\s\S]*?<span\s+class=\"transcription-text\">([\s\S]*?)<\/span>/i),n=e.match(/transcription-item\s+ipa[\s\S]*?<span\s+class=\"transcription-text\">([\s\S]*?)<\/span>/i),r=e.match(/transcription-item\s+user-lang[\s\S]*?<span\s+class=\"transcription-label\">([\s\S]*?)<\/span>/i);return{label:r?r[1].trim():void 0,user:t?t[1].trim():void 0,ipa:n?n[1].trim():void 0}}catch(e){return{}}}(t),r=n.label||"Transcription",a=n.user,o=n.ipa;if(!a&&!o)return"";var i=a?'\n        <div style="margin:4px 0; text-align:center;">\n            <span style="font-weight:600; font-size:12px; color:#64748B;">'.concat(r,':</span>\n            <span style="font-size:14px; color:#334155; font-weight:600; margin-left:6px;">').concat(a,"</span>\n        </div>\n    "):"",l=o?"\n        <div style=\"margin:4px 0; text-align:center;\">\n            <span style=\"font-weight:600; font-size:12px; color:#64748B;\">IPA:</span>\n            <span style=\"font-family: 'Doulos SIL','Charis SIL','Times New Roman',serif; font-size:14px; color:#0F172A; margin-left:6px;\">".concat(o,"</span>\n        </div>\n    "):"";return'\n        <div style="margin-top: 8px; padding: 10px; background-color:#F8FAFC; border:1px solid #E2E8F0; border-radius:6px; text-align:center;">\n            <div style="color:#1E293B; font-weight:700; font-size:13px; margin-bottom:6px; display:inline-flex; align-items:center; gap:6px; justify-content:center;">\n                <span>\u{1f524}</span>\n                <span>Pronunciation</span>\n            </div>\n            '.concat(i,"\n            ").concat(l,"\n        </div>\n    ")}(e);return"\n        ".concat(u,'\n        <div style="margin-top: 10px;"><b>').concat(e.translation,"</b></div>\n        <br>").concat(t,"<br><br>\n        ").concat(n,"\n        ").concat(l,"\n    ")}function te(e){if(!e)return e;var t=e,n=[];return t=(t=(t=(t=t.replace(/<pre[\s\S]*?<\/pre>|<code[\s\S]*?<\/code>/gi,(function(e){return n.push(e),"__CODE_BLOCK_".concat(n.length-1,"__")}))).replace(/\$\$([\s\S]*?)\$\$/g,(function(e,t){return"\\[".concat(t,"]")}))).replace(/(?<!\$)\$([^$\n]+)\$(?!\$)/g,(function(e,t){return"\\(".concat(t,"\\)")}))).replace(/__CODE_BLOCK_(\d+)__/g,(function(e,t){return n[Number(t)]}))}function ne(e,t){var n=e.replace(/^(Key points?:?)/i,"").trim(),r=/<\s*(ul|ol|li)\b/i.test(n),a=/class\s*=\s*"[^"]*katex[^"]*"/i.test(n),o="";if(r||a)o=n;else{var i=n.split(/\r?\n/).map((function(e){return e.trim()})).filter(Boolean);if(i.filter((function(e){return/^(?:[-*\u2022]\s+|\d+\.\s+)/.test(e)})).length>=Math.max(2,Math.floor(i.length/2))){var l=i.filter((function(e){return e.length>0})).map((function(e){return e.replace(/^(?:[-*\u2022]\s+|\d+\.\s+)/,"")})).map((function(e){return"<li>".concat(e,"</li>")})).join("");o="<b>Key points:</b>\n<ul>".concat(l,"</ul>")}else o=i.length<=1?"<div>".concat(i[0]||n,"</div>"):i.map((function(e){return"<p>".concat(e,"</p>")})).join("\n")}var s="";if(t){var c=t;if(c.startsWith("data:")){var u="base64,",d=c.indexOf(u);if(-1!==d){var p=c.substring(d+7);s='<div><img src="data:image/jpeg;base64,'.concat(p,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else s='<div><img src="'.concat(c,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else s='<div><img src="data:image/jpeg;base64,'.concat(c,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}var f=te(o);return"\n".concat(f,"\n").concat(s,"\n")}var re=function(e,t,n,r,a,o){return J(void 0,void 0,void 0,(function(){var i,l,s,c,u;return Z(this,(function(d){switch(d.label){case 0:return d.trys.push([0,4,,5]),i=JSON.stringify({action:"createDeck",version:6,key:n,params:{deck:r}}),[4,fetch(t,{method:"POST",body:i,headers:{"Content-Type":"application/json"}})];case 1:if(!d.sent().ok)throw new Error("Failed to create deck.");return l=o.map((function(t){var n;if(e===Q.d.LanguageLearning&&"translation"in t&&"examples"in t&&"image_base64"in t)n={Front:t.text,Back:ee(t)};else if(e===Q.d.GeneralTopic&&"back"in t){var o=t;n={Front:te(o.front),Back:ne(o.back,o.image_base64)}}return{deckName:r,modelName:a,fields:n,options:{allowDuplicate:!1},tags:[]}})),s=JSON.stringify({action:"addNotes",version:6,key:n,params:{notes:l}}),[4,fetch(t,{method:"POST",body:s,headers:{"Content-Type":"application/json"}})];case 2:if(!(c=d.sent()).ok)throw new Error("Failed to add notes.");return[4,c.json()];case 3:if((u=d.sent()).error)throw new Error("Anki error: ".concat(u.error));return[2,u.result];case 4:throw d.sent();case 5:return[2]}}))}))};function ae(e){return J(this,void 0,void 0,(function(){return Z(this,(function(t){return[2,new Promise((function(t,n){chrome.runtime.sendMessage(e,(function(e){e.status&&void 0!==e.data?t(e.data):(console.error("Error fetching image:",e.error),n(null))}))}))]}))}))}var oe=function(e,t){return J(void 0,void 0,void 0,(function(){var n,r,a,o;return Z(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),n=function(e){var t="http://127.0.0.1:8765";if(!e)return t;try{var n=new URL(e.trim());return n.pathname=n.pathname.replace(/\/+$/,""),n.toString()}catch(e){return console.warn("Invalid AnkiConnect URL provided, falling back to default.",e),t}}(e),[4,fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"deckNames",version:6,key:t})})];case 1:if(!(r=i.sent()).ok)throw new Error("HTTP error! Status: ".concat(r.status));return[4,r.json()];case 2:return(a=i.sent()).result?[2,{result:a.result.map((function(e){return{deckId:e,name:e}})),error:a.error}]:[2,a];case 3:throw o=i.sent(),console.error("Error fetching decks:",o),o;case 4:return[2]}}))}))},ie=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))},le=function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(s){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&l[0]?r.return:l[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,l[1])).done)return a;switch(r=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,r=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],r=0}finally{n=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}},se="SAVE_ANKI_CARDS",ce="SET_TEXT",ue="SET_TRANSLATION",de="SET_EXAMPLES",pe="SET_IMAGE",fe="SET_IMAGE_URL",he="SET_BACK",ge="SET_FRONT",me="SAVE_CARD_TO_STORAGE",ve="LOAD_STORED_CARDS",ye="DELETE_STORED_CARD",be="SET_STORED_CARDS",xe="UPDATE_CARD_EXPORT_STATUS",we="UPDATE_STORED_CARD",Se="SET_CURRENT_CARD_ID",ke="SET_LINGUISTIC_INFO",Ce="SET_TRANSCRIPTION",Ee="SET_IS_GENERATING_CARD",Ae="SET_LAST_DRAFT_CARD",Te=function(e,t,n,r,a,o){return void 0===n&&(n=null),function(i){return ie(void 0,void 0,void 0,(function(){var l,s;return le(this,(function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,re(e,t,n,r,a,o)];case 1:return l=c.sent(),i({type:se,payload:l}),[3,3];case 2:throw s=c.sent(),console.error("Error saving Anki cards:",s),s;case 3:return[2]}}))}))}},Ie=function(e){var t,n,r,a;return console.log("*** ACTION: saveCardToStorage called with card data ***"),console.log("Action payload image info:",{hasImage:!!e.image,hasImageUrl:!!e.imageUrl,imageType:typeof e.image,imageUrlType:typeof e.imageUrl,imageLength:null===(t=e.image)||void 0===t?void 0:t.length,imageUrlLength:null===(n=e.imageUrl)||void 0===n?void 0:n.length,imageValue:e.image,imageUrlValue:e.imageUrl,imagePreview:null===(r=e.image)||void 0===r?void 0:r.substring(0,50),imageUrlPreview:null===(a=e.imageUrl)||void 0===a?void 0:a.substring(0,50)}),{type:me,payload:e}},ze=function(){return{type:ve}},Fe=function(e){return{type:ce,payload:e}},Me=function(e){return{type:de,payload:e}},je=function(e){return{type:ue,payload:e}},Be=function(e){return{type:pe,payload:e}},Re=function(e){return{type:fe,payload:e}},Oe=function(e){return{type:he,payload:e}},Le=function(e){return{type:ge,payload:e}},Ne=function(e){var t,n,r,a;return console.log("*** ACTION: updateStoredCard called ***"),console.log("Updated card image info:",{cardId:e.id,hasImage:!!e.image,hasImageUrl:!!e.imageUrl,imageType:typeof e.image,imageUrlType:typeof e.imageUrl,imageLength:null===(t=e.image)||void 0===t?void 0:t.length,imageUrlLength:null===(n=e.imageUrl)||void 0===n?void 0:n.length,imageValue:e.image,imageUrlValue:e.imageUrl,imagePreview:null===(r=e.image)||void 0===r?void 0:r.substring(0,50),imageUrlPreview:null===(a=e.imageUrl)||void 0===a?void 0:a.substring(0,50)}),{type:we,payload:e}},Pe=function(e){return{type:Se,payload:e}},_e=function(e){return{type:ke,payload:e}},De=function(e){return{type:Ce,payload:e}},qe=function(e){return{type:Ee,payload:e}},Ue=function(e){return{type:Ae,payload:e}},$e=function(){return $e=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},$e.apply(this,arguments)},He=(0,r.createContext)(null),Ve=function(e){var t=e.tabId,n=e.children,a=E(),i=m((function(e){return e.tabState.tabStates[t]}),T),l=m((function(e){return{text:e.cards.text,translation:e.cards.translation,examples:e.cards.examples,image:e.cards.image,imageUrl:e.cards.imageUrl,front:e.cards.front,back:e.cards.back,linguisticInfo:e.cards.linguisticInfo,transcription:e.cards.transcription,isGeneratingCard:e.cards.isGeneratingCard,currentCardId:e.cards.currentCardId}}),T),s=m((function(e){return e.cards.storedCards})),c=m((function(e){return e.currentPage})),u=(0,r.useRef)("fallback_".concat(t,"_").concat(Date.now(),"_")),d=(0,r.useMemo)((function(){var e=(null==i?void 0:i.cardData)||{text:l.text,translation:l.translation,examples:l.examples,image:l.image,imageUrl:l.imageUrl,front:l.front,back:l.back,linguisticInfo:l.linguisticInfo,transcription:l.transcription,isGeneratingCard:l.isGeneratingCard,currentCardId:l.currentCardId},n=(null==i?void 0:i.fieldIdPrefix)||u.current,r=(null==i?void 0:i.currentPage)||c;return{text:e.text,translation:e.translation,examples:e.examples,image:e.image,imageUrl:e.imageUrl,front:e.front,back:e.back,linguisticInfo:e.linguisticInfo,transcription:e.transcription,isGeneratingCard:e.isGeneratingCard,currentCardId:e.currentCardId,storedCards:s,fieldIdPrefix:n,currentPage:r,setText:function(e){a(i?D(t,e):Fe(e))},setTranslation:function(e){a(i?q(t,e):je(e))},setExamples:function(e){a(i?U(t,e):Me(e))},setImage:function(e){a(i?$(t,e):Be(e))},setImageUrl:function(e){a(i?H(t,e):Re(e))},setFront:function(e){a(i?V(t,e):Le(e))},setBack:function(e){a(i?G(t,e):Oe(e))},setLinguisticInfo:function(e){a(i?W(t,e):_e(e))},setTranscription:function(e){a(i?Y(t,e):De(e))},setIsGeneratingCard:function(e){a(i?K(t,e):qe(e))},setCurrentCardId:function(e){a(i?X(t,e):Pe(e))},saveCardToStorage:function(e){a(Ie(e))},updateStoredCard:function(e){a(Ne(e))},deleteStoredCard:function(e){a(function(e){return{type:ye,payload:e}}(e))},updateCardExportStatus:function(e,t){a(function(e,t){return{type:xe,payload:{cardId:e,status:t}}}(e,t))},setCurrentPage:function(e){a(i?function(e,t){return{type:P,payload:{tabId:e,currentPage:t}}}(t,e):function(e){return{type:"SET_CURRENT_PAGE",currentPage:e}}(e))},updateCard:function(e){Object.keys(e).forEach((function(n){var r=e[n];if(void 0!==r)switch(n){case"text":a(i?D(t,r):Fe(r));break;case"translation":a(i?q(t,r):je(r));break;case"examples":a(i?U(t,r):Me(r));break;case"image":a(i?$(t,r):Be(r));break;case"imageUrl":a(i?H(t,r):Re(r));break;case"front":a(i?V(t,r):Le(r));break;case"back":a(i?G(t,r):Oe(r));break;case"linguisticInfo":a(i?W(t,r):_e(r));break;case"transcription":a(i?Y(t,r):De(r));break;case"isGeneratingCard":a(i?K(t,r):qe(r));break;case"currentCardId":a(i?X(t,r):Pe(r))}}))}}}),[i,l,s,t,a,c]);return(0,o.jsx)(He.Provider,$e({value:d},{children:n}))},Ge=function(){var e=(0,r.useContext)(He);if(!e)throw new Error("useTabAware must be used within a TabAwareProvider");return e},We=n(456),Ye=n(78),Ke={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Xe=r.createContext&&r.createContext(Ke),Qe=function(){return Qe=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},Qe.apply(this,arguments)},Je=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n};function Ze(e){return e&&e.map((function(e,t){return r.createElement(e.tag,Qe({key:t},e.attr),Ze(e.child))}))}function et(e){return function(t){return r.createElement(tt,Qe({attr:Qe({},e.attr)},t),Ze(e.child))}}function tt(e){var t=function(t){var n,a=e.attr,o=e.size,i=e.title,l=Je(e,["attr","size","title"]),s=o||t.size||"1em";return t.className&&(n=t.className),e.className&&(n=(n?n+" ":"")+e.className),r.createElement("svg",Qe({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,a,l,{className:n,style:Qe(Qe({color:e.color||t.color},t.style),e.style),height:s,width:s,xmlns:"http://www.w3.org/2000/svg"}),i&&r.createElement("title",null,i),e.children)};return void 0!==Xe?r.createElement(Xe.Consumer,null,(function(e){return t(e)})):t(Ke)}function nt(e){return et({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"}}]})(e)}function rt(e){return et({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"}}]})(e)}function at(e){return et({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M207.029 381.476L12.686 187.132c-9.373-9.373-9.373-24.569 0-33.941l22.667-22.667c9.357-9.357 24.522-9.375 33.901-.04L224 284.505l154.745-154.021c9.379-9.335 24.544-9.317 33.901.04l22.667 22.667c9.373 9.373 9.373 24.569 0 33.941L240.971 381.476c-9.373 9.372-24.569 9.372-33.942 0z"}}]})(e)}function ot(e){return et({tag:"svg",attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M34.52 239.03L228.87 44.69c9.37-9.37 24.57-9.37 33.94 0l22.67 22.67c9.36 9.36 9.37 24.52.04 33.9L131.49 256l154.02 154.75c9.34 9.38 9.32 24.54-.04 33.9l-22.67 22.67c-9.37 9.37-24.57 9.37-33.94 0L34.52 272.97c-9.37-9.37-9.37-24.57 0-33.94z"}}]})(e)}function it(e){return et({tag:"svg",attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"}}]})(e)}function lt(e){return et({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M240.971 130.524l194.343 194.343c9.373 9.373 9.373 24.569 0 33.941l-22.667 22.667c-9.357 9.357-24.522 9.375-33.901.04L224 227.495 69.255 381.516c-9.379 9.335-24.544 9.317-33.901-.04l-22.667-22.667c-9.373-9.373-9.373-24.569 0-33.941L207.03 130.525c9.372-9.373 24.568-9.373 33.941-.001z"}}]})(e)}function st(e){return et({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"}}]})(e)}function ct(e){return et({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M278.9 511.5l-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2l43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6l144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z"}}]})(e)}function ut(e){return et({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"}}]})(e)}function dt(e){return et({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V80c0-26.51-21.49-48-48-48zM224 416H64V160h160v256zm224 0H288V160h160v256z"}}]})(e)}function pt(e){return et({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"}}]})(e)}function ft(e){return et({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"}}]})(e)}function ht(e){return et({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M0 168v-16c0-13.255 10.745-24 24-24h360V80c0-21.367 25.899-32.042 40.971-16.971l80 80c9.372 9.373 9.372 24.569 0 33.941l-80 80C409.956 271.982 384 261.456 384 240v-48H24c-13.255 0-24-10.745-24-24zm488 152H128v-48c0-21.314-25.862-32.08-40.971-16.971l-80 80c-9.372 9.373-9.372 24.569 0 33.941l80 80C102.057 463.997 128 453.437 128 432v-48h360c13.255 0 24-10.745 24-24v-16c0-13.255-10.745-24-24-24z"}}]})(e)}function gt(e){return et({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"}}]})(e)}function mt(e){return et({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M448 344v112a23.94 23.94 0 0 1-24 24H312c-21.39 0-32.09-25.9-17-41l36.2-36.2L224 295.6 116.77 402.9 153 439c15.09 15.1 4.39 41-17 41H24a23.94 23.94 0 0 1-24-24V344c0-21.4 25.89-32.1 41-17l36.19 36.2L184.46 256 77.18 148.7 41 185c-15.1 15.1-41 4.4-41-17V56a23.94 23.94 0 0 1 24-24h112c21.39 0 32.09 25.9 17 41l-36.2 36.2L224 216.4l107.23-107.3L295 73c-15.09-15.1-4.39-41 17-41h112a23.94 23.94 0 0 1 24 24v112c0 21.4-25.89 32.1-41 17l-36.19-36.2L263.54 256l107.28 107.3L407 327.1c15.1-15.2 41-4.5 41 16.9z"}}]})(e)}function vt(e){return et({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M432 416h-23.41L277.88 53.69A32 32 0 0 0 247.58 32h-47.16a32 32 0 0 0-30.3 21.69L39.41 416H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h128a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16h-19.58l23.3-64h152.56l23.3 64H304a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h128a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM176.85 272L224 142.51 271.15 272z"}}]})(e)}function yt(e){return et({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M622.34 153.2L343.4 67.5c-15.2-4.67-31.6-4.67-46.79 0L17.66 153.2c-23.54 7.23-23.54 38.36 0 45.59l48.63 14.94c-10.67 13.19-17.23 29.28-17.88 46.9C38.78 266.15 32 276.11 32 288c0 10.78 5.68 19.85 13.86 25.65L20.33 428.53C18.11 438.52 25.71 448 35.94 448h56.11c10.24 0 17.84-9.48 15.62-19.47L82.14 313.65C90.32 307.85 96 298.78 96 288c0-11.57-6.47-21.25-15.66-26.87.76-15.02 8.44-28.3 20.69-36.72L296.6 284.5c9.06 2.78 26.44 6.25 46.79 0l278.95-85.7c23.55-7.24 23.55-38.36 0-45.6zM352.79 315.09c-28.53 8.76-52.84 3.92-65.59 0l-145.02-44.55L128 384c0 35.35 85.96 64 192 64s192-28.65 192-64l-14.18-113.47-145.03 44.56z"}}]})(e)}function bt(e){return et({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h416c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM112 120c-30.928 0-56 25.072-56 56s25.072 56 56 56 56-25.072 56-56-25.072-56-56-56zM64 384h384V272l-87.515-87.515c-4.686-4.686-12.284-4.686-16.971 0L208 320l-55.515-55.515c-4.686-4.686-12.284-4.686-16.971 0L64 336v48z"}}]})(e)}function xt(e){return et({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}}]})(e)}function wt(e){return et({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M512 176.001C512 273.203 433.202 352 336 352c-11.22 0-22.19-1.062-32.827-3.069l-24.012 27.014A23.999 23.999 0 0 1 261.223 384H224v40c0 13.255-10.745 24-24 24h-40v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24v-78.059c0-6.365 2.529-12.47 7.029-16.971l161.802-161.802C163.108 213.814 160 195.271 160 176 160 78.798 238.797.001 335.999 0 433.488-.001 512 78.511 512 176.001zM336 128c0 26.51 21.49 48 48 48s48-21.49 48-48-21.49-48-48-48-48 21.49-48 48z"}}]})(e)}function St(e){return et({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M152.1 236.2c-3.5-12.1-7.8-33.2-7.8-33.2h-.5s-4.3 21.1-7.8 33.2l-11.1 37.5H163zM616 96H336v320h280c13.3 0 24-10.7 24-24V120c0-13.3-10.7-24-24-24zm-24 120c0 6.6-5.4 12-12 12h-11.4c-6.9 23.6-21.7 47.4-42.7 69.9 8.4 6.4 17.1 12.5 26.1 18 5.5 3.4 7.3 10.5 4.1 16.2l-7.9 13.9c-3.4 5.9-10.9 7.8-16.7 4.3-12.6-7.8-24.5-16.1-35.4-24.9-10.9 8.7-22.7 17.1-35.4 24.9-5.8 3.5-13.3 1.6-16.7-4.3l-7.9-13.9c-3.2-5.6-1.4-12.8 4.2-16.2 9.3-5.7 18-11.7 26.1-18-7.9-8.4-14.9-17-21-25.7-4-5.7-2.2-13.6 3.7-17.1l6.5-3.9 7.3-4.3c5.4-3.2 12.4-1.7 16 3.4 5 7 10.8 14 17.4 20.9 13.5-14.2 23.8-28.9 30-43.2H412c-6.6 0-12-5.4-12-12v-16c0-6.6 5.4-12 12-12h64v-16c0-6.6 5.4-12 12-12h16c6.6 0 12 5.4 12 12v16h64c6.6 0 12 5.4 12 12zM0 120v272c0 13.3 10.7 24 24 24h280V96H24c-13.3 0-24 10.7-24 24zm58.9 216.1L116.4 167c1.7-4.9 6.2-8.1 11.4-8.1h32.5c5.1 0 9.7 3.3 11.4 8.1l57.5 169.1c2.6 7.8-3.1 15.9-11.4 15.9h-22.9a12 12 0 0 1-11.5-8.6l-9.4-31.9h-60.2l-9.1 31.8c-1.5 5.1-6.2 8.7-11.5 8.7H70.3c-8.2 0-14-8.1-11.4-15.9z"}}]})(e)}function kt(e){return et({tag:"svg",attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M96.06 454.35c.01 6.29 1.87 12.45 5.36 17.69l17.09 25.69a31.99 31.99 0 0 0 26.64 14.28h61.71a31.99 31.99 0 0 0 26.64-14.28l17.09-25.69a31.989 31.989 0 0 0 5.36-17.69l.04-38.35H96.01l.05 38.35zM0 176c0 44.37 16.45 84.85 43.56 115.78 16.52 18.85 42.36 58.23 52.21 91.45.04.26.07.52.11.78h160.24c.04-.26.07-.51.11-.78 9.85-33.22 35.69-72.6 52.21-91.45C335.55 260.85 352 220.37 352 176 352 78.61 272.91-.3 175.45 0 73.44.31 0 82.97 0 176zm176-80c-44.11 0-80 35.89-80 80 0 8.84-7.16 16-16 16s-16-7.16-16-16c0-61.76 50.24-112 112-112 8.84 0 16 7.16 16 16s-7.16 16-16 16z"}}]})(e)}function Ct(e){return et({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M80 368H16a16 16 0 0 0-16 16v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16v-64a16 16 0 0 0-16-16zm0-320H16A16 16 0 0 0 0 64v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16V64a16 16 0 0 0-16-16zm0 160H16a16 16 0 0 0-16 16v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16v-64a16 16 0 0 0-16-16zm416 176H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z"}}]})(e)}function Et(e){return et({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M224 96l16-32 32-16-32-16-16-32-16 32-32 16 32 16 16 32zM80 160l26.66-53.33L160 80l-53.34-26.67L80 0 53.34 53.33 0 80l53.34 26.67L80 160zm352 128l-26.66 53.33L352 368l53.34 26.67L432 448l26.66-53.33L512 368l-53.34-26.67L432 288zm70.62-193.77L417.77 9.38C411.53 3.12 403.34 0 395.15 0c-8.19 0-16.38 3.12-22.63 9.38L9.38 372.52c-12.5 12.5-12.5 32.76 0 45.25l84.85 84.85c6.25 6.25 14.44 9.37 22.62 9.37 8.19 0 16.38-3.12 22.63-9.37l363.14-363.15c12.5-12.48 12.5-32.75 0-45.24zM359.45 203.46l-50.91-50.91 86.6-86.6 50.91 50.91-86.6 86.6z"}}]})(e)}function At(e){return et({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M290.74 93.24l128.02 128.02-277.99 277.99-114.14 12.6C11.35 513.54-1.56 500.62.14 485.34l12.7-114.22 277.9-277.88zm207.2-19.06l-60.11-60.11c-18.75-18.75-49.16-18.75-67.91 0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.76 18.75-49.16 0-67.91z"}}]})(e)}function Tt(e){return et({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(e)}function It(e){return et({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M32,224H64V416H32A31.96166,31.96166,0,0,1,0,384V256A31.96166,31.96166,0,0,1,32,224Zm512-48V448a64.06328,64.06328,0,0,1-64,64H160a64.06328,64.06328,0,0,1-64-64V176a79.974,79.974,0,0,1,80-80H288V32a32,32,0,0,1,64,0V96H464A79.974,79.974,0,0,1,544,176ZM264,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,264,256Zm-8,128H192v32h64Zm96,0H288v32h64ZM456,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,456,256Zm-8,128H384v32h64ZM640,256V384a31.96166,31.96166,0,0,1-32,32H576V224h32A31.96166,31.96166,0,0,1,640,256Z"}}]})(e)}function zt(e){return et({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"}}]})(e)}function Ft(e){return et({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M440.65 12.57l4 82.77A247.16 247.16 0 0 0 255.83 8C134.73 8 33.91 94.92 12.29 209.82A12 12 0 0 0 24.09 224h49.05a12 12 0 0 0 11.67-9.26 175.91 175.91 0 0 1 317-56.94l-101.46-4.86a12 12 0 0 0-12.57 12v47.41a12 12 0 0 0 12 12H500a12 12 0 0 0 12-12V12a12 12 0 0 0-12-12h-47.37a12 12 0 0 0-11.98 12.57zM255.83 432a175.61 175.61 0 0 1-146-77.8l101.8 4.87a12 12 0 0 0 12.57-12v-47.4a12 12 0 0 0-12-12H12a12 12 0 0 0-12 12V500a12 12 0 0 0 12 12h47.35a12 12 0 0 0 12-12.6l-4.15-82.57A247.17 247.17 0 0 0 255.83 504c121.11 0 221.93-86.92 243.55-201.82a12 12 0 0 0-11.8-14.18h-49.05a12 12 0 0 0-11.67 9.26A175.86 175.86 0 0 1 255.83 432z"}}]})(e)}function Mt(e){return et({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"}}]})(e)}function jt(e){return et({tag:"svg",attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"}}]})(e)}function Bt(e){return et({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z"}}]})(e)}var Rt=function(){return Rt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},Rt.apply(this,arguments)};const Ot=function(e){var t=e.size,n=void 0===t?"medium":t,r=e.type,a=void 0===r?"spinner":r,i=e.color,l=void 0===i?"#3B82F6":i,s=e.text,c=e.fullScreen,u=void 0!==c&&c,d=e.overlay,p=void 0!==d&&d,f=e.inline,h=void 0!==f&&f,g={small:{container:"16px",fontSize:"12px",spacing:"8px"},medium:{container:"24px",fontSize:"14px",spacing:"12px"},large:{container:"32px",fontSize:"16px",spacing:"16px"}}[n],m={display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:g.spacing,zIndex:1e3};return u&&(m.position="fixed",m.top=0,m.left=0,m.right=0,m.bottom=0),p&&(m.position="absolute",m.top=0,m.left=0,m.right=0,m.bottom=0,m.backgroundColor="rgba(255, 255, 255, 0.8)"),h&&(m.display="inline-flex",m.flexDirection="row",m.marginLeft="8px",m.marginRight="8px"),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("style",{children:["\n    @keyframes spin {\n      0% { transform: rotate(0deg); }\n      100% { transform: rotate(360deg); }\n    }\n  ","\n    @keyframes pulse {\n      0%, 100% { opacity: 1; transform: scale(1); }\n      50% { opacity: 0.5; transform: scale(0.8); }\n    }\n  ","\n    @keyframes dots1 {\n      0%, 80%, 100% { transform: scale(0); }\n      40% { transform: scale(1); }\n    }\n    @keyframes dots2 {\n      0%, 80%, 100% { transform: scale(0); }\n      40% { transform: scale(1); }\n      animation-delay: 0.2s;\n    }\n    @keyframes dots3 {\n      0%, 80%, 100% { transform: scale(0); }\n      40% { transform: scale(1); }\n      animation-delay: 0.4s;\n    }\n  "]}),(0,o.jsxs)("div",Rt({style:m},{children:[function(){switch(a){case"spinner":return(0,o.jsx)("div",{style:{width:g.container,height:g.container,border:"2px solid ".concat(l),borderTopColor:"transparent",borderRadius:"50%",animation:"spin 0.8s linear infinite"}});case"pulse":return(0,o.jsx)("div",{style:{width:g.container,height:g.container,backgroundColor:l,borderRadius:"50%",animation:"pulse 1.2s ease-in-out infinite"}});case"dots":return(0,o.jsx)("div",Rt({style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"}},{children:[1,2,3].map((function(e){return(0,o.jsx)("div",{style:{width:"calc(".concat(g.container," / 3)"),height:"calc(".concat(g.container," / 3)"),backgroundColor:l,borderRadius:"50%",animation:"dots".concat(e," 1.4s infinite ease-in-out both"),animationDelay:"".concat(.2*(e-1),"s")}},e)}))}));default:return null}}(),s&&(0,o.jsx)("div",Rt({style:{color:l,fontSize:g.fontSize,fontWeight:500,textAlign:"center"}},{children:s}))]}))]})};var Lt=n(984),Nt=n(75),Pt=n(148),_t=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))},Dt=function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(s){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&l[0]?r.return:l[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,l[1])).done)return a;switch(r=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,r=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],r=0}finally{n=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}},qt=function(e,t,n){if(n||2===arguments.length)for(var r,a=0,o=t.length;a<o;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))},Ut=[/[a-zA-Z\ud835\udc46\ud835\udc5d\ud835\udc4e\ud835\udc4f\ud835\udc50\ud835\udc65\ud835\udc66\ud835\udc67]\s*[\+\-\*\/\=]\s*[a-zA-Z0-9\ud835\udc46\ud835\udc5d\ud835\udc4e\ud835\udc4f\ud835\udc50]/g,/[a-zA-Z0-9\ud835\udc46\ud835\udc5d\ud835\udc4e\ud835\udc4f\ud835\udc50]\^[0-9]+|[a-zA-Z0-9\ud835\udc46\ud835\udc5d\ud835\udc4e\ud835\udc4f\ud835\udc50][\xb2\xb3\u2074\u2075\u2076\u2077\u2078\u2079]/g,/\b(sin|cos|tan|log|ln|exp|sqrt|abs|max|min|lim)\s*\(/g,/\b\d+\/\d+\b/g,/\b(alpha|beta|gamma|delta|epsilon|pi|sigma|theta|omega|mu|lambda)\b/gi,/[\u03c0\u03b1\ud835\udefc\u03b2\ud835\udefd\u03b3\ud835\udefe\u03b4\ud835\udeff\u03b8\ud835\udf03\u03bb\ud835\udf06\u03bc\ud835\udf07\u03c3\ud835\udf0e\u03c6\ud835\udf11\u03c9\ud835\udf14]/g,/[\xb1\u2211\u222b\u221a\u221e\u2264\u2265\u2260\u2248\u2202\u2207\xb7]/g,/[\ud835\udc46\ud835\udc5d\ud835\udc4e\ud835\udc4f\ud835\udc50\ud835\udc65\ud835\udc66\ud835\udc67\ud835\udc34\ud835\udc35\ud835\udc36]/g,/\([a-zA-Z0-9\ud835\udc46\ud835\udc5d\ud835\udc4e\ud835\udc4f\ud835\udc50\+\-\*\/\^\s]+\)\s*[\=\+\-\*\/]/g,/[\ud835\udc46S]\s*=\s*[\ud835\udc5dp]\s*\([\ud835\udc5dp]\s*[-\u2212]\s*[\ud835\udc4ea]\)/g],$t=function(e){return Ut.some((function(t){return t.test(e)}))},Ht=["\u0443\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u0435","\u0444\u043e\u0440\u043c\u0443\u043b\u0430","\u0438\u043d\u0442\u0435\u0433\u0440\u0430\u043b","\u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u043d\u0430\u044f","\u0444\u0443\u043d\u043a\u0446\u0438\u044f","\u0442\u0435\u043e\u0440\u0435\u043c\u0430","\u043b\u0435\u043c\u043c\u0430","\u0434\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c\u0441\u0442\u0432\u043e","\u0432\u044b\u0447\u0438\u0441\u043b\u0438\u0442\u044c","\u043d\u0430\u0439\u0442\u0438","\u043a\u043e\u0440\u0435\u043d\u044c","\u0441\u0442\u0435\u043f\u0435\u043d\u044c","\u043b\u043e\u0433\u0430\u0440\u0438\u0444\u043c","\u0441\u0438\u043d\u0443\u0441","\u043a\u043e\u0441\u0438\u043d\u0443\u0441","\u0442\u0430\u043d\u0433\u0435\u043d\u0441","\u043f\u0440\u0435\u0434\u0435\u043b","\u0441\u0443\u043c\u043c\u0430","\u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0434\u0435\u043d\u0438\u0435","\u043c\u0430\u0442\u0440\u0438\u0446\u0430","\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u0435\u043b\u044c","\u043f\u043b\u043e\u0449\u0430\u0434\u044c","\u0442\u0440\u0435\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a","\u043f\u0435\u0440\u0438\u043c\u0435\u0442\u0440","\u0434\u043b\u0438\u043d\u0430","\u0441\u0442\u043e\u0440\u043e\u043d\u0430","\u0433\u0438\u043f\u043e\u0442\u0435\u043d\u0443\u0437\u0430","\u043a\u0430\u0442\u0435\u0442","\u0440\u0430\u0434\u0438\u0443\u0441","\u0434\u0438\u0430\u043c\u0435\u0442\u0440","\u043e\u043a\u0440\u0443\u0436\u043d\u043e\u0441\u0442\u044c"],Vt=function(e){var t=e.toLowerCase();return Ht.some((function(e){return t.includes(e)}))},Gt=function(e,t){return void 0===t&&(t=!0),_t(void 0,void 0,void 0,(function(){var n,r,a,o;return Dt(this,(function(i){switch(i.label){case 0:if(n={originalText:e,processedText:e,formulasDetected:0,formulas:[]},!$t(e)&&!Vt(e))return[2,n];i.label=1;case 1:return i.trys.push([1,5,,6]),t?(r="".concat("\nAnalyze the following text and identify mathematical expressions, equations, formulas, or mathematical notation. \nConvert them to proper LaTeX format for beautiful rendering.\n\nRules:\n1. Identify mathematical expressions including:\n   - Equations (like x^2 + y^2 = z^2)\n   - Mathematical functions (sin, cos, log, etc.)\n   - Fractions, integrals, summations\n   - Greek letters (alpha, beta, pi, etc.)\n   - Mathematical symbols (\u2211, \u222b, \u221a, \xb1, \u2265, \u2264, etc.)\n   - Exponents and subscripts\n   - Mathematical constants (pi, e, infinity)\n\n2. Convert to LaTeX:\n   - Use $$formula$$ for display math (block formulas)\n   - Use $formula$ for inline math\n   - Proper LaTeX syntax (\\frac{}{}, \\sqrt{}, \\int, \\sum, etc.)\n\n3. Preserve the original text structure\n4. Only wrap actual mathematical content\n\n5. Return ONLY the processed text with formulas converted to LaTeX.\n   Do not add explanations or comments.\n\nText to analyze:\n",'\n\n"').concat(e,'"'),[4,(0,Nt.getAIService)(Pt.l.OpenAI).translateText(r,"en")]):[3,3];case 2:return(a=i.sent())&&a!==e&&(n.processedText=a,n.formulasDetected=Wt(a),n.formulas=Yt(e,a)),[3,4];case 3:n.processedText=Xt(e),n.formulasDetected=Wt(n.processedText),i.label=4;case 4:return[3,6];case 5:return o=i.sent(),console.warn("Formula detection AI failed, using fallback:",o),n.processedText=Xt(e),n.formulasDetected=Wt(n.processedText),[3,6];case 6:return[2,n]}}))}))},Wt=function(e){return(e.match(/\$\$[^$]+\$\$/g)||[]).length+(e.match(/(?<!\$)\$[^$\n]+\$(?!\$)/g)||[]).length},Yt=function(e,t){var n=[];return qt(qt([],Array.from(t.matchAll(/\$\$([^$]+)\$\$/g)),!0),Array.from(t.matchAll(/(?<!\$)\$([^$\n]+)\$(?!\$)/g)),!0).forEach((function(e,t){n.push({original:e[0],latex:e[1],position:{start:e.index||0,end:(e.index||0)+e[0].length},confidence:.8})})),n},Kt=function(e){var t=e;return Object.entries({\u{1d446}:"S",\u{1d45d}:"p",\u{1d44e}:"a",\u{1d44f}:"b",\u{1d450}:"c",\u{1d465}:"x",\u{1d466}:"y",\u{1d467}:"z",\u{1d434}:"A",\u{1d435}:"B",\u{1d436}:"C",\u{1d4ae}:"S",\u{1d491}:"p",\u03c0:"pi",\u03b1:"alpha",\u03b2:"beta",\u03b3:"gamma",\u03b4:"delta",\u03b8:"theta",\u03bb:"lambda",\u03bc:"mu",\u03c3:"sigma",\u03c6:"phi",\u03c9:"omega"}).forEach((function(e){var n=e[0],r=e[1],a=new RegExp(n,"g");t=t.replace(a,r)})),t=(t=t.replace(/([a-zA-Z])\s+([=+\-*/()])/g,"$1$2")).replace(/([=+\-*/(])\s+([a-zA-Z])/g,"$1$2")},Xt=function(e){var t=e;t=(t=(t=(t=(t=(t=Kt(t)).replace(/([psPS])\s*=\s*\(([^)]+)\)\s*\/\s*(\d+)/g,"$$$$1 = \\frac{$2}{$3}$$")).replace(/\u043f\u043e\u043b\u0443\u043f\u0435\u0440\u0438\u043c\u0435\u0442\u0440\s+([psPS])\s+\u0440\u0430\u0432\u0435\u043d\s+\u043f\u043e\u043b\u043e\u0432\u0438\u043d\u0435\s+\u0441\u0443\u043c\u043c\u044b\s+\u0441\u0442\u043e\u0440\u043e\u043d[:\s]*([psPS])\s*=\s*\(([^)]+)\)\s*\/\s*(\d+)/gi,"\u041f\u043e\u043b\u0443\u043f\u0435\u0440\u0438\u043c\u0435\u0442\u0440 $1 \u0440\u0430\u0432\u0435\u043d \u043f\u043e\u043b\u043e\u0432\u0438\u043d\u0435 \u0441\u0443\u043c\u043c\u044b \u0441\u0442\u043e\u0440\u043e\u043d: $$$$2 = \\frac{$3}{$4}$$")).replace(/([Ss\u041f\u043b\u043e\u0449\u0430\u0434\u044c]*)\s*=\s*sqrt\s*\(([^)]+)\)/gi,"$$$$1 = \\sqrt{$2}$$")).replace(/\b([a-zA-Z])\^([0-9]+)\b/g,"$$$$1^{$2}$$")).replace(/\b([a-zA-Z])\^(\d+)\s*\+\s*([a-zA-Z])\^(\d+)\s*=\s*([a-zA-Z])\^(\d+)\b/g,"$$$$1^{$2} + $3^{$4} = $5^{$6}$$");Object.entries({\u0430\u043b\u044c\u0444\u0430:"\\alpha",\u0431\u0435\u0442\u0430:"\\beta",\u0433\u0430\u043c\u043c\u0430:"\\gamma",\u0434\u0435\u043b\u044c\u0442\u0430:"\\delta",\u044d\u043f\u0441\u0438\u043b\u043e\u043d:"\\epsilon",\u043f\u0438:"\\pi",\u0441\u0438\u0433\u043c\u0430:"\\sigma",\u0442\u0435\u0442\u0430:"\\theta",\u043e\u043c\u0435\u0433\u0430:"\\omega",\u043c\u044e:"\\mu",\u043b\u044f\u043c\u0431\u0434\u0430:"\\lambda",\u0444\u0438:"\\phi"}).forEach((function(e){var n=e[0],r=e[1],a=new RegExp("\\b".concat(n,"\\b"),"gi");t=t.replace(a,"$".concat(r,"$"))}));return Object.entries({alpha:"\\alpha",beta:"\\beta",gamma:"\\gamma",delta:"\\delta",epsilon:"\\epsilon",pi:"\\pi",sigma:"\\sigma",theta:"\\theta",omega:"\\omega",mu:"\\mu",lambda:"\\lambda",phi:"\\phi"}).forEach((function(e){var n=e[0],r=e[1],a=new RegExp("\\b".concat(n,"\\b"),"gi");t=t.replace(a,"$".concat(r,"$"))})),t=(t=(t=(t=(t=(t=(t=(t=t.replace(/\b(sin|cos|tan|log|ln)\s*\(([^)]+)\)/g,"$\\\\$1($2)$")).replace(/\b(\w+)\s*\/\s*(\w+)\b/g,"$\\frac{$1}{$2}$")).replace(/sqrt\s*\(([^)]+)\)/gi,"$\\sqrt{$1}$")).replace(/\u043a\u043e\u0440\u0435\u043d\u044c\s+\u0438\u0437\s+(\w+)/gi,"$\\sqrt{$1}$")).replace(/\u221a\s*([^,.\s]+)/g,"\\sqrt{$1}")).replace(/S\s*=\s*\u221a?\s*p\s*\(?\s*p\s*[-\u2212]\s*a\s*\)?\s*\(?\s*p\s*[-\u2212]\s*b\s*\)?\s*\(?\s*p\s*[-\u2212]\s*c\s*\)?/gi,"$$S = \\sqrt{p(p-a)(p-b)(p-c)}$$")).replace(/S\s*=\s*\u221a?\s*p\s*\(\s*p\s*[-\u2212]\s*a\s*\)\s*\(\s*p\s*[-\u2212]\s*b\s*\)\s*\(\s*p\s*[-\u2212]\s*c\s*\)/gi,"$$S = \\sqrt{p(p-a)(p-b)(p-c)}$$")).replace(/\(([a-zA-Z])\s*[-\u2212]\s*([a-zA-Z])\)/g,"($1 - $2)")},Qt=function(){return Qt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},Qt.apply(this,arguments)},Jt=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))},Zt=function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(s){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&l[0]?r.return:l[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,l[1])).done)return a;switch(r=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,r=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],r=0}finally{n=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}};const en=function(e){var t=e.content,n=e.className,a=void 0===n?"":n,i=e.style,l=void 0===i?{}:i,s=e.enableAI,c=void 0===s||s,u=e.onProcessingComplete,d=(0,r.useState)(t),p=d[0],f=d[1],h=(0,r.useState)(!1),g=h[0],m=h[1],v=(0,r.useState)(!1),y=v[0],b=v[1],x=(0,r.useRef)(null),w=(0,r.useRef)("");(0,r.useEffect)((function(){t!==w.current&&(w.current=t,S(t))}),[t,c]);var S=function(e){return Jt(void 0,void 0,void 0,(function(){var n,r,a,o,i,l,s,d;return Zt(this,(function(p){switch(p.label){case 0:if(!(null==e?void 0:e.trim()))return f(""),b(!1),null==u||u(!1),[2];console.log("\u{1f527} MathContentRenderer processing:",e),m(!0),p.label=1;case 1:if(p.trys.push([1,11,12,13]),h=function(e){for(var t="",n=0;n<e.length;){var r=e.codePointAt(n),a=String.fromCodePoint(r),o=null;r>=119808&&r<=119833?o=String.fromCharCode("A".charCodeAt(0)+(r-119808)):r>=119834&&r<=119859?o=String.fromCharCode("a".charCodeAt(0)+(r-119834)):r>=119860&&r<=119885?o=String.fromCharCode("A".charCodeAt(0)+(r-119860)):r>=119886&&r<=119911?o=String.fromCharCode("a".charCodeAt(0)+(r-119886)):r>=119912&&r<=119937?o=String.fromCharCode("A".charCodeAt(0)+(r-119912)):r>=119938&&r<=119963?o=String.fromCharCode("a".charCodeAt(0)+(r-119938)):r>=120782&&r<=120791?o=String.fromCharCode("0".charCodeAt(0)+(r-120782)):8462===r&&(o="h"),t+=null!=o?o:a,n+=a.length}return t=t.replace(/\b([A-Za-z])\s(?:[A-Za-z]\s+){2,}[A-Za-z]\b/g,(function(e){return e.replace(/\s+/g,"")}))}(h=(h=(h=e).replace(/[\u200B-\u200D\u2060\u2061\uFEFF]/g,"")).replace(/https?:\/\/[^\s]*org\/MathML[^\s]*/gi,"").replace(/\borg\s*\/\s*MathML\b/gi,"").replace(/application-tex\"?>?/gi,"").replace(/xapplication-tex/gi,"").replace(/MathMLMath/gi,"").replace(/data-tex\s*=\s*\"[^\"]*\"/gi,"").replace(/aria-hidden=\"true\"/gi,"")),n=(n=h=(h=(h=(h=(h=(h=h.replace(/https?:\/\/\s*w\s*3\s*\.\s*o\s*r\s*g\s*\/\s*1998\s*\/\s*Math\s*\/\s*MathML/gi,"").replace(/\bw\s*3\s*\.\s*o\s*r\s*g\b/gi,"").replace(/\b1998\s*org\s*\/?/gi,"").replace(/\borg\b\s*1998/gi,"").replace(/\b1998\s*\/\s*Math\s*\/\s*MathML\b/gi,"").replace(/MathMLMath/gi,"").replace(/\bMathML\b/gi,"")).replace(/xmlns\s*=\s*"[^"]*MathML[^"]*"/gi,"").replace(/display\s*=\s*"block"/gi,"").replace(/<annotation[\s\S]*?<\/annotation>/gi,"").replace(/application[^a-zA-Z]*x?[^a-zA-Z]*tex/gi,"")).replace(/<[^>]*>/g,"")).replace(/\b(semantics|mrow|mfrac|mi|mo)\b/gi,"")).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/[\u00A0\t ]+/g," ").replace(/\s*\n\s*/g," ").replace(/\s{2,}/g," ").trim()).replace(/\$\$1\s*=\s*[^$]*\$*/g,"").replace(/\xb7/g,"*").replace(/\u2212/g,"-").replace(/\$\$[^$]*$/g,""),console.log("\u{1f9f9} Cleaned text:",n),n=(n=n.replace(/(\u043f\u043e\s+\u0444\u043e\u0440\u043c\u0443\u043b\u0435\s*:|formula\s*:)[\s\n]*([^\n]+?)(?=(\n|\.|$))/gi,(function(e,t,n){var r=n.replace(/\^(\d+)/g,"^{$1}").trim();return"".concat(t,"\n$$").concat(r,"$$")}))).replace(/(^|\n)\s*([A-Za-z\u0410-\u042f\u0430-\u044f][A-Za-z\u0410-\u042f\u0430-\u044f0-9_\s\(\)\^+\-\\\/\*\xb7=]+=[^\n]+)\s*(?=\n|$)/g,(function(e,t,n){var r=n.replace(/\xb7/g,"\\cdot").replace(/\^(\d+)/g,"^{$1}").trim();return"".concat(t,"$$").concat(r,"$$")})),r=function(e){console.log("\u{1f50d} Force formula detection for:",e);var t=e;return t=Kt(t),console.log("\u{1f524} After Unicode conversion:",t),t=(t=(t=(t=(t=(t=t.replace(/\$\$1\s*=\s*\\frac\{?\(?(a\s*\+\s*b\s*\+\s*c)\)?\}?\{?2\}?\$*/g,"$$p = \\frac{a + b + c}{2}$$")).replace(/\$\$1\s*=\s*\\sqrt\{[^}]*$/g,"$$S = \\sqrt{p \\cdot (p - a) \\cdot (p - b) \\cdot (p - c)}$$")).replace(/\xb7/g,"\\cdot")).replace(/\u2212/g,"-")).replace(/\u043f\u043e\u043b\u0443\u043f\u0435\u0440\u0438\u043c\u0435\u0442\u0440\s+([pP])\s+\u0440\u0430\u0432\u0435\u043d\s+\u043f\u043e\u043b\u043e\u0432\u0438\u043d\u0435\s+\u0441\u0443\u043c\u043c\u044b\s+\u0441\u0442\u043e\u0440\u043e\u043d[:\s]*\$?\$?1?\s*=\s*\\?frac\{?\(?(a\s*\+\s*b\s*\+\s*c)\)?\}?\{?2\}?\$?/gi,"\u041f\u043e\u043b\u0443\u043f\u0435\u0440\u0438\u043c\u0435\u0442\u0440 $1 \u0440\u0430\u0432\u0435\u043d \u043f\u043e\u043b\u043e\u0432\u0438\u043d\u0435 \u0441\u0443\u043c\u043c\u044b \u0441\u0442\u043e\u0440\u043e\u043d: $$p = \\frac{a + b + c}{2}$$")).replace(/\u0432\u044b\u0440\u043e\u0436\u0435\u043d\u0438\u0435\s+\u043f\u043b\u043e\u0449\u0430\u0434\u0438\s+\u0440\u0435\u0430\u043b\u0438\u0437\u0443\u0435\u0442\u0441\u044f\s+\u0447\u0435\u0440\u0435\u0437\s+\u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0434\u0435\u043d\u0438\u0435[^:]*:\s*\$\$1\s*=\s*\\sqrt\{[^}]*\$*/gi,"\u0412\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043f\u043b\u043e\u0449\u0430\u0434\u0438 \u0440\u0435\u0430\u043b\u0438\u0437\u0443\u0435\u0442\u0441\u044f \u0447\u0435\u0440\u0435\u0437 \u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0434\u0435\u043d\u0438\u0435: $$S = \\sqrt{p \\cdot (p - a) \\cdot (p - b) \\cdot (p - c)}$$"),(t=(t=(t=(t=Xt(t)).replace(/\u0444\u043e\u0301?\u0440\u043c\u0443\u043b\u0430\s+\u0433\u0435\u0440\u043e\u043d\u0430[^:]*:\s*S\s*=\s*p\s*\(\s*p\s*[-\u2212]\s*a\s*\)\s*\(\s*p\s*[-\u2212]\s*b\s*\)\s*\(\s*p\s*[-\u2212]\s*c\s*\)\s*,?/gi,"\u0424\u043e\u0440\u043c\u0443\u043b\u0430 \u0413\u0435\u0440\u043e\u043d\u0430: $$S = \\sqrt{p(p-a)(p-b)(p-c)}$$,")).replace(/S\s*=\s*p\s*\(\s*p\s*[-\u2212]\s*a\s*\)\s*\(\s*p\s*[-\u2212]\s*b\s*\)\s*\(\s*p\s*[-\u2212]\s*c\s*\)\s*,?\s*/gi,"$$S = \\sqrt{p(p-a)(p-b)(p-c)}$$")).replace(/\u0442\u0435\u043e\u0440\u0435\u043c\u0430\s+\u043f\u0438\u0444\u0430\u0433\u043e\u0440\u0430[:\s]*([^.!?]*)/gi,"\u0422\u0435\u043e\u0440\u0435\u043c\u0430 \u041f\u0438\u0444\u0430\u0433\u043e\u0440\u0430: $$a^2 + b^2 = c^2$$")).includes("\\sqrt{p(p-a)(p-b)(p-c)}")||t.includes("\\sqrt{p \\cdot (p - a)")||(t=t.replace(/S\s*=\s*\\?sqrt\s*\{?([^}]*)\}?/gi,"$$S = \\sqrt{$1}$$")),console.log("\u2705 Processed result:",t),t}(n),r=r.replace(/\\{2,}([A-Za-z]+)/g,"\\$1").replace(/\\{2,}\{/g,"\\{").replace(/\\{2,}\}/g,"\\}").replace(/\\{2,}\^/g,"\\^").replace(/\\{2,}_/g,"\\_").replace(/\\{2,}\$/g,"\\$").replace(/\\{2,}mathbb/g,"\\mathbb").replace(/\\{2,}mathcal/g,"\\mathcal").replace(/\\{2,}times/g,"\\times").replace(/\\{2,}sum/g,"\\sum"),a=(r.match(/\$\$[^$]+\$\$/g)||[]).length+(r.match(/(?<!\$)\$[^$\n]+\$(?!\$)/g)||[]).length,console.log("\u{1f4ca} Found formulas:",a),b(a>0),0!==a)return[3,9];if(!c||!function(e){return $t(e)||Vt(e)||e.length>50}(e))return[3,7];p.label=2;case 2:return p.trys.push([2,4,,6]),console.log("\u{1f916} Trying AI formula detection..."),[4,Gt(e,!0)];case 3:return(l=p.sent()).formulasDetected>0&&(r=l.processedText,b(!0),console.log("\u2705 AI found formulas:",l.formulasDetected)),[3,6];case 4:return o=p.sent(),console.warn("\u274c AI formula detection failed, using simple rules:",o),[4,Gt(e,!1)];case 5:return i=p.sent(),r=i.processedText,b(i.formulasDetected>0),[3,6];case 6:return[3,9];case 7:return console.log("\u{1f4dd} Using simple formula rules..."),[4,Gt(e,!1)];case 8:l=p.sent(),r=l.processedText,b(l.formulasDetected>0),p.label=9;case 9:return console.log("\u{1f3a8} Rendering with KaTeX:",r),[4,(0,Lt.processLatexInContentAsync)(r)];case 10:return s=p.sent(),console.log("\u2728 Final rendered content:",s),f(s),null==u||u(y),[3,13];case 11:return d=p.sent(),console.error("\u274c Content processing error:",d),f(t),b(!1),null==u||u(!1),[3,13];case 12:return m(!1),[7];case 13:return[2]}var h}))}))};var k=Qt({lineHeight:"1.6",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',color:"#374151",fontSize:"14px",wordWrap:"break-word"},l),C=g?{opacity:.7,transition:"opacity 0.2s ease"}:{};return(0,o.jsxs)("div",Qt({ref:x,className:"math-content-renderer ".concat(a," ").concat(y?"has-formulas":""),style:Qt(Qt({},k),C)},{children:[g&&y&&(0,o.jsx)("div",Qt({style:{position:"absolute",top:"2px",right:"2px",fontSize:"10px",color:"#6B7280",background:"rgba(255,255,255,0.8)",padding:"1px 4px",borderRadius:"2px",fontWeight:"500"}},{children:"Rendering math..."})),(0,o.jsx)("div",{dangerouslySetInnerHTML:{__html:p},style:{position:"relative"}}),(0,o.jsx)("style",{children:"\n                .math-content-renderer .katex {\n                    font-size: 1.1em !important;\n                    color: #1f2937 !important;\n                }\n                \n                .math-content-renderer .katex-display {\n                    margin: 16px 0 !important;\n                    padding: 12px !important;\n                    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%) !important;\n                    border-radius: 8px !important;\n                    border: 1px solid #e2e8f0 !important;\n                    box-shadow: 0 1px 3px rgba(0,0,0,0.1) !important;\n                    position: relative !important;\n                    overflow-x: auto !important;\n                }\n                \n                .math-content-renderer .katex-display::before {\n                    content: '';\n                    position: absolute;\n                    top: 8px;\n                    right: 8px;\n                    width: 12px;\n                    height: 12px;\n                    background: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"%236B7280\"><path d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z\"/></svg>') no-repeat center;\n                    background-size: contain;\n                    opacity: 0.3;\n                }\n                \n                .math-content-renderer .katex:not(.katex-display) {\n                    background: rgba(99, 102, 241, 0.1) !important;\n                    padding: 2px 4px !important;\n                    border-radius: 4px !important;\n                    margin: 0 1px !important;\n                    font-weight: 500 !important;\n                }\n                \n                .math-content-renderer code {\n                    background: #f3f4f6 !important;\n                    padding: 2px 6px !important;\n                    border-radius: 4px !important;\n                    font-family: 'SF Mono', Monaco, 'Inconsolata', 'Roboto Mono', Consolas, 'Courier New', monospace !important;\n                    font-size: 0.9em !important;\n                    color: #4b5563 !important;\n                    border: 1px solid #e5e7eb !important;\n                }\n                \n                .math-content-renderer pre {\n                    background: #1f2937 !important;\n                    color: #f9fafb !important;\n                    padding: 16px !important;\n                    border-radius: 8px !important;\n                    overflow-x: auto !important;\n                    margin: 12px 0 !important;\n                    font-family: 'SF Mono', Monaco, 'Inconsolata', 'Roboto Mono', Consolas, 'Courier New', monospace !important;\n                    font-size: 0.9em !important;\n                    line-height: 1.5 !important;\n                    box-shadow: 0 4px 6px rgba(0,0,0,0.1) !important;\n                }\n                \n                .math-content-renderer img {\n                    max-width: 100% !important;\n                    height: auto !important;\n                    border-radius: 6px !important;\n                    box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;\n                    margin: 8px 0 !important;\n                }\n                \n                .math-content-renderer h1,\n                .math-content-renderer h2,\n                .math-content-renderer h3 {\n                    color: #1f2937 !important;\n                    font-weight: 600 !important;\n                    margin: 16px 0 8px 0 !important;\n                }\n                \n                .math-content-renderer p {\n                    margin: 8px 0 !important;\n                    line-height: 1.6 !important;\n                }\n                \n                .math-content-renderer ul,\n                .math-content-renderer ol {\n                    margin: 8px 0 !important;\n                    padding-left: 20px !important;\n                }\n                \n                .math-content-renderer li {\n                    margin: 4px 0 !important;\n                }\n                \n                .math-content-renderer blockquote {\n                    border-left: 4px solid #e5e7eb !important;\n                    margin: 12px 0 !important;\n                    padding: 8px 16px !important;\n                    background: #f9fafb !important;\n                    color: #6b7280 !important;\n                    font-style: italic !important;\n                    border-radius: 0 4px 4px 0 !important;\n                }\n                \n                .math-content-renderer.has-formulas {\n                    min-height: 40px;\n                }\n                \n                @media (max-width: 640px) {\n                    .math-content-renderer .katex {\n                        font-size: 1em !important;\n                    }\n                    \n                    .math-content-renderer .katex-display {\n                        margin: 12px 0 !important;\n                        padding: 8px !important;\n                        font-size: 0.9em !important;\n                    }\n                }\n            "})]}))};var tn=function(){return tn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},tn.apply(this,arguments)};const nn=function(e){var t=e.content,n=e.isEditable,r=void 0!==n&&n,a=e.onEditClick;return(0,o.jsxs)("div",tn({className:"grammar-card-container",style:{position:"relative"},onClick:function(e){e.stopPropagation()}},{children:[(0,o.jsx)("div",{className:"grammar-card grammar-reference",dangerouslySetInnerHTML:{__html:t||""},onClick:function(e){e.stopPropagation()}}),r&&a&&(0,o.jsxs)("button",tn({onClick:function(e){e.stopPropagation(),a()},style:{position:"absolute",top:"8px",right:"8px",background:"rgba(255, 255, 255, 0.8)",border:"1px solid #E5E7EB",color:"#3B82F6",fontSize:"12px",padding:"4px 8px",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",borderRadius:"4px",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"}},{children:[(0,o.jsx)(ft,{size:12}),"Edit"]}))]}))};var rn=function(){return rn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},rn.apply(this,arguments)},an={TRANSLATING_TEXT:{title:"Translating text...",subtitle:"Converting your text to the target language",icon:"\u{1f30d}",color:"#3B82F6",steps:[{title:"Preparing translation...",subtitle:"Setting up translation parameters"},{title:"Sending to translation AI...",subtitle:"Communicating with OpenAI servers"},{title:"Processing translation...",subtitle:"AI is analyzing and translating your text"},{title:"Finalizing translation...",subtitle:"Applying final touches to the translation"}]},TRANSLATING_EXAMPLES:{title:"Translating examples...",subtitle:"Making example sentences available in your language",icon:"\u{1f4dd}",color:"#10B981",steps:[{title:"Preparing examples...",subtitle:"Organizing example sentences for translation"},{title:"Translating examples...",subtitle:"Converting examples to your target language"},{title:"Processing translations...",subtitle:"Ensuring translation quality and accuracy"}]},GENERATING_EXAMPLES:{title:"Generating examples...",subtitle:"Creating meaningful example sentences for better understanding",icon:"\u{1f4a1}",color:"#F59E0B",steps:[{title:"Analyzing word context...",subtitle:"Understanding word usage and meaning"},{title:"Creating example prompts...",subtitle:"Preparing AI prompts for example generation"},{title:"Generating examples...",subtitle:"AI is crafting relevant example sentences"},{title:"Refining examples...",subtitle:"Ensuring examples are clear and educational"}]},ANALYZING_WORD_FOR_IMAGE:{title:"Analyzing word...",subtitle:"Determining if this is a concept or object for optimal visualization",icon:"\u{1f50d}",color:"#8B5CF6",steps:[{title:"Classifying word type...",subtitle:"Determining if word represents concept or object"},{title:"Evaluating visual potential...",subtitle:"Assessing how well this can be visualized"},{title:"Preparing visualization strategy...",subtitle:"Choosing optimal image generation approach"}]},CREATING_IMAGE_DESCRIPTION:{title:"Creating image description...",subtitle:"Crafting detailed prompts for AI image generation",icon:"\u{1f3a8}",color:"#EC4899",steps:[{title:"Building image prompt...",subtitle:"Creating detailed description for image generation"},{title:"Optimizing prompt...",subtitle:"Refining prompt for best AI image results"},{title:"Finalizing description...",subtitle:"Preparing final prompt for image generation"}]},GENERATING_IMAGE:{title:"Generating image...",subtitle:"AI is creating a beautiful illustration just for you",icon:"\u{1f5bc}\ufe0f",color:"#6366F1",steps:[{title:"Sending to image AI...",subtitle:"Transmitting prompt to OpenAI DALL-E"},{title:"AI generating image...",subtitle:"Neural network is creating your custom illustration"},{title:"Processing image...",subtitle:"Applying final touches and optimizations"},{title:"Preparing image for display...",subtitle:"Finalizing image for your flashcard"}]},GENERATING_CARD_CONTENT:{title:"Generating card content...",subtitle:"AI is analyzing your text and creating the perfect flashcard",icon:"\u{1f9e0}",color:"#3B82F6",steps:[{title:"Analyzing input text...",subtitle:"Understanding the content and context"},{title:"Extracting key information...",subtitle:"Identifying main concepts and details"},{title:"Structuring card content...",subtitle:"Organizing information for optimal learning"},{title:"Generating front side...",subtitle:"Creating effective question or prompt"},{title:"Generating back side...",subtitle:"Developing comprehensive answer or explanation"},{title:"Finalizing card format...",subtitle:"Ensuring proper flashcard structure"}]},GENERATING_FRONT_SIDE:{title:"Creating front side...",subtitle:"Crafting an effective question or prompt",icon:"\u2753",color:"#10B981",steps:[{title:"Designing question format...",subtitle:"Choosing optimal question structure"},{title:"Crafting question text...",subtitle:"Writing clear and effective question"},{title:"Optimizing for learning...",subtitle:"Ensuring question promotes active recall"}]},GENERATING_BACK_SIDE:{title:"Creating back side...",subtitle:"Developing comprehensive answers and explanations",icon:"\u{1f4d6}",color:"#F59E0B",steps:[{title:"Compiling answer content...",subtitle:"Gathering comprehensive information"},{title:"Structuring explanation...",subtitle:"Organizing answer for clarity"},{title:"Adding learning elements...",subtitle:"Including helpful context and examples"}]},SAVING_TO_ANKI:{title:"Saving to Anki...",subtitle:"Your card is being added to your Anki collection",icon:"\u{1f4be}",color:"#EF4444",steps:[{title:"Connecting to Anki...",subtitle:"Establishing connection with Anki application"},{title:"Validating card data...",subtitle:"Ensuring card format is correct"},{title:"Saving to collection...",subtitle:"Adding card to your Anki deck"},{title:"Confirming save...",subtitle:"Verifying card was saved successfully"}]},CONNECTING_TO_ANKI:{title:"Connecting to Anki...",subtitle:"Establishing connection with your Anki application",icon:"\u{1f517}",color:"#6366F1",steps:[{title:"Locating Anki application...",subtitle:"Finding Anki on your system"},{title:"Establishing connection...",subtitle:"Setting up communication with Anki"},{title:"Verifying connection...",subtitle:"Ensuring stable connection is established"}]},DETECTING_LANGUAGE:{title:"Detecting language...",subtitle:"Analyzing text to determine the source language",icon:"\u{1f524}",color:"#8B5CF6",steps:[{title:"Analyzing text patterns...",subtitle:"Examining linguistic characteristics"},{title:"Identifying language...",subtitle:"Determining the most likely language"},{title:"Confirming detection...",subtitle:"Validating language identification"}]},PROCESSING_REQUEST:{title:"Processing your request...",subtitle:"Please wait while we work our magic",icon:"\u26a1",color:"#6B7280",steps:[{title:"Initializing request...",subtitle:"Setting up your request parameters"},{title:"Processing...",subtitle:"Working on your request"},{title:"Almost done...",subtitle:"Finalizing your request"}]},FINALIZING:{title:"Finalizing...",subtitle:"Putting everything together nicely",icon:"\u2728",color:"#10B981",steps:[{title:"Assembling results...",subtitle:"Combining all processed information"},{title:"Applying final touches...",subtitle:"Making everything look perfect"},{title:"Ready!",subtitle:"Your request has been completed successfully"}]}},on=function(e,t){var n=an[e],r=n.steps||[];if(!t||t<=0)return rn(rn({},n),{currentStep:0,totalSteps:r.length,currentStepTitle:n.title,currentStepSubtitle:n.subtitle});var a=r[Math.min(t-1,r.length-1)];return rn(rn({},n),{currentStep:t,totalSteps:r.length,currentStepTitle:(null==a?void 0:a.title)||n.title,currentStepSubtitle:(null==a?void 0:a.subtitle)||n.subtitle})},ln=(function(){function e(e,t){this.currentStep=0,this.startTime=Date.now(),this.operation=e,this.onProgressUpdate=t,this.startTime=Date.now()}e.prototype.nextStep=function(){this.currentStep++;var e=on(this.operation,this.currentStep);return this.onProgressUpdate&&e&&this.onProgressUpdate(e),e},e.prototype.setStep=function(e){this.currentStep=e;var t=on(this.operation,this.currentStep);return this.onProgressUpdate&&t&&this.onProgressUpdate(t),t},e.prototype.getCurrentProgress=function(){return on(this.operation,this.currentStep)},e.prototype.getElapsedTime=function(){return Math.floor((Date.now()-this.startTime)/1e3)},e.prototype.isComplete=function(){var e=an[this.operation].steps||[];return this.currentStep>=e.length},e.prototype.reset=function(){this.currentStep=0,this.startTime=Date.now()}}(),function(){return ln=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},ln.apply(this,arguments)}),sn=function(e,t,n){if(n||2===arguments.length)for(var r,a=0,o=t.length;a<o;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))};const cn=function(e){var t=e.front,n=e.back,a=e.translation,i=e.examples,l=e.imageUrl,s=e.image,c=e.linguisticInfo,u=e.transcription,d=e.onNewImage,p=e.onNewExamples,f=e.onAccept,h=e.onViewSavedCards,g=e.onCancel,m=e.mode,v=void 0===m?Q.d.LanguageLearning:m,y=e.loadingNewImage,b=e.loadingNewExamples,x=e.loadingAccept,w=e.loadingGetResult,S=void 0!==w&&w,k=(e.shouldGenerateImage,e.isSaved),C=void 0!==k&&k,E=(e.isEdited,e.isGeneratingCard),A=e.setTranslation,T=e.setBack,I=e.setExamples,z=e.setLinguisticInfo,F=e.hideActionButtons,M=void 0!==F&&F,j=e.createdAt,B=(0,r.useState)(!1),R=B[0],O=B[1],L=(0,r.useState)(a||""),N=L[0],P=L[1],_=(0,r.useState)(!1),D=_[0],q=_[1],U=(0,r.useState)(n||""),$=U[0],H=U[1],V=(0,r.useState)(!1),G=V[0],W=V[1],Y=(0,r.useState)(!0),K=(Y[0],Y[1],(0,r.useState)(!0)),X=K[0],J=K[1],Z=(0,r.useState)(null),ee=Z[0],te=Z[1],ne=(0,r.useState)(null),re=ne[0],ae=ne[1],oe=(0,r.useState)(null),ie=oe[0],le=oe[1];(0,r.useEffect)((function(){P(a||"")}),[a]),(0,r.useEffect)((function(){H(n||"")}),[n]),(0,r.useEffect)((function(){te(y?on("GENERATING_IMAGE",1):null)}),[y]),(0,r.useEffect)((function(){ae(b?on("GENERATING_EXAMPLES",1):null)}),[b]),(0,r.useEffect)((function(){le(x?on("SAVING_TO_ANKI",1):null)}),[x]),(0,r.useEffect)((function(){ze(c||"")}),[c]);var se=function(){W(!0)},ce=function(){if(R&&A&&(A(N),O(!1)),D&&T&&(T($),q(!1)),null!==ye&&I){var e=sn([],i,!0);e[ye]=[we,ke],I(e),be(null)}Ee&&z&&(z(Ie),Ae(!1)),C&&f(),W(!1)},ue=function(){G&&(O(!0),P(a||""))},de=function(){A&&A(N),O(!1)},pe=function(){G&&(q(!0),H(n||""))},fe=function(){T&&T($),q(!1)},he=function(e,t,n){if(G&&I&&i){var r=sn([],i,!0);t?r[e][0]=n:r[e][1]=n||null,I(r)}},ge=(0,r.useState)(!1),me=(ge[0],ge[1],(0,r.useState)(a||"")),ve=(me[0],me[1],(0,r.useState)(null)),ye=ve[0],be=ve[1],xe=(0,r.useState)(""),we=xe[0],Se=(xe[1],(0,r.useState)("")),ke=Se[0],Ce=(Se[1],(0,r.useState)(!1)),Ee=Ce[0],Ae=Ce[1],Te=(0,r.useState)(c||""),Ie=Te[0],ze=Te[1];return(0,o.jsxs)("div",ln({style:{padding:"16px",borderRadius:"8px",width:"100%",maxWidth:"100%",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",overflowX:"hidden",backgroundColor:G?"#FAFAFA":"#ffffff",boxSizing:"border-box",borderLeft:G?"3px solid #3B82F6":"3px solid transparent"}},{children:[(0,o.jsxs)("div",ln({style:{fontSize:"10px",color:"#9CA3AF",marginBottom:"12px",textAlign:"right",display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"4px",padding:"6px 8px",backgroundColor:G?"#EFF6FF":C?"#ECFDF5":"#F9FAFB",borderRadius:"4px",border:G?"1px solid #DBEAFE":C?"1px solid #D1FAE5":"1px solid #F3F4F6"}},{children:[(0,o.jsxs)("div",ln({style:{display:"flex",alignItems:"center",gap:"4px"}},{children:[(0,o.jsx)("span",{style:{display:"inline-block",width:"8px",height:"8px",borderRadius:"50%",backgroundColor:G?"#3B82F6":C?"#10B981":"#6B7280"}}),(0,o.jsx)("strong",ln({style:{color:G?"#1E40AF":C?"#059669":"#4B5563"}},{children:G?"Editing":C?"Saved to Collection":"New - Not Saved Yet"}))]})),(0,o.jsxs)("div",ln({style:{fontSize:"9px",color:"#9CA3AF",fontStyle:"italic",display:"flex",alignItems:"center",gap:"3px"}},{children:[(0,o.jsx)("span",{children:"\u{1f4c5}"}),(j||new Date).toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]}))]})),G?(0,o.jsxs)("button",ln({onClick:ce,disabled:x,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",backgroundColor:"#3B82F6",color:"white",border:"none",borderRadius:"6px",padding:"10px 12px",fontSize:"14px",fontWeight:"600",cursor:"pointer",marginBottom:"12px",width:"100%",opacity:x?.7:1},onMouseOver:function(e){return!x&&(e.currentTarget.style.backgroundColor="#2563EB")},onMouseOut:function(e){return!x&&(e.currentTarget.style.backgroundColor="#3B82F6")}},{children:[(0,o.jsx)(zt,{size:14}),x?(0,o.jsxs)("div",ln({style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"}},{children:[(0,o.jsx)(Ot,{type:"spinner",size:"small",inline:!0,color:"#ffffff"}),(0,o.jsx)("span",ln({style:{fontSize:"12px",fontWeight:"500"}},{children:(null==ie?void 0:ie.currentStepTitle)||(null==ie?void 0:ie.title)||"Saving"}))]})):C?"Save & Finish Editing":"Finish Editing"]})):G?null:(0,o.jsxs)("button",ln({onClick:se,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",backgroundColor:"#F3F4F6",color:"#4B5563",border:"1px solid #E5E7EB",borderRadius:"6px",padding:"10px 12px",fontSize:"14px",fontWeight:"600",cursor:"pointer",marginBottom:"12px",width:"100%"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#E5E7EB",e.currentTarget.style.color="#1F2937"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.color="#4B5563"}},{children:[(0,o.jsx)(ft,{size:14}),"Edit Card"]})),G?(0,o.jsxs)("div",ln({style:{marginBottom:"16px",backgroundColor:"#EFF6FF",borderRadius:"6px",padding:"10px",border:"1px solid #DBEAFE",fontSize:"13px",color:"#1E40AF"}},{children:[(0,o.jsxs)("div",ln({style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"6px",fontWeight:"600"}},{children:[(0,o.jsx)(ft,{size:12}),"Editing Mode"]})),(0,o.jsxs)("p",ln({style:{margin:0,fontSize:"12px"}},{children:['Click on text elements to edit them. When finished, click "',C?"Save & Finish Editing":"Finish Editing",'" at the top of the card.']}))]})):null,t&&(0,o.jsx)("div",ln({style:{marginBottom:"12px"}},{children:v===Q.d.GeneralTopic||/\\(frac|sqrt|sum|int|prod|log|ln|sin|cos|tan|cot|arctan|arcsin|arccos|sinh|cosh|tanh)\b|\$|\\\[|\\\(|\)|\[|\]/.test(t)?(0,o.jsx)("div",ln({style:{textAlign:"left",padding:"10px",backgroundColor:"#F3F4F6",borderRadius:"8px"}},{children:(0,o.jsx)(en,{content:t,enableAI:!0,style:{fontSize:"16px",color:"#111827"}})})):t.includes("/")?function(){var e,n=t.split(/\s*\//),r=(null===(e=n[0])||void 0===e?void 0:e.trim())||"",a=n.length>1?"/".concat(n.slice(1).join("/").replace(/\/$/,"")):"";return(0,o.jsxs)("div",ln({style:{textAlign:"center",padding:"12px",backgroundColor:"#F3F4F6",borderRadius:"8px"}},{children:[(0,o.jsx)("h3",ln({style:{fontSize:"20px",fontWeight:"700",margin:"0 0 6px 0",color:"#111827"}},{children:r})),a&&(0,o.jsx)("div",ln({style:{fontSize:"14px",color:"#6B7280",fontStyle:"italic"}},{children:a}))]}))}():(0,o.jsx)("h3",ln({style:{fontSize:"18px",fontWeight:"600",textAlign:"center",margin:"2px 0",color:"#111827",padding:"10px",backgroundColor:"#F3F4F6",borderRadius:"8px"}},{children:t}))})),u&&(0,o.jsx)("div",ln({style:{marginBottom:"12px",textAlign:"center",padding:"8px 12px",backgroundColor:"#F8FAFC",border:"1px solid #E2E8F0",borderRadius:"6px"}},{children:(0,o.jsx)("div",{style:{fontSize:"14px",lineHeight:"1.6",color:"#475569"},dangerouslySetInnerHTML:{__html:u}})})),(v===Q.d.LanguageLearning?a:n)&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("hr",{style:{margin:"10px 0",border:"none",borderTop:"1px solid #E5E7EB"}}),(v===Q.d.LanguageLearning?R:D)&&G?(0,o.jsxs)("div",ln({style:{marginBottom:"12px",position:"relative"}},{children:[v===Q.d.LanguageLearning?(0,o.jsx)("input",{type:"text",value:N,onChange:function(e){return P(e.target.value)},style:{width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #3B82F6",backgroundColor:"#ffffff",color:"#111827",fontSize:"14px",outline:"none",fontWeight:"600",textAlign:"center"},autoFocus:!0,onBlur:de,onKeyDown:function(e){"Enter"===e.key&&de()}}):(0,o.jsx)("textarea",{value:$,onChange:function(e){return H(e.target.value)},style:{width:"100%",minHeight:"120px",padding:"12px",borderRadius:"6px",border:"1px solid #3B82F6",backgroundColor:"#ffffff",color:"#111827",fontSize:"14px",outline:"none",fontWeight:"400",lineHeight:"1.5",resize:"vertical"},autoFocus:!0,onBlur:fe,onKeyDown:function(e){"Enter"===e.key&&e.ctrlKey&&fe()}}),(0,o.jsx)("div",ln({style:{fontSize:"11px",color:"#6B7280",textAlign:"center",marginTop:"4px"}},{children:v===Q.d.LanguageLearning?"Press Enter or click outside to save":"Press Ctrl+Enter or click outside to save"}))]})):(0,o.jsxs)("div",ln({style:ln({marginBottom:"12px",textAlign:v===Q.d.LanguageLearning?"center":"left",position:"relative",paddingRight:G?"24px":"0"},G?{padding:"8px",border:"1px dashed #E5E7EB",borderRadius:"4px",transition:"all 0.2s ease",cursor:"pointer",backgroundColor:"#FAFAFA"}:{}),onClick:G?v===Q.d.LanguageLearning?ue:pe:void 0,onMouseOver:function(e){G&&(e.currentTarget.style.borderColor="#3B82F6",e.currentTarget.style.backgroundColor="#F9FAFB")},onMouseOut:function(e){G&&(e.currentTarget.style.borderColor="#E5E7EB",e.currentTarget.style.backgroundColor="#FAFAFA")}},{children:[v===Q.d.LanguageLearning?(0,o.jsx)("p",ln({style:{fontWeight:"600",color:"#111827",fontSize:"14px",margin:0}},{children:a})):(0,o.jsx)(en,{content:n||"",enableAI:!0,style:{color:"#111827",fontSize:"14px",lineHeight:"1.6",margin:0}}),G&&(0,o.jsx)("button",ln({onClick:function(e){e.stopPropagation(),v===Q.d.LanguageLearning?ue():pe()},style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",background:"#F3F4F6",border:"none",borderRadius:"4px",cursor:"pointer",color:"#6B7280",display:"flex",padding:"4px",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},title:v===Q.d.LanguageLearning?"Edit translation":"Edit content",onMouseOver:function(e){e.currentTarget.style.backgroundColor="#E5E7EB",e.currentTarget.style.color="#3B82F6"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.color="#6B7280"}},{children:(0,o.jsx)(At,{size:12})}))]}))]}),c&&(0,o.jsxs)("div",ln({style:{marginTop:"12px",marginBottom:"16px",borderRadius:"10px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.05)",border:"1px solid",borderColor:X?"#BFDBFE":"#E5E7EB",backgroundColor:X?"#EFF6FF":"#F9FAFB",transition:"all 0.3s ease",overflow:"hidden"}},{children:[(0,o.jsxs)("div",ln({style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",borderBottom:X?"1px solid #BFDBFE":"none",transition:"background-color 0.2s"}},{children:[(0,o.jsxs)("div",ln({style:{display:"flex",alignItems:"center",gap:"10px",fontWeight:600,fontSize:"14px",color:X?"#1D4ED8":"#4B5563",flex:1}},{children:[(0,o.jsx)(yt,{size:16,color:X?"#2563EB":"#6B7280"}),(0,o.jsx)("span",{children:"Grammar & Linguistics"})]})),(0,o.jsx)("button",ln({onClick:function(e){e.stopPropagation(),J(!X)},style:{background:"none",border:"none",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px",transition:"background-color 0.2s"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="rgba(0,0,0,0.05)"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="transparent"}},{children:X?(0,o.jsx)(lt,{size:14,color:"#6B7280"}):(0,o.jsx)(at,{size:14,color:"#6B7280"})}))]})),X&&(0,o.jsx)("div",ln({style:{padding:"16px"}},{children:Ee?(0,o.jsxs)("div",ln({style:{width:"100%"}},{children:[(0,o.jsx)("textarea",{value:Ie,onChange:function(e){ze(e.target.value)},style:{width:"100%",minHeight:"120px",padding:"10px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",fontSize:"14px",lineHeight:"1.5",resize:"vertical",marginBottom:"8px"}}),(0,o.jsxs)("div",ln({style:{display:"flex",justifyContent:"flex-end",gap:"8px"}},{children:[(0,o.jsx)("button",ln({onClick:function(){ze(c||""),Ae(!1)},style:{padding:"6px 12px",backgroundColor:"#F3F4F6",color:"#4B5563",border:"1px solid #E5E7EB",borderRadius:"6px",fontSize:"13px",cursor:"pointer"}},{children:"Cancel"})),(0,o.jsx)("button",ln({onClick:function(){z&&z(Ie),Ae(!1)},style:{padding:"6px 12px",backgroundColor:"#2563EB",color:"white",border:"none",borderRadius:"6px",fontSize:"13px",cursor:"pointer"}},{children:"Save"}))]}))]})):(0,o.jsx)("div",ln({style:{position:"relative"}},{children:(0,o.jsx)(nn,{content:c||"",isEditable:G,onEditClick:function(){return Ae(!0)}})}))}))]})),i.length>0&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("hr",{style:{margin:"10px 0",border:"none",borderTop:"1px solid #E5E7EB"}}),(0,o.jsxs)("div",ln({style:{marginBottom:"12px"}},{children:[(0,o.jsx)("div",ln({style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"}},{children:(0,o.jsx)("h4",ln({style:{fontSize:"14px",fontWeight:"600",color:"#374151",margin:0}},{children:"Examples"}))})),(0,o.jsx)("ul",ln({style:{listStyle:"none",padding:0,margin:0,display:"flex",flexDirection:"column",gap:"8px"}},{children:i.map((function(e,t){var n=e[0],r=e[1];return(0,o.jsxs)("li",ln({style:ln({padding:"12px",backgroundColor:"#F9FAFB",borderRadius:"6px",position:"relative",minHeight:"auto",wordWrap:"break-word",overflow:"visible"},G?{border:"1px dashed #CBD5E1",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"}:{})},{children:[G&&(0,o.jsx)("div",ln({style:{position:"absolute",top:"8px",right:"8px",display:"flex",gap:"8px",zIndex:5}},{children:(0,o.jsxs)("button",ln({onClick:function(){return function(e){if(G&&I&&i){var t=sn([],i,!0);t.splice(e,1),I(t)}}(t)},style:{background:"#FEE2E2",border:"none",borderRadius:"4px",cursor:"pointer",color:"#EF4444",padding:"4px 6px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"11px",fontWeight:"500"},title:"Delete example",onMouseOver:function(e){e.currentTarget.style.backgroundColor="#FECACA"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#FEE2E2"}},{children:[(0,o.jsx)(Bt,{size:10,style:{marginRight:"4px"}}),"Delete"]}))})),G?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",ln({style:{marginBottom:"8px"}},{children:(0,o.jsx)("textarea",{value:n,onChange:function(e){return he(t,!0,e.target.value)},style:{width:"100%",padding:"6px 8px",borderRadius:"4px",border:"1px solid #E5E7EB",fontSize:"13px",color:"#111827",fontWeight:"500",backgroundColor:"#ffffff",minHeight:"40px",resize:"vertical",fontFamily:"inherit",lineHeight:"1.4"},placeholder:"Example sentence"})})),(0,o.jsx)("div",{children:(0,o.jsx)("textarea",{value:r||"",onChange:function(e){return he(t,!1,e.target.value)},style:{width:"100%",padding:"6px 8px",borderRadius:"4px",border:"1px solid #E5E7EB",fontSize:"13px",color:"#6B7280",fontStyle:"italic",backgroundColor:"#ffffff",minHeight:"40px",resize:"vertical",fontFamily:"inherit",lineHeight:"1.4"},placeholder:"Translation (optional)"})})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",ln({style:{fontWeight:"500",color:"#111827",fontSize:"13px",marginBottom:r?"6px":0,lineHeight:"1.4",wordWrap:"break-word",overflow:"visible",whiteSpace:"normal"}},{children:n})),r&&(0,o.jsx)("div",ln({style:{color:"#6B7280",fontSize:"13px",fontStyle:"italic",lineHeight:"1.4",wordWrap:"break-word",overflow:"visible",whiteSpace:"normal"}},{children:r}))]})]}),t)}))})),G&&(0,o.jsxs)("button",ln({onClick:function(){if(G&&I&&i){var e=sn([],i,!0);e.push(["",null]),I(e)}},style:{width:"100%",padding:"10px",borderRadius:"6px",backgroundColor:"#EFF6FF",color:"#3B82F6",fontSize:"14px",fontWeight:"500",border:"1px dashed #BFDBFE",cursor:"pointer",marginTop:"12px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"all 0.2s ease"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#DBEAFE",e.currentTarget.style.borderColor="#93C5FD"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#EFF6FF",e.currentTarget.style.borderColor="#BFDBFE"}},{children:[(0,o.jsx)(Tt,{size:12}),"Add Example"]}))]}))]}),(s||l)&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("hr",{style:{margin:"16px 0",border:"none",borderTop:"1px solid #E5E7EB"}}),(0,o.jsx)("div",ln({style:{marginBottom:"16px"}},{children:(0,o.jsx)("img",{src:s||l||"",alt:"",style:{width:"100%",borderRadius:"6px",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)"}})}))]}),!C&&(0,o.jsxs)("div",ln({style:{display:"flex",gap:"6px",marginBottom:"8px"}},{children:[(s||l)&&(0,o.jsx)("button",ln({onClick:d,disabled:y,style:{flex:1,padding:"8px 12px",borderRadius:"6px",backgroundColor:"#F59E0B",color:"#ffffff",fontWeight:"600",fontSize:"13px",border:"none",cursor:"pointer",transition:"all 0.2s ease",opacity:y?.7:1},onMouseOver:function(e){return!y&&(e.currentTarget.style.backgroundColor="#D97706")},onMouseOut:function(e){return!y&&(e.currentTarget.style.backgroundColor="#F59E0B")}},{children:y?(0,o.jsxs)("div",ln({style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"}},{children:[(0,o.jsx)(Ot,{type:"spinner",size:"small",inline:!0,color:"#ffffff"}),(0,o.jsx)("span",ln({style:{fontSize:"12px",fontWeight:"500"}},{children:(null==ee?void 0:ee.currentStepTitle)||(null==ee?void 0:ee.title)||"Generating"}))]})):"New Image"})),i.length>0&&(0,o.jsx)("button",ln({onClick:p,disabled:b,style:{flex:1,padding:"8px 12px",borderRadius:"6px",backgroundColor:"#F59E0B",color:"#ffffff",fontWeight:"600",fontSize:"13px",border:"none",cursor:"pointer",transition:"all 0.2s ease",opacity:b?.7:1},onMouseOver:function(e){return!b&&(e.currentTarget.style.backgroundColor="#D97706")},onMouseOut:function(e){return!b&&(e.currentTarget.style.backgroundColor="#F59E0B")}},{children:b?(0,o.jsxs)("div",ln({style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"}},{children:[(0,o.jsx)(Ot,{type:"spinner",size:"small",inline:!0,color:"#ffffff"}),(0,o.jsx)("span",ln({style:{fontSize:"12px",fontWeight:"500"}},{children:(null==re?void 0:re.currentStepTitle)||(null==re?void 0:re.title)||"Loading"}))]})):"New Examples"}))]})),!M&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",ln({style:{marginBottom:"10px"}},{children:[!G&&(!C||E||S)&&(0,o.jsxs)("div",ln({style:{display:"flex",gap:"8px",width:"100%"}},{children:[(0,o.jsxs)("button",ln({onClick:g,disabled:x,style:{flex:"1",padding:"10px",borderRadius:"6px",backgroundColor:"#F3F4F6",color:"#4B5563",fontWeight:"600",fontSize:"14px",border:"1px solid #E5E7EB",cursor:x?"not-allowed":"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",opacity:x?.7:1},onMouseOver:function(e){x||(e.currentTarget.style.backgroundColor="#E5E7EB",e.currentTarget.style.color="#374151")},onMouseOut:function(e){x||(e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.color="#4B5563")}},{children:[(0,o.jsx)(jt,{}),E||S?"Cancel Generation":"Cancel"]})),!E&&!S&&(0,o.jsxs)("button",ln({onClick:f,disabled:x,style:{flex:"2",padding:"10px",borderRadius:"6px",backgroundColor:"#22C55E",color:"#ffffff",fontWeight:"600",fontSize:"14px",border:"none",cursor:"pointer",transition:"all 0.2s ease",opacity:x?.7:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},onMouseOver:function(e){return!x&&(e.currentTarget.style.backgroundColor="#15803D")},onMouseOut:function(e){return!x&&(e.currentTarget.style.backgroundColor="#22C55E")}},{children:[(0,o.jsx)(rt,{}),x?(0,o.jsx)("div",ln({style:{display:"flex",alignItems:"center",justifyContent:"center"}},{children:(0,o.jsx)(Ot,{type:"spinner",size:"small",inline:!0,color:"#ffffff",text:"Saving"})})):"Save Card"]}))]})),!G&&C&&(0,o.jsxs)("div",ln({style:{width:"100%",padding:"10px",borderRadius:"6px",backgroundColor:"#ECFDF5",border:"1px solid #D1FAE5",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"}},{children:[(0,o.jsx)("div",ln({style:{display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",borderRadius:"50%",backgroundColor:"#10B981",color:"white"}},{children:(0,o.jsx)(rt,{size:12})})),(0,o.jsx)("span",ln({style:{fontWeight:"600",fontSize:"14px",color:"#059669"}},{children:"Saved to Collection"}))]})),!G&&!C&&(0,o.jsx)("p",ln({style:{fontSize:"11px",color:"#6B7280",textAlign:"center",margin:"4px 0 0 0"}},{children:"The card will be saved to your collection"}))]})),(0,o.jsxs)("button",ln({onClick:h,style:{width:"100%",padding:"10px",borderRadius:"6px",backgroundColor:"#4B5563",color:"#ffffff",fontWeight:"600",fontSize:"13px",border:"none",cursor:"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="#374151"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="#4B5563"}},{children:[(0,o.jsx)(Ct,{size:14}),"View Saved Cards"]}))]})]}))};var un=n(504),dn=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))},pn=function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(s){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&l[0]?r.return:l[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,l[1])).done)return a;switch(r=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,r=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],r=0}finally{n=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}},fn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]};function hn(e,t,n){return void 0===n&&(n=""),dn(this,void 0,void 0,(function(){var r,a,o,i,l;return pn(this,(function(s){switch(s.label){case 0:if(fn("getImage called with description:",t),r=null,a=null,!t)throw new Error("Cannot generate image: missing description");if(!e)throw new Error("Cannot generate image: no OpenAI API key provided. Please check your settings.");s.label=1;case 1:return s.trys.push([1,7,,8]),fn("Using OpenAI with key:",e?e.substring(0,5)+"...":"null"),[4,(0,We.getOpenAiImageUrl)(e,t,n)];case 2:if(r=s.sent(),fn("OpenAI returned URL:",r?"success":"null"),!r)return[3,6];s.label=3;case 3:return s.trys.push([3,5,,6]),fn("Converting image URL to base64 for permanent storage..."),[4,ae(r)];case 4:return a=s.sent(),fn("Image URL converted to base64:",a?"success":"null"),a?fn("\u2705 Image successfully converted to base64 - keeping both URL and base64 for reliability"):console.warn("\u26a0\ufe0f Failed to convert image to base64 - keeping temporary URL as fallback"),[3,6];case 5:return o=s.sent(),console.error("\u274c Error converting URL to base64:",o),console.warn("\u26a0\ufe0f Will use temporary URL as fallback, but it may disappear later"),[3,6];case 6:return[3,8];case 7:throw i=s.sent(),console.error("OpenAI image generation error:",i),i instanceof Error?i:new Error("Failed to generate image with OpenAI. Please check your API key and try again.");case 8:if(!r&&!a)throw new Error("Failed to generate image. Please check your API key and try again.");return fn("Final result:",{hasBase64:!!a,hasUrl:!!(l=a?null:r),status:a?"Base64 (permanent)":l?"URL only (temporary)":"No image"}),[2,{imageUrl:l,imageBase64:a}]}}))}))}var gn=n(482),mn=function(){return mn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},mn.apply(this,arguments)};const vn=function(){var e=(0,r.useState)(null),t=e[0],n=e[1],a=(0,r.useState)(!1),i=a[0],l=a[1],s=(0,r.useState)(!1),c=s[0],u=s[1],d=(0,r.useRef)(null),p=(0,r.useRef)(null),f=(0,r.useRef)(null),h=(0,r.useCallback)((function(){d.current&&(clearTimeout(d.current),d.current=null),p.current&&(clearTimeout(p.current),p.current=null),u(!1),f.current&&(clearTimeout(f.current),f.current=null),f.current=setTimeout((function(){l(!1),n(null),f.current=null}),300)}),[]),g=(0,r.useCallback)((function(e,t){if(void 0===t&&(t="error"),e){var r=Date.now();n({id:r,message:e,type:t}),l(!0),f.current&&(clearTimeout(f.current),f.current=null),p.current&&(clearTimeout(p.current),p.current=null),u(!1),p.current=setTimeout((function(){u(!0),p.current=null}),40),d.current&&clearTimeout(d.current),d.current=setTimeout((function(){h(),d.current=null}),5e3)}else h()}),[h]);(0,r.useEffect)((function(){return function(){d.current&&(clearTimeout(d.current),d.current=null),p.current&&(clearTimeout(p.current),p.current=null),f.current&&(clearTimeout(f.current),f.current=null)}}),[]);return{showError:g,renderErrorNotification:function(){if(!i||!t)return null;var e,n,r=function(){switch(t.type){case"success":return{icon:(0,o.jsx)(nt,{size:16}),color:"#059669",bgColor:"#ECFDF5",borderColor:"#10B981"};case"warning":return{icon:(0,o.jsx)(gt,{size:16}),color:"#D97706",bgColor:"#FFFBEB",borderColor:"#F59E0B"};case"info":return{icon:(0,o.jsx)(xt,{size:16}),color:"#2563EB",bgColor:"#EFF6FF",borderColor:"#3B82F6"};default:return{icon:(0,o.jsx)(Mt,{size:16}),color:"#DC2626",bgColor:"#FEF2F2",borderColor:"#EF4444"}}}(),a=r.icon,l=r.color,s=r.bgColor,u=r.borderColor,d=(e=t.message,(n=e.toLowerCase()).includes("401")||n.includes("unauthorized")||n.includes("authentication failed")||n.includes("authorization failed")||n.includes("invalid api key")||n.includes("api key is invalid")||n.includes("api key provided is incorrect")||n.includes("bearer token is invalid")||n.includes("invalid credentials")||n.includes("invalid token")?"Authorization failed: your API key is invalid or no longer active.\n\nOpen the extension settings and paste a working key.":n.includes("429")||n.includes("rate limit")||n.includes("quota")?"Quota exhausted: your OpenAI plan or monthly budget has been reached.\n\nOpen the OpenAI Platform \u2192 Usage limits to raise the quota or update billing, then try again.":n.includes("500")||n.includes("502")||n.includes("503")||n.includes("504")?"The AI service is temporarily unavailable. Please try again later.":n.includes("openai")?"OpenAI error: ".concat(e.split("OpenAI").pop()):n.includes("groq")?"Groq error: ".concat(e.split("Groq").pop()):e);return(0,o.jsxs)("div",mn({style:{transform:c?"translateX(0)":"translateX(100%)",opacity:c?1:0,transition:"all 0.3s ease-out",backgroundColor:s,border:"1px solid ".concat(u),borderRadius:"12px",padding:"16px",minWidth:"280px",maxWidth:"320px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",position:"relative",display:"flex",alignItems:"flex-start",gap:"12px",marginBottom:"8px"},role:"alert","aria-live":"polite"},{children:[(0,o.jsx)("div",mn({style:{color:l,marginTop:"2px",flexShrink:0}},{children:a})),(0,o.jsx)("div",mn({style:{flex:1,paddingRight:"8px"}},{children:(0,o.jsx)("p",mn({style:{color:"#374151",margin:0,fontSize:"14px",lineHeight:"1.5",fontWeight:500}},{children:d}))})),(0,o.jsx)("button",mn({onClick:h,style:{position:"absolute",top:"8px",right:"8px",background:"transparent",border:"none",color:"#9CA3AF",cursor:"pointer",padding:"4px",borderRadius:"4px",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="rgba(0, 0, 0, 0.1)",e.currentTarget.style.color="#374151"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="#9CA3AF"},"aria-label":"Close notification"},{children:(0,o.jsx)(jt,{size:12})})),(0,o.jsx)("div",mn({style:{position:"absolute",bottom:0,left:0,right:0,height:"3px",backgroundColor:"rgba(0, 0, 0, 0.1)",borderRadius:"0 0 12px 12px",overflow:"hidden"}},{children:(0,o.jsx)("div",{style:{height:"100%",backgroundColor:u,width:"100%",transition:"width 5s linear",transformOrigin:"left"}})}))]}),t.id)}}};var yn=function(){return yn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},yn.apply(this,arguments)},bn=function(e,t,n){if(n||2===arguments.length)for(var r,a=0,o=t.length;a<o;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))},xn="anki_stored_cards",wn="anki_last_draft_card",Sn="anki_tab_cards",kn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},Cn=function(e){try{return e.startsWith("data:image/")&&e.length>1e5?(kn("Large image detected, applying basic compression"),console.warn("Large image (".concat(Math.round(e.length/1024),"KB) detected. Consider using smaller images.")),e):e}catch(t){return console.error("Error compressing image:",t),e}},En=function(e){try{var t=JSON.stringify(e,(function(e,t){return t instanceof Date?t.toISOString():t})),n=new Blob([t]).size/1048576;if(kn("Storage analysis: ".concat(e.length," cards, ").concat(n.toFixed(2),"MB")),n<4)return e;console.warn("Storage size is large, optimizing...");for(var r=bn([],e,!0).sort((function(e,t){return new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()})),a=[],o=0,i=0,l=r;i<l.length;i++){var s=l[i],c=JSON.stringify(s,(function(e,t){return t instanceof Date?t.toISOString():t})),u=new Blob([c]).size;if(o+u>4194304){console.warn("Stopping at ".concat(a.length," cards to stay within storage limit"));break}a.push(s),o+=u}return a}catch(t){return console.error("Error managing storage quota:",t),e}},An=function(){console.warn("\u26a0\ufe0f Storage quota exceeded! This usually happens when you have many cards with large images."),console.warn("\u{1f4a1} To fix this:"),console.warn("   \u2022 Use smaller images"),console.warn("   \u2022 Export older cards and delete them"),console.warn("   \u2022 Consider using image URLs instead of embedded images")},Tn=function(){try{var e=localStorage.getItem(xn);if(kn("Loading cards from localStorage. Data exists:",!!e),e)try{var t=JSON.parse(e);if(kn("Successfully parsed cards from localStorage, total count:",t.length),t.length>0){var n=t.slice(0,Math.min(3,t.length)),r=t.length>3?t.slice(-3):[];kn("First few cards:",n.map((function(e){var t;return{id:e.id,text:null===(t=e.text)||void 0===t?void 0:t.substring(0,20)}}))),r.length>0&&kn("Last few cards:",r.map((function(e){var t;return{id:e.id,text:null===(t=e.text)||void 0===t?void 0:t.substring(0,20)}})))}if(!Array.isArray(t))return console.error("Stored cards is not an array!",t),[];var a=t.filter((function(e){var t=!!e.id,n=!!e.text,r=!!e.createdAt;return!!(t&&n&&r)||(console.warn("Found invalid card, removing from results:",e),!1)}));kn("Card validation: ".concat(a.length," valid out of ").concat(t.length," total"));var o=a.map((function(e){return yn(yn({},e),{createdAt:new Date(e.createdAt)})})),i=o.filter((function(e){return e.image||e.imageUrl}));return kn("Loaded cards with images:",i.length),i.forEach((function(e){var t,n,r,a;kn("Loaded card ".concat(e.id," image data:"),{hasImage:!!e.image,hasImageUrl:!!e.imageUrl,imageLength:null===(t=e.image)||void 0===t?void 0:t.length,imageUrlLength:null===(n=e.imageUrl)||void 0===n?void 0:n.length,imagePreview:null===(r=e.image)||void 0===r?void 0:r.substring(0,50),imageUrlPreview:null===(a=e.imageUrl)||void 0===a?void 0:a.substring(0,50)})})),o}catch(e){return console.error("JSON parse error:",e),localStorage.removeItem(xn),[]}}catch(e){console.error("Error loading cards from localStorage:",e);try{localStorage.removeItem(xn)}catch(e){console.error("Could not clean up localStorage:",e)}}return[]},In=function(e){if(e instanceof Date)return e;if("string"==typeof e||"number"==typeof e){var t=new Date(e);if(!Number.isNaN(t.getTime()))return t}return new Date},zn=function(e){try{if(!e)return void localStorage.removeItem(wn);var t=yn(yn({},e),{createdAt:In(e.createdAt).toISOString()});localStorage.setItem(wn,JSON.stringify(t))}catch(e){console.error("Error saving last draft card to storage:",e)}},Fn=function(e,t,n){var r="".concat(Sn,"_").concat(e);try{var a=JSON.stringify(t,(function(e,t){return t instanceof Date?t.toISOString():t}));new Blob([a]).size}catch(e){console.error("Could not determine original size:",e)}if(n instanceof DOMException&&("QuotaExceededError"===n.name||"NS_ERROR_DOM_QUOTA_REACHED"===n.name)){console.error("localStorage quota exceeded for tab ".concat(e,". Using storage optimization.")),An();var o=En(t);try{var i=JSON.stringify(o,(function(e,t){return t instanceof Date?t.toISOString():t}));localStorage.setItem(r,i),console.warn("Smart optimization for tab ".concat(e,": Saved ").concat(o.length," of ").concat(t.length," cards"))}catch(t){console.error("Failed to save optimized cards for tab ".concat(e,":"),t)}}};const Mn=function(e){return function(t){return function(n){var r=t(n);switch(n.type){case ve:try{var a=Tn();e.dispatch({type:"SET_STORED_CARDS",payload:a});var o=function(){var e,t,n,r,a,o,i;try{var l=localStorage.getItem(wn);if(!l)return null;var s=JSON.parse(l);return s&&"object"==typeof s?yn(yn({},s),{createdAt:In(s.createdAt),examples:Array.isArray(s.examples)?s.examples:[],image:null!==(e=s.image)&&void 0!==e?e:null,imageUrl:null!==(t=s.imageUrl)&&void 0!==t?t:null,translation:null!==(n=s.translation)&&void 0!==n?n:null,front:null!==(r=s.front)&&void 0!==r?r:s.text,back:null!==(a=s.back)&&void 0!==a?a:null,linguisticInfo:null!==(o=s.linguisticInfo)&&void 0!==o?o:"",transcription:null!==(i=s.transcription)&&void 0!==i?i:""}):null}catch(e){return console.error("Error loading last draft card from storage:",e),localStorage.removeItem(wn),null}}();e.dispatch(Ue(o))}catch(t){console.error("Error in LOAD_STORED_CARDS middleware:",t),e.dispatch({type:"SET_STORED_CARDS",payload:[]}),e.dispatch(Ue(null))}break;case me:case ye:case we:case xe:try{var i=e.getState().cards,l=i.storedCards;o=i.lastDraftCard;!function(e){try{kn("Saving cards to localStorage:",e),kn("Total cards count:",e.length);var t=e.filter((function(e){return e.image||e.imageUrl}));kn("Cards with images:",t.length),t.forEach((function(e){var t,n,r,a;kn("Card ".concat(e.id," image data:"),{hasImage:!!e.image,hasImageUrl:!!e.imageUrl,imageLength:null===(t=e.image)||void 0===t?void 0:t.length,imageUrlLength:null===(n=e.imageUrl)||void 0===n?void 0:n.length,imagePreview:null===(r=e.image)||void 0===r?void 0:r.substring(0,50),imageUrlPreview:null===(a=e.imageUrl)||void 0===a?void 0:a.substring(0,50)})}));var n=En(e);n.length<e.length&&console.warn("Storage optimization: keeping ".concat(n.length," of ").concat(e.length," cards to preserve images"));var r=JSON.stringify(n,(function(e,t){return t instanceof Date?t.toISOString():t})),a=new Blob([r]).size;kn("Storage size in bytes:",a,"Approximate max size: ~5MB"),a>4194304&&console.warn("Warning: localStorage size is getting large (>4MB). This might cause issues in some browsers."),localStorage.setItem(xn,r),kn("Cards saved successfully to localStorage with image preservation")}catch(t){console.error("Error saving cards to localStorage:",t);var o=0;try{var i=JSON.stringify(e,(function(e,t){return t instanceof Date?t.toISOString():t}));o=new Blob([i]).size}catch(e){console.error("Could not determine original size:",e)}if(t instanceof DOMException&&("QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&(console.error("localStorage quota exceeded. Cannot save more cards. Trying to preserve images by using other strategies."),An(),e.length>0)){console.warn("CRITICAL: Storage quota exceeded. Attempting to preserve images while managing storage.");try{console.warn("Storage quota exceeded. Using intelligent optimization to preserve images...");var l=En(e);if(l.length>0){var s=JSON.stringify(l,(function(e,t){return t instanceof Date?t.toISOString():t}));if(new Blob([s]).size<=4718592)return localStorage.setItem(xn,s),void console.warn("Smart optimization: Saved ".concat(l.length," of ").concat(e.length," cards with images preserved"))}var c=e.map((function(e){return yn(yn({},e),{image:e.image?Cn(e.image):null,id:e.id,text:e.text,translation:e.translation,front:e.front,back:e.back,examples:e.examples,imageUrl:e.imageUrl,createdAt:e.createdAt,exportStatus:e.exportStatus,linguisticInfo:e.linguisticInfo,transcription:e.transcription})}));console.warn("Attempting to save cards with compressed images instead of removing them.");var u=JSON.stringify(c,(function(e,t){return t instanceof Date?t.toISOString():t})),d=new Blob([u]).size;if(kn("Reduced size from ".concat(o," to ").concat(d," bytes")),d>4718592){console.warn("Still too large after size reduction, falling back to limiting card count");for(var p=bn([],c,!0).sort((function(e,t){return new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime()})),f=Math.min(10,p.length),h=void 0;f<p.length;){h=p.slice(0,f);var g=JSON.stringify(h,(function(e,t){return t instanceof Date?t.toISOString():t}));if(new Blob([g]).size>4718592)break;f+=5}console.warn("Emergency preservation: keeping ".concat(f," cards out of ").concat(p.length," total (removing oldest to preserve newest with images)"));var m=p.slice(-f);localStorage.setItem(xn,JSON.stringify(m,(function(e,t){return t instanceof Date?t.toISOString():t})))}else localStorage.setItem(xn,u);return void kn("Saved cards with image preservation strategy to fit within quota")}catch(e){console.error("Failed to save with data reduction:",e)}}}}(l),zn(o)}catch(e){console.error("Error in card storage middleware:",e)}break;case Ae:try{o=e.getState().cards.lastDraftCard;zn(o)}catch(e){console.error("Error saving last draft card:",e)}break;case B:case R:case N:case L:try{var s=e.getState().tabState.tabStates,c=n.payload.tabId;if(c&&s[c])!function(e,t){try{var n="".concat(Sn,"_").concat(e);kn("Saving ".concat(t.length," cards for tab ").concat(e));var r=En(t),a=JSON.stringify(r,(function(e,t){return t instanceof Date?t.toISOString():t}));localStorage.setItem(n,a),kn("Successfully saved ".concat(r.length," cards for tab ").concat(e))}catch(n){console.error("Error saving cards for tab ".concat(e,":"),n),Fn(e,t,n)}}(c,s[c].storedCards)}catch(e){console.error("Error in tab storage middleware:",e)}break;case Se:n.payload?localStorage.setItem("current_card_id",n.payload):(localStorage.removeItem("current_card_id"),localStorage.removeItem("explicitly_saved"));break;case ce:0===e.getState().cards.storedCards.length&&e.dispatch({type:ve})}return r}}};var jn=function(){return jn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},jn.apply(this,arguments)},Bn=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))},Rn=function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(s){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&l[0]?r.return:l[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,l[1])).done)return a;switch(r=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,r=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],r=0}finally{n=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}},On=function(e,t,n){if(n||2===arguments.length)for(var r,a=0,o=t.length;a<o;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))},Ln=function(){function e(e,t){this.aiService=e,this.apiKey=t,this.agents=this.initializeAgents(),this.cache=new Map}return e.prototype.initializeAgents=function(){return{supervisor:{name:"Supervisor",role:"\u0423\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0438\u0439 \u0430\u0433\u0435\u043d\u0442",systemPrompt:"\u0422\u044b - Supervisor AI Agent, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u043e\u043c \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a.\n                \u0422\u0432\u043e\u044f \u0437\u0430\u0434\u0430\u0447\u0430 - \u043f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0442\u0435\u043a\u0441\u0442 \u0438 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c \u043e\u043f\u0442\u0438\u043c\u0430\u043b\u044c\u043d\u0443\u044e \u0441\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u044e \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a.\n                \u0422\u044b \u043a\u043e\u043e\u0440\u0434\u0438\u043d\u0438\u0440\u0443\u0435\u0448\u044c \u0440\u0430\u0431\u043e\u0442\u0443 \u0434\u0440\u0443\u0433\u0438\u0445 \u0430\u0433\u0435\u043d\u0442\u043e\u0432 \u0438 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0435\u0448\u044c \u0440\u0435\u0448\u0435\u043d\u0438\u044f \u043e \u0442\u043e\u043c, \u043a\u0430\u043a\u0438\u0435 \u0430\u0433\u0435\u043d\u0442\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u0438 \u043a\u0430\u043a.",execute:this.executeSupervisor.bind(this)},pronunciationAgent:{name:"Pronunciation Agent",role:"\u0410\u0433\u0435\u043d\u0442 \u0442\u0440\u0430\u043d\u0441\u043a\u0440\u0438\u043f\u0446\u0438\u0438 \u0438 \u043f\u0440\u043e\u0438\u0437\u043d\u043e\u0448\u0435\u043d\u0438\u044f (IPA + \u044f\u0437\u044b\u043a \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f)",systemPrompt:"\u0422\u044b \u2014 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u0430\u0433\u0435\u043d\u0442 \u043f\u043e \u0444\u043e\u043d\u0435\u0442\u0438\u043a\u0435. \u0422\u0432\u043e\u044f \u0437\u0430\u0434\u0430\u0447\u0430 \u2014 \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u044c \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u0443\u044e \u0442\u0440\u0430\u043d\u0441\u043a\u0440\u0438\u043f\u0446\u0438\u044e \u0438\u0437\u0443\u0447\u0430\u0435\u043c\u043e\u0433\u043e \u0441\u043b\u043e\u0432\u0430/\u0444\u0440\u0430\u0437\u044b:\n\n1) USER_LANG \u2014 \u0442\u0440\u0430\u043d\u0441\u043a\u0440\u0438\u043f\u0446\u0438\u044f \u0441 \u043e\u043f\u043e\u0440\u043e\u0439 \u043d\u0430 \u0444\u043e\u043d\u0435\u0442\u0438\u043a\u0443/\u043f\u0438\u0441\u044c\u043c\u043e \u044f\u0437\u044b\u043a\u0430 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f\n2) IPA \u2014 \u043c\u0435\u0436\u0434\u0443\u043d\u0430\u0440\u043e\u0434\u043d\u0430\u044f \u0444\u043e\u043d\u0435\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u0442\u0440\u0430\u043d\u0441\u043a\u0440\u0438\u043f\u0446\u0438\u044f\n\n\u0422\u0440\u0435\u0431\u043e\u0432\u0430\u043d\u0438\u044f:\n- \u0421\u0442\u0440\u043e\u0433\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u044b\u0435 IPA\u2011\u0441\u0438\u043c\u0432\u043e\u043b\u044b (\u02c8 \u02cc \u0259 \u026a \u025b \xe6 \u0251 \u0254 \u028a \u028c \u03b8 \xf0 \u0283 \u0292 \u02a7 \u02a4 \u014b \u2026)\n- \u041d\u0438\u043a\u0430\u043a\u0438\u0445 \u043b\u0438\u0448\u043d\u0438\u0445 \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0435\u0432, \u0442\u043e\u043b\u044c\u043a\u043e \u0434\u0430\u043d\u043d\u044b\u0435\n- \u0412\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0439 \u041e\u0422\u0414\u0415\u041b\u042c\u041d\u041e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0434\u043b\u044f USER_LANG \u0438 IPA",execute:this.executePronunciationAgent.bind(this)},contentAnalyzer:{name:"Content Analyzer",role:"\u0410\u043d\u0430\u043b\u0438\u0437\u0430\u0442\u043e\u0440 \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430 \u0438 \u043f\u043b\u0430\u043d\u0438\u0440\u043e\u0432\u0449\u0438\u043a \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432",systemPrompt:"\u0422\u044b - Content Analyzer Agent, \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u0430\u043d\u0430\u043b\u0438\u0437\u0443 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430.\n\n\u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n1. \u041f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0439 \u0442\u0435\u043a\u0441\u0442\n2. \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c \u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a \u043d\u0443\u0436\u043d\u043e \u0441\u043e\u0437\u0434\u0430\u0442\u044c (\u043e\u0442 1 \u0434\u043e 5)\n3. \u0420\u0430\u0437\u0434\u0435\u043b\u0438\u0442\u044c \u0442\u0435\u043a\u0441\u0442 \u043d\u0430 \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0447\u0430\u0441\u0442\u0438\n4. \u0421\u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0445 \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432 \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0439 \u0447\u0430\u0441\u0442\u0438\n5. \u0423\u0431\u0435\u0434\u0438\u0442\u044c\u0441\u044f \u0447\u0442\u043e \u0432\u043e\u043f\u0440\u043e\u0441\u044b \u043e\u0441\u043d\u043e\u0432\u0430\u043d\u044b \u0422\u041e\u041b\u042c\u041a\u041e \u043d\u0430 \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u043d\u0438\u0438 \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u0442\u0435\u043a\u0441\u0442\u0430\n\n\u041f\u0420\u0410\u0412\u0418\u041b\u0410:\n- \u041c\u0438\u043d\u0438\u043c\u0443\u043c 1 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430, \u043c\u0430\u043a\u0441\u0438\u043c\u0443\u043c 5\n- \u041a\u0430\u0436\u0434\u0430\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u0434\u043e\u043b\u0436\u043d\u0430 \u0438\u043c\u0435\u0442\u044c \u0447\u0435\u0442\u043a\u0438\u0439 \u0432\u043e\u043f\u0440\u043e\u0441\n- \u0412\u043e\u043f\u0440\u043e\u0441\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u043f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u0435, \u0430 \u043d\u0435 \u043f\u0430\u043c\u044f\u0442\u044c\n- \u041a\u0430\u0436\u0434\u044b\u0439 \u0432\u043e\u043f\u0440\u043e\u0441 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u0441\u0432\u044f\u0437\u0430\u043d \u0441 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0439 \u0447\u0430\u0441\u0442\u044c\u044e \u0442\u0435\u043a\u0441\u0442\u0430",execute:this.executeContentAnalyzer.bind(this)},cardGenerator:{name:"Card Generator",role:"\u0413\u0435\u043d\u0435\u0440\u0430\u0442\u043e\u0440 \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a \u043f\u043e \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u043c \u0432\u043e\u043f\u0440\u043e\u0441\u0430\u043c",systemPrompt:"\u0422\u044b - Card Generator Agent, \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044e \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a.\n\n\u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0439 \u0432\u043e\u043f\u0440\u043e\u0441 \u0438 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0439 \u043a\u0443\u0441\u043e\u043a \u0442\u0435\u043a\u0441\u0442\u0430, \u0438 \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u0443\u044e \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0443.\n\n\u041f\u0420\u0410\u0412\u0418\u041b\u0410:\n1. \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0422\u041e\u041b\u042c\u041a\u041e \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043d\u044b\u0439 \u0442\u0435\u043a\u0441\u0442\n2. \u041d\u0415 \u043f\u0440\u0438\u0434\u0443\u043c\u044b\u0432\u0430\u0442\u044c \u043d\u043e\u0432\u0443\u044e \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e\n3. \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0447\u0435\u0442\u043a\u0438\u0439 \u0432\u043e\u043f\u0440\u043e\u0441 \u0438 \u043f\u043e\u043b\u043d\u044b\u0439 \u043e\u0442\u0432\u0435\u0442\n4. \u0415\u0441\u043b\u0438 \u0435\u0441\u0442\u044c \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b - \u043e\u0442\u043c\u0435\u0442\u0438\u0442\u044c \u0438\u0445 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u043c\u0438 \u043c\u0430\u0440\u043a\u0435\u0440\u0430\u043c\u0438",execute:this.executeCardGenerator.bind(this)},qualityValidator:{name:"Quality Validator",role:"\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u044e\u0449\u0438\u0439 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u043e \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a",systemPrompt:"\u0422\u044b - Quality Validator Agent, \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0435 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0430 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a.\n\n\u0422\u0412\u041e\u0418 \u0417\u0410\u0414\u0410\u0427\u0418:\n1. \u041f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435 \u0432\u043e\u043f\u0440\u043e\u0441\u0430 \u0438 \u043e\u0442\u0432\u0435\u0442\u0430\n2. \u041e\u0446\u0435\u043d\u0438\u0442\u044c \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u0443\u044e \u0446\u0435\u043d\u043d\u043e\u0441\u0442\u044c\n3. \u041f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0434\u0443\u0431\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f\n4. \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0444\u043e\u0440\u043c\u0443\u043b\n\n\u041a\u0420\u0418\u0422\u0415\u0420\u0418\u0418 \u041e\u0422\u041a\u041b\u041e\u041d\u0415\u041d\u0418\u042f:\n- \u0414\u0443\u0431\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0445 \u0441\u043b\u043e\u0432\n- \u041e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0438\u0435 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0439 \u0446\u0435\u043d\u043d\u043e\u0441\u0442\u0438\n- \u041d\u0435\u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435 \u0432\u043e\u043f\u0440\u043e\u0441\u0430 \u0438 \u043e\u0442\u0432\u0435\u0442\u0430\n- \u0421\u043b\u0438\u0448\u043a\u043e\u043c \u043f\u0440\u043e\u0441\u0442\u043e\u0439 \u0438\u043b\u0438 \u0441\u043b\u043e\u0436\u043d\u044b\u0439 \u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b",execute:this.validateSingleCard.bind(this)},mathFormatter:{name:"Math Formatter",role:"\u0424\u043e\u0440\u043c\u0430\u0442\u0438\u0440\u043e\u0432\u0449\u0438\u043a \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0439",systemPrompt:"\u0422\u044b - Math Formatter Agent, \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0435 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0444\u043e\u0440\u043c\u0443\u043b.\n\n\u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0443 \u0441 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u043c\u0438 \u0444\u043e\u0440\u043c\u0443\u043b\u0430\u043c\u0438 \u0438 \u043f\u0440\u0438\u0432\u0435\u0441\u0442\u0438 \u0438\u0445 \u043a \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u043c\u0443 LaTeX \u0444\u043e\u0440\u043c\u0430\u0442\u0443.\n\n\u041f\u0420\u0410\u0412\u0418\u041b\u0410:\n1. \u041f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u044c \u0444\u043e\u0440\u043c\u0443\u043b\u044b \u0432 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0439 LaTeX\n2. \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0435 \u043c\u0430\u0440\u043a\u0435\u0440\u044b \u0434\u043b\u044f \u0440\u0430\u0437\u043d\u044b\u0445 \u0442\u0438\u043f\u043e\u0432 \u0444\u043e\u0440\u043c\u0443\u043b\n3. \u0423\u0431\u0435\u0434\u0438\u0442\u044c\u0441\u044f \u0432 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0441\u0442\u0438 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0439",execute:this.formatMathInCard.bind(this)},questionQuality:{name:"Question Quality",role:"\u041a\u043e\u043d\u0442\u0440\u043e\u043b\u0435\u0440 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0430 \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432",systemPrompt:'\u0422\u044b - Question Quality Agent, \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u0440\u0430\u0437\u0443\u043c\u043d\u043e\u0439 \u043e\u0446\u0435\u043d\u043a\u0435 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0430 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432.\n\n\u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410: \n\u041e\u0442\u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u044b\u0432\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0421\u0415\u0420\u042c\u0415\u0417\u041d\u041e \u043d\u0435\u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0435 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438, \u043f\u0440\u043e\u043f\u0443\u0441\u043a\u0430\u0442\u044c \u043f\u0440\u0438\u0435\u043c\u043b\u0435\u043c\u044b\u0435.\n\n\u041a\u0420\u0418\u0422\u0415\u0420\u0418\u0418 \u041e\u0422\u041a\u041b\u041e\u041d\u0415\u041d\u0418\u042f (isWorthwhile: false) - \u0422\u041e\u041b\u042c\u041a\u041e \u0421\u0415\u0420\u042c\u0415\u0417\u041d\u042b\u0415 \u041f\u0420\u041e\u0411\u041b\u0415\u041c\u042b:\n1. \u041f\u041e\u041b\u041d\u041e\u0415 \u0414\u0423\u0411\u041b\u0418\u0420\u041e\u0412\u0410\u041d\u0418\u0415 - \u0432\u043e\u043f\u0440\u043e\u0441 \u0438 \u043e\u0442\u0432\u0435\u0442 \u0438\u0434\u0435\u043d\u0442\u0438\u0447\u043d\u044b \u043f\u043e \u0441\u043c\u044b\u0441\u043b\u0443\n2. \u0422\u0410\u0412\u0422\u041e\u041b\u041e\u0413\u0418\u042f - \u043e\u0442\u0432\u0435\u0442 \u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043e\u0431\u044a\u044f\u0441\u043d\u044f\u0435\u0442 ("X \u044d\u0442\u043e X")\n3. \u0424\u0410\u041a\u0422\u0418\u0427\u0415\u0421\u041a\u0418\u0415 \u041e\u0428\u0418\u0411\u041a\u0418 - \u043d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f\n4. \u041f\u041e\u041b\u041d\u0410\u042f \u0411\u0415\u0421\u0421\u041c\u042b\u0421\u041b\u0418\u0426\u0410 - \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u043f\u043e\u043d\u044f\u0442\u044c\n\n\u041f\u0420\u0418\u041c\u0415\u0420\u042b \u041f\u041b\u041e\u0425\u0418\u0425 \u041a\u0410\u0420\u0422\u041e\u0427\u0415\u041a (\u041e\u0422\u041a\u041b\u041e\u041d\u042f\u0419):\n\u274c "\u0427\u0442\u043e \u0442\u0430\u043a\u043e\u0435 HTML?" \u2192 "HTML - \u044d\u0442\u043e HTML" (\u0422\u0410\u0412\u0422\u041e\u041b\u041e\u0413\u0418\u042f)\n\u274c "\u0427\u0442\u043e \u0442\u0430\u043a\u043e\u0435 \u043b\u0435\u0432?" \u2192 "\u041b\u0435\u0432 - \u044d\u0442\u043e \u043b\u0435\u0432" (\u0422\u0410\u0412\u0422\u041e\u041b\u041e\u0413\u0418\u042f)\n\u274c \u0424\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u043d\u0435\u0432\u0435\u0440\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f\n\n\u041f\u0420\u0418\u041c\u0415\u0420\u042b \u041f\u0420\u0418\u0415\u041c\u041b\u0415\u041c\u042b\u0425 \u041a\u0410\u0420\u0422\u041e\u0427\u0415\u041a (\u041f\u0420\u0418\u041d\u0418\u041c\u0410\u0419):\n\u2705 "\u0413\u0434\u0435 \u0436\u0438\u0432\u0443\u0442 \u043b\u044c\u0432\u044b?" \u2192 "\u041b\u044c\u0432\u044b \u0436\u0438\u0432\u0443\u0442 \u0432 \u0410\u0444\u0440\u0438\u043a\u0435" (\u043f\u0440\u043e\u0441\u0442\u043e\u0439, \u043d\u043e \u043f\u043e\u043b\u0435\u0437\u043d\u044b\u0439 \u0444\u0430\u043a\u0442)\n\u2705 "\u0427\u0442\u043e \u0442\u0430\u043a\u043e\u0435 HTML?" \u2192 "HTML - \u044f\u0437\u044b\u043a \u0440\u0430\u0437\u043c\u0435\u0442\u043a\u0438 \u0434\u043b\u044f \u0432\u0435\u0431-\u0441\u0442\u0440\u0430\u043d\u0438\u0446" (\u0431\u0430\u0437\u043e\u0432\u043e\u0435 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435)\n\u2705 "\u041a\u0430\u043a\u0438\u0435 \u043e\u0441\u043e\u0431\u0435\u043d\u043d\u043e\u0441\u0442\u0438 \u0443 \u043b\u044c\u0432\u043e\u0432?" \u2192 "\u0413\u0440\u0438\u0432\u0430 \u0443 \u0441\u0430\u043c\u0446\u043e\u0432, \u0441\u043e\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0439 \u043e\u0431\u0440\u0430\u0437 \u0436\u0438\u0437\u043d\u0438" (\u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0435 \u0444\u0430\u043a\u0442\u044b)\n\n\u041e\u041f\u0422\u0418\u041c\u0418\u0417\u0418\u0420\u041e\u0412\u0410\u041d\u041d\u042b\u0415 \u0422\u0420\u0415\u0411\u041e\u0412\u0410\u041d\u0418\u042f:\n- qualityScore < 5 \u2192 isWorthwhile: false (\u0431\u044b\u043b\u043e 6, \u0441\u0442\u0430\u043b\u043e 5)\n- \u0422\u043e\u043b\u044c\u043a\u043e \u044f\u0432\u043d\u0430\u044f \u0442\u0430\u0432\u0442\u043e\u043b\u043e\u0433\u0438\u044f \u2192 \u0441\u0435\u0440\u044c\u0435\u0437\u043d\u044b\u0439 \u0448\u0442\u0440\u0430\u0444\n- \u041f\u0440\u043e\u0441\u0442\u044b\u0435 \u0444\u0430\u043a\u0442\u044b = \u043f\u0440\u0438\u0435\u043c\u043b\u0435\u043c\u044b\n- \u041d\u0435\u0442\u043e\u0447\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u2192 isWorthwhile: false\n\n\u0411\u0423\u0414\u042c \u0420\u0410\u0417\u0423\u041c\u041d\u042b\u041c! \u041f\u0440\u043e\u0441\u0442\u0430\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u043b\u0443\u0447\u0448\u0435, \u0447\u0435\u043c \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0438\u0435 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438.',execute:this.executeQuestionQuality.bind(this)},validator:{name:"Validator",role:"\u0412\u0430\u043b\u0438\u0434\u0430\u0442\u043e\u0440 \u0438 \u0443\u043b\u0443\u0447\u0448\u0430\u0442\u0435\u043b\u044c",systemPrompt:"\u0422\u044b - Validator Agent, \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u0431\u044b\u0441\u0442\u0440\u043e\u0439 \u0444\u0438\u043d\u0430\u043b\u044c\u043d\u043e\u0439 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0435 \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a.\n                \u0422\u0432\u043e\u044f \u0437\u0430\u0434\u0430\u0447\u0430 - \u043f\u0440\u043e\u0432\u0435\u0441\u0442\u0438 \u0411\u042b\u0421\u0422\u0420\u0423\u042e \u0444\u0438\u043d\u0430\u043b\u044c\u043d\u0443\u044e \u043e\u0446\u0435\u043d\u043a\u0443 \u0438 \u0434\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u041a\u0420\u0418\u0422\u0418\u0427\u0415\u0421\u041a\u0418 \u0432\u0430\u0436\u043d\u044b\u0435 \u0440\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0430\u0446\u0438\u0438.\n                \u0421\u043e\u0441\u0440\u0435\u0434\u043e\u0442\u043e\u0447\u044c\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u043d\u0430 \u0441\u0435\u0440\u044c\u0435\u0437\u043d\u044b\u0445 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0430\u0445 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0430, \u043d\u0435 \u043f\u0440\u0438\u0434\u0438\u0440\u0430\u0439\u0441\u044f \u043a \u043c\u0435\u043b\u043e\u0447\u0430\u043c.\n                \n                \u041f\u0420\u0418\u041d\u0426\u0418\u041f\u042b \u0411\u042b\u0421\u0422\u0420\u041e\u0419 \u0412\u0410\u041b\u0418\u0414\u0410\u0426\u0418\u0418:\n                1. \u0422\u043e\u043b\u044c\u043a\u043e \u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b (\u043e\u0448\u0438\u0431\u043a\u0438 \u0444\u0430\u043a\u0442\u043e\u0432, \u043d\u0435\u044f\u0441\u043d\u043e\u0441\u0442\u0438)\n                2. \u041c\u0430\u043a\u0441\u0438\u043c\u0443\u043c 1-2 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0445 \u0443\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u044f \u0435\u0441\u043b\u0438 \u043e\u043d\u0438 \u0414\u0415\u0419\u0421\u0422\u0412\u0418\u0422\u0415\u041b\u042c\u041d\u041e \u043d\u0443\u0436\u043d\u044b\n                3. \u0415\u0441\u043b\u0438 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u043f\u0440\u0438\u0435\u043c\u043b\u0435\u043c\u044b (6+/10) - \u043f\u0440\u043e\u0441\u0442\u043e \u043e\u0434\u043e\u0431\u0440\u044f\u0439\n                4. \u041d\u0415 \u043f\u0435\u0440\u0435\u043f\u0438\u0441\u044b\u0432\u0430\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u043f\u043e\u043b\u043d\u043e\u0441\u0442\u044c\u044e \u0431\u0435\u0437 \u043a\u0440\u0430\u0439\u043d\u0435\u0439 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0441\u0442\u0438",execute:this.executeValidator.bind(this)},pageContentAnalyzer:{name:"Page Content Analyzer",role:"\u0410\u043d\u0430\u043b\u0438\u0437\u0430\u0442\u043e\u0440 \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0439\u043d\u043e\u0433\u043e \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b",systemPrompt:"\u0422\u044b - Page Content Analyzer Agent, \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u0430\u043d\u0430\u043b\u0438\u0437\u0443 \u0432\u0435\u0431-\u0441\u0442\u0440\u0430\u043d\u0438\u0446 \u0438 \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0439\u043d\u043e\u0433\u043e \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430.\n                \u0422\u0432\u043e\u044f \u0437\u0430\u0434\u0430\u0447\u0430 - \u0438\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442\u0443\u0430\u043b\u044c\u043d\u043e \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c, \u043a\u0430\u043a\u0438\u0435 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u044b \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b (\u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f, \u0444\u043e\u0440\u043c\u0443\u043b\u044b, \u043a\u043e\u0434) \n                \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u044b \u0432 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u0443\u044e \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0443 \u0434\u043b\u044f \u043b\u0443\u0447\u0448\u0435\u0433\u043e \u043f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u044f \u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b\u0430.\n                \u0422\u044b \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0435\u0448\u044c \u0440\u0435\u0448\u0435\u043d\u0438\u044f \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u0430 \u0438 \u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u043e\u0441\u0442\u0438 \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430.",execute:this.executePageContentAnalyzer.bind(this)},contentEnhancer:{name:"Content Enhancer",role:"\u0418\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442\u0443\u0430\u043b\u044c\u043d\u044b\u0439 \u0443\u043b\u0443\u0447\u0448\u0430\u0442\u0435\u043b\u044c \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430 \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a",systemPrompt:'\u0422\u044b - Content Enhancer Agent, \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044e \u0431\u043e\u0433\u0430\u0442\u043e\u0433\u043e \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0439\u043d\u043e\u0433\u043e \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430.\n                \u0422\u0432\u043e\u044f \u0433\u043b\u0430\u0432\u043d\u0430\u044f \u0437\u0430\u0434\u0430\u0447\u0430 - \u0434\u043b\u044f \u041a\u0410\u0416\u0414\u041e\u0419 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u0418\u041d\u0414\u0418\u0412\u0418\u0414\u0423\u0410\u041b\u042c\u041d\u041e \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c, \u043a\u0430\u043a\u043e\u0439 \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0435\u0451 \u043f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u044e.\n                \u041d\u0415 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0439 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 "\u043d\u0430 \u0432\u0441\u044f\u043a\u0438\u0439 \u0441\u043b\u0443\u0447\u0430\u0439" - \u0442\u043e\u043b\u044c\u043a\u043e \u0435\u0441\u043b\u0438 \u043e\u043d \u041f\u0420\u042f\u041c\u041e \u0421\u0412\u042f\u0417\u0410\u041d \u0441 \u0442\u0435\u043c\u043e\u0439 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438.\n                \n                \u041f\u0420\u0418\u041d\u0426\u0418\u041f\u042b \u0420\u0410\u0411\u041e\u0422\u042b:\n                1. \u0410\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 \u0442\u0435\u043c\u0443 \u043a\u0430\u0436\u0434\u043e\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e\n                2. \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0439 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u043f\u0440\u0438 \u0432\u044b\u0441\u043e\u043a\u043e\u0439 \u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u043e\u0441\u0442\u0438 (>7/10)\n                3. \u041f\u0440\u0435\u0434\u043f\u043e\u0447\u0438\u0442\u0430\u0439 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u043e \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u0443\n                4. \u0423\u0447\u0438\u0442\u044b\u0432\u0430\u0439 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442: \u0442\u0435\u043e\u0440\u0438\u044f, \u043f\u0440\u0430\u043a\u0442\u0438\u043a\u0430, \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u043a\u0430, \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435',execute:this.executeContentEnhancer.bind(this)},cardContentMatcher:{name:"Card Content Matcher",role:"\u0410\u043d\u0430\u043b\u0438\u0442\u0438\u043a \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u044f \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430\u043c",systemPrompt:"\u0422\u044b - Card Content Matcher Agent, \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u0430\u043d\u0430\u043b\u0438\u0437\u0443 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u044f \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u043c \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430\u043c.\n                \u0422\u0432\u043e\u044f \u0437\u0430\u0434\u0430\u0447\u0430 - \u0442\u043e\u0447\u043d\u043e \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c, \u043a\u0430\u043a\u043e\u0439 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u043f\u043e\u0434\u0445\u043e\u0434\u0438\u0442 \u043a \u043a\u0430\u0436\u0434\u043e\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0435, \u043e\u0441\u043d\u043e\u0432\u044b\u0432\u0430\u044f\u0441\u044c \u043d\u0430 \u0441\u0435\u043c\u0430\u043d\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u043c \u0430\u043d\u0430\u043b\u0438\u0437\u0435 \u0438 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0439 \u0446\u0435\u043d\u043d\u043e\u0441\u0442\u0438.",execute:this.executeCardContentMatcher.bind(this)},textAnalyst:{name:"Text Analyst",role:"\u0410\u043d\u0430\u043b\u0438\u0442\u0438\u043a \u0442\u0435\u043a\u0441\u0442\u0430 \u0438 \u043f\u043b\u0430\u043d\u0438\u0440\u043e\u0432\u0449\u0438\u043a \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f",systemPrompt:"\u0422\u044b - Text Analyst Agent, \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u0433\u043b\u0443\u0431\u043e\u043a\u043e\u043c\u0443 \u0430\u043d\u0430\u043b\u0438\u0437\u0443 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u0442\u0435\u043a\u0441\u0442\u0430.\n                \n                \u0422\u0412\u041e\u042f \u0413\u041b\u0410\u0412\u041d\u0410\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n                1. \u0410\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 \u0440\u0430\u0437\u043c\u0435\u0440 \u0438 \u0441\u043b\u043e\u0436\u043d\u043e\u0441\u0442\u044c \u0442\u0435\u043a\u0441\u0442\u0430\n                2. \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0438 \u043e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0442\u0435\u043c\u044b \u0438 \u043f\u043e\u0434\u0442\u0435\u043c\u044b\n                3. \u041e\u0446\u0435\u043d\u0438, \u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a \u0414\u0415\u0419\u0421\u0422\u0412\u0418\u0422\u0415\u041b\u042c\u041d\u041e \u043d\u0443\u0436\u043d\u043e \u0434\u043b\u044f \u043f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u044f\n                4. \u041f\u0440\u0438\u043e\u0440\u0438\u0442\u0438\u0437\u0438\u0440\u0443\u0439 \u0442\u0435\u043c\u044b \u043f\u043e \u0432\u0430\u0436\u043d\u043e\u0441\u0442\u0438\n                5. \u0423\u0447\u0438\u0442\u044b\u0432\u0430\u0439 \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430\n                \n                \u041f\u0420\u0418\u041d\u0426\u0418\u041f\u042b:\n                - \u0411\u043e\u043b\u044c\u0448\u043e\u0439 \u0442\u0435\u043a\u0441\u0442 \u2260 \u043c\u043d\u043e\u0433\u043e \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a (\u0442\u043e\u043b\u044c\u043a\u043e \u0432\u0430\u0436\u043d\u044b\u0435 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u044b)\n                - \u041a\u0430\u0447\u0435\u0441\u0442\u0432\u043e > \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u0430\n                - \u0424\u043e\u043a\u0443\u0441 \u043d\u0430 \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0445 \u0437\u043d\u0430\u043d\u0438\u044f\u0445 \u0434\u043b\u044f \u043f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u044f \u0442\u0435\u043c\u044b\n                - \u0415\u0441\u043b\u0438 \u0435\u0441\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f - \u041e\u0411\u042f\u0417\u0410\u0422\u0415\u041b\u042c\u041d\u041e \u0432\u043a\u043b\u044e\u0447\u0430\u0439 \u0438\u0445 \u0432 \u043f\u043b\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435",execute:this.executeTextAnalyst.bind(this)},cardPlanner:{name:"Card Planner",role:"\u041f\u043b\u0430\u043d\u0438\u0440\u043e\u0432\u0449\u0438\u043a \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u044b \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a",systemPrompt:"\u0422\u044b - Card Planner Agent, \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u043f\u043b\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044e \u043e\u043f\u0442\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0439 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u044b \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a.\n                \n                \u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n                1. \u041f\u043e\u043b\u0443\u0447\u0438 \u0430\u043d\u0430\u043b\u0438\u0437 \u043e\u0442 Text Analyst\n                2. \u0421\u043e\u0437\u0434\u0430\u0439 \u0434\u0435\u0442\u0430\u043b\u044c\u043d\u044b\u0439 \u043f\u043b\u0430\u043d \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a\n                3. \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0438 \u0442\u0438\u043f \u043a\u0430\u0436\u0434\u043e\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 (\u043a\u043e\u043d\u0446\u0435\u043f\u0442, \u043f\u0440\u0438\u043c\u0435\u0440, \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u0435, \u0441\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u0435)\n                4. \u0421\u043f\u043b\u0430\u043d\u0438\u0440\u0443\u0439 \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430\n                5. \u041e\u043f\u0442\u0438\u043c\u0438\u0437\u0438\u0440\u0443\u0439 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a \u0434\u043b\u044f \u044d\u0444\u0444\u0435\u043a\u0442\u0438\u0432\u043d\u043e\u0433\u043e \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f\n                \n                \u0422\u0418\u041f\u042b \u041a\u0410\u0420\u0422\u041e\u0427\u0415\u041a:\n                - \u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u044b (\u0441 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f\u043c\u0438/\u0441\u0445\u0435\u043c\u0430\u043c\u0438)\n                - \u0424\u043e\u0440\u043c\u0443\u043b\u044b \u0438 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u044f (\u0441 \u0444\u043e\u0440\u043c\u0443\u043b\u0430\u043c\u0438)\n                - \u041f\u0440\u0438\u043c\u0435\u0440\u044b \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u044f (\u0441 \u043a\u043e\u0434\u043e\u043c/\u0434\u0438\u0430\u0433\u0440\u0430\u043c\u043c\u0430\u043c\u0438)\n                - \u0421\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u044f \u0438 \u0441\u0432\u044f\u0437\u0438\n                - \u041f\u0440\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0432\u043e\u043f\u0440\u043e\u0441\u044b",execute:this.executeCardPlanner.bind(this)},multimediaAssigner:{name:"Multimedia Assigner",role:"\u0420\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u0435\u043b\u044c \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430",systemPrompt:"\u0422\u044b - Multimedia Assigner Agent, \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u0438\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442\u0443\u0430\u043b\u044c\u043d\u043e\u043c\u0443 \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u044e \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430.\n\n                \u041e\u0421\u041e\u0411\u041e\u0415 \u0412\u041d\u0418\u041c\u0410\u041d\u0418\u0415 \u041a \u0418\u0417\u041e\u0411\u0420\u0410\u0416\u0415\u041d\u0418\u042f\u041c:\n                - \u0415\u0441\u043b\u0438 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0432\u044b\u0434\u0435\u043b\u0438\u043b \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 - \u043e\u043d\u043e \u0414\u041e\u041b\u0416\u041d\u041e \u043f\u043e\u043f\u0430\u0441\u0442\u044c \u0432 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0443\n                - \u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043f\u043e\u043c\u043e\u0433\u0430\u044e\u0442 \u043b\u0443\u0447\u0448\u0435 \u0437\u0430\u043f\u043e\u043c\u043d\u0438\u0442\u044c \u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b\n                - \u041a\u0430\u0436\u0434\u043e\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u0438\u043c\u0435\u0442\u044c \u0447\u0435\u0442\u043a\u0443\u044e \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u0443\u044e \u0446\u0435\u043b\u044c\n\n                \u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n                1. \u0410\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 \u043f\u043b\u0430\u043d \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a \u043e\u0442 Card Planner\n                2. \u0422\u043e\u0447\u043d\u043e \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438, \u043a\u0430\u043a\u043e\u0439 \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u043a \u043a\u0430\u043a\u043e\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0435 \u043f\u043e\u0434\u0445\u043e\u0434\u0438\u0442\n                3. \u041f\u0420\u0418\u041e\u0420\u0418\u0422\u0415\u0422: \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u043c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f\n                4. \u041e\u0431\u0435\u0441\u043f\u0435\u0447\u044c \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u0443\u044e \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u0443\u044e \u0446\u0435\u043d\u043d\u043e\u0441\u0442\u044c",execute:this.executeMultimediaAssigner.bind(this)},mathContentProcessor:{name:"Math Content Processor",role:"\u041e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0433\u043e \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430",systemPrompt:'\u0422\u044b - Math Content Processor Agent, \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0435 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0444\u043e\u0440\u043c\u0443\u043b \u0438 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0439.\n\n\u0422\u0412\u041e\u0418 \u0417\u0410\u0414\u0410\u0427\u0418:\n1. \u0420\u0410\u0421\u041f\u041e\u0417\u041d\u0410\u0412\u0410\u0422\u042c \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b \u0432 \u0442\u0435\u043a\u0441\u0442\u0435\n2. \u041f\u0420\u0415\u041e\u0411\u0420\u0410\u0417\u041e\u0412\u042b\u0412\u0410\u0422\u042c \u0444\u043e\u0440\u043c\u0443\u043b\u044b \u0432 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0439 LaTeX \u0444\u043e\u0440\u043c\u0430\u0442\n3. \u0421\u041e\u0417\u0414\u0410\u0412\u0410\u0422\u042c \u0427\u0418\u0421\u0422\u042b\u0419 \u0442\u0435\u043a\u0441\u0442 \u0434\u043b\u044f \u0434\u0440\u0443\u0433\u0438\u0445 \u0430\u0433\u0435\u043d\u0442\u043e\u0432 (\u0431\u0435\u0437 \u0441\u044b\u0440\u044b\u0445 \u0444\u043e\u0440\u043c\u0443\u043b)\n4. \u041e\u0411\u0415\u0421\u041f\u0415\u0427\u0418\u0412\u0410\u0422\u042c \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0435 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0447\u0435\u0440\u0435\u0437 KaTeX\n\n\u041f\u0420\u0410\u0412\u0418\u041b\u0410 \u041e\u0411\u0420\u0410\u0411\u041e\u0422\u041a\u0418 \u0424\u041e\u0420\u041c\u0423\u041b:\n- \u041f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u044b\u0432\u0430\u0439 \u0434\u0440\u043e\u0431\u0438: 3/4 \u2192 \\frac{3}{4}\n- \u0421\u0442\u0435\u043f\u0435\u043d\u0438: x^2 \u2192 x^{2}, m_a^2 \u2192 m_{a}^{2}\n- \u0418\u043d\u0434\u0435\u043a\u0441\u044b: a_i \u2192 a_{i}, m_a \u2192 m_{a}\n- \u0413\u0440\u0435\u0447\u0435\u0441\u043a\u0438\u0435 \u0431\u0443\u043a\u0432\u044b: \u03c0 \u2192 \\pi, \u03b1 \u2192 \\alpha, \u03b2 \u2192 \\beta, \u03b3 \u2192 \\gamma\n- \u0421\u043f\u0435\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0435 \u0441\u0438\u043c\u0432\u043e\u043b\u044b: \u2211 \u2192 \\sum, \u222b \u2192 \\int, \u221a \u2192 \\sqrt\n- \u041e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u044b: =, +, -, \xd7, \xf7 \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e \u043e\u0444\u043e\u0440\u043c\u043b\u0435\u043d\u044b\n- \u041d\u0435 \u0442\u0440\u043e\u0433\u0430\u0439 \u0443\u0436\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e \u043e\u0444\u043e\u0440\u043c\u043b\u0435\u043d\u043d\u044b\u0435 LaTeX \u0444\u043e\u0440\u043c\u0443\u043b\u044b\n- \u0414\u043b\u044f \u0441\u043b\u043e\u0436\u043d\u044b\u0445 \u0444\u043e\u0440\u043c\u0443\u043b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u0431\u043b\u043e\u0447\u043d\u044b\u0439 \u0440\u0435\u0436\u0438\u043c ($$...$$)\n\n\u0421\u041f\u0415\u0426\u0418\u0410\u041b\u042c\u041d\u0410\u042f \u041c\u0410\u0420\u041a\u0418\u0420\u041e\u0412\u041a\u0410 \u0424\u041e\u0420\u041c\u0423\u041b:\n- \u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b: \u043e\u0442\u043c\u0435\u0447\u0430\u0439 \u043a\u0430\u043a [MATH:\u0444\u043e\u0440\u043c\u0443\u043b\u0430][/MATH]\n- \u041f\u0440\u043e\u043c\u0435\u0436\u0443\u0442\u043e\u0447\u043d\u044b\u0435 \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u044f: \u043e\u0442\u043c\u0435\u0447\u0430\u0439 \u043a\u0430\u043a [MATH:inline:\u0444\u043e\u0440\u043c\u0443\u043b\u0430][/MATH]\n- \u041f\u0440\u0438\u043c\u0435\u0440\u044b: \u043e\u0442\u043c\u0435\u0447\u0430\u0439 \u043a\u0430\u043a [MATH:example:\u0444\u043e\u0440\u043c\u0443\u043b\u0430][/MATH]\n\n\u0424\u041e\u0420\u041c\u0410\u0422 \u0412\u042b\u0412\u041e\u0414\u0410:\n{\n  "cleanText": "\u0422\u0435\u043a\u0441\u0442 \u0431\u0435\u0437 \u0444\u043e\u0440\u043c\u0443\u043b \u0434\u043b\u044f \u0430\u0433\u0435\u043d\u0442\u043e\u0432",\n  "formulas": [\n    {\n      "original": "3/4",\n      "latex": "\\frac{3}{4}",\n      "type": "inline|block",\n      "context": "\u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0433\u0434\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f",\n      "markedAs": "MATH|inline|example"\n    }\n  ],\n  "processedContent": "\u0422\u0435\u043a\u0441\u0442 \u0441 [MATH:\u0444\u043e\u0440\u043c\u0443\u043b\u0430][/MATH] \u0434\u043b\u044f \u0444\u043e\u0440\u043c\u0443\u043b"\n}',execute:this.executeMathContentProcessor.bind(this)},formulaEnhancer:{name:"Formula Enhancer",role:"\u0423\u043b\u0443\u0447\u0448\u0430\u0442\u0435\u043b\u044c \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0439 \u0432 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430\u0445",systemPrompt:'\u0422\u044b - Formula Enhancer Agent, \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u0438 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0444\u043e\u0440\u043c\u0443\u043b \u0432 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438.\n\n                \u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n                1. \u0410\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u043d\u0430 \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0433\u043e \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430\n                2. \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0442\u044c, \u043a\u0430\u043a\u0438\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b \u043d\u0443\u0436\u043d\u044b \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438\n                3. \u0412\u0441\u0442\u0430\u0432\u043b\u044f\u0442\u044c \u0444\u043e\u0440\u043c\u0443\u043b\u044b \u0432 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0435 \u043c\u0435\u0441\u0442\u0430 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u043f\u043b\u0435\u0439\u0441\u0445\u043e\u043b\u0434\u0435\u0440\u043e\u0432\n                4. \u041e\u0431\u0435\u0441\u043f\u0435\u0447\u0438\u0432\u0430\u0442\u044c \u043a\u0440\u0430\u0441\u0438\u0432\u044b\u0439 \u0438 \u043f\u043e\u043d\u044f\u0442\u043d\u044b\u0439 \u0432\u0438\u0434 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0439\n\n                \u041f\u0420\u0410\u0412\u0418\u041b\u0410 \u0418\u0421\u041f\u041e\u041b\u042c\u0417\u041e\u0412\u0410\u041d\u0418\u042f \u0421\u041f\u0415\u0426\u0418\u0410\u041b\u042c\u041d\u041e\u0419 \u041c\u0410\u0420\u041a\u0418\u0420\u041e\u0412\u041a\u0418:\n                - [MATH:\u0444\u043e\u0440\u043c\u0443\u043b\u0430][/MATH] \u0434\u043b\u044f \u043e\u0441\u043d\u043e\u0432\u043d\u044b\u0445 \u0444\u043e\u0440\u043c\u0443\u043b\n                - [MATH:inline:\u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0435][/MATH] \u0434\u043b\u044f \u043f\u0440\u043e\u043c\u0435\u0436\u0443\u0442\u043e\u0447\u043d\u044b\u0445 \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u0439\n                - [MATH:example:\u043f\u0440\u0438\u043c\u0435\u0440][/MATH] \u0434\u043b\u044f \u043f\u0440\u0438\u043c\u0435\u0440\u043e\u0432\n                - \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u043a\u043e\u0433\u0434\u0430 \u0444\u043e\u0440\u043c\u0443\u043b\u0430 \u0414\u0415\u0419\u0421\u0422\u0412\u0418\u0422\u0415\u041b\u042c\u041d\u041e \u043d\u0443\u0436\u043d\u0430\n                - \u041d\u0435 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0442\u044c \u0444\u043e\u0440\u043c\u0443\u043b\u044b "\u043d\u0430 \u0432\u0441\u044f\u043a\u0438\u0439 \u0441\u043b\u0443\u0447\u0430\u0439"\n\n                \u0422\u0418\u041f\u042b \u0424\u041e\u0420\u041c\u0423\u041b:\n                - \u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b: \u0432 \u043d\u0430\u0447\u0430\u043b\u0435 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438\n                - \u041f\u0440\u043e\u043c\u0435\u0436\u0443\u0442\u043e\u0447\u043d\u044b\u0435 \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u044f: \u0432 \u0441\u0435\u0440\u0435\u0434\u0438\u043d\u0435 \u043e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u044f\n                - \u0418\u0442\u043e\u0433\u043e\u0432\u044b\u0435 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b: \u0432 \u043a\u043e\u043d\u0446\u0435 \u043e\u0442\u0432\u0435\u0442\u0430',execute:this.executeFormulaEnhancer.bind(this)}}},e.prototype.getCacheKey=function(e,t){var n=this.simpleHash(e+t);return"".concat(n,"_").concat(t)},e.prototype.simpleHash=function(e){for(var t=0,n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n),t|=0}return Math.abs(t).toString(36)},e.prototype.getCachedResult=function(e){var t=this.cache.get(e);return t&&Date.now()-t.timestamp<18e5?(console.log("\u26a1 CACHE HIT: Using cached cards for this text"),t.cards):null},e.prototype.setCachedResult=function(e,t){if(this.cache.size>=10){var n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,{cards:t,timestamp:Date.now()})},e.prototype.executePronunciationAgent=function(e){return Bn(this,void 0,void 0,(function(){var t,r,a,o,i;return Rn(this,(function(l){switch(l.label){case 0:t=e.text,r=e.sourceLanguage,a=e.userLanguage,l.label=1;case 1:return l.trys.push([1,4,,5]),[4,Promise.resolve().then(n.bind(n,75))];case 2:return[4,(0,l.sent().createTranscription)(jn({},this.aiService),this.apiKey,t,r,a)];case 3:return[2,{userLanguageTranscription:(null==(o=l.sent())?void 0:o.userLanguageTranscription)||null,ipaTranscription:(null==o?void 0:o.ipaTranscription)||null}];case 4:return i=l.sent(),console.error("Pronunciation agent failed:",i),[2,{userLanguageTranscription:null,ipaTranscription:null}];case 5:return[2]}}))}))},e.prototype.getLanguageNameWithCache=function(e){var t;return Bn(this,void 0,void 0,(function(){var n,r,a,o,i,l;return Rn(this,(function(s){switch(s.label){case 0:return s.trys.push([0,3,,4]),n="language_name_".concat(e),(r="undefined"!=typeof localStorage?localStorage.getItem(n):null)?[2,r]:this.aiService.createChatCompletion?(a='Return only the native name of the language with ISO 639-1 code "'.concat(e,'".'),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"user",content:a}])]):[3,2];case 1:if(o=s.sent(),i=null===(t=null==o?void 0:o.content)||void 0===t?void 0:t.trim())return"undefined"!=typeof localStorage&&localStorage.setItem(n,i),[2,i];s.label=2;case 2:return[3,4];case 3:return l=s.sent(),console.warn("getLanguageNameWithCache failed, fallback to code:",l),[3,4];case 4:return[2,(e||"").toUpperCase()]}}))}))},e.prototype.generatePronunciationHtml=function(e,t,n){return Bn(this,void 0,void 0,(function(){var r,a,o,i,l,s;return Rn(this,(function(c){switch(c.label){case 0:return e&&t&&n?[4,this.executePronunciationAgent({text:e,sourceLanguage:t,userLanguage:n})]:[2,null];case 1:return r=c.sent(),a=r.userLanguageTranscription,o=r.ipaTranscription,a||o?[4,this.getLanguageNameWithCache(n)]:[2,null];case 2:return i=c.sent(),l=[],a&&l.push('<div class="transcription-item user-lang">\n                    <span class="transcription-label">'.concat(i,':</span>\n                    <span class="transcription-text">').concat(a,"</span>\n                </div>")),o&&(s=o.startsWith("[")?o:"[".concat(o,"]"),l.push('<div class="transcription-item ipa">\n                    <span class="transcription-label">IPA:</span>\n                    <span class="transcription-text">'.concat(s,"</span>\n                </div>"))),[2,l.join("\n")]}}))}))},e.prototype.createCardsFromTextFast=function(e,t,n){var r,a,o;return Bn(this,void 0,void 0,(function(){var i,l,s,c,u,d,p,f,h,g,m;return Rn(this,(function(v){switch(v.label){case 0:return v.trys.push([0,7,,8]),console.log("\u{1f3af} NEW ARCHITECTURE: Multi-agent workflow with parallel processing"),i=this.getCacheKey(e,"multi_agent"),(l=this.getCachedResult(i))?(console.log("\u26a1 CACHE HIT: Returning cached cards instantly"),[2,this.convertToStoredCards(l,e)]):(s=this.buildSimpleMathCard(e,t))?(console.log("\u26a1 SIMPLE MATH PATH: 1 card (title + formula)"),this.setCachedResult(i,[s]),[2,this.convertToStoredCards([s],e)]):(console.log("\u26a1 Trying minimal-requests pipeline (\u22643 requests)..."),[4,this.createCardsWithMax3Requests(e,n)]);case 1:if((c=v.sent())&&c.length>0)return this.setCachedResult(i,c),[2,this.convertToStoredCards(c,e)];if(u={originalText:e,currentStep:"analysis",previousResults:{},metadata:{textLength:e.length,language:this.detectLanguage(e),topic:"",complexity:this.estimateComplexity(e)}},t&&(u.previousResults.pageContext=t,console.log("\u{1f4cb} Page context: ".concat((null===(r=t.pageImages)||void 0===r?void 0:r.length)||0," images, ").concat((null===(a=t.formulas)||void 0===a?void 0:a.length)||0," formulas, ").concat((null===(o=t.codeBlocks)||void 0===o?void 0:o.length)||0," code blocks"))),null==n?void 0:n.aborted)throw new Error("AI card creation was cancelled by user");return console.log("\u{1f9e0} \u0428\u0410\u0413 1: \u0410\u043d\u0430\u043b\u0438\u0437 \u0442\u0435\u043a\u0441\u0442\u0430 \u0438 \u043f\u043b\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a..."),[4,this.executeContentAnalyzer(e,u)];case 2:return(d=v.sent())&&d.questions&&d.questions.length>0?(console.log("\u{1f4cb} \u041f\u043b\u0430\u043d: ".concat(d.questions.length," \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432 \u0434\u043b\u044f \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438")),u.previousResults.analysis=d,console.log("\u{1f504} \u0428\u0410\u0413 2: \u041f\u0430\u0440\u0430\u043b\u043b\u0435\u043b\u044c\u043d\u0430\u044f \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a..."),[4,this.executeParallelCardGeneration(d,u,n)]):(console.log("\u26a0\ufe0f \u0410\u043d\u0430\u043b\u0438\u0437 \u043d\u0435 \u0443\u0434\u0430\u043b\u0441\u044f, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c fallback"),[2,this.createCardsFromTextFallback(e,t,u,n)]);case 3:if(!(p=v.sent())||0===p.length)throw new Error("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438");return console.log("\u2705 \u0428\u0410\u0413 3: \u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0430 \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a..."),[4,this.executeQualityValidation(p,u,n)];case 4:return f=v.sent(),console.log("\u{1f4d0} \u0428\u0410\u0413 4: \u041e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0444\u043e\u0440\u043c\u0443\u043b..."),[4,this.executeMathFormatting(f,u,n)];case 5:return h=v.sent(),console.log("\u{1f3a8} \u0428\u0410\u0413 5: \u041f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u0438 \u0444\u0438\u043d\u0430\u043b\u044c\u043d\u0430\u044f \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430..."),[4,this.applyMultimediaAndFormatting(h,t,u,n)];case 6:return g=v.sent(),console.log("\u{1f389} \u041c\u0423\u041b\u042c\u0422\u0418-\u0410\u0413\u0415\u041d\u0422\u041d\u042b\u0419 WORKFLOW \u0417\u0410\u0412\u0415\u0420\u0428\u0415\u041d: ".concat(g.length," \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a \u0441\u043e\u0437\u0434\u0430\u043d\u043e")),this.setCachedResult(i,g),[2,this.convertToStoredCards(g,e)];case 7:return m=v.sent(),console.error("\u274c Error in multi-agent workflow:",m),[2,this.createCardsFromTextFallback(e,t,void 0,n)];case 8:return[2]}}))}))},e.prototype.buildSimpleMathCard=function(e,t){var n=(e||"").trim();if(!n)return null;var r=n.toLowerCase();if(!(/(\u0442\u0435\u043e\u0440\u0435\u043c|\u0444\u043e\u0440\u043c\u0443\u043b|\u043f\u0440\u0430\u0432\u0438\u043b|lemma|theorem|formula|rule)/i.test(r)||/\$\$|\$|\\frac|\\sqrt|\\tan|\\sin|\\cos|tg|ctg|sin|cos|tan|=/.test(n)||/\([^\n()]+\)\s*\/\s*\([^\n()]+\)/.test(n)))return null;var a=this.quickSanitizeForMath(n),o=this.extractFirstLatexFormula(a);if(!o&&(null==t?void 0:t.formulas)&&t.formulas.length>0){var i=On([],t.formulas,!0).sort((function(e,t){return(t.relevanceScore||0)-(e.relevanceScore||0)}))[0];if(null==i?void 0:i.text){var l=this.extractFirstLatexFormula(this.quickSanitizeForMath(i.text));l&&(o=l)}}return o?{front:this.extractFormulaTitle(n)||"\u0424\u043e\u0440\u043c\u0443\u043b\u0430",back:o,tags:["math"],difficulty:"easy",concept:"formula"}:null},e.prototype.quickSanitizeForMath=function(e){return e.replace(/[\u200B-\u200D\u2060\u2061\uFEFF\u00A0]/g," ").replace(/<annotation[\s\S]*?<\/annotation>/gi,"").replace(/application[^a-zA-Z]*x?[^a-zA-Z]*tex/gi,"").replace(/<[^>]*>/g," ").replace(/https?:\/\/\s*w\s*3\s*\.\s*o\s*r\s*g\s*\/\s*1998\s*\/\s*Math\s*\/\s*MathML/gi,"").replace(/\bw\s*3\s*\.\s*o\s*r\s*g\b/gi,"").replace(/\b1998\s*org\s*\/?/gi,"").replace(/\borg\s*1998\b/gi,"").replace(/\b1998\s*\/\s*Math\s*\/\s*MathML\b/gi,"").replace(/MathMLMath/gi,"").replace(/\bMathML\b/gi,"").replace(/\s+/g," ").trim()},e.prototype.extractFirstLatexFormula=function(e){var t=(0,n(984).processLatexInContent)(e),r=t.match(/\$\$([^$]+)\$\$/);if(r)return"$$".concat(r[1].trim(),"$$");var a=t.match(/(?<!\$)\$([^$\n]+)\$(?!\$)/);if(a)return"$$".concat(a[1].trim(),"$$");var o=t.match(/\(\s*([^()]+?)\s*\)\s*\/\s*\(\s*([^()]+?)\s*\)/);return o?"$$\\frac{".concat(o[1],"}{").concat(o[2],"}$$"):null},e.prototype.extractFormulaTitle=function(e){var t,n=e.split(/\r?\n/).map((function(e){return e.trim()})).filter(Boolean),r=n.join(" ").match(/\b(\u0422\u0435\u043e\u0440\u0435\u043c\u0430|\u0424\u043e\u0440\u043c\u0443\u043b\u0430|\u041f\u0440\u0430\u0432\u0438\u043b\u043e)\s+([^:\n]+)\b/i);if(r)return"".concat(r[1]," ").concat(r[2]).trim();var a=null===(t=n[0])||void 0===t?void 0:t.match(/^([A-Z\u0410-\u042f\u0401][^:]{2,80})/);return a?a[1].trim():null},e.prototype.createCardsWithMax3Requests=function(e,t){return Bn(this,void 0,void 0,(function(){var n,r,a,o,i,l,s,c,u,d,p,f=this;return Rn(this,(function(h){switch(h.label){case 0:if(h.trys.push([0,6,,7]),null==t?void 0:t.aborted)throw new Error("AI card creation was cancelled by user");return n='\u0422\u044b \u2014 \u041a\u041b\u0410\u0421\u0421\u0418\u0424\u0418\u041a\u0410\u0422\u041e\u0420/\u0421\u0415\u0413\u041c\u0415\u041d\u0422\u0410\u0422\u041e\u0420 \u0434\u043b\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a Anki.\n\n\u0417\u0410\u0414\u0410\u0427\u0410:\n1) \u0420\u0430\u0437\u0431\u0435\u0439 \u0442\u0435\u043a\u0441\u0442 \u043d\u0430 \u0430\u0442\u043e\u043c\u0430\u0440\u043d\u044b\u0435 \u0444\u0430\u043a\u0442\u044b (\u043d\u0435 \u0431\u043e\u043b\u0435\u0435 3 \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a \u0441\u0443\u043c\u043c\u0430\u0440\u043d\u043e)\n2) \u0414\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0444\u0430\u043a\u0442\u0430 \u0432\u044b\u0431\u0435\u0440\u0438 \u0442\u0438\u043f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438:\n   - basic: \u043f\u0440\u043e\u0441\u0442\u043e\u0439 \u0432\u043e\u043f\u0440\u043e\u0441-\u043e\u0442\u0432\u0435\u0442 (\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u044f, \u0442\u0435\u0440\u043c\u0438\u043d\u044b, \u0444\u0430\u043a\u0442\u044b)\n   - cloze: \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u0441 \u043f\u0440\u043e\u043f\u0443\u0441\u043a\u0430\u043c\u0438 {{c1::...}}\n   - derivation: \u0448\u0430\u0433\u0438 \u0432\u044b\u0432\u043e\u0434\u0430/\u0434\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c\u0441\u0442\u0432\u0430 (\u043a\u0440\u0430\u0442\u043a\u043e, \u043f\u043e \u043f\u0443\u043d\u043a\u0442\u0430\u043c)\n3) \u0415\u0421\u041b\u0418 \u0415\u0421\u0422\u042c \u041c\u0410\u0422\u0415\u041c\u0410\u0422\u0418\u041a\u0410 \u2014 \u041d\u0415 \u0412\u0421\u0422\u0410\u0412\u041b\u042f\u0419 \u0421\u042b\u0420\u041e\u0419 LaTeX \u0412 \u0422\u0415\u041a\u0421\u0422. \u0412\u041c\u0415\u0421\u0422\u041e \u042d\u0422\u041e\u0413\u041e:\n   - \u0417\u0430\u043c\u0435\u043d\u0438 \u0444\u043e\u0440\u043c\u0443\u043b\u0443 \u043d\u0430 \u043f\u043b\u0435\u0439\u0441\u0445\u043e\u043b\u0434\u0435\u0440 [[F0]], [[F1]], ... \u0432 \u043d\u0443\u0436\u043d\u043e\u043c \u043c\u0435\u0441\u0442\u0435 \u0442\u0435\u043a\u0441\u0442\u0430\n   - \u0412 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e\u043c \u043c\u0430\u0441\u0441\u0438\u0432\u0435 formulas \u0432\u0435\u0440\u043d\u0438 latex \u0438 \u0440\u0435\u0436\u0438\u043c \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f: "inline" | "block"\n4) \u041d\u0415 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u0444\u0440\u0430\u0437\u044b \xab\u043f\u043e \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u043c\u0443 \u0442\u0435\u043a\u0441\u0442\u0443\xbb, \xab\u0432 \u0442\u0435\u043a\u0441\u0442\u0435\xbb \u0438 \u0442.\u043f.\n5) \u041e\u0442\u0432\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u0432 JSON \u043f\u043e \u0441\u0445\u0435\u043c\u0435 \u043d\u0438\u0436\u0435.\n\n\u0412\u0425\u041e\u0414\u041d\u041e\u0419 \u0422\u0415\u041a\u0421\u0422:\n"""\n'.concat(e,'\n"""\n\n\u0424\u041e\u0420\u041c\u0410\u0422 \u041e\u0422\u0412\u0415\u0422\u0410 (JSON):\n{\n  "cards": [\n    {\n      "type": "basic" | "cloze" | "derivation",\n      "front": "\u0441\u0442\u0440\u043e\u043a\u0430 \u0434\u043b\u044f \u043b\u0438\u0446\u0435\u0432\u043e\u0439 \u0441\u0442\u043e\u0440\u043e\u043d\u044b (\u0434\u043b\u044f cloze \u2014 \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u0441 {{c1::...}}). \u041c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u043a\u0430 \u0437\u0430\u043c\u0435\u043d\u0435\u043d\u0430 \u043d\u0430 [[F#]]",\n      "back": "\u043a\u0440\u0430\u0442\u043a\u0438\u0439 \u043e\u0442\u0432\u0435\u0442. \u041c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u043a\u0430 \u0437\u0430\u043c\u0435\u043d\u0435\u043d\u0430 \u043d\u0430 [[F#]]",\n      "tags": ["auto"],\n      "difficulty": "easy" | "medium" | "hard"\n    }\n  ],\n  "formulas": [\n    { "id": "F0", "latex": "m_{a}^{2} + m_{b}^{2}", "display": "inline" },\n    { "id": "F1", "latex": "g = \\frac{(d-1)(d-2)}{2} - s", "display": "block" }\n  ]\n}'),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:"\u0422\u044b \u0433\u0435\u043d\u0435\u0440\u0438\u0440\u0443\u0435\u0448\u044c \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u0431\u044b\u0441\u0442\u0440\u043e \u0438 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e. \u0424\u043e\u0440\u043c\u0443\u043b\u044b \u2014 \u0442\u043e\u043b\u044c\u043a\u043e \u0432\u0430\u043b\u0438\u0434\u043d\u044b\u0439 LaTeX \u0441 $ \u0438\u043b\u0438 $$."},{role:"user",content:n}])];case 1:if(!(null==(r=h.sent())?void 0:r.content))return[2,[]];if(a=this.parseJSONResponse(r.content,"classifierSegmenter"),o={},Array.isArray(null==a?void 0:a.formulas))for(i=0,l=a.formulas;i<l.length;i++)(s=l[i])&&"string"==typeof s.id&&"string"==typeof s.latex&&(c="inline"===s.display?"inline":"block",o[s.id]={latex:s.latex,display:c});if(u=Array.isArray(null==a?void 0:a.cards)?a.cards.slice(0,3).map((function(e){return{front:f.injectFormulas(String(e.front||""),o),back:f.injectFormulas(String(e.back||""),o),tags:Array.isArray(e.tags)?e.tags:["auto"],difficulty:e.difficulty||"medium",concept:e.type||"basic"}})):[],d=e.toLowerCase(),0===(u=u.filter((function(e){var t=f.checkTextRelation((e.front+" "+e.back).toLowerCase(),d),n=!f.checkTautology(e.front,e.back),r=f.checkEducationalValue(e.front,e.back);return t&&n&&r}))).length)return[2,[]];h.label=2;case 2:return h.trys.push([2,4,,5]),[4,this.processLatexInCards(u)];case 3:return[2,h.sent()];case 4:return h.sent(),console.warn("KaTeX post-processing failed, returning raw cards"),[2,u];case 5:return[3,7];case 6:return p=h.sent(),console.warn("Minimal-requests pipeline failed:",p),[2,[]];case 7:return[2]}}))}))},e.prototype.injectFormulas=function(e,t){var n=e.replace(/\\n/g,"\n");return n=n.replace(/\[\[F(\d+)\]\]/g,(function(e,n){var r="F".concat(n),a=t[r];if(!a)return e;var o=a.latex.replace(/\\{2,}([A-Za-z]+)/g,"\\$1").replace(/\|/g," \\mid ");return"inline"===a.display?"$".concat(o,"$"):"$$".concat(o,"$$")}))},e.prototype.executeFastCombinedProcess=function(e,t,n,r){var a,o,i,l,s;return Bn(this,void 0,void 0,(function(){var r,c,u,d,p,f;return Rn(this,(function(h){switch(h.label){case 0:r=t&&((null===(a=t.pageImages)||void 0===a?void 0:a.length)>0||(null===(o=t.formulas)||void 0===o?void 0:o.length)>0||(null===(i=t.codeBlocks)||void 0===i?void 0:i.length)>0),c=null===(l=n.previousResults)||void 0===l?void 0:l.mathContent,u='\u0422\u044b - \u0413\u0415\u041d\u0415\u0420\u0410\u0422\u041e\u0420 \u041a\u0410\u0420\u0422\u041e\u0427\u0415\u041a. \u0421\u043e\u0437\u0434\u0430\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u0442\u0435\u043a\u0441\u0442\u0430:\n\n\u0422\u0415\u041a\u0421\u0422: "'.concat(e,'"\n\n').concat(c?"\u041c\u0410\u0422\u0415\u041c\u0410\u0422\u0418\u0427\u0415\u0421\u041a\u0418\u0419 \u041a\u041e\u041d\u0422\u0415\u041d\u0422: \u041e\u0411\u0420\u0410\u0411\u041e\u0422\u0410\u041d (\u0444\u043e\u0440\u043c\u0443\u043b\u044b \u0431\u0443\u0434\u0443\u0442 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u044b \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e)":"\u041c\u0410\u0422\u0415\u041c\u0410\u0422\u0418\u0427\u0415\u0421\u041a\u041e\u0413\u041e \u041a\u041e\u041d\u0422\u0415\u041d\u0422\u0410: \u043d\u0435\u0442","\n").concat(r?"\u0418\u0417\u041e\u0411\u0420\u0410\u0416\u0415\u041d\u0418\u042f: ".concat((null===(s=null==t?void 0:t.pageImages)||void 0===s?void 0:s.length)||0," \u0448\u0442"):"\u0418\u0417\u041e\u0411\u0420\u0410\u0416\u0415\u041d\u0418\u0419: \u043d\u0435\u0442",'\n\n\u0421\u0422\u0420\u041e\u0413\u0418\u0415 \u041f\u0420\u0410\u0412\u0418\u041b\u0410:\n1. \u0421\u043e\u0437\u0434\u0430\u0432\u0430\u0439 \u0432\u043e\u043f\u0440\u043e\u0441\u044b, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u041d\u0415 \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442 \u0444\u0440\u0430\u0437 \u0442\u0438\u043f\u0430 "\u043f\u043e \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u043c\u0443 \u0442\u0435\u043a\u0441\u0442\u0443", "\u0432 \u0442\u0435\u043a\u0441\u0442\u0435", "\u043a\u0430\u043a \u0443\u043a\u0430\u0437\u0430\u043d\u043e"\n2. \u0412\u043e\u043f\u0440\u043e\u0441\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c \u0435\u0441\u0442\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u043c\u0438 \u0438 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u043c\u0438\n3. \u041d\u0415 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0439 \u043b\u0438\u0448\u043d\u0438\u0435 \u0441\u043b\u043e\u0432\u0430 - \u0432\u043e\u043f\u0440\u043e\u0441 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u043f\u0440\u044f\u043c\u044b\u043c\n4. \u041c\u0430\u043a\u0441\u0438\u043c\u0443\u043c 3 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438\n5. \u0424\u043e\u043a\u0443\u0441 \u043d\u0430 \u043f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u0438, \u0430 \u043d\u0435 \u043d\u0430 \u043c\u0435\u0445\u0430\u043d\u0438\u0447\u0435\u0441\u043a\u043e\u043c \u0437\u0430\u043f\u043e\u043c\u0438\u043d\u0430\u043d\u0438\u0438\n6. \u041d\u0415 \u0432\u043a\u043b\u044e\u0447\u0430\u0439 \u0441\u044b\u0440\u044b\u0435 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b \u0432 \u0442\u0435\u043a\u0441\u0442 - \u043e\u043d\u0438 \u0431\u0443\u0434\u0443\u0442 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u044b \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e\n\n\u041f\u041b\u041e\u0425\u0418\u0415 \u041f\u0420\u0418\u041c\u0415\u0420\u042b (\u041d\u0415 \u0414\u0415\u041b\u0410\u0422\u042c):\n\u274c "\u041a\u0430\u043a \u043f\u043e \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u043c\u0443 \u0442\u0435\u043a\u0441\u0442\u0443 \u0432\u044b\u0447\u0438\u0441\u043b\u0438\u0442\u044c..."\n\u274c "\u0427\u0442\u043e \u0433\u043e\u0432\u043e\u0440\u0438\u0442\u0441\u044f \u0432 \u0442\u0435\u043a\u0441\u0442\u0435 \u043e..."\n\u274c "\u041a\u0430\u043a\u0430\u044f \u0444\u043e\u0440\u043c\u0443\u043b\u0430 \u043f\u0440\u0438\u0432\u0435\u0434\u0435\u043d\u0430..."\n\u274c \u0412\u0441\u0442\u0430\u0432\u043a\u0430 \u0441\u044b\u0440\u044b\u0445 \u0444\u043e\u0440\u043c\u0443\u043b \u0442\u0438\u043f\u0430 "m_a^2 + m_b^2 + m_c^2 = 3/4 S"\n\n\u0425\u041e\u0420\u041e\u0428\u0418\u0415 \u041f\u0420\u0418\u041c\u0415\u0420\u042b:\n\u2705 "\u041a\u0430\u043a \u0432\u044b\u0447\u0438\u0441\u043b\u0438\u0442\u044c \u0441\u0443\u043c\u043c\u0443 \u043a\u0432\u0430\u0434\u0440\u0430\u0442\u043e\u0432 \u043c\u0435\u0434\u0438\u0430\u043d \u0442\u0440\u0435\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\u0430?"\n\u2705 "\u041a\u0430\u043a\u0438\u0435 \u0441\u0442\u043e\u0440\u043e\u043d\u044b \u0442\u0440\u0435\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\u0430 \u0441\u0432\u044f\u0437\u0430\u043d\u044b \u0441 \u043c\u0435\u0434\u0438\u0430\u043d\u0430\u043c\u0438?"\n\u2705 "\u0427\u0442\u043e \u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442 \u0441\u043e\u043e\u0442\u043d\u043e\u0448\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u043c\u0435\u0434\u0438\u0430\u043d \u0432 \u0442\u0440\u0435\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\u0435?"\n\u2705 \u041e\u043f\u0438\u0441\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u0432\u043e\u043f\u0440\u043e\u0441\u044b \u0431\u0435\u0437 \u0441\u044b\u0440\u044b\u0445 \u0444\u043e\u0440\u043c\u0443\u043b\n\nJSON:\n{\n  "cards": [\n    {\n      "front": "\u041f\u0440\u044f\u043c\u043e\u0439 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0439 \u0432\u043e\u043f\u0440\u043e\u0441 \u0431\u0435\u0437 \u043b\u0438\u0448\u043d\u0438\u0445 \u0441\u043b\u043e\u0432",\n      "back": "\u041f\u043e\u043b\u043d\u044b\u0439 \u043e\u0442\u0432\u0435\u0442 \u0441 \u043e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u0435\u043c (\u0444\u043e\u0440\u043c\u0443\u043b\u044b \u0431\u0443\u0434\u0443\u0442 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u044b \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e)",\n      "difficulty": "medium",\n      "concept": "\u041e\u0441\u043d\u043e\u0432\u043d\u0430\u044f \u0442\u0435\u043c\u0430",\n      "tags": ["\u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0439_\u0442\u0435\u043a\u0441\u0442"]\n    }\n  ]\n}'),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:"\u0422\u044b - \u0431\u044b\u0441\u0442\u0440\u044b\u0439 \u0433\u0435\u043d\u0435\u0440\u0430\u0442\u043e\u0440 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0445 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a. \u0424\u043e\u043a\u0443\u0441 \u043d\u0430 \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u0438 \u0438 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435."},{role:"user",content:u}])];case 2:if(!(null==(d=h.sent())?void 0:d.content))throw new Error("No response from fast process");if(!(p=this.parseJSONResponse(d.content,"fastCombined")).cards||!Array.isArray(p.cards)||0===p.cards.length)throw new Error("No cards generated");return console.log("\u26a1 FAST: Generated ".concat(p.cards.length," cards in single API call")),[2,p];case 3:return f=h.sent(),console.error("Fast combined process error:",f),[2,this.createFallbackCardsSimple(e)];case 4:return[2]}}))}))},e.prototype.executeFastQualityValidation=function(e,t,n){var r;return Bn(this,void 0,void 0,(function(){var n,a,o=this;return Rn(this,(function(i){return n=(null===(r=t.originalText)||void 0===r?void 0:r.toLowerCase())||"",a=e.filter((function(e){var t=(e.front+" "+e.back).toLowerCase();return o.checkTextRelation(t,n)?o.checkTautology(e.front,e.back)?(console.log("\u274c \u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u043e\u0442\u043a\u043b\u043e\u043d\u0435\u043d\u0430: \u0442\u0430\u0432\u0442\u043e\u043b\u043e\u0433\u0438\u044f",e.front),!1):!!o.checkEducationalValue(e.front,e.back)||(console.log("\u274c \u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u043e\u0442\u043a\u043b\u043e\u043d\u0435\u043d\u0430: \u043d\u0435\u0442 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0439 \u0446\u0435\u043d\u043d\u043e\u0441\u0442\u0438",e.front),!1):(console.log("\u274c \u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u043e\u0442\u043a\u043b\u043e\u043d\u0435\u043d\u0430: \u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u043c\u0443 \u0442\u0435\u043a\u0441\u0442\u0443",e.front),!1)})),console.log("\u26a1 FAST Quality: ".concat(a.length,"/").concat(e.length," cards passed validation")),[2,a.length>0?a:e]}))}))},e.prototype.checkTextRelation=function(e,t){var n=t.split(/\s+/).filter((function(e){return e.length>2})),r=e.split(/\s+/).filter((function(e){return e.length>2})),a=n.filter((function(e){return r.some((function(t){return t.includes(e)||e.includes(t)}))})).length>=2,o=n.some((function(t){return t.length>5&&e.includes(t)}));return a||o},e.prototype.checkTautology=function(e,t){var n=e.toLowerCase().split(/\s+/).filter((function(e){return e.length>2})),r=t.toLowerCase().split(/\s+/).filter((function(e){return e.length>2}));return n.filter((function(e){return r.some((function(t){return t.includes(e)&&e!==t}))})).length>.3*n.length},e.prototype.checkEducationalValue=function(e,t){var n,r=e.trim().length;if(t.trim().length<1.5*r)return!1;for(var a=e.toLowerCase(),o=0,i=["\u043f\u043e \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u043c\u0443 \u0442\u0435\u043a\u0441\u0442\u0443","\u0432 \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u043c \u0442\u0435\u043a\u0441\u0442\u0435","\u043a\u0430\u043a \u0443\u043a\u0430\u0437\u0430\u043d\u043e","\u0447\u0442\u043e \u0433\u043e\u0432\u043e\u0440\u0438\u0442\u0441\u044f","\u043a\u0430\u043a\u0430\u044f \u0444\u043e\u0440\u043c\u0443\u043b\u0430 \u043f\u0440\u0438\u0432\u0435\u0434\u0435\u043d\u0430","\u0447\u0442\u043e \u0432\u0430\u0436\u043d\u043e \u0432 \u044d\u0442\u043e\u043c","\u043a\u0430\u043a\u043e\u0439 \u043a\u043b\u044e\u0447\u0435\u0432\u043e\u0439 \u043c\u043e\u043c\u0435\u043d\u0442 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442\u0441\u044f"];o<i.length;o++){var l=i[o];if(a.includes(l))return console.log('\u274c \u0417\u0430\u043f\u0440\u0435\u0449\u0435\u043d\u043d\u0430\u044f \u0444\u0440\u0430\u0437\u0430 \u0432 \u0432\u043e\u043f\u0440\u043e\u0441\u0435: "'.concat(l,'"')),!1}var s=e.toLowerCase(),c=t.toLowerCase();if(s.includes("\u0447\u0442\u043e \u0442\u0430\u043a\u043e\u0435")&&c.includes("\u044d\u0442\u043e")){var u=null===(n=s.split("\u0447\u0442\u043e \u0442\u0430\u043a\u043e\u0435")[1])||void 0===n?void 0:n.trim();if(u&&c.includes(u.split(" ")[0]))return!1}return!0},e.prototype.applyMultimediaFast=function(e,t,n){var r,a,o=this;return console.log("\u{1f3a8} \u041f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430: ".concat((null===(r=null==t?void 0:t.pageImages)||void 0===r?void 0:r.length)||0," \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0439 \u0434\u043b\u044f ").concat(e.length," \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a")),console.log("\u{1f4d0} \u041c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b: ".concat((null===(a=null==n?void 0:n.formulas)||void 0===a?void 0:a.length)||0," \u0448\u0442")),e.map((function(e,r){var a,i,l=jn({},e);if(null===(a=null==t?void 0:t.pageImages)||void 0===a?void 0:a.length){var s=t.pageImages,c=o.findRelevantImagesForCard(e,s);if(c.length>0){var u=c[0];console.log("\u{1f5bc}\ufe0f \u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 ".concat(r+1,": ").concat(c.length," \u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u044b\u0445 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0439")),l=jn(jn({},l),{attachedImages:c,image:u.base64||null,imageUrl:u.src||null})}}return(null===(i=null==n?void 0:n.formulas)||void 0===i?void 0:i.length)&&(l=o.applyFormulasToCard(l,n.formulas),console.log("\u{1f4d0} \u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 ".concat(r+1,": \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u044b \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b"))),l}))},e.prototype.applyFormulasToCard=function(e,t){var n=this,r=e.back;return r=this.processRawFormulasInText(r),t.forEach((function(e,t){["[MATH:".concat(e.original,"][/MATH]"),"[MATH:inline:".concat(e.original,"][/MATH]"),"[MATH:example:".concat(e.original,"][/MATH]")].forEach((function(t){if(r.includes(t)){if(n.hasFormulaDuplicate(r,e))return console.log("\u26a0\ufe0f \u041f\u0440\u043e\u043f\u0443\u0441\u043a\u0430\u0435\u043c \u0434\u0443\u0431\u043b\u0438\u0440\u0443\u044e\u0449\u0443\u044e\u0441\u044f \u0444\u043e\u0440\u043c\u0443\u043b\u0443 ".concat(t)),void(r=r.replace(t,""));var a="block";t.includes("inline:")?a="inline":t.includes("example:")&&(a="example");var o=n.createLatexFormula(e,a);r=r.replace(t,o),console.log("\u{1f504} \u0417\u0430\u043c\u0435\u043d\u0430 ".concat(t," \u043d\u0430 LaTeX \u0444\u043e\u0440\u043c\u0443\u043b\u0443 \u0432 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0435"))}}))})),jn(jn({},e),{back:r})},e.prototype.createLatexFormula=function(e,t){var n=e.latex;switch(t){case"inline":return"$".concat(n,"$");case"example":return'<div style="border: 2px solid #3B82F6; border-radius: 8px; padding: 12px; margin: 8px 0; background: #F0F9FF;">$$'.concat(n,"$$</div>");default:return"$$".concat(n,"$$")}},e.prototype.hasFormulaDuplicate=function(e,t){var n=e.toLowerCase(),r=(t.original||"").toLowerCase();if(r&&n.includes(r))return!0;var a=t.latex.toLowerCase().split(/[^a-zA-Z0-9]/).filter((function(e){return e.length>2})),o=0;return a.forEach((function(e){n.includes(e)&&o++})),o>.5*a.length},e.prototype.processRawFormulasInText=function(e){var t=this,n=e;return n=(n=(n=(n=n.replace(/\(\$\s*([^$]+)\s*\$\)/g,(function(e,t){return"$$".concat(t,"$$")}))).replace(/\$\$\s*([^$]+)\s*\$\$/g,(function(e,t){return"$$".concat(t,"$$")}))).replace(/\(\$\$\s*([^$]+)\s*\$\$\)/g,(function(e,n){var r=t.fixFormulaErrors(n);return"$$".concat(r,"$$")}))).replace(/\$\$\s*([^$]+?)\s*\$\$/g,(function(e,n){var r=t.fixFormulaErrors(n);return"$$".concat(r,"$$")})),console.log("\u{1f527} Processed raw formulas in text"),n},e.prototype.fixFormulaErrors=function(e){var t=e;return t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/1\^{2}/g,"a^{2}")).replace(/2\^{2}/g,"b^{2}")).replace(/3\^{2}/g,"c^{2}")).replace(/\\\(/g,"(")).replace(/\\\)/g,")")).replace(/m_a/g,"m_{a}")).replace(/m_b/g,"m_{b}")).replace(/m_c/g,"m_{c}")).replace(/\\frac\s*\{\s*3\s*\}\s*\{\s*4\s*\}/g,"\\frac{3}{4}")).replace(/\\\(\s*\\frac\s*\{\s*3\s*\}\s*\{\s*4\s*\}\s*\\\)/g,"\\frac{3}{4}"),console.log('\u{1f527} Fixed formula: "'.concat(e,'" \u2192 "').concat(t,'"')),t},e.prototype.findRelevantImagesForCard=function(e,t){var n=this,r=(e.front+" "+e.back+" "+(e.concept||"")).toLowerCase(),a=r.split(/\s+/).filter((function(e){return e.length>2})),o=t.filter((function(e){var t=(e.alt||"").toLowerCase(),n=(e.title||"").toLowerCase(),a=["\u0444\u043e\u0440\u043c\u0443\u043b\u0430","\u0442\u0435\u043e\u0440\u0435\u043c\u0430","\u0434\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c\u0441\u0442\u0432\u043e","\u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u043a\u0430","\u0430\u043b\u0433\u0435\u0431\u0440\u0430","\u0433\u0435\u043e\u043c\u0435\u0442\u0440\u0438\u044f"].some((function(e){return t.includes(e)||n.includes(e)})),o=r.includes("\u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u043a")||r.includes("\u0444\u043e\u0440\u043c\u0443\u043b")||r.includes("\u0442\u0435\u043e\u0440\u0435\u043c")||r.includes("\u0434\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c\u0441\u0442\u0432");return!(a&&!o)||(console.log("\u26a0\ufe0f \u0418\u0441\u043a\u043b\u044e\u0447\u0430\u0435\u043c \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u043d\u0435\u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438: ".concat(t)),!1)})).map((function(e){var t=(e.alt||"").toLowerCase(),o=(e.title||"").toLowerCase(),i=0,l=0;return a.forEach((function(e){t.includes(e)&&(i+=3,l++),o.includes(e)&&(i+=2,l++)})),n.extractKeyTerms(r).forEach((function(e){t.includes(e.toLowerCase())&&(i+=5,l++)})),i+=2*(e.relevanceScore||0),e.isNearText&&(i+=2),(t.length<10||t.includes("\u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435")||t.includes("\u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0430"))&&(i-=2),{image:e,score:i,matches:l}})).filter((function(e){return e.score>3})).sort((function(e,t){return t.score-e.score})).slice(0,1).map((function(e){return e.image}));return o.length>0&&console.log("\u{1f5bc}\ufe0f \u041d\u0430\u0439\u0434\u0435\u043d\u043e ".concat(o.length," \u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u043e\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438")),o},e.prototype.extractKeyTerms=function(e){for(var t=e.split(/\s+/),n=[],r=0;r<t.length;r++){var a=t[r].toLowerCase();if(!(a.length<4)&&(!["\u0447\u0442\u043e","\u043a\u0430\u043a","\u0434\u043b\u044f","\u044d\u0442\u043e","\u043f\u0440\u0438","\u0434\u043b\u044f","\u0438\u043b\u0438","\u0438\u0437","\u043d\u0430","\u043f\u043e","\u043e\u0442","\u0434\u043e"].includes(a)&&(n.includes(a)||n.push(a),r<t.length-1))){var o=t[r+1].toLowerCase();if(o.length>2&&!["\u0438","\u0430","\u043d\u043e","\u0438\u043b\u0438","\u0438\u0437","\u043d\u0430","\u043f\u043e","\u043e\u0442","\u0434\u043e"].includes(o)){var i="".concat(a," ").concat(o);i.length>6&&!n.includes(i)&&n.push(i)}}}return n.slice(0,5)},e.prototype.createFallbackCardsSimple=function(e){var t=[],n=e.split(/[.!?]+/).filter((function(e){return e.trim().length>10}));if(n.length>0){var r=n[0].trim();r.length>20&&t.push({front:"\u041a\u0430\u043a\u043e\u0439 \u043a\u043b\u044e\u0447\u0435\u0432\u043e\u0439 \u043c\u043e\u043c\u0435\u043d\u0442 \u0437\u0434\u0435\u0441\u044c \u0432\u0430\u0436\u0435\u043d?",back:r,difficulty:"medium",concept:"\u041a\u043b\u044e\u0447\u0435\u0432\u043e\u0439 \u043c\u043e\u043c\u0435\u043d\u0442",tags:["\u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0439_\u0442\u0435\u043a\u0441\u0442"]})}if(n.length>1){var a=n[1].trim();a.length>20&&a!==n[0].trim()&&t.push({front:"\u0427\u0442\u043e \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0432\u0430\u0436\u043d\u044b\u043c \u0441\u043b\u0435\u0434\u0441\u0442\u0432\u0438\u0435\u043c?",back:a,difficulty:"medium",concept:"\u0421\u0432\u044f\u0437\u044c \u0438\u0434\u0435\u0439",tags:["\u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0439_\u0442\u0435\u043a\u0441\u0442"]})}return 0===t.length&&t.push({front:"\u0427\u0442\u043e \u0437\u0434\u0435\u0441\u044c \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0441\u0430\u043c\u044b\u043c \u0432\u0430\u0436\u043d\u044b\u043c?",back:e.substring(0,200)+(e.length>200?"...":""),difficulty:"medium",concept:"\u0412\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0439 \u043a\u043e\u043d\u0442\u0435\u043d\u0442",tags:["\u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0439_\u0442\u0435\u043a\u0441\u0442"]}),console.log("\u26a0\ufe0f Fallback: \u0441\u043e\u0437\u0434\u0430\u043d\u044b ".concat(t.length," \u043f\u0440\u043e\u0441\u0442\u044b\u0435 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u0438\u0437 \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u0442\u0435\u043a\u0441\u0442\u0430")),{cards:t,analysis:{mainTopic:"\u0412\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0439 \u0442\u0435\u043a\u0441\u0442",complexity:"medium",estimatedCards:t.length,hasMultimedia:!1}}},e.prototype.executeSupervisor=function(e,t){return Bn(this,void 0,void 0,(function(){var n,r,a;return Rn(this,(function(o){switch(o.label){case 0:n='\u0422\u044b - Supervisor AI Agent. \u041f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 \u0442\u0435\u043a\u0441\u0442 \u0438 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438 \u043e\u043f\u0442\u0438\u043c\u0430\u043b\u044c\u043d\u0443\u044e \u0441\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u044e \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a.\n\n\u0422\u0415\u041a\u0421\u0422: "'.concat(e,'"\n\n\u041a\u041e\u041d\u0422\u0415\u041a\u0421\u0422:\n- \u0414\u043b\u0438\u043d\u0430: ').concat(t.metadata.textLength," \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432\n- \u0421\u043b\u043e\u0436\u043d\u043e\u0441\u0442\u044c: ").concat(t.metadata.complexity,"\n- \u042f\u0437\u044b\u043a: ").concat(t.metadata.language,'\n\n\u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n1. \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0438 \u0441\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u044e \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f (single_concept, multiple_concepts, step_by_step, comparison)\n2. \u0420\u0435\u0448\u0438 \u043a\u0430\u043a\u0438\u0435 \u0430\u0433\u0435\u043d\u0442\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u0438 \u043a\u0430\u043a\n3. \u0414\u0430\u0439 \u0447\u0435\u0442\u043a\u0438\u0435 \u0438\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u0438 \u043a\u0430\u0436\u0434\u043e\u043c\u0443 \u0430\u0433\u0435\u043d\u0442\u0443\n4. \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0438 \u043e\u0436\u0438\u0434\u0430\u0435\u043c\u044b\u0439 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\n\n\u0421\u0422\u0420\u0410\u0422\u0415\u0413\u0418\u0418:\n- single_concept: \u043e\u0434\u0438\u043d \u043a\u043b\u044e\u0447\u0435\u0432\u043e\u0439 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\n- multiple_concepts: \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043d\u0435\u0437\u0430\u0432\u0438\u0441\u0438\u043c\u044b\u0445 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u043e\u0432  \n- step_by_step: \u043f\u043e\u0448\u0430\u0433\u043e\u0432\u044b\u0439 \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u0438\u043b\u0438 \u0430\u043b\u0433\u043e\u0440\u0438\u0442\u043c\n- comparison: \u0441\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u0435 \u0438\u043b\u0438 \u043f\u0440\u043e\u0442\u0438\u0432\u043e\u043f\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0435\n\nJSON \u043e\u0442\u0432\u0435\u0442:\n{\n  "strategy": "step_by_step",\n  "agents": ["contentAnalyzer", "cardGenerator", "questionQuality", "validator"],\n  "instructions": {\n    "contentAnalyzer": "\u0412\u044b\u0434\u0435\u043b\u0438 \u043e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0448\u0430\u0433\u0438 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \u0438 \u0438\u0445 \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c",\n    "cardGenerator": "\u0421\u043e\u0437\u0434\u0430\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0448\u0430\u0433\u0430 \u0441 \u0430\u043a\u0446\u0435\u043d\u0442\u043e\u043c \u043d\u0430 \u043f\u0440\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u0435",\n    "questionQuality": "\u041f\u0440\u043e\u0432\u0435\u0440\u044c \u0447\u0442\u043e \u043a\u0430\u0436\u0434\u044b\u0439 \u0432\u043e\u043f\u0440\u043e\u0441 \u043f\u043e\u043c\u043e\u0433\u0430\u0435\u0442 \u043f\u043e\u043d\u044f\u0442\u044c \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0439",\n    "validator": "\u0423\u0431\u0435\u0434\u0438\u0441\u044c \u0447\u0442\u043e \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u043e\u0431\u0440\u0430\u0437\u0443\u044e\u0442 \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f"\n  },\n  "expectedOutput": "\u041d\u0430\u0431\u043e\u0440 \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a \u043f\u043e\u043a\u0440\u044b\u0432\u0430\u044e\u0449\u0438\u0445 \u043f\u043e\u0448\u0430\u0433\u043e\u0432\u044b\u0439 \u043f\u0440\u043e\u0446\u0435\u0441\u0441",\n  "reasoning": "\u0422\u0435\u043a\u0441\u0442 \u043e\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u0442 \u043f\u0440\u043e\u0446\u0435\u0434\u0443\u0440\u0443, \u043b\u0443\u0447\u0448\u0435 \u0438\u0437\u0443\u0447\u0430\u0442\u044c \u043f\u043e \u0448\u0430\u0433\u0430\u043c"\n}'),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.supervisor.systemPrompt},{role:"user",content:n}])];case 2:if(!(null==(r=o.sent())?void 0:r.content))throw new Error("No response from supervisor agent");return[2,this.parseJSONResponse(r.content,"supervisor")];case 3:return a=o.sent(),console.error("Supervisor agent error:",a),[2,this.createFallbackSupervisorDecision()];case 4:return[2]}}))}))},e.prototype.executeCardGenerator=function(e,t){var n,r,a,o;return Bn(this,void 0,void 0,(function(){var t,i,l,s,c,u,d,p;return Rn(this,(function(f){switch(f.label){case 0:t=e.text,i=e.cardPlan,l=e.textAnalysis,e.multimediaDistribution,s=e.analysis,c=e.instructions,u=i&&l?'\u0422\u044b - Card Generator Agent. \u0421\u043e\u0437\u0434\u0430\u0439 \u0432\u044b\u0441\u043e\u043a\u043e\u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0435 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u0422\u041e\u0427\u041d\u041e \u043f\u043e \u043f\u043b\u0430\u043d\u0443.\n\n\u0422\u0415\u041a\u0421\u0422: "'.concat(t,'"\n\n\u0410\u041d\u0410\u041b\u0418\u0417 \u0422\u0415\u041a\u0421\u0422\u0410:\n- \u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0442\u0435\u043c\u044b: ').concat(l.mainTopics.map((function(e){return e.name})).join(", "),"\n- \u0420\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u043c\u044b\u0435 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438: ").concat(l.estimatedCards,"\n- \u0421\u043b\u043e\u0436\u043d\u043e\u0441\u0442\u044c: ").concat(l.complexity,"\n- \u041c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u043e: ").concat(l.hasMultimedia?"\u0414\u0410":"\u041d\u0415\u0422","\n\n\u041f\u041b\u0410\u041d \u041a\u0410\u0420\u0422\u041e\u0427\u0415\u041a (\u0421\u041b\u0415\u0414\u0423\u0419 \u0422\u041e\u0427\u041d\u041e):\n").concat(i.cardSpecs.map((function(e,t){return"\n\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 ".concat(t+1," (").concat(e.id,"):\n- \u0422\u0438\u043f: ").concat(e.type,"\n- \u0422\u0435\u043c\u0430: ").concat(e.topic,"\n- \u041f\u0440\u0438\u043e\u0440\u0438\u0442\u0435\u0442: ").concat(e.priority,"\n- \u0421\u043b\u043e\u0436\u043d\u043e\u0441\u0442\u044c: ").concat(e.difficulty,"\n- \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435: ").concat(e.description,"\n- \u041d\u0443\u0436\u0435\u043d \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430: ").concat(e.needsMultimedia?"\u0414\u0410":"\u041d\u0415\u0422","\n")})).join(""),'\n\n\u041a\u0420\u0418\u0422\u0418\u0427\u0415\u0421\u041a\u0418\u0415 \u0422\u0420\u0415\u0411\u041e\u0412\u0410\u041d\u0418\u042f \u041a \u041a\u0410\u0427\u0415\u0421\u0422\u0412\u0423:\n1. \u041d\u0418\u041a\u041e\u0413\u0414\u0410 \u041d\u0415 \u0414\u0423\u0411\u041b\u0418\u0420\u0423\u0419 \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u0441\u043b\u043e\u0432\u0430 \u0438\u0437 \u0432\u043e\u043f\u0440\u043e\u0441\u0430 \u0432 \u043e\u0442\u0432\u0435\u0442\u0435\n2. \u0412\u043e\u043f\u0440\u043e\u0441\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u041f\u041e\u041d\u0418\u041c\u0410\u041d\u0418\u0415, \u043d\u0435 \u043f\u0430\u043c\u044f\u0442\u044c\n3. \u041e\u0442\u0432\u0435\u0442\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c \u0418\u041d\u0424\u041e\u0420\u041c\u0410\u0422\u0418\u0412\u041d\u042b\u041c\u0418 \u0438 \u041e\u0411\u0423\u0427\u0410\u042e\u0429\u0418\u041c\u0418\n4. \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0439 \u041a\u041e\u041d\u0422\u0415\u041a\u0421\u0422 \u0438 \u041e\u0411\u042a\u042f\u0421\u041d\u0415\u041d\u0418\u042f\n5. \u0418\u0437\u0431\u0435\u0433\u0430\u0439 \u041e\u0427\u0415\u0412\u0418\u0414\u041d\u042b\u0425 \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432\n\n\u041f\u041b\u041e\u0425\u0418\u0415 \u041f\u0420\u0418\u041c\u0415\u0420\u042b (\u041d\u0415 \u0414\u0415\u041b\u0410\u0419 \u0422\u0410\u041a):\n\u274c "\u0427\u0442\u043e \u0442\u0430\u043a\u043e\u0435 \u043b\u0435\u0432?" \u2192 "\u041b\u0435\u0432 - \u044d\u0442\u043e \u043b\u0435\u0432"\n\u274c "\u041a\u0430\u043a\u043e\u0439 \u0432\u0438\u0434 \u043c\u043b\u0435\u043a\u043e\u043f\u0438\u0442\u0430\u044e\u0449\u0438\u0445 \u043b\u0435\u0432?" \u2192 "\u041b\u0435\u0432 - \u0432\u0438\u0434 \u0445\u0438\u0449\u043d\u044b\u0445 \u043c\u043b\u0435\u043a\u043e\u043f\u0438\u0442\u0430\u044e\u0449\u0438\u0445"\n\u274c "\u0413\u0434\u0435 \u0436\u0438\u0432\u0443\u0442 \u043b\u044c\u0432\u044b?" \u2192 "\u041b\u044c\u0432\u044b \u0436\u0438\u0432\u0443\u0442 \u0432 \u0410\u0444\u0440\u0438\u043a\u0435"\n\n\u0425\u041e\u0420\u041e\u0428\u0418\u0415 \u041f\u0420\u0418\u041c\u0415\u0420\u042b:\n\u2705 "\u041f\u043e\u0447\u0435\u043c\u0443 \u043b\u044c\u0432\u044b \u0435\u0434\u0438\u043d\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0435 \u0441\u043e\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0435 \u0431\u043e\u043b\u044c\u0448\u0438\u0435 \u043a\u043e\u0448\u043a\u0438?" \u2192 "\u041b\u044c\u0432\u044b \u0436\u0438\u0432\u0443\u0442 \u043f\u0440\u0430\u0439\u0434\u0430\u043c\u0438 \u0434\u043b\u044f \u0441\u043e\u0432\u043c\u0435\u0441\u0442\u043d\u043e\u0439 \u043e\u0445\u043e\u0442\u044b \u043d\u0430 \u043a\u0440\u0443\u043f\u043d\u0443\u044e \u0434\u043e\u0431\u044b\u0447\u0443, \u0437\u0430\u0449\u0438\u0442\u044b \u0442\u0435\u0440\u0440\u0438\u0442\u043e\u0440\u0438\u0438 \u0438 \u0432\u043e\u0441\u043f\u0438\u0442\u0430\u043d\u0438\u044f \u043f\u043e\u0442\u043e\u043c\u0441\u0442\u0432\u0430. \u0414\u0440\u0443\u0433\u0438\u0435 \u0431\u043e\u043b\u044c\u0448\u0438\u0435 \u043a\u043e\u0448\u043a\u0438 (\u0442\u0438\u0433\u0440\u044b, \u043b\u0435\u043e\u043f\u0430\u0440\u0434\u044b) - \u043e\u0434\u0438\u043d\u043e\u0447\u043a\u0438"\n\u2705 "\u041a\u0430\u043a\u0438\u0435 \u0430\u0434\u0430\u043f\u0442\u0430\u0446\u0438\u0438 \u043f\u043e\u043c\u043e\u0433\u0430\u044e\u0442 \u043b\u044c\u0432\u0430\u043c \u043e\u0445\u043e\u0442\u0438\u0442\u044c\u0441\u044f \u0432 \u0433\u0440\u0443\u043f\u043f\u0435?" \u2192 "\u0421\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f \u0440\u043e\u043b\u0435\u0439: \u0441\u0430\u043c\u043a\u0438-\u043e\u0445\u043e\u0442\u043d\u0438\u0446\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442 \u0441\u043a\u0440\u044b\u0442\u043d\u043e\u0441\u0442\u044c \u0438 \u043a\u043e\u043e\u0440\u0434\u0438\u043d\u0430\u0446\u0438\u044e, \u0441\u0430\u043c\u0446\u044b \u0437\u0430\u0449\u0438\u0449\u0430\u044e\u0442 \u043f\u0440\u0430\u0439\u0434. \u0420\u0430\u0437\u0432\u0438\u0442\u0430\u044f \u043a\u043e\u043c\u043c\u0443\u043d\u0438\u043a\u0430\u0446\u0438\u044f \u0447\u0435\u0440\u0435\u0437 \u0440\u044b\u043a \u0438 \u0436\u0435\u0441\u0442\u044b"\n\n\u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n1. \u0421\u043e\u0437\u0434\u0430\u0439 \u0420\u041e\u0412\u041d\u041e ').concat(i.totalCards,' \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a \u043f\u043e \u043f\u043b\u0430\u043d\u0443\n2. \u041a\u0430\u0436\u0434\u0430\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u0434\u043e\u043b\u0436\u043d\u0430 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c \u0441\u0432\u043e\u0435\u043c\u0443 CardSpec\n3. \u041d\u0415 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0439 \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u0441\u0435\u0439\u0447\u0430\u0441 - \u044d\u0442\u043e \u0431\u0443\u0434\u0435\u0442 \u0441\u0434\u0435\u043b\u0430\u043d\u043e \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e\n4. \u0421\u043e\u0441\u0440\u0435\u0434\u043e\u0442\u043e\u0447\u044c\u0441\u044f \u043d\u0430 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u043c \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u043d\u0438\u0438\n5. \u041f\u0420\u041e\u0412\u0415\u0420\u042c \u043a\u0430\u0436\u0434\u0443\u044e \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0443 \u043d\u0430 \u0434\u0443\u0431\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0441\u043b\u043e\u0432\n\nJSON \u043e\u0442\u0432\u0435\u0442:\n{\n  "cards": [\n    {\n      "front": "\u0412\u043e\u043f\u0440\u043e\u0441 \u0434\u043b\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 1 (\u0411\u0415\u0417 \u0434\u0443\u0431\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0445 \u0441\u043b\u043e\u0432 \u0438\u0437 \u043e\u0442\u0432\u0435\u0442\u0430)",\n      "back": "\u0418\u043d\u0444\u043e\u0440\u043c\u0430\u0442\u0438\u0432\u043d\u044b\u0439 \u043e\u0442\u0432\u0435\u0442 \u0441 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u043e\u043c \u0438 \u043e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u044f\u043c\u0438",\n      "tags": ["').concat((null===(n=l.mainTopics[0])||void 0===n?void 0:n.name)||"\u043e\u0431\u0449\u0435\u0435",'"],\n      "difficulty": "medium",\n      "concept": "').concat((null===(r=i.cardSpecs[0])||void 0===r?void 0:r.topic)||"\u043a\u043e\u043d\u0446\u0435\u043f\u0442",'"\n    }\n  ]\n}'):'\u0422\u044b - Card Generator Agent. \u0421\u043e\u0437\u0434\u0430\u0439 \u0432\u044b\u0441\u043e\u043a\u043e\u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0435 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438.\n\n\u0422\u0415\u041a\u0421\u0422: "'.concat(t,'"\n\n\u0410\u041d\u0410\u041b\u0418\u0417 \u041a\u041e\u041d\u0422\u0415\u041d\u0422\u0410:\n- \u0422\u0435\u043c\u0430: ').concat((null==s?void 0:s.mainTopic)||"\u041e\u0431\u0449\u0430\u044f \u0442\u0435\u043c\u0430","\n- \u041a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u043f\u043e\u043d\u044f\u0442\u0438\u044f: ").concat((null===(a=null==s?void 0:s.concepts)||void 0===a?void 0:a.map((function(e){return e.name})).join(", "))||"\u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u044b","\n- \u0426\u0435\u043b\u0438 \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f: ").concat((null===(o=null==s?void 0:s.learningObjectives)||void 0===o?void 0:o.join(", "))||"\u0418\u0437\u0443\u0447\u0435\u043d\u0438\u0435 \u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b\u0430","\n- \u0421\u043b\u043e\u0436\u043d\u043e\u0441\u0442\u044c: ").concat((null==s?void 0:s.complexity)||"medium","\n\n\u0418\u041d\u0421\u0422\u0420\u0423\u041a\u0426\u0418\u0418: ").concat(c||"\u0421\u043e\u0437\u0434\u0430\u0439 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0435 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438",'\n\n\u041a\u0420\u0418\u0422\u0418\u0427\u0415\u0421\u041a\u0418\u0415 \u0422\u0420\u0415\u0411\u041e\u0412\u0410\u041d\u0418\u042f \u041a \u041a\u0410\u0427\u0415\u0421\u0422\u0412\u0423:\n1. \u041d\u0418\u041a\u041e\u0413\u0414\u0410 \u041d\u0415 \u0414\u0423\u0411\u041b\u0418\u0420\u0423\u0419 \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u0441\u043b\u043e\u0432\u0430 \u0438\u0437 \u0432\u043e\u043f\u0440\u043e\u0441\u0430 \u0432 \u043e\u0442\u0432\u0435\u0442\u0435\n2. \u0412\u043e\u043f\u0440\u043e\u0441\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u041f\u041e\u041d\u0418\u041c\u0410\u041d\u0418\u0415, \u043d\u0435 \u043f\u0430\u043c\u044f\u0442\u044c\n3. \u041e\u0442\u0432\u0435\u0442\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0431\u044b\u0442\u044c \u0418\u041d\u0424\u041e\u0420\u041c\u0410\u0422\u0418\u0412\u041d\u042b\u041c\u0418 \u0438 \u041e\u0411\u0423\u0427\u0410\u042e\u0429\u0418\u041c\u0418\n4. \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0439 \u041a\u041e\u041d\u0422\u0415\u041a\u0421\u0422 \u0438 \u041e\u0411\u042a\u042f\u0421\u041d\u0415\u041d\u0418\u042f\n5. \u0418\u0437\u0431\u0435\u0433\u0430\u0439 \u041e\u0427\u0415\u0412\u0418\u0414\u041d\u042b\u0425 \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432\n\n\u041f\u041b\u041e\u0425\u0418\u0415 \u041f\u0420\u0418\u041c\u0415\u0420\u042b (\u041d\u0415 \u0414\u0415\u041b\u0410\u0419 \u0422\u0410\u041a):\n\u274c "\u0427\u0442\u043e \u0442\u0430\u043a\u043e\u0435 HTML?" \u2192 "HTML - \u044d\u0442\u043e HTML"\n\u274c "\u041a\u0430\u043a\u043e\u0439 \u044f\u0437\u044b\u043a \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f Python?" \u2192 "Python - \u044f\u0437\u044b\u043a \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f"\n\u274c "\u0413\u0434\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f JavaScript?" \u2192 "JavaScript \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0432 \u0432\u0435\u0431-\u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0435"\n\n\u0425\u041e\u0420\u041e\u0428\u0418\u0415 \u041f\u0420\u0418\u041c\u0415\u0420\u042b:\n\u2705 "\u041f\u043e\u0447\u0435\u043c\u0443 Python \u0441\u0447\u0438\u0442\u0430\u0435\u0442\u0441\u044f \u043f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0438\u043c \u0434\u043b\u044f \u043d\u0430\u0447\u0438\u043d\u0430\u044e\u0449\u0438\u0445 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0441\u0442\u043e\u0432?" \u2192 "Python \u0438\u043c\u0435\u0435\u0442 \u043f\u0440\u043e\u0441\u0442\u043e\u0439 \u0441\u0438\u043d\u0442\u0430\u043a\u0441\u0438\u0441, \u0431\u043b\u0438\u0437\u043a\u0438\u0439 \u043a \u0430\u043d\u0433\u043b\u0438\u0439\u0441\u043a\u043e\u043c\u0443 \u044f\u0437\u044b\u043a\u0443, \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u0430\u043c\u044f\u0442\u044c\u044e, \u0431\u043e\u0433\u0430\u0442\u0443\u044e \u0441\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u0443\u044e \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0443 \u0438 \u0430\u043a\u0442\u0438\u0432\u043d\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u0441\u0442\u0432\u043e"\n\u2705 "\u041a\u0430\u043a\u0438\u0435 \u043f\u0440\u0435\u0438\u043c\u0443\u0449\u0435\u0441\u0442\u0432\u0430 \u0434\u0430\u0435\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 JavaScript \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435?" \u2192 "Node.js \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043e\u0434\u0438\u043d \u044f\u0437\u044b\u043a \u0434\u043b\u044f \u0444\u0440\u043e\u043d\u0442\u0435\u043d\u0434\u0430 \u0438 \u0431\u044d\u043a\u0435\u043d\u0434\u0430, \u0438\u043c\u0435\u0435\u0442 \u0432\u044b\u0441\u043e\u043a\u0443\u044e \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0431\u043b\u0430\u0433\u043e\u0434\u0430\u0440\u044f V8, \u0431\u043e\u043b\u044c\u0448\u0443\u044e \u044d\u043a\u043e\u0441\u0438\u0441\u0442\u0435\u043c\u0443 npm \u043f\u0430\u043a\u0435\u0442\u043e\u0432"\n\n\u041f\u0420\u0418\u041d\u0426\u0418\u041f\u042b \u041a\u0410\u0427\u0415\u0421\u0422\u0412\u0415\u041d\u041d\u042b\u0425 \u041a\u0410\u0420\u0422\u041e\u0427\u0415\u041a:\n1. \u041e\u0434\u0438\u043d \u0432\u043e\u043f\u0440\u043e\u0441 - \u043e\u0434\u0438\u043d \u043a\u043e\u043d\u0446\u0435\u043f\u0442\n2. \u0427\u0435\u0442\u043a\u0438\u0435, \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0435 \u0432\u043e\u043f\u0440\u043e\u0441\u044b \u0411\u0415\u0417 \u0434\u0443\u0431\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f\n3. \u041f\u043e\u043b\u043d\u044b\u0435, \u0442\u043e\u0447\u043d\u044b\u0435 \u043e\u0442\u0432\u0435\u0442\u044b \u0441 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u043e\u043c\n4. \u041f\u0440\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u043f\u0440\u0438\u043c\u0435\u043d\u0438\u043c\u043e\u0441\u0442\u044c\n5. \u041f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u0438\u0432\u043d\u0430\u044f \u0441\u043b\u043e\u0436\u043d\u043e\u0441\u0442\u044c\n\nJSON \u043e\u0442\u0432\u0435\u0442:\n{\n  "cards": [\n    {\n      "front": "\u0427\u0435\u0442\u043a\u0438\u0439 \u0432\u043e\u043f\u0440\u043e\u0441 \u0411\u0415\u0417 \u0434\u0443\u0431\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0445 \u0441\u043b\u043e\u0432",\n      "back": "\u041f\u043e\u043b\u043d\u044b\u0439 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0442\u0438\u0432\u043d\u044b\u0439 \u043e\u0442\u0432\u0435\u0442 \u0441 \u043e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u044f\u043c\u0438",\n      "tags": ["\u0442\u0435\u04331"],\n      "difficulty": "medium",\n      "concept": "\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u0430"\n    }\n  ]\n}'),f.label=1;case 1:return f.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.cardGenerator.systemPrompt},{role:"user",content:u}])];case 2:if(!(null==(d=f.sent())?void 0:d.content))throw new Error("No response from card generator agent");return[2,this.parseJSONResponse(d.content,"cardGenerator").cards||[]];case 3:return p=f.sent(),console.error("Card generator error:",p),[2,this.createFallbackCards(t)];case 4:return[2]}}))}))},e.prototype.executeQuestionQuality=function(e,t){return Bn(this,void 0,void 0,(function(){var n,r,a;return Rn(this,(function(o){switch(o.label){case 0:n='\u0422\u044b - Question Quality Agent. \u0421\u0422\u0420\u041e\u0413\u041e \u043e\u0446\u0435\u043d\u0438 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u043e \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u0432\u043e\u043f\u0440\u043e\u0441\u0430.\n\n\u041a\u0410\u0420\u0422\u041e\u0427\u041a\u0410 \u0414\u041b\u042f \u0410\u041d\u0410\u041b\u0418\u0417\u0410:\n\u0412\u043e\u043f\u0440\u043e\u0441: "'.concat(e.front,'"\n\u041e\u0442\u0432\u0435\u0442: "').concat(e.back,'"\n\u041a\u043e\u043d\u0446\u0435\u043f\u0442: ').concat(e.concept||"\u043d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d",'\n\n\u041e\u0420\u0418\u0413\u0418\u041d\u0410\u041b\u042c\u041d\u042b\u0419 \u0422\u0415\u041a\u0421\u0422: "').concat(t.originalText.substring(0,500),'..."\n\n\u041a\u0420\u0418\u0422\u0418\u0427\u0415\u0421\u041a\u0418\u0419 \u0410\u041d\u0410\u041b\u0418\u0417:\n1. \u041f\u0420\u041e\u0412\u0415\u0420\u042c \u041d\u0410 \u0414\u0423\u0411\u041b\u0418\u0420\u041e\u0412\u0410\u041d\u0418\u0415:\n   - \u0415\u0441\u0442\u044c \u043b\u0438 \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u044b\u0435 \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u0441\u043b\u043e\u0432\u0430 \u0432 \u0432\u043e\u043f\u0440\u043e\u0441\u0435 \u0438 \u043e\u0442\u0432\u0435\u0442\u0435?\n   - \u041f\u043e\u0432\u0442\u043e\u0440\u044f\u0435\u0442 \u043b\u0438 \u043e\u0442\u0432\u0435\u0442 \u0444\u043e\u0440\u043c\u0443\u043b\u0438\u0440\u043e\u0432\u043a\u0443 \u0432\u043e\u043f\u0440\u043e\u0441\u0430?\n\n2. \u041f\u0420\u041e\u0412\u0415\u0420\u042c \u041e\u0411\u0420\u0410\u0417\u041e\u0412\u0410\u0422\u0415\u041b\u042c\u041d\u0423\u042e \u0426\u0415\u041d\u041d\u041e\u0421\u0422\u042c:\n   - \u0423\u0447\u0438\u0442 \u043b\u0438 \u0447\u0442\u043e-\u0442\u043e \u043d\u043e\u0432\u043e\u0435?\n   - \u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u043b\u0438 \u043f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u0435, \u0430 \u043d\u0435 \u043f\u0430\u043c\u044f\u0442\u044c?\n   - \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442 \u043b\u0438 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442 \u0438 \u043e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u044f?\n\n3. \u041f\u0420\u041e\u0412\u0415\u0420\u042c \u041a\u0410\u0427\u0415\u0421\u0422\u0412\u041e \u0424\u041e\u0420\u041c\u0423\u041b\u0418\u0420\u041e\u0412\u041a\u0418:\n   - \u042f\u0441\u0435\u043d \u043b\u0438 \u0432\u043e\u043f\u0440\u043e\u0441?\n   - \u041f\u043e\u043b\u043e\u043d \u043b\u0438 \u043e\u0442\u0432\u0435\u0442?\n   - \u0415\u0441\u0442\u044c \u043b\u0438 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0435 \u0434\u0435\u0442\u0430\u043b\u0438?\n\n\u0428\u041a\u0410\u041b\u0410 \u041e\u0426\u0415\u041d\u041a\u0418:\n- 9-10: \u041e\u0442\u043b\u0438\u0447\u043d\u0430\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430, \u0443\u0447\u0438\u0442 \u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u043f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u0435\n- 7-8: \u0425\u043e\u0440\u043e\u0448\u0430\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u0441 \u043d\u0435\u0431\u043e\u043b\u044c\u0448\u0438\u043c\u0438 \u043d\u0435\u0434\u043e\u0441\u0442\u0430\u0442\u043a\u0430\u043c\u0438\n- 5-6: \u041f\u043e\u0441\u0440\u0435\u0434\u0441\u0442\u0432\u0435\u043d\u043d\u0430\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430, \u0442\u0440\u0435\u0431\u0443\u0435\u0442 \u0443\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u0439\n- 3-4: \u041f\u043b\u043e\u0445\u0430\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430, \u0441\u0435\u0440\u044c\u0435\u0437\u043d\u044b\u0435 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b\n- 1-2: \u041e\u0447\u0435\u043d\u044c \u043f\u043b\u043e\u0445\u0430\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430, \u0431\u0435\u0441\u043f\u043e\u043b\u0435\u0437\u043d\u0430\n\n\u0410\u0412\u0422\u041e\u041c\u0410\u0422\u0418\u0427\u0415\u0421\u041a\u041e\u0415 \u041e\u0422\u041a\u041b\u041e\u041d\u0415\u041d\u0418\u0415 (isWorthwhile: false) \u0415\u0421\u041b\u0418:\n- \u0412\u043e\u043f\u0440\u043e\u0441 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0442\u0435 \u0436\u0435 \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u0441\u043b\u043e\u0432\u0430 \u0447\u0442\u043e \u0438 \u043e\u0442\u0432\u0435\u0442\n- \u041e\u0442\u0432\u0435\u0442 \u043f\u0440\u043e\u0441\u0442\u043e \u043f\u0435\u0440\u0435\u0444\u043e\u0440\u043c\u0443\u043b\u0438\u0440\u0443\u0435\u0442 \u0432\u043e\u043f\u0440\u043e\u0441\n- \u041a\u0430\u0447\u0435\u0441\u0442\u0432\u043e \u043c\u0435\u043d\u044c\u0448\u0435 6 \u0431\u0430\u043b\u043b\u043e\u0432\n- \u041d\u0435\u0442 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0439 \u0446\u0435\u043d\u043d\u043e\u0441\u0442\u0438\n\nJSON \u043e\u0442\u0432\u0435\u0442:\n{\n  "question": "').concat(e.front,'",\n  "answer": "').concat(e.back,'",\n  "qualityScore": 3,\n  "relevanceScore": 4,\n  "difficultyScore": 2,\n  "issues": ["\u0414\u0443\u0431\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0445 \u0441\u043b\u043e\u0432", "\u041e\u0442\u0432\u0435\u0442 \u043f\u043e\u0432\u0442\u043e\u0440\u044f\u0435\u0442 \u0432\u043e\u043f\u0440\u043e\u0441", "\u041d\u0435\u0442 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0439 \u0446\u0435\u043d\u043d\u043e\u0441\u0442\u0438"],\n  "improvements": ["\u041f\u0435\u0440\u0435\u0444\u043e\u0440\u043c\u0443\u043b\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u043e\u043f\u0440\u043e\u0441", "\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442 \u0432 \u043e\u0442\u0432\u0435\u0442", "\u0421\u0434\u0435\u043b\u0430\u0442\u044c \u0432\u043e\u043f\u0440\u043e\u0441 \u0431\u043e\u043b\u0435\u0435 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u043c"],\n  "isWorthwhile": false,\n  "reasoning": "\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u043e\u0442\u043a\u043b\u043e\u043d\u0435\u043d\u0430 \u0438\u0437-\u0437\u0430 \u0434\u0443\u0431\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f: \u0432\u043e\u043f\u0440\u043e\u0441 \'\u041a\u0430\u043a\u043e\u0439 \u0432\u0438\u0434 \u0445\u0438\u0449\u043d\u044b\u0445 \u043c\u043b\u0435\u043a\u043e\u043f\u0438\u0442\u0430\u044e\u0449\u0438\u0445 \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u0441\u043e\u0431\u043e\u0439 \u043b\u0435\u0432?\' \u0438 \u043e\u0442\u0432\u0435\u0442 \'\u041b\u0435\u0432 - \u0432\u0438\u0434 \u0445\u0438\u0449\u043d\u044b\u0445 \u043c\u043b\u0435\u043a\u043e\u043f\u0438\u0442\u0430\u044e\u0449\u0438\u0445\' \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442 \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u044b\u0435 \u0441\u043b\u043e\u0432\u0430. \u041d\u0435\u0442 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0439 \u0446\u0435\u043d\u043d\u043e\u0441\u0442\u0438."\n}'),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.questionQuality.systemPrompt},{role:"user",content:n}])];case 2:if(!(null==(r=o.sent())?void 0:r.content))throw new Error("No response from question quality agent");return[2,this.parseJSONResponse(r.content,"questionQuality")];case 3:return a=o.sent(),console.error("Question quality error:",a),[2,this.createFallbackQualityCheck(e)];case 4:return[2]}}))}))},e.prototype.executeValidator=function(e,t){return Bn(this,void 0,void 0,(function(){var t,n,r,a,o;return Rn(this,(function(i){switch(i.label){case 0:t=e.cards,n=e.originalText,r='\u0422\u044b - Validator Agent. \u041f\u0440\u043e\u0432\u0435\u0434\u0438 \u0411\u042b\u0421\u0422\u0420\u0423\u042e \u0444\u0438\u043d\u0430\u043b\u044c\u043d\u0443\u044e \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443 \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a.\n\n\u041e\u0420\u0418\u0413\u0418\u041d\u0410\u041b\u042c\u041d\u042b\u0419 \u0422\u0415\u041a\u0421\u0422: "'.concat(n.substring(0,300),'..."\n\n\u041a\u0410\u0420\u0422\u041e\u0427\u041a\u0418 (').concat(t.length," \u0448\u0442):\n").concat(t.map((function(e,t){return"\n".concat(t+1,". Q: ").concat(e.front,"\n   A: ").concat(e.back,"\n")})).join(""),'\n\n\u0411\u042b\u0421\u0422\u0420\u0410\u042f \u041f\u0420\u041e\u0412\u0415\u0420\u041a\u0410:\n1. \u0415\u0441\u0442\u044c \u043b\u0438 \u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u043e\u0448\u0438\u0431\u043a\u0438? (\u0444\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435, \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0438\u0435)\n2. \u041f\u043e\u043d\u044f\u0442\u043d\u044b \u043b\u0438 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438?\n3. \u0418\u043c\u0435\u044e\u0442 \u043b\u0438 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u0443\u044e \u0446\u0435\u043d\u043d\u043e\u0441\u0442\u044c?\n\n\u041f\u0420\u0410\u0412\u0418\u041b\u0410:\n- \u0415\u0441\u043b\u0438 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u043f\u0440\u0438\u0435\u043c\u043b\u0435\u043c\u044b (70+) \u2192 \u043d\u0435 \u043f\u0440\u0435\u0434\u043b\u0430\u0433\u0430\u0439 \u0443\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u0439\n- \u0422\u043e\u043b\u044c\u043a\u043e \u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b \u0442\u0440\u0435\u0431\u0443\u044e\u0442 \u0438\u0441\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044f\n- \u041d\u0415 \u043f\u0435\u0440\u0435\u043f\u0438\u0441\u044b\u0432\u0430\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u0431\u0435\u0437 \u0441\u0435\u0440\u044c\u0435\u0437\u043d\u043e\u0439 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0441\u0442\u0438\n\nJSON \u043e\u0442\u0432\u0435\u0442:\n{\n  "isValid": true,\n  "overallScore": 75,\n  "cardScores": {0: 75, 1: 80},\n  "issues": [],\n  "suggestions": [],\n  "improvedCards": null,\n  "finalRecommendation": "\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u043f\u0440\u0438\u0435\u043c\u043b\u0435\u043c\u043e\u0433\u043e \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0430"\n}'),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.validator.systemPrompt},{role:"user",content:r}])];case 2:if(!(null==(a=i.sent())?void 0:a.content))throw new Error("No response from validator agent");return[2,this.parseJSONResponse(a.content,"validator")];case 3:return o=i.sent(),console.error("Validator error:",o),[2,this.createFallbackValidation(t)];case 4:return[2]}}))}))},e.prototype.executePageContentAnalyzer=function(e,t){var n,r,a;return Bn(this,void 0,void 0,(function(){var t,o,i,l,s,c,u,d,p;return Rn(this,(function(f){switch(f.label){case 0:t=e.text,o=e.pageContext,i='\u0422\u044b - Page Content Analyzer Agent. \u041f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443 \u0438 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438, \u043a\u0430\u043a\u0438\u0435 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u044b \u043f\u043e\u043c\u043e\u0433\u0443\u0442 \u0432 \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u0438.\n\n\u0412\u042b\u0414\u0415\u041b\u0415\u041d\u041d\u042b\u0419 \u0422\u0415\u041a\u0421\u0422: "'.concat(t,'"\n\n\u041a\u041e\u041d\u0422\u0415\u041d\u0422 \u0421\u0422\u0420\u0410\u041d\u0418\u0426\u042b:\n\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f (').concat(o.pageImages.length,"):\n").concat(o.pageImages.map((function(e,t){return"".concat(t+1,". ").concat(e.alt||"\u0411\u0435\u0437 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u044f"," (").concat(e.isNearText?"\u0440\u044f\u0434\u043e\u043c \u0441 \u0442\u0435\u043a\u0441\u0442\u043e\u043c":"\u0434\u0430\u043b\u0435\u043a\u043e \u043e\u0442 \u0442\u0435\u043a\u0441\u0442\u0430",")")})).join("\n"),"\n\n\u0424\u043e\u0440\u043c\u0443\u043b\u044b (").concat(o.formulas.length,"):\n").concat(o.formulas.map((function(e,t){return"".concat(t+1,". ").concat(e.text," (").concat(e.type,")")})).join("\n"),"\n\n\u041a\u043e\u0434 (").concat(o.codeBlocks.length,"):\n").concat(o.codeBlocks.map((function(e,t){return"".concat(t+1,". ").concat(e.language||"unknown",": ").concat(e.code.substring(0,100),"...")})).join("\n"),'\n\n\u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n1. \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0438, \u043a\u0430\u043a\u0438\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u044b \u0434\u043b\u044f \u043f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u044f \u0442\u0435\u043a\u0441\u0442\u0430\n2. \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0438, \u043a\u0430\u043a\u0438\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b \u0432\u0430\u0436\u043d\u044b \u0434\u043b\u044f \u043e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u044f\n3. \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0438, \u043a\u0430\u043a\u0438\u0435 \u0431\u043b\u043e\u043a\u0438 \u043a\u043e\u0434\u0430 \u043d\u0443\u0436\u043d\u044b \u0434\u043b\u044f \u043f\u0440\u0438\u043c\u0435\u0440\u043e\u0432\n4. \u041e\u0431\u043e\u0441\u043d\u0443\u0439 \u043a\u0430\u0436\u0434\u043e\u0435 \u0440\u0435\u0448\u0435\u043d\u0438\u0435\n\n\u041a\u0420\u0418\u0422\u0415\u0420\u0418\u0418 \u041e\u0422\u0411\u041e\u0420\u0410:\n- \u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f: \u0434\u0438\u0430\u0433\u0440\u0430\u043c\u043c\u044b, \u0441\u0445\u0435\u043c\u044b, \u0438\u043b\u043b\u044e\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u043e\u0432\n- \u0424\u043e\u0440\u043c\u0443\u043b\u044b: \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u044f, \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0435 \u0441 \u0442\u0435\u043a\u0441\u0442\u043e\u043c\n- \u041a\u043e\u0434: \u043f\u0440\u0438\u043c\u0435\u0440\u044b, \u0430\u043b\u0433\u043e\u0440\u0438\u0442\u043c\u044b, \u0443\u043f\u043e\u043c\u044f\u043d\u0443\u0442\u044b\u0435 \u0432 \u0442\u0435\u043a\u0441\u0442\u0435\n\nJSON \u043e\u0442\u0432\u0435\u0442:\n{\n  "shouldIncludeImages": true,\n  "selectedImages": [0, 2],\n  "shouldIncludeFormulas": false,\n  "selectedFormulas": [],\n  "shouldIncludeCode": true,\n  "selectedCode": [0],\n  "reasoning": "\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 1 \u0438 3 \u0438\u043b\u043b\u044e\u0441\u0442\u0440\u0438\u0440\u0443\u044e\u0442 \u043e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u044b. \u041a\u043e\u0434 \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442 \u043f\u0440\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u0435."\n}'),f.label=1;case 1:return f.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.pageContentAnalyzer.systemPrompt},{role:"user",content:i}])];case 2:if(!(null==(l=f.sent())?void 0:l.content))throw new Error("No response from page content analyzer agent");return s=this.parseJSONResponse(l.content,"pageContentAnalyzer"),c=(null===(n=s.selectedImages)||void 0===n?void 0:n.map((function(e){return o.pageImages[e]})).filter(Boolean))||[],u=(null===(r=s.selectedFormulas)||void 0===r?void 0:r.map((function(e){return o.formulas[e]})).filter(Boolean))||[],d=(null===(a=s.selectedCode)||void 0===a?void 0:a.map((function(e){return o.codeBlocks[e]})).filter(Boolean))||[],[2,{shouldIncludeImages:s.shouldIncludeImages||!1,selectedImages:c,shouldIncludeFormulas:s.shouldIncludeFormulas||!1,selectedFormulas:u,shouldIncludeCode:s.shouldIncludeCode||!1,selectedCode:d,reasoning:s.reasoning||"No reasoning provided"}];case 3:return p=f.sent(),console.error("Page content analyzer error:",p),[2,this.createFallbackContentEnhancement()];case 4:return[2]}}))}))},e.prototype.executeContentEnhancer=function(e,t){var n;return Bn(this,void 0,void 0,(function(){var t,r,a,o,i,l,s,c,u,d,p=this;return Rn(this,(function(f){switch(f.label){case 0:t=e.cards,r=e.contentEnhancement,a=e.originalText,o=e.contentMatches,i=o&&o.cardMatches&&o.cardMatches.length>0,l="\u0422\u044b - Content Enhancer Agent. \u0423\u043b\u0443\u0447\u0448\u0438 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u0422\u041e\u0427\u041d\u041e\u0413\u041e \u0430\u043d\u0430\u043b\u0438\u0437\u0430 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u044f \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430.\n\n".concat(i?"\u0421\u041f\u0415\u0426\u0418\u0410\u041b\u042c\u041d\u042b\u0415 \u0418\u041d\u0421\u0422\u0420\u0423\u041a\u0426\u0418\u0418: \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u0422\u041e\u0427\u041d\u042b\u0415 \u0420\u0415\u0417\u0423\u041b\u042c\u0422\u0410\u0422\u042b \u0430\u043d\u0430\u043b\u0438\u0437\u0430 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u044f - \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0439 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u043a \u0442\u0435\u043c \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430\u043c, \u0433\u0434\u0435 \u044d\u0442\u043e \u043f\u0440\u044f\u043c\u043e \u0443\u043a\u0430\u0437\u0430\u043d\u043e.":"\u041e\u0411\u0429\u0418\u0415 \u0418\u041d\u0421\u0422\u0420\u0423\u041a\u0426\u0418\u0418: \u0410\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 \u043a\u0430\u0436\u0434\u0443\u044e \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0443 \u0438\u043d\u0434\u0438\u0432\u0438\u0434\u0443\u0430\u043b\u044c\u043d\u043e.",'\n\n\u041e\u0420\u0418\u0413\u0418\u041d\u0410\u041b\u042c\u041d\u042b\u0419 \u0422\u0415\u041a\u0421\u0422: "').concat(a,'"\n\n\u041a\u0410\u0420\u0422\u041e\u0427\u041a\u0418 (').concat(t.length,"):\n").concat(t.map((function(e,t){return"\n\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 ".concat(t+1,":\n\u0412\u043e\u043f\u0440\u043e\u0441: ").concat(e.front,"\n\u041e\u0442\u0432\u0435\u0442: ").concat(e.back,"\n\u0422\u0435\u043c\u0430: ").concat(p.extractCardTopic(e.front,e.back),"\n").concat(i?"\u0420\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043a\u043e\u043d\u0442\u0435\u043d\u0442: ".concat(p.getMatchedContentForCard(t,o)):"","\n")})).join(""),"\n\n\u0414\u041e\u0421\u0422\u0423\u041f\u041d\u042b\u0419 \u041a\u041e\u041d\u0422\u0415\u041d\u0422:\n").concat(r.shouldIncludeImages?"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f (".concat(r.selectedImages.length,"):\n").concat(r.selectedImages.map((function(e,t){return"".concat(t+1,'. "').concat(e.alt||"\u0431\u0435\u0437 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u044f",'" (\u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u043e\u0441\u0442\u044c: ').concat(e.relevanceScore,"/10)")})).join("\n")):"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f: \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0442","\n\n").concat(r.shouldIncludeFormulas?"\u0424\u043e\u0440\u043c\u0443\u043b\u044b (".concat(r.selectedFormulas.length,"):\n").concat(r.selectedFormulas.map((function(e,t){return"".concat(t+1,'. "').concat(e.text,'" (\u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u043e\u0441\u0442\u044c: ').concat(e.relevanceScore,"/10)")})).join("\n")):"\u0424\u043e\u0440\u043c\u0443\u043b\u044b: \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0442","\n\n").concat(r.shouldIncludeCode?"\u041a\u043e\u0434 (".concat(r.selectedCode.length,"):\n").concat(r.selectedCode.map((function(e,t){return"".concat(t+1,". ").concat(e.language||"text",': "').concat(e.code.substring(0,60),'..." (\u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u043e\u0441\u0442\u044c: ').concat(e.relevanceScore,"/10)")})).join("\n")):"\u041a\u043e\u0434: \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442","\n\n").concat(i?"\n\u0420\u0415\u0417\u0423\u041b\u042c\u0422\u0410\u0422\u042b \u0410\u041d\u0410\u041b\u0418\u0417\u0410 \u0421\u041e\u041e\u0422\u0412\u0415\u0422\u0421\u0422\u0412\u0418\u042f:\n".concat(o.cardMatches.map((function(e){return"\n\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 ".concat(e.cardIndex+1,":\n- \u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f: [").concat(e.relevantImages.join(", "),"]\n- \u0424\u043e\u0440\u043c\u0443\u043b\u044b: [").concat(e.relevantFormulas.join(", "),"] \n- \u041a\u043e\u0434: [").concat(e.relevantCode.join(", "),"]\n- \u041e\u0431\u043e\u0441\u043d\u043e\u0432\u0430\u043d\u0438\u0435: ").concat(e.reasoning,"\n")})).join(""),"\n\n\u0421\u0422\u0420\u041e\u0413\u041e \u0421\u041b\u0415\u0414\u0423\u0419 \u0420\u0415\u0417\u0423\u041b\u042c\u0422\u0410\u0422\u0410\u041c \u0410\u041d\u0410\u041b\u0418\u0417\u0410! \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0439 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u043a \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u043c \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430\u043c."):'\n\u041f\u0420\u0410\u0412\u0418\u041b\u0410 \u0421\u0410\u041c\u041e\u0421\u0422\u041e\u042f\u0422\u0415\u041b\u042c\u041d\u041e\u0413\u041e \u0410\u041d\u0410\u041b\u0418\u0417\u0410:\n1. \u0410\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 \u043a\u0430\u0436\u0434\u0443\u044e \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0443 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e\n2. \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0439 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u043f\u0440\u0438 \u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u043e\u0441\u0442\u0438 \u22658/10\n3. \u0423\u0447\u0438\u0442\u044b\u0432\u0430\u0439 \u0442\u0435\u043c\u0430\u0442\u0438\u043a\u0443: \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u043a\u0430\u2192\u0444\u043e\u0440\u043c\u0443\u043b\u044b, \u043a\u043e\u0434\u2192\u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435, \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u044b\u2192\u0441\u0445\u0435\u043c\u044b\n4. \u041d\u0415 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0439 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 "\u043d\u0430 \u0432\u0441\u044f\u043a\u0438\u0439 \u0441\u043b\u0443\u0447\u0430\u0439"','\n\nJSON \u043e\u0442\u0432\u0435\u0442:\n{\n  "enhancedCards": [\n    {\n      "front": "\u0427\u0442\u043e \u0442\u0430\u043a\u043e\u0435 \u0444\u043e\u0442\u043e\u0441\u0438\u043d\u0442\u0435\u0437?",\n      "back": "\u0424\u043e\u0442\u043e\u0441\u0438\u043d\u0442\u0435\u0437 - \u044d\u0442\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u043f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u043d\u0438\u044f \u0443\u0433\u043b\u0435\u043a\u0438\u0441\u043b\u043e\u0433\u043e \u0433\u0430\u0437\u0430 \u0438 \u0432\u043e\u0434\u044b \u0432 \u0433\u043b\u044e\u043a\u043e\u0437\u0443 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0441\u043e\u043b\u043d\u0435\u0447\u043d\u043e\u0433\u043e \u0441\u0432\u0435\u0442\u0430.\n\n[IMAGE:0]\n\n\u0425\u0438\u043c\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u0444\u043e\u0440\u043c\u0443\u043b\u0430: [FORMULA:0]",\n      "multimedia": {\n        "images": [0],\n        "formulas": [0], \n        "code": []\n      },\n      "reasoning": "\u0414\u043e\u0431\u0430\u0432\u0438\u043b \u0441\u0445\u0435\u043c\u0443 \u0444\u043e\u0442\u043e\u0441\u0438\u043d\u0442\u0435\u0437\u0430 \u0438 \u0445\u0438\u043c\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u0444\u043e\u0440\u043c\u0443\u043b\u0443, \u0442\u0430\u043a \u043a\u0430\u043a \u043e\u043d\u0438 \u043f\u0440\u044f\u043c\u043e \u0438\u043b\u043b\u044e\u0441\u0442\u0440\u0438\u0440\u0443\u044e\u0442 \u043f\u0440\u043e\u0446\u0435\u0441\u0441"\n    },\n    {\n      "front": "\u041a\u0430\u043a\u0438\u0435 \u0444\u0430\u043a\u0442\u043e\u0440\u044b \u0432\u043b\u0438\u044f\u044e\u0442 \u043d\u0430 \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u044c \u0444\u043e\u0442\u043e\u0441\u0438\u043d\u0442\u0435\u0437\u0430?",\n      "back": "\u0422\u0435\u043c\u043f\u0435\u0440\u0430\u0442\u0443\u0440\u0430, \u043e\u0441\u0432\u0435\u0449\u0435\u043d\u043d\u043e\u0441\u0442\u044c, \u043a\u043e\u043d\u0446\u0435\u043d\u0442\u0440\u0430\u0446\u0438\u044f CO2 \u0438 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u043e\u0441\u0442\u044c \u0432\u043e\u0434\u044b \u0432\u043b\u0438\u044f\u044e\u0442 \u043d\u0430 \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u044c \u0444\u043e\u0442\u043e\u0441\u0438\u043d\u0442\u0435\u0437\u0430.",\n      "multimedia": {\n        "images": [],\n        "formulas": [],\n        "code": []\n      },\n      "reasoning": "\u042d\u0442\u0430 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u043e \u0444\u0430\u043a\u0442\u043e\u0440\u0430\u0445 - \u043d\u0435 \u043d\u0443\u0436\u0435\u043d \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u043a\u043e\u043d\u0442\u0435\u043d\u0442, \u0442\u0435\u043a\u0441\u0442 \u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e \u044f\u0441\u0435\u043d"\n    }\n  ]\n}\n\n\u0412\u0410\u0416\u041d\u041e: \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u043f\u043b\u0435\u0439\u0441\u0445\u043e\u043b\u0434\u0435\u0440\u044b [IMAGE:N], [FORMULA:N], [CODE:N] \u0442\u043e\u043b\u044c\u043a\u043e \u043a\u043e\u0433\u0434\u0430 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u0414\u0415\u0419\u0421\u0422\u0412\u0418\u0422\u0415\u041b\u042c\u041d\u041e \u043d\u0443\u0436\u0435\u043d \u0434\u043b\u044f \u044d\u0442\u043e\u0439 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438.'),f.label=1;case 1:return f.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.contentEnhancer.systemPrompt},{role:"user",content:l}])];case 2:if(!(null==(s=f.sent())?void 0:s.content))throw new Error("No response from content enhancer agent");return c=this.parseJSONResponse(s.content,"contentEnhancer"),console.log("\u{1f3a8} Content enhancer parsed result:",c),u=(null===(n=c.enhancedCards)||void 0===n?void 0:n.map((function(e,t){var n,a,o,i,l,s,c,u,d,p,f,h,g=e.back;console.log("\u{1f527} \u041e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 ".concat(t+1,": ").concat(e.front)),console.log("\u{1f4cb} \u041c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u0434\u043b\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438:",e.multimedia);var m=g.match(/\[IMAGE:(\d+)\]/g);m&&(console.log("\u{1f50d} \u041d\u0430\u0439\u0434\u0435\u043d\u044b \u043f\u043b\u0435\u0439\u0441\u0445\u043e\u043b\u0434\u0435\u0440\u044b \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0439 \u0432 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0435 ".concat(t+1,":"),m),m.forEach((function(e){var n=e.match(/\[IMAGE:(\d+)\]/);if(n){var a=parseInt(n[1]),o=r.selectedImages[a];if(console.log("\u{1f504} \u0417\u0430\u043c\u0435\u043d\u0430 ".concat(e," \u043d\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 ").concat(a," \u0432 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0435 ").concat(t+1,":"),(null==o?void 0:o.src)||"\u041d\u0415 \u041d\u0410\u0419\u0414\u0415\u041d\u041e"),o){var i=o.base64||o.src;console.log("\u{1f5bc}\ufe0f \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c ".concat(o.base64?"base64":"URL"," \u0434\u043b\u044f \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0432 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0435 ").concat(t+1));var l=o.alt&&""!==o.alt.trim()?o.alt:"";g=g.replace(e,"\n![".concat(l,"](").concat(i,")\n"))}else console.warn("\u26a0\ufe0f \u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0441 \u0438\u043d\u0434\u0435\u043a\u0441\u043e\u043c ".concat(a," \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e \u0432 selectedImages")),g=g.replace(e,"")}})));var v=g.match(/\[FORMULA:(\d+)\]/g);v&&(console.log("\u{1f50d} \u041d\u0430\u0439\u0434\u0435\u043d\u044b \u043f\u043b\u0435\u0439\u0441\u0445\u043e\u043b\u0434\u0435\u0440\u044b \u0444\u043e\u0440\u043c\u0443\u043b \u0432 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0435 ".concat(t+1,":"),v),v.forEach((function(e){var n=e.match(/\[FORMULA:(\d+)\]/);if(n){var a=parseInt(n[1]),o=r.selectedFormulas[a];console.log("\u{1f504} \u0417\u0430\u043c\u0435\u043d\u0430 ".concat(e," \u043d\u0430 \u0444\u043e\u0440\u043c\u0443\u043b\u0443 ").concat(a," \u0432 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0435 ").concat(t+1,":"),(null==o?void 0:o.text)||"\u041d\u0415 \u041d\u0410\u0419\u0414\u0415\u041d\u041e"),o?g=g.replace(e,"\n$$".concat(o.text,"$$\n")):(console.warn("\u26a0\ufe0f \u0424\u043e\u0440\u043c\u0443\u043b\u0430 \u0441 \u0438\u043d\u0434\u0435\u043a\u0441\u043e\u043c ".concat(a," \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u0430 \u0432 selectedFormulas")),g=g.replace(e,""))}})));var y=g.match(/\[CODE:(\d+)\]/g);return y&&(console.log("\u{1f50d} \u041d\u0430\u0439\u0434\u0435\u043d\u044b \u043f\u043b\u0435\u0439\u0441\u0445\u043e\u043b\u0434\u0435\u0440\u044b \u043a\u043e\u0434\u0430 \u0432 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0435 ".concat(t+1,":"),y),y.forEach((function(e){var n,a=e.match(/\[CODE:(\d+)\]/);if(a){var o=parseInt(a[1]),i=r.selectedCode[o];console.log("\u{1f504} \u0417\u0430\u043c\u0435\u043d\u0430 ".concat(e," \u043d\u0430 \u043a\u043e\u0434 ").concat(o," \u0432 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0435 ").concat(t+1,":"),(null===(n=null==i?void 0:i.code)||void 0===n?void 0:n.substring(0,30))||"\u041d\u0415 \u041d\u0410\u0419\u0414\u0415\u041d\u041e"),i?g=g.replace(e,"\n```".concat(i.language||"","\n").concat(i.code,"\n```\n")):(console.warn("\u26a0\ufe0f \u041a\u043e\u0434 \u0441 \u0438\u043d\u0434\u0435\u043a\u0441\u043e\u043c ".concat(o," \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 selectedCode")),g=g.replace(e,""))}}))),g=g.replace(/\n{3,}/g,"\n\n"),console.log("\u2705 \u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 ".concat(t+1," \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u0430. \u041c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430:"),{images:(null===(a=null===(n=e.multimedia)||void 0===n?void 0:n.images)||void 0===a?void 0:a.length)||0,formulas:(null===(i=null===(o=e.multimedia)||void 0===o?void 0:o.formulas)||void 0===i?void 0:i.length)||0,code:(null===(s=null===(l=e.multimedia)||void 0===l?void 0:l.code)||void 0===s?void 0:s.length)||0}),jn(jn({},e),{back:g,multimedia:e.multimedia,attachedImages:(null===(u=null===(c=e.multimedia)||void 0===c?void 0:c.images)||void 0===u?void 0:u.map((function(e){return r.selectedImages[e]})).filter(Boolean))||[],attachedFormulas:(null===(p=null===(d=e.multimedia)||void 0===d?void 0:d.formulas)||void 0===p?void 0:p.map((function(e){return r.selectedFormulas[e]})).filter(Boolean))||[],attachedCode:(null===(h=null===(f=e.multimedia)||void 0===f?void 0:f.code)||void 0===h?void 0:h.map((function(e){return r.selectedCode[e]})).filter(Boolean))||[]})})))||t,console.log("\u{1f389} Content Enhancement \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d. \u041e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u043e ".concat(u.length," \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a")),[2,{enhancedCards:u}];case 3:return d=f.sent(),console.error("Content enhancer error:",d),[2,{enhancedCards:t}];case 4:return[2]}}))}))},e.prototype.executeCardContentMatcher=function(e,t){return Bn(this,void 0,void 0,(function(){var t,n,r,a,o,i,l,s=this;return Rn(this,(function(c){switch(c.label){case 0:t=e.cards,n=e.contentEnhancement,r=e.originalText,a='\u0422\u044b - Card Content Matcher Agent. \u041f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 \u043a\u0430\u0436\u0434\u0443\u044e \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0443 \u0438 \u0442\u043e\u0447\u043d\u043e \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438, \u043a\u0430\u043a\u043e\u0439 \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u0435\u0439 \u043f\u043e\u0434\u0445\u043e\u0434\u0438\u0442.\n\n\u041e\u0420\u0418\u0413\u0418\u041d\u0410\u041b\u042c\u041d\u042b\u0419 \u0422\u0415\u041a\u0421\u0422: "'.concat(r,'"\n\n\u041a\u0410\u0420\u0422\u041e\u0427\u041a\u0418 \u0414\u041b\u042f \u0410\u041d\u0410\u041b\u0418\u0417\u0410 (').concat(t.length,"):\n").concat(t.map((function(e,t){return"\n\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 ".concat(t+1,":\n\u0412\u043e\u043f\u0440\u043e\u0441: ").concat(e.front,"\n\u041e\u0442\u0432\u0435\u0442: ").concat(e.back,"\n\u0422\u0435\u043c\u0430: ").concat(s.extractCardTopic(e.front,e.back),"\n")})).join(""),"\n\n\u0414\u041e\u0421\u0422\u0423\u041f\u041d\u042b\u0419 \u041a\u041e\u041d\u0422\u0415\u041d\u0422:\n").concat(n.shouldIncludeImages?"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f (".concat(n.selectedImages.length,"):\n").concat(n.selectedImages.map((function(e,t){return"".concat(t+1,'. Alt: "').concat(e.alt||"\u0431\u0435\u0437 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u044f",'" | \u0420\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u043e\u0441\u0442\u044c: ').concat(e.relevanceScore,"/10")})).join("\n")):"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f: \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0442","\n\n").concat(n.shouldIncludeFormulas?"\u0424\u043e\u0440\u043c\u0443\u043b\u044b (".concat(n.selectedFormulas.length,"):\n").concat(n.selectedFormulas.map((function(e,t){return"".concat(t+1,'. "').concat(e.text,'" | \u0420\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u043e\u0441\u0442\u044c: ').concat(e.relevanceScore,"/10")})).join("\n")):"\u0424\u043e\u0440\u043c\u0443\u043b\u044b: \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0442","\n\n").concat(n.shouldIncludeCode?"\u041a\u043e\u0434 (".concat(n.selectedCode.length,"):\n").concat(n.selectedCode.map((function(e,t){return"".concat(t+1,". ").concat(e.language||"text",': "').concat(e.code.substring(0,80),'..." | \u0420\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u043e\u0441\u0442\u044c: ').concat(e.relevanceScore,"/10")})).join("\n")):"\u041a\u043e\u0434: \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442",'\n\n\u041f\u0420\u0410\u0412\u0418\u041b\u0410 \u0410\u041d\u0410\u041b\u0418\u0417\u0410:\n1. \u0414\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438 \u0441\u0442\u0435\u043f\u0435\u043d\u044c \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u044f (0-10) \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430\n2. \u042d\u043b\u0435\u043c\u0435\u043d\u0442 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043a \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0435 \u0442\u043e\u043b\u044c\u043a\u043e \u043f\u0440\u0438 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0438 \u2265 8/10\n3. \u0423\u0447\u0438\u0442\u044b\u0432\u0430\u0439 \u0442\u0435\u043c\u0430\u0442\u0438\u043a\u0443: \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u043a\u0430\u2192\u0444\u043e\u0440\u043c\u0443\u043b\u044b, \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435\u2192\u043a\u043e\u0434, \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u044b\u2192\u0441\u0445\u0435\u043c\u044b\n4. \u041d\u0415 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0439 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u0435\u0441\u043b\u0438 \u043e\u043d \u043d\u0435 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0439 \u0446\u0435\u043d\u043d\u043e\u0441\u0442\u0438\n5. \u041f\u0440\u0438\u043e\u0440\u0438\u0442\u0435\u0442: \u0441\u043f\u0435\u0446\u0438\u0444\u0438\u0447\u043d\u043e\u0441\u0442\u044c > \u043e\u0431\u0449\u043d\u043e\u0441\u0442\u044c\n\nJSON \u043e\u0442\u0432\u0435\u0442:\n{\n  "cardMatches": [\n    {\n      "cardIndex": 0,\n      "relevantImages": [0],\n      "relevantFormulas": [],\n      "relevantCode": [],\n      "reasoning": "\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 1 \u043f\u0440\u044f\u043c\u043e \u0438\u043b\u043b\u044e\u0441\u0442\u0440\u0438\u0440\u0443\u0435\u0442 \u043a\u043e\u043d\u0446\u0435\u043f\u0442 \u0438\u0437 \u0432\u043e\u043f\u0440\u043e\u0441\u0430"\n    },\n    {\n      "cardIndex": 1,\n      "relevantImages": [],\n      "relevantFormulas": [0],\n      "relevantCode": [],\n      "reasoning": "\u0424\u043e\u0440\u043c\u0443\u043b\u0430 1 \u043e\u0431\u044a\u044f\u0441\u043d\u044f\u0435\u0442 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e\u0441\u0442\u044c \u0438\u0437 \u043e\u0442\u0432\u0435\u0442\u0430"\n    }\n  ]\n}'),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.cardContentMatcher.systemPrompt},{role:"user",content:a}])];case 2:if(!(null==(o=c.sent())?void 0:o.content))throw new Error("No response from card content matcher agent");return i=this.parseJSONResponse(o.content,"cardContentMatcher"),console.log("\u{1f3af} Card content matcher result:",i),[2,i];case 3:return l=c.sent(),console.error("Card content matcher error:",l),[2,{cardMatches:[]}];case 4:return[2]}}))}))},e.prototype.extractCardTopic=function(e,t){var n=(e+" "+t).toLowerCase();return n.includes("\u0444\u043e\u0440\u043c\u0443\u043b\u0430")||n.includes("\u0443\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u0435")||n.includes("\u043c\u0430\u0442\u0435\u043c\u0430\u0442")?"\u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u043a\u0430":n.includes("\u043a\u043e\u0434")||n.includes("\u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c")||n.includes("\u0430\u043b\u0433\u043e\u0440\u0438\u0442\u043c")?"\u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435":n.includes("\u0441\u0445\u0435\u043c\u0430")||n.includes("\u0434\u0438\u0430\u0433\u0440\u0430\u043c\u043c\u0430")||n.includes("\u043f\u0440\u043e\u0446\u0435\u0441\u0441")?"\u0441\u0445\u0435\u043c\u0430\u0442\u0438\u043a\u0430":n.includes("\u0438\u0441\u0442\u043e\u0440\u0438\u044f")||n.includes("\u0434\u0430\u0442\u0430")||n.includes("\u0441\u043e\u0431\u044b\u0442\u0438\u0435")?"\u0438\u0441\u0442\u043e\u0440\u0438\u044f":n.includes("\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435")||n.includes("\u043f\u043e\u043d\u044f\u0442\u0438\u0435")||n.includes("\u0442\u0435\u0440\u043c\u0438\u043d")?"\u0442\u0435\u043e\u0440\u0438\u044f":"\u043e\u0431\u0449\u0430\u044f"},e.prototype.executeTextAnalyst=function(e,t){var n,r,a;return Bn(this,void 0,void 0,(function(){var t,o,i,l,s,c,u,d,p;return Rn(this,(function(f){switch(f.label){case 0:t=e.text,o=e.pageContext,i=(null===(n=null==o?void 0:o.pageImages)||void 0===n?void 0:n.length)>0,l=(null===(r=null==o?void 0:o.formulas)||void 0===r?void 0:r.length)>0,s=(null===(a=null==o?void 0:o.codeBlocks)||void 0===a?void 0:a.length)>0,c="\u0422\u044b - Text Analyst Agent. \u041f\u0440\u043e\u0432\u0435\u0434\u0438 \u0433\u043b\u0443\u0431\u043e\u043a\u0438\u0439 \u0430\u043d\u0430\u043b\u0438\u0437 \u0442\u0435\u043a\u0441\u0442\u0430 \u0438 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438 \u043e\u043f\u0442\u0438\u043c\u0430\u043b\u044c\u043d\u0443\u044e \u0441\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u044e \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f.\n\n\u0422\u0415\u041a\u0421\u0422 \u0414\u041b\u042f \u0410\u041d\u0410\u041b\u0418\u0417\u0410 (".concat(t.length,' \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432):\n"').concat(t,'"\n\n\u0414\u041e\u0421\u0422\u0423\u041f\u041d\u042b\u0419 \u041c\u0423\u041b\u042c\u0422\u0418\u041c\u0415\u0414\u0418\u0410 \u041a\u041e\u041d\u0422\u0415\u041d\u0422:\n- \u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f: ').concat(i?o.pageImages.length:0," ").concat(i?"(\u0415\u0421\u0422\u042c - \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0443\u0447\u0442\u0438!)":"","\n- \u0424\u043e\u0440\u043c\u0443\u043b\u044b: ").concat(l?o.formulas.length:0,"\n- \u041a\u043e\u0434: ").concat(s?o.codeBlocks.length:0,'\n\n\u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n1. \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0438 \u043e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0442\u0435\u043c\u044b \u0438 \u0438\u0445 \u0432\u0430\u0436\u043d\u043e\u0441\u0442\u044c\n2. \u041e\u0446\u0435\u043d\u0438 \u0441\u043b\u043e\u0436\u043d\u043e\u0441\u0442\u044c \u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b\u0430\n3. \u0422\u041e\u0427\u041d\u041e \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438 \u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a \u0414\u0415\u0419\u0421\u0422\u0412\u0418\u0422\u0415\u041b\u042c\u041d\u041e \u043d\u0443\u0436\u043d\u043e (\u043d\u0435 \u043f\u0435\u0440\u0435\u0431\u043e\u0440\u0449\u0438!)\n4. \u0423\u0447\u0442\u0438 \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u0432 \u043f\u043b\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0438\n5. \u041f\u0440\u0438\u043e\u0440\u0438\u0442\u0438\u0437\u0438\u0440\u0443\u0439 \u0442\u0435\u043c\u044b\n\n\u041f\u0420\u0418\u041d\u0426\u0418\u041f\u042b:\n- \u0411\u043e\u043b\u044c\u0448\u043e\u0439 \u0442\u0435\u043a\u0441\u0442 \u2260 \u043c\u043d\u043e\u0433\u043e \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a\n- \u0424\u043e\u043a\u0443\u0441 \u043d\u0430 \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0445 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u0430\u0445 \u0434\u043b\u044f \u043f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u044f\n- \u0415\u0441\u043b\u0438 \u0435\u0441\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f - \u043e\u043d\u0438 \u0414\u041e\u041b\u0416\u041d\u042b \u0431\u044b\u0442\u044c \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u044b\n- \u041a\u0430\u0447\u0435\u0441\u0442\u0432\u043e > \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e\n\nJSON \u043e\u0442\u0432\u0435\u0442:\n{\n  "textLength": ').concat(t.length,',\n  "complexity": "medium",\n  "mainTopics": [\n    {\n      "name": "\u041e\u0441\u043d\u043e\u0432\u043d\u0430\u044f \u0442\u0435\u043c\u0430",\n      "importance": "critical",\n      "complexity": "medium",\n      "estimatedCards": 2,\n      "needsMultimedia": true,\n      "multimediaTypes": ["images"],\n      "subtopics": ["\u043f\u043e\u0434\u0442\u0435\u043c\u04301", "\u043f\u043e\u0434\u0442\u0435\u043c\u04302"]\n    }\n  ],\n  "estimatedCards": 3,\n  "learningObjectives": ["\u043f\u043e\u043d\u044f\u0442\u044c X", "\u0437\u0430\u043f\u043e\u043c\u043d\u0438\u0442\u044c Y"],\n  "hasMultimedia": ').concat(i||l||s,',\n  "multimediaTypes": [').concat(i?'"images"':"").concat(l?', "formulas"':"").concat(s?', "code"':"",'],\n  "priority": "high",\n  "reasoning": "\u041e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u0435 \u0441\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u0438"\n}'),f.label=1;case 1:return f.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.textAnalyst.systemPrompt},{role:"user",content:c}])];case 2:if(!(null==(u=f.sent())?void 0:u.content))throw new Error("No response from text analyst agent");return d=this.parseJSONResponse(u.content,"textAnalyst"),console.log("\u{1f4cb} Text analysis result:",d),[2,d];case 3:return p=f.sent(),console.error("Text analyst error:",p),[2,{textLength:t.length,complexity:this.estimateComplexity(t),mainTopics:[{name:"\u041e\u0441\u043d\u043e\u0432\u043d\u0430\u044f \u0442\u0435\u043c\u0430",importance:"important",complexity:"medium",estimatedCards:Math.min(5,Math.ceil(t.length/1e3)),needsMultimedia:i||l||s,multimediaTypes:On(On(On([],i?["images"]:[],!0),l?["formulas"]:[],!0),s?["code"]:[],!0),subtopics:[]}],estimatedCards:Math.min(5,Math.ceil(t.length/1e3)),learningObjectives:["\u041f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u0435 \u043e\u0441\u043d\u043e\u0432\u043d\u044b\u0445 \u043a\u043e\u043d\u0446\u0435\u043f\u0442\u043e\u0432"],hasMultimedia:i||l||s,multimediaTypes:On(On(On([],i?["images"]:[],!0),l?["formulas"]:[],!0),s?["code"]:[],!0),priority:"medium",reasoning:"Fallback analysis due to error"}];case 4:return[2]}}))}))},e.prototype.executeCardPlanner=function(e,t){var n,r,a,o,i,l,s,c,u,d,p,f;return Bn(this,void 0,void 0,(function(){var t,h,g,m,v,y,b;return Rn(this,(function(x){switch(x.label){case 0:t=e.textAnalysis,e.originalText,h=e.pageContext,g="\u0422\u044b - Card Planner Agent. \u0421\u043e\u0437\u0434\u0430\u0439 \u0434\u0435\u0442\u0430\u043b\u044c\u043d\u044b\u0439 \u043f\u043b\u0430\u043d \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u0430\u043d\u0430\u043b\u0438\u0437\u0430 \u0442\u0435\u043a\u0441\u0442\u0430.\n\n\u0410\u041d\u0410\u041b\u0418\u0417 \u0422\u0415\u041a\u0421\u0422\u0410:\n\u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0442\u0435\u043c\u044b: ".concat((null===(n=t.mainTopics)||void 0===n?void 0:n.map((function(e){return"".concat(e.name," (\u0432\u0430\u0436\u043d\u043e\u0441\u0442\u044c: ").concat(e.importance,")")})).join(", "))||"\u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0442\u0435\u043c\u044b","\n\u0420\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u043c\u043e\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a: ").concat(t.estimatedCards,"\n\u0421\u043b\u043e\u0436\u043d\u043e\u0441\u0442\u044c: ").concat(t.complexity,"\n\u0415\u0441\u0442\u044c \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430: ").concat(t.hasMultimedia?"\u0414\u0410":"\u041d\u0415\u0422","\n\u0422\u0438\u043f\u044b \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430: ").concat((null===(r=t.multimediaTypes)||void 0===r?void 0:r.join(", "))||"\u043d\u0435\u0442 \u0442\u0438\u043f\u043e\u0432","\n\n\u0414\u041e\u0421\u0422\u0423\u041f\u041d\u042b\u0419 \u041a\u041e\u041d\u0422\u0415\u041d\u0422:\n").concat((null===(a=null==h?void 0:h.pageImages)||void 0===a?void 0:a.length)>0?"- \u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f: ".concat(h.pageImages.length," (\u041f\u0420\u0418\u041e\u0420\u0418\u0422\u0415\u0422 - \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0432\u044b\u0434\u0435\u043b\u0438\u043b!)"):"","\n").concat((null===(o=null==h?void 0:h.formulas)||void 0===o?void 0:o.length)>0?"- \u0424\u043e\u0440\u043c\u0443\u043b\u044b: ".concat(h.formulas.length):"","\n").concat((null===(i=null==h?void 0:h.codeBlocks)||void 0===i?void 0:i.length)>0?"- \u041a\u043e\u0434: ".concat(h.codeBlocks.length):"",'\n\n\u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n1. \u0421\u043e\u0437\u0434\u0430\u0439 \u0442\u043e\u0447\u043d\u044b\u0439 \u043f\u043b\u0430\u043d \u043a\u0430\u0436\u0434\u043e\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438\n2. \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0438 \u0442\u0438\u043f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 (\u043a\u043e\u043d\u0446\u0435\u043f\u0442, \u043f\u0440\u0438\u043c\u0435\u0440, \u0444\u043e\u0440\u043c\u0443\u043b\u0430, \u043a\u043e\u0434)\n3. \u0421\u043f\u043b\u0430\u043d\u0438\u0440\u0443\u0439 \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430\n4. \u041e\u043f\u0442\u0438\u043c\u0438\u0437\u0438\u0440\u0443\u0439 \u0434\u043b\u044f \u044d\u0444\u0444\u0435\u043a\u0442\u0438\u0432\u043d\u043e\u0433\u043e \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f\n5. \u041e\u0411\u042f\u0417\u0410\u0422\u0415\u041b\u042c\u041d\u041e \u0432\u043a\u043b\u044e\u0447\u0438 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0435\u0441\u043b\u0438 \u043e\u043d\u0438 \u0435\u0441\u0442\u044c\n\n\u0422\u0418\u041f\u042b \u041a\u0410\u0420\u0422\u041e\u0427\u0415\u041a:\n- concept: \u043e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u043f\u043e\u043d\u044f\u0442\u0438\u044f (\u0441 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f\u043c\u0438/\u0441\u0445\u0435\u043c\u0430\u043c\u0438)\n- definition: \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u044f \u0442\u0435\u0440\u043c\u0438\u043d\u043e\u0432\n- formula: \u0444\u043e\u0440\u043c\u0443\u043b\u044b \u0438 \u0443\u0440\u0430\u0432\u043d\u0435\u043d\u0438\u044f (\u0441 \u0444\u043e\u0440\u043c\u0443\u043b\u0430\u043c\u0438)\n- code: \u043f\u0440\u0438\u043c\u0435\u0440\u044b \u043a\u043e\u0434\u0430 (\u0441 \u043a\u043e\u0434\u043e\u043c)\n- example: \u043f\u0440\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u043f\u0440\u0438\u043c\u0435\u0440\u044b\n- application: \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u0437\u043d\u0430\u043d\u0438\u0439\n\nJSON \u043e\u0442\u0432\u0435\u0442:\n{\n  "totalCards": 3,\n  "cardSpecs": [\n    {\n      "id": "card_1",\n      "type": "concept",\n      "topic": "\u041e\u0441\u043d\u043e\u0432\u043d\u043e\u0435 \u043f\u043e\u043d\u044f\u0442\u0438\u0435",\n      "priority": "high",\n      "difficulty": "medium",\n      "needsMultimedia": true,\n      "multimediaTypes": ["images"],\n      "estimatedLength": "medium",\n      "description": "\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u043e\u0431\u044a\u044f\u0441\u043d\u044f\u0435\u0442 \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0439 \u043a\u043e\u043d\u0446\u0435\u043f\u0442 \u0441 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435\u043c \u0441\u0445\u0435\u043c\u044b"\n    }\n  ],\n  "multimediaDistribution": {\n    "totalImages": ').concat((null===(l=null==h?void 0:h.pageImages)||void 0===l?void 0:l.length)||0,',\n    "totalFormulas": ').concat((null===(s=null==h?void 0:h.formulas)||void 0===s?void 0:s.length)||0,',\n    "totalCode": ').concat((null===(c=null==h?void 0:h.codeBlocks)||void 0===c?void 0:c.length)||0,',\n    "assignments": [],\n    "userSelectedImages": [0, 1],\n    "reasoning": "\u0420\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430"\n  },\n  "learningFlow": ["card_1", "card_2", "card_3"],\n  "reasoning": "\u041e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u0435 \u043f\u043b\u0430\u043d\u0430"\n}'),x.label=1;case 1:return x.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.cardPlanner.systemPrompt},{role:"user",content:g}])];case 2:if(!(null==(m=x.sent())?void 0:m.content))throw new Error("No response from card planner agent");return v=this.parseJSONResponse(m.content,"cardPlanner"),console.log("\u{1f4cb} Card plan result:",v),[2,v];case 3:return y=x.sent(),console.error("Card planner error:",y),[2,{totalCards:b=Math.min(t.estimatedCards,5),cardSpecs:Array.from({length:b},(function(e,n){return{id:"card_".concat(n+1),type:"concept",topic:"\u0422\u0435\u043c\u0430 ".concat(n+1),priority:"medium",difficulty:"medium",needsMultimedia:t.hasMultimedia,multimediaTypes:t.multimediaTypes||[],estimatedLength:"medium",description:"\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 ".concat(n+1)}})),multimediaDistribution:{totalImages:(null===(u=null==h?void 0:h.pageImages)||void 0===u?void 0:u.length)||0,totalFormulas:(null===(d=null==h?void 0:h.formulas)||void 0===d?void 0:d.length)||0,totalCode:(null===(p=null==h?void 0:h.codeBlocks)||void 0===p?void 0:p.length)||0,assignments:[],userSelectedImages:(null===(f=null==h?void 0:h.pageImages)||void 0===f?void 0:f.map((function(e,t){return t})))||[],reasoning:"Fallback distribution"},learningFlow:Array.from({length:b},(function(e,t){return"card_".concat(t+1)})),reasoning:"Fallback plan due to error"}];case 4:return[2]}}))}))},e.prototype.executeMathContentProcessor=function(e,t){return Bn(this,void 0,void 0,(function(){var t,n,r,a,o;return Rn(this,(function(i){switch(i.label){case 0:t=e.text,n='\u0422\u044b - Math Content Processor Agent. \u041e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u0439 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u0432 \u0442\u0435\u043a\u0441\u0442\u0435.\n\n\u0412\u0425\u041e\u0414\u041d\u041e\u0419 \u0422\u0415\u041a\u0421\u0422:\n"'.concat(t,'"\n\n\u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n1. \u041d\u0430\u0439\u0434\u0438 \u0432\u0441\u0435 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b \u0438 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u044f\n2. \u041f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u0443\u0439 \u0438\u0445 \u0432 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0439 LaTeX \u0444\u043e\u0440\u043c\u0430\u0442\n3. \u0421\u043e\u0437\u0434\u0430\u0439 \u0447\u0438\u0441\u0442\u044b\u0439 \u0442\u0435\u043a\u0441\u0442 \u0434\u043b\u044f \u0434\u0440\u0443\u0433\u0438\u0445 \u0430\u0433\u0435\u043d\u0442\u043e\u0432 (\u0437\u0430\u043c\u0435\u043d\u0438 \u0444\u043e\u0440\u043c\u0443\u043b\u044b \u043d\u0430 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u044f)\n4. \u0421\u043e\u0437\u0434\u0430\u0439 \u0442\u0435\u043a\u0441\u0442 \u0441 \u043f\u043b\u0435\u0439\u0441\u0445\u043e\u043b\u0434\u0435\u0440\u0430\u043c\u0438 \u0434\u043b\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u0433\u043e \u0440\u0435\u043d\u0434\u0435\u0440\u0438\u043d\u0433\u0430\n\n\u041f\u0420\u0418\u041c\u0415\u0420\u042b \u041f\u0420\u0415\u041e\u0411\u0420\u0410\u0417\u041e\u0412\u0410\u041d\u0418\u042f:\n- "3/4" \u2192 "\\frac{3}{4}"\n- "x^2 + y^2" \u2192 "x^{2} + y^{2}"\n- "m_a^2 + m_b^2 + m_c^2" \u2192 "m_{a}^{2} + m_{b}^{2} + m_{c}^{2}"\n- "(3/4) S" \u2192 "\\frac{3}{4} S"\n- "\u2211(x_i)" \u2192 "\\sum(x_{i})"\n- "\u221a(a\xb2 + b\xb2)" \u2192 "\\sqrt{a^{2} + b^{2}}"\n- "a^2 + b^2 + c^2" \u2192 "a^{2} + b^{2} + c^{2}"\n\nJSON \u041e\u0422\u0412\u0415\u0422:\n{\n  "cleanText": "\u0421\u0443\u043c\u043c\u0430 \u043a\u0432\u0430\u0434\u0440\u0430\u0442\u043e\u0432 \u043c\u0435\u0434\u0438\u0430\u043d \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u043b\u044c\u043d\u043e\u0433\u043e \u0442\u0440\u0435\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\u0430 \u0441\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u0442\u0440\u0438 \u0447\u0435\u0442\u0432\u0435\u0440\u0442\u0438 \u043e\u0442 \u0441\u0443\u043c\u043c\u044b \u043a\u0432\u0430\u0434\u0440\u0430\u0442\u043e\u0432 \u0435\u0433\u043e \u0441\u0442\u043e\u0440\u043e\u043d",\n  "formulas": [\n    {\n      "original": "m_a^2 + m_b^2 + m_c^2 = (3/4) S",\n      "latex": "m_{a}^{2} + m_{b}^{2} + m_{c}^{2} = \\frac{3}{4} S",\n      "type": "block",\n      "context": "\u043e\u0441\u043d\u043e\u0432\u043d\u0430\u044f \u0444\u043e\u0440\u043c\u0443\u043b\u0430 \u0442\u0435\u043e\u0440\u0435\u043c\u044b \u043e \u043c\u0435\u0434\u0438\u0430\u043d\u0430\u0445 \u0442\u0440\u0435\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\u0430"\n    }\n  ],\n  "processedContent": "\u0421\u0443\u043c\u043c\u0430 \u043a\u0432\u0430\u0434\u0440\u0430\u0442\u043e\u0432 \u043c\u0435\u0434\u0438\u0430\u043d \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u043b\u044c\u043d\u043e\u0433\u043e \u0442\u0440\u0435\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\u0430 \u0441\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 [FORMULA:0] \u043e\u0442 \u0441\u0443\u043c\u043c\u044b \u043a\u0432\u0430\u0434\u0440\u0430\u0442\u043e\u0432 \u0435\u0433\u043e \u0441\u0442\u043e\u0440\u043e\u043d"\n}'),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.mathContentProcessor.systemPrompt},{role:"user",content:n}])];case 2:if(!(null==(r=i.sent())?void 0:r.content))throw new Error("No response from math content processor agent");return a=this.parseJSONResponse(r.content,"mathContentProcessor"),console.log("\u{1f522} Math content processor result:",a),[2,a];case 3:return o=i.sent(),console.error("Math content processor error:",o),[2,{cleanText:t,formulas:[],processedContent:t}];case 4:return[2]}}))}))},e.prototype.executeFormulaEnhancer=function(e,t){return Bn(this,void 0,void 0,(function(){var t,n,r,a,o,i;return Rn(this,(function(l){switch(l.label){case 0:t=e.cards,n=e.mathContent,e.originalText,r="\u0422\u044b - Formula Enhancer Agent. \u0418\u043d\u0442\u0435\u0433\u0440\u0438\u0440\u0443\u0439 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b \u0432 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438.\n\n\u041c\u0410\u0422\u0415\u041c\u0410\u0422\u0418\u0427\u0415\u0421\u041a\u0418\u0419 \u041a\u041e\u041d\u0422\u0415\u041d\u0422:\n".concat(n?'\u0427\u0438\u0441\u0442\u044b\u0439 \u0442\u0435\u043a\u0441\u0442: "'.concat(n.cleanText,'"\n\u0424\u043e\u0440\u043c\u0443\u043b\u044b: ').concat(JSON.stringify(n.formulas,null,2)):"\u041c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0433\u043e \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430 \u043d\u0435\u0442","\n\n\u041a\u0410\u0420\u0422\u041e\u0427\u041a\u0418 \u0414\u041b\u042f \u041e\u0411\u0420\u0410\u0411\u041e\u0422\u041a\u0418:\n").concat(t.map((function(e,t){return"\n\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 ".concat(t+1,":\n\u0412\u043e\u043f\u0440\u043e\u0441: ").concat(e.front,"\n\u041e\u0442\u0432\u0435\u0442: ").concat(e.back,"\n")})).join(""),'\n\n\u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n1. \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0438, \u043a\u0430\u043a\u0438\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b \u043d\u0443\u0436\u043d\u044b \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438\n2. \u0412\u0441\u0442\u0430\u0432\u044c \u0421\u041f\u0415\u0426\u0418\u0410\u041b\u042c\u041d\u0423\u042e \u041c\u0410\u0420\u041a\u0418\u0420\u041e\u0412\u041a\u0423 \u0444\u043e\u0440\u043c\u0443\u043b \u0432 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0435 \u043c\u0435\u0441\u0442\u0430\n3. \u041e\u0431\u0435\u0441\u043f\u0435\u0447\u044c \u043b\u043e\u0433\u0438\u0447\u043d\u043e\u0435 \u0438 \u043a\u0440\u0430\u0441\u0438\u0432\u043e\u0435 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\n4. \u041d\u0415 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0439 \u0444\u043e\u0440\u043c\u0443\u043b\u044b, \u0435\u0441\u043b\u0438 \u043e\u043d\u0438 \u043d\u0435 \u043d\u0443\u0436\u043d\u044b\n\n\u0421\u0422\u0420\u041e\u0413\u0418\u0415 \u041f\u0420\u0410\u0412\u0418\u041b\u0410:\n- \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0439 \u0444\u043e\u0440\u043c\u0443\u043b\u0443 \u0422\u041e\u041b\u042c\u041a\u041e \u0435\u0441\u043b\u0438 \u043e\u043d\u0430 \u043d\u0430\u043f\u0440\u044f\u043c\u0443\u044e \u043e\u0442\u043d\u043e\u0441\u0438\u0442\u0441\u044f \u043a \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0435\n- \u041d\u0415 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0439 \u0444\u043e\u0440\u043c\u0443\u043b\u044b "\u043d\u0430 \u0432\u0441\u044f\u043a\u0438\u0439 \u0441\u043b\u0443\u0447\u0430\u0439"\n- \u041e\u0434\u043d\u0430 \u0444\u043e\u0440\u043c\u0443\u043b\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0443 \u043c\u0430\u043a\u0441\u0438\u043c\u0443\u043c (\u0435\u0441\u043b\u0438 \u0432\u043e\u043e\u0431\u0449\u0435 \u043d\u0443\u0436\u043d\u0430)\n- \u0424\u043e\u0440\u043c\u0443\u043b\u0430 \u0434\u043e\u043b\u0436\u043d\u0430 \u043f\u043e\u043c\u043e\u0433\u0430\u0442\u044c \u043f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u044e, \u0430 \u043d\u0435 \u0437\u0430\u0433\u0440\u043e\u043c\u043e\u0436\u0434\u0430\u0442\u044c\n- \u0415\u0441\u043b\u0438 \u0432 \u043e\u0442\u0432\u0435\u0442\u0435 \u0443\u0436\u0435 \u0435\u0441\u0442\u044c \u0442\u0435\u043a\u0441\u0442\u043e\u0432\u0430\u044f \u0444\u043e\u0440\u043c\u0443\u043b\u0430 - \u041d\u0415 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0439 LaTeX \u0432\u0435\u0440\u0441\u0438\u044e\n\n\u041f\u0420\u0410\u0412\u0418\u041b\u0410 \u0421\u041f\u0415\u0426\u0418\u0410\u041b\u042c\u041d\u041e\u0419 \u041c\u0410\u0420\u041a\u0418\u0420\u041e\u0412\u041a\u0418:\n- \u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b: [MATH:\u0444\u043e\u0440\u043c\u0443\u043b\u0430][/MATH]\n- \u041f\u0440\u043e\u043c\u0435\u0436\u0443\u0442\u043e\u0447\u043d\u044b\u0435 \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u044f: [MATH:inline:\u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0435][/MATH]\n- \u041f\u0440\u0438\u043c\u0435\u0440\u044b: [MATH:example:\u043f\u0440\u0438\u043c\u0435\u0440][/MATH]\n\n\u041f\u0420\u0410\u0412\u0418\u041b\u0410 \u0420\u0410\u0417\u041c\u0415\u0429\u0415\u041d\u0418\u042f:\n- \u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b: \u0432 \u043d\u0430\u0447\u0430\u043b\u0435 \u043e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u044f\n- \u041f\u0440\u043e\u043c\u0435\u0436\u0443\u0442\u043e\u0447\u043d\u044b\u0435 \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u044f: \u0432 \u0441\u0435\u0440\u0435\u0434\u0438\u043d\u0435 \u0442\u0435\u043a\u0441\u0442\u0430\n- \u0418\u0442\u043e\u0433\u043e\u0432\u044b\u0435 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b: \u0432 \u043a\u043e\u043d\u0446\u0435 \u043e\u0442\u0432\u0435\u0442\u0430\n\n\u041f\u041b\u041e\u0425\u0418\u0415 \u041f\u0420\u0418\u041c\u0415\u0420\u042b (\u041d\u0415 \u0414\u0415\u041b\u0410\u0422\u042c):\n\u274c \u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b \u043a \u043a\u0430\u0436\u0434\u043e\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0435\n\u274c \u0414\u0443\u0431\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0442\u0435\u043a\u0441\u0442\u043e\u0432\u043e\u0439 \u0444\u043e\u0440\u043c\u0443\u043b\u044b LaTeX \u0432\u0435\u0440\u0441\u0438\u0435\u0439\n\u274c \u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043d\u0435\u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u044b\u0445 \u0444\u043e\u0440\u043c\u0443\u043b\n\n\u0425\u041e\u0420\u041e\u0428\u0418\u0415 \u041f\u0420\u0418\u041c\u0415\u0420\u042b:\n\u2705 "\u0421\u0443\u043c\u043c\u0430 \u043a\u0432\u0430\u0434\u0440\u0430\u0442\u043e\u0432 \u043c\u0435\u0434\u0438\u0430\u043d \u0440\u0430\u0432\u043d\u0430 [MATH:\u043e\u0441\u043d\u043e\u0432\u043d\u0430\u044f_\u0444\u043e\u0440\u043c\u0443\u043b\u0430][/MATH]" (\u0435\u0441\u043b\u0438 \u0444\u043e\u0440\u043c\u0443\u043b\u0430 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043d\u0443\u0436\u043d\u0430)\n\u2705 \u041e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0443 \u0431\u0435\u0437 \u0444\u043e\u0440\u043c\u0443\u043b\u044b, \u0435\u0441\u043b\u0438 \u0442\u0435\u043a\u0441\u0442 \u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e \u043f\u043e\u043d\u044f\u0442\u0435\u043d\n\nJSON \u041e\u0422\u0412\u0415\u0422:\n{\n  "enhancedCards": [\n    {\n      "front": "\u0412\u043e\u043f\u0440\u043e\u0441 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438",\n      "back": "\u041e\u0442\u0432\u0435\u0442 \u0441 [MATH:\u043e\u0441\u043d\u043e\u0432\u043d\u0430\u044f_\u0444\u043e\u0440\u043c\u0443\u043b\u0430][/MATH] \u0432 \u043d\u0443\u0436\u043d\u043e\u043c \u043c\u0435\u0441\u0442\u0435 (\u0442\u043e\u043b\u044c\u043a\u043e \u0435\u0441\u043b\u0438 \u0444\u043e\u0440\u043c\u0443\u043b\u0430 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043d\u0443\u0436\u043d\u0430)",\n      "formulasUsed": [0],\n      "reasoning": "\u0414\u043e\u0431\u0430\u0432\u0438\u043b \u0444\u043e\u0440\u043c\u0443\u043b\u0443 \u0442\u043e\u043b\u044c\u043a\u043e \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e \u043e\u043d\u0430 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u043e \u043f\u043e\u043c\u043e\u0433\u0430\u0435\u0442 \u043f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u044e"\n    }\n  ]\n}'),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.formulaEnhancer.systemPrompt},{role:"user",content:r}])];case 2:if(!(null==(a=l.sent())?void 0:a.content))throw new Error("No response from formula enhancer agent");return o=this.parseJSONResponse(a.content,"formulaEnhancer"),console.log("\u{1f4d0} Formula enhancer result:",o),[2,o];case 3:return i=l.sent(),console.error("Formula enhancer error:",i),[2,{enhancedCards:t}];case 4:return[2]}}))}))},e.prototype.executeMultimediaAssigner=function(e,t){var n,r,a,o,i,l,s,c,u,d;return Bn(this,void 0,void 0,(function(){var t,p,f,h,g,m,v,y,b,x;return Rn(this,(function(w){switch(w.label){case 0:t=e.cardPlan,p=e.pageContext,e.originalText,f="\u0422\u044b - Multimedia Assigner Agent. \u0422\u043e\u0447\u043d\u043e \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0438 \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u043f\u043e \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430\u043c.\n\n\u041f\u041b\u0410\u041d \u041a\u0410\u0420\u0422\u041e\u0427\u0415\u041a:\n".concat(t.cardSpecs.map((function(e,t){var n;return"\n\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 ".concat(t+1," (").concat(e.id,"):\n- \u0422\u0438\u043f: ").concat(e.type,"\n- \u0422\u0435\u043c\u0430: ").concat(e.topic,"\n- \u041d\u0443\u0436\u0435\u043d \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430: ").concat(e.needsMultimedia?"\u0414\u0410":"\u041d\u0415\u0422","\n- \u0422\u0438\u043f\u044b: ").concat((null===(n=e.multimediaTypes)||void 0===n?void 0:n.join(", "))||"\u043d\u0435\u0442 \u0442\u0438\u043f\u043e\u0432","\n- \u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435: ").concat(e.description,"\n")})).join(""),"\n\n\u0414\u041e\u0421\u0422\u0423\u041f\u041d\u042b\u0419 \u041c\u0423\u041b\u042c\u0422\u0418\u041c\u0415\u0414\u0418\u0410:\n").concat((null===(n=null==p?void 0:p.pageImages)||void 0===n?void 0:n.length)>0?"\n\u0418\u0417\u041e\u0411\u0420\u0410\u0416\u0415\u041d\u0418\u042f (".concat(p.pageImages.length,") - \u041f\u0420\u0418\u041e\u0420\u0418\u0422\u0415\u0422:\n").concat(p.pageImages.map((function(e,t){return"".concat(t,'. "').concat(e.alt||"\u0431\u0435\u0437 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u044f",'" (\u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u043e\u0441\u0442\u044c: ').concat(e.relevanceScore,"/10)")})).join("\n"),"\n"):"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f: \u043d\u0435\u0442","\n\n").concat((null===(r=null==p?void 0:p.formulas)||void 0===r?void 0:r.length)>0?"\n\u0424\u041e\u0420\u041c\u0423\u041b\u042b (".concat(p.formulas.length,"):\n").concat(p.formulas.map((function(e,t){return"".concat(t,'. "').concat(e.text,'" (\u0442\u0438\u043f: ').concat(e.type,")")})).join("\n"),"\n"):"\u0424\u043e\u0440\u043c\u0443\u043b\u044b: \u043d\u0435\u0442","\n\n").concat((null===(a=null==p?void 0:p.codeBlocks)||void 0===a?void 0:a.length)>0?"\n\u041a\u041e\u0414 (".concat(p.codeBlocks.length,"):\n").concat(p.codeBlocks.map((function(e,t){return"".concat(t,". ").concat(e.language||"text",': "').concat(e.code.substring(0,60),'..."')})).join("\n"),"\n"):"\u041a\u043e\u0434: \u043d\u0435\u0442",'\n\n\u041e\u0421\u041e\u0411\u042b\u0415 \u0422\u0420\u0415\u0411\u041e\u0412\u0410\u041d\u0418\u042f:\n- \u0415\u0441\u043b\u0438 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0432\u044b\u0434\u0435\u043b\u0438\u043b \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 - \u043e\u043d\u043e \u0414\u041e\u041b\u0416\u041d\u041e \u043f\u043e\u043f\u0430\u0441\u0442\u044c \u0432 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0443\n- \u041a\u0430\u0436\u0434\u043e\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u0438\u043c\u0435\u0442\u044c \u0447\u0435\u0442\u043a\u0443\u044e \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u0443\u044e \u0446\u0435\u043b\u044c\n- \u0420\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0439 \u043a\u043e\u043d\u0442\u0435\u043d\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u043f\u0440\u0438 \u0432\u044b\u0441\u043e\u043a\u043e\u0439 \u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u043e\u0441\u0442\u0438 (\u22658/10)\n- \u041e\u0434\u0438\u043d \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u043c\u0443\u043b\u044c\u0442\u0438\u043c\u0435\u0434\u0438\u0430 \u043c\u043e\u0436\u0435\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u0432 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u0445 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430\u0445 \u0435\u0441\u043b\u0438 \u044d\u0442\u043e \u043e\u043f\u0440\u0430\u0432\u0434\u0430\u043d\u043e\n\nJSON \u043e\u0442\u0432\u0435\u0442:\n{\n  "totalImages": ').concat((null===(o=null==p?void 0:p.pageImages)||void 0===o?void 0:o.length)||0,',\n  "totalFormulas": ').concat((null===(i=null==p?void 0:p.formulas)||void 0===i?void 0:i.length)||0,',\n  "totalCode": ').concat((null===(l=null==p?void 0:p.codeBlocks)||void 0===l?void 0:l.length)||0,',\n  "assignments": [\n    {\n      "cardId": "card_1",\n      "imageIndices": [0],\n      "formulaIndices": [],\n      "codeIndices": [],\n      "reasoning": "\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 0 \u043f\u0440\u044f\u043c\u043e \u0438\u043b\u043b\u044e\u0441\u0442\u0440\u0438\u0440\u0443\u0435\u0442 \u043a\u043e\u043d\u0446\u0435\u043f\u0442 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438"\n    }\n  ],\n  "userSelectedImages": [').concat((null===(s=null==p?void 0:p.pageImages)||void 0===s?void 0:s.map((function(e,t){return t})).join(", "))||"",'],\n  "reasoning": "\u041e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u0435 \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u044f"\n}'),w.label=1;case 1:return w.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.multimediaAssigner.systemPrompt},{role:"user",content:f}])];case 2:if(!(null==(h=w.sent())?void 0:h.content))throw new Error("No response from multimedia assigner agent");return g=this.parseJSONResponse(h.content,"multimediaAssigner"),console.log("\u{1f3af} Multimedia assignment result:",g),[2,g];case 3:return m=w.sent(),console.error("Multimedia assigner error:",m),v=[],y=(null===(c=null==p?void 0:p.pageImages)||void 0===c?void 0:c.length)||0,b=(null===(u=null==p?void 0:p.formulas)||void 0===u?void 0:u.length)||0,x=(null===(d=null==p?void 0:p.codeBlocks)||void 0===d?void 0:d.length)||0,t.cardSpecs.forEach((function(e,n){var r={cardId:e.id,imageIndices:[],formulaIndices:[],codeIndices:[],reasoning:"Fallback assignment"};if(e.needsMultimedia&&Array.isArray(e.multimediaTypes)&&e.multimediaTypes.includes("images")&&y>0){var a=Math.ceil(y/t.cardSpecs.length),o=n*a,i=Math.min(o+a,y);r.imageIndices=Array.from({length:i-o},(function(e,t){return o+t}))}v.push(r)})),[2,{totalImages:y,totalFormulas:b,totalCode:x,assignments:v,userSelectedImages:Array.from({length:y},(function(e,t){return t})),reasoning:"Fallback distribution due to error"}];case 4:return[2]}}))}))},e.prototype.getMatchedContentForCard=function(e,t){if(!t||!t.cardMatches)return"\u043d\u0435\u0442 \u0440\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0430\u0446\u0438\u0439";var n=t.cardMatches.find((function(t){return t.cardIndex===e}));if(!n)return"\u043d\u0435\u0442 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0439";var r=[];return n.relevantImages&&Array.isArray(n.relevantImages)&&n.relevantImages.length>0&&r.push("\u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f [".concat(n.relevantImages.join(", "),"]")),n.relevantFormulas&&Array.isArray(n.relevantFormulas)&&n.relevantFormulas.length>0&&r.push("\u0444\u043e\u0440\u043c\u0443\u043b\u044b [".concat(n.relevantFormulas.join(", "),"]")),n.relevantCode&&Array.isArray(n.relevantCode)&&n.relevantCode.length>0&&r.push("\u043a\u043e\u0434 [".concat(n.relevantCode.join(", "),"]")),r.length>0?r.join(", "):"\u043d\u0435\u0442 \u043f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0435\u0433\u043e \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430"},e.prototype.detectLanguage=function(e){return/[\u0430-\u044f\u0451]/i.test(e)?"russian":"english"},e.prototype.estimateComplexity=function(e){var t=e.split(/\s+/).length,n=t/e.split(/[.!?]+/).length;return n<10&&t<100?"simple":n<20&&t<500?"medium":"advanced"},e.prototype.parseJSONResponse=function(e,t){try{var n=e.match(/\{[\s\S]*\}/);if(!n)throw new Error("No JSON found in ".concat(t," response"));return JSON.parse(n[0])}catch(e){throw console.error("Error parsing ".concat(t," response:"),e),e}},e.prototype.createFallbackSupervisorDecision=function(){return{strategy:"multiple_concepts",agents:["contentAnalyzer","cardGenerator","questionQuality","validator"],instructions:{contentAnalyzer:"\u041f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u043f\u043e\u043d\u044f\u0442\u0438\u044f \u0432 \u0442\u0435\u043a\u0441\u0442\u0435",cardGenerator:"\u0421\u043e\u0437\u0434\u0430\u0439 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 \u0434\u043b\u044f \u043e\u0441\u043d\u043e\u0432\u043d\u044b\u0445 \u043f\u043e\u043d\u044f\u0442\u0438\u0439",questionQuality:"\u041f\u0440\u043e\u0432\u0435\u0440\u044c \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u043e \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0432\u043e\u043f\u0440\u043e\u0441\u0430",validator:"\u041f\u0440\u043e\u0432\u0435\u0434\u0438 \u0444\u0438\u043d\u0430\u043b\u044c\u043d\u0443\u044e \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443"},expectedOutput:"\u041d\u0430\u0431\u043e\u0440 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0445 \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a",reasoning:"Fallback strategy - general approach"}},e.prototype.createFallbackContentAnalysis=function(e){return{mainTopic:"\u0410\u043d\u0430\u043b\u0438\u0437 \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430",keyPoints:[e.substring(0,100)],concepts:[{name:"\u041e\u0441\u043d\u043e\u0432\u043d\u043e\u0439 \u043a\u043e\u043d\u0446\u0435\u043f\u0442",definition:e.substring(0,200),importance:"medium",prerequisites:[],examples:[]}],relationships:[],learningObjectives:["\u041f\u043e\u043d\u044f\u0442\u044c \u043e\u0441\u043d\u043e\u0432\u043d\u0443\u044e \u0438\u0434\u0435\u044e"],complexity:"medium",estimatedCards:2}},e.prototype.createFallbackCards=function(e){return[{front:"What is discussed in this text?",back:e.substring(0,200)+(e.length>200?"...":""),difficulty:"medium",concept:"Main idea"}]},e.prototype.createFallbackQualityCheck=function(e){return{question:e.front,answer:e.back,qualityScore:7,relevanceScore:7,difficultyScore:7,issues:[],improvements:[],isWorthwhile:!0,reasoning:"Fallback quality check - acceptable card"}},e.prototype.createFallbackValidation=function(e){return{isValid:!0,overallScore:75,cardScores:e.reduce((function(e,t,n){var r;return jn(jn({},e),((r={})[n]=75,r))}),{}),issues:[],suggestions:[],finalRecommendation:"Cards passed basic validation"}},e.prototype.createFallbackContentEnhancement=function(){return{shouldIncludeImages:!1,selectedImages:[],shouldIncludeFormulas:!1,selectedFormulas:[],shouldIncludeCode:!1,selectedCode:[],reasoning:"Fallback - no multimedia content analysis"}},e.prototype.processLatexInCards=function(e){return Bn(this,void 0,void 0,(function(){var t,r,a,o=this;return Rn(this,(function(i){switch(i.label){case 0:return[4,Promise.resolve().then(n.bind(n,984))];case 1:return t=i.sent(),r=t.processLatexInContentAsync,a=t.processLatexInContent,[4,Promise.all(e.map((function(e){return Bn(o,void 0,void 0,(function(){var t,n;return Rn(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),n=e.back,n=this.processMathMarkers(n),[4,r(n)];case 1:return((n=o.sent()).includes("background: #FEF2F2")||n.includes("color: #DC2626"))&&(console.log("\u26a0\ufe0f KaTeX failed, using sync fallback for card"),n=a(e.back),n=this.processMathMarkers(n),n=a(n)),console.log("\u{1f3a8} LaTeX processed for card:",e.front.substring(0,30)+"..."),[2,jn(jn({},e),{back:n})];case 2:t=o.sent(),console.warn("LaTeX processing error for card:",t);try{return n=e.back,n=this.processMathMarkers(n),n=a(n),[2,jn(jn({},e),{back:n})]}catch(t){return console.warn("Even sync LaTeX processing failed:",t),[2,e]}return[3,3];case 3:return[2]}}))}))})))];case 2:return[2,i.sent()]}}))}))},e.prototype.processMathMarkers=function(e){var t=this,n=e;return n=(n=(n=(n=n.replace(/\\n/g,"\n")).replace(/\[MATH\s*:\s*([\s\S]*?)\s*\]\s*\[\/MATH\]/gi,(function(e,n){var r=t.convertMathDescriptionToLatex(n);return"$$".concat(r,"$$")}))).replace(/\[MATH\s*:\s*inline\s*:\s*([\s\S]*?)\s*\]\s*\[\/MATH\]/gi,(function(e,n){var r=t.convertMathDescriptionToLatex(n);return"$".concat(r,"$")}))).replace(/\[MATH\s*:\s*example\s*:\s*([\s\S]*?)\s*\]\s*\[\/MATH\]/gi,(function(e,n){var r=t.convertMathDescriptionToLatex(n);return'<div style="border: 2px solid #3B82F6; border-radius: 8px; padding: 12px; margin: 8px 0; background: #F0F9FF;">$$'.concat(r,"$$</div>")}))},e.prototype.convertMathDescriptionToLatex=function(e){var t={\u043e\u0441\u043d\u043e\u0432\u043d\u0430\u044f_\u0444\u043e\u0440\u043c\u0443\u043b\u0430:"m_{a}^{2} + m_{b}^{2} + m_{c}^{2} = \\frac{3}{4} S","m_a^2 + m_b^2 + m_c^2 = 3/4 S":"m_{a}^{2} + m_{b}^{2} + m_{c}^{2} = \\frac{3}{4} S",\u0442\u0435\u043e\u0440\u0435\u043c\u0430_\u043e_\u043c\u0435\u0434\u0438\u0430\u043d\u0430\u0445:"m_{a}^{2} + m_{b}^{2} + m_{c}^{2} = \\frac{3}{4} S",\u0441\u0443\u043c\u043c\u0430_\u043a\u0432\u0430\u0434\u0440\u0430\u0442\u043e\u0432_\u043c\u0435\u0434\u0438\u0430\u043d:"m_{a}^{2} + m_{b}^{2} + m_{c}^{2}",\u043b\u0435\u0432\u0430\u044f_\u0447\u0430\u0441\u0442\u044c:"m_{a}^{2} + m_{b}^{2} + m_{c}^{2}",\u043f\u0440\u0430\u0432\u0430\u044f_\u0447\u0430\u0441\u0442\u044c:"\\frac{3}{4} S","3/4":"\\frac{3}{4}",\u0442\u0440\u0438_\u0447\u0435\u0442\u0432\u0435\u0440\u0442\u044b\u0445:"\\frac{3}{4}",\u043e\u0434\u043d\u0430_\u0447\u0435\u0442\u0432\u0435\u0440\u0442\u0430\u044f:"\\frac{1}{4}",\u0434\u0432\u0435_\u0442\u0440\u0435\u0442\u0438:"\\frac{2}{3}","m_a^2":"m_{a}^{2}","m_b^2":"m_{b}^{2}","m_c^2":"m_{c}^{2}",\u043c\u0435\u0434\u0438\u0430\u043d\u0430_a:"m_{a}",\u043c\u0435\u0434\u0438\u0430\u043d\u0430_b:"m_{b}",\u043c\u0435\u0434\u0438\u0430\u043d\u0430_c:"m_{c}",\u043a\u0432\u0430\u0434\u0440\u0430\u0442_\u0441\u0442\u043e\u0440\u043e\u043d\u044b_a:"a^{2}",\u043a\u0432\u0430\u0434\u0440\u0430\u0442_\u0441\u0442\u043e\u0440\u043e\u043d\u044b_b:"b^{2}",\u043a\u0432\u0430\u0434\u0440\u0430\u0442_\u0441\u0442\u043e\u0440\u043e\u043d\u044b_c:"c^{2}",\u0441\u0443\u043c\u043c\u0430_\u0441\u0442\u043e\u0440\u043e\u043d:"a + b + c",\u043f\u043b\u043e\u0449\u0430\u0434\u044c_\u0442\u0440\u0435\u0443\u0433\u043e\u043b\u044c\u043d\u0438\u043a\u0430:"S"};if(t[e])return t[e];var n=e.replace(/\s+/g,"_").toLowerCase();if(t[n])return t[n];if(e.includes("\\")||e.includes("_")||e.includes("^"))return e;var r=this.autoConvertToLatex(e);return r!==e?r:(console.log("\u26a0\ufe0f Unknown math description: ".concat(e)),e)},e.prototype.autoConvertToLatex=function(e){var t=e;return t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/(\w+)\^(\w+)/g,"$1^{$2}")).replace(/(\w+)_([a-zA-Z])/g,"$1_{$2}")).replace(/(\d+)\/(\d+)/g,"\\frac{$1}{$2}")).replace(/\+/g," + ")).replace(/-/g," - ")).replace(/\*/g," \\cdot ")).replace(/\xd7/g," \\times ")).replace(/\xf7/g," \\div ")).replace(/\|/g," \\mid ")},e.prototype.executeContentAnalyzer=function(e,t){return Bn(this,void 0,void 0,(function(){var t,n,r,a;return Rn(this,(function(o){switch(o.label){case 0:t='\u0422\u044b - Content Analyzer Agent. \u041f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0439 \u0442\u0435\u043a\u0441\u0442 \u0438 \u0441\u043e\u0441\u0442\u0430\u0432\u044c \u043f\u043b\u0430\u043d \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432.\n\n\u0412\u042b\u0414\u0415\u041b\u0415\u041d\u041d\u042b\u0419 \u0422\u0415\u041a\u0421\u0422:\n"'.concat(e,'"\n\n\u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n1. \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c \u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a \u043d\u0443\u0436\u043d\u043e \u0441\u043e\u0437\u0434\u0430\u0442\u044c (1-5)\n2. \u0420\u0430\u0437\u0434\u0435\u043b\u0438\u0442\u044c \u0442\u0435\u043a\u0441\u0442 \u043d\u0430 \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0447\u0430\u0441\u0442\u0438\n3. \u0414\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0439 \u0447\u0430\u0441\u0442\u0438 \u0441\u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0439 \u0432\u043e\u043f\u0440\u043e\u0441\n4. \u0423\u0431\u0435\u0434\u0438\u0442\u044c\u0441\u044f \u0447\u0442\u043e \u0432\u043e\u043f\u0440\u043e\u0441\u044b \u043e\u0441\u043d\u043e\u0432\u0430\u043d\u044b \u0422\u041e\u041b\u042c\u041a\u041e \u043d\u0430 \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u043d\u0438\u0438 \u0442\u0435\u043a\u0441\u0442\u0430\n\n\u041f\u0420\u0410\u0412\u0418\u041b\u0410:\n- \u041c\u0438\u043d\u0438\u043c\u0443\u043c 1 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430, \u043c\u0430\u043a\u0441\u0438\u043c\u0443\u043c 5\n- \u0412\u043e\u043f\u0440\u043e\u0441\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u043f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u0435, \u043d\u0435 \u043f\u0430\u043c\u044f\u0442\u044c\n- \u041a\u0430\u0436\u0434\u044b\u0439 \u0432\u043e\u043f\u0440\u043e\u0441 \u0441\u0432\u044f\u0437\u0430\u043d \u0441 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0439 \u0447\u0430\u0441\u0442\u044c\u044e \u0442\u0435\u043a\u0441\u0442\u0430\n\nJSON \u041e\u0422\u0412\u0415\u0422:\n{\n  "questions": [\n    {\n      "question": "\u041a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0439 \u0432\u043e\u043f\u0440\u043e\u0441 \u043f\u043e \u0442\u0435\u043a\u0441\u0442\u0443",\n      "textChunk": "\u0421\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0439 \u043a\u0443\u0441\u043e\u043a \u0442\u0435\u043a\u0441\u0442\u0430",\n      "priority": "high|medium|low"\n    }\n  ],\n  "analysis": {\n    "totalCards": 3,\n    "mainTopics": ["\u0442\u0435\u043c\u04301", "\u0442\u0435\u043c\u04302"],\n    "complexity": "medium"\n  }\n}'),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.contentAnalyzer.systemPrompt},{role:"user",content:t}])];case 2:if(!(null==(n=o.sent())?void 0:n.content))throw new Error("No response from content analyzer");return r=this.parseJSONResponse(n.content,"contentAnalyzer"),console.log("\u{1f9e0} Content analysis result:",r),[2,r];case 3:return a=o.sent(),console.error("Content analyzer error:",a),[2,{mainTopic:"\u0410\u043d\u0430\u043b\u0438\u0437 \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u0442\u0435\u043a\u0441\u0442\u0430",keyPoints:[e.substring(0,100)],concepts:[],relationships:[],learningObjectives:["\u041f\u043e\u043d\u044f\u0442\u044c \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u043d\u0438\u0435 \u0442\u0435\u043a\u0441\u0442\u0430"],complexity:"medium",estimatedCards:1,questions:[{question:"\u0427\u0442\u043e \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043e\u0441\u043d\u043e\u0432\u043d\u044b\u043c \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u043d\u0438\u0435\u043c \u044d\u0442\u043e\u0433\u043e \u0442\u0435\u043a\u0441\u0442\u0430?",textChunk:e,priority:"high"}],analysis:{totalCards:1,mainTopics:["\u043e\u0431\u0449\u0435\u0435"],complexity:"medium"}}];case 4:return[2]}}))}))},e.prototype.executeParallelCardGeneration=function(e,t,n){return Bn(this,void 0,void 0,(function(){var r,a,o,i,l=this;return Rn(this,(function(s){switch(s.label){case 0:if(!(r=e.questions)||0===r.length)throw new Error("\u041d\u0435\u0442 \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432 \u0434\u043b\u044f \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u0438 \u043a\u0430\u0440\u0442\u043e\u0447\u0435\u043a");return console.log("\u{1f504} Generating ".concat(r.length," cards in parallel...")),a=r.map((function(e,r){return Bn(l,void 0,void 0,(function(){var a;return Rn(this,(function(o){switch(o.label){case 0:if(null==n?void 0:n.aborted)throw new Error("Generation cancelled");o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.generateSingleCard(e,t,r)];case 2:return[2,o.sent()];case 3:return a=o.sent(),console.warn("Failed to generate card ".concat(r+1,":"),a),[2,null];case 4:return[2]}}))}))})),[4,Promise.all(a)];case 1:return o=s.sent(),i=o.filter((function(e){return null!==e})),console.log("\u2705 Generated ".concat(i.length,"/").concat(r.length," cards successfully")),[2,i]}}))}))},e.prototype.generateSingleCard=function(e,t,n){return Bn(this,void 0,void 0,(function(){var t,r,a,o,i,l;return Rn(this,(function(s){switch(s.label){case 0:t=e.question,r=e.textChunk,a="\u0422\u044b - Card Generator Agent. \u0421\u043e\u0437\u0434\u0430\u0439 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u0443\u044e \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0443.\n\n\u0412\u041e\u041f\u0420\u041e\u0421: ".concat(t,"\n\u0422\u0415\u041a\u0421\u0422 \u0414\u041b\u042f \u041e\u0422\u0412\u0415\u0422\u0410: ").concat(r,'\n\n\u041f\u0420\u0410\u0412\u0418\u041b\u0410:\n1. \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0422\u041e\u041b\u042c\u041a\u041e \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043d\u044b\u0439 \u0442\u0435\u043a\u0441\u0442\n2. \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u043e\u043b\u043d\u044b\u0439 \u0438 \u043f\u043e\u043d\u044f\u0442\u043d\u044b\u0439 \u043e\u0442\u0432\u0435\u0442\n3. \u0415\u0441\u043b\u0438 \u0435\u0441\u0442\u044c \u0444\u043e\u0440\u043c\u0443\u043b\u044b - \u043e\u0442\u043c\u0435\u0442\u0438\u0442\u044c \u0438\u0445 \u043c\u0430\u0440\u043a\u0435\u0440\u0430\u043c\u0438 [MATH:...][/MATH]\n4. \u0421\u0434\u0435\u043b\u0430\u0442\u044c \u043e\u0442\u0432\u0435\u0442 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0442\u0438\u0432\u043d\u044b\u043c\n\nJSON \u041e\u0422\u0412\u0415\u0422:\n{\n  "front": "').concat(t,'",\n  "back": "\u041f\u043e\u043b\u043d\u044b\u0439 \u043e\u0442\u0432\u0435\u0442 \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0435 \u0442\u0435\u043a\u0441\u0442\u0430",\n  "difficulty": "medium"\n}'),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.cardGenerator.systemPrompt},{role:"user",content:a}])];case 2:return(null==(o=s.sent())?void 0:o.content)?[2,{front:(i=this.parseJSONResponse(o.content,"cardGenerator")).front||t,back:i.back||"\u041e\u0442\u0432\u0435\u0442 \u043d\u0435 \u0441\u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u043d",difficulty:i.difficulty||"medium",concept:"\u0412\u043e\u043f\u0440\u043e\u0441 ".concat(n+1),tags:["generated"]}]:[2,null];case 3:return l=s.sent(),console.warn("Single card generation error:",l),[2,null];case 4:return[2]}}))}))},e.prototype.executeQualityValidation=function(e,t,n){return Bn(this,void 0,void 0,(function(){var r,a,o=this;return Rn(this,(function(i){switch(i.label){case 0:return console.log("\u2705 Validating ".concat(e.length," cards...")),0===e.length?[2,e]:[4,Promise.all(e.map((function(e){return Bn(o,void 0,void 0,(function(){var r,a;return Rn(this,(function(o){switch(o.label){case 0:if(null==n?void 0:n.aborted)return[2,{card:e,isValid:!1,aborted:!0}];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.validateSingleCard(e,t)];case 2:return(r=o.sent())||console.log("\u274c Card rejected: ".concat(e.front.substring(0,50),"...")),[2,{card:e,isValid:r,aborted:!1}];case 3:return a=o.sent(),console.warn("Card validation error:",a),[2,{card:e,isValid:!1,aborted:!1}];case 4:return[2]}}))}))})))];case 1:return r=i.sent(),(null==n?void 0:n.aborted)?(console.log("\u23f9\ufe0f Validation aborted - returning original cards"),[2,e]):(a=r.filter((function(e){return e.isValid})).map((function(e){return e.card})),console.log("\u2705 Validation complete: ".concat(a.length,"/").concat(e.length," cards passed")),[2,a.length>0?a:e])}}))}))},e.prototype.validateSingleCard=function(e,t){return Bn(this,void 0,void 0,(function(){var t,n,r;return Rn(this,(function(a){switch(a.label){case 0:t="\u0422\u044b - Quality Validator Agent. \u041f\u0440\u043e\u0432\u0435\u0440\u044c \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u043e \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438.\n\n\u041a\u0410\u0420\u0422\u041e\u0427\u041a\u0410:\n\u0412\u043e\u043f\u0440\u043e\u0441: ".concat(e.front,"\n\u041e\u0442\u0432\u0435\u0442: ").concat(e.back,'\n\n\u041a\u0420\u0418\u0422\u0415\u0420\u0418\u0418 \u041f\u0420\u041e\u0412\u0415\u0420\u041a\u0418:\n1. \u0421\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043b\u0438 \u043e\u0442\u0432\u0435\u0442 \u0432\u043e\u043f\u0440\u043e\u0441\u0443?\n2. \u0415\u0441\u0442\u044c \u043b\u0438 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u0430\u044f \u0446\u0435\u043d\u043d\u043e\u0441\u0442\u044c?\n3. \u041d\u0435\u0442 \u043b\u0438 \u0434\u0443\u0431\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0445 \u0441\u043b\u043e\u0432?\n4. \u0415\u0441\u0442\u044c \u043b\u0438 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b (\u0435\u0441\u043b\u0438 \u043f\u0440\u0438\u043c\u0435\u043d\u0438\u043c\u043e)?\n\n\u041e\u0446\u0435\u043d\u0438 \u043f\u043e \u0448\u043a\u0430\u043b\u0435 1-10 \u0438 \u0432\u0435\u0440\u043d\u0438 true \u0435\u0441\u043b\u0438 >=7.\n\nJSON \u041e\u0422\u0412\u0415\u0422:\n{\n  "score": 8,\n  "isValid": true,\n  "issues": [],\n  "hasMath": false\n}'),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.qualityValidator.systemPrompt},{role:"user",content:t}])];case 2:return(null==(n=a.sent())?void 0:n.content)?[2,!0===this.parseJSONResponse(n.content,"qualityValidator").isValid]:[2,!1];case 3:return r=a.sent(),console.warn("Quality validation error:",r),[2,!0];case 4:return[2]}}))}))},e.prototype.executeMathFormatting=function(e,t,n){return Bn(this,void 0,void 0,(function(){var r,a,o=this;return Rn(this,(function(i){switch(i.label){case 0:return console.log("\u{1f4d0} Processing math in ".concat(e.length," cards...")),0===e.length?[2,e]:[4,Promise.all(e.map((function(e){return Bn(o,void 0,void 0,(function(){var r,a;return Rn(this,(function(o){switch(o.label){case 0:if(null==n?void 0:n.aborted)return[2,{original:e,processed:e,aborted:!0}];if(!/\[MATH:[^\]]+\]\[\/MATH\]/g.test(e.back))return[2,{original:e,processed:e,aborted:!1}];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.formatMathInCard(e,t)];case 2:return r=o.sent(),[2,{original:e,processed:r,aborted:!1}];case 3:return a=o.sent(),console.warn("Math formatting error:",a),[2,{original:e,processed:e,aborted:!1}];case 4:return[2]}}))}))})))];case 1:return r=i.sent(),(null==n?void 0:n.aborted)?(console.log("\u23f9\ufe0f Math formatting aborted - returning original cards"),[2,e]):(a=r.map((function(e){return e.processed})),console.log("\u{1f4d0} Math processing complete: ".concat(a.length," cards")),[2,a])}}))}))},e.prototype.formatMathInCard=function(e,t){return Bn(this,void 0,void 0,(function(){var t,n,r,a;return Rn(this,(function(o){switch(o.label){case 0:t="\u0422\u044b - Math Formatter Agent. \u041e\u0442\u0444\u043e\u0440\u043c\u0430\u0442\u0438\u0440\u0443\u0439 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b.\n\n\u041a\u0410\u0420\u0422\u041e\u0427\u041a\u0410:\n\u0412\u043e\u043f\u0440\u043e\u0441: ".concat(e.front,"\n\u041e\u0442\u0432\u0435\u0442: ").concat(e.back,'\n\n\u0422\u0412\u041e\u042f \u0417\u0410\u0414\u0410\u0427\u0410:\n1. \u041d\u0430\u0439\u0442\u0438 \u043c\u0430\u0440\u043a\u0435\u0440\u044b [MATH:...][/MATH]\n2. \u041f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u044c \u0438\u0445 \u0432 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0439 LaTeX\n3. \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0438\u0435 \u0442\u0438\u043f\u044b \u0444\u043e\u0440\u043c\u0443\u043b ($$...$$ \u0434\u043b\u044f \u0431\u043b\u043e\u0447\u043d\u044b\u0445, $...$ \u0434\u043b\u044f inline)\n\n\u041f\u0420\u0410\u0412\u0418\u041b\u0410:\n- \u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0444\u043e\u0440\u043c\u0443\u043b\u044b: $$\u0444\u043e\u0440\u043c\u0443\u043b\u0430$$\n- Inline \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u044f: $\u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0435$\n- \u041f\u0440\u0438\u043c\u0435\u0440\u044b: \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0440\u0430\u043c\u043a\u0443 \u0435\u0441\u043b\u0438 \u043d\u0443\u0436\u043d\u043e\n\nJSON \u041e\u0422\u0412\u0415\u0422:\n{\n  "formattedBack": "\u041e\u0442\u0432\u0435\u0442 \u0441 \u043e\u0442\u0444\u043e\u0440\u043c\u0430\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u043c\u0438 \u0444\u043e\u0440\u043c\u0443\u043b\u0430\u043c\u0438"\n}'),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.mathFormatter.systemPrompt},{role:"user",content:t}])];case 2:return(null==(n=o.sent())?void 0:n.content)?(r=this.parseJSONResponse(n.content,"mathFormatter"),[2,jn(jn({},e),{back:r.formattedBack||e.back})]):[2,e];case 3:return a=o.sent(),console.warn("Math formatter error:",a),[2,e];case 4:return[2]}}))}))},e.prototype.applyMultimediaAndFormatting=function(e,t,n,r){return Bn(this,void 0,void 0,(function(){var n;return Rn(this,(function(a){switch(a.label){case 0:return n=On([],e,!0),t&&t.pageImages&&t.pageImages.length>0&&(console.log("\u{1f3a8} Applying multimedia..."),n=this.applyMultimediaFast(n,t)),(null==r?void 0:r.aborted)?[3,2]:(console.log("\u{1f3a8} Processing LaTeX formulas..."),[4,this.processLatexInCards(n)]);case 1:n=a.sent(),a.label=2;case 2:return[2,n]}}))}))},e.prototype.createCardsFromTextFallback=function(e,t,n,r){return Bn(this,void 0,void 0,(function(){var a,o;return Rn(this,(function(i){switch(i.label){case 0:return console.log("\u26a0\ufe0f Using fallback method..."),[4,this.executeFastCombinedProcess(e,t,n||{originalText:e,currentStep:"fallback",previousResults:{},metadata:{textLength:e.length,language:this.detectLanguage(e),topic:"",complexity:this.estimateComplexity(e)}},r)];case 1:return a=i.sent(),o=a.cards,[4,this.applyMultimediaAndFormatting(o,t,n,r)];case 2:return o=i.sent(),[2,this.convertToStoredCards(o,e)]}}))}))},e.prototype.convertToStoredCards=function(e,t){return e.map((function(e,n){var r=jn(jn(jn(jn({id:"ai_agent_".concat(Date.now(),"_").concat(n,"_").concat(Math.random().toString(36).substr(2,9)),mode:Q.d.GeneralTopic,front:e.front,back:e.back,text:t,createdAt:new Date,exportStatus:"not_exported"},e.tags&&{tags:e.tags}),e.difficulty&&{difficulty:e.difficulty}),e.concept&&{concept:e.concept}),e.qualityScore&&{qualityScore:e.qualityScore});if(e.attachedImages&&e.attachedImages.length>0){var a=e.attachedImages[0];a.base64?(r.image=a.base64,console.log("\u{1f4be} \u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043e \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0432 base64 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 \u0434\u043b\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438:",r.id)):a.src&&(r.imageUrl=a.src,console.log("\u{1f4be} \u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0430 \u0441\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438:",r.id))}return e.image&&(r.image=e.image,console.log("\u{1f4be} \u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u043e \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0438\u0437 card.image \u0434\u043b\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438:",r.id)),e.imageUrl&&(r.imageUrl=e.imageUrl,console.log("\u{1f4be} \u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0430 \u0441\u0441\u044b\u043b\u043a\u0430 \u0438\u0437 card.imageUrl \u0434\u043b\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438:",r.id)),r}))},e}(),Nn=function(e,t){return new Ln(e,t)},Pn=n(736),_n=function(){return _n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},_n.apply(this,arguments)},Dn=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))},qn=function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(s){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&l[0]?r.return:l[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,l[1])).done)return a;switch(r=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,r=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],r=0}finally{n=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}},Un=function(e,t,n){if(n||2===arguments.length)for(var r,a=0,o=t.length;a<o;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))},$n=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},Hn=function(e){if(e instanceof Date)return e;if("string"==typeof e||"number"==typeof e){var t=new Date(e);if(!Number.isNaN(t.getTime()))return t}return new Date},Vn=function(e){var t,n,r,a,o,i,l,s;return _n(_n({},e),{createdAt:Hn(e.createdAt),examples:null!==(t=e.examples)&&void 0!==t?t:[],image:null!==(n=e.image)&&void 0!==n?n:null,imageUrl:null!==(r=e.imageUrl)&&void 0!==r?r:null,translation:null!==(a=e.translation)&&void 0!==a?a:null,front:null!==(o=e.front)&&void 0!==o?o:e.text,back:null!==(i=e.back)&&void 0!==i?i:null,linguisticInfo:null!==(l=e.linguisticInfo)&&void 0!==l?l:"",transcription:null!==(s=e.transcription)&&void 0!==s?s:""})},Gn=function(e){var t,n,r,a,o,i,l,s,c=(null!==(t=e.examples)&&void 0!==t?t:[]).map((function(e){var t;return[e[0],null!==(t=e[1])&&void 0!==t?t:null]}));return JSON.stringify({id:e.id,mode:e.mode,text:e.text,translation:null!==(n=e.translation)&&void 0!==n?n:null,front:null!==(r=e.front)&&void 0!==r?r:"",back:null!==(a=e.back)&&void 0!==a?a:null,examples:c,image:null!==(o=e.image)&&void 0!==o?o:null,imageUrl:null!==(i=e.imageUrl)&&void 0!==i?i:null,createdAt:Hn(e.createdAt).toISOString(),linguisticInfo:null!==(l=e.linguisticInfo)&&void 0!==l?l:"",transcription:null!==(s=e.transcription)&&void 0!==s?s:""})},Wn=function(e){var t,n,r,a,o,i,l,s,c=(null!==(t=e.examples)&&void 0!==t?t:[]).map((function(e){var t;return[e[0],null!==(t=e[1])&&void 0!==t?t:null]}));return JSON.stringify({id:e.id,mode:e.mode,text:e.text,translation:null!==(n=e.translation)&&void 0!==n?n:null,front:null!==(r=e.front)&&void 0!==r?r:"",back:null!==(a=e.back)&&void 0!==a?a:null,examples:c,image:null!==(o=e.image)&&void 0!==o?o:null,imageUrl:null!==(i=e.imageUrl)&&void 0!==i?i:null,linguisticInfo:null!==(l=e.linguisticInfo)&&void 0!==l?l:"",transcription:null!==(s=e.transcription)&&void 0!==s?s:""})};const Yn=function(){var e;r.useEffect((function(){var e=document.createElement("style");return e.textContent="\n            @keyframes fadeIn {\n                from { opacity: 0; }\n                to { opacity: 1; }\n            }\n            @keyframes slideUp {\n                from {\n                    opacity: 0;\n                    transform: translateY(30px) scale(0.95);\n                }\n                to {\n                    opacity: 1;\n                    transform: translateY(0) scale(1);\n                }\n            }\n            @keyframes slideIn {\n                from {\n                    opacity: 0;\n                    transform: translateX(-20px);\n                }\n                to {\n                    opacity: 1;\n                    transform: translateX(0);\n                }\n            }\n            @keyframes glowPulse {\n                0%, 100% {\n                    box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4);\n                    transform: scale(1);\n                }\n                50% {\n                    box-shadow: 0 0 0 6px rgba(59, 130, 246, 0);\n                    transform: scale(1.02);\n                }\n            }\n            @keyframes modeSwitch {\n                0% {\n                    transform: scale(1);\n                    opacity: 0.8;\n                }\n                50% {\n                    transform: scale(1.01);\n                    opacity: 1;\n                }\n                100% {\n                    transform: scale(1);\n                    opacity: 1;\n                }\n            }\n            @keyframes instantSlide {\n                0% {\n                    transform: translateX(-10px);\n                    opacity: 0;\n                }\n                100% {\n                    transform: translateX(0);\n                    opacity: 1;\n                }\n            }\n            @keyframes smoothGlow {\n                0%, 100% {\n                    boxShadow: 0 0 0 0 rgba(59, 130, 246, 0.3);\n                }\n                50% {\n                    boxShadow: 0 0 0 8px rgba(59, 130, 246, 0);\n                }\n            }\n        ",document.head.appendChild(e),function(){document.head.removeChild(e)}}),[]);var t=(0,r.useState)(!1),a=t[0],i=t[1],l=(m((function(e){return e.deck.deckId})),Ge()),s=E(),c=(0,r.useCallback)((function(e){s({type:"SET_SOURCE_LANGUAGE",payload:e}),localStorage.setItem("source_language",e)}),[s]),u=((0,r.useCallback)((function(){}),[]),l.text),d=l.translation,p=l.examples,f=l.image,h=l.imageUrl,g=l.front,v=l.back,y=l.currentCardId,b=l.linguisticInfo,x=l.transcription,w=(l.fieldIdPrefix,m((function(e){return e.cards.lastDraftCard}))),S=m((function(e){return e.settings.translateToLanguage})),k=m((function(e){return e.settings.aiInstructions})),C=m((function(e){return e.settings.imageInstructions})),A=(m((function(e){return e.deck.decks})),m((function(e){return e.settings.mode}))),T=(0,r.useState)(""),I=T[0],z=T[1],F=(0,r.useMemo)((function(){if(!w)return null;var e;e=w.createdAt instanceof Date?w.createdAt:new Date(w.createdAt),Number.isNaN(e.getTime())&&(e=new Date);var t=Array.isArray(w.examples)?w.examples:[],n=_n(_n({},w),{createdAt:e,examples:t});if(!Boolean(n.text&&n.text.trim()||n.translation&&n.translation.trim()||n.front&&n.front.trim()||n.back&&n.back.trim()||n.examples&&n.examples.length>0||n.image||n.imageUrl||n.linguisticInfo&&n.linguisticInfo.trim()||n.transcription&&n.transcription.trim()))return null;var r=w.mode===Q.d.LanguageLearning,a=r?n.text:n.front||n.text,o=r?n.translation||"":n.back||n.translation||"",i=(a||o||n.text||"").replace(/\s+/g," ").trim(),l=i.length>0?i:"Saved card is ready to preview",s=l.length>110?"".concat(l.slice(0,107).trim(),"\u2026"):l,c="en-GB",u=new Intl.DateTimeFormat(c,{dateStyle:"medium",timeStyle:"short"}),d=new Intl.DateTimeFormat(c,{hour:"2-digit",minute:"2-digit",hour12:!1});return{raw:n,front:a||"",translation:o||"",examples:t,createdAt:e,snippet:l,previewSnippet:s,timeLabel:u.format(e),shortTimeLabel:d.format(e),modeLabel:r?"Language Learning":"General Topic"}}),[w]),M=(0,r.useRef)(null!==(e=null==w?void 0:w.id)&&void 0!==e?e:null),j=(0,r.useRef)(w?Gn(Vn(w)):null),B=(0,r.useRef)(w?Wn(Vn(w)):null);(0,r.useEffect)((function(){w&&(M.current=w.id,j.current=Gn(Vn(w)),B.current=Wn(Vn(w)))}),[w]);var R=(0,r.useCallback)((function(){localStorage.setItem("selected_mode",Q.d.LanguageLearning),A!==Q.d.LanguageLearning&&(s((0,Ye.iY)(Q.d.LanguageLearning)),s(Fe("")),s(Le("")),s(Oe(null)),s(je(null)),s(Me([])),s(Be(null)),s(Re(null)),s(_e("")),s(De("")),s(Pe(null)),rn(null),dn(""),on(!1),i(!1),tn(!1),Kt([]),Jt(0),(0,un.$_)())}),[A,s]),O=((0,r.useCallback)((function(){R()}),[R]),(0,r.useCallback)((function(e){R()}),[R])),L=(0,r.useCallback)((function(e,t){return Dn(void 0,void 0,void 0,(function(){var n,r,a,o,i;return qn(this,(function(l){switch(l.label){case 0:if(n=e&&""!==e.trim()?e:null,r=t&&""!==t.trim()?t:null,a=!!n&&n.startsWith("data:image"),n&&a||!r)return[3,4];l.label=1;case 1:return l.trys.push([1,3,,4]),[4,ae(r)];case 2:return(o=l.sent())&&(n=o,r=null),[3,4];case 3:return i=l.sent(),console.error("Failed to convert image URL to base64:",i),[3,4];case 4:return[2,{image:n,imageUrl:r}]}}))}))}),[]);(0,r.useEffect)((function(){var e=function(e){"l"!==e.key&&"L"!==e.key||(e.ctrlKey||e.metaKey)&&(e.preventDefault(),O(Q.d.LanguageLearning))};return document.addEventListener("keydown",e),function(){document.removeEventListener("keydown",e)}}),[O]);m((function(e){return e.settings.useAnkiConnect})),m((function(e){return e.settings.ankiConnectUrl})),m((function(e){return e.settings.ankiConnectApiKey}));var N=(0,r.useState)(!1),P=N[0],_=N[1],D=(0,r.useState)(!1),q=D[0],U=D[1],$=(0,r.useState)(!1),H=$[0],V=$[1],G=(0,r.useState)(!1),W=G[0],Y=G[1],K=(0,r.useState)(null),X=K[0],J=K[1],Z=(0,r.useState)({completed:0,total:0}),ee=Z[0],te=Z[1],ne=(0,r.useState)(!1),re=ne[0],oe=ne[1],ie=(0,r.useState)(0),le=ie[0],se=ie[1],ce=(0,r.useRef)(null),ue=(0,r.useState)(!1),de=ue[0],pe=ue[1],fe=(0,r.useState)(!0),he=fe[0],ge=fe[1],me=(0,r.useState)(!1),ve=me[0],ye=me[1],be=m((function(e){return e.settings.openAiKey})),xe=m((function(e){return e.settings.groqApiKey})),we=m((function(e){return e.settings.groqModelName})),Se=m((function(e){return e.settings.modelProvider})),ke=m((function(e){return e.settings.shouldGenerateImage})),Ce=m((function(e){return e.settings.imageGenerationMode})),Ee=(0,r.useState)(!1),Ae=Ee[0],Te=Ee[1],qe="anki_image_generation_mode",$e=(0,r.useRef)(!1);(0,r.useEffect)((function(){if($e.current)try{localStorage.setItem(qe,Ce)}catch(e){console.warn("Failed to persist image generation mode:",e)}}),[Ce]),(0,r.useEffect)((function(){if(!$e.current){$e.current=!0;try{var e=localStorage.getItem(qe);e&&e!==Ce&&(s((0,Ye.BE)(e)),"off"===e&&s((0,Ye.yo)(!1)))}catch(e){console.warn("Failed to restore image generation mode:",e)}}}),[s,Ce]),r.useEffect((function(){"smart"!==Ce&&"always"!==Ce||ke||($n("\u{1f527} Initializing: Setting shouldGenerateImage=true for ".concat(Ce," mode")),s((0,Ye.yo)(!0)))}),[Ce,ke,s]);var He=(0,r.useState)(!1),Ve=He[0],Ke=He[1],Xe=(0,r.useState)(k),Qe=Xe[0],Je=Xe[1],Ze=(0,r.useState)(C),et=Ze[0],tt=Ze[1],nt=vn(),at=nt.showError,ot=nt.renderErrorNotification,lt=function(e){var t=e.message.toLowerCase();return t.includes("quota")||t.includes("insufficient_quota")||t.includes("billing")||t.includes("exceeded")||t.includes("429")},dt=(0,r.useState)(""),pt=dt[0],gt=dt[1],mt=(0,r.useState)(!1),yt=mt[0],xt=mt[1],At=(0,r.useState)(!1),Tt=At[0],Ft=At[1],Mt=(0,r.useState)([]),Bt=Mt[0],Rt=Mt[1],Lt=(0,r.useState)(!1),_t=Lt[0],Dt=Lt[1],qt=(0,r.useState)(!1),Ut=qt[0],$t=qt[1],Ht=(0,r.useState)({}),Vt=Ht[0],Gt=Ht[1],Wt=(0,r.useState)([]),Yt=Wt[0],Kt=Wt[1],Xt=(0,r.useState)(0),Qt=Xt[0],Jt=Xt[1],Zt=(0,r.useState)(!1),en=Zt[0],tn=Zt[1],nn=(0,r.useState)(null),rn=(nn[0],nn[1]),an=(0,r.useState)(!1),on=(an[0],an[1]),ln=(0,r.useState)(""),sn=ln[0],dn=ln[1],pn=(0,r.useState)([]),fn=pn[0],mn=pn[1],yn=(0,r.useState)(!1),bn=yn[0],xn=yn[1],wn=(0,r.useState)(0),Sn=wn[0],kn=wn[1],Cn=(0,r.useState)(new Set),En=Cn[0],An=Cn[1],In=(0,r.useState)(!1),zn=In[0],Fn=In[1],Mn=(0,r.useState)(""),jn=Mn[0],Bn=Mn[1],Rn=(0,r.useState)(!1),On=Rn[0],Ln=Rn[1],Yn=(0,r.useRef)(null),Kn=(0,r.useRef)(!1),Xn=(0,r.useCallback)((function(){$n("\u{1f6ab} Critical API issue detected - stopping loaders instantly"),Kn.current=!0,pe(!0),_(!1),xt(!1),U(!1),V(!1),J(null),te({completed:0,total:0}),se(0),ce.current&&(clearInterval(ce.current),ce.current=null),(0,un.Y3)((function(){})),(0,un.$_)(),l.setIsGeneratingCard(!1),Yn.current&&(Yn.current.abort(),Yn.current=null)}),[l,pe,_,xt,U,V,J,te,se]),Qn=l.storedCards,Jn=(0,r.useMemo)((function(){return(0,Nt.getAIService)(Se)}),[Se]),Zn=(0,r.useMemo)((function(){return(0,Nt.getApiKeyForProvider)(Se,be,xe)}),[Se,be,xe]),er=(0,r.useMemo)((function(){switch(Se){case Pt.l.Groq:return"Groq";case Pt.l.OpenAI:default:return"OpenAI"}}),[Se]),tr=(0,r.useCallback)((function(){Ln(!0)}),[]);(0,r.useEffect)((function(){Zn&&Ln(!1)}),[Zn]);var nr=(0,r.useCallback)((function(e){if(!e)return!1;var t=e.toLowerCase(),n=!Zn||["invalid api key","incorrect api key","authentication failed","authorization failed","api key is missing","api key provided is incorrect","unauthorized","bearer token is invalid","invalid credentials","invalid token","401","access was denied","forbidden"].some((function(e){return t.includes(e)}));return n&&(Kn.current=!0,Xn(),tr()),n}),[Zn,tr,Xn]),rr=(0,r.useState)([]),ar=rr[0],or=rr[1],ir=(0,r.useCallback)((function(e){return!!e&&ar.includes(e)}),[ar]),lr=(0,r.useMemo)((function(){if($n("Calculating isSaved:",{currentCardId:y,explicitlySaved:ve,isMultipleCards:en,currentCardIndex:Qt,createdCardsLength:Yt.length,explicitlySavedIds:ar}),en&&Yt.length>0){var e=Yt[Qt];return!!e&&ir(e.id)}return!(!y||!ve)}),[y,ve,en,Qt,Yt,ir]),sr=(0,r.useMemo)((function(){if(!w||re)return!1;var e="undefined"!=typeof window&&"true"===localStorage.getItem("explicitly_saved");if(!ve&&!e)return!1;var t=y||("undefined"!=typeof window?localStorage.getItem("current_card_id"):null);return!!t&&w.id===t}),[w,ve,y,re]);(0,r.useEffect)((function(){if(w){var e="undefined"!=typeof window&&"true"===localStorage.getItem("explicitly_saved"),t="undefined"!=typeof window?localStorage.getItem("current_card_id"):null,n=y||t,r=!!n&&w.id===n;!re&&(lr||ve||e&&r)&&s(Ue(null))}}),[w,lr,ve,re,y,s]);var cr=(0,r.useMemo)((function(){if(!a)return null;var e=(I||"").trim(),t=(e||g||"").trim(),n=(e||u||g||"").trim();if(!Boolean(n||d&&d.trim()||v&&v.trim()||p.length>0||f||h||b&&b.trim()||x&&x.trim()))return null;var r="undefined"!=typeof window&&"true"===localStorage.getItem("explicitly_saved");if((lr||r||ve)&&!re)return null;var o=n||u||g||"",i=t||g||o,l=d||(A===Q.d.GeneralTopic?v||"":d);return{id:null!=y?y:void 0,mode:A,text:o,translation:l&&l.length>0?l:null,examples:p.length?p:[],image:f||null,imageUrl:h||null,createdAt:null==w?void 0:w.createdAt,exportStatus:"not_exported",front:i,back:null!=v?v:null,linguisticInfo:b||"",transcription:x||""}}),[a,I,u,g,d,v,p,f,h,b,x,y,A,w,lr,re,ve]);(0,r.useEffect)((function(){var e,t,n,r;if(cr){var a=null!==(n=null!==(t=null!==(e=cr.id)&&void 0!==e?e:M.current)&&void 0!==t?t:null==w?void 0:w.id)&&void 0!==n?n:null;a||(a="draft-".concat(Date.now())),M.current=a;var o=_n(_n({},cr),{id:a,createdAt:Hn(null!==(r=cr.createdAt)&&void 0!==r?r:null==w?void 0:w.createdAt)}),i=Vn(o),l=Wn(i),c=l!==B.current?new Date:Hn(null==w?void 0:w.createdAt),u=_n(_n({},i),{createdAt:c}),d=Gn(u);d!==j.current&&(j.current=d,B.current=l,s(Ue(u)))}}),[cr,s,w]),$n("Card state details:",{isNewSubmission:he,explicitlySaved:ve,isSaved:lr,currentCardId:y,text:u.substring(0,20)+(u.length>20?"...":""),localStorage_explicitly_saved:localStorage.getItem("explicitly_saved")});(0,r.useEffect)((function(){return $n("\u{1f504} Loading state changed:",{loadingGetResult:P,isProcessingCustomInstruction:yt,loadingNewImage:q,loadingNewExamples:H}),P?($n("\u23f1\ufe0f Starting timer for card creation"),se(0),ce.current=setInterval((function(){se((function(e){return e+1}))}),1e3)):ce.current&&($n("\u23f1\ufe0f Stopping timer for card creation"),clearInterval(ce.current),ce.current=null),function(){ce.current&&clearInterval(ce.current)}}),[P,yt,q,H]);(0,r.useEffect)((function(){lr&&oe(!0)}),[u,d,p,f,h,g,lr]);var ur=(0,r.useCallback)((function(e){if(e&&""!==e.trim()){var t=Tn().find((function(t){return t.text===e}));return!!t&&($n("Found existing card with matching text:",(null==t?void 0:t.text)||e,"ID:",t.id),$n("Setting currentCardId but NOT setting explicitlySaved"),s(Pe(t.id)),!0)}}),[s]),dr=function(e){l.setText(e),lr?oe(!0):ur(e)},pr=function(e){l.setTranslation(e),lr&&oe(!0)},fr=function(e){l.setBack(null!=e?e:null),lr&&oe(!0)},hr=function(e){l.setExamples(e),lr&&oe(!0)},gr=function(){return Dn(void 0,void 0,void 0,(function(){var e,t,n,r,a,o,i,s;return qn(this,(function(c){switch(c.label){case 0:U(!0),c.label=1;case 1:return c.trys.push([1,6,7,8]),(null===(i=Yn.current)||void 0===i?void 0:i.signal.aborted)?($n("New image generation cancelled"),[2]):[4,Jn.getDescriptionImage(Zn,u,C,null===(s=Yn.current)||void 0===s?void 0:s.signal)];case 2:return e=c.sent(),Se!==Pt.l.OpenAI?[3,4]:[4,hn(be,e,C)];case 3:return t=c.sent(),n=t.imageUrl,r=t.imageBase64,n&&l.setImageUrl(n),r&&l.setImage(r),[3,5];case 4:at("Image generation is not supported with the selected provider."),c.label=5;case 5:return[3,8];case 6:return(a=c.sent())instanceof Error&&lt(a)?(console.error("Quota error detected in image generation:",a.message),at(a.message),nr(a.message),[2]):(console.error("Error generating image:",a),o=a instanceof Error?a.message:"Failed to generate image",at(o),nr(o),[3,8]);case 7:return U(!1),[7];case 8:return lr&&oe(!0),[2]}}))}))},mr=function(){return Dn(void 0,void 0,void 0,(function(){var e,t,n,r,a,o,i;return qn(this,(function(s){switch(s.label){case 0:V(!0),s.label=1;case 1:return s.trys.push([1,3,4,5]),(null===(o=Yn.current)||void 0===o?void 0:o.signal.aborted)?($n("New examples generation cancelled"),[2]):(e=pa?ea:Qr,[4,(0,Nt.createExamples)(Jn,Zn,u,S,!0,k,e||void 0,null===(i=Yn.current)||void 0===i?void 0:i.signal)]);case 2:return(t=s.sent())&&t.length>0&&(n=t.map((function(e){return[e.original,e.translated]})),l.setExamples(n)),[3,5];case 3:return(r=s.sent())instanceof Error&&lt(r)?(console.error("Quota error detected in examples generation:",r.message),at(r.message),nr(r.message),[2]):(console.error("Error getting examples:",r),a=r instanceof Error?r.message:"Failed to generate examples",at(a),nr(a),[3,5]);case 4:return V(!1),[7];case 5:return lr&&oe(!0),[2]}}))}))},vr=function(){return Dn(void 0,void 0,void 0,(function(){var e,t,n,r,a,o,i,s,c,d;return qn(this,(function(p){switch(p.label){case 0:if(!pt.trim()||yt)return[2];xt(!0),p.label=1;case 1:return p.trys.push([1,15,16,17]),pt.toLowerCase().includes("image")||pt.toLowerCase().includes("picture")||pt.toLowerCase().includes("\u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438")||pt.toLowerCase().includes("\u043a\u0430\u0440\u0442\u0438\u043d")?[4,(0,We.getDescriptionImage)(be,u,pt)]:[3,4];case 2:return o=p.sent(),[4,hn(be,o,pt)];case 3:return e=p.sent(),t=e.imageUrl,n=e.imageBase64,t&&l.setImageUrl(t),n&&l.setImage(n),[3,14];case 4:return pt.toLowerCase().includes("example")||pt.toLowerCase().includes("sentence")||pt.toLowerCase().includes("\u043f\u0440\u0438\u043c\u0435\u0440")||pt.toLowerCase().includes("\u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u0435")?($n("\u{1f4da} Starting examples generation..."),[4,Jn.getExamples(Zn,u,S,!0,pt)]):[3,6];case 5:return a=p.sent(),$n("\u{1f4da} Examples generation completed"),l.setExamples(a),[3,14];case 6:return pt.toLowerCase().includes("translat")||pt.toLowerCase().includes("\u043f\u0435\u0440\u0435\u0432\u043e\u0434")?[4,Jn.translateText(Zn,u,S,pt)]:[3,8];case 7:return(r=p.sent())&&l.setTranslation(r),[3,14];case 8:return[4,Jn.translateText(Zn,u,S,pt)];case 9:return r=p.sent(),$n("\u{1f4da} Starting examples generation (combined)..."),[4,Jn.getExamples(Zn,u,S,!0,pt)];case 10:return a=p.sent(),$n("\u{1f4da} Examples generation completed (combined)"),ke?[4,Jn.getDescriptionImage(Zn,u,pt)]:[3,13];case 11:return o=p.sent(),[4,null===(d=Jn.getImageUrl)||void 0===d?void 0:d.call(Jn,Zn,o)];case 12:(i=p.sent())&&l.setImageUrl(i),p.label=13;case 13:r&&l.setTranslation(r),l.setExamples(a),p.label=14;case 14:return gt(""),[3,17];case 15:return(s=p.sent())instanceof Error&&lt(s)?(console.error("Quota error detected in custom instructions:",s.message),at(s.message),nr(s.message),[2]):(console.error("Error applying custom instructions:",s),c=s instanceof Error?s.message:"Failed to apply custom instructions",at(c),nr(c),[3,17]);case 16:return $n("\u{1f4dd} Custom instruction processing completed"),xt(!1),[7];case 17:return[2]}}))}))},yr=function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),vr())},br=function(){return Se!==Pt.l.Groq},xr=function(){return Dn(void 0,void 0,void 0,(function(){var e,t,n,r,a,o,i,l,c;return qn(this,(function(m){$n("*** HANDLE SAVE ALL CARDS: Starting ***"),$n("Current Redux state at save all cards time:",{text:u,translation:d,image:f,imageUrl:h,hasImage:!!f,hasImageUrl:!!h,imageType:typeof f,imageUrlType:typeof h,shouldGenerateImage:ke,mode:A,createdCardsCount:Yt.length}),at(null);try{for(Y(!0),(e=Un([],Yt,!0))[Qt]&&(e[Qt]=_n(_n({},e[Qt]),{text:u,translation:d,examples:p,image:f,imageUrl:h,front:g,back:v||null,linguisticInfo:b||"",transcription:x||""})),t=0,n=0,r=0,a=0,o=Un([],ar,!0),$n("Starting to save cards. Total cards:",e.length,"Already saved:",ar.length),$n("Cards to save:",e.map((function(e){var t;return{id:e.id,text:null===(t=e.text)||void 0===t?void 0:t.substring(0,30)}}))),i=function(i){var l=e[i];if(ar.includes(l.id))return $n("Card #".concat(i," (").concat(l.id,") already explicitly saved, skipping")),t++,"continue";try{$n("Saving card #".concat(i," (").concat(l.id,") from multi-card set")),-1===Qn.findIndex((function(e){return e.id===l.id}))?(s(Ie(l)),r++,o.push(l.id),$n("Card #".concat(i," (").concat(l.id,") saved as new")),t++):($n("Card #".concat(i," (").concat(l.id,") already in storage, updating")),s(Ne(l)),a++,o.push(l.id),t++)}catch(e){console.error("Error saving card #".concat(i," (").concat(l.id,"):"),e),n++}},l=0;l<e.length;l++)i(l);$n("Save all complete. Saved:",r,"Updated:",a,"Errors:",n),or(o),Kt(e),ye(!0),localStorage.setItem("explicitly_saved","true"),(c=e[Qt])&&c.id&&(s(Pe(c.id)),localStorage.setItem("current_card_id",c.id)),0===n?r>0&&a>0?"Saved ".concat(r," new cards and updated ").concat(a," existing cards."):r>0?"Saved ".concat(r," cards successfully!"):a>0?"Updated ".concat(a," cards successfully!"):"All ".concat(t," cards are now saved!"):at("Saved ".concat(t," cards, ").concat(n," failed."),"warning"),oe(!1),ge(!1),s(ze())}catch(e){console.error("Error in save all cards operation:",e),at("Error saving cards. Please try again.")}finally{Y(!1)}return[2]}))}))},wr=function(){return Dn(void 0,void 0,void 0,(function(){var e,t,n,r,a,o,i,c,m,v,w,S,k,C,E,T,z;return qn(this,(function(F){switch(F.label){case 0:$n("*** HANDLE ACCEPT: Starting to save card ***"),$n("Current Redux state at save time:",{text:u,translation:d,image:f,imageUrl:h,hasImage:!!f,hasImageUrl:!!h,imageType:typeof f,imageUrlType:typeof h,imageLength:null==f?void 0:f.length,imageUrlLength:null==h?void 0:h.length,shouldGenerateImage:ke,mode:A}),at(null),F.label=1;case 1:return F.trys.push([1,8,9,10]),Y(!0),en&&Yt.length>0?(Lr(),(e=Yt[Qt])?($n("Saving current card from multi-card set:",e.id),[4,L(null!==(S=e.image)&&void 0!==S?S:null,null!==(k=e.imageUrl)&&void 0!==k?k:null)]):(at("Card data not found"),[2])):[3,3];case 2:return t=F.sent(),n=_n(_n({},e),{image:t.image,imageUrl:t.imageUrl}),Kt((function(e){var t=Un([],e,!0);return t[Qt]=n,t})),-1===Qn.findIndex((function(e){return e.id===n.id||e.text===n.text&&e.mode===n.mode}))?(l.saveCardToStorage(n),$n("Saved new card: ".concat(n.id))):(l.updateStoredCard(n),$n("Updated existing card: ".concat(n.id))),or((function(e){if(e.includes(n.id))return e;var t=Un(Un([],e,!0),[n.id],!1);return $n("Updated explicitly saved IDs:",t),t})),s(ze()),l.setCurrentCardId(n.id),localStorage.setItem("current_card_id",n.id),ye(!0),localStorage.setItem("explicitly_saved","true"),oe(!1),s(Ue(null)),[2];case 3:return r=y||Date.now().toString(),$n("Saving card with data:",{originalSelectedText:I,text:u,translation:d,examples:p.length,mode:A,currentCardId:y,linguisticInfo:b?"present":"absent"}),A!==Q.d.LanguageLearning?[3,5]:u||I?(o=I||u,[4,L(f,h)]):(console.error("Missing text data for card"),at("Please enter or select some text for your card before saving."),[2]);case 4:return a=F.sent(),c=a.image,m=a.imageUrl,c&&c!==f?(l.setImage(c),l.setImageUrl(null)):c||m===h||l.setImageUrl(m),v={id:r,mode:A,text:o,translation:d,examples:p,linguisticInfo:b,transcription:x||"",image:c,imageUrl:m,createdAt:new Date,exportStatus:"not_exported"},$n("*** CREATECARD: Preparing to save card to storage ***"),$n("Card data being sent to Redux:",{id:v.id,text:v.text,mode:v.mode,hasImage:!!v.image,hasImageUrl:!!v.imageUrl,imageType:typeof v.image,imageUrlType:typeof v.imageUrl,imageLength:null===(C=v.image)||void 0===C?void 0:C.length,imageUrlLength:null===(E=v.imageUrl)||void 0===E?void 0:E.length,imageActualValue:v.image,imageUrlActualValue:v.imageUrl,imagePreview:null===(T=v.image)||void 0===T?void 0:T.substring(0,50),imageUrlPreview:null===(z=v.imageUrl)||void 0===z?void 0:z.substring(0,50)}),y?($n("Updating existing card by user action:",r),l.updateStoredCard(v)):($n("Saving new card by user action:",r),l.saveCardToStorage(v),l.setCurrentCardId(r)),s(Ue(null)),[3,7];case 5:return A!==Q.d.GeneralTopic?[3,7]:g?(o=I||u||"",[4,L(f,h)]):(console.error("Missing front data for general topic card"),at("Please generate card content before saving."),[2]);case 6:i=F.sent(),c=i.image,m=i.imageUrl,c&&c!==f?(l.setImage(c),l.setImageUrl(null)):c||m===h||l.setImageUrl(m),v={id:r,mode:A,front:g,back:d||g,text:o,linguisticInfo:b,transcription:x||"",image:c,imageUrl:m,createdAt:new Date,exportStatus:"not_exported"},$n("Saving general topic card to storage:",v),y?($n("Updating existing general topic card by user action:",r),l.updateStoredCard(v)):($n("Saving new general topic card by user action:",r),l.saveCardToStorage(v),l.setCurrentCardId(r)),s(Ue(null)),F.label=7;case 7:return ye(!0),localStorage.setItem("explicitly_saved","true"),oe(!1),ge(!1),[3,10];case 8:return w=F.sent(),console.error("Error saving card:",w),at("Error saving card. Please try again."),[3,10];case 9:return Y(!1),[7];case 10:return[2]}}))}))},Sr=(0,r.useCallback)((function(){l.setCurrentPage("storedCards")}),[l]),kr=(0,r.useCallback)((function(){Ln(!1),l.setCurrentPage("settings")}),[l]),Cr=(0,r.useCallback)((function(){Ln(!1)}),[]),Er=(0,r.useCallback)((function(e){var t,n,r,a,o,s,c,u,d,p,f=Vn(e),h=f.mode===Q.d.LanguageLearning?null!==(t=f.translation)&&void 0!==t?t:"":null!==(r=null!==(n=f.back)&&void 0!==n?n:f.translation)&&void 0!==r?r:"";l.updateCard({text:f.text,translation:h,examples:null!==(a=f.examples)&&void 0!==a?a:[],image:null!==(o=f.image)&&void 0!==o?o:null,imageUrl:null!==(s=f.imageUrl)&&void 0!==s?s:null,front:null!==(c=f.front)&&void 0!==c?c:f.text,back:null!==(u=f.back)&&void 0!==u?u:null,linguisticInfo:null!==(d=f.linguisticInfo)&&void 0!==d?d:"",transcription:null!==(p=f.transcription)&&void 0!==p?p:""}),f.id?l.setCurrentCardId(f.id):l.setCurrentCardId(null),z(f.mode===Q.d.LanguageLearning?f.text:""),l.setIsGeneratingCard(!1),i(!0),oe(!1),ge(!1),ye(!1),or([]),tn(!1),Kt([]),Jt(0)}),[l]),Ar=function(){var e;if(F){var t=Boolean((null!==(e=F.translation)&&void 0!==e?e:"").trim()),n=Array.isArray(F.examples)&&F.examples.length>0;t&&n&&(Er(F.raw),Ft(!0))}},Tr=(0,r.useCallback)((function(e){$n("Text selection handled for tab-specific state:",e),Dt(!1),Gt({}),Rt([]),l.setText(e),$n("Text set via tabAware.setText:",e)}),[l]);(0,r.useEffect)((function(){var e=function(e){var t,n=document.getElementById("sidebar");if(!n||!n.contains(e.target)){if(e.target&&e.composedPath)for(var r=0,a=e.composedPath();r<a.length;r++){var o=a[r];if(o instanceof Element&&"sidebar"===o.id)return;if(o instanceof ShadowRoot&&o.host&&"sidebar"===o.host.id)return}var i=null===(t=window.getSelection())||void 0===t?void 0:t.toString().trim();i&&i.length>0&&Tr(i)}};return document.addEventListener("mouseup",e),function(){document.removeEventListener("mouseup",e)}}),[Tr]),(0,r.useEffect)((function(){localStorage.setItem("selected_mode",Q.d.LanguageLearning),s((0,Ye.iY)(Q.d.LanguageLearning)),u&&d&&p.length>0?i(!0):i(!1),s(ze())}),[s]),(0,r.useEffect)((function(){Dn(void 0,void 0,void 0,(function(){return qn(this,(function(e){return $n("Running saved cards check on mount"),s(ze()),setTimeout((function(){var e=Tn();$n("Loaded cards from storage:",e.length);var t=localStorage.getItem("current_card_id"),n=localStorage.getItem("explicitly_saved");if($n("localStorage values on mount:",{savedCardId:t,explicitlySavedFlag:n,cardCount:e.length}),t){$n("Found current card ID in localStorage:",t);var r=e.find((function(e){return e.id===t}));r?($n("Restoring card from storage:",r),oe(!1),ge(!1),"true"===n?($n("Setting explicitlySaved to TRUE based on localStorage flag"),ye(!0)):($n("Setting explicitlySaved to FALSE based on localStorage flag"),ye(!1)),l.setCurrentCardId(t),l.setText(r.text),r.translation&&l.setTranslation(r.translation),r.examples&&l.setExamples(r.examples),r.image&&l.setImage(r.image),r.imageUrl&&l.setImageUrl(r.imageUrl),r.front&&l.setFront(r.front),r.back&&l.setBack(r.back),r.linguisticInfo&&l.setLinguisticInfo(r.linguisticInfo),r.transcription&&l.setTranscription(r.transcription),z(r.text),i(!0)):($n("Card ID from localStorage not found in storage, resetting"),localStorage.removeItem("current_card_id"),localStorage.removeItem("explicitly_saved"),l.setCurrentCardId(null),ge(!0),ye(!1))}else $n("No current card ID in localStorage"),ge(!0),ye(!1)}),200),[2]}))}))}),[]),(0,r.useEffect)((function(){u&&!he&&""!==u.trim()&&(!a||y?(y||($n("Actively typing new card text - ensuring not marked as saved"),ye(!1),localStorage.removeItem("explicitly_saved")),ur(u)):$n("New card being created, skipping automatic saved detection"))}),[u,y,he,a,ur]);var Ir=function(){s((0,Ye.qM)(Qe)),Te(!1)},zr=function(){s((0,Ye.Fo)(et)),Ke(!1)},Fr=function(){$n("Canceling current card, clearing all state"),Yn.current&&($n("Aborting ongoing AI requests"),Yn.current.abort(),Yn.current=null),i(!1),oe(!1),s(Pe(null)),ge(!0),ye(!1),localStorage.removeItem("explicitly_saved"),localStorage.removeItem("current_card_id"),l.setIsGeneratingCard(!1),_(!1),Kt([]),tn(!1),Jt(0),s(Fe("")),s(je("")),s(Me([])),s(Be(null)),s(Re(null)),s(Le("")),s(Oe(null)),s(_e("")),s(De("")),z(""),s(Ue(null))},Mr=function(){switch(Se){case Pt.l.OpenAI:return(0,o.jsx)("span",_n({style:{display:"inline-flex",alignItems:"center",marginLeft:"8px",padding:"2px 6px",borderRadius:"4px",backgroundColor:"#10a37f",color:"white",fontSize:"10px",fontWeight:"600"}},{children:"OpenAI"}));case Pt.l.Groq:return(0,o.jsx)("span",_n({style:{display:"inline-flex",alignItems:"center",marginLeft:"8px",padding:"2px 6px",borderRadius:"4px",backgroundColor:"#7c3aed",color:"white",fontSize:"10px",fontWeight:"600"}},{children:"Groq"}));default:return null}},jr=function(){if($n("Modal close handler. Card saved status:",lr,"isEdited:",re),en)return $n("Closing modal for multiple cards without automatic saving"),void Ft(!1);!a||lr||re||!d||en?lr||($n("Card not saved, clearing all data"),s(Fe("")),s(je("")),s(Me([])),s(Be(null)),s(Re(null)),s(Le("")),s(Oe(null)),s(_e("")),s(De("")),i(!1)):($n("Closing without saving, clearing all card data"),s(Fe("")),s(je("")),s(Me([])),s(Be(null)),s(Re(null)),s(Le("")),s(Oe(null)),s(_e("")),s(De("")),i(!1)),Ft(!1)},Br=function(){return Dn(void 0,void 0,void 0,(function(){var e,t,n,r,a,o,c,u,d,p,f,h,g,m,v,y,b,x,w,E,T,I,F,M,j,B,R,O,N,P,D,q,U,$,H,V,G,W,Y,K,X,Z,ee,ne,re,ae,oe,ie,le,se;return qn(this,(function(ce){switch(ce.label){case 0:if(0===(e=Object.keys(Vt).filter((function(e){return Vt[e]}))).length)return at("Please select at least one text option","warning"),[2];if(A!==Q.d.LanguageLearning)return at("Multiple card creation is only available in Language Learning mode","warning"),[2];if(!Zn)return tr(),[2];Kn.current=!1,Yn.current=new AbortController,t=Yn.current.signal,$n("*** MULTIPLE CARDS CREATION STARTED ***"),$n("Image generation settings:",{imageGenerationMode:Ce,modelProvider:Se,isImageGenerationAvailable:br(),selectedOptionsCount:e.length}),Dt(!1),pe(!1),_(!0),l.setIsGeneratingCard(!0),ce.label=1;case 1:ce.trys.push([1,34,35,36]),n=[],r=0,a=e,ce.label=2;case 2:if(!(r<a.length))return[3,33];if(o=a[r],t.aborted)return $n("Multiple cards creation cancelled by user"),[2];s(Fe("")),s(je("")),s(Me([])),s(_e("")),s(Fe(o)),z(o),ye(!1),localStorage.removeItem("explicitly_saved"),ce.label=3;case 3:if(ce.trys.push([3,31,,32]),c=ea,!pa)return[3,7];ce.label=4;case 4:return ce.trys.push([4,6,,7]),[4,ya(o)];case 5:return(u=ce.sent())&&(c=u),[3,7];case 6:return d=ce.sent(),console.error('Language detection failed for option "'.concat(o,'":'),d),[3,7];case 7:return[4,(0,Nt.createTranslation)(Jn,Zn,o,S,k,void 0,t)];case 8:return p=ce.sent(),t.aborted?($n("Multiple cards creation cancelled by user after translation"),[2]):(p.translated&&s(je(p.translated)),f=pa?c:Qr,[4,(0,Nt.createExamples)(Jn,Zn,o,S,!0,k,f||void 0,t)]);case 9:return h=ce.sent(),t.aborted?($n("Multiple cards creation cancelled by user after examples"),[2]):(h&&h.length>0&&(g=h.map((function(e){return[e.original,e.translated]})),s(Me(g))),[4,(0,Nt.createFlashcard)(Jn,Zn,o,t)]);case 10:return m=ce.sent(),t.aborted?($n("Multiple cards creation cancelled by user after flashcard"),[2]):(m.front&&s(Le(m.front)),y="",(v=pa?c:Qr)?(b=void 0,$n('Using optimized linguistic info creation for "'.concat(o,'" (max 2 requests)')),[4,(0,Nt.createOptimizedLinguisticInfo)(Jn,Zn,o,v,S)]):[3,12]);case 11:(b=ce.sent()).linguisticInfo?(y=b.linguisticInfo,s(_e(b.linguisticInfo)),b.wasValidated?$n('Linguistic info for "'.concat(o,'" created and validated')):console.warn('Linguistic info for "'.concat(o,'" created but not fully validated'))):console.warn('Failed to generate linguistic info for "'.concat(o,'"')),ce.label=12;case 12:x="",ce.label=13;case 13:return ce.trys.push([13,19,,20]),(w=pa?c:Qr)?($n('Creating transcription for "'.concat(o,'" using source language: ').concat(w,", user language: ").concat(S)),[4,(0,Nt.createTranscription)(Jn,Zn,o,w,S)]):[3,17];case 14:return(E=ce.sent())?[4,Aa(S)]:[3,16];case 15:T=ce.sent(),(I=[E.userLanguageTranscription&&'<div class="transcription-item user-lang">\n                                            <span class="transcription-label">'.concat(T,':</span>\n                                            <span class="transcription-text">').concat(E.userLanguageTranscription,"</span>\n                                        </div>"),E.ipaTranscription&&'<div class="transcription-item ipa">\n                                            <span class="transcription-label">IPA:</span>\n                                            <span class="transcription-text">'.concat(E.ipaTranscription,"</span>\n                                        </div>")].filter(Boolean).join("\n"))&&(x=I,s(De(I)),$n('Transcription created successfully for "'.concat(o,'"'))),ce.label=16;case 16:return[3,18];case 17:console.warn('No source language available for transcription of "'.concat(o,'"')),ce.label=18;case 18:return[3,20];case 19:return F=ce.sent(),console.error('Transcription generation failed for "'.concat(o,'":'),F),[3,20];case 20:if(M=null,j=null,"off"===Ce||!br())return[3,29];ce.label=21;case 21:return ce.trys.push([21,28,,29]),B="always"===Ce,R="","smart"!==Ce?[3,23]:[4,Ta(o)];case 22:O=ce.sent(),B=O.shouldGenerate,R=O.reason,$n('Smart image analysis for "'.concat(o,'": ').concat(B?"YES":"NO"," - ").concat(R)),ce.label=23;case 23:return B?($n('Generating image for "'.concat(o,'"')),[4,Jn.getDescriptionImage(Zn,o,C)]):[3,26];case 24:return N=ce.sent(),[4,hn(be,N,C)];case 25:return P=ce.sent(),D=P.imageUrl,q=P.imageBase64,D&&(M=D,$n('Image URL generated for "'.concat(o,'": ').concat(D.substring(0,50),"..."))),q&&(j=q,$n('Image base64 generated for "'.concat(o,'": ').concat(q.substring(0,50),"..."))),[3,27];case 26:"smart"===Ce&&$n('No image needed for "'.concat(o,'": ').concat(R)),ce.label=27;case 27:return[3,29];case 28:return U=ce.sent(),console.error('Image generation failed for "'.concat(o,'":'),U),[3,29];case 29:return $="general_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9),"_").concat(n.length),H={id:$,mode:A,text:o,translation:p.translated||"",examples:h.map((function(e){return[e.original,e.translated]})),linguisticInfo:y,transcription:x,front:m.front||"",back:p.translated||"",image:j,imageUrl:M,createdAt:new Date,exportStatus:"not_exported"},[4,L(null!==(re=H.image)&&void 0!==re?re:null,null!==(ae=H.imageUrl)&&void 0!==ae?ae:null)];case 30:return V=ce.sent(),G=_n(_n({},H),{image:V.image,imageUrl:V.imageUrl}),$n("Created card ".concat(G.id," but NOT saving to storage yet. Image info:"),{hasImage:!!G.image,hasImageUrl:!!G.imageUrl,imageLength:null===(oe=G.image)||void 0===oe?void 0:oe.length,imageUrlLength:null===(ie=G.imageUrl)||void 0===ie?void 0:ie.length}),n.push(G),[3,32];case 31:if((W=ce.sent())instanceof Error&&lt(W))throw console.error("Quota error detected, stopping multiple cards creation:",W.message),at(W.message),W;return console.error('Error creating card for "'.concat(o,'":'),W),Y=W instanceof Error?W.message:"Unknown error",at('Failed to create card for "'.concat(o.substring(0,20),'...": ').concat(Y),"error"),nr(Y),[3,32];case 32:return r++,[3,2];case 33:return n.length>0?(Kt(n),Jt(0),tn(n.length>1),(K=n[0])&&($n("Loading first card into Redux state:",{cardId:K.id,hasImage:!!K.image,hasImageUrl:!!K.imageUrl,imageLength:null===(le=K.image)||void 0===le?void 0:le.length,imageUrlLength:null===(se=K.imageUrl)||void 0===se?void 0:se.length}),"string"==typeof K.text&&s(Fe(K.text)),s(je(void 0===K.translation?null:K.translation)),s(Me(Array.isArray(K.examples)?K.examples:[])),s(Be(void 0===K.image?null:K.image)),s(Re(void 0===K.imageUrl?null:K.imageUrl)),"string"==typeof K.front&&s(Le(K.front)),s(Oe(void 0===K.back?null:K.back)),s(_e(K.linguisticInfo||"")),K.transcription?s(De(K.transcription)):s(De("")),$n("First card loaded into Redux state successfully")),ye(!1),or([]),localStorage.removeItem("explicitly_saved"),$n("Reset saved status for new multiple cards"),or([]),localStorage.removeItem("explicitly_saved"),ye(!1),i(!0),Ft(!0),$n("Created new cards, none saved yet. Card IDs:",n.map((function(e){return e.id})))):(at(X="Failed to create cards. Please try again.","error"),nr(X)),[3,36];case 34:if(Z=ce.sent(),t.aborted)throw $n("Multiple cards creation was cancelled by user"),new Error("Operation cancelled by user");return Z instanceof Error&&lt(Z)?(console.error("Quota error detected in multiple cards creation:",Z.message),at(Z.message),nr(Z.message),[2]):(console.error("Error processing selected options:",Z),ee=Z instanceof Error?Z.message:"Failed to create cards. Please try again.",at(ee),ne=nr(ee),_(!1),J(null),te({completed:0,total:0}),l.setIsGeneratingCard(!1),ne&&Yn.current&&Yn.current.abort(),[3,36]);case 35:return $n("\u{1f3af} Multiple cards creation finally block reached"),Kn.current?($n("\u{1f6ab} Critical API error detected - skipping delayed loader hide"),Kn.current=!1,_(!1),J(null),te({completed:0,total:0}),l.setIsGeneratingCard(!1),Gt({}),Yn.current=null,[2]):(setTimeout((function(){$n("\u23f3 Checking for pending operations in multiple cards creation...");var e=(0,un.cr)(),t=e.getStats(),n=t.inProgress>0;$n("\u{1f4ca} Multiple cards tracker stats:",t),n?($n("\u23f8\ufe0f Keeping loader visible for multiple cards - operations still running"),setTimeout((function(){$n("\u23f3 Final check for multiple cards..."),0===e.getStats().inProgress&&($n("\u2705 Multiple cards operations completed - hiding loader"),_(!1),l.setIsGeneratingCard(!1),Gt({}))}),3e3)):($n("\u2705 No pending operations in multiple cards - hiding loader"),_(!1),l.setIsGeneratingCard(!1),Gt({}))}),1e3),Yn.current=null,Kn.current=!1,[7]);case 36:return[2]}}))}))},Rr=function(e){!function(e){Gt((function(t){var n;return _n(_n({},t),((n={})[e]=!t[e],n))}))}(e)},Or=function(){if(!(Yt.length<=1||Qt>=Yt.length-1)){Lr();var e=Qt+1;$n("Moving from card ".concat(Qt," to card ").concat(e));var t=Yt[e];t&&($n("Loading next card data: ".concat(t.id,", text: ").concat(t.text,", linguistic info: ").concat(t.linguisticInfo?"yes":"no")),Nr(t),Jt(e))}},Lr=function(){if(Yt[Qt]){$n("Saving current card state:",{index:Qt,text:u,linguisticInfo:b?b.substring(0,30)+"...":"empty"});var e=_n(_n({},Yt[Qt]),{text:u,translation:d,examples:p,image:f,imageUrl:h,front:g,back:v||null,linguisticInfo:b||"",transcription:x||""}),t=Un([],Yt,!0);t[Qt]=e,Kt(t),$n("Updated card saved:",e.id)}},Nr=function(e){var t,n;$n("Loading card data for card:",{id:e.id,text:e.text,hasLinguisticInfo:Boolean(e.linguisticInfo),hasImage:!!e.image,hasImageUrl:!!e.imageUrl,imageLength:null===(t=e.image)||void 0===t?void 0:t.length,imageUrlLength:null===(n=e.imageUrl)||void 0===n?void 0:n.length}),s(Fe("")),s(je(null)),s(Me([])),s(Be(null)),s(Re(null)),s(Le("")),s(Oe(null)),s(_e("")),s(De("")),"string"==typeof e.text&&s(Fe(e.text)),s(je(void 0===e.translation?null:e.translation)),s(Me(Array.isArray(e.examples)?e.examples:[])),s(Be(void 0===e.image?null:e.image)),s(Re(void 0===e.imageUrl?null:e.imageUrl)),"string"==typeof e.front&&s(Le(e.front)),s(Oe(void 0===e.back?null:e.back)),e.linguisticInfo?($n("Setting linguistic info:",e.linguisticInfo.substring(0,30)+"..."),s(_e(e.linguisticInfo))):($n("No linguistic info found for this card"),s(_e(""))),e.transcription?($n("Setting transcription:",e.transcription.substring(0,30)+"..."),s(De(e.transcription))):($n("No transcription found for this card"),s(De(""))),$n("Card data loaded successfully, image status:",{hasImage:!!e.image,hasImageUrl:!!e.imageUrl})},Pr=function(){if(!(Yt.length<=1||Qt<=0)){Lr();var e=Qt-1;$n("Moving from card ".concat(Qt," to card ").concat(e));var t=Yt[e];t&&($n("Loading previous card data: ".concat(t.id,", text: ").concat(t.text,", linguistic info: ").concat(t.linguisticInfo?"yes":"no")),Nr(t),Jt(e))}},_r=[{code:"ru",name:"\u0420\u0443\u0441\u0441\u043a\u0438\u0439",flag:"\u{1f1f7}\u{1f1fa}",englishName:"Russian"},{code:"en",name:"English",flag:"\u{1f1ec}\u{1f1e7}",englishName:"English"},{code:"es",name:"Espa\xf1ol",flag:"\u{1f1ea}\u{1f1f8}",englishName:"Spanish"},{code:"fr",name:"Fran\xe7ais",flag:"\u{1f1eb}\u{1f1f7}",englishName:"French"},{code:"de",name:"Deutsch",flag:"\u{1f1e9}\u{1f1ea}",englishName:"German"},{code:"it",name:"Italiano",flag:"\u{1f1ee}\u{1f1f9}",englishName:"Italian"},{code:"pt",name:"Portugu\xeas",flag:"\u{1f1f5}\u{1f1f9}",englishName:"Portuguese"},{code:"ja",name:"\u65e5\u672c\u8a9e",flag:"\u{1f1ef}\u{1f1f5}",englishName:"Japanese"},{code:"ko",name:"\ud55c\uad6d\uc5b4",flag:"\u{1f1f0}\u{1f1f7}",englishName:"Korean"},{code:"zh",name:"\u4e2d\u6587",flag:"\u{1f1e8}\u{1f1f3}",englishName:"Chinese"},{code:"ar",name:"\u0627\u0644\u0639\u0631\u0628\u064a\u0629",flag:"\u{1f1e6}\u{1f1ea}",englishName:"Arabic"},{code:"hi",name:"\u0939\u093f\u0902\u0926\u0940",flag:"\u{1f1ee}\u{1f1f3}",englishName:"Hindi"},{code:"bn",name:"\u09ac\u09be\u0982\u09b2\u09be",flag:"\u{1f1e7}\u{1f1e9}",englishName:"Bengali"},{code:"tr",name:"T\xfcrk\xe7e",flag:"\u{1f1f9}\u{1f1f7}",englishName:"Turkish"},{code:"pl",name:"Polski",flag:"\u{1f1f5}\u{1f1f1}",englishName:"Polish"},{code:"nl",name:"Nederlands",flag:"\u{1f1f3}\u{1f1f1}",englishName:"Dutch"},{code:"cs",name:"\u010ce\u0161tina",flag:"\u{1f1e8}\u{1f1ff}",englishName:"Czech"},{code:"sv",name:"Svenska",flag:"\u{1f1f8}\u{1f1ea}",englishName:"Swedish"},{code:"vi",name:"Ti\u1ebfng Vi\u1ec7t",flag:"\u{1f1fb}\u{1f1f3}",englishName:"Vietnamese"},{code:"th",name:"\u0e20\u0e32\u0e29\u0e32\u0e44\u0e17\u0e22",flag:"\u{1f1f9}\u{1f1ed}",englishName:"Thai"},{code:"he",name:"\u05e2\u05b4\u05d1\u05b0\u05e8\u05b4\u05d9\u05ea",flag:"\u{1f1ee}\u{1f1f1}",englishName:"Hebrew"},{code:"id",name:"Bahasa Indonesia",flag:"\u{1f1ee}\u{1f1e9}",englishName:"Indonesian"},{code:"uk",name:"\u0423\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430",flag:"\u{1f1fa}\u{1f1e6}",englishName:"Ukrainian"},{code:"el",name:"\u0395\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ac",flag:"\u{1f1ec}\u{1f1f7}",englishName:"Greek"},{code:"ro",name:"Rom\xe2n\u0103",flag:"\u{1f1f7}\u{1f1f4}",englishName:"Romanian"},{code:"hu",name:"Magyar",flag:"\u{1f1ed}\u{1f1fa}",englishName:"Hungarian"},{code:"fi",name:"Suomi",flag:"\u{1f1eb}\u{1f1ee}",englishName:"Finnish"},{code:"da",name:"Dansk",flag:"\u{1f1e9}\u{1f1f0}",englishName:"Danish"},{code:"no",name:"Norsk",flag:"\u{1f1f3}\u{1f1f4}",englishName:"Norwegian"},{code:"sk",name:"Sloven\u010dina",flag:"\u{1f1f8}\u{1f1f0}",englishName:"Slovak"},{code:"lt",name:"Lietuvi\u0173",flag:"\u{1f1f1}\u{1f1f9}",englishName:"Lithuanian"},{code:"lv",name:"Latvie\u0161u",flag:"\u{1f1f1}\u{1f1fb}",englishName:"Latvian"},{code:"bg",name:"\u0411\u044a\u043b\u0433\u0430\u0440\u0441\u043a\u0438",flag:"\u{1f1e7}\u{1f1ec}",englishName:"Bulgarian"},{code:"hr",name:"Hrvatski",flag:"\u{1f1ed}\u{1f1f7}",englishName:"Croatian"},{code:"sr",name:"\u0421\u0440\u043f\u0441\u043a\u0438",flag:"\u{1f1f7}\u{1f1f8}",englishName:"Serbian"},{code:"et",name:"Eesti",flag:"\u{1f1ea}\u{1f1ea}",englishName:"Estonian"},{code:"sl",name:"Sloven\u0161\u010dina",flag:"\u{1f1f8}\u{1f1ee}",englishName:"Slovenian"}],Dr=(0,r.useState)(!1),qr=Dr[0],Ur=Dr[1],$r=(0,r.useState)(""),Hr=$r[0],Vr=$r[1],Gr=(0,r.useMemo)((function(){if(!Hr)return _r;var e=Hr.toLowerCase();return _r.filter((function(t){return t.name.toLowerCase().includes(e)||t.englishName.toLowerCase().includes(e)||t.code.toLowerCase().includes(e)}))}),[Hr]),Wr=(0,r.useMemo)((function(){return _r.find((function(e){return e.code===S}))||_r[0]}),[S]),Yr="target_language";r.useEffect((function(){try{var e=localStorage.getItem(Yr);if(e&&e!==S)_r.some((function(t){return t.code===e}))&&s((0,Ye._W)(e))}catch(e){}}),[]),r.useEffect((function(){try{S&&localStorage.setItem(Yr,S)}catch(e){}}),[S]);var Kr=function(){return qr?(0,o.jsx)("div",_n({style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(2px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"16px"},onClick:function(){return Ur(!1)}},{children:(0,o.jsxs)("div",_n({style:{backgroundColor:"#FFFFFF",borderRadius:"12px",width:"90%",maxWidth:"360px",maxHeight:"80vh",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",overflow:"hidden",display:"flex",flexDirection:"column"},onClick:function(e){return e.stopPropagation()}},{children:[(0,o.jsxs)("div",_n({style:{padding:"16px",borderBottom:"1px solid #E5E7EB",display:"flex",flexDirection:"column",gap:"12px"}},{children:[(0,o.jsxs)("div",_n({style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},{children:[(0,o.jsx)("h3",_n({style:{margin:0,fontSize:"16px",fontWeight:600,color:"#111827"}},{children:"Select Your Language"})),(0,o.jsx)("button",_n({onClick:function(){return Ur(!1)},style:{background:"none",border:"none",cursor:"pointer",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"6px"}},{children:(0,o.jsx)("svg",_n({xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"#6B7280",viewBox:"0 0 16 16"},{children:(0,o.jsx)("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})}))}))]})),(0,o.jsxs)("div",_n({style:{position:"relative",width:"100%"}},{children:[(0,o.jsx)("input",{type:"text",value:Hr,onChange:function(e){return Vr(e.target.value)},placeholder:"Search languages...",style:{width:"100%",padding:"10px 12px 10px 36px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#F9FAFB",fontSize:"14px",color:"#374151",outline:"none"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}}),(0,o.jsx)("svg",_n({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"#9CA3AF",viewBox:"0 0 16 16",style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)"}},{children:(0,o.jsx)("path",{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"})})),Hr&&(0,o.jsx)("button",_n({onClick:function(){return Vr("")},style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",backgroundColor:"#E5E7EB"}},{children:(0,o.jsx)("svg",_n({xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"#6B7280",viewBox:"0 0 16 16"},{children:(0,o.jsx)("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})}))}))]})),(0,o.jsx)("p",_n({style:{margin:0,fontSize:"12px",color:"#6B7280",lineHeight:1.5}},{children:"This will be used for both the interface language and translations. Your cards will be created in this language."}))]})),(0,o.jsx)("div",_n({style:{overflowY:"auto",maxHeight:"calc(80vh - 135px)",padding:"8px 0"}},{children:0===Gr.length?(0,o.jsxs)("div",_n({style:{padding:"16px",textAlign:"center",color:"#6B7280",fontSize:"14px"}},{children:['No languages found matching "',Hr,'"']})):Gr.map((function(e){return(0,o.jsxs)("button",_n({onClick:function(){s((0,Ye._W)(e.code)),Ur(!1)},style:{display:"flex",alignItems:"center",width:"100%",padding:"12px 16px",backgroundColor:e.code===S?"#EFF6FF":"transparent",border:"none",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s"},onMouseOver:function(t){e.code!==S&&(t.currentTarget.style.backgroundColor="#F3F4F6")},onMouseOut:function(t){e.code!==S&&(t.currentTarget.style.backgroundColor="transparent")}},{children:[(0,o.jsx)("span",_n({style:{fontSize:"22px",marginRight:"12px",width:"28px",textAlign:"center"}},{children:e.flag})),(0,o.jsxs)("div",_n({style:{display:"flex",flexDirection:"column",alignItems:"flex-start"}},{children:[(0,o.jsx)("span",_n({style:{color:e.code===S?"#2563EB":"#111827",fontWeight:e.code===S?"600":"normal",fontSize:"14px"}},{children:e.name})),e.englishName!==e.name&&(0,o.jsx)("span",_n({style:{color:"#6B7280",fontSize:"12px"}},{children:e.englishName}))]})),e.code===S&&(0,o.jsx)("svg",_n({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"#2563EB",viewBox:"0 0 16 16",style:{marginLeft:"auto"}},{children:(0,o.jsx)("path",{d:"M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"})}))]}),e.code)}))}))]}))})):(0,o.jsxs)("div",_n({style:{position:"relative",width:"100%",display:"flex",flexDirection:"column",gap:"8px"}},{children:[(0,o.jsxs)("label",_n({style:{color:"#111827",fontWeight:"600",fontSize:"14px",margin:0,display:"flex",alignItems:"center",gap:"6px"}},{children:["Your Language",(0,o.jsx)("span",_n({style:{fontSize:"12px",color:"#6B7280",fontWeight:"normal",fontStyle:"italic"}},{children:"(translations)"}))]})),(0,o.jsxs)("button",_n({onClick:function(){return Ur(!0)},style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#F9FAFB",color:"#374151",fontSize:"14px",cursor:"pointer",transition:"all 0.2s ease",textAlign:"left"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="#F3F4F6"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="#F9FAFB"}},{children:[(0,o.jsxs)("span",_n({style:{display:"flex",alignItems:"center",gap:"8px"}},{children:[(0,o.jsx)("span",_n({style:{fontSize:"18px"}},{children:Wr.flag})),(0,o.jsx)("span",{children:Wr.name})]})),(0,o.jsx)("svg",_n({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},{children:(0,o.jsx)("path",{fillRule:"evenodd",d:"M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"})}))]}))]}))},Xr=(0,r.useState)((function(){return localStorage.getItem("source_language")||""})),Qr=Xr[0],Jr=Xr[1],Zr=(0,r.useState)((function(){return localStorage.getItem("detected_language")||null})),ea=Zr[0],ta=Zr[1],na=(0,r.useState)(!1),ra=na[0],aa=na[1],oa=(0,r.useState)(!1),ia=oa[0],la=oa[1],sa=(0,r.useState)(""),ca=sa[0],ua=sa[1],da=(0,r.useState)((function(){return"false"!==localStorage.getItem("auto_detect_language")})),pa=da[0],fa=da[1],ha=(0,r.useMemo)((function(){if(!ca)return _r;var e=ca.toLowerCase();return _r.filter((function(t){return t.name.toLowerCase().includes(e)||t.englishName.toLowerCase().includes(e)||t.code.toLowerCase().includes(e)}))}),[ca]),ga=(0,r.useMemo)((function(){return Qr?_r.find((function(e){return e.code===Qr}))||null:ea&&_r.find((function(e){return e.code===ea}))||null}),[Qr,ea]),ma=(0,r.useCallback)((function(e){var t=e.trim().toLowerCase();if(/[\u0430-\u044f\u0451]/i.test(t))return"ru";if(/^[a-z\s\.,!?\-'"]+$/i.test(t)){var n=["the","and","is","in","to","of","a","for","with","on","at","by","from","this","that","it","he","she","they","we","you","was","were","are","have","has","had","can","will","would","could","should"],r=t.split(/\s+/);if(r.filter((function(e){return n.includes(e.replace(/[^\w]/g,""))})).length>0||1===r.length)return"en"}return/[\xf1\xe1\xe9\xed\xf3\xfa\xfc]/i.test(t)?"es":/[\xe0\xe2\xe4\xe9\xe8\xea\xeb\xef\xee\xf4\xf6\xf9\xfb\xfc\xff\xe7]/i.test(t)?"fr":/[\xe4\xf6\xfc\xdf]/i.test(t)?"de":/[\xe0\xe8\xe9\xec\xed\xee\xf2\xf3\xf9]/i.test(t)?"it":null}),[]),va=(0,r.useCallback)((function(e){var t=e.trim().toLowerCase(),n=t.replace(/[\u0430-\u044f\u0451]/g,"C").replace(/[a-z]/g,"L").replace(/[0-9]/g,"N").replace(/\s+/g,"S").replace(/[^\w\s]/g,"P").slice(0,50);return"lang_pattern_".concat(n,"_").concat(t.length<20?t:t.slice(0,20))}),[]),ya=(0,r.useCallback)((function(e){return Dn(void 0,void 0,void 0,(function(){var t,n,r,a,o,i,l,s,u,d,p,f,h,g,m,v,y,b,x,w,S,k,C,E,A,T,I,z,F,M,j,B,R,O,L,N,P,_,D;return qn(this,(function(q){switch(q.label){case 0:if($n("=== LANGUAGE DETECTION START ==="),$n("Input text:",e.substring(0,100)+(e.length>100?"...":"")),$n("Text length:",e.length),!e||e.trim().length<2)return $n("Text too short for language detection"),[2,null];if(t=null,n=function(n,r){var a=(n||"").trim().toLowerCase();if(a){ea!==a&&($n("Setting detected language (".concat(r,"):"),a),ta(a)),localStorage.setItem("detected_language",a);var o=va(e);localStorage.setItem(o,a),c(a),t=a}},r=ma(e))return $n("Language detected offline:",r),n(r,"offline detection"),[2,t];if(a=va(e),(o=localStorage.getItem(a))&&ea!==o)return $n("Using smart cached language detection result:",o),n(o,"smart cache"),[2,t];if(ea&&o===ea)return $n("Language already detected for this text:",ea),t=ea,[2,ea];if((0,We.isQuotaExceededCached)())return $n("Language detection skipped due to cached quota error"),(0,We.shouldShowQuotaNotification)()&&(h=(0,We.getCachedQuotaError)())&&(at(h),(0,We.markQuotaNotificationShown)()),[2,null!=ea?ea:t];if(i=localStorage.getItem("last_language_api_call"),l=Date.now(),i&&l-parseInt(i)<2e3)return $n("Language detection API call skipped - too frequent calls"),[2,null!=ea?ea:t];$n("Making API call for language detection..."),localStorage.setItem("last_language_api_call",l.toString()),aa(!0),q.label=1;case 1:if(q.trys.push([1,13,14,15]),!(Se===Pt.l.OpenAI&&be||Se===Pt.l.Groq&&xe))return[3,11];if(Se!==Pt.l.OpenAI)return[3,7];if((0,We.isQuotaExceededCached)()){if($n("OpenAI language detection skipped due to cached quota error"),(0,We.shouldShowQuotaNotification)()&&(h=(0,We.getCachedQuotaError)()))throw new Error(h);return[2,null!=ea?ea:t]}q.label=2;case 2:return q.trys.push([2,5,,6]),[4,(0,gn.H)("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(be)},body:JSON.stringify({model:"gpt-5-nano",messages:[{role:"system",content:"You are a language detection assistant. Respond only with the ISO 639-1 language code."},{role:"user",content:"Detect the language of this text and respond only with the ISO 639-1 language code (e.g. 'en', 'ru', 'fr', etc.): \"".concat(e,'"')}]})})];case 3:return[4,(u=q.sent()).json()];case 4:if(d=q.sent(),!u.ok){if(null==d?void 0:d.error)throw p=(0,We.formatOpenAIErrorMessage)(d),"insufficient_quota"!==d.error.code&&429!==u.status||((0,We.cacheQuotaExceededError)(p),$n("Quota error detected and cached in OpenAI language detection")),new Error(p);throw new Error("OpenAI API error: ".concat(u.status," ").concat(u.statusText))}return s=null===(L=null===(O=null===(R=null===(B=d.choices)||void 0===B?void 0:B[0])||void 0===R?void 0:R.message)||void 0===O?void 0:O.content)||void 0===L?void 0:L.trim().toLowerCase(),$n("Language detected via OpenAI:",s),[3,6];case 5:throw(f=q.sent())instanceof Error&&((x=f.message).includes("quota")||x.includes("insufficient_quota")||x.includes("billing")||x.includes("exceeded")||x.includes("429"))&&((0,We.cacheQuotaExceededError)(x),$n("Quota error detected and cached in OpenAI language detection")),f;case 6:return[3,10];case 7:if(Se!==Pt.l.Groq)return[3,10];if((0,We.isQuotaExceededCached)()){if($n("Groq language detection skipped due to cached quota error"),(0,We.shouldShowQuotaNotification)()&&(h=(0,We.getCachedQuotaError)()))throw new Error(h);return[2,null!=ea?ea:t]}return[4,(0,gn.H)("https://api.groq.com/openai/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(xe)},body:JSON.stringify({model:we,messages:[{role:"system",content:"You are a language detection assistant. Respond only with the ISO 639-1 language code."},{role:"user",content:"Detect the language of this text and respond only with the ISO 639-1 language code (e.g. 'en', 'ru', 'fr', etc.): \"".concat(e,'"')}],max_tokens:5,temperature:0})})];case 8:return[4,(g=q.sent()).json()];case 9:if(m=q.sent(),!g.ok)throw v=m&&m.error&&m.error.message?"Groq API error: ".concat(m.error.message):"Groq API error: ".concat(g.status," ").concat(g.statusText),(429===g.status||v.toLowerCase().includes("quota"))&&(0,We.cacheQuotaExceededError)(v),console.error("Groq language detection failed:",m||g.statusText),new Error(v);s=null===(D=null===(_=null===(P=null===(N=m.choices)||void 0===N?void 0:N[0])||void 0===P?void 0:P.message)||void 0===_?void 0:_.content)||void 0===D?void 0:D.trim().toLowerCase(),$n("Language detected via Groq:",s),q.label=10;case 10:return s&&_r.some((function(e){return e.code===s}))?($n("Language successfully detected:",s),n(s,"API detection"),[2,t]):($n("Invalid or unrecognized language code:",s),[3,12]);case 11:if(y=e.trim().toLowerCase().slice(0,100),C=/[\u0430-\u044f\u0451]/gi,E=/[a-z]/gi,A=/[\u4e00-\u9fff]/gi,T=/[\u3040-\u309f\u30a0-\u30ff]/gi,I=/[\uac00-\ud7af]/gi,z=/[\u0600-\u06ff]/gi,F=/[\xe1\xe9\xed\xf3\xfa\xfc\xf1\xbf\xa1]/gi,M=["hasta","desde","como","pero","porque","adonde","quien","para","por"].some((function(e){return y===e||y.startsWith(e+" ")||y.includes(" "+e+" ")})),j="",C.test(y)?($n("Detected Cyrillic script - setting Russian"),j="ru"):A.test(y)?($n("Detected Chinese characters"),j="zh"):T.test(y)?($n("Detected Japanese characters"),j="ja"):I.test(y)?($n("Detected Korean characters"),j="ko"):z.test(y)?($n("Detected Arabic script"),j="ar"):F.test(y)||M?($n("Detected Spanish text or common Spanish word"),j="es"):E.test(y)&&($n("Detected Latin script, defaulting to English"),j="en"),j)return $n("Language detected using fallback method:",j),n(j,"fallback detection"),[2,t];q.label=12;case 12:return[3,15];case 13:return b=q.sent(),console.error("Error detecting language:",b),b instanceof Error&&lt(b)?(console.error("Quota error detected in language detection:",b.message),at(b.message),(0,We.markQuotaNotificationShown)(),[2,null!=ea?ea:t]):(x=b instanceof Error?b.message:String(b),(x.includes("401")||x.includes("Unauthorized")||x.includes("Authentication")||x.includes("Invalid API key")||x.includes("Incorrect API key")||x.includes("API key is missing"))&&(console.warn("API key error detected, disabling auto-detection to prevent infinite retries"),fa(!1),localStorage.setItem("auto_detect_language","false"),w=Se===Pt.l.OpenAI?"OpenAI":Se===Pt.l.Groq?"Groq":"AI","function"==typeof at&&(S="Language detection failed: Invalid ".concat(w," API key. Please check your API key in settings."),at(S,"error"),nr(S)),k=e.trim().toLowerCase().slice(0,100),C=/[\u0430-\u044f\u0451]/gi,E=/[a-z]/gi,A=/[\u4e00-\u9fff]/gi,T=/[\u3040-\u309f\u30a0-\u30ff]/gi,I=/[\uac00-\ud7af]/gi,z=/[\u0600-\u06ff]/gi,F=/[\xe1\xe9\xed\xf3\xfa\xfc\xf1\xbf\xa1]/gi,M=["hasta","desde","como","pero","porque","adonde","quien","para","por"].some((function(e){return k===e||k.startsWith(e+" ")||k.includes(" "+e+" ")})),j="",C.test(k)?j="ru":A.test(k)?j="zh":T.test(k)?j="ja":I.test(k)?j="ko":z.test(k)?j="ar":F.test(k)||M?j="es":E.test(k)&&(j="en"),j)?($n("Language detected using fallback method in error handler:",j),n(j,"fallback method in error handler"),[2,t]):[3,15]);case 14:return aa(!1),$n("=== LANGUAGE DETECTION END ==="),[7];case 15:return[2,t]}}))}))}),[be,Se,xe,we,ma,va,c,ea,at,We.shouldShowQuotaNotification,We.getCachedQuotaError,We.markQuotaNotificationShown,We.cacheQuotaExceededError,fa,_r]),ba=function(){var e=!pa;fa(e),localStorage.setItem("auto_detect_language",e?"true":"false"),pa?ea&&c(ea):(c(""),ta(null),localStorage.removeItem("detected_language"))},xa=function(){return ia?(0,o.jsx)("div",_n({style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(2px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"16px"},onClick:function(){return la(!1)}},{children:(0,o.jsxs)("div",_n({style:{backgroundColor:"#FFFFFF",borderRadius:"12px",width:"90%",maxWidth:"360px",maxHeight:"80vh",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",overflow:"hidden",display:"flex",flexDirection:"column"},onClick:function(e){return e.stopPropagation()}},{children:[(0,o.jsxs)("div",_n({style:{padding:"16px",borderBottom:"1px solid #E5E7EB",display:"flex",flexDirection:"column",gap:"12px"}},{children:[(0,o.jsxs)("div",_n({style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},{children:[(0,o.jsxs)("h3",_n({style:{margin:0,fontSize:"16px",fontWeight:600,color:"#111827",display:"flex",alignItems:"center",gap:"8px"}},{children:[(0,o.jsx)(St,{color:"#6366F1",size:18}),(0,o.jsx)("span",{children:"Select Source Language"})]})),(0,o.jsx)("button",_n({onClick:function(){return la(!1)},style:{background:"none",border:"none",cursor:"pointer",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"6px"}},{children:(0,o.jsx)("svg",_n({xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"#6B7280",viewBox:"0 0 16 16"},{children:(0,o.jsx)("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})}))}))]})),(0,o.jsxs)("div",_n({style:{position:"relative",width:"100%"}},{children:[(0,o.jsx)("input",{type:"text",value:ca,onChange:function(e){return ua(e.target.value)},placeholder:"Search languages...",style:{width:"100%",padding:"10px 12px 10px 36px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#F9FAFB",fontSize:"14px",color:"#374151",outline:"none"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}}),(0,o.jsx)("svg",_n({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"#9CA3AF",viewBox:"0 0 16 16",style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)"}},{children:(0,o.jsx)("path",{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"})})),ca&&(0,o.jsx)("button",_n({onClick:function(){return ua("")},style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",backgroundColor:"#E5E7EB"}},{children:(0,o.jsx)("svg",_n({xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"#6B7280",viewBox:"0 0 16 16"},{children:(0,o.jsx)("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})}))}))]})),(0,o.jsx)("p",_n({style:{margin:0,fontSize:"12px",color:"#6B7280",lineHeight:1.5}},{children:"Select the language of your text. This helps generate more accurate translations and examples."}))]})),(0,o.jsx)("div",_n({style:{overflowY:"auto",maxHeight:"calc(80vh - 135px)",padding:"8px 0"}},{children:0===ha.length?(0,o.jsxs)("div",_n({style:{padding:"16px",textAlign:"center",color:"#6B7280",fontSize:"14px"}},{children:['No languages found matching "',ca,'"']})):ha.map((function(e){return(0,o.jsxs)("button",_n({onClick:function(){Jr(e.code),la(!1),fa(!1)},style:{display:"flex",alignItems:"center",width:"100%",padding:"12px 16px",backgroundColor:e.code===Qr?"#EFF6FF":"transparent",border:"none",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s"},onMouseOver:function(t){e.code!==Qr&&(t.currentTarget.style.backgroundColor="#F3F4F6")},onMouseOut:function(t){e.code!==Qr&&(t.currentTarget.style.backgroundColor="transparent")}},{children:[(0,o.jsx)("span",_n({style:{fontSize:"22px",marginRight:"12px",width:"28px",textAlign:"center"}},{children:e.flag})),(0,o.jsxs)("div",_n({style:{display:"flex",flexDirection:"column",alignItems:"flex-start"}},{children:[(0,o.jsx)("span",_n({style:{color:e.code===Qr?"#2563EB":"#111827",fontWeight:e.code===Qr?"600":"normal",fontSize:"14px"}},{children:e.name})),e.englishName!==e.name&&(0,o.jsx)("span",_n({style:{color:"#6B7280",fontSize:"12px"}},{children:e.englishName}))]})),e.code===Qr&&(0,o.jsx)("svg",_n({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"#2563EB",viewBox:"0 0 16 16",style:{marginLeft:"auto"}},{children:(0,o.jsx)("path",{d:"M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"})}))]}),e.code)}))}))]}))})):(0,o.jsxs)("div",_n({style:{position:"relative",width:"100%",display:"flex",flexDirection:"column",gap:"8px"}},{children:[(0,o.jsxs)("div",_n({style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"}},{children:[(0,o.jsxs)("label",_n({style:{color:"#111827",fontWeight:"600",fontSize:"14px",margin:0,display:"flex",alignItems:"center",gap:"6px"}},{children:[(0,o.jsx)("span",{children:"Source Language"}),(0,o.jsx)("span",_n({style:{fontSize:"12px",color:"#6B7280",fontWeight:"normal",fontStyle:"italic"}},{children:"(of your text)"}))]})),(0,o.jsxs)("div",_n({style:{display:"flex",alignItems:"center",gap:"8px"}},{children:[(0,o.jsx)("span",_n({style:{fontSize:"12px",color:pa?"#10B981":"#9CA3AF",transition:"color 0.2s ease"}},{children:"Auto"})),(0,o.jsx)("button",_n({onClick:ba,style:{width:"36px",height:"20px",backgroundColor:pa?"#10B981":"#E5E7EB",border:"none",borderRadius:"10px",position:"relative",cursor:"pointer",transition:"background-color 0.2s ease"}},{children:(0,o.jsx)("span",{style:{position:"absolute",width:"16px",height:"16px",backgroundColor:"white",borderRadius:"50%",top:"2px",left:pa?"18px":"2px",transition:"left 0.2s ease",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.1)"}})}))]}))]})),(0,o.jsxs)("button",_n({onClick:function(){return la(!0)},disabled:pa,style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:pa?"#F3F4F6":"#F9FAFB",color:"#374151",fontSize:"14px",cursor:pa?"not-allowed":"pointer",opacity:pa?.7:1,transition:"all 0.2s ease",textAlign:"left"},onMouseOver:function(e){return!pa&&(e.currentTarget.style.backgroundColor="#F3F4F6")},onMouseOut:function(e){return!pa&&(e.currentTarget.style.backgroundColor="#F9FAFB")}},{children:[(0,o.jsx)("span",_n({style:{display:"flex",alignItems:"center",gap:"8px"}},{children:ra?(0,o.jsx)(Ot,{type:"spinner",size:"small",inline:!0,color:"#6B7280"}):ga?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",_n({style:{fontSize:"18px"}},{children:ga.flag})),(0,o.jsx)("span",{children:ga.name}),pa&&(0,o.jsxs)("span",_n({style:{fontSize:"11px",color:"#10B981",backgroundColor:"#ECFDF5",padding:"2px 6px",borderRadius:"4px",marginLeft:"4px",display:"flex",alignItems:"center",gap:"3px"}},{children:[(0,o.jsx)(rt,{size:10}),(0,o.jsx)("span",{children:"Detected"})]}))]}):(0,o.jsx)("span",_n({style:{color:"#9CA3AF"}},{children:pa?"Detecting language...":"Select source language"}))})),!pa&&(0,o.jsx)("svg",_n({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},{children:(0,o.jsx)("path",{fillRule:"evenodd",d:"M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"})}))]})),(0,o.jsxs)("div",_n({style:{display:"flex",alignItems:"center",gap:"8px",padding:"6px 8px",backgroundColor:"#F3F4F6",borderRadius:"6px",marginTop:"4px"}},{children:[(0,o.jsxs)("div",_n({style:{display:"flex",alignItems:"center",gap:"4px"}},{children:[(0,o.jsx)("span",_n({style:{fontSize:"14px"}},{children:ga?ga.flag:"\u{1f310}"})),(0,o.jsx)(ht,{size:12,color:"#6B7280"}),(0,o.jsx)("span",_n({style:{fontSize:"14px"}},{children:Wr.flag}))]})),(0,o.jsxs)("span",_n({style:{fontSize:"12px",color:"#4B5563"}},{children:["Translating ",ga?"from ".concat(ga.englishName):""," to ",Wr.englishName]})),pa&&(0,o.jsx)("button",_n({onClick:function(){if((0,We.isQuotaExceededCached)()){if($n("Language detection reset skipped due to cached quota error"),(0,We.shouldShowQuotaNotification)()){var e=(0,We.getCachedQuotaError)();e&&(at(e),(0,We.markQuotaNotificationShown)())}}else u&&($n("Manually triggering language detection for:",u.substring(0,50)+"..."),ya(u))},title:"Reset language detection",style:{marginLeft:"auto",background:"none",border:"none",display:"flex",padding:"2px",cursor:"pointer",color:"#6B7280"}},{children:(0,o.jsxs)("svg",_n({xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",fill:"currentColor",viewBox:"0 0 16 16"},{children:[(0,o.jsx)("path",{d:"M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"}),(0,o.jsx)("path",{d:"M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"})]}))}))]}))]}))},wa=function(e){s(_e(e)),lr&&oe(!0)};(0,r.useEffect)((function(){var e=localStorage.getItem("source_language"),t=localStorage.getItem("detected_language"),n=localStorage.getItem("auto_detect_language");$n("Initializing language settings from localStorage:",{savedSourceLanguage:e,savedDetectedLanguage:t,savedAutoDetect:n}),e?c(e):t&&"false"!==n&&c(t),"false"===n&&fa(!1)}),[]);var Sa,ka,Ca,Ea=(0,r.useCallback)((function(e){return Dn(void 0,void 0,void 0,(function(){var t,n,r,a;return qn(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),Zn?(t='Return only the native name of the language with ISO 639-1 code "'.concat(e,'".\nExamples: \n- "en" -> "English"\n- "ru" -> "\u0420\u0443\u0441\u0441\u043a\u0438\u0439" \n- "es" -> "Espa\xf1ol"\n- "fr" -> "Fran\xe7ais"\n- "de" -> "Deutsch"\n- "zh" -> "\u4e2d\u6587"\n- "ja" -> "\u65e5\u672c\u8a9e"\n- "ar" -> "\u0627\u0644\u0639\u0631\u0628\u064a\u0629"\n\nRespond with ONLY the native language name, no additional text.'),[4,Jn.createChatCompletion(Zn,[{role:"user",content:t}])]):[2,e.toUpperCase()];case 1:return(n=o.sent())&&n.content?(r=n.content.trim(),localStorage.setItem("language_name_".concat(e),r),[2,r]):[2,e.toUpperCase()];case 2:return a=o.sent(),console.error("Error getting language name from AI:",a),[2,e.toUpperCase()];case 3:return[2]}}))}))}),[Zn,Jn]),Aa=(0,r.useCallback)((function(e){return Dn(void 0,void 0,void 0,(function(){var t;return qn(this,(function(n){switch(n.label){case 0:return(t=localStorage.getItem("language_name_".concat(e)))?[2,t]:[4,Ea(e)];case 1:return[2,n.sent()]}}))}))}),[Ea]),Ta=(0,r.useCallback)((function(e){return Dn(void 0,void 0,void 0,(function(){var t,n,r,a,o,i;return qn(this,(function(l){switch(l.label){case 0:if(!e||0===e.trim().length)return[2,{shouldGenerate:!1,reason:"No text provided"}];l.label=1;case 1:return l.trys.push([1,3,,4]),t='Analyze this word/phrase and determine if a visual image would be helpful for language learning: "'.concat(e,'"\n\nConsider these criteria:\n- Concrete objects, animals, places, foods, tools, vehicles = YES\n- Abstract concepts, emotions, actions, grammar terms = NO\n- People, professions, activities that can be visualized = YES\n- Numbers, prepositions, conjunctions, abstract ideas = NO\n\nRespond with ONLY "YES" or "NO" followed by a brief reason (max 10 words).\nFormat: "YES - concrete object that can be visualized" or "NO - abstract concept"'),[4,Jn.createChatCompletion(Zn,[{role:"user",content:t}])];case 2:return(n=l.sent())&&n.content?(r=n.content.trim(),a=r.toUpperCase().startsWith("YES"),o=r.includes(" - ")?r.split(" - ")[1]:"AI analysis",[2,{shouldGenerate:a,reason:o}]):[2,{shouldGenerate:!1,reason:"AI analysis failed"}];case 3:return i=l.sent(),console.error("Error analyzing text for image generation:",i),[2,{shouldGenerate:!1,reason:"Analysis error"}];case 4:return[2]}}))}))}),[Jn,Zn]),Ia=function(e){s((0,Ye.BE)(e)),"smart"===e||"always"===e?($n("\u{1f527} Automatically enabling shouldGenerateImage for ".concat(e," mode")),s((0,Ye.yo)(!0)),setTimeout((function(){$n("\u{1f50d} Verification: shouldGenerateImage should now be true for ".concat(e," mode"))}),100)):"off"===e&&($n("\u{1f527} Disabling shouldGenerateImage for off mode"),s((0,Ye.yo)(!1))),"always"===e&&u&&br()&&gr(),"off"===e&&(s(Be(null)),s(Re(null)))},za=(0,r.useCallback)((function(e,t,n){return Dn(void 0,void 0,void 0,(function(){var r,a,o,l,c,u,d,p,f,h,g,m,v,y,b,x,w,S,k;return qn(this,(function(E){switch(E.label){case 0:if(!t.trim())return at("Please enter some text to create a card from","error"),[2];if(!Zn)return tr(),[2];E.label=1;case 1:return E.trys.push([1,9,10,11]),r=n||e.prompt,a="".concat(r,'\n\nText: "').concat(t,'"\n\nProvide a clear, educational response that would work well as flashcard content. Be concise but informative.'),[4,Jn.translateText(Zn,a,"en")];case 2:if(!(o=E.sent()))throw new Error("Failed to generate card content");if(l=e.name,c=o,"qa"===e.id&&o.includes("Q:")&&o.includes("A:")?(u=o.indexOf("Q:"),d=o.indexOf("A:"),-1!==u&&-1!==d&&d>u&&(l=o.substring(u+2,d).trim(),c=o.substring(d+2).trim())):"definition"===e.id?(p=o.split("\n").filter((function(e){return e.trim()}))).length>0&&((f=p[0]).includes(":")?(h=f.split(":"),l=h[0].trim(),c=h.slice(1).join(":").trim(),p.length>1&&(c+="\n"+p.slice(1).join("\n"))):(g=t.split(" ").filter((function(e){return e.length>3})),l=g.slice(0,3).join(" ")+(g.length>3?"...":""),c=o)):(m=t.length>50?t.substring(0,50)+"...":t,l="".concat(e.name,": ").concat(m),c=o),v=null,!ke||"off"===Ce||!br())return[3,8];E.label=3;case 3:return E.trys.push([3,7,,8]),[4,Jn.getDescriptionImage(Zn,t,C)];case 4:return(y=E.sent())?[4,null===(k=Jn.getImageUrl)||void 0===k?void 0:k.call(Jn,Zn,y)]:[3,6];case 5:(b=E.sent())&&(v=b),E.label=6;case 6:return[3,8];case 7:return x=E.sent(),console.warn("Failed to generate image:",x),[3,8];case 8:return s(Le(l)),s(Oe(c)),s(Fe(t)),v&&s(Re(v)),i(!0),[3,11];case 9:return w=E.sent(),console.error("Error generating general card:",w),S=w instanceof Error?w.message:"Unknown error",at("Failed to generate card: ".concat(S),"error"),nr(S),[3,11];case 10:return[7];case 11:return[2]}}))}))}),[Jn,at,s,ke,Ce,br,C,Zn,tr,nr]),Fa=((0,r.useCallback)((function(e){rn(e),u.trim()&&za(e,u),on(!1)}),[u,za]),(0,r.useCallback)((function(){return Dn(void 0,void 0,void 0,(function(){return qn(this,(function(e){switch(e.label){case 0:return sn.trim()&&u.trim()?[4,za({id:"custom",name:"Custom",description:"Custom prompt",icon:"\u26a1",prompt:sn},u,sn)]:(at("Please enter both text and a custom prompt","error"),[2]);case 1:return e.sent(),dn(""),[2]}}))}))}),[sn,u,za,at]),(0,r.useCallback)((function(){return Dn(void 0,void 0,void 0,(function(){var e,t,n,r,a,o,i,l,s,c,d;return qn(this,(function(p){switch(p.label){case 0:if(!u.trim())return at("Please enter or select text to create cards","error"),[2];if(!Zn)return tr(),[2];Kn.current=!1,Yn.current=new AbortController,e=Yn.current.signal,pe(!1),_(!0),p.label=1;case 1:if(p.trys.push([1,7,8,9]),e.aborted)throw new Error("Generation cancelled by user");t=Nn(Jn,Zn),n=void 0,p.label=2;case 2:return p.trys.push([2,4,,5]),r=window.getSelection(),a=void 0,r&&r.rangeCount>0&&(o=r.getRangeAt(0),a=o.commonAncestorContainer.nodeType===Node.ELEMENT_NODE?o.commonAncestorContainer:o.commonAncestorContainer.parentElement||void 0),[4,Pn.PageContentExtractor.extractPageContentAsync(u,a)];case 3:return n=p.sent(),$n("\u{1f4c4} Extracted page content:",{images:n.pageImages.length,formulas:n.formulas.length,codeBlocks:n.codeBlocks.length,links:n.links.length,metadata:n.metadata,selectedText:u.substring(0,100)+"..."}),n.pageImages.forEach((function(e,t){$n("\u{1f5bc}\ufe0f \u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 ".concat(t,":"),{src:e.src,alt:e.alt,relevanceScore:e.relevanceScore,isRelevant:e.relevanceScore>.3,hasBase64:!!e.base64})})),[3,5];case 4:return i=p.sent(),console.warn("Failed to extract page content, proceeding without multimedia:",i),n=void 0,[3,5];case 5:return[4,t.createCardsFromTextFast(u,n,e)];case 6:return l=p.sent(),e.aborted?($n("AI card creation was cancelled by user"),[2]):($n("\u{1f389} AI Agents created ".concat(l.length," cards successfully")),l.forEach((function(e,t){var n;$n("\u{1f0cf} \u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 ".concat(t,":"),{front:e.front,backPreview:e.back.substring(0,200)+"...",hasAttachedImages:!!e.attachedImages&&e.attachedImages.length>0,attachedImagesCount:(null===(n=e.attachedImages)||void 0===n?void 0:n.length)||0,multimedia:e.multimedia,hasImageInBack:e.back.includes("[IMAGE:")||e.back.includes("!["),hasFormulaInBack:e.back.includes("[FORMULA:")||e.back.includes("$$"),hasCodeInBack:e.back.includes("[CODE:")||e.back.includes("```")}),0===t&&$n("\u{1f0cf} \u041f\u043e\u043b\u043d\u044b\u0439 back \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0438 0:",e.back)})),mn(l),kn(0),xn(!0),[3,9]);case 7:return s=p.sent(),e.aborted?($n("AI card creation was cancelled by user"),[2]):(console.error("\u274c Error in AI agent card creation:",s),c=s instanceof Error?s.message:"Unknown error",at("Card creation error: ".concat(c),"error"),d=nr(c),_(!1),J(null),te({completed:0,total:0}),d&&Yn.current&&Yn.current.abort(),[3,9]);case 8:return $n("\u{1f3af} Main card creation function finally block reached"),Kn.current?($n("\u{1f6ab} Critical API error detected in AI agent flow - stopping loader immediately"),Kn.current=!1,_(!1),J(null),te({completed:0,total:0}),Yn.current=null,[2]):(setTimeout((function(){$n("\u23f3 Checking for pending operations before hiding loader...");var e=(0,un.cr)(),t=e.getStats(),n=t.inProgress>0;$n("\u{1f4ca} Tracker stats:",t),$n("\u{1f504} Has pending requests:",n);var r=yt||q||H;$n("\u{1f3e0} Local loading states:",{isProcessingCustomInstruction:yt,loadingNewImage:q,loadingNewExamples:H,hasLocalOperations:r}),n||r?($n("\u23f8\ufe0f Keeping loader visible - operations still running"),setTimeout((function(){$n("\u23f3 Second check after additional delay..."),e.getStats().inProgress>0||yt||q||H?$n("\u23f8\ufe0f Still has pending operations - keeping loader"):($n("\u2705 Second check passed - hiding loader"),_(!1),J(null),te({completed:0,total:0}))}),2e3)):($n("\u2705 No pending operations - hiding loader"),_(!1),J(null),te({completed:0,total:0}))}),1500),Yn.current=null,Kn.current=!1,[7]);case 9:return[2]}}))}))}),[u,Jn,Zn,at,tr,nr])),Ma=function(){xn(!1),mn([]),kn(0),An(new Set),Bn("")},ja=function(){return Dn(void 0,void 0,void 0,(function(){var e,t,n,r,a,o;return qn(this,(function(i){switch(i.label){case 0:Y(!0),i.label=1;case 1:return i.trys.push([1,3,4,5]),(e=fn[Sn])?[4,L(null!==(a=e.image)&&void 0!==a?a:null,null!==(o=e.imageUrl)&&void 0!==o?o:null)]:(at("No card to save","error"),[2]);case 2:return t=i.sent(),n=_n(_n({},e),{image:t.image,imageUrl:t.imageUrl}),s(Ie(n)),An((function(e){return new Set(e).add(Sn)})),[3,5];case 3:return r=i.sent(),console.error("Error saving current card:",r),at("Error saving card","error"),[3,5];case 4:return Y(!1),[7];case 5:return[2]}}))}))},Ba=m((function(e){return e.cards.isGeneratingCard}));return(0,o.jsxs)("div",_n({style:{display:"flex",flexDirection:"column",flex:1,width:"100%",height:"100%",position:"relative"}},{children:[P&&!de&&(0,o.jsxs)("div",_n({className:"loading-overlay",style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.9)",backdropFilter:"blur(4px)",zIndex:10,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"20px",padding:"0 20px",borderRadius:"12px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)"}},{children:[(0,o.jsxs)("div",_n({style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"12px"}},{children:[(0,o.jsx)(Ot,{type:"spinner",size:"large",color:(null==X?void 0:X.color)||"#3B82F6"}),X&&(0,o.jsx)("div",_n({style:{fontSize:"20px",opacity:.8}},{children:X.icon}))]})),(0,o.jsxs)("div",_n({style:{textAlign:"center",color:"#374151",maxWidth:"400px"}},{children:[(0,o.jsx)("div",_n({style:{fontSize:"18px",fontWeight:"600",marginBottom:"8px",color:(null==X?void 0:X.color)||"#1f2937"}},{children:(null==X?void 0:X.currentStepTitle)||(null==X?void 0:X.title)||"Starting..."})),(0,o.jsx)("div",_n({style:{fontSize:"14px",color:"#6b7280",lineHeight:"1.5"}},{children:(null==X?void 0:X.currentStepSubtitle)||(null==X?void 0:X.subtitle)||"Preparing your request..."}))]})),(0,o.jsx)("div",_n({style:{width:"280px",height:"8px",backgroundColor:"#f3f4f6",borderRadius:"4px",overflow:"hidden",marginTop:"12px",boxShadow:"inset 0 1px 2px rgba(0, 0, 0, 0.1)"}},{children:(0,o.jsx)("div",_n({style:{height:"100%",width:"".concat(ee.total>0?Math.max(5,ee.completed/ee.total*100):15,"%"),background:"linear-gradient(90deg, ".concat((null==X?void 0:X.color)||"#3B82F6"," 0%, ").concat((null==X?void 0:X.color)||"#3B82F6","dd 50%, ").concat((null==X?void 0:X.color)||"#3B82F6"," 100%)"),borderRadius:"4px",transition:"width 0.6s ease-out, background 0.3s ease-in-out",boxShadow:"0 0 10px ".concat((null==X?void 0:X.color)||"#3B82F6","40"),position:"relative",overflow:"hidden"}},{children:(0,o.jsx)("div",{style:{position:"absolute",top:0,left:"-100%",width:"100%",height:"100%",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent)",animation:"shimmer 2s infinite"}})}))})),(0,o.jsxs)("div",_n({style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",marginTop:"16px",padding:"8px 16px",backgroundColor:"rgba(255, 255, 255, 0.1)",borderRadius:"20px",border:"1px solid ".concat((null==X?void 0:X.color)||"#3B82F6","20"),boxShadow:"0 0 15px ".concat((null==X?void 0:X.color)||"#3B82F6","20")}},{children:[(0,o.jsx)(st,{style:{color:(null==X?void 0:X.color)||"#3B82F6",fontSize:"14px",animation:"pulse 2s ease-in-out infinite"}}),(0,o.jsx)("span",_n({style:{fontSize:"16px",fontWeight:"600",color:(null==X?void 0:X.color)||"#3B82F6",fontFamily:"monospace",letterSpacing:"1px"}},{children:(Sa=le,ka=Math.floor(Sa/60),Ca=Sa%60,"".concat(ka,":").concat(Ca.toString().padStart(2,"0")))}))]})),(0,o.jsxs)("button",_n({onClick:Fr,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",backgroundColor:"#F3F4F6",color:"#4B5563",border:"1px solid #E5E7EB",borderRadius:"6px",padding:"10px 16px",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",marginTop:"10px"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#E5E7EB",e.currentTarget.style.color="#374151"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.color="#4B5563"},title:"Cancel card generation"},{children:[(0,o.jsx)(jt,{}),"Cancel Generation"]}))]})),Ut&&(0,o.jsxs)("div",_n({style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.8)",zIndex:5,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"20px",padding:"0 20px"}},{children:[(0,o.jsx)(Ot,{type:"spinner",size:"large",color:"#3B82F6",text:"Analyzing selected text..."}),(0,o.jsxs)("button",_n({onClick:function(){return $t(!1)},style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",backgroundColor:"#F3F4F6",color:"#4B5563",border:"1px solid #E5E7EB",borderRadius:"6px",padding:"10px 16px",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",marginTop:"10px"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#E5E7EB",e.currentTarget.style.color="#374151"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.color="#4B5563"},title:"Cancel text analysis"},{children:[(0,o.jsx)(jt,{}),"Cancel Analysis"]}))]})),On&&!Zn&&(0,o.jsxs)("div",_n({style:{margin:"16px",marginBottom:0,display:"flex",alignItems:"flex-start",gap:"12px",padding:"16px 18px",borderRadius:"12px",background:"linear-gradient(135deg, #EFF6FF 0%, #FFFFFF 100%)",border:"1px solid #BFDBFE",boxShadow:"0 12px 35px -18px rgba(59, 130, 246, 0.45)",animation:"slideIn 0.25s ease-out"}},{children:[(0,o.jsx)("div",_n({style:{width:"40px",height:"40px",borderRadius:"12px",backgroundColor:"#DBEAFE",display:"flex",alignItems:"center",justifyContent:"center",color:"#1D4ED8",flexShrink:0}},{children:(0,o.jsx)(wt,{size:18})})),(0,o.jsxs)("div",_n({style:{flex:1}},{children:[(0,o.jsxs)("div",_n({style:{display:"flex",flexDirection:"column",gap:"4px"}},{children:[(0,o.jsxs)("span",_n({style:{fontSize:"15px",fontWeight:600,color:"#1D4ED8"}},{children:["Add an API key for ",er]})),(0,o.jsx)("span",_n({style:{fontSize:"13px",color:"#1F2937",lineHeight:1.5}},{children:"Add a valid key in Settings to create cards. You can update it anytime."}))]})),(0,o.jsxs)("div",_n({style:{display:"flex",flexWrap:"wrap",gap:"8px",marginTop:"10px"}},{children:[(0,o.jsxs)("button",_n({onClick:kr,style:{display:"flex",alignItems:"center",gap:"6px",background:"linear-gradient(135deg, #2563EB, #1D4ED8)",color:"#ffffff",border:"none",borderRadius:"8px",padding:"8px 14px",fontSize:"13px",fontWeight:600,cursor:"pointer",boxShadow:"0 6px 16px -8px rgba(37, 99, 235, 0.6)"},onMouseOver:function(e){e.currentTarget.style.background="linear-gradient(135deg, #1D4ED8, #1E3A8A)"},onMouseOut:function(e){e.currentTarget.style.background="linear-gradient(135deg, #2563EB, #1D4ED8)"}},{children:["Open settings",(0,o.jsx)(it,{size:12})]})),(0,o.jsx)("button",_n({onClick:Cr,style:{backgroundColor:"#FFFFFF",color:"#1F2937",border:"1px solid #E5E7EB",borderRadius:"8px",padding:"8px 14px",fontSize:"13px",fontWeight:500,cursor:"pointer"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#F3F4F6"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#FFFFFF"}},{children:"Dismiss"}))]}))]}))]})),(0,o.jsx)("div",_n({style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",gap:"12px",width:"100%",padding:"12px",paddingTop:"16px",height:"100%",overflowY:"auto",overflowX:"hidden",backgroundColor:"#ffffff",paddingBottom:"16px",boxSizing:"border-box"}},{children:(0,o.jsxs)("div",_n({style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"12px",width:"100%",maxWidth:"320px"}},{children:[A===Q.d.LanguageLearning&&(0,o.jsxs)("div",_n({style:{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%",gap:"8px"}},{children:[Kr(),xa(),(0,o.jsxs)("div",_n({style:{display:"flex",flexDirection:"column",width:"100%",gap:"8px",marginTop:"4px"}},{children:[(0,o.jsx)("label",_n({style:{color:"#111827",fontWeight:"600",fontSize:"14px",margin:0}},{children:"Image Generation:"})),(0,o.jsxs)("div",_n({style:{display:"flex",width:"100%",backgroundColor:"#F3F4F6",borderRadius:"8px",padding:"4px",gap:"2px",opacity:br()?1:.5}},{children:[(0,o.jsx)("button",_n({type:"button",onClick:function(){return Ia("off")},disabled:!br(),style:{flex:1,whiteSpace:"nowrap",padding:"8px 12px",borderRadius:"6px",border:"none",backgroundColor:"off"===Ce?"#FFFFFF":"transparent",color:"off"===Ce?"#111827":"#6B7280",fontSize:"11px",fontWeight:"off"===Ce?"600":"500",cursor:br()?"pointer":"not-allowed",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",boxShadow:"off"===Ce?"0 1px 2px rgba(0, 0, 0, 0.05)":"none"}},{children:"\u{1f6ab} Off"})),(0,o.jsx)("button",_n({type:"button",onClick:function(){return Ia("smart")},disabled:!br(),style:{flex:1,whiteSpace:"nowrap",padding:"8px 12px",borderRadius:"6px",border:"none",backgroundColor:"smart"===Ce?"#FFFFFF":"transparent",color:"smart"===Ce?"#111827":"#6B7280",fontSize:"11px",fontWeight:"smart"===Ce?"600":"500",cursor:br()?"pointer":"not-allowed",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",boxShadow:"smart"===Ce?"0 1px 2px rgba(0, 0, 0, 0.05)":"none"}},{children:"\u{1f9e0} Smart"})),(0,o.jsx)("button",_n({type:"button",onClick:function(){return Ia("always")},disabled:!br(),style:{flex:1,whiteSpace:"nowrap",padding:"8px 12px",borderRadius:"6px",border:"none",backgroundColor:"always"===Ce?"#FFFFFF":"transparent",color:"always"===Ce?"#111827":"#6B7280",fontSize:"11px",fontWeight:"always"===Ce?"600":"500",cursor:br()?"pointer":"not-allowed",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",boxShadow:"always"===Ce?"0 1px 2px rgba(0, 0, 0, 0.05)":"none"}},{children:"\u{1f3a8} Always"}))]})),(0,o.jsx)("div",_n({style:{position:"relative",height:"2.8em",marginTop:"2px"}},{children:(0,o.jsxs)("div",_n({style:{position:"absolute",top:0,left:0,right:0,fontSize:"11px",color:"#6B7280",lineHeight:"1.4",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"}},{children:["off"===Ce&&"No images will be generated","smart"===Ce&&"AI decides: Images only for concrete objects, places, and visual concepts. Saves API costs by skipping abstract terms.","always"===Ce&&"Images generated for all cards"]}))})),!br()&&(0,o.jsx)("div",_n({style:{fontSize:"11px",color:"#EF4444",backgroundColor:"#FEF2F2",padding:"6px 8px",borderRadius:"6px",border:"1px solid #FECACA"}},{children:"Image generation not available with Groq provider"}))]})),"off"!==Ce&&br()&&(ke?Ve?(0,o.jsxs)("div",_n({style:{backgroundColor:"#F9FAFB",border:"1px solid #E5E7EB",borderRadius:"8px",padding:"16px",width:"100%",marginBottom:"12px",marginTop:"8px"}},{children:[(0,o.jsxs)("div",_n({style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"}},{children:[(0,o.jsxs)("h3",_n({style:{margin:0,fontSize:"16px",fontWeight:600,display:"flex",alignItems:"center",gap:"8px"}},{children:[(0,o.jsx)(bt,{size:14,color:"#10B981"}),"Image Instructions"]})),(0,o.jsx)("button",_n({onClick:function(){return Ke(!1)},style:{background:"transparent",border:"none",cursor:"pointer",color:"#6B7280",fontSize:"13px"}},{children:"Cancel"}))]})),(0,o.jsxs)("div",_n({style:{marginBottom:"16px"}},{children:[(0,o.jsx)("label",_n({style:{display:"block",marginBottom:"4px",fontSize:"14px",fontWeight:500,color:"#374151"}},{children:"Image generation style"})),(0,o.jsx)("textarea",{value:et,onChange:function(e){return tt(e.target.value)},placeholder:"E.g., use anime style, make it minimalist, use pastel colors, make it black and white",style:{width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",fontSize:"14px",minHeight:"100px",resize:"vertical"}}),(0,o.jsxs)("div",_n({style:{fontSize:"12px",color:"#6B7280",marginTop:"8px",lineHeight:"1.4"}},{children:[(0,o.jsx)("p",_n({style:{margin:"0 0 6px 0",fontWeight:"500"}},{children:"How to use:"})),(0,o.jsxs)("ul",_n({style:{margin:0,paddingLeft:"16px"}},{children:[(0,o.jsxs)("li",{children:["These are ",(0,o.jsx)("strong",{children:"style instructions"})," for image generation"]}),(0,o.jsx)("li",{children:"The image will still be related to the word you're learning"}),(0,o.jsx)("li",{children:"Focus on artistic style, mood, colors, composition, etc."}),(0,o.jsx)("li",{children:'Examples: "watercolor style", "dark background", "realistic rendering"'})]}))]}))]})),(0,o.jsxs)("button",_n({onClick:zr,style:{backgroundColor:"#10B981",color:"white",border:"none",borderRadius:"6px",padding:"8px 16px",fontSize:"14px",fontWeight:500,cursor:"pointer",width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"}},{children:[(0,o.jsx)(bt,{size:14}),"Save Image Instructions"]}))]})):(0,o.jsxs)("button",_n({onClick:function(){return Ke(!0)},style:{display:"flex",alignItems:"center",gap:"6px",backgroundColor:"#F3F4F6",border:"1px solid #E5E7EB",borderRadius:"6px",padding:"6px 12px",fontSize:"13px",color:"#4B5563",cursor:"pointer",width:"100%",justifyContent:"center",marginTop:"8px"}},{children:[(0,o.jsx)(bt,{size:14}),"Customize image generation"]})):null)]})),A===Q.d.GeneralTopic&&(0,o.jsxs)("div",_n({style:{display:"flex",flexDirection:"column",gap:"12px",padding:"16px",backgroundColor:"#F8FAFC",borderRadius:"8px",border:"1px solid #E2E8F0"}},{children:[(0,o.jsxs)("div",_n({style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"}},{children:[(0,o.jsx)(It,{style:{color:"#6366F1"}}),(0,o.jsx)("h4",_n({style:{fontSize:"16px",fontWeight:"600",color:"#111827",margin:0}},{children:"AI Agent Card Creator"}))]})),(0,o.jsx)("p",_n({style:{fontSize:"14px",color:"#6B7280",margin:0,lineHeight:"1.4"}},{children:"Select text on any page and AI agents will automatically create optimal cards for learning. The system analyzes content and creates 1 to several cards with quality validation."})),(0,o.jsxs)("div",_n({style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 12px",backgroundColor:"#FEF3C7",borderRadius:"6px",border:"1px solid #F59E0B"}},{children:[(0,o.jsx)(kt,{style:{color:"#F59E0B"}}),(0,o.jsx)("span",_n({style:{fontSize:"11px",color:"#92400E",fontWeight:"500"}},{children:"AI analyzes text, creates cards and validates results"}))]})),!P&&(0,o.jsxs)("button",_n({onClick:Fa,disabled:!u.trim()||P,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",width:"100%",padding:"8px 10px",backgroundColor:u.trim()&&!P?"#2563EB":"#E5E7EB",color:u.trim()&&!P?"#ffffff":"#9CA3AF",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:"600",cursor:u.trim()&&!P?"pointer":"not-allowed",transition:"all 0.2s ease",marginTop:"4px",opacity:P?.7:1},onMouseOver:function(e){u.trim()&&!P&&(e.currentTarget.style.backgroundColor="#1D4ED8")},onMouseOut:function(e){u.trim()&&!P&&(e.currentTarget.style.backgroundColor="#2563EB")}},{children:[P?(0,o.jsx)(Ot,{type:"spinner",size:"small",inline:!0,color:"#ffffff"}):(0,o.jsx)(It,{}),"Create Cards with AI"]}))]})),Ae?(0,o.jsxs)("div",_n({style:{backgroundColor:"#F9FAFB",border:"1px solid #E5E7EB",borderRadius:"8px",padding:"16px",width:"100%",marginBottom:"12px"}},{children:[(0,o.jsxs)("div",_n({style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"}},{children:[(0,o.jsxs)("h3",_n({style:{margin:0,fontSize:"16px",fontWeight:600,display:"flex",alignItems:"center",gap:"8px"}},{children:[(0,o.jsx)(kt,{size:14,color:"#2563EB"}),"AI Instructions"]})),(0,o.jsx)("button",_n({onClick:function(){return Te(!1)},style:{background:"transparent",border:"none",cursor:"pointer",color:"#6B7280",fontSize:"13px"}},{children:"Cancel"}))]})),(0,o.jsxs)("div",_n({style:{marginBottom:"16px"}},{children:[(0,o.jsx)("label",_n({style:{display:"block",marginBottom:"4px",fontSize:"14px",fontWeight:500,color:"#374151"}},{children:"Additional instructions for AI"})),(0,o.jsx)("textarea",{value:Qe,onChange:function(e){return Je(e.target.value)},placeholder:"E.g., Keep specialized terms untranslated. Make examples more advanced. Use formal language.",style:{width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",fontSize:"14px",minHeight:"100px",resize:"vertical"}}),(0,o.jsxs)("div",_n({style:{fontSize:"12px",color:"#6B7280",marginTop:"8px",lineHeight:"1.4"}},{children:[(0,o.jsx)("p",_n({style:{margin:"0 0 6px 0",fontWeight:"500"}},{children:"How to use:"})),(0,o.jsxs)("ul",_n({style:{margin:0,paddingLeft:"16px"}},{children:[(0,o.jsxs)("li",{children:["These are ",(0,o.jsx)("strong",{children:"additional"})," instructions that supplement the basic AI behavior"]}),(0,o.jsx)("li",{children:"The original word will always be used (no need to specify it)"}),(0,o.jsx)("li",{children:"Examples will always be generated for the word you're learning"}),(0,o.jsx)("li",{children:"Use this for style guidance, preferences, or special requirements"})]}))]}))]})),(0,o.jsxs)("button",_n({onClick:Ir,style:{backgroundColor:"#2563EB",color:"white",border:"none",borderRadius:"6px",padding:"8px 16px",fontSize:"14px",fontWeight:500,cursor:"pointer",width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",marginBottom:"8px"}},{children:[(0,o.jsx)(ct,{size:14}),"Save Instructions"]}))]})):(0,o.jsxs)("button",_n({onClick:function(){return Te(!0)},style:{display:"flex",alignItems:"center",gap:"6px",backgroundColor:"#F3F4F6",border:"1px solid #E5E7EB",borderRadius:"6px",padding:"6px 12px",fontSize:"13px",color:"#4B5563",cursor:"pointer",width:"100%",justifyContent:"center"}},{children:[(0,o.jsx)(ut,{size:14}),"Customize AI behavior"]})),A===Q.d.LanguageLearning&&(0,o.jsxs)("form",_n({onSubmit:function(e){return Dn(void 0,void 0,void 0,(function(){var t,r,a,o,s,c,d,p,f,h,g,m,v,y,b,x,w,C,E,T,F,M,j,B,R,O,L,N,P,D,q,U,$,H,V,G,W,Y,K,X,Z;return qn(this,(function(ee){switch(ee.label){case 0:if(e.preventDefault(),!u.trim())return[2];if(t=ea,!pa)return[3,4];ee.label=1;case 1:return ee.trys.push([1,3,,4]),[4,ya(u)];case 2:return(r=ee.sent())&&(t=r),[3,4];case 3:return a=ee.sent(),console.error("Language detection failed before submission:",a),[3,4];case 4:if(!Zn)return tr(),[2];Kn.current=!1,Yn.current=new AbortController,o=Yn.current.signal,l.setIsGeneratingCard(!0),ye(!1),localStorage.removeItem("explicitly_saved"),Kt([]),tn(!1),l.setCurrentCardId(null),ke?I!==u&&($n("Text has changed, clearing existing images for new generation"),l.setImage(null),l.setImageUrl(null)):($n("Image generation is disabled, clearing existing images"),l.setImage(null),l.setImageUrl(null)),l.setLinguisticInfo(""),l.setTranscription(""),pe(!1),_(!0),J(null),(0,un.cr)().reset(),(0,un.Y3)((function(e){Kn.current||($n("\u{1f504} Progress update: ".concat(e.completed,"/").concat(e.total," - ").concat(e.message.title)),J(e.message),te({completed:e.completed,total:e.total}))})),z(u),at(null),ee.label=5;case 5:if(ee.trys.push([5,23,24,25]),$n("=== DEBUG INFO ==="),$n("Model Provider:",Se),$n("API Key available:",Boolean(Zn)),$n("Model Name (if Groq):",Se===Pt.l.Groq?we:"N/A"),$n("AI Service:",Object.keys(Jn)),$n("Source Language:",pa?t:Qr),s=pa?t:Qr,A===Q.d.LanguageLearning)return[3,16];$n("\u{1f680} General mode - using fast AI agent workflow for complete cards..."),ee.label=6;case 6:ee.trys.push([6,12,,15]),c=void 0,ee.label=7;case 7:return ee.trys.push([7,9,,10]),[4,Promise.resolve().then(n.bind(n,736))];case 8:return d=ee.sent().PageContentExtractor,c=d.extractPageContent(u),$n("\u{1f4cb} General mode: Extracted page context with ".concat((null===(Y=null==c?void 0:c.pageImages)||void 0===Y?void 0:Y.length)||0," images")),[3,10];case 9:return p=ee.sent(),console.warn("Failed to extract page content for General mode:",p),c=void 0,[3,10];case 10:return[4,Nn(Jn,Zn).createCardsFromTextFast(u,c,o)];case 11:return(f=ee.sent())&&f.length>0&&((h=f[0]).front&&l.setFront(h.front),h.back&&l.setBack(h.back),h.image&&l.setImage(h.image),h.imageUrl&&l.setImageUrl(h.imageUrl),$n("\u2705 General mode: Created ".concat(f.length," cards with fast workflow"))),[3,15];case 12:return g=ee.sent(),console.error("\u274c Error in General mode fast workflow:",g),$n("\u{1f504} Falling back to simple flashcard creation..."),[4,Promise.resolve().then(n.bind(n,75))];case 13:return[4,(0,ee.sent().createFlashcard)(Jn,Zn,u,o)];case 14:return(m=ee.sent())&&m.front&&l.setFront(m.front),[3,15];case 15:return i(!0),[2];case 16:return $n("\u{1f680} Using parallel card creation for Language Learning mode..."),[4,Promise.resolve().then(n.bind(n,75))];case 17:return v=ee.sent().createCardComponentsParallel,y=Date.now(),[4,v(Jn,Zn,u,S,k,s||void 0,ke,o,Ce)];case 18:if(b=ee.sent(),x=Date.now()-y,$n("\u26a1 Parallel card creation completed in ".concat(x,"ms")),o.aborted)throw new Error("Generation cancelled by user");if(w={translation:!1,examples:!1,flashcard:!1,image:!1,linguisticInfo:!1,transcription:!1},C=null,E=!1,(null===(K=b.translation)||void 0===K?void 0:K.translated)&&(l.setTranslation(b.translation.translated),w.translation=!0),b.examples&&b.examples.length>0&&(T=b.examples.map((function(e){return[e.original,e.translated]})),l.setExamples(T),w.examples=!0),(null===(X=b.flashcard)||void 0===X?void 0:X.front)&&(l.setFront(b.flashcard.front),w.flashcard=!0),b.linguisticInfo&&(l.setLinguisticInfo(b.linguisticInfo),w.linguisticInfo=!0),b.imageUrl&&(l.setImageUrl(b.imageUrl),w.image=!0),!b.transcription)return[3,22];ee.label=19;case 19:return ee.trys.push([19,21,,22]),[4,Aa(S)];case 20:return F=ee.sent(),M=b.transcription.userLanguageTranscription||null,(j=b.transcription.ipaTranscription||null)&&!j.startsWith("[")&&(j="[".concat(j,"]")),(B=[M&&'\n                            <div class="transcription-item user-lang">\n                                <span class="transcription-label">'.concat(F,':</span>\n                                <span class="transcription-text">').concat(M,"</span>\n                            </div>\n                        "),j&&'\n                            <div class="transcription-item ipa">\n                                <span class="transcription-label">IPA:</span>\n                                <span class="transcription-text">'.concat(j,"</span>\n                            </div>\n                        ")].filter(Boolean).join("\n"))&&(l.setTranscription(B),w.transcription=!0),[3,22];case 21:return R=ee.sent(),console.warn("Failed to format transcription result:",R),[3,22];case 22:if(b.errors.length>0){for(console.warn("Some components failed:",b.errors),O=0,L=b.errors;O<L.length;O++)N=L[O],P=N.error||"",D="".concat(N.component," generation failed: ").concat(P),"translation"===N.component?(at("Translation failed: ".concat(P),"error"),P&&(C=P)):at(D,"warning"),P&&nr(P)&&(E=!0);if(!w.translation)throw new Error(C||(E?"Authentication failed: your API key is missing, invalid, or not working. Please update it in Settings.":"Translation failed - cannot create card without translation"))}if(!w.translation)throw new Error(C||"Translation failed - cannot create card without translation");if($n("Parallel card creation completed with:",w),i(!0),ye(!1),localStorage.removeItem("explicitly_saved"),$n("Setting showResult to true after successful parallel card creation"),q="".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),l.setCurrentCardId(q),$n("Created card with ID:",q),!w.translation)throw new Error("Failed to create card: No data was successfully generated. Please check your API key and try again.");if(i(!0),Ft(!0),ge(!0),setTimeout((function(){$n("\u{1f3af} Parallel content is ready - hiding loading"),_(!1),J(null),te({completed:0,total:0})}),500),!w.transcription)try{U=(null===(Z=b.flashcard)||void 0===Z?void 0:Z.front)&&b.flashcard.front.trim()?b.flashcard.front.trim():u,$=s,U&&$&&S&&(H=Nn(Jn,Zn),Dn(void 0,void 0,void 0,(function(){var e;return qn(this,(function(t){switch(t.label){case 0:return $n('\u{1f524} Pronunciation Agent (fallback): generating for "'.concat(U,'" (').concat($," -> ").concat(S,")")),[4,H.generatePronunciationHtml(U,$,S)];case 1:return(e=t.sent())&&(l.setTranscription(e),$n("\u{1f524} Pronunciation Agent (fallback): transcription set")),[2]}}))})).catch((function(e){return console.warn("Pronunciation Agent fallback async error:",e)})))}catch(e){console.warn("Pronunciation Agent fallback failed to start:",e)}return[3,25];case 23:if(V=ee.sent(),o.aborted)throw $n("Card generation was cancelled by user"),new Error("Operation cancelled by user");return V instanceof Error&&lt(V)?(console.error("Quota error detected in main catch:",V.message),at(V.message),_(!1),J(null),te({completed:0,total:0}),[2]):(console.error("Error processing text:",V),G=V instanceof Error?"".concat(V.message):"Failed to create card. Please check your API key and try again.",at(G),W=nr(G),_(!1),J(null),te({completed:0,total:0}),W&&l.setIsGeneratingCard(!1),[3,25]);case 24:return l.setIsGeneratingCard(!1),Yn.current=null,Kn.current=!1,[7];case 25:return[2]}}))}))},style:{width:"100%",display:"flex",flexDirection:"column",gap:"8px",marginTop:"4px",marginBottom:"0"}},{children:[(0,o.jsxs)("div",_n({style:{display:"flex",flexDirection:"column",gap:"4px",width:"100%"}},{children:[(0,o.jsxs)("label",_n({htmlFor:"text",style:{color:"#111827",fontWeight:"600",fontSize:"14px",display:"flex",alignItems:"center"}},{children:["Text:",Mr()]})),(0,o.jsx)("textarea",{id:"text",value:u,onChange:function(e){return dr(e.target.value)},placeholder:"Enter text to translate or select text from a webpage",style:{width:"100%",minHeight:"80px",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"14px",resize:"vertical",outline:"none",transition:"all 0.2s ease"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}})]})),(0,o.jsx)("button",_n({type:"submit",disabled:P,style:{width:"100%",padding:"8px 10px",marginTop:"4px",borderRadius:"6px",backgroundColor:"#2563EB",color:"#ffffff",fontWeight:"600",fontSize:"14px",border:"none",cursor:"pointer",transition:"all 0.2s ease",opacity:P?.7:1},onMouseOver:function(e){return!P&&(e.currentTarget.style.backgroundColor="#1D4ED8")},onMouseOut:function(e){return!P&&(e.currentTarget.style.backgroundColor="#2563EB")}},{children:P?(0,o.jsx)("div",_n({style:{display:"flex",alignItems:"center",justifyContent:"center"}},{children:(0,o.jsx)(Ot,{type:"spinner",size:"small",inline:!0,color:"#ffffff",text:"Creating card"})})):"Create Card"}))]})),A===Q.d.GeneralTopic&&(0,o.jsxs)("div",_n({style:{width:"100%",display:"flex",flexDirection:"column",gap:"8px",marginTop:"4px"}},{children:[(0,o.jsxs)("label",_n({htmlFor:"general-text",style:{color:"#111827",fontWeight:"600",fontSize:"14px",display:"flex",alignItems:"center"}},{children:["Text for Analysis:",Mr()]})),(0,o.jsx)("textarea",{id:"general-text",value:u,onChange:function(e){return dr(e.target.value)},placeholder:"Enter or select text from the page to create cards",style:{width:"100%",minHeight:"80px",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"14px",resize:"vertical",outline:"none",transition:"all 0.2s ease"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}})]})),function(){var e;if(!F||lr||sr)return null;var t=Boolean((null!==(e=F.translation)&&void 0!==e?e:"").trim()),n=Array.isArray(F.examples)&&F.examples.length>0;return t&&n?(0,o.jsxs)("button",_n({type:"button",onClick:Ar,style:{width:"100%",border:"1px solid #E5E7EB",borderRadius:"10px",padding:"16px",backgroundColor:"#FFFFFF",color:"#1F2937",cursor:"pointer",position:"relative",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"16px",transition:"background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease",boxShadow:"0 1px 2px rgba(15, 23, 42, 0.04)",marginTop:"12px"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#F9FAFB",e.currentTarget.style.borderColor="#D1D5DB",e.currentTarget.style.boxShadow="0 8px 18px -12px rgba(30, 64, 175, 0.35)"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#FFFFFF",e.currentTarget.style.borderColor="#E5E7EB",e.currentTarget.style.boxShadow="0 1px 2px rgba(15, 23, 42, 0.04)"}},{children:[(0,o.jsxs)("div",_n({style:{display:"flex",alignItems:"center",gap:"12px",position:"relative",zIndex:1}},{children:[(0,o.jsx)("div",_n({style:{width:"36px",height:"36px",borderRadius:"50%",backgroundColor:"#EEF2FF",display:"flex",alignItems:"center",justifyContent:"center",color:"#4338CA",fontSize:"13px"}},{children:(0,o.jsx)(st,{size:14})})),(0,o.jsxs)("div",_n({style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"2px"}},{children:[(0,o.jsx)("span",_n({style:{fontWeight:600,fontSize:"13px",color:"#111827"}},{children:"Latest draft card"})),(0,o.jsxs)("span",_n({style:{fontSize:"11px",color:"#6B7280"}},{children:["Saved on ",F.timeLabel]}))]}))]})),(0,o.jsxs)("div",_n({style:{display:"flex",alignItems:"center",gap:"12px",flex:1,justifyContent:"flex-end"}},{children:[(0,o.jsx)("span",_n({style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",fontSize:"12px",fontWeight:500,color:"#1F2937",textAlign:"right",maxWidth:"60%"}},{children:F.previewSnippet})),(0,o.jsx)(it,{size:14,style:{color:"#9CA3AF"}})]}))]})):null}()]}))})),function(){if(!_t)return null;var e=Object.values(Vt).filter(Boolean).length;return(0,o.jsx)("div",_n({style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(2px)",padding:"16px"},onClick:function(){Gt({}),Dt(!1)}},{children:(0,o.jsxs)("div",_n({style:{backgroundColor:"#ffffff",borderRadius:"12px",maxWidth:"360px",width:"100%",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",position:"relative",padding:"16px"},onClick:function(e){return e.stopPropagation()}},{children:[(0,o.jsxs)("div",_n({style:{position:"sticky",top:0,display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid #E5E7EB",paddingBottom:"12px",marginBottom:"16px",backgroundColor:"#ffffff",zIndex:2}},{children:[(0,o.jsxs)("h3",_n({style:{margin:0,fontSize:"16px",fontWeight:600,color:"#111827",display:"flex",alignItems:"center",gap:"8px"}},{children:[(0,o.jsx)(vt,{size:14,color:"#2563EB"}),"Select Terms for Cards"]})),(0,o.jsx)("button",_n({onClick:function(){Gt({}),Rt([]),Dt(!1)},style:{background:"none",border:"none",display:"flex",alignItems:"center",justifyContent:"center",padding:"8px",borderRadius:"50%",cursor:"pointer",transition:"background-color 0.2s"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="#F3F4F6"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="transparent"},"aria-label":"Close"},{children:(0,o.jsx)(jt,{size:16,color:"#6B7280"})}))]})),(0,o.jsxs)("div",_n({style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"14px"}},{children:[(0,o.jsxs)("p",_n({style:{fontSize:"14px",color:"#4B5563",margin:0,lineHeight:"1.4"}},{children:["Found ",Bt.length," key terms"]})),e>0&&(0,o.jsxs)("span",_n({style:{fontSize:"13px",fontWeight:500,color:"#2563EB",padding:"3px 8px",backgroundColor:"#EFF6FF",borderRadius:"6px"}},{children:[e," selected"]}))]})),(0,o.jsxs)("div",_n({style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 4px",marginBottom:"12px"}},{children:[(0,o.jsx)("button",_n({onClick:function(){var t=e<Bt.length,n={};Bt.forEach((function(e){n[e]=t})),Gt(n)},style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"13px",background:"none",border:"none",padding:"4px 8px",borderRadius:"4px",color:"#4B5563",cursor:"pointer"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="#F3F4F6"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="transparent"}},{children:e===Bt.length?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",_n({style:{fontSize:"13px"}},{children:"\u2713"}))," Deselect all"]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",_n({style:{fontSize:"13px"}},{children:"\u2610"}))," Select all"]})})),(0,o.jsx)("span",_n({style:{fontSize:"12px",color:"#6B7280",fontStyle:"italic"}},{children:"Tap to select"}))]})),(0,o.jsx)("div",_n({style:{display:"flex",flexDirection:"column",gap:"8px",marginBottom:"16px",maxHeight:"300px",overflowY:"auto",padding:"4px",listStyle:"none"}},{children:Ut?(0,o.jsx)("div",_n({style:{display:"flex",justifyContent:"center",padding:"20px"}},{children:(0,o.jsx)(Ot,{type:"spinner",size:"large",color:"#3B82F6",text:"Analyzing selected text..."})})):Bt.map((function(e,t){return(0,o.jsxs)("div",_n({style:{display:"flex",alignItems:"center",padding:"10px 12px",backgroundColor:Vt[e]?"#EFF6FF":"#F9FAFB",border:"1px solid ".concat(Vt[e]?"#BFDBFE":"#E5E7EB"),borderRadius:"8px",cursor:"pointer",transition:"all 0.2s ease",position:"relative",listStyleType:"none"},onClick:function(){return Rr(e)}},{children:[(0,o.jsx)("input",{type:"checkbox",checked:!!Vt[e],onChange:function(){return Rr(e)},style:{marginRight:"12px",width:"16px",height:"16px",accentColor:"#2563EB",minWidth:"16px"},id:"option-".concat(t)}),(0,o.jsx)("span",_n({style:{fontSize:"14px",color:"#374151",flex:1,cursor:"pointer",wordBreak:"break-word",textAlign:"left",paddingLeft:"0",marginLeft:"0",display:"inline-block"}},{children:e.replace(/^[-\u2013\u2014\u2022\s]+/,"")})),(0,o.jsx)("span",_n({style:{position:"absolute",right:"10px",top:"10px",fontSize:"10px",padding:"2px 6px",borderRadius:"10px",backgroundColor:e.split(/\s+/).length>1?"#DBEAFE":"#F3F4F6",color:e.split(/\s+/).length>1?"#1E40AF":"#6B7280",fontWeight:e.split(/\s+/).length>1?"500":"normal"}},{children:e.split(/\s+/).length>1?"phrase":"word"}))]}),t)}))})),(0,o.jsxs)("div",_n({style:{display:"flex",gap:"8px",marginTop:"12px"}},{children:[(0,o.jsx)("button",_n({onClick:function(){Gt({}),Dt(!1)},style:{flex:"1",padding:"10px 12px",backgroundColor:"#F9FAFB",color:"#4B5563",border:"1px solid #E5E7EB",borderRadius:"6px",fontSize:"14px",fontWeight:500,cursor:"pointer",transition:"all 0.2s ease"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#F3F4F6"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#F9FAFB"}},{children:"Cancel"})),(0,o.jsxs)("button",_n({onClick:Br,disabled:0===e,style:{flex:"2",padding:"10px 12px",backgroundColor:0===e?"#E5E7EB":"#2563EB",color:0===e?"#9CA3AF":"#FFFFFF",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:500,cursor:0===e?"not-allowed":"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},onMouseOver:function(t){e>0&&(t.currentTarget.style.backgroundColor="#1D4ED8")},onMouseOut:function(t){e>0&&(t.currentTarget.style.backgroundColor="#2563EB")}},{children:[(0,o.jsx)(Ct,{size:14}),"Create ",e>0?"".concat(e," Card").concat(e>1?"s":""):"Cards"]}))]}))]}))}))}(),Tt&&a?(0,o.jsx)("div",_n({style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"flex-start",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(2px)",padding:"16px",overflowY:"auto",overflowX:"hidden"},onClick:jr},{children:(0,o.jsxs)("div",_n({style:{backgroundColor:"#ffffff",borderRadius:"12px",maxWidth:"340px",width:"100%",maxHeight:"calc(100% - 32px)",overflowY:"auto",overflowX:"hidden",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",position:"relative",padding:"16px",boxSizing:"border-box",margin:"auto"},onClick:function(e){return e.stopPropagation()}},{children:[(0,o.jsxs)("div",_n({style:{position:"sticky",top:0,display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid #E5E7EB",paddingBottom:"12px",marginBottom:"16px",backgroundColor:"#ffffff",zIndex:2}},{children:[(0,o.jsx)("h3",_n({style:{margin:0,fontSize:"16px",fontWeight:600,color:"#111827"}},{children:en?"Card ".concat(Qt+1," of ").concat(Yt.length):"Your Card"})),(0,o.jsx)("button",_n({onClick:jr,style:{background:"none",border:"none",display:"flex",alignItems:"center",justifyContent:"center",padding:"8px",borderRadius:"50%",cursor:"pointer",transition:"background-color 0.2s"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="#F3F4F6"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="transparent"},"aria-label":"Close"},{children:(0,o.jsx)(jt,{size:16,color:"#6B7280"})}))]})),(0,o.jsxs)("div",_n({style:{width:"100%",maxWidth:"100%",marginBottom:"12px"}},{children:[(0,o.jsxs)("div",_n({style:{position:"relative",width:"100%",maxWidth:"100%"}},{children:[(0,o.jsx)("input",{type:"text",value:pt,onChange:function(e){return gt(e.target.value)},onKeyDown:yr,placeholder:"Enter custom instructions (e.g., 'more formal examples', 'change image style')",style:{width:"100%",maxWidth:"100%",padding:"10px 12px",paddingRight:"44px",borderRadius:"8px",border:"1px solid #E5E7EB",fontSize:"14px",color:"#374151",backgroundColor:yt?"#F9FAFB":"#FFFFFF",transition:"all 0.2s ease",boxShadow:yt?"inset 0 1px 2px rgba(0, 0, 0, 0.05)":"none",boxSizing:"border-box"},disabled:yt}),yt?(0,o.jsx)("div",_n({style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",padding:"6px",borderRadius:"50%",color:"#4F46E5"}},{children:(0,o.jsx)(Ot,{type:"spinner",size:"small",inline:!0,color:"#4F46E5"})})):(0,o.jsx)("button",_n({onClick:vr,disabled:!pt.trim()||yt,style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",background:pt.trim()?"linear-gradient(to right, #4F46E5, #6366F1)":"none",border:"none",color:pt.trim()?"#FFFFFF":"#9CA3AF",cursor:pt.trim()?"pointer":"not-allowed",display:"flex",alignItems:"center",justifyContent:"center",padding:"6px",borderRadius:"50%",width:"28px",height:"28px",boxShadow:pt.trim()?"0 1px 3px rgba(0, 0, 0, 0.1)":"none",transition:"all 0.2s ease"},title:"Apply instructions"},{children:(0,o.jsx)(Et,{size:14})}))]})),(0,o.jsxs)("div",_n({style:{fontSize:"12px",color:yt?"#4F46E5":"#6B7280",marginTop:"6px",display:"flex",alignItems:"center",gap:"6px",fontWeight:yt?"500":"normal"}},{children:[yt&&(0,o.jsx)("span",{style:{display:"inline-block",width:"6px",height:"6px",borderRadius:"50%",backgroundColor:"#4F46E5",animation:"pulse 1.5s infinite"}}),yt?"Applying your instructions...":"Type instructions and press Enter or click the magic wand"]})),(0,o.jsx)("style",{children:"\n                            @keyframes pulse {\n                                0% { opacity: 1; }\n                                50% { opacity: 0.4; }\n                                100% { opacity: 1; }\n                            }\n                        "})]})),en&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",_n({style:{marginBottom:"8px",display:"flex",justifyContent:"center",alignItems:"center"}},{children:(0,o.jsxs)("div",_n({style:{fontSize:"13px",color:"#4B5563",backgroundColor:"#F9FAFB",padding:"4px 10px",borderRadius:"16px",display:"flex",alignItems:"center",gap:"4px"}},{children:["Card ",Qt+1," of ",Yt.length,Yt[Qt]&&ir(Yt[Qt].id)&&(0,o.jsxs)("span",_n({style:{display:"inline-flex",alignItems:"center",gap:"3px",backgroundColor:"#ECFDF5",color:"#10B981",padding:"2px 6px",borderRadius:"10px",fontSize:"11px",fontWeight:"bold"}},{children:[(0,o.jsx)(rt,{size:8}),"SAVED"]}))]}))})),(0,o.jsxs)("div",_n({style:{display:"flex",justifyContent:"space-between",gap:"8px",marginBottom:"12px"}},{children:[(0,o.jsxs)("button",_n({onClick:Pr,disabled:0===Qt,style:{padding:"8px 16px",backgroundColor:0===Qt?"#F3F4F6":"#EFF6FF",color:0===Qt?"#9CA3AF":"#2563EB",border:"1px solid ".concat(0===Qt?"#E5E7EB":"#BFDBFE"),borderRadius:"6px",fontSize:"14px",fontWeight:500,cursor:0===Qt?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"6px",flex:1}},{children:["\u2190 Prev",Qt>0&&Yt[Qt-1]&&(ir(Yt[Qt-1].id)?(0,o.jsx)("span",{style:{width:"6px",height:"6px",borderRadius:"50%",backgroundColor:"#10B981",marginLeft:"auto"}}):null)]})),(0,o.jsxs)("button",_n({onClick:Or,disabled:Qt===Yt.length-1,style:{padding:"8px 16px",backgroundColor:Qt===Yt.length-1?"#F3F4F6":"#EFF6FF",color:Qt===Yt.length-1?"#9CA3AF":"#2563EB",border:"1px solid ".concat(Qt===Yt.length-1?"#E5E7EB":"#BFDBFE"),borderRadius:"6px",fontSize:"14px",fontWeight:500,cursor:Qt===Yt.length-1?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"6px",flex:1,justifyContent:"flex-end"}},{children:[Qt<Yt.length-1&&Yt[Qt+1]&&(ir(Yt[Qt+1].id)?(0,o.jsx)("span",{style:{width:"6px",height:"6px",borderRadius:"50%",backgroundColor:"#10B981",marginRight:"auto"}}):null),"Next \u2192"]}))]})),(0,o.jsx)("button",_n({onClick:xr,style:{width:"100%",padding:"10px 12px",backgroundColor:"#10B981",color:"white",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:500,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",marginBottom:"12px",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"},disabled:W},{children:W?(0,o.jsx)(Ot,{type:"spinner",size:"small",inline:!0,color:"#ffffff",text:"Saving"}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("svg",_n({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},{children:(0,o.jsx)("path",{d:"M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022Z"})})),ar.length>0?(0,o.jsxs)(o.Fragment,{children:["Save ",Yt.length-ar.length," Remaining Cards",(0,o.jsxs)("span",_n({style:{fontSize:"11px",backgroundColor:"rgba(255,255,255,0.25)",borderRadius:"4px",padding:"1px 6px",marginLeft:"4px"}},{children:[ar.length," saved"]}))]}):(0,o.jsxs)(o.Fragment,{children:["Save All Cards (",Yt.length,")"]})]})}))]}),(0,o.jsx)(cn,{mode:A,front:g,translation:d,examples:p,imageUrl:h,image:f,linguisticInfo:b,transcription:x,onNewImage:gr,onNewExamples:mr,onAccept:wr,onViewSavedCards:Sr,onCancel:Fr,loadingNewImage:q,loadingNewExamples:H,createdAt:new Date,loadingAccept:W,loadingGetResult:P,shouldGenerateImage:ke,isSaved:lr,isEdited:re,isGeneratingCard:Ba,setTranslation:pr,setBack:fr,setExamples:hr,setLinguisticInfo:wa})]}))})):null,ia&&xa(),qr&&Kr(),bn&&fn.length>0&&(0,o.jsx)("div",_n({style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.8)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px",animation:"fadeIn 0.3s ease-out"}},{children:(0,o.jsxs)("div",_n({style:{backgroundColor:"#ffffff",borderRadius:"8px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",maxWidth:"640px",width:"100%",maxHeight:"90vh",overflow:"hidden",display:"flex",flexDirection:"column",border:"1px solid #EAEAEA",animation:"slideUp 0.4s ease-out"}},{children:[(0,o.jsx)("div",_n({style:{padding:"20px 24px 16px 24px",borderBottom:"1px solid #EAEAEA"}},{children:(0,o.jsxs)("div",_n({style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},{children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("h3",_n({style:{margin:0,fontSize:"18px",fontWeight:"600",color:"#000000",letterSpacing:"-0.025em"}},{children:"Review Cards"})),(0,o.jsxs)("p",_n({style:{margin:"4px 0 0 0",fontSize:"14px",color:"#666666",fontWeight:"400"}},{children:[fn.length," cards generated by AI"]}))]}),(0,o.jsx)("button",_n({onClick:Ma,style:{background:"none",border:"none",fontSize:"16px",color:"#999999",cursor:"pointer",padding:"6px",borderRadius:"4px",transition:"all 0.15s ease"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#F5F5F5",e.currentTarget.style.color="#666666"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="#999999"}},{children:(0,o.jsx)(jt,{})}))]}))})),fn.length>1&&(0,o.jsx)("div",_n({style:{padding:"12px 24px",backgroundColor:"#FAFAFA",borderBottom:"1px solid #EAEAEA",display:"flex",alignItems:"center",justifyContent:"center"}},{children:(0,o.jsxs)("div",_n({style:{display:"flex",alignItems:"center",gap:"12px"}},{children:[(0,o.jsx)("button",_n({onClick:function(){Sn>0&&kn(Sn-1)},disabled:0===Sn,style:{backgroundColor:"transparent",color:0===Sn?"#CCCCCC":"#666666",border:"1px solid ".concat(0===Sn?"#EAEAEA":"#DDDDD"),borderRadius:"6px",padding:"6px 10px",fontSize:"13px",fontWeight:"500",cursor:0===Sn?"not-allowed":"pointer",transition:"all 0.15s ease",display:"flex",alignItems:"center",gap:"4px"},onMouseOver:function(e){0!==Sn&&(e.currentTarget.style.borderColor="#999999",e.currentTarget.style.color="#333333")},onMouseOut:function(e){0!==Sn&&(e.currentTarget.style.borderColor="#DDDDDD",e.currentTarget.style.color="#666666")}},{children:"\u2190"})),(0,o.jsxs)("div",_n({style:{fontSize:"13px",color:"#666666",fontWeight:"500",padding:"0 8px"}},{children:[Sn+1," of ",fn.length]})),(0,o.jsx)("button",_n({onClick:function(){Sn<fn.length-1&&kn(Sn+1)},disabled:Sn===fn.length-1,style:{backgroundColor:"transparent",color:Sn===fn.length-1?"#CCCCCC":"#666666",border:"1px solid ".concat(Sn===fn.length-1?"#EAEAEA":"#DDDDDD"),borderRadius:"6px",padding:"6px 10px",fontSize:"13px",fontWeight:"500",cursor:Sn===fn.length-1?"not-allowed":"pointer",transition:"all 0.15s ease",display:"flex",alignItems:"center",gap:"4px"},onMouseOver:function(e){Sn!==fn.length-1&&(e.currentTarget.style.borderColor="#999999",e.currentTarget.style.color="#333333")},onMouseOut:function(e){Sn!==fn.length-1&&(e.currentTarget.style.borderColor="#DDDDDD",e.currentTarget.style.color="#666666")}},{children:"\u2192"}))]}))})),(0,o.jsx)("div",_n({style:{flex:1,overflow:"auto",padding:"16px",backgroundColor:"#ffffff"}},{children:fn[Sn]&&(0,o.jsx)("div",_n({style:{animation:"slideIn 0.3s ease-out"}},{children:(0,o.jsx)(cn,{front:fn[Sn].front||null,back:fn[Sn].back||null,translation:null,examples:[],imageUrl:fn[Sn].imageUrl||null,image:fn[Sn].image||null,linguisticInfo:"",transcription:null,onNewImage:function(){},onNewExamples:function(){},onAccept:ja,onViewSavedCards:function(){},loadingNewImage:!1,loadingNewExamples:!1,loadingAccept:W,createdAt:new Date,mode:Q.d.GeneralTopic,shouldGenerateImage:!1,isSaved:En.has(Sn),isEdited:!1,isGeneratingCard:!1,hideActionButtons:!0,setBack:function(e){var t=Un([],fn,!0);t[Sn]=_n(_n({},t[Sn]),{back:e}),mn(t)}})}))})),(0,o.jsxs)("div",_n({style:{padding:"16px 20px",borderTop:"1px solid #EAEAEA",backgroundColor:"#FAFAFA",display:"flex",flexDirection:"column",gap:"12px"}},{children:[(0,o.jsxs)("div",_n({style:{display:"flex",justifyContent:"center",gap:"8px"}},{children:[(0,o.jsx)("button",_n({onClick:ja,disabled:W||En.has(Sn),style:{backgroundColor:En.has(Sn)?"#10B981":"#ffffff",color:En.has(Sn)?"#ffffff":"#374151",border:"1px solid ".concat(En.has(Sn)?"#10B981":"#D1D5DB"),borderRadius:"6px",padding:"8px 16px",fontSize:"14px",fontWeight:"500",cursor:W||En.has(Sn)?"not-allowed":"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"6px",minWidth:"100px",justifyContent:"center",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",opacity:W||En.has(Sn)?.7:1},onMouseOver:function(e){W||En.has(Sn)||(e.currentTarget.style.borderColor="#9CA3AF",e.currentTarget.style.boxShadow="0 4px 6px -1px rgba(0, 0, 0, 0.1)")},onMouseOut:function(e){W||En.has(Sn)||(e.currentTarget.style.borderColor="#D1D5DB",e.currentTarget.style.boxShadow="0 1px 2px 0 rgba(0, 0, 0, 0.05)")}},{children:En.has(Sn)?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(rt,{size:14}),"Saved"]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(zt,{size:14}),"Save"]})})),(0,o.jsxs)("button",_n({onClick:function(){Fn(!0),Bn("")},disabled:W,style:{backgroundColor:"#ffffff",color:"#F59E0B",border:"1px solid #F59E0B",borderRadius:"6px",padding:"8px 16px",fontSize:"14px",fontWeight:"500",cursor:W?"not-allowed":"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"6px",minWidth:"100px",justifyContent:"center",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",opacity:W?.7:1},onMouseOver:function(e){W||(e.currentTarget.style.backgroundColor="#F59E0B",e.currentTarget.style.color="#ffffff",e.currentTarget.style.boxShadow="0 4px 6px -1px rgba(0, 0, 0, 0.1)")},onMouseOut:function(e){W||(e.currentTarget.style.backgroundColor="#ffffff",e.currentTarget.style.color="#F59E0B",e.currentTarget.style.boxShadow="0 1px 2px 0 rgba(0, 0, 0, 0.05)")}},{children:[(0,o.jsx)(ft,{size:14}),"Improve"]}))]})),(0,o.jsxs)("div",_n({style:{display:"flex",justifyContent:"center",gap:"8px"}},{children:[(0,o.jsx)("button",_n({onClick:Ma,disabled:W,style:{backgroundColor:"#ffffff",color:"#6B7280",border:"1px solid #D1D5DB",borderRadius:"6px",padding:"8px 16px",fontSize:"14px",fontWeight:"500",cursor:W?"not-allowed":"pointer",transition:"all 0.2s ease",minWidth:"100px",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",opacity:W?.7:1},onMouseOver:function(e){W||(e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.boxShadow="0 4px 6px -1px rgba(0, 0, 0, 0.1)")},onMouseOut:function(e){W||(e.currentTarget.style.backgroundColor="#ffffff",e.currentTarget.style.boxShadow="0 1px 2px 0 rgba(0, 0, 0, 0.05)")}},{children:"Cancel"})),(0,o.jsx)("button",_n({onClick:function(){return Dn(void 0,void 0,void 0,(function(){var e,t,n,r,a,o,i,l;return qn(this,(function(c){switch(c.label){case 0:Y(!0),c.label=1;case 1:c.trys.push([1,6,7,8]),e=0,t=fn,c.label=2;case 2:return e<t.length?(n=t[e],[4,L(null!==(i=n.image)&&void 0!==i?i:null,null!==(l=n.imageUrl)&&void 0!==l?l:null)]):[3,5];case 3:r=c.sent(),a=_n(_n({},n),{image:r.image,imageUrl:r.imageUrl}),s(Ie(a)),c.label=4;case 4:return e++,[3,2];case 5:return xn(!1),mn([]),kn(0),s(Fe("")),[3,8];case 6:return o=c.sent(),console.error("Error saving preview cards:",o),at("Error saving cards","error"),[3,8];case 7:return Y(!1),[7];case 8:return[2]}}))}))},disabled:W,style:{backgroundColor:W?"#9CA3AF":"#3B82F6",color:"#ffffff",border:"none",borderRadius:"6px",padding:"8px 20px",fontSize:"14px",fontWeight:"600",cursor:W?"not-allowed":"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"6px",minWidth:"140px",justifyContent:"center",boxShadow:"0 4px 6px -1px rgba(59, 130, 246, 0.3)",opacity:W?.7:1},onMouseOver:function(e){W||(e.currentTarget.style.backgroundColor="#2563EB",e.currentTarget.style.boxShadow="0 6px 10px -1px rgba(59, 130, 246, 0.4)",e.currentTarget.style.transform="translateY(-1px)")},onMouseOut:function(e){W||(e.currentTarget.style.backgroundColor="#3B82F6",e.currentTarget.style.boxShadow="0 4px 6px -1px rgba(59, 130, 246, 0.3)",e.currentTarget.style.transform="translateY(0)")}},{children:W?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Ot,{type:"spinner",size:"small",inline:!0,color:"#ffffff"}),"Saving..."]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(rt,{size:14}),"Save All (",fn.length,")"]})}))]}))]}))]}))})),zn&&(0,o.jsx)("div",_n({style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:1e4,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"}},{children:(0,o.jsxs)("div",_n({style:{backgroundColor:"#ffffff",borderRadius:"8px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",maxWidth:"520px",width:"100%",maxHeight:"80vh",overflow:"hidden",display:"flex",flexDirection:"column",border:"1px solid #EAEAEA"}},{children:[(0,o.jsx)("div",_n({style:{padding:"20px 24px 16px 24px",borderBottom:"1px solid #EAEAEA"}},{children:(0,o.jsxs)("div",_n({style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},{children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("h3",_n({style:{margin:0,fontSize:"18px",fontWeight:"600",color:"#000000",letterSpacing:"-0.025em"}},{children:"Improve Card"})),(0,o.jsx)("p",_n({style:{margin:"4px 0 0 0",fontSize:"14px",color:"#666666",fontWeight:"400"}},{children:"Provide feedback to create a better version"}))]}),(0,o.jsx)("button",_n({onClick:function(){return Fn(!1)},style:{background:"none",border:"none",fontSize:"16px",color:"#999999",cursor:"pointer",padding:"6px",borderRadius:"4px",transition:"all 0.15s ease"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#F5F5F5",e.currentTarget.style.color="#666666"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="#999999"}},{children:(0,o.jsx)(jt,{})}))]}))})),(0,o.jsxs)("div",_n({style:{padding:"24px",flex:1,overflow:"auto"}},{children:[(0,o.jsx)("textarea",{value:jn,onChange:function(e){return Bn(e.target.value)},placeholder:"Example: Make the question more specific, simplify the answer, add more context, focus on practical examples...",style:{width:"100%",minHeight:"140px",padding:"16px",borderRadius:"6px",border:"1px solid #EAEAEA",backgroundColor:"#FAFAFA",fontSize:"14px",lineHeight:"1.6",resize:"vertical",fontFamily:"inherit",outline:"none",transition:"all 0.15s ease"},onFocus:function(e){e.currentTarget.style.borderColor="#0070F3",e.currentTarget.style.backgroundColor="#ffffff"},onBlur:function(e){e.currentTarget.style.borderColor="#EAEAEA",e.currentTarget.style.backgroundColor="#FAFAFA"}}),(0,o.jsx)("div",_n({style:{marginTop:"16px",padding:"12px 16px",backgroundColor:"#F9F9F9",borderRadius:"6px",border:"1px solid #EAEAEA"}},{children:(0,o.jsxs)("div",_n({style:{display:"flex",alignItems:"flex-start",gap:"6px",fontSize:"13px",color:"#666666",lineHeight:"1.5"}},{children:[(0,o.jsx)(kt,{size:14,style:{color:"#999999",marginTop:"1px"}}),(0,o.jsx)("span",{children:"Be specific about what you want to change for better results"})]}))}))]})),(0,o.jsxs)("div",_n({style:{padding:"20px 24px",borderTop:"1px solid #EAEAEA",backgroundColor:"#FAFAFA",display:"flex",justifyContent:"flex-end",gap:"8px"}},{children:[(0,o.jsx)("button",_n({onClick:function(){return Fn(!1)},style:{backgroundColor:"transparent",color:"#999999",border:"none",padding:"8px 12px",fontSize:"13px",fontWeight:"500",cursor:"pointer",transition:"all 0.15s ease",borderRadius:"5px"},onMouseOver:function(e){e.currentTarget.style.color="#666666",e.currentTarget.style.backgroundColor="#F5F5F5"},onMouseOut:function(e){e.currentTarget.style.color="#999999",e.currentTarget.style.backgroundColor="transparent"}},{children:"Cancel"})),(0,o.jsx)("button",_n({onClick:function(){return Dn(void 0,void 0,void 0,(function(){var e,t,n,r,a,o,i,l,s,c,d,p,f;return qn(this,(function(h){switch(h.label){case 0:Fn(!1),Y(!0),h.label=1;case 1:if(h.trys.push([1,7,8,9]),!(e=fn[Sn]))return at("No card to recreate","error"),[2];t=Nn(Jn,Zn),n="Please recreate this card with improvements. Original card:\nQuestion: ".concat(e.front,"\nAnswer: ").concat(e.back,"\nOriginal text: ").concat(u),jn.trim()&&(n+="\n\nUser feedback: ".concat(jn.trim())),n+="\n\nPlease create an improved version based on the feedback.",r=void 0,h.label=2;case 2:return h.trys.push([2,4,,5]),a=window.getSelection(),o=void 0,a&&a.rangeCount>0&&(i=a.getRangeAt(0),o=i.commonAncestorContainer.nodeType===Node.ELEMENT_NODE?i.commonAncestorContainer:i.commonAncestorContainer.parentElement||void 0),[4,Pn.PageContentExtractor.extractPageContentAsync(u,o)];case 3:return r=h.sent(),[3,5];case 4:return l=h.sent(),console.warn("Failed to extract page content for recreation:",l),r=void 0,[3,5];case 5:return[4,t.createCardsFromTextFast(n,r)];case 6:return(s=h.sent()).length>0?((c=Un([],fn,!0))[Sn]=s[0],mn(c),An((function(e){var t=new Set(e);return t.delete(Sn),t}))):at("Failed to recreate card","error"),[3,9];case 7:return d=h.sent(),console.error("Error recreating card:",d),p=d instanceof Error?d.message:"Unknown error",f="Card recreation error: ".concat(p),at(f,"error"),nr(p),[3,9];case 8:return Y(!1),Bn(""),[7];case 9:return[2]}}))}))},disabled:W,style:{backgroundColor:W?"#F5F5F5":"#000000",color:W?"#999999":"#ffffff",border:"none",borderRadius:"5px",padding:"8px 16px",fontSize:"13px",fontWeight:"500",cursor:W?"not-allowed":"pointer",transition:"all 0.15s ease",display:"flex",alignItems:"center",gap:"6px",opacity:W?.6:1},onMouseOver:function(e){W||(e.currentTarget.style.backgroundColor="#333333")},onMouseOut:function(e){W||(e.currentTarget.style.backgroundColor="#000000")}},{children:W?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Ot,{type:"spinner",size:"small",inline:!0,color:"#999999"}),"Improving..."]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(ft,{size:11}),"Improve Card"]})}))]}))]}))})),(0,o.jsx)("div",_n({style:{position:"absolute",top:"16px",right:"16px",zIndex:9999,pointerEvents:"none"}},{children:(0,o.jsx)("div",_n({style:{pointerEvents:"auto"}},{children:ot()}))})),(0,o.jsx)("style",{children:"\n                    @keyframes shimmer {\n                        0% {\n                            left: -100%;\n                        }\n                        100% {\n                            left: 100%;\n                        }\n                    }\n                "})]}))},Kn=n.p+"assets/img/chat-gpt39f424be38a6852eb2c5.png",Xn=n.p+"assets/img/copy-iconb2b0ec637a2b0fd4ca40.svg";var Qn=function(){return Qn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},Qn.apply(this,arguments)},Jn=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))},Zn=function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(s){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&l[0]?r.return:l[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,l[1])).done)return a;switch(r=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,r=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],r=0}finally{n=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}};const er=function(e){e.onBackClick;var t=e.popup,n=void 0!==t&&t,a=E(),i=(0,r.useState)(null),l=i[0],s=i[1],c=m((function(e){return e.settings.openAiKey})),u=(m((function(e){return e.settings.ankiConnectUrl})),m((function(e){return e.settings.ankiConnectApiKey}))),d=m((function(e){return e.settings.groqApiKey})),p=m((function(e){return e.settings.groqModelName})),f=m((function(e){return e.settings.modelProvider})),h=function(e){a((0,Ye.Wy)(e.target.value))},g=function(e){a((0,Ye.H1)(e.target.value))},v=function(e){a((0,Ye.KS)(e.target.value))},y=chrome.runtime.getURL(Kn),b=chrome.runtime.getURL(Xn),x=function(e){return Jn(void 0,void 0,void 0,(function(){var t,n,r,a,o,i,l,u;return Zn(this,(function(f){switch(f.label){case 0:s(null),f.label=1;case 1:switch(f.trys.push([1,4,,5]),t="",n={},r={},a="",e){case Pt.l.OpenAI:t="https://api.openai.com/v1/chat/completions",n={"Content-Type":"application/json",Authorization:"Bearer ".concat(a=c)},r={model:"gpt-5-nano",messages:[{role:"user",content:"Say hello"}]};break;case Pt.l.Groq:t="https://api.groq.com/openai/v1/chat/completions",n={"Content-Type":"application/json",Authorization:"Bearer ".concat(a=d)},r={model:p,messages:[{role:"user",content:"Say hello"}]}}return a.trim()?[4,fetch(t,{method:"POST",headers:n,body:JSON.stringify(r)})]:(s({success:!1,message:"API key is missing. Please enter your API key."}),[2]);case 2:return[4,(o=f.sent()).json()];case 3:return i=f.sent(),o.ok?(console.log("API test response:",i),s({success:!0,message:"Connection successful! API is working properly."})):(console.error("API test error:",i),s({success:!1,message:"Error: ".concat((null===(u=i.error)||void 0===u?void 0:u.message)||"Unknown error occurred")})),[3,5];case 4:return l=f.sent(),console.error("API connection test error:",l),s({success:!1,message:"Error: ".concat(l instanceof Error?l.message:"Unknown error occurred")}),[3,5];case 5:return[2]}}))}))},w=function(){return l?(0,o.jsx)("div",Qn({style:{padding:"10px",marginTop:"10px",borderRadius:"6px",backgroundColor:l.success?"#ECFDF5":"#FEF2F2",color:l.success?"#065F46":"#B91C1C",fontSize:"14px",borderLeft:"4px solid ".concat(l.success?"#10B981":"#EF4444")}},{children:l.message})):null};return(0,o.jsxs)("div",Qn({style:{boxSizing:"border-box",padding:"14px",backgroundColor:"#ffffff",height:"100%",width:"100%",maxWidth:n?"100%":"640px",margin:"0 auto",overflowY:"auto",overflowX:"hidden",paddingBottom:"18px",marginTop:"12px",borderRadius:n?"12px":"0",boxShadow:n?"0 16px 35px rgba(15, 23, 42, 0.12)":"none"}},{children:[(0,o.jsxs)("div",Qn({style:{marginBottom:"20px",backgroundColor:"#F9FAFB",padding:"12px",borderRadius:"8px"}},{children:[(0,o.jsx)("label",Qn({htmlFor:"modelProvider",style:{display:"block",fontWeight:"600",marginBottom:"8px",color:"#111827",fontSize:"14px"}},{children:"AI Provider"})),(0,o.jsx)("p",Qn({style:{fontSize:"12px",marginBottom:"8px",color:"#6B7280"}},{children:"Select which provider to use for generating flashcards"})),(0,o.jsxs)("select",Qn({id:"modelProvider",value:f,onChange:function(e){a((0,Ye.dU)(e.target.value)),s(null)},style:{width:"100%",padding:"8px 12px",boxSizing:"border-box",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"13px",outline:"none",transition:"all 0.2s ease",cursor:"pointer"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}},{children:[(0,o.jsx)("option",Qn({value:Pt.l.OpenAI},{children:"OpenAI"})),(0,o.jsx)("option",Qn({value:Pt.l.Groq},{children:"Groq"}))]}))]})),(0,o.jsxs)("div",{children:[f!==Pt.l.OpenAI?null:(0,o.jsxs)("div",Qn({style:{marginBottom:"20px"}},{children:[(0,o.jsxs)("div",Qn({style:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:"6px",marginBottom:"8px"}},{children:[(0,o.jsx)("label",Qn({htmlFor:"openAiKey",style:{display:"block",fontWeight:"600",marginBottom:"0",marginRight:"8px",color:"#111827",fontSize:"14px"}},{children:"OpenAI API Key"})),(0,o.jsx)("img",{src:y,alt:"ChatGPT Logo",style:{width:"16px",height:"16px",marginTop:"-2px"}})]})),(0,o.jsxs)("p",Qn({style:{fontSize:"12px",marginBottom:"6px",color:"#6B7280"}},{children:["You can get your OpenAI API key from ",(0,o.jsx)("a",Qn({href:"https://platform.openai.com/account/api-keys",target:"_blank",rel:"noopener noreferrer",style:{color:"#2563EB",textDecoration:"underline"}},{children:"here"})),"."]})),(0,o.jsx)("div",Qn({style:{position:"relative",marginBottom:"16px"}},{children:(0,o.jsx)("input",{type:"text",id:"openAiKey",value:c,onChange:h,style:{width:"100%",padding:"8px 10px",boxSizing:"border-box",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"13px",outline:"none",transition:"all 0.2s ease"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}})})),(0,o.jsx)("button",Qn({onClick:function(){return x(Pt.l.OpenAI)},style:{marginTop:"8px",padding:"6px 12px",backgroundColor:"#10a37f",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px"}},{children:"Test API Connection"})),w()]})),f!==Pt.l.Groq?null:(0,o.jsxs)("div",Qn({style:{marginBottom:"20px"}},{children:[(0,o.jsx)("label",Qn({htmlFor:"groqApiKey",style:{display:"block",fontWeight:"600",marginBottom:"8px",color:"#111827",fontSize:"14px"}},{children:"Groq API Key"})),(0,o.jsxs)("p",Qn({style:{fontSize:"12px",marginBottom:"8px",color:"#6B7280"}},{children:["You can get your Groq API key from ",(0,o.jsx)("a",Qn({href:"https://console.groq.com/keys",target:"_blank",rel:"noopener noreferrer",style:{color:"#2563EB",textDecoration:"underline"}},{children:"here"})),"."]})),(0,o.jsx)("input",{type:"text",id:"groqApiKey",value:d,onChange:g,style:{width:"100%",padding:"8px 12px",boxSizing:"border-box",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"13px",outline:"none",transition:"all 0.2s ease",marginBottom:"16px"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}}),(0,o.jsx)("div",Qn({style:{padding:"8px",backgroundColor:"#DBEAFE",borderRadius:"6px",marginBottom:"16px"}},{children:(0,o.jsxs)("p",Qn({style:{fontSize:"12px",color:"#1E40AF",margin:0}},{children:[(0,o.jsx)("strong",{children:"Note:"})," Image generation is not available with Groq."]}))})),(0,o.jsx)("label",Qn({htmlFor:"groqModelName",style:{display:"block",fontWeight:"600",marginBottom:"8px",color:"#111827",fontSize:"14px"}},{children:"Groq Model"})),(0,o.jsxs)("select",Qn({id:"groqModelName",value:p,onChange:v,style:{width:"100%",padding:"8px 12px",boxSizing:"border-box",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"13px",outline:"none",transition:"all 0.2s ease",cursor:"pointer",marginBottom:"16px"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}},{children:[(0,o.jsx)("option",Qn({value:"llama3-8b-8192"},{children:"Llama-3 8B"})),(0,o.jsx)("option",Qn({value:"llama3-70b-8192"},{children:"Llama-3 70B"})),(0,o.jsx)("option",Qn({value:"mixtral-8x7b-32768"},{children:"Mixtral 8x7B"})),(0,o.jsx)("option",Qn({value:"gemma-7b-it"},{children:"Gemma 7B"}))]})),(0,o.jsx)("button",Qn({onClick:function(){return x(Pt.l.Groq)},style:{marginTop:"8px",padding:"6px 12px",backgroundColor:"#7c3aed",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px"}},{children:"Test API Connection"})),w()]})),(0,o.jsx)("div",{style:{marginBottom:"20px"}})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",Qn({htmlFor:"ankiConnectApiKey",style:{display:"block",fontWeight:"600",marginBottom:"8px",color:"#111827",fontSize:"14px"}},{children:"AnkiConnect API Key (optional)"})),(0,o.jsx)("input",{type:"text",id:"ankiConnectApiKey",value:null!==u?u:"",onChange:function(e){a((0,Ye.Zm)(e.target.value))},style:{width:"100%",padding:"8px 12px",boxSizing:"border-box",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"13px",outline:"none",transition:"all 0.2s ease",marginBottom:"20px"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}})]}),(0,o.jsxs)("div",{children:[(0,o.jsxs)("p",Qn({style:{fontSize:"13px",marginBottom:"8px",color:"#6B7280"}},{children:["Install the Anki plugin ",(0,o.jsx)("strong",{children:"AnkiConnect"})," and configure it as follows:"]})),(0,o.jsxs)("ul",Qn({style:{fontSize:"13px",listStyle:"disc",paddingLeft:"20px",marginBottom:"8px",color:"#6B7280"}},{children:[(0,o.jsxs)("li",Qn({style:{marginBottom:"4px"}},{children:["Go to ",(0,o.jsx)("strong",{children:"Tools"})," then ",(0,o.jsx)("strong",{children:"Add-ons"})," then ",(0,o.jsx)("strong",{children:"Get Add-ons..."})]})),(0,o.jsxs)("li",Qn({style:{marginBottom:"4px",display:"flex",alignItems:"center",flexWrap:"wrap",gap:"6px"}},{children:["Paste Code\xa0\xa0",(0,o.jsxs)("button",Qn({onClick:function(){return navigator.clipboard.writeText("2055492159")},style:{display:"flex",alignItems:"center",backgroundColor:"#F3F4F6",padding:"4px 6px",borderRadius:"4px",color:"#2563EB",transition:"all 0.2s ease",border:"none",cursor:"pointer"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="#E5E7EB"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="#F3F4F6"}},{children:[(0,o.jsx)("img",{src:b,alt:"Copy Icon",style:{width:"16px",height:"16px",marginRight:"4px"}}),(0,o.jsx)("code",Qn({style:{backgroundColor:"transparent",fontSize:"12px"}},{children:"2055492159"}))]}))]})),(0,o.jsxs)("li",Qn({style:{marginBottom:"4px"}},{children:["Then click ",(0,o.jsx)("strong",{children:"OK"})]})),(0,o.jsx)("li",Qn({style:{marginBottom:"4px"}},{children:"Restart Anki"})),(0,o.jsxs)("li",Qn({style:{marginBottom:"4px"}},{children:["Navigate to ",(0,o.jsx)("strong",{children:"Tools"})," > ",(0,o.jsx)("strong",{children:"Add-ons"})," > ",(0,o.jsx)("strong",{children:"AnkiConnect"})," >",(0,o.jsx)("strong",{children:"Config"})]}))]})),(0,o.jsxs)("div",Qn({style:{position:"relative",backgroundColor:"#F9FAFB",padding:"12px",borderRadius:"6px",marginBottom:"20px"}},{children:[(0,o.jsxs)("p",Qn({style:{fontSize:"13px",marginBottom:"8px",color:"#6B7280"}},{children:["Copy paste the following config, you can change the ",(0,o.jsx)("code",{children:"apiKey"}),":"]})),(0,o.jsx)("pre",Qn({style:{display:"block",overflowX:"hidden",overflowY:"auto",padding:"10px",backgroundColor:"#F3F4F6",borderRadius:"4px",whiteSpace:"pre-wrap",cursor:"pointer",fontSize:"12px",color:"#374151",margin:0,wordBreak:"break-word"},onClick:function(){return navigator.clipboard.writeText(JSON.stringify({apiKey:u||"your_api_key",webCorsOriginList:["http://localhost","*"],webBindPort:8765},null,2))},title:"Click to copy"},{children:JSON.stringify({apiKey:u||"your_api_key",webCorsOriginList:["http://localhost","*"],webBindPort:8765},null,2)})),(0,o.jsx)("button",Qn({onClick:function(){return navigator.clipboard.writeText(JSON.stringify({apiKey:u||"your_api_key",webCorsOriginList:["http://localhost","*"],webBindPort:8765},null,2))},style:{position:"absolute",top:"8px",right:"8px",background:"transparent",border:"none",cursor:"pointer",padding:"4px"},title:"Copy to clipboard"},{children:(0,o.jsx)("img",{src:b,alt:"Copy Icon",style:{width:"16px",height:"16px"}})}))]}))]})]}))};var tr="SET_ANKI_AVAILABILITY",nr=function(e){return{type:tr,payload:e}},rr="FETCH_DECKS_SUCCESS",ar="SET_DECK_ID",or=function(e){return{type:ar,payload:e}},ir=function(){return ir=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},ir.apply(this,arguments)},lr=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))},sr=function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(s){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&l[0]?r.return:l[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,l[1])).done)return a;switch(r=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,r=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],r=0}finally{n=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}},cr=function(e,t,n){if(n||2===arguments.length)for(var r,a=0,o=t.length;a<o;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))},ur=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]};const dr=function(e){e.onBackClick;var t=E(),n=Ge(),a=n.storedCards,i=m((function(e){return e.deck.deckId})),l=m((function(e){return e.deck.decks})),s=m((function(e){return e.settings.useAnkiConnect})),c=m((function(e){return e.settings.ankiConnectUrl})),u=m((function(e){return e.settings.ankiConnectApiKey})),d=m((function(e){return e.anki.isAnkiAvailable})),p=m((function(e){return e.settings.openAiKey})),f=m((function(e){return e.settings.imageInstructions})),h=m((function(e){return e.cards})),g=(0,r.useState)([]),v=g[0],y=g[1],b=(0,r.useState)(!1),x=b[0],w=b[1],S=(0,r.useState)(!1),k=S[0],C=S[1],A=(0,r.useState)("not_exported"),T=A[0],I=A[1],z=(0,r.useState)(!1),F=z[0],M=z[1],j=(0,r.useState)(null),B=j[0],R=j[1],O=(0,r.useState)(!1),L=O[0],N=O[1],P=(0,r.useState)(!1),_=(P[0],P[1]),D=(0,r.useState)(""),q=D[0],U=D[1],$=(0,r.useState)(!1),H=$[0],V=$[1],G=(0,r.useState)(null),W=G[0],Y=G[1],K=(0,r.useState)(!1),X=K[0],J=K[1],Z=(0,r.useState)(!1),ee=Z[0],te=Z[1],ne=(0,r.useState)(1),re=ne[0],ae=ne[1],ie=(0,r.useState)(10),le=ie[0],se=ie[1],ce=(0,r.useState)(!1),ue=ce[0],de=ce[1],pe=(0,r.useState)("anki_cards"),fe=pe[0],he=pe[1],ge=(0,r.useState)(!1),me=ge[0],ve=ge[1],ye=vn(),be=ye.showError,xe=ye.renderErrorNotification;(0,r.useEffect)((function(){t(ze())}),[t]);var we=(0,r.useRef)(!1);(0,r.useEffect)((function(){if(!(a.length>0||we.current))try{var e=localStorage.getItem("anki_stored_cards");if(!e)return void(we.current=!0);var n=JSON.parse(e);Array.isArray(n)&&n.length>0&&t({type:"SET_STORED_CARDS",payload:n})}catch(e){console.error("Failed to hydrate cards from localStorage:",e)}finally{we.current=!0}}),[t,a.length]);var Se=(0,r.useCallback)((function(){return lr(void 0,void 0,void 0,(function(){var e,n,r;return sr(this,(function(a){switch(a.label){case 0:if(!s)return t(nr(!1)),[2];C(!0),a.label=1;case 1:return a.trys.push([1,3,4,5]),[4,oe(c,u)];case 2:if((e=a.sent()).error)throw new Error(e.error);return n=Array.isArray(e.result)?e.result:[],t({type:"FETCH_DECKS_SUCCESS",payload:n}),t(nr(!0)),!i&&n.length>0&&t(or(n[0].deckId)),[3,5];case 3:return r=a.sent(),console.error("Error loading decks:",r),t(nr(!1)),t({type:"FETCH_DECKS_SUCCESS",payload:[]}),[3,5];case 4:return C(!1),[7];case 5:return[2]}}))}))}),[s,c,u,t,i]);(0,r.useEffect)((function(){s?Se():t(nr(!1))}),[s,Se,t]),(0,r.useEffect)((function(){d||M(!1)}),[d]);var ke=(0,r.useMemo)((function(){if(!Array.isArray(a)||0===a.length)return[];var e=function(){switch(T){case"not_exported":return a.filter((function(e){return"not_exported"===e.exportStatus}));case"exported":return a.filter((function(e){return"exported_to_anki"===e.exportStatus||"exported_to_file"===e.exportStatus}));default:return a}}();return cr([],e,!0).sort((function(e,t){return new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()}))}),[a,T]),Ce=(0,r.useMemo)((function(){return 0===ke.length?1:Math.max(1,Math.ceil(ke.length/le))}),[ke.length,le]),Ee=(0,r.useMemo)((function(){if(0===ke.length)return[];var e=Math.min(Math.max(re,1),Ce),t=(e-1)*le,n=t+le;return ke.slice(t,n)}),[ke,re,le,Ce,a.length]);(0,r.useEffect)((function(){ae((function(e){var t=Math.min(Math.max(e,1),Ce);return t===e?e:t}))}),[Ce]);var Ae=(0,r.useMemo)((function(){for(var e=0,t=0,n=0,r=a;n<r.length;n++){var o=r[n];"not_exported"===o.exportStatus?e+=1:"exported_to_anki"!==o.exportStatus&&"exported_to_file"!==o.exportStatus||(t+=1)}return{all:a.length,not_exported:e,exported:t}}),[a]),Ie=(0,r.useCallback)((function(e){B||y((function(t){return t.includes(e)?t.filter((function(t){return t!==e})):cr(cr([],t,!0),[e],!1)}))}),[B]),Fe=(0,r.useCallback)((function(){B||y((function(e){return e.length===ke.length?[]:ke.map((function(e){return e.id}))}))}),[B,ke]),Me=function(e){var t=new Date(e),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),a=String(t.getHours()).padStart(2,"0"),o=String(t.getMinutes()).padStart(2,"0");return"".concat(r,"/").concat(n," ").concat(a,":").concat(o)},je=function(e){switch(e){case"exported_to_anki":return(0,o.jsx)("span",ir({style:{fontSize:"11px",color:"#10B981",marginLeft:"8px"}},{children:"\u2713 Anki"}));case"exported_to_file":return(0,o.jsx)("span",ir({style:{fontSize:"11px",color:"#2563EB",marginLeft:"8px"}},{children:"\u2713 File"}));default:return null}},Be=function(e){return B===e?null:(0,o.jsxs)("div",ir({className:"card-content",style:{padding:"8px"}},{children:[(e.text||e.front)&&(e.mode===Q.d.LanguageLearning?(0,o.jsx)("p",ir({style:{fontWeight:"bold",fontSize:"14px",marginBottom:"4px",color:"#111827",lineHeight:"1.4",wordWrap:"break-word"}},{children:e.text||e.front||""})):(0,o.jsx)("div",ir({style:{fontWeight:600,fontSize:"14px",marginBottom:"4px",color:"#111827",lineHeight:"1.4",wordWrap:"break-word"}},{children:(0,o.jsx)(en,{content:e.front||"",enableAI:!0,style:{fontSize:"14px",color:"#111827"}})}))),(e.translation||e.back)&&(0,o.jsx)("div",ir({style:{color:"#374151",fontSize:"13px",marginBottom:"8px",lineHeight:"1.4",wordWrap:"break-word"}},{children:e.mode===Q.d.LanguageLearning?e.translation:e.back&&(0,o.jsx)(en,{content:e.back.length>150?e.back.substring(0,150)+"...":e.back,enableAI:!0,style:{fontSize:"13px",color:"#374151"}})})),e.mode===Q.d.LanguageLearning&&e.examples&&e.examples.length>0&&(0,o.jsxs)("div",ir({style:{marginTop:"8px"}},{children:[(0,o.jsx)("p",ir({style:{fontSize:"12px",color:"#6B7280",marginBottom:"4px"}},{children:"Examples:"})),e.examples.slice(0,1).map((function(e,t){var n=e[0],r=e[1];return(0,o.jsxs)("div",ir({style:{fontSize:"12px",marginBottom:"2px"}},{children:[(0,o.jsx)("p",ir({style:{color:"#111827",marginBottom:"2px",lineHeight:"1.4",wordWrap:"break-word",overflow:"visible",whiteSpace:"normal"}},{children:n})),r&&(0,o.jsx)("p",ir({style:{color:"#6B7280",fontStyle:"italic",lineHeight:"1.4",wordWrap:"break-word",overflow:"visible",whiteSpace:"normal"}},{children:r}))]}),t)})),e.examples.length>1&&(0,o.jsxs)("p",ir({style:{fontSize:"11px",color:"#6B7280"}},{children:["+",e.examples.length-1," more examples"]}))]})),(e.image||e.imageUrl)&&(0,o.jsx)("div",ir({style:{marginTop:"8px",textAlign:"center"}},{children:(0,o.jsx)("img",{src:e.image||e.imageUrl||"",alt:"Card image",style:{maxWidth:"100%",maxHeight:"80px",borderRadius:"4px",border:"1px solid #E5E7EB",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"},onError:function(t){var n,r,a,o,i;console.error("Image failed to load for card:",e.id,"image data:",{hasImage:!!e.image,hasImageUrl:!!e.imageUrl,imageLength:null===(n=e.image)||void 0===n?void 0:n.length,imageUrlLength:null===(r=e.imageUrl)||void 0===r?void 0:r.length,imagePreview:null===(a=e.image)||void 0===a?void 0:a.substring(0,50),imageUrlPreview:null===(o=e.imageUrl)||void 0===o?void 0:o.substring(0,50),imageSrc:(e.image||e.imageUrl||"").substring(0,100),usingType:e.image?"base64 (permanent)":"url (temporary)"});var l=t.target;l.style.display="none";var s=document.createElement("div");s.style.cssText="\n                                    width: 100%;\n                                    height: 60px;\n                                    background-color: #F3F4F6;\n                                    border: 1px dashed #D1D5DB;\n                                    border-radius: 4px;\n                                    display: flex;\n                                    align-items: center;\n                                    justify-content: center;\n                                    color: #6B7280;\n                                    font-size: 12px;\n                                ",s.textContent=e.image?"\u{1f5bc}\ufe0f Image error":"\u{1f5bc}\ufe0f URL expired",null===(i=l.parentNode)||void 0===i||i.insertBefore(s,l.nextSibling)},onLoad:function(){var t,n;ur("\u2705 Image loaded successfully for card:",e.id,{usingType:e.image?"base64 (permanent)":"url (temporary)",imageLength:null===(t=e.image)||void 0===t?void 0:t.length,imageUrlLength:null===(n=e.imageUrl)||void 0===n?void 0:n.length})}})})),(0,o.jsxs)("div",ir({style:{marginTop:"8px",display:"flex",justifyContent:"space-between",alignItems:"center"}},{children:[(0,o.jsx)("span",ir({style:{fontSize:"10px",color:"#6B7280",backgroundColor:e.mode===Q.d.LanguageLearning?"#EEF2FF":"#F0FDF4",padding:"2px 6px",borderRadius:"12px",border:"1px solid ".concat(e.mode===Q.d.LanguageLearning?"#C7D2FE":"#BBF7D0"),fontWeight:"500"}},{children:e.mode===Q.d.LanguageLearning?"\u{1f5e3}\ufe0f Language":"\u{1f4da} General"})),(0,o.jsx)("span",ir({style:{fontSize:"10px",color:"#9CA3AF"}},{children:Me(e.createdAt)}))]}))]}))},Re=function(e){t(or(e.target.value))},Oe=function(){M((function(e){var t=!e;return!e&&s&&Se(),t}))},Le=function(e){ur("Starting to edit card:",e.id),ur("Card data:",e),R(e),Y(ir({},e)),N(!0),_(!0),U(""),V(!1),J(!1),te(!1),ur("Modal state set for editing card:",e.id)},Ne=function(){ur("Canceling edit, resetting modal state..."),R(null),Y(null),N(!1),_(!1),U(""),V(!1),J(!1),te(!1),ur("Edit canceled, modal should be hidden now.")},Pe=function(){return lr(void 0,void 0,void 0,(function(){var e,t;return sr(this,(function(r){if(!B||!W)return[2];try{if(te(!0),(e=ir(ir({},B),{text:W.text||B.text||"",translation:W.translation||B.translation||"",examples:Array.isArray(W.examples)?W.examples:Array.isArray(B.examples)?B.examples:[],front:W.front||B.front||"",back:W.back||B.back||"",image:W.image||B.image||null,imageUrl:W.imageUrl||B.imageUrl||null,linguisticInfo:W.linguisticInfo||B.linguisticInfo||"",transcription:W.transcription||B.transcription||""})).mode===Q.d.LanguageLearning){if(!e.text||!e.translation)return be("Please provide both text and translation"),[2];e.text=e.text.trim(),e.translation=e.translation.trim()}else{if(!e.front||!e.back)return be("Please provide both front and back content"),[2];e.front=e.front.trim(),e.back=(null===(t=e.back)||void 0===t?void 0:t.trim())||null}ur("Final data being saved to Redux:",e),n.updateStoredCard(e),Ne()}catch(e){console.error("Error saving card:",e),be("Failed to update card. Please try again.")}finally{te(!1)}return[2]}))}))},_e=function(){return lr(void 0,void 0,void 0,(function(){var e,t,n,r,a,o,i;return sr(this,(function(l){switch(l.label){case 0:if(!B)return[2];l.label=1;case 1:if(l.trys.push([1,6,,7]),!p)throw new Error("OpenAI API key is not configured. Please add it in the settings.");return e=(null==W?void 0:W.text)||B.text,ur("Starting image generation for text:",e),[4,(0,We.getDescriptionImage)(p,e,f)];case 2:if(t=l.sent(),ur("Description generated:",t),!t)throw new Error("Failed to generate image description");return n=f?"".concat(t,". ").concat(f):t,[4,(0,gn.H)("https://api.openai.com/v1/images/generations",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(p)},body:JSON.stringify({prompt:n,n:1,size:"512x512",response_format:"url"})})];case 3:return[4,l.sent().json()];case 4:if(r=l.sent(),ur("OpenAI direct API response:",r),!r.data||!r.data[0]||!r.data[0].url)throw new Error("OpenAI did not return an image URL");return a=r.data[0].url,ur("Image URL generated:",a),[4,new Promise((function(e,t){chrome.runtime.sendMessage(a,(function(n){if(chrome.runtime.lastError)return console.error("Error sending message:",chrome.runtime.lastError),void t(chrome.runtime.lastError);ur("Response from background script:",n),n&&n.status&&n.data?e(n.data):t(new Error("Failed to get image data from background script"))}))}))];case 5:return o=l.sent(),ur("Image data received from background"),W&&Y(ir(ir({},W),{imageUrl:o,image:o})),[3,7];case 6:return i=l.sent(),console.error("Error generating image:",i),be("Image generation failed: ".concat((null==i?void 0:i.message)||"Unknown error")),[3,7];case 7:return[2]}}))}))},De=function(){return lr(void 0,void 0,void 0,(function(){return sr(this,(function(e){if(!B)return[2];try{J(!0),(null==W?void 0:W.text)||B.text,be("Examples generation would be implemented here","info")}catch(e){console.error("Error generating examples:",e),be("Examples generation failed: ".concat((null==e?void 0:e.message)||"Unknown error"))}finally{J(!1)}return[2]}))}))},qe=function(){return lr(void 0,void 0,void 0,(function(){return sr(this,(function(e){if(!q.trim()||H||!B)return[2];V(!0);try{be('Custom instruction "'.concat(q,'" would be applied here'),"info"),U("")}catch(e){console.error("Error applying custom instructions:",e),be("Failed to apply custom instructions")}finally{V(!1)}return[2]}))}))},Ue=function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),qe())},$e=function(e){W&&Y(ir(ir({},W),{translation:e}))},He=function(e){W&&Y(ir(ir({},W),{examples:e}))},Ve=function(e){W&&Y(ir(ir({},W),{back:e}))},Ye=function(e){W&&Y(ir(ir({},W),{linguisticInfo:e}))},Ke=function(e){e>=1&&e<=Ce&&ae(e)},Xe=function(e){se(Number(e.target.value)),ae(1)};(0,r.useEffect)((function(){var e,t;ur("Modal state changed:",{showEditModal:L,editingCard:null==B?void 0:B.id,currentCardData:{text:(null===(e=h.text)||void 0===e?void 0:e.substring(0,20))+"...",translation:(null===(t=h.translation)||void 0===t?void 0:t.substring(0,20))+"..."}})}),[L,B,h.text,h.translation]);var Qe,Je=function(){return lr(void 0,void 0,void 0,(function(){var e,t,r,o,i,l,s,c;return sr(this,(function(u){if(0===v.length)return be("Please select at least one card to export"),[2];try{ve(!0),e=a.filter((function(e){return v.includes(e.id)})),t="#separator:tab\n#html:true\n",e.forEach((function(e,n){var r,a,o,i;if(ur("Processing card ".concat(n," for file export:"),{id:e.id,mode:e.mode,hasImage:!!e.image,hasImageUrl:!!e.imageUrl,imageType:typeof e.image,imageUrlType:typeof e.imageUrl,imageLength:null===(r=e.image)||void 0===r?void 0:r.length,imageUrlLength:null===(a=e.imageUrl)||void 0===a?void 0:a.length,imagePreview:null===(o=e.image)||void 0===o?void 0:o.substring(0,50),imageUrlPreview:null===(i=e.imageUrl)||void 0===i?void 0:i.substring(0,50),hasLinguisticInfo:!!e.linguisticInfo}),e.mode===Q.d.LanguageLearning){var l=(e.text||e.front||"").trim(),s="";if(e.translation&&(s+="<b>".concat(e.translation,"</b>")),e.examples&&e.examples.length>0&&(s+="<br><br>",e.examples.forEach((function(e,t){var n=e[0],r=e[1];s+="".concat(t+1,". ").concat(n),r&&(s+="<br><span style='font-size: 0.8em;'><i>".concat(r,"</i></span>")),s+="<br><br>"}))),e.image)if((g=e.image).startsWith("data:")){var c="base64,";if(-1!==(y=g.indexOf(c))){var u=g.substring(y+c.length);s+='<div><img src="data:image/jpeg;base64,'.concat(u,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else s+='<div><img src="'.concat(g,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else s+='<div><img src="data:image/jpeg;base64,'.concat(g,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>');else if(e.imageUrl){if((v=e.imageUrl).startsWith("data:")){c="base64,";if(-1!==(y=v.indexOf(c))){u=v.substring(y+c.length);s+='<div><img src="data:image/jpeg;base64,'.concat(u,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else s+='<div><img src="'.concat(v,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else v.startsWith("http")?s+='<div><img src="'.concat(v,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>'):s+='<div><img src="data:image/jpeg;base64,'.concat(v,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}if(e.linguisticInfo&&e.linguisticInfo.trim()){var d=e.linguisticInfo.trim().split("\n").filter((function(e){return e.trim()})),p="";d.forEach((function(e){var t=e.trim();if(t.match(/^[\u0410-\u042f\u0401A-Z][^:]*:$/))p+='<div style="color: #2563EB; font-weight: bold; margin-top: 12px; margin-bottom: 4px;">'.concat(t,"</div>");else if(t.startsWith("\u2022")||t.startsWith("-")||t.startsWith("*")){var n=t.replace(/^[\u2022\-*]\s*/,"");p+='<div style="margin-left: 16px; margin-bottom: 2px; color: #374151;">\u2022 '.concat(n,"</div>")}else if(t.includes(":")&&!t.endsWith(":")){var r=t.split(":"),a=r[0],o=r.slice(1).join(":").trim();p+='<div style="margin-bottom: 4px;"><span style="color: #6B7280; font-weight: 500;">'.concat(a.trim(),':</span> <span style="color: #111827;">').concat(o,"</span></div>")}else t&&(p+='<div style="margin-bottom: 6px; color: #374151; line-height: 1.4;">'.concat(t,"</div>"))})),p&&(s+='<div style="margin-top: 20px; padding: 12px; background-color: #F8FAFC; border-left: 4px solid #2563EB; border-radius: 0 6px 6px 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1);"><div style="color: #1E40AF; font-weight: bold; font-size: 14px; margin-bottom: 8px; display: flex; align-items: center;"><span style="margin-right: 6px;">\u{1f4da}</span>Grammar & Linguistics</div>'.concat(p,"</div>"))}var f=l.replace(/\t/g," ").replace(/\n/g," ").trim(),h=s.replace(/\t/g," ").replace(/\r?\n/g,"<br>").trim();t+="".concat(f,"\t").concat(h,"\n"),ur("Exported card ".concat(n,":"),{front:f.substring(0,50),backLength:h.length,hasLinguisticInfo:h.includes("Grammar & Linguistics")})}else if(e.mode===Q.d.GeneralTopic){l=(e.front||e.text||"No content").trim();var g,m=(e.back||e.text||"").trim();if(e.image)if((g=e.image).startsWith("data:")){c="base64,";if(-1!==(y=g.indexOf(c))){u=g.substring(y+c.length);m+='<div><img src="data:image/jpeg;base64,'.concat(u,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else m+='<div><img src="'.concat(g,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else m+='<div><img src="data:image/jpeg;base64,'.concat(g,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>');else if(e.imageUrl){var v;if((v=e.imageUrl).startsWith("data:")){var y;c="base64,";if(-1!==(y=v.indexOf(c))){u=v.substring(y+c.length);m+='<div><img src="data:image/jpeg;base64,'.concat(u,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else m+='<div><img src="'.concat(v,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else v.startsWith("http")?m+='<div><img src="'.concat(v,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>'):m+='<div><img src="data:image/jpeg;base64,'.concat(v,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}f=l.replace(/\t/g," ").replace(/\n/g," ").trim(),h=m.replace(/\t/g," ").replace(/\r?\n/g,"<br>").trim();t+="".concat(f,"\t").concat(h,"\n"),ur("Exported General Topic card ".concat(n,":"),{front:f.substring(0,50),backLength:h.length,hasImage:!(!e.image&&!e.imageUrl),imageSource:e.image?"image field":e.imageUrl?"imageUrl field":"none"})}})),(r=fe.trim())||(r="anki_cards"),(r=r.replace(/[<>:"/\\|?*]/g,"_")).toLowerCase().endsWith(".txt")||(r+=".txt"),o=new Blob([t],{type:"text/plain;charset=utf-8;"}),i=URL.createObjectURL(o),(l=document.createElement("a")).setAttribute("href",i),l.setAttribute("download",r),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l),s=e.length,c=e.filter((function(e){return e.linguisticInfo&&e.linguisticInfo.trim()})).length,ur("Export complete: ".concat(s," cards exported, ").concat(c," with grammar information")),v.forEach((function(e){n.updateCardExportStatus(e,"exported_to_file"),ur("Updated card ".concat(e," export status to 'exported_to_file'"))})),de(!1),setTimeout((function(){try{var e=localStorage.getItem("anki_stored_cards");if(e){var t=JSON.parse(e);ur("Verified localStorage after file export:",t.filter((function(e){return e.id&&v.includes(e.id)})).map((function(e){return{id:e.id,status:e.exportStatus}})))}}catch(e){console.error("Error verifying localStorage after file export:",e)}}),500)}catch(e){console.error("Error during file export:",e),be("Failed to export cards. Please try again.")}finally{ve(!1)}return[2]}))}))};return(0,o.jsxs)("div",ir({style:{display:"flex",flexDirection:"column",height:"100%",padding:"12px",paddingBottom:"20px",overflowY:"auto",overflowX:"hidden",width:"100%",maxWidth:"320px",margin:"0 auto",position:"relative"}},{children:[(0,o.jsx)("div",ir({style:{display:"flex",justifyContent:"center",alignItems:"center",marginBottom:"16px",paddingBottom:"12px",borderBottom:"1px solid #E5E7EB",marginTop:"20px"}},{children:(0,o.jsxs)("div",ir({style:{fontWeight:"600",fontSize:"16px",color:"#111827",background:"linear-gradient(to right, #4F46E5, #2563EB)",backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",padding:"4px 12px",borderRadius:"16px",border:"1px solid #E5E7EB",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"}},{children:["Saved Cards (",a.length,")"]}))})),a.length>0?(0,o.jsxs)(o.Fragment,{children:[(Qe={base:{padding:"8px 16px",fontSize:"14px",fontWeight:"500",borderRadius:"6px 6px 0 0",cursor:"pointer",textAlign:"center",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"6px"},active:{backgroundColor:"#ffffff",color:"#2563EB",borderBottom:"2px solid #2563EB"},inactive:{backgroundColor:"#F3F4F6",color:"#6B7280",borderBottom:"2px solid transparent"}},(0,o.jsxs)("div",ir({style:{display:"flex",width:"100%",borderBottom:"1px solid #E5E7EB",marginBottom:"16px",backgroundColor:"#F3F4F6"}},{children:[(0,o.jsxs)("div",ir({onClick:function(){return I("not_exported")},style:ir(ir(ir({},Qe.base),"not_exported"===T?Qe.active:Qe.inactive),{flex:1})},{children:["New",(0,o.jsx)("span",ir({style:{backgroundColor:"not_exported"===T?"#2563EB":"#9CA3AF",color:"white",borderRadius:"9999px",fontSize:"12px",padding:"1px 6px",minWidth:"20px"}},{children:Ae.not_exported}))]})),(0,o.jsxs)("div",ir({onClick:function(){return I("all")},style:ir(ir(ir({},Qe.base),"all"===T?Qe.active:Qe.inactive),{flex:1})},{children:["All",(0,o.jsx)("span",ir({style:{backgroundColor:"all"===T?"#2563EB":"#9CA3AF",color:"white",borderRadius:"9999px",fontSize:"12px",padding:"1px 6px",minWidth:"20px"}},{children:Ae.all}))]})),(0,o.jsxs)("div",ir({onClick:function(){return I("exported")},style:ir(ir(ir({},Qe.base),"exported"===T?Qe.active:Qe.inactive),{flex:1})},{children:["Exported",(0,o.jsx)("span",ir({style:{backgroundColor:"exported"===T?"#2563EB":"#9CA3AF",color:"white",borderRadius:"9999px",fontSize:"12px",padding:"1px 6px",minWidth:"20px"}},{children:Ae.exported}))]}))]}))),s&&function(){var e;if(!s)return null;var t={container:{display:"flex",flexDirection:"column",gap:"8px",marginBottom:"16px",backgroundColor:"#F9FAFB",padding:"12px",borderRadius:"8px",border:"1px solid #E5E7EB"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},title:{fontSize:"14px",fontWeight:"600",color:"#111827"},button:{backgroundColor:"transparent",border:"none",cursor:"pointer",color:"#6B7280",display:"flex",alignItems:"center",padding:"0",fontSize:"12px"},selectContainer:{display:"flex",alignItems:"center",gap:"8px",width:"100%"},select:{flex:1,padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"14px",cursor:"pointer"},refreshButton:{backgroundColor:"#F3F4F6",border:"1px solid #E5E7EB",borderRadius:"6px",cursor:"pointer",color:"#6B7280",display:"flex",alignItems:"center",justifyContent:"center",padding:"6px 8px",width:"36px",height:"36px",transition:"all 0.2s ease"}},n=(null===(e=l.find((function(e){return e.deckId===i})))||void 0===e?void 0:e.name)||"None selected",r=k?"#F59E0B":d?"#10B981":"#EF4444",a=k?"AnkiConnect: checking\u2026":d?"AnkiConnect: available":"AnkiConnect: unavailable",c=(0,o.jsxs)("div",ir({style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"12px",padding:"8px 12px",backgroundColor:"#F9FAFB",borderRadius:"8px",border:"1px solid #E5E7EB",marginBottom:d?"8px":"16px"}},{children:[(0,o.jsxs)("div",ir({style:{display:"flex",alignItems:"center",gap:"8px"}},{children:[(0,o.jsx)("span",{style:{width:"8px",height:"8px",borderRadius:"999px",backgroundColor:r,boxShadow:"0 0 0 3px ".concat(r,"22")}}),(0,o.jsx)("span",ir({style:{fontSize:"13px",fontWeight:500,color:"#111827"}},{children:a}))]})),(0,o.jsx)("button",ir({onClick:Se,disabled:k,style:{backgroundColor:"transparent",border:"none",color:"#2563EB",cursor:k?"default":"pointer",fontSize:"12px",display:"flex",alignItems:"center",gap:"6px"}},{children:k?(0,o.jsx)(Ot,{type:"spinner",size:"small",color:"#2563EB"}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Ft,{size:12}),d?"Refresh":"Check"]})}))]}));return d?F?(0,o.jsxs)(o.Fragment,{children:[c,(0,o.jsxs)("div",ir({style:t.container},{children:[(0,o.jsxs)("div",ir({style:t.header},{children:[(0,o.jsx)("span",ir({style:t.title},{children:"Select Anki Deck"})),(0,o.jsx)("button",ir({onClick:Oe,style:t.button},{children:"Hide"}))]})),(0,o.jsxs)("div",ir({style:t.selectContainer},{children:[(0,o.jsxs)("select",ir({value:i,onChange:Re,style:t.select,disabled:k},{children:[0===l.length&&(0,o.jsx)("option",ir({value:""},{children:"No decks available"})),l.map((function(e){return(0,o.jsx)("option",ir({value:e.deckId},{children:e.name}),e.deckId)}))]})),(0,o.jsx)("button",ir({onClick:Se,disabled:k,title:"Refresh decks list",style:t.refreshButton,"aria-label":"Refresh decks"},{children:k?(0,o.jsx)("span",ir({style:{marginLeft:"2px"}},{children:(0,o.jsx)(Ot,{type:"spinner",size:"small",color:"#4B5563"})})):(0,o.jsx)(Ft,{size:14})}))]}))]}))]}):(0,o.jsxs)(o.Fragment,{children:[c,(0,o.jsxs)("div",ir({style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",marginBottom:"12px",padding:"8px 12px",backgroundColor:"#F9FAFB",borderRadius:"6px",border:"1px solid #E5E7EB"}},{children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("span",ir({style:{fontSize:"13px",color:"#6B7280"}},{children:"Anki Deck:"})),(0,o.jsx)("span",ir({style:{fontSize:"14px",fontWeight:"500",marginLeft:"8px",color:"#111827"}},{children:n}))]}),(0,o.jsx)("button",ir({onClick:Oe,style:{backgroundColor:"transparent",border:"none",cursor:"pointer",color:"#2563EB",fontSize:"13px"}},{children:"Change"}))]}))]}):c}(),(0,o.jsxs)("div",ir({style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"}},{children:[(0,o.jsxs)("div",ir({style:{display:"flex",alignItems:"center"}},{children:[(0,o.jsx)("input",{type:"checkbox",id:"selectAll",checked:v.length===ke.length&&ke.length>0,onChange:Fe,style:{marginRight:"8px"},disabled:null!==B}),(0,o.jsx)("label",ir({htmlFor:"selectAll",style:{fontSize:"14px",cursor:null!==B?"default":"pointer",opacity:null!==B?.6:1}},{children:v.length===ke.length&&ke.length>0?"Deselect All":"Select All"}))]})),(0,o.jsxs)("div",ir({style:{display:"flex",gap:"8px",flexWrap:"wrap"}},{children:[(0,o.jsx)("button",ir({onClick:function(){return lr(void 0,void 0,void 0,(function(){var e,r,o,l,p,f,h,g;return sr(this,(function(m){switch(m.label){case 0:if(0===v.length)return be("Please select at least one card to save"),[2];if(!s)return be("AnkiConnect integration is disabled. Enable it in settings and try again."),[2];if(!d)return be("AnkiConnect is not available. Make sure Anki is running with the AnkiConnect plugin."),[2];if(!i)return be("Please select an Anki deck before saving."),[2];w(!0),m.label=1;case 1:m.trys.push([1,10,11,12]),e="Basic",r=a.filter((function(e){return v.includes(e.id)})),o=[],l=[],p=function(e){var t,n,r,a,i,s,c,u,d,p;return sr(this,(function(f){switch(f.label){case 0:return e.mode===Q.d.LanguageLearning&&e.translation?(n=null,e.image&&(e.image.startsWith("data:")?(a="base64,",i=e.image.indexOf(a),n=-1!==i?e.image.substring(i+a.length):e.image):n=e.image),t={text:e.text||e.front||"",translation:e.translation,examples:e.examples||[],image_base64:n,linguisticInfo:e.linguisticInfo,transcription:e.transcription||""},ur("Adding language learning card to Anki export:",{cardId:e.id,text:e.text,hasImage:!!n,imageLength:null==n?void 0:n.length,imagePreview:null==n?void 0:n.substring(0,30)}),o.push(t),[3,13]):[3,1];case 1:return e.mode!==Q.d.GeneralTopic||!e.front&&!e.text||!e.back&&!e.text?[3,13]:(n=null,(r=e.image||e.imageUrl)?r.startsWith("data:")?(a="base64,",i=r.indexOf(a),n=-1!==i?r.substring(i+a.length):r,[3,12]):[3,2]:[3,12]);case 2:if(!r.startsWith("http://")&&!r.startsWith("https://"))return[3,11];f.label=3;case 3:return f.trys.push([3,9,,10]),ur("Fetching image from URL for card ".concat(e.id,": ").concat(r)),[4,fetch(r)];case 4:return(s=f.sent()).ok?[4,s.blob()]:[3,7];case 5:return c=f.sent(),[4,new Promise((function(e){var t=new FileReader;t.onloadend=function(){var n=t.result,r="base64,",a=n.indexOf(r);e(-1!==a?n.substring(a+7):n)},t.readAsDataURL(c)}))];case 6:return u=f.sent(),n=u,ur("Successfully converted URL to base64 for card ".concat(e.id)),[3,8];case 7:console.warn("Failed to fetch image from URL for card ".concat(e.id,": ").concat(s.status)),f.label=8;case 8:return[3,10];case 9:return d=f.sent(),console.error("Error fetching image from URL for card ".concat(e.id,":"),d),[3,10];case 10:return[3,12];case 11:n=r,f.label=12;case 12:p={front:e.front||e.text||"No content",back:e.back||e.text||"No content",text:e.text,image_base64:n},ur("Adding general topic card to Anki export:",{cardId:e.id,text:e.text,hasImage:!!n,imageLength:null==n?void 0:n.length,imagePreview:null==n?void 0:n.substring(0,30),originalImageSource:null==r?void 0:r.substring(0,50),hadImageField:!!e.image,hadImageUrlField:!!e.imageUrl,usedField:e.image?"image":e.imageUrl?"imageUrl":"none"}),l.push(p),f.label=13;case 13:return[2]}}))},f=0,h=r,m.label=2;case 2:return f<h.length?(g=h[f],[5,p(g)]):[3,5];case 3:m.sent(),m.label=4;case 4:return f++,[3,2];case 5:return o.length>0?[4,t(Te(Q.d.LanguageLearning,c,u,i,e,o))]:[3,7];case 6:m.sent(),m.label=7;case 7:return l.length>0?[4,t(Te(Q.d.GeneralTopic,c,u,i,e,l))]:[3,9];case 8:m.sent(),m.label=9;case 9:return v.forEach((function(e){n.updateCardExportStatus(e,"exported_to_anki"),ur("Updated card ".concat(e," export status to 'exported_to_anki'"))})),setTimeout((function(){try{var e=localStorage.getItem("anki_stored_cards");if(e){var t=JSON.parse(e);ur("Verified localStorage after export:",t.filter((function(e){return e.id&&v.includes(e.id)})).map((function(e){return{id:e.id,status:e.exportStatus}})))}}catch(e){console.error("Error verifying localStorage after export:",e)}}),500),[3,12];case 10:return m.sent(),be("Failed to save cards to Anki. Make sure Anki is running and AnkiConnect is properly configured."),[3,12];case 11:return w(!1),[7];case 12:return[2]}}))}))},disabled:x||0===v.length||!s||!d||!i||null!==B,style:{padding:"6px 10px",borderRadius:"6px",backgroundColor:"#10B981",color:"#ffffff",fontSize:"13px",border:"none",cursor:"pointer",opacity:!x&&0!==v.length&&s&&d&&i&&null===B?1:.6},title:null!==B?"Finish editing first":!d&&s?"Anki Connect is not available":!i&&s?"Please select a deck first":""},{children:x?(0,o.jsx)("div",ir({style:{display:"flex",alignItems:"center",justifyContent:"center"}},{children:(0,o.jsx)(Ot,{type:"spinner",size:"small",inline:!0,color:"#ffffff",text:"Saving to Anki"})})):"Save to Anki"})),(0,o.jsxs)("button",ir({onClick:function(){if(0!==v.length){var e=(new Date).toISOString().split("T")[0],t="anki_cards_".concat(e);he(t),de(!0)}else be("Please select at least one card to export")},disabled:x||0===v.length||null!==B,style:{padding:"6px 10px",borderRadius:"6px",backgroundColor:"#2563EB",color:"#ffffff",fontSize:"13px",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",opacity:x||0===v.length||null!==B?.6:1}},{children:[(0,o.jsx)(pt,{size:12}),(0,o.jsx)("span",{children:"Export"})]}))]}))]})),(0,o.jsx)("div",ir({style:{flex:1,overflow:"auto",marginBottom:"16px"}},{children:0===ke.length?(0,o.jsx)("div",ir({style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"200px",color:"#6B7280",textAlign:"center",padding:"20px"}},{children:(0,o.jsx)("p",ir({style:{fontSize:"14px"}},{children:"all"===T?"No cards yet":"not_exported"===T?"No new cards":"No exported cards"}))})):Ee.map((function(e){return(0,o.jsxs)("div",ir({style:{border:"1px solid #E5E7EB",borderRadius:"6px",marginBottom:"8px",backgroundColor:v.includes(e.id)?"#F3F4F6":"#ffffff"}},{children:[(0,o.jsxs)("div",ir({style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",borderBottom:B===e?"none":"1px solid #E5E7EB"}},{children:[(0,o.jsxs)("div",ir({style:{display:"flex",alignItems:"center"}},{children:[(0,o.jsx)("input",{type:"checkbox",checked:v.includes(e.id),onChange:function(){return Ie(e.id)},style:{marginRight:"8px"},disabled:null!==B}),(0,o.jsx)("div",ir({style:{flex:1,minWidth:0}},{children:(0,o.jsxs)("div",ir({style:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:"4px"}},{children:[(0,o.jsx)("span",ir({style:{fontSize:"12px",color:"#6B7280"}},{children:e.mode===Q.d.LanguageLearning?"Language":"Topic"})),(0,o.jsx)("span",ir({style:{fontSize:"10px",color:"#9CA3AF"}},{children:Me(e.createdAt)})),je(e.exportStatus)]}))}))]})),(0,o.jsx)("div",ir({style:{display:"flex",alignItems:"center",gap:"4px"}},{children:B!==e&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("button",ir({onClick:function(){return Le(e)},style:{backgroundColor:"transparent",border:"1px solid #E5E7EB",borderRadius:"6px",cursor:"pointer",color:"#2563EB",display:"flex",alignItems:"center",justifyContent:"center",padding:"6px 8px",fontSize:"12px",minWidth:"70px",height:"32px",transition:"all 0.2s ease",gap:"4px"},title:"Edit card",onMouseOver:function(e){e.currentTarget.style.backgroundColor="#EFF6FF",e.currentTarget.style.borderColor="#2563EB"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.borderColor="#E5E7EB"}},{children:[(0,o.jsx)(ft,{size:12}),"Edit"]})),(0,o.jsxs)("button",ir({onClick:function(){return t=e.id,n.deleteStoredCard(t),void y((function(e){return e.filter((function(e){return e!==t}))}));var t},style:{backgroundColor:"transparent",border:"1px solid #E5E7EB",borderRadius:"6px",cursor:"pointer",color:"#EF4444",display:"flex",alignItems:"center",justifyContent:"center",padding:"6px 8px",fontSize:"12px",minWidth:"70px",height:"32px",transition:"all 0.2s ease",gap:"4px"},title:"Delete card",onMouseOver:function(e){e.currentTarget.style.backgroundColor="#FEF2F2",e.currentTarget.style.borderColor="#EF4444"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.borderColor="#E5E7EB"}},{children:[(0,o.jsx)(Bt,{size:12}),"Delete"]}))]})}))]})),Be(e)]}),e.id)}))})),(0,o.jsxs)("div",ir({style:{display:"flex",flexDirection:"column",gap:"12px",marginTop:"16px",marginBottom:"16px",padding:"12px",backgroundColor:"#F9FAFB",borderRadius:"8px",border:"1px solid #E5E7EB"}},{children:[(0,o.jsxs)("div",ir({style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},{children:[(0,o.jsx)("div",ir({style:{display:"flex",alignItems:"center",gap:"8px"}},{children:(0,o.jsxs)("select",ir({value:le,onChange:Xe,style:{padding:"6px 8px",borderRadius:"6px",border:"1px solid #D1D5DB",fontSize:"13px",backgroundColor:"#FFFFFF",color:"#111827",fontWeight:"500",cursor:"pointer",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)",WebkitAppearance:"none",MozAppearance:"none",appearance:"none",backgroundImage:'url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2212%22%20height%3D%2212%22%20viewBox%3D%220%200%2012%2012%22%3E%3Cpath%20fill%3D%22%23424242%22%20d%3D%22M6%2C9L1.2%2C4.2%20c-0.4-0.4-0.4-1%2C0-1.4s1-0.4%2C1.4%2C0L6%2C6.2l3.4-3.4c0.4-0.4%2C1-0.4%2C1.4%2C0s0.4%2C1%2C0%2C1.4L6%2C9z%22%2F%3E%3C%2Fsvg%3E")',backgroundRepeat:"no-repeat",backgroundPosition:"right 8px center",paddingRight:"28px",minWidth:"90px"},"aria-label":"Cards per page"},{children:[(0,o.jsx)("option",ir({value:5},{children:"5 per page"})),(0,o.jsx)("option",ir({value:10},{children:"10 per page"})),(0,o.jsx)("option",ir({value:20},{children:"20 per page"})),(0,o.jsx)("option",ir({value:50},{children:"50 per page"}))]}))})),(0,o.jsx)("div",ir({style:{display:"flex",alignItems:"center",fontSize:"13px",fontWeight:"500",color:"#4B5563"}},{children:ke.length>0?"".concat(Math.min((re-1)*le+1,ke.length),"-").concat(Math.min(re*le,ke.length)," of ").concat(ke.length," cards"):"0 cards"}))]})),(0,o.jsx)("div",ir({style:{display:"flex",justifyContent:"center",alignItems:"center"}},{children:(0,o.jsxs)("div",ir({style:{display:"flex",alignItems:"center",border:"1px solid #D1D5DB",borderRadius:"8px",overflow:"hidden",backgroundColor:"#FFFFFF",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"}},{children:[(0,o.jsx)("button",ir({onClick:function(){return Ke(1)},disabled:1===re,style:{padding:"8px 10px",backgroundColor:"transparent",border:"none",borderRight:"1px solid #E5E7EB",cursor:1===re?"default":"pointer",color:1===re?"#9CA3AF":"#111827",display:"flex",alignItems:"center",justifyContent:"center",transition:"background-color 0.2s"},onMouseOver:function(e){1!==re&&(e.currentTarget.style.backgroundColor="#F9FAFB")},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent"},"aria-label":"Go to first page",title:"First page"},{children:(0,o.jsx)("svg",ir({width:"14",height:"14",fill:"currentColor",viewBox:"0 0 20 20"},{children:(0,o.jsx)("path",{fillRule:"evenodd",d:"M15.707 15.707a1 1 0 01-1.414 0l-5-5a1 1 0 010-1.414l5-5a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 010 1.414zm-6 0a1 1 0 01-1.414 0l-5-5a1 1 0 010-1.414l5-5a1 1 0 011.414 1.414L5.414 10l4.293 4.293a1 1 0 010 1.414z",clipRule:"evenodd"})}))})),(0,o.jsx)("button",ir({onClick:function(){return Ke(re-1)},disabled:1===re,style:{padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRight:"1px solid #E5E7EB",cursor:1===re?"default":"pointer",color:1===re?"#9CA3AF":"#111827",display:"flex",alignItems:"center",justifyContent:"center",transition:"background-color 0.2s"},onMouseOver:function(e){1!==re&&(e.currentTarget.style.backgroundColor="#F9FAFB")},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent"},"aria-label":"Previous page",title:"Previous page"},{children:(0,o.jsx)(ot,{size:14})})),(0,o.jsxs)("div",ir({style:{padding:"6px 16px",fontSize:"13px",fontWeight:"500",color:"#111827",display:"flex",alignItems:"center",backgroundColor:"transparent",borderRight:"1px solid #E5E7EB",minWidth:"60px",justifyContent:"center"}},{children:[re," / ",Ce||1]})),(0,o.jsx)("button",ir({onClick:function(){return Ke(re+1)},disabled:re===Ce||0===Ce,style:{padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRight:"1px solid #E5E7EB",cursor:re===Ce||0===Ce?"default":"pointer",color:re===Ce||0===Ce?"#9CA3AF":"#111827",display:"flex",alignItems:"center",justifyContent:"center",transition:"background-color 0.2s"},onMouseOver:function(e){re!==Ce&&0!==Ce&&(e.currentTarget.style.backgroundColor="#F9FAFB")},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent"},"aria-label":"Next page",title:"Next page"},{children:(0,o.jsx)(it,{size:14})})),(0,o.jsx)("button",ir({onClick:function(){return Ke(Ce)},disabled:re===Ce||0===Ce,style:{padding:"8px 10px",backgroundColor:"transparent",border:"none",cursor:re===Ce||0===Ce?"default":"pointer",color:re===Ce||0===Ce?"#9CA3AF":"#111827",display:"flex",alignItems:"center",justifyContent:"center",transition:"background-color 0.2s"},onMouseOver:function(e){re!==Ce&&0!==Ce&&(e.currentTarget.style.backgroundColor="#F9FAFB")},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent"},"aria-label":"Go to last page",title:"Last page"},{children:(0,o.jsx)("svg",ir({width:"14",height:"14",fill:"currentColor",viewBox:"0 0 20 20"},{children:(0,o.jsx)("path",{fillRule:"evenodd",d:"M4.293 15.707a1 1 0 001.414 0l5-5a1 1 0 000-1.414l-5-5a1 1 0 00-1.414 1.414L8.586 10l-4.293 4.293a1 1 0 000 1.414zm6 0a1 1 0 001.414 0l5-5a1 1 0 000-1.414l-5-5a1 1 0 00-1.414 1.414L14.586 10l-4.293 4.293a1 1 0 000 1.414z",clipRule:"evenodd"})}))}))]}))}))]}))]}):(0,o.jsx)("div",ir({style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"300px",color:"#6B7280",textAlign:"center"}},{children:(0,o.jsx)("p",{children:"No saved cards yet."})})),ue&&(0,o.jsx)("div",ir({style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(4px)"}},{children:(0,o.jsxs)("div",ir({style:{backgroundColor:"#ffffff",borderRadius:"12px",padding:"24px",maxWidth:"400px",width:"90%",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",border:"1px solid #E5E7EB"}},{children:[(0,o.jsxs)("div",ir({style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"20px"}},{children:[(0,o.jsxs)("h3",ir({style:{margin:0,fontSize:"18px",fontWeight:"600",color:"#111827",display:"flex",alignItems:"center",gap:"8px"}},{children:[(0,o.jsx)(pt,{size:16,style:{color:"#2563EB"}}),"Export Cards"]})),(0,o.jsx)("button",ir({onClick:function(){return de(!1)},disabled:me,style:{backgroundColor:"transparent",border:"none",cursor:me?"default":"pointer",padding:"4px",borderRadius:"4px",color:"#6B7280",opacity:me?.5:1}},{children:(0,o.jsx)(jt,{size:16})}))]})),(0,o.jsxs)("div",ir({style:{marginBottom:"20px"}},{children:[(0,o.jsxs)("p",ir({style:{margin:"0 0 16px 0",fontSize:"14px",color:"#6B7280",lineHeight:"1.5"}},{children:["Export ",v.length," selected cards to a file. Choose a filename or use the default."]})),(0,o.jsx)("label",ir({style:{display:"block",fontSize:"14px",fontWeight:"500",color:"#374151",marginBottom:"8px"}},{children:"Filename"})),(0,o.jsxs)("div",ir({style:{position:"relative"}},{children:[(0,o.jsx)("input",{type:"text",value:fe,onChange:function(e){return he(e.target.value)},placeholder:"Enter filename (without extension)",disabled:me,style:{width:"100%",padding:"10px 12px",paddingRight:"48px",border:"1px solid #D1D5DB",borderRadius:"8px",fontSize:"14px",outline:"none",transition:"border-color 0.2s ease",backgroundColor:me?"#F9FAFB":"#ffffff",opacity:me?.7:1,boxSizing:"border-box"},onFocus:function(e){me||(e.target.style.borderColor="#2563EB",e.target.style.boxShadow="0 0 0 3px rgba(37, 99, 235, 0.1)")},onBlur:function(e){e.target.style.borderColor="#D1D5DB",e.target.style.boxShadow="none"},onKeyDown:function(e){"Enter"!==e.key||me||Je(),"Escape"===e.key&&de(!1)}}),(0,o.jsx)("span",ir({style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",fontSize:"13px",color:"#9CA3AF",pointerEvents:"none"}},{children:".txt"}))]})),(0,o.jsx)("p",ir({style:{margin:"6px 0 0 0",fontSize:"12px",color:"#6B7280"}},{children:"The .txt extension will be added automatically"}))]})),(0,o.jsxs)("div",ir({style:{display:"flex",gap:"12px",justifyContent:"flex-end"}},{children:[(0,o.jsx)("button",ir({onClick:function(){return de(!1)},disabled:me,style:{padding:"10px 16px",border:"1px solid #D1D5DB",borderRadius:"8px",backgroundColor:"#ffffff",color:"#374151",fontSize:"14px",fontWeight:"500",cursor:me?"default":"pointer",transition:"all 0.2s ease",opacity:me?.5:1},onMouseOver:function(e){me||(e.currentTarget.style.backgroundColor="#F9FAFB",e.currentTarget.style.borderColor="#9CA3AF")},onMouseOut:function(e){me||(e.currentTarget.style.backgroundColor="#ffffff",e.currentTarget.style.borderColor="#D1D5DB")}},{children:"Cancel"})),(0,o.jsx)("button",ir({onClick:Je,disabled:me||!fe.trim(),style:{padding:"10px 16px",border:"none",borderRadius:"8px",backgroundColor:!fe.trim()||me?"#9CA3AF":"#2563EB",color:"#ffffff",fontSize:"14px",fontWeight:"500",cursor:!fe.trim()||me?"default":"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"8px",minWidth:"100px",justifyContent:"center"},onMouseOver:function(e){!me&&fe.trim()&&(e.currentTarget.style.backgroundColor="#1D4ED8")},onMouseOut:function(e){!me&&fe.trim()&&(e.currentTarget.style.backgroundColor="#2563EB")}},{children:me?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Ot,{type:"spinner",size:"small",inline:!0,color:"#ffffff"}),(0,o.jsx)("span",{children:"Exporting..."})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(pt,{size:14}),(0,o.jsx)("span",{children:"Export"})]})}))]}))]}))})),function(){if(ur("renderEditModal called. showEditModal:",L,"editingCard:",B),!L||!B)return ur("Modal not showing because showEditModal:",L,"editingCard:",!!B),null;if(!W)return ur("No local editing card data available"),null;var e=W.text,t=W.translation,n=W.examples,r=W.front,a=W.back,i=W.image,l=W.imageUrl,s=W.linguisticInfo,c=W.transcription,u=B.mode===Q.d.LanguageLearning?e||r||"":r||"";return ur("Rendering edit modal with local data:",{text:(null==e?void 0:e.substring(0,20))+"...",translation:(null==t?void 0:t.substring(0,20))+"...",examplesCount:null==n?void 0:n.length,hasImage:!!i,hasImageUrl:!!l}),(0,o.jsx)("div",ir({style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"flex-start",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(2px)",padding:"16px",overflowY:"auto",overflowX:"hidden"},onClick:Ne},{children:(0,o.jsxs)("div",ir({style:{backgroundColor:"#ffffff",borderRadius:"12px",maxWidth:"340px",width:"100%",maxHeight:"calc(100% - 32px)",overflowY:"auto",overflowX:"hidden",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",position:"relative",padding:"16px",boxSizing:"border-box",margin:"auto"},onClick:function(e){return e.stopPropagation()}},{children:[(0,o.jsxs)("div",ir({style:{position:"sticky",top:0,display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid #E5E7EB",paddingBottom:"12px",marginBottom:"16px",backgroundColor:"#ffffff",zIndex:2}},{children:[(0,o.jsx)("h3",ir({style:{margin:0,fontSize:"16px",fontWeight:600,color:"#111827"}},{children:"Edit Card"})),(0,o.jsx)("button",ir({onClick:Ne,style:{background:"none",border:"none",display:"flex",alignItems:"center",justifyContent:"center",padding:"8px",borderRadius:"50%",cursor:"pointer",transition:"background-color 0.2s"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="#F3F4F6"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="transparent"},"aria-label":"Close"},{children:(0,o.jsx)(jt,{size:16,color:"#6B7280"})}))]})),(0,o.jsxs)("div",ir({style:{width:"100%",marginBottom:"12px"}},{children:[(0,o.jsxs)("div",ir({style:{position:"relative",width:"100%",maxWidth:"100%"}},{children:[(0,o.jsx)("input",{type:"text",value:q,onChange:function(e){return U(e.target.value)},onKeyDown:Ue,placeholder:"Enter custom instructions for this card (e.g., 'regenerate examples', 'change image style')",style:{width:"100%",maxWidth:"100%",padding:"10px 12px",paddingRight:"44px",borderRadius:"8px",border:"1px solid #E5E7EB",fontSize:"14px",color:"#374151",backgroundColor:H?"#F9FAFB":"#FFFFFF",transition:"all 0.2s ease",boxShadow:H?"inset 0 1px 2px rgba(0, 0, 0, 0.05)":"none",boxSizing:"border-box"},disabled:H}),H?(0,o.jsx)("div",ir({style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",padding:"6px",borderRadius:"50%",color:"#4F46E5"}},{children:(0,o.jsx)(Ot,{type:"spinner",size:"small",inline:!0,color:"#4F46E5"})})):(0,o.jsx)("button",ir({onClick:qe,disabled:!q.trim()||H,style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",background:q.trim()?"linear-gradient(to right, #4F46E5, #6366F1)":"none",border:"none",color:q.trim()?"#FFFFFF":"#9CA3AF",cursor:q.trim()?"pointer":"not-allowed",display:"flex",alignItems:"center",justifyContent:"center",padding:"6px",borderRadius:"50%",width:"28px",height:"28px",boxShadow:q.trim()?"0 1px 3px rgba(0, 0, 0, 0.1)":"none",transition:"all 0.2s ease"},title:"Apply instructions"},{children:(0,o.jsx)(Et,{size:14})}))]})),(0,o.jsxs)("div",ir({style:{fontSize:"12px",color:H?"#4F46E5":"#6B7280",marginTop:"6px",display:"flex",alignItems:"center",gap:"6px",fontWeight:H?"500":"normal"}},{children:[H&&(0,o.jsx)("span",{style:{display:"inline-block",width:"6px",height:"6px",borderRadius:"50%",backgroundColor:"#4F46E5",animation:"pulse 1.5s infinite"}}),H?"Applying your instructions...":"Type instructions and press Enter or click the magic wand"]}))]})),(0,o.jsx)(cn,{mode:B.mode,front:u||null,back:a||null,translation:t||null,examples:n||[],imageUrl:l||null,image:i||null,linguisticInfo:s||void 0,transcription:c||null,onNewImage:_e,onNewExamples:De,onAccept:Pe,onViewSavedCards:function(){},onCancel:Ne,loadingNewImage:!1,loadingNewExamples:X,loadingAccept:ee,shouldGenerateImage:!0,isSaved:!0,isEdited:!0,createdAt:B.createdAt?new Date(B.createdAt):new Date,setTranslation:$e,setBack:Ve,setExamples:He,setLinguisticInfo:Ye})]}))}))}(),(0,o.jsx)("div",ir({style:{position:"absolute",top:"16px",right:"16px",zIndex:9999,pointerEvents:"none"}},{children:(0,o.jsx)("div",ir({style:{pointerEvents:"auto"}},{children:xe()}))}))]}))};var pr="TOGGLE_SIDEBAR",fr="SET_SIDEBAR_VISIBILITY",hr="SET_GLOBAL_SIDEBAR_STATE",gr="INHERIT_SIDEBAR_STATE",mr="SHOW_NOTIFICATION",vr="HIDE_NOTIFICATION",yr=function(e){return{type:vr,payload:{id:e}}},br=function(){return br=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},br.apply(this,arguments)};const xr=function(){var e=m((function(e){return e.notifications.notifications})),t=E();(0,r.useEffect)((function(){e.forEach((function(e){var n=e.id,r=e.type,a=0;"success"===r||"info"===r?a=5e3:"warning"===r&&(a=6e3),a>0&&setTimeout((function(){t(yr(n))}),a)}))}),[e,t]);return 0===e.length?null:(0,o.jsx)("div",br({style:{position:"absolute",top:"16px",right:"16px",zIndex:9999,maxWidth:"300px",width:"auto",display:"flex",flexDirection:"column",gap:"8px"}},{children:e.map((function(e){var n=function(e){switch(e){case"success":return{icon:(0,o.jsx)(nt,{size:16}),color:"#059669",bgColor:"#ECFDF5",borderColor:"#10B981"};case"warning":return{icon:(0,o.jsx)(gt,{size:16}),color:"#D97706",bgColor:"#FFFBEB",borderColor:"#F59E0B"};case"info":return{icon:(0,o.jsx)(xt,{size:16}),color:"#2563EB",bgColor:"#EFF6FF",borderColor:"#3B82F6"};default:return{icon:(0,o.jsx)(Mt,{size:16}),color:"#DC2626",bgColor:"#FEF2F2",borderColor:"#EF4444"}}}(e.type),r=n.icon,a=n.color,i=n.bgColor,l=n.borderColor;return(0,o.jsxs)("div",br({style:{transform:"translateX(0)",opacity:1,transition:"all 0.3s ease-out",backgroundColor:i,border:"1px solid ".concat(l),borderRadius:"12px",padding:"16px",minWidth:"280px",maxWidth:"320px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",position:"relative",display:"flex",alignItems:"flex-start",gap:"12px"},role:"alert","aria-live":"polite"},{children:[(0,o.jsx)("div",br({style:{color:a,marginTop:"2px",flexShrink:0}},{children:r})),(0,o.jsx)("div",br({style:{flex:1,paddingRight:"8px"}},{children:(0,o.jsx)("p",br({style:{color:"#374151",margin:0,fontSize:"14px",lineHeight:"1.5",fontWeight:500}},{children:e.message}))})),(0,o.jsx)("button",br({onClick:function(){return n=e.id,void t(yr(n));var n},style:{position:"absolute",top:"8px",right:"8px",background:"transparent",border:"none",color:"#9CA3AF",cursor:"pointer",padding:"4px",borderRadius:"4px",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="rgba(0, 0, 0, 0.1)",e.currentTarget.style.color="#374151"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="#9CA3AF"},"aria-label":"Close notification"},{children:(0,o.jsx)(jt,{size:12})}))]}),e.id)}))}))};var wr=function(){return wr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},wr.apply(this,arguments)},Sr="anki_view_prefs_v1",kr="view/HYDRATE",Cr="view/SET_MODE",Er="view/SET_VISIBILITY",Ar="view/SET_FLOAT_GEOMETRY",Tr={preferredModeByTab:{},visibleByTab:{},floatGeometryByTab:{},globalMode:"sidebar",globalVisible:!0},Ir=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))},zr=function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(s){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&l[0]?r.return:l[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,l[1])).done)return a;switch(r=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,r=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],r=0}finally{n=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}},Fr=function(e){var t,n,r;return{preferredModeByTab:null!==(t=null==e?void 0:e.preferredModeByTab)&&void 0!==t?t:{},visibleByTab:null!==(n=null==e?void 0:e.visibleByTab)&&void 0!==n?n:{},floatGeometryByTab:null!==(r=null==e?void 0:e.floatGeometryByTab)&&void 0!==r?r:{},globalMode:"float"===(null==e?void 0:e.globalMode)?"float":"sidebar",globalVisible:"boolean"!=typeof(null==e?void 0:e.globalVisible)||e.globalVisible}},Mr=function(e){return new Promise((function(t){var n;try{chrome.storage.local.set(((n={})[Sr]=e,n),(function(){return t()}))}catch(e){t()}}))},jr=function(e,t){return function(n,r){return Ir(void 0,void 0,void 0,(function(){return zr(this,(function(a){switch(a.label){case 0:return n({type:Cr,payload:{tabId:e,mode:t}}),[4,Mr(Fr(r().view))];case 1:return a.sent(),[2]}}))}))}},Br=function(e,t){return function(n,r){return Ir(void 0,void 0,void 0,(function(){return zr(this,(function(a){switch(a.label){case 0:return n({type:Er,payload:{tabId:e,visible:t}}),[4,Mr(Fr(r().view))];case 1:return a.sent(),[2]}}))}))}},Rr=function(){return Rr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},Rr.apply(this,arguments)},Or=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))},Lr=function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(s){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&l[0]?r.return:l[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,l[1])).done)return a;switch(r=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,r=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],r=0}finally{n=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}},Nr=function(e,t,n){return Math.max(t,Math.min(n,e))},Pr=360,_r=660,Dr=24,qr=24,Ur=Pr+48,$r=2147483646,Hr=function(e){var t="anki-float-reset-gap",n=document.getElementById(t);e?(n||((n=document.createElement("style")).id=t,n.textContent="\n        html, body { margin-right: 0 !important; padding-right: 0 !important; }\n        #anki-sidebar-spacer, .anki-sidebar-spacer { display: none !important; width: 0 !important; }\n      ",document.head.appendChild(n)),document.documentElement.style.marginRight="",document.documentElement.style.paddingRight="",document.body.style.marginRight="",document.body.style.paddingRight=""):n&&n.parentNode&&n.parentNode.removeChild(n)},Vr=function(e,t){try{var n=document.querySelector("#sidebar");n&&(n.style.display=e?"":"none");var r=null!=t?t:document.querySelector("#anki-sidebar-root");if(r)return r.setAttribute("data-anki-sidebar-host","true"),void(r.style.display=e?"":"none")}catch(e){}if(!t)try{var a=document.querySelector("[data-anki-app-anchor]");if(!a)return;for(var o=Array.from(document.querySelectorAll("*")),i=0,l=o;i<l.length;i++){var s=l[i];if("anki-floating-root"!==s.id){var c=getComputedStyle(s),u="0px"===s.style.right||"0px"===c.right;if(("fixed"===c.position||"absolute"===c.position)&&u&&s.offsetWidth>=280&&s.offsetWidth<=520&&s.contains(a)){s.style.display=e?"":"none";break}}}}catch(e){}},Gr={backgroundColor:"#ffffff",position:"fixed",left:0,top:0,width:"var(--anki-float-width, 360px)",height:"var(--anki-float-height, 660px)",display:"flex",flexDirection:"column",zIndex:$r,borderRadius:12,overflow:"hidden",boxShadow:"0 8px 24px rgba(0,0,0,0.18), 0 1px 0 rgba(0,0,0,0.08)",border:"1px solid rgba(0,0,0,0.06)",transform:"var(--anki-float-transform, translate3d(24px, 24px, 0))",willChange:"transform"},Wr={backgroundColor:"#ffffff",height:"100vh",display:"flex",flexDirection:"column",position:"absolute",right:0,top:0,width:"350px",fontFamily:"Inter, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, sans-serif",boxShadow:"0 0 0 1px rgba(0,0,0,0.05), 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06)"},Yr=function(e){var t=e.tabId,n=Ge(),a=n.currentPage,l=n.setCurrentPage,s=(0,r.useState)(!0),c=s[0],u=s[1],d=(0,r.useState)(!1),p=d[0],f=d[1],h=E(),g=m((function(e){return e.settings.ankiConnectApiKey})),v=m((function(e){return e.settings.ankiConnectUrl})),y=(0,r.useState)(!1),b=y[0],x=y[1],w=(0,r.useState)({x:Dr,y:qr}),S=w[0],k=w[1],C=(0,r.useState)({width:Pr,height:_r}),A=C[0],T=C[1],I=(0,r.useRef)(null),z=(0,r.useRef)(null),F=(0,r.useRef)(null),M=(0,r.useRef)({x:Dr,y:qr,width:Pr,height:_r}),j=(0,r.useRef)(null),B=(0,r.useRef)(null),R=(0,r.useRef)(null),O=(0,r.useRef)(null),L=(0,r.useRef)(null),N=(0,r.useCallback)((function(){return"anki_ui_tab_".concat(t)}),[t]),P=(0,r.useCallback)((function(){if(b){var e=F.current;if(e){var t=M.current,n=t.x,r=t.y,a=t.width,o=t.height;e.style.setProperty("--anki-float-x","".concat(n,"px")),e.style.setProperty("--anki-float-y","".concat(r,"px")),e.style.setProperty("--anki-float-width","".concat(a,"px")),e.style.setProperty("--anki-float-height","".concat(o,"px")),e.style.setProperty("--anki-float-transform","translate3d(".concat(n,"px, ").concat(r,"px, 0)"))}}}),[b]),_=(0,r.useCallback)((function(){null===j.current&&(j.current=window.requestAnimationFrame((function(){j.current=null,P()})))}),[P]);(0,r.useEffect)((function(){return function(){null!==j.current&&window.cancelAnimationFrame(j.current),null!==B.current&&window.clearTimeout(B.current)}}),[]);var D=(0,r.useCallback)((function(e){var t;try{var n=N();null===(t=chrome.storage)||void 0===t||t.local.get([n],(function(t){var r,a,o,i=null!==(a=null==t?void 0:t[n])&&void 0!==a?a:{sidebarVisible:!1,floatingVisible:!1,preferredMode:"sidebar"},l=Rr(Rr({},i),e);try{null===(o=chrome.storage)||void 0===o||o.local.set(((r={})[n]=l,r))}catch(e){}}))}catch(e){}}),[N]),q=(0,r.useCallback)((function(e){try{var t=document.getElementById("sidebar");t&&(t.style.transform=e?"translateX(0)":"translateX(100%)",t.style.display=e?"":"none"),document.body.style.marginRight=e?"350px":"0"}catch(e){}}),[]),U=(0,r.useCallback)((function(){if(p){var e=M.current,n=e.x,r=e.y,a=e.width,o=e.height,i=R.current;i&&i.x===n&&i.y===r&&i.width===a&&i.height===o||(R.current={x:n,y:r,width:a,height:o},h(function(e,t){return function(n,r){return Ir(void 0,void 0,void 0,(function(){return zr(this,(function(a){switch(a.label){case 0:return n({type:Ar,payload:{tabId:e,geometry:t}}),[4,Mr(Fr(r().view))];case 1:return a.sent(),[2]}}))}))}}(t,{x:n,y:r,width:a,height:o})))}}),[h,t,p]),$=(0,r.useCallback)((function(e){if(p)return e?(null!==B.current&&(window.clearTimeout(B.current),B.current=null),void U()):void(null===B.current&&(B.current=window.setTimeout((function(){B.current=null,U()}),1e4)))}),[U,p]);(0,r.useEffect)((function(){M.current.x=S.x,M.current.y=S.y,M.current.width=A.width,M.current.height=A.height,b&&P()}),[S.x,S.y,A.width,A.height,b,P]),(0,r.useEffect)((function(){p&&(R.current=null)}),[p]),(0,r.useEffect)((function(){b&&F.current&&_()}),[b,_]),(0,r.useEffect)((function(){var e=L.current;if(e){var t=O.current;if(t&&document.body.contains(t))return t.style.display=b?"none":"",void Hr(b);var n=function(){var t=document.querySelector("#anki-sidebar-root");if(t)return t;for(var n=e.parentElement;n&&n!==document.body;){var r=getComputedStyle(n),a=n.offsetWidth,o="0px"===n.style.right||"0px"===r.right;if(("fixed"===r.position||"absolute"===r.position)&&o&&a>=280&&a<=520)return n;n=n.parentElement}for(var i=0,l=Array.from(document.querySelectorAll("*"));i<l.length;i++){var s=l[i];r=getComputedStyle(s),o="0px"===s.style.right||"0px"===r.right;if(("fixed"===r.position||"absolute"===r.position)&&o&&s.offsetWidth>=280&&s.offsetWidth<=520&&s.contains(e))return s}return null}();n&&(O.current=n,n.style.display=b?"none":""),Hr(b)}}),[b]),(0,r.useEffect)((function(){c&&Or(void 0,void 0,void 0,(function(){var e;return Lr(this,(function(t){switch(t.label){case 0:t.trys.push([0,,5,6]),h(ze()),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,oe(v,g)];case 2:return(e=t.sent()).error?h(nr(!1)):(h(function(e){return{type:rr,payload:e}}(e.result)),h(nr(!0))),[3,4];case 3:return t.sent(),h(nr(!1)),[3,4];case 4:return[3,6];case 5:return u(!1),[7];case 6:return[2]}}))}))}),[h,v,g,c]),(0,r.useEffect)((function(){h((function(e,t){return Ir(void 0,void 0,void 0,(function(){var n,r;return zr(this,(function(a){switch(a.label){case 0:return[4,new Promise((function(e){try{chrome.storage.local.get([Sr],(function(t){e(t&&t[Sr]||null)}))}catch(t){e(null)}}))];case 1:return(n=a.sent())?(e({type:kr,payload:Fr(n)}),[3,4]):[3,2];case 2:return r=Fr(t().view),e({type:kr,payload:r}),[4,Mr(r)];case 3:a.sent(),a.label=4;case 4:return[2]}}))}))})).finally((function(){return f(!0)}))}),[h]);var H=m((function(e){return function(e,t){var n,r,a,o,i,l=null!==(r=null===(n=e.view)||void 0===n?void 0:n.globalMode)&&void 0!==r?r:"sidebar";return null!==(i=null===(o=null===(a=e.view)||void 0===a?void 0:a.preferredModeByTab)||void 0===o?void 0:o[t])&&void 0!==i?i:l}(e,t)})),V=m((function(e){return function(e,t){var n,r,a,o=null===(r=null===(n=e.view)||void 0===n?void 0:n.visibleByTab)||void 0===r?void 0:r[t];if("boolean"==typeof o)return o;var i=null===(a=e.view)||void 0===a?void 0:a.globalVisible;return"boolean"!=typeof i||i}(e,t)})),G=m((function(e){return function(e,t){var n,r,a;return null!==(a=null===(r=null===(n=e.view)||void 0===n?void 0:n.floatGeometryByTab)||void 0===r?void 0:r[t])&&void 0!==a?a:null}(e,t)})),W=(0,r.useCallback)((function(){if(!G)try{var e=Pr,t=Math.min(_r,Math.max(340,window.innerHeight-48)),n=Math.max(8,window.innerWidth-e-24),r=Math.max(8,Math.min(qr,window.innerHeight-t-8));k({x:n,y:r}),T({width:e,height:t}),M.current={x:n,y:r,width:e,height:t},_()}catch(e){}}),[G,_]);(0,r.useEffect)((function(){x("float"===H&&!1!==V)}),[H,V]),(0,r.useEffect)((function(){p&&("float"===H?(D({preferredMode:"floating",floatingVisible:!1!==V,sidebarVisible:!1}),!1!==V&&q(!1)):(D({preferredMode:"sidebar",floatingVisible:!1,sidebarVisible:!1!==V}),q(!1!==V)))}),[H,V,p,D,q]),(0,r.useEffect)((function(){if(G){var e=G.x,t=G.y,n=G.width,r=G.height;k((function(n){return n.x===e&&n.y===t?n:{x:e,y:t}})),T((function(e){return e.width===n&&e.height===r?e:{width:n,height:r}})),M.current={x:e,y:t,width:n,height:r},b&&_()}else W()}),[G,W,b,_]);var Y=(0,r.useCallback)((function(){h(Br(t,!1)),x(!1),D({preferredMode:"floating",floatingVisible:!1,sidebarVisible:!1}),q(!1);var e=document.getElementById("anki-floating-root");e&&e.remove();try{null==fe||fe(!1)}catch(e){}}),[h,t,D,q]),K=(0,r.useCallback)((function(){if(b)Y();else{h(jr(t,"sidebar")),h(Br(t,!1)),h(function(e,t){return void 0===t&&(t=!0),{type:pr,payload:{tabId:e,persist:t}}}(t)),D({preferredMode:"sidebar",floatingVisible:!1,sidebarVisible:!1});try{chrome.runtime.sendMessage({action:"toggleSidebar",tabId:t})}catch(e){}}}),[h,t,b,D,Y]),X=(0,r.useCallback)((function(){W(),h(jr(t,"float")),h(Br(t,!0)),x(!0),Hr(!0),D({preferredMode:"floating",floatingVisible:!0,sidebarVisible:!1}),q(!1)}),[h,t,D,q,W]),Q=(0,r.useCallback)((function(){h(jr(t,"sidebar")),h(Br(t,!0)),x(!1),Hr(!1),D({preferredMode:"sidebar",floatingVisible:!1,sidebarVisible:!0}),q(!0);var e=document.querySelector("#sidebar");e&&(e.removeAttribute("hidden"),e.style.removeProperty("display"),e.style.removeProperty("visibility"),e.style.removeProperty("opacity"));var n=document.getElementById("anki-floating-root");n&&0===n.childElementCount&&n.remove()}),[h,t,D,q]),J=(0,r.useCallback)((function(){x((function(e){var n,r=!e;return h(jr(t,r?"float":"sidebar")),h(Br(t,!0)),r?(W(),Hr(!0),Vr(!1,O.current),D({preferredMode:"floating",floatingVisible:!0,sidebarVisible:!1}),q(!1)):(Hr(!1),Vr(!0,O.current),(n=document.querySelector("#sidebar"))&&(n.removeAttribute("hidden"),n.style.removeProperty("display"),n.style.removeProperty("visibility"),n.style.removeProperty("opacity"),n.style.removeProperty("transform"),n.classList.remove("hidden","is-hidden","collapsed")),D({preferredMode:"sidebar",floatingVisible:!1,sidebarVisible:!0}),q(!0)),r}))}),[h,t,D,q,W]);(0,r.useEffect)((function(){var e=function(e,t,n){if(null==e?void 0:e.action)return"toggleFloating"===e.action?(J(),null==n||n({ok:!0}),!0):"showFloating"===e.action?(X(),null==n||n({ok:!0}),!0):"hideFloating"===e.action?(Y(),null==n||n({ok:!0}),!0):"collapseSidebar"===e.action?(X(),null==n||n({ok:!0}),!0):"expandSidebar"===e.action?(Q(),null==n||n({ok:!0}),!0):void 0};return chrome.runtime.onMessage.addListener(e),function(){return chrome.runtime.onMessage.removeListener(e)}}),[J,X,Q,Y]);var Z,ee,te=function(e){if(b){e.preventDefault(),fe(!0);var t=M.current,n=t.x,r=t.y;I.current={offsetX:e.clientX-n,offsetY:e.clientY-r},window.addEventListener("mousemove",re),window.addEventListener("mouseup",ne)}},ne=function(){if(I.current){I.current=null,window.removeEventListener("mousemove",re),window.removeEventListener("mouseup",ne),fe(!1);var e=M.current,t=e.x,n=e.y;k((function(e){return e.x===t&&e.y===n?e:{x:t,y:n}})),$(!0)}},re=function(e){var t=I.current;if(t){var n=window.innerWidth,r=window.innerHeight,a=M.current,o=Math.max(8,n-a.width-8),i=Math.max(8,r-a.height-8),l=Nr(e.clientX-t.offsetX,8,o),s=Nr(e.clientY-t.offsetY,8,i);l===a.x&&s===a.y||(a.x=l,a.y=s,_(),$())}},ae=function(e){if(b){e.preventDefault(),e.stopPropagation(),fe(!0);var t=M.current,n=t.width,r=t.height;z.current={startX:e.clientX,startY:e.clientY,startW:n,startH:r},window.addEventListener("mousemove",le),window.addEventListener("mouseup",ie)}},ie=function(){if(z.current){z.current=null,window.removeEventListener("mousemove",le),window.removeEventListener("mouseup",ie),fe(!1);var e=M.current,t=e.width,n=e.height,r=e.x,a=e.y;T((function(e){return e.width===t&&e.height===n?e:{width:t,height:n}})),k((function(e){return e.x===r&&e.y===a?e:{x:r,y:a}})),$(!0)}},le=function(e){var t=z.current;if(t){var n=e.clientX-t.startX,r=e.clientY-t.startY,a=Math.min(window.innerWidth-16,Ur),o=Math.min(window.innerHeight-16,900),i=Nr(t.startW+n,340,a),l=Nr(t.startH+r,340,o),s=M.current,c=Nr(s.x,8,Math.max(8,window.innerWidth-i-8)),u=Nr(s.y,8,Math.max(8,window.innerHeight-l-8));s.width===i&&s.height===l&&s.x===c&&s.y===u||(s.width=i,s.height=l,s.x=c,s.y=u,_(),$())}},se=(0,r.useCallback)((function(e){return l(e)}),[l]),ce=(0,r.useMemo)((function(){var e=b?"12px":"0px";return{width:"100%",height:"100%",paddingTop:"createCard"!==a?"46px":"12px",paddingBottom:"58px",paddingLeft:e,paddingRight:e,overflowY:"auto",overflowX:"hidden",opacity:1,transform:"translateX(0)",transition:"all 0.3s ease-in-out",boxSizing:"border-box"}}),[a,b]),ue=(0,r.useMemo)((function(){return Rr(Rr({},ce),{flex:1,display:"flex",flexDirection:"column",position:"relative"})}),[ce]),de=function(){switch(a){case"settings":return(0,o.jsx)("div",Rr({style:ce},{children:(0,o.jsx)(er,{onBackClick:function(){return se("createCard")},popup:!1})}));case"storedCards":return(0,o.jsx)("div",Rr({style:ce},{children:(0,o.jsx)(dr,{onBackClick:function(){return se("createCard")}})}));default:return(0,o.jsx)("div",Rr({style:ue},{children:(0,o.jsx)(Yn,{})}))}},pe=function(){var e=n.storedCards.filter((function(e){return"not_exported"===e.exportStatus})).length;return(0,o.jsxs)(o.Fragment,{children:[b&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{style:{position:"absolute",top:0,left:0,right:0,height:32,pointerEvents:"none",background:"linear-gradient(to right, rgba(243,244,246,0.96), rgba(255,255,255,0.84))",borderTopLeftRadius:12,borderTopRightRadius:12,borderBottom:"1px solid rgba(0,0,0,0.06)",zIndex:$r+0}}),(0,o.jsx)("div",{onMouseDown:te,style:{position:"absolute",top:0,left:0,right:96,height:32,cursor:"move",zIndex:$r+1},title:"Drag to move"})]}),(0,o.jsx)("button",Rr({onClick:K,style:{position:"absolute",top:"6px",right:"12px",background:"transparent",border:"none",cursor:"pointer",padding:"6px",color:"#6B7280",borderRadius:5,width:28,height:28,zIndex:$r+2},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.color="#EF4444"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="#6B7280"},title:"Close extension"},{children:(0,o.jsx)(jt,{size:14})})),(0,o.jsx)("button",Rr({onClick:J,style:{position:"absolute",top:"6px",right:"46px",background:"transparent",border:"none",cursor:"pointer",padding:"6px",color:"#6B7280",borderRadius:5,width:28,height:28,zIndex:$r+2},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.color="#111827"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="#6B7280"},title:b?"Dock to sidebar":"Make window floating"},{children:b?(0,o.jsx)(dt,{size:14}):(0,o.jsx)(mt,{size:14})})),"createCard"!==a&&(0,o.jsx)("div",Rr({style:{position:"absolute",top:b?"".concat(40,"px"):"6px",left:"12px",right:"80px",zIndex:$r+2}},{children:(0,o.jsxs)("button",Rr({onClick:function(){return se("createCard")},style:{backgroundColor:"#2563EB",border:"none",cursor:"pointer",padding:"8px 14px",color:"#fff",borderRadius:8,width:"100%",minHeight:36,fontSize:13,fontWeight:600,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",lineHeight:1.1,boxShadow:"0 1px 3px rgba(37,99,235,0.2)",transition:"all .2s"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#1D4ED8",e.currentTarget.style.transform="translateY(-0.5px)"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#2563EB",e.currentTarget.style.transform="translateY(0)"}},{children:[(0,o.jsx)(Tt,{size:14,style:{transform:"translateY(-0.5px)"}}),(0,o.jsx)("span",Rr({style:{transform:"translateY(-0.5px)"}},{children:"New Card"}))]}))})),(0,o.jsxs)("div",Rr({style:{position:"absolute",bottom:"8px",left:"12px",right:"12px",display:"flex",gap:"6px",zIndex:100}},{children:[(0,o.jsxs)("button",Rr({onClick:function(){return se("storedCards")},disabled:n.isGeneratingCard,className:"nav-button",style:{backgroundColor:"storedCards"===a?"#EFF6FF":"#F9FAFB",border:"1px solid ".concat("storedCards"===a?"#BFDBFE":"#E5E7EB"),cursor:n.isGeneratingCard?"not-allowed":"pointer",padding:"10px 14px",color:n.isGeneratingCard?"#9CA3AF":"storedCards"===a?"#2563EB":"#6B7280",borderRadius:"10px",transition:"all 0.2s ease",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flex:1,gap:"3px",fontSize:"11px",fontWeight:"storedCards"===a?600:500,boxShadow:"storedCards"===a?"0 2px 4px rgba(37, 99, 235, 0.1)":"0 1px 2px rgba(0, 0, 0, 0.05)",position:"relative",opacity:n.isGeneratingCard?.6:1},title:n.isGeneratingCard?"Please wait while card is being generated":"View your saved cards"},{children:[(0,o.jsxs)("div",Rr({style:{position:"relative",display:"flex",alignItems:"center"}},{children:[(0,o.jsx)(Ct,{size:16}),e>0&&(0,o.jsx)("span",Rr({style:{position:"absolute",top:"-6px",right:"-8px",backgroundColor:"#EF4444",color:"white",borderRadius:"10px",fontSize:"10px",fontWeight:"bold",padding:"2px 6px",minWidth:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.1)"}},{children:e>99?"99+":e}))]})),(0,o.jsx)("span",{children:"Cards"})]})),(0,o.jsxs)("button",Rr({onClick:function(){return se("settings")},disabled:n.isGeneratingCard,className:"nav-button",style:{backgroundColor:"settings"===a?"#EFF6FF":"#F9FAFB",border:"1px solid ".concat("settings"===a?"#BFDBFE":"#E5E7EB"),cursor:n.isGeneratingCard?"not-allowed":"pointer",padding:"10px 14px",color:n.isGeneratingCard?"#9CA3AF":"settings"===a?"#2563EB":"#6B7280",borderRadius:"10px",transition:"all 0.2s ease",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flex:1,gap:"3px",fontSize:"11px",fontWeight:"settings"===a?600:500,boxShadow:"settings"===a?"0 2px 4px rgba(37, 99, 235, 0.1)":"0 1px 2px rgba(0, 0, 0, 0.05)",opacity:n.isGeneratingCard?.6:1},title:n.isGeneratingCard?"Please wait while card is being generated":"App settings and API configuration"},{children:[(0,o.jsx)(ut,{size:16}),(0,o.jsx)("span",{children:"Settings"})]}))]})),b&&(0,o.jsx)("div",{onMouseDown:ae,title:"Drag to resize",style:{position:"absolute",width:16,height:16,right:6,bottom:6,cursor:"nwse-resize",borderRadius:4,background:"linear-gradient(135deg, rgba(203,213,225,.9), rgba(148,163,184,.9))",boxShadow:"0 1px 2px rgba(0,0,0,.08)",zIndex:$r+2}})]})},fe=function(e){var t,n,r="anki-disable-user-select",a="anki-drag-overlay",o=document.getElementById(r),i=fe;if(e){if(o||((o=document.createElement("style")).id=r,o.textContent="\n          html, body, * { user-select: none !important; -webkit-user-select: none !important; }\n          body { cursor: grabbing !important; }\n        ",document.head.appendChild(o)),!document.getElementById(a))(s=document.createElement("div")).id=a,s.style.position="fixed",s.style.inset="0",s.style.zIndex=String($r-1),s.style.cursor="grabbing",s.style.background="transparent",document.body.appendChild(s);var l=function(e){return e.preventDefault()};i._preventHandler=l,document.addEventListener("selectstart",l,!0),document.addEventListener("dragstart",l,!0)}else{var s;o&&o.remove(),(s=document.getElementById(a))&&s.remove(),(l=i._preventHandler)&&(document.removeEventListener("selectstart",l,!0),document.removeEventListener("dragstart",l,!0),i._preventHandler=void 0);try{null===(n=null===(t=window.getSelection())||void 0===t?void 0:t.removeAllRanges)||void 0===n||n.call(t)}catch(e){}}},he=b?Gr:Wr,ge=(0,r.useMemo)((function(){return{width:"100%",flex:1,display:"flex",flexDirection:"column",backgroundColor:"#ffffff",marginTop:0,height:"100%",overflowY:"auto",overflowX:"hidden",boxSizing:"border-box",paddingTop:b?40:0,paddingRight:b?12:0,paddingLeft:b?8:0,scrollPaddingTop:b?40:0}}),[b]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{ref:L,"data-anki-app-anchor":!0,style:{display:"none"}}),b?(0,i.createPortal)((0,o.jsx)("div",Rr({className:"App",ref:b?F:void 0,style:he},{children:(0,o.jsxs)("div",Rr({style:{flex:1,width:"100%",height:"100%",position:"relative",display:"flex",flexDirection:"column"}},{children:[pe(),(0,o.jsxs)("header",Rr({className:"App-header",style:ge},{children:[de(),(0,o.jsx)("div",Rr({style:{position:"absolute",top:16,right:16,zIndex:$r+2,maxWidth:300,width:"auto",pointerEvents:"none"}},{children:(0,o.jsx)("div",Rr({style:{pointerEvents:"auto"}},{children:(0,o.jsx)(xr,{})}))}))]}))]}))})),(Z="anki-floating-root",ee=document.getElementById(Z),ee||((ee=document.createElement("div")).id=Z,document.body.appendChild(ee)),ee)):(0,o.jsx)("div",Rr({className:"App",style:he},{children:(0,o.jsxs)("div",Rr({style:{flex:1,width:"100%",height:"100%",position:"relative",display:"flex",flexDirection:"column"}},{children:[pe(),(0,o.jsxs)("header",Rr({className:"App-header",style:ge},{children:[de(),(0,o.jsx)("div",Rr({style:{position:"absolute",top:16,right:16,zIndex:$r+2,maxWidth:300,width:"auto",pointerEvents:"none"}},{children:(0,o.jsx)("div",Rr({style:{pointerEvents:"auto"}},{children:(0,o.jsx)(xr,{})}))}))]}))]}))}))]})};const Kr=function(e){var t=e.tabId,n=E();return(0,r.useEffect)((function(){n(function(e){return{type:F,payload:e}}(t)),Vr(!0),Hr(!1)}),[n,t]),(0,o.jsx)(Ve,Rr({tabId:t},{children:(0,o.jsx)(Yr,{tabId:t})}))};
/**
 * @license
 * ReduxedChromeStorage v3.0.10
 * https://github.com/hindmost/reduxed-chrome-storage
 * Copyright (c) Savr Goryaev aka hindmost
 *
 * This source code is licensed under the MIT license
 * https://github.com/hindmost/reduxed-chrome-storage/blob/master/LICENSE
 *
 * Dependencies:
 *
 * uuid v8.3.2
 */
var Xr,Qr=new Uint8Array(16);function Jr(){if(!Xr&&!(Xr="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Xr(Qr)}var Zr=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var ea=[],ta=0;ta<256;++ta)ea.push((ta+256).toString(16).substr(1));function na(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(ea[e[t+0]]+ea[e[t+1]]+ea[e[t+2]]+ea[e[t+3]]+"-"+ea[e[t+4]]+ea[e[t+5]]+"-"+ea[e[t+6]]+ea[e[t+7]]+"-"+ea[e[t+8]]+ea[e[t+9]]+"-"+ea[e[t+10]]+ea[e[t+11]]+ea[e[t+12]]+ea[e[t+13]]+ea[e[t+14]]+ea[e[t+15]]).toLowerCase();if(!function(e){return"string"==typeof e&&Zr.test(e)}(n))throw TypeError("Stringified UUID is invalid");return n}function ra(e,t,n){var r=(e=e||{}).random||(e.rng||Jr)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var a=0;a<16;++a)t[n+a]=r[a];return t}return na(r)}function aa(e){return null==e||"object"!=typeof e?e:JSON.parse(JSON.stringify(e))}function oa(e,t){if(e===t)return!0;if(null==e||"object"!=typeof e||null==t||"object"!=typeof t||Array.isArray(e)!==Array.isArray(t))return!1;const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(const a of n)if(r.indexOf(a)<=-1||!oa(e[a],t[a]))return!1;return!0}function ia(e,t){if(e===t)return;if(null==e||"object"!=typeof e||null==t||"object"!=typeof t)return e;if(Array.isArray(e)||Array.isArray(t))return oa(e,t)?void 0:e;const n=Object.keys(e),r=Object.keys(t);let a=!0;const o=n.reduce(((n,o)=>{const i=r.indexOf(o)>-1?ia(e[o],t[o]):e[o];return void 0===i||(a=!1,n[o]=i),n}),{});return r.forEach((e=>{n.indexOf(e)>-1||(a=!1,o[e]=void 0)})),a?void 0:o}function la(e,t,n){if(Array.isArray(t))return aa(t);if(null==e||"object"!=typeof e||Array.isArray(e)||null==t||"object"!=typeof t)return aa(void 0!==t?t:e);const r=Object.keys(e).concat(Object.keys(t).filter((t=>!(t in e)))).reduce(((r,a)=>(r[a]=la(e[a],t[a],n),r)),{});if(!n)return r;const a=Object.keys(t);return Object.keys(e).forEach((e=>{a.indexOf(e)>-1||delete r[e]})),r}const sa=e=>{if(void 0===e||!Array.isArray(e)||3!==e.length)return[e,"",0];const[t,n,r]=e;return"string"==typeof t&&"number"==typeof n?[r,t,n]:[e,"",0]};class ca{constructor(e,t,n,r,a,o,i){this.container=e,this.storage=t,this.isolated=n,this.plain=r,this.timeout=a?Math.max(a,500):1e3,this.resetState=i,this.store=this._instantiateStore(),this.state=null,this.id=ra(),this.tmstamp=0,this.outdted=[],"function"==typeof o&&(this.lisner=o),this.lisners=[],this.getState=this.getState.bind(this),this.subscribe=this.subscribe.bind(this),this.dispatch=this.dispatch.bind(this),this.replaceReducer=this.replaceReducer.bind(this),this[Symbol.observable]=this[Symbol.observable].bind(this)}init(){this.tmstamp||this.isolated||this.storage.subscribe(((e,t)=>{const[n,r,a]=sa(e);if(r===this.id||oa(n,this.state))return;const o=a>=this.tmstamp,i=o?la(this.state,n,!0):la(n,this.state,!0);!o&&oa(i,this.state)||(this._setState(i,a),this._renewStore(),oa(i,n)||this._send2Storage(),this._callListeners())}));const e=this.store.getState();return new Promise((t=>{this.storage.load((n=>{const[r,,a]=sa(n);let o=r?la(e,r):e;this.resetState&&(o=la(o,this.resetState)),this._setState(o,a),this._renewStore(),oa(o,r)||this._send2Storage(),t(this)}))}))}initFrom(e){return this._setState(e,0),this._renewStore(),this}_setState(e,t){this.state=aa(e),(t=void 0!==t?t:Date.now())>this.tmstamp&&(this.tmstamp=t)}_renewStore(){this.plain?this.unsub&&this.unsub():this._clean();const e=this.store=this._instantiateStore(this.state),t=Date.now(),n=this.outdted.length;this.outdted=this.outdted.map((([e,r],a)=>e||a>=n-1?[e,r]:[t,r]));let r=aa(this.state);const a=this.store.subscribe((()=>{const t=e&&e.getState(),n=this.store===e;if(this._clean(),!oa(t,this.state)){if(n)this._setState(t);else{const e=ia(t,r);if(void 0===e)return;this._setState(la(this.state,e)),this._renewStore()}this._send2Storage(),this._callListeners(!0,r),r=aa(t)}}));this.plain?this.unsub=a:this.outdted.push([0,a])}_clean(){if(this.plain)return;const e=Date.now(),t=this.outdted.length;this.outdted.forEach((([n,r],a)=>{a>=t-1||e-n<this.timeout||(r(),delete this.outdted[a])}))}_instantiateStore(e){const t=this.container(e);if("object"!=typeof t||"function"!=typeof t.getState)throw new Error("Invalid 'storeCreatorContainer' supplied");return t}_send2Storage(){var e,t,n;this.storage.save((e=this.state,t=this.id,n=this.tmstamp,[t,n,e]))}_callListeners(e,t){e&&this.lisner&&this.lisner(this,t);for(const e of this.lisners)e()}getState(){return this.state}subscribe(e){return"function"==typeof e&&this.lisners.push(e),()=>{"function"==typeof e&&(this.lisners=this.lisners.filter((t=>t!==e)))}}dispatch(e){return this.store.dispatch(e)}replaceReducer(e){return"function"==typeof e&&this.store.replaceReducer(e),this}[Symbol.observable](){const e=this.getState,t=this.subscribe;return{subscribe(n){if("object"!=typeof n||null===n)throw new TypeError("Expected the observer to be an object.");function r(){const t=n;t.next&&t.next(e())}r();return{unsubscribe:t(r)}},[Symbol.observable](){return this}}}}var ua;!function(e){e.local="local",e.sync="sync"}(ua||(ua={}));const da=e=>(new TextEncoder).encode(Object.entries(e).map((([e,t])=>e+JSON.stringify(t))).join("")).length;class pa{constructor({namespace:e,area:t,key:n}){this.ns=e,this.areaName=t===ua.sync?ua.sync:ua.local,this.key=n||"reduxed",this.listeners=[],this.errListeners=[]}regShared(){this.regListener(((e,t)=>{for(const n of this.listeners)n(e,t)}))}regListener(e){this.ns.storage.onChanged.addListener(((t,n)=>{if(n!==this.areaName||!(this.key in t))return;const{newValue:r,oldValue:a}=t[this.key];r&&e(r,a)}))}subscribe(e){"function"==typeof e&&this.listeners.push(e)}subscribeForError(e){"function"==typeof e&&this.errListeners.push(e)}fireErrorListeners(e,t){for(const n of this.errListeners)n(e,t)}callbackOnLoad(e,t,n){t(!this.ns.runtime.lastError&&(n?e:e&&e[this.key]))}callbackOnSave(e,t){if(!this.ns.runtime.lastError)return;const{message:n}=this.ns.runtime.lastError;if(!n||!e||!t)return void this.fireErrorListeners(n||"",!1);this.areaName===ua.sync&&t.QUOTA_BYTES_PER_ITEM&&da({[this.key]:e})>t.QUOTA_BYTES_PER_ITEM?this.fireErrorListeners(n,!0):this.load((r=>{const a="object"==typeof r&&t.QUOTA_BYTES>0&&da(Object.assign(Object.assign({},r),{[this.key]:e}))>t.QUOTA_BYTES;this.fireErrorListeners(n,a)}),!0)}}class fa extends pa{constructor({namespace:e,area:t,key:n}){super({namespace:e,area:t,key:n}),this.areaApi=this.ns.storage[this.areaName]}load(e,t){"function"==typeof e&&this.areaApi.get(t?null:this.key,(n=>{this.callbackOnLoad(n,e,t)}))}save(e){this.areaApi.set({[this.key]:e},(()=>{this.callbackOnSave(e,this.areaApi)}))}}class ha extends pa{constructor({namespace:e,area:t,key:n}){super({namespace:e,area:t,key:n}),this.areaApi=this.ns.storage[this.areaName]}load(e,t){"function"==typeof e&&this.areaApi.get(t?null:this.key).then((t=>{this.callbackOnLoad(t,e)}))}save(e){this.areaApi.set({[this.key]:e}).then((()=>{this.callbackOnSave(e,this.areaApi)}))}}var ga;function ma(e){return ma="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ma(e)}function va(e){var t=function(e,t){if("object"!==ma(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==ma(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===ma(t)?t:String(t)}function ya(e,t,n){return(t=va(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ba(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ba(Object(n),!0).forEach((function(t){ya(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ba(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function wa(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}!function(e){e.chrome="chrome",e.browser="browser"}(ga||(ga={}));var Sa="function"==typeof Symbol&&Symbol.observable||"@@observable",ka=function(){return Math.random().toString(36).substring(7).split("").join(".")},Ca={INIT:"@@redux/INIT"+ka(),REPLACE:"@@redux/REPLACE"+ka(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+ka()}};function Ea(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function Aa(e,t,n){var r;if("function"==typeof t&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw new Error(wa(0));if("function"==typeof t&&void 0===n&&(n=t,t=void 0),void 0!==n){if("function"!=typeof n)throw new Error(wa(1));return n(Aa)(e,t)}if("function"!=typeof e)throw new Error(wa(2));var a=e,o=t,i=[],l=i,s=!1;function c(){l===i&&(l=i.slice())}function u(){if(s)throw new Error(wa(3));return o}function d(e){if("function"!=typeof e)throw new Error(wa(4));if(s)throw new Error(wa(5));var t=!0;return c(),l.push(e),function(){if(t){if(s)throw new Error(wa(6));t=!1,c();var n=l.indexOf(e);l.splice(n,1),i=null}}}function p(e){if(!Ea(e))throw new Error(wa(7));if(void 0===e.type)throw new Error(wa(8));if(s)throw new Error(wa(9));try{s=!0,o=a(o,e)}finally{s=!1}for(var t=i=l,n=0;n<t.length;n++){(0,t[n])()}return e}return p({type:Ca.INIT}),(r={dispatch:p,subscribe:d,getState:u,replaceReducer:function(e){if("function"!=typeof e)throw new Error(wa(10));a=e,p({type:Ca.REPLACE})}})[Sa]=function(){var e,t=d;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new Error(wa(11));function n(){e.next&&e.next(u())}return n(),{unsubscribe:t(n)}}})[Sa]=function(){return this},e},r}function Ta(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}function Ia(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return function(){var n=e.apply(void 0,arguments),r=function(){throw new Error(wa(15))},a={getState:n.getState,dispatch:function(){return r.apply(void 0,arguments)}},o=t.map((function(e){return e(a)}));return r=Ta.apply(void 0,o)(n.dispatch),xa(xa({},n),{},{dispatch:r})}}}function za(e){return function(t){var n=t.dispatch,r=t.getState;return function(t){return function(a){return"function"==typeof a?a(n,r,e):t(a)}}}}var Fa=za();Fa.withExtraArgument=za;const Ma=Fa;var ja=function(){return ja=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},ja.apply(this,arguments)},Ba={decks:[],deckId:""};var Ra=function(){return Ra=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},Ra.apply(this,arguments)},Oa=function(e,t,n){if(n||2===arguments.length)for(var r,a=0,o=t.length;a<o;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))},La=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},Na=Ra({savedCards:[],storedCards:[],text:"",translation:"",examples:[],image:null,imageUrl:null,error:void 0,back:null,front:"",currentCardId:null,linguisticInfo:"",transcription:"",isGeneratingCard:!1,lastDraftCard:null}),Pa=function(e){if(e instanceof Date)return e;if("string"==typeof e||"number"==typeof e){var t=new Date(e);if(!Number.isNaN(t.getTime()))return t}return new Date},_a=function(e){return e.length?e.reduce((function(e,t){var n=Pa(e.createdAt),r=Pa(t.createdAt);return r.getTime()>=n.getTime()?Ra(Ra({},t),{createdAt:r}):e}),Ra(Ra({},e[0]),{createdAt:Pa(e[0].createdAt)})):null};const Da=function(e,t){var n,r,a,o,i,l,s,c,u,d;void 0===e&&(e=Na);var p=Ra({},e);switch(t.type){case se:p.savedCards=Oa(Oa([],e.savedCards,!0),t.payload,!0);break;case me:La("*** REDUCER: SAVE_CARD_TO_STORAGE action received ***"),La("Action payload raw:",t.payload),La("Action payload image data:",{hasImage:!!t.payload.image,hasImageUrl:!!t.payload.imageUrl,imageType:typeof t.payload.image,imageUrlType:typeof t.payload.imageUrl,imageValue:t.payload.image,imageUrlValue:t.payload.imageUrl,imageUndefinedCheck:void 0!==t.payload.image,imageUrlUndefinedCheck:void 0!==t.payload.imageUrl});var f=Ra(Ra({},t.payload.id?t.payload:Ra(Ra({},t.payload),{id:Date.now().toString()})),{image:void 0!==t.payload.image?t.payload.image:null,imageUrl:void 0!==t.payload.imageUrl?t.payload.imageUrl:null,exportStatus:t.payload.exportStatus||"not_exported",linguisticInfo:t.payload.linguisticInfo||"",transcription:t.payload.transcription||""}),h=Ra(Ra({},f),{createdAt:Pa(f.createdAt)});La("REDUCER: Final card object created:",{cardId:h.id,hasImage:!!h.image,hasImageUrl:!!h.imageUrl,imageType:typeof h.image,imageUrlType:typeof h.imageUrl,imageLength:null===(n=h.image)||void 0===n?void 0:n.length,imageUrlLength:null===(r=h.imageUrl)||void 0===r?void 0:r.length,imageActualValue:h.image,imageUrlActualValue:h.imageUrl,imagePreview:null===(a=h.image)||void 0===a?void 0:a.substring(0,50),imageUrlPreview:null===(o=h.imageUrl)||void 0===o?void 0:o.substring(0,50)});var g=e.storedCards.find((function(e){return e.id===h.id}));g?(p.storedCards=e.storedCards.map((function(e){return e.id===g.id?Ra(Ra({},h),{id:g.id}):e})),La("Updated existing card with ID:",h.id,"text:",h.text)):(p.storedCards=Oa(Oa([],e.storedCards,!0),[h],!1),La("Added new card with ID:",h.id,"text:",h.text),La("Total stored cards after addition:",p.storedCards.length)),p.lastDraftCard=h;break;case xe:p.storedCards=e.storedCards.map((function(e){return e.id===t.payload.cardId?Ra(Ra({},e),{exportStatus:t.payload.status}):e}));break;case we:if(La("*** REDUCER: UPDATE_STORED_CARD action received ***"),La("Update payload image info:",{cardId:t.payload.id,hasImage:!!t.payload.image,hasImageUrl:!!t.payload.imageUrl,imageType:typeof t.payload.image,imageUrlType:typeof t.payload.imageUrl,imageValue:t.payload.image,imageUrlValue:t.payload.imageUrl,imageLength:null===(i=t.payload.image)||void 0===i?void 0:i.length,imageUrlLength:null===(l=t.payload.imageUrl)||void 0===l?void 0:l.length}),!t.payload.id)return console.error("Cannot update card without ID"),e;if(e.storedCards.some((function(e){return e.id===t.payload.id})))p.storedCards=e.storedCards.map((function(e){var n;return e.id===t.payload.id?Ra(Ra(Ra({},e),t.payload),{createdAt:Pa(null!==(n=t.payload.createdAt)&&void 0!==n?n:e.createdAt),exportStatus:t.payload.exportStatus||e.exportStatus,linguisticInfo:t.payload.linguisticInfo||e.linguisticInfo,transcription:t.payload.transcription||e.transcription}):e})),La("UPDATE_STORED_CARD: Updated existing card with ID:",t.payload.id,"image:",!!t.payload.image);else{var m=Ra(Ra({},t.payload),{createdAt:Pa(t.payload.createdAt),exportStatus:t.payload.exportStatus||"not_exported",linguisticInfo:t.payload.linguisticInfo||"",transcription:t.payload.transcription||""});p.storedCards=Oa(Oa([],e.storedCards,!0),[m],!1),La("UPDATE_STORED_CARD: Added new card with ID:",t.payload.id,"image:",!!m.image)}p.lastDraftCard=_a(p.storedCards);break;case ve:break;case be:var v=(t.payload||[]).map((function(e){return Ra(Ra({},e),{createdAt:Pa(e.createdAt)})}));p.storedCards=v;break;case ye:p.storedCards=e.storedCards.filter((function(e){return e.id!==t.payload})),p.lastDraftCard=_a(p.storedCards);break;case ce:p.text=t.payload,""!==t.payload&&""!==t.payload.trim()||(La("Text cleared completely, also clearing images"),p.image=null,p.imageUrl=null);break;case ue:p.translation=t.payload;break;case de:p.examples=t.payload;break;case pe:La("*** REDUCER: SET_IMAGE called with:",{hasPayload:!!t.payload,payloadType:typeof t.payload,payloadLength:null===(s=t.payload)||void 0===s?void 0:s.length,payloadPreview:null===(c=t.payload)||void 0===c?void 0:c.substring(0,50)}),p.image=t.payload;break;case fe:return La("*** REDUCER: SET_IMAGE_URL called with:",{hasPayload:!!t.payload,payloadType:typeof t.payload,payloadLength:null===(u=t.payload)||void 0===u?void 0:u.length,payloadPreview:null===(d=t.payload)||void 0===d?void 0:d.substring(0,50)}),Ra(Ra({},e),{imageUrl:t.payload});case he:return Ra(Ra({},e),{back:t.payload});case ge:return Ra(Ra({},e),{front:t.payload});case Se:return Ra(Ra({},e),{currentCardId:t.payload});case ke:return Ra(Ra({},e),{linguisticInfo:t.payload});case Ce:return Ra(Ra({},e),{transcription:t.payload});case Ee:return Ra(Ra({},e),{isGeneratingCard:t.payload});case Ae:return Ra(Ra({},e),{lastDraftCard:t.payload?Ra(Ra({},t.payload),{createdAt:Pa(t.payload.createdAt)}):null});default:return e}return p};const qa=function(e,t){return void 0===e&&(e="createCard"),"SET_CURRENT_PAGE"===t.type?t.currentPage:e};var Ua=function(){return Ua=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},Ua.apply(this,arguments)},$a={isAnkiAvailable:!1};const Ha=function(e,t){return void 0===e&&(e=$a),t.type===tr?Ua(Ua({},e),{isAnkiAvailable:t.payload}):e};var Va=function(){return Va=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},Va.apply(this,arguments)},Ga={globalState:{isVisible:!1,lastToggleTime:Date.now()},tabStates:{},inheritanceSettings:{enabled:!0,mode:"lastActive"}},Wa=function(e,t){return e.tabStates[t]||{isVisible:e.globalState.isVisible,lastToggleTime:Date.now()}};const Ya=function(e,t){var n,r,a;switch(void 0===e&&(e=Ga),t.type){case pr:var o=t.payload||{},i=o.tabId,l=o.persist,s=void 0===l||l,c=Date.now();if(i){var u=!(g=Wa(e,i)).isVisible,d=Va(Va({},e),{tabStates:Va(Va({},e.tabStates),(n={},n[i]=Va(Va({},g),{isVisible:u,lastToggleTime:c}),n))});return s&&(d.globalState=Va(Va({},e.globalState),{isVisible:u,lastActiveTabId:i,lastToggleTime:c})),d}return Va(Va({},e),{globalState:Va(Va({},e.globalState),{isVisible:!e.globalState.isVisible,lastToggleTime:c})});case fr:var p=t.payload,f=p.isVisible,h=(i=p.tabId,p.persist);s=void 0===h||h,c=Date.now();if(i){var g=Wa(e,i);d=Va(Va({},e),{tabStates:Va(Va({},e.tabStates),(r={},r[i]=Va(Va({},g),{isVisible:f,lastToggleTime:c}),r))});return s&&(d.globalState=Va(Va({},e.globalState),{isVisible:f,lastActiveTabId:i,lastToggleTime:c})),d}return Va(Va({},e),{globalState:Va(Va({},e.globalState),{isVisible:f,lastToggleTime:c})});case hr:var m=t.payload,v=(f=m.isVisible,m.lastActiveTabId);return Va(Va({},e),{globalState:Va(Va({},e.globalState),{isVisible:f,lastActiveTabId:v||e.globalState.lastActiveTabId,lastToggleTime:Date.now()})});case gr:var y=t.payload,b=y.fromTabId,x=y.toTabId,w=void 0,S=void 0;return b&&e.tabStates[b]?(w=e.tabStates[b].isVisible,S=b):(w=function(e){return e.globalState.lastActiveTabId&&e.tabStates[e.globalState.lastActiveTabId]?e.tabStates[e.globalState.lastActiveTabId].isVisible:e.globalState.isVisible}(e),S=e.globalState.lastActiveTabId),Va(Va({},e),{tabStates:Va(Va({},e.tabStates),(a={},a[x]={isVisible:w,inheritedFrom:S,lastToggleTime:Date.now()},a))});default:return e}};var Ka=function(){return Ka=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},Ka.apply(this,arguments)},Xa=function(e,t,n){if(n||2===arguments.length)for(var r,a=0,o=t.length;a<o;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))},Qa={notifications:[]};const Ja=function(e,t){switch(void 0===e&&(e=Qa),t.type){case mr:return e.notifications.find((function(e){return e.message===t.payload.message&&e.type===t.payload.type}))?e:Ka(Ka({},e),{notifications:Xa(Xa([],e.notifications,!0),[t.payload],!1)});case vr:return Ka(Ka({},e),{notifications:e.notifications.filter((function(e){return e.id!==t.payload.id}))});default:return e}};var Za=function(){return Za=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},Za.apply(this,arguments)},eo=function(e,t,n){if(n||2===arguments.length)for(var r,a=0,o=t.length;a<o;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))},to={currentTabId:null,tabStates:{}};const no=function(e,t){var n,r,a,o,i,l,s,c,u,d;void 0===e&&(e=to);var p=Za({},e);switch(t.type){case F:var f=t.payload;p.currentTabId=f,f&&!p.tabStates[f]&&(p.tabStates=Za(Za({},p.tabStates),((n={})[f]=function(e){return{cardData:{text:"",translation:"",examples:[],image:null,imageUrl:null,front:"",back:null,linguisticInfo:"",transcription:"",isGeneratingCard:!1,currentCardId:null},storedCards:[],fieldIdPrefix:"tab_".concat(e,"_").concat(Date.now(),"_"),currentPage:"createCard"}}(f),n)));break;case M:var h=t.payload,g=h.tabId,m=h.field,v=h.value;g&&p.tabStates[g]&&(p.tabStates=Za(Za({},p.tabStates),((r={})[g]=Za(Za({},p.tabStates[g]),{cardData:Za(Za({},p.tabStates[g].cardData),(a={},a[m]=v,a))}),r)));break;case j:var y=t.payload.tabId;y&&p.tabStates[y]&&(p.tabStates=Za(Za({},p.tabStates),((o={})[y]=Za(Za({},p.tabStates[y]),{cardData:{text:"",translation:"",examples:[],image:null,imageUrl:null,front:"",back:null,linguisticInfo:"",transcription:"",isGeneratingCard:!1,currentCardId:null}}),o)));break;case B:var b=t.payload,x=b.tabId,w=b.card;if(x&&p.tabStates[x]){var S=p.tabStates[x],k=Za(Za({},w),{id:w.id||"".concat(S.fieldIdPrefix).concat(Date.now()),createdAt:w.createdAt||new Date}),C=S.storedCards.findIndex((function(e){return e.text===k.text})),E=void 0;C>=0?(E=eo([],S.storedCards,!0))[C]=Za(Za({},k),{id:S.storedCards[C].id}):E=eo(eo([],S.storedCards,!0),[k],!1),p.tabStates=Za(Za({},p.tabStates),((i={})[x]=Za(Za({},S),{storedCards:E}),i))}break;case R:var A=t.payload,T=A.tabId,I=A.cardId;if(T&&p.tabStates[T]){S=p.tabStates[T];p.tabStates=Za(Za({},p.tabStates),((l={})[T]=Za(Za({},S),{storedCards:S.storedCards.filter((function(e){return e.id!==I}))}),l))}break;case O:var z=t.payload,_=z.tabId,D=z.cards;_&&p.tabStates[_]&&(p.tabStates=Za(Za({},p.tabStates),((s={})[_]=Za(Za({},p.tabStates[_]),{storedCards:D}),s)));break;case L:var q=t.payload,U=q.tabId,$=q.cardId,H=q.status;if(U&&p.tabStates[U]){S=p.tabStates[U];p.tabStates=Za(Za({},p.tabStates),((c={})[U]=Za(Za({},S),{storedCards:S.storedCards.map((function(e){return e.id===$?Za(Za({},e),{exportStatus:H}):e}))}),c))}break;case N:var V=t.payload,G=V.tabId,W=V.card;if(G&&p.tabStates[G]&&W.id){var Y=(S=p.tabStates[G]).storedCards.some((function(e){return e.id===W.id}));E=void 0;E=Y?S.storedCards.map((function(e){return e.id===W.id?Za({},W):e})):eo(eo([],S.storedCards,!0),[W],!1),p.tabStates=Za(Za({},p.tabStates),((u={})[G]=Za(Za({},S),{storedCards:E}),u))}break;case P:var K=t.payload,X=K.tabId,Q=K.currentPage;X&&p.tabStates[X]&&(p.tabStates=Za(Za({},p.tabStates),((d={})[X]=Za(Za({},p.tabStates[X]),{currentPage:Q}),d)))}return p};var ro,ao=function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++){var a=t[r];0,"function"==typeof e[a]&&(n[a]=e[a])}var o,i=Object.keys(n);try{!function(e){Object.keys(e).forEach((function(t){var n=e[t];if(void 0===n(void 0,{type:Ca.INIT}))throw new Error(wa(12));if(void 0===n(void 0,{type:Ca.PROBE_UNKNOWN_ACTION()}))throw new Error(wa(13))}))}(n)}catch(e){o=e}return function(e,t){if(void 0===e&&(e={}),o)throw o;for(var r=!1,a={},l=0;l<i.length;l++){var s=i[l],c=n[s],u=e[s],d=c(u,t);if(void 0===d){t&&t.type;throw new Error(wa(14))}a[s]=d,r=r||d!==u}return(r=r||i.length!==Object.keys(e).length)?a:e}}({deck:function(e,t){switch(void 0===e&&(e=Ba),t.type){case rr:return ja(ja({},e),{decks:t.payload});case ar:return ja(ja({},e),{deckId:t.payload});default:return e}},cards:Da,settings:Pt.W,currentPage:qa,anki:Ha,sidebar:Ya,notifications:Ja,tabState:no,view:function(e,t){var n,r,a,o,i;switch(void 0===e&&(e=Tr),t.type){case kr:return wr(wr(wr({},e),t.payload),{globalMode:null!==(i=null!==(o=t.payload.globalMode)&&void 0!==o?o:e.globalMode)&&void 0!==i?i:"sidebar",globalVisible:"boolean"==typeof t.payload.globalVisible?t.payload.globalVisible:"boolean"!=typeof e.globalVisible||e.globalVisible});case Cr:var l=t.payload,s=l.tabId,c=l.mode;return wr(wr({},e),{preferredModeByTab:wr(wr({},e.preferredModeByTab),(n={},n[s]=c,n)),globalMode:c});case Er:var u=t.payload,d=(s=u.tabId,u.visible);return wr(wr({},e),{visibleByTab:wr(wr({},e.visibleByTab),(r={},r[s]=d,r)),globalVisible:d});case Ar:var p=t.payload,f=(s=p.tabId,p.geometry);return wr(wr({},e),{floatGeometryByTab:wr(wr({},e.floatGeometryByTab),(a={},a[s]=f,a))});default:return e}}}),oo=function(e,t,n){const{namespace:r,chromeNs:a,browserNs:o,storageArea:i,storageKey:l,isolated:s,plainActions:c,outdatedTimeout:u}=t||{},{onGlobalChange:d,onLocalChange:p,onError:f}=n||{};if("function"!=typeof e)throw new Error("Missing argument for 'storeCreatorContainer'");const h=o||r===ga.browser?new ha({namespace:o||browser,area:i,key:l}):new fa({namespace:a||chrome,area:i,key:l});return"function"==typeof d&&h.regListener(((t,n)=>{const r=new ca(e,h,!0,c),[a]=sa(t),[o]=sa(n);d(r.initFrom(a),o)})),s||h.regShared(),t=>{f&&h.subscribeForError(f);return new ca(e,h,s,c,u,p,t).init()}}((function(e){return Aa(ao,e,Ia(Ma,Mn))})),io=function(){return io=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},io.apply(this,arguments)},lo=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function l(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((r=r.apply(e,t||[])).next())}))},so=function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(s){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&l[0]?r.return:l[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,l[1])).done)return a;switch(r=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,r=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],r=0}finally{n=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}},co="anki_api_keys_v1",uo={openai:"",groq:"",anki:""},po=null,fo=function(e){return io({},e)},ho=function(e){if(!e||"object"!=typeof e)return fo(uo);var t=e;return{openai:"string"==typeof t.openai?t.openai:"",groq:"string"==typeof t.groq?t.groq:"",anki:"string"==typeof t.anki?t.anki:""}},go=function(){var e;try{if("undefined"!=typeof chrome&&(null===(e=null===chrome||void 0===chrome?void 0:chrome.storage)||void 0===e?void 0:e.local))return chrome.storage.local}catch(e){console.error("Unable to access chrome.storage.local:",e)}return null},mo=function(){try{if("undefined"!=typeof window&&window.localStorage){var e=window.localStorage.getItem(co);if(e)return ho(JSON.parse(e))}}catch(e){console.error("Failed to read API keys from localStorage:",e)}return fo(uo)},vo=function(e){try{"undefined"!=typeof window&&window.localStorage&&window.localStorage.setItem(co,JSON.stringify(e))}catch(e){console.error("Failed to write API keys to localStorage:",e)}},yo=function(e){return lo(void 0,void 0,void 0,(function(){var t;return so(this,(function(n){switch(n.label){case 0:return(t=go())?[4,new Promise((function(n){var r;try{t.set(((r={})[co]=e,r),(function(){var e,t=null===(e=null===chrome||void 0===chrome?void 0:chrome.runtime)||void 0===e?void 0:e.lastError;t&&console.error("Failed to save API keys to chrome storage:",t),n()}))}catch(e){console.error("Failed to access chrome storage while saving API keys:",e),n()}}))]:[2];case 1:return n.sent(),[2]}}))}))},bo=function(e){return lo(void 0,void 0,void 0,(function(){return so(this,(function(t){switch(t.label){case 0:return po=fo(e),vo(e),[4,yo(e)];case 1:return t.sent(),[2]}}))}))},xo=function(e){var t;return{openai:e.settings.openAiKey||"",groq:e.settings.groqApiKey||"",anki:null!==(t=e.settings.ankiConnectApiKey)&&void 0!==t?t:""}};console.log("Content script works!"),console.log("Must reload extension for modifications to take effect."),ro="Using the 'printLine' function from the Print Module",console.log("===> FROM THE PRINT MODULE:",ro);const wo=document.createElement("div");wo.id="sidebar",wo.setAttribute("style","\n  all: initial;\n  position: fixed;\n  top: 0;\n  right: 0;\n  width: 350px;\n  height: 100%;\n  overflow: auto;\n  z-index: 2147483645; /* \u043d\u0438\u0436\u0435 \u043f\u043b\u0430\u0432\u0430\u044e\u0449\u0435\u0433\u043e \u043e\u043a\u043d\u0430 */\n  background-color: #ffffff;\n  box-shadow: -2px 0 5px rgba(0, 0, 0, 0.15);\n  transform: translateX(100%); /* \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u0441\u043a\u0440\u044b\u0442\u043e */\n  transition: transform 0.3s ease-in-out;\n");const So=wo.attachShadow({mode:"open"}),ko=document.createElement("link");ko.setAttribute("rel","stylesheet"),ko.setAttribute("href",chrome.runtime.getURL("tailwind.css")),So.appendChild(ko),document.body.appendChild(wo);const Co=(0,a.H)(So),Eo=()=>r.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",background:"linear-gradient(135deg, #2563EB 0%, #1D4ED8 100%)",fontFamily:"system-ui, -apple-system, sans-serif",color:"#ffffff"}},[r.createElement("div",{key:"logo",style:{width:"48px",height:"48px",background:"rgba(255,255,255,0.2)",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:"24px",animation:"pulse 2s ease-in-out infinite"}},"\u{1f9e0}"),r.createElement("div",{key:"spinner",style:{width:"32px",height:"32px",border:"2px solid rgba(255,255,255,0.3)",borderTop:"2px solid #ffffff",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:"20px"}}),r.createElement("h2",{key:"title",style:{color:"#ffffff",fontSize:20,fontWeight:700,marginBottom:8,textAlign:"center"}},"Anki Flash Cards"),r.createElement("p",{key:"subtitle",style:{color:"rgba(255,255,255,0.8)",fontSize:14,textAlign:"center"}},"Initializing your learning assistant..."),r.createElement("div",{key:"progress-bar",style:{width:200,height:2,backgroundColor:"rgba(255,255,255,0.3)",borderRadius:1,marginTop:24,overflow:"hidden"}},r.createElement("div",{style:{width:"100%",height:"100%",backgroundColor:"#ffffff",animation:"progressBar 2s ease-in-out infinite"}})),r.createElement("style",{key:"styles"},"\n      @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }\n      @keyframes pulse { 0%,100% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.05); opacity: 0.8; } }\n      @keyframes progressBar { 0% { transform: translateX(-100%); } 50% { transform: translateX(0%); } 100% { transform: translateX(100%); } }\n    ")]),Ao="anki_view_prefs_v1",To=e=>new Promise((t=>{chrome.storage.local.get([Ao],(n=>{const r=(a=n[Ao],{preferredModeByTab:{...a?.preferredModeByTab||{}},visibleByTab:{...a?.visibleByTab||{}},floatGeometryByTab:{...a?.floatGeometryByTab||{}},globalMode:"float"===a?.globalMode?"float":"sidebar",globalVisible:"boolean"!=typeof a?.globalVisible||a.globalVisible});var a;const o=e(r)||r;chrome.storage.local.set({[Ao]:o},(()=>t(o)))}))}));function Io(){this.prefix="anki_ui_tab_"}Io.prototype.key=function(e){return this.prefix+String(e)},Io.prototype.get=function(e){const t=this.key(e);return new Promise((e=>{chrome.storage.local.get([t,Ao],(n=>{const r=n[t];if(r)return void e(r);const a=n[Ao]||{},o="float"===a.globalMode?"floating":"sidebar",i="boolean"!=typeof a.globalVisible||a.globalVisible;e({sidebarVisible:"sidebar"===o&&i,floatingVisible:"floating"===o&&i,preferredMode:o})}))}))},Io.prototype.set=function(e,t){const n=this.key(e);return new Promise((e=>{chrome.storage.local.get([n],(r=>{const a={...r[n]||{sidebarVisible:!1,floatingVisible:!1,preferredMode:"sidebar"},...t};chrome.storage.local.set({[n]:a},(()=>e(a)))}))}))};const zo=new Io,Fo=()=>{wo.removeAttribute("hidden"),wo.style.removeProperty("display"),wo.style.removeProperty("visibility"),wo.style.removeProperty("opacity"),wo.style.transform="translateX(0)",document.body.style.marginRight="350px"},Mo=()=>{wo.style.transform="translateX(100%)",document.body.style.marginRight="0"},jo=e=>{e?Fo():Mo()},Bo=()=>{const[e,t]=(0,r.useState)(null),[n,a]=(0,r.useState)(!0),[o,i]=(0,r.useState)(null),l=(0,r.useRef)(null);return(0,r.useEffect)((()=>{let e=!0;return(async()=>{try{chrome.runtime.sendMessage({action:"getTabId"},(async t=>{if(!e)return;const n=t&&void 0!==t.tabId?t.tabId:Math.floor(1e6*Math.random());i(n);try{const e=await zo.get(n);jo(e.sidebarVisible)}catch(e){console.error("Error reading initial UI state:",e),jo(!1)}}));const n=await oo();if(!e)return;t(n);try{const t=await function(e){return lo(void 0,void 0,void 0,(function(){var t,n,r,a,o,i,l,s;return so(this,(function(c){switch(c.label){case 0:return[4,lo(void 0,void 0,void 0,(function(){var e,t,n;return so(this,(function(r){switch(r.label){case 0:return po?[2,fo(po)]:(e=go())?[4,new Promise((function(t){try{e.get([co],(function(e){var n,r=null===(n=null===chrome||void 0===chrome?void 0:chrome.runtime)||void 0===n?void 0:n.lastError;if(r)return console.error("Failed to load API keys from chrome storage:",r),void t(mo());t(ho(null==e?void 0:e[co]))}))}catch(e){console.error("Failed to access chrome storage for API keys:",e),t(mo())}}))]:(t=mo(),po=t,[2,fo(t)]);case 1:return n=r.sent(),po=n,vo(n),[2,fo(n)]}}))}))];case 1:return t=c.sent(),n=e.getState(),t.openai!==n.settings.openAiKey&&e.dispatch((0,Ye.Wy)(t.openai)),t.groq!==n.settings.groqApiKey&&e.dispatch((0,Ye.H1)(t.groq)),r=null!==(s=n.settings.ankiConnectApiKey)&&void 0!==s?s:"",t.anki!==r&&e.dispatch((0,Ye.Zm)(t.anki||null)),a=xo(e.getState()),[4,bo(a)];case 2:return c.sent(),o=Promise.resolve(),i=function(e){o=o.then((function(){return bo(e)})).catch((function(e){console.error("Failed to persist API keys:",e)}))},l=e.subscribe((function(){var t,n,r=xo(e.getState());n=a,((t=r).openai!==n.openai||t.groq!==n.groq||t.anki!==n.anki)&&(a=r,i(r))})),[2,function(){l()}]}}))}))}(n);e?l.current=t:"function"==typeof t&&t()}catch(e){console.error("Failed to initialize API key persistence:",e)}setTimeout((()=>a(!1)),100)}catch(e){console.error("Error initializing store:",e),a(!1)}})(),()=>{e=!1,l.current&&(l.current(),l.current=null)}}),[]),n||!e||null===o?r.createElement(Eo):r.createElement(w,{store:e},r.createElement(Kr,{tabId:o}))};Co.render(r.createElement(Bo)),chrome.runtime.onMessage.addListener(((e,t,n)=>{if(e&&e.action){if("toggleSidebar"===e.action){const t=e.tabId;return t?(zo.get(t).then((e=>{const r=!e.sidebarVisible;jo(r),zo.set(t,{sidebarVisible:r}).then((()=>{To((e=>(e.visibleByTab[t]=r,r&&(e.preferredModeByTab[t]="sidebar",e.globalMode="sidebar"),e.globalVisible=r,e))).finally((()=>{n&&n({status:"Sidebar toggled",visible:r,tabId:t})}))}))})),!0):(n&&n({status:"error",message:"Unknown tab ID"}),!0)}if("collapseSidebar"===e.action||"forceHideSidebar"===e.action){const t=e.tabId;return t&&(zo.set(t,{sidebarVisible:!1}),To((e=>(e.visibleByTab[t]=!1,e.globalVisible=!1,e)))),Mo(),n&&n({ok:!0}),!0}if("expandSidebar"===e.action||"forceShowSidebar"===e.action){const t=e.tabId;return t&&(zo.set(t,{sidebarVisible:!0}),To((e=>(e.visibleByTab[t]=!0,e.preferredModeByTab[t]="sidebar",e.globalVisible=!0,e.globalMode="sidebar",e)))),Fo(),n&&n({ok:!0}),!0}if("setPreferredMode"===e.action){const t=e.tabId,r="floating"===e.mode?"floating":"sidebar";return t&&zo.set(t,{preferredMode:r}),To((e=>(t&&(e.preferredModeByTab[t]="floating"===r?"float":"sidebar"),e.globalMode="floating"===r?"float":"sidebar",e))).finally((()=>{n&&n({ok:!0,preferredMode:r})})),!0}if("syncFloatingState"===e.action){const t=e.tabId,r=!!e.floatingVisible;return t&&zo.set(t,{floatingVisible:r}),t&&To((e=>(e.visibleByTab[t]=r,r&&(e.preferredModeByTab[t]="float",e.globalMode="float"),e.globalVisible=r,e))),n&&n({ok:!0}),!0}if("togglePreferredUI"===e.action){const t=e.tabId;return t?(zo.get(t).then((e=>{if("floating"===(e.preferredMode||"sidebar"))e.floatingVisible?(chrome.runtime.sendMessage({action:"hideFloating",tabId:t},(()=>{})),zo.set(t,{floatingVisible:!1,sidebarVisible:!1}).then((()=>{To((e=>(e.visibleByTab[t]=!1,e.globalVisible=!1,e))).finally((()=>{jo(!1),n&&n({ok:!0,toggled:"floating:off"})}))}))):(chrome.runtime.sendMessage({action:"showFloating",tabId:t},(()=>{})),zo.set(t,{floatingVisible:!0,sidebarVisible:!1}).then((()=>{To((e=>(e.visibleByTab[t]=!0,e.preferredModeByTab[t]="float",e.globalVisible=!0,e.globalMode="float",e))).finally((()=>{jo(!1),n&&n({ok:!0,toggled:"floating:on"})}))})));else{const r=!e.sidebarVisible;jo(r),zo.set(t,{sidebarVisible:r,floatingVisible:!1}).then((()=>{To((e=>(e.visibleByTab[t]=r,r&&(e.preferredModeByTab[t]="sidebar",e.globalMode="sidebar"),e.globalVisible=r,e))).finally((()=>{r&&chrome.runtime.sendMessage({action:"hideFloating",tabId:t},(()=>{})),n&&n({ok:!0,toggled:"sidebar:"+(r?"on":"off")})}))}))}})),!0):(n&&n({status:"error",message:"Unknown tab ID"}),!0)}return"toggleFloating"===e.action||"showFloating"===e.action||"hideFloating"===e.action?(n&&n({ok:!0}),!0):void 0}}))})();