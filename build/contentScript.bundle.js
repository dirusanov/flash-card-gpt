(()=>{"use strict";var e={146:(e,t,n)=>{var r=n(363),o={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},a={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},i={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};function l(e){return r.isMemo(e)?i:s[e.$$typeof]||o}s[r.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},s[r.Memo]=i;var c=Object.defineProperty,u=Object.getOwnPropertyNames,d=Object.getOwnPropertySymbols,f=Object.getOwnPropertyDescriptor,p=Object.getPrototypeOf,g=Object.prototype;e.exports=function e(t,n,r){if("string"!=typeof n){if(g){var o=p(n);o&&o!==g&&e(t,o,r)}var i=u(n);d&&(i=i.concat(d(n)));for(var s=l(t),h=l(n),m=0;m<i.length;++m){var y=i[m];if(!(a[y]||r&&r[y]||h&&h[y]||s&&s[y])){var v=f(n,y);try{c(t,y,v)}catch(e){}}}}return t}},551:(e,t,n)=>{
/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var r=n(540),o=n(982);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,s={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(s[e]=t,e=0;e<t.length;e++)i.add(t[e])}var u=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),d=Object.prototype.hasOwnProperty,f=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},g={};function h(e,t,n,r,o,a,i){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=i}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){m[e]=new h(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];m[t]=new h(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){m[e]=new h(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){m[e]=new h(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){m[e]=new h(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){m[e]=new h(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){m[e]=new h(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){m[e]=new h(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){m[e]=new h(e,5,!1,e.toLowerCase(),null,!1,!1)}));var y=/[\-:]([a-z])/g;function v(e){return e[1].toUpperCase()}function x(e,t,n,r){var o=m.hasOwnProperty(t)?m[t]:null;(null!==o?0!==o.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null==t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,o,r)&&(n=null),r||null===o?function(e){return!!d.call(g,e)||!d.call(p,e)&&(f.test(e)?g[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):o.mustUseProperty?e[o.propertyName]=null===n?3!==o.type&&"":n:(t=o.attributeName,r=o.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(o=o.type)||4===o&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(y,v);m[t]=new h(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(y,v);m[t]=new h(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(y,v);m[t]=new h(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){m[e]=new h(e,1,!1,e.toLowerCase(),null,!1,!1)})),m.xlinkHref=new h("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){m[e]=new h(e,1,!1,e.toLowerCase(),null,!0,!0)}));var b=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for("react.element"),S=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),k=Symbol.for("react.profiler"),I=Symbol.for("react.provider"),A=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),T=Symbol.for("react.suspense"),j=Symbol.for("react.suspense_list"),F=Symbol.for("react.memo"),R=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var O=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var P=Symbol.iterator;function B(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=P&&e[P]||e["@@iterator"])?e:null}var N,L=Object.assign;function z(e){if(void 0===N)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);N=t&&t[1]||""}return"\n"+N+e}var D=!1;function M(e,t){if(!e||D)return"";D=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(e){var r=e}Reflect.construct(e,[],t)}else{try{t.call()}catch(e){r=e}e.call(t.prototype)}else{try{throw Error()}catch(e){r=e}e()}}catch(t){if(t&&r&&"string"==typeof t.stack){for(var o=t.stack.split("\n"),a=r.stack.split("\n"),i=o.length-1,s=a.length-1;1<=i&&0<=s&&o[i]!==a[s];)s--;for(;1<=i&&0<=s;i--,s--)if(o[i]!==a[s]){if(1!==i||1!==s)do{if(i--,0>--s||o[i]!==a[s]){var l="\n"+o[i].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=i&&0<=s);break}}}finally{D=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?z(e):""}function U(e){switch(e.tag){case 5:return z(e.type);case 16:return z("Lazy");case 13:return z("Suspense");case 19:return z("SuspenseList");case 0:case 2:case 15:return e=M(e.type,!1);case 11:return e=M(e.type.render,!1);case 1:return e=M(e.type,!0);default:return""}}function q(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case C:return"Fragment";case S:return"Portal";case k:return"Profiler";case E:return"StrictMode";case T:return"Suspense";case j:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case A:return(e.displayName||"Context")+".Consumer";case I:return(e._context.displayName||"Context")+".Provider";case _:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case F:return null!==(t=e.displayName||null)?t:q(e.type)||"Memo";case R:t=e._payload,e=e._init;try{return q(e(t))}catch(e){}}return null}function W(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return q(t);case 8:return t===E?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t}return null}function V(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function $(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function G(e){e._valueTracker||(e._valueTracker=function(e){var t=$(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var o=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function H(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=$(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function K(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Q(e,t){var n=t.checked;return L({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Y(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=V(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function J(e,t){null!=(t=t.checked)&&x(e,"checked",t,!1)}function X(e,t){J(e,t);var n=V(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,V(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&K(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var o=0;o<n.length;o++)t["$"+n[o]]=!0;for(n=0;n<e.length;n++)o=t.hasOwnProperty("$"+e[n].value),e[n].selected!==o&&(e[n].selected=o),o&&r&&(e[n].defaultSelected=!0)}else{for(n=""+V(n),t=null,o=0;o<e.length;o++){if(e[o].value===n)return e[o].selected=!0,void(r&&(e[o].defaultSelected=!0));null!==t||e[o].disabled||(t=e[o])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return L({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function oe(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(a(92));if(te(n)){if(1<n.length)throw Error(a(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:V(n)}}function ae(e,t){var n=V(t.value),r=V(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function ie(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,de=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return ue(e,t)}))}:ue);function fe(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ge=["Webkit","ms","Moz","O"];function he(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function me(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),o=he(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,o):e[n]=o}}Object.keys(pe).forEach((function(e){ge.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]}))}));var ye=L({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ve(e,t){if(t){if(ye[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(a(62))}}function xe(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var be=null;function we(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Se=null,Ce=null,Ee=null;function ke(e){if(e=bo(e)){if("function"!=typeof Se)throw Error(a(280));var t=e.stateNode;t&&(t=So(t),Se(e.stateNode,e.type,t))}}function Ie(e){Ce?Ee?Ee.push(e):Ee=[e]:Ce=e}function Ae(){if(Ce){var e=Ce,t=Ee;if(Ee=Ce=null,ke(e),t)for(e=0;e<t.length;e++)ke(t[e])}}function _e(e,t){return e(t)}function Te(){}var je=!1;function Fe(e,t,n){if(je)return e(t,n);je=!0;try{return _e(e,t,n)}finally{je=!1,(null!==Ce||null!==Ee)&&(Te(),Ae())}}function Re(e,t){var n=e.stateNode;if(null===n)return null;var r=So(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(a(231,t,typeof n));return n}var Oe=!1;if(u)try{var Pe={};Object.defineProperty(Pe,"passive",{get:function(){Oe=!0}}),window.addEventListener("test",Pe,Pe),window.removeEventListener("test",Pe,Pe)}catch(ue){Oe=!1}function Be(e,t,n,r,o,a,i,s,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(e){this.onError(e)}}var Ne=!1,Le=null,ze=!1,De=null,Me={onError:function(e){Ne=!0,Le=e}};function Ue(e,t,n,r,o,a,i,s,l){Ne=!1,Le=null,Be.apply(Me,arguments)}function qe(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function We(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ve(e){if(qe(e)!==e)throw Error(a(188))}function $e(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=qe(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,r=t;;){var o=n.return;if(null===o)break;var i=o.alternate;if(null===i){if(null!==(r=o.return)){n=r;continue}break}if(o.child===i.child){for(i=o.child;i;){if(i===n)return Ve(o),e;if(i===r)return Ve(o),t;i=i.sibling}throw Error(a(188))}if(n.return!==r.return)n=o,r=i;else{for(var s=!1,l=o.child;l;){if(l===n){s=!0,n=o,r=i;break}if(l===r){s=!0,r=o,n=i;break}l=l.sibling}if(!s){for(l=i.child;l;){if(l===n){s=!0,n=i,r=o;break}if(l===r){s=!0,r=i,n=o;break}l=l.sibling}if(!s)throw Error(a(189))}}if(n.alternate!==r)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(e))?Ge(e):null}function Ge(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ge(e);if(null!==t)return t;e=e.sibling}return null}var He=o.unstable_scheduleCallback,Ke=o.unstable_cancelCallback,Qe=o.unstable_shouldYield,Ye=o.unstable_requestPaint,Je=o.unstable_now,Xe=o.unstable_getCurrentPriorityLevel,Ze=o.unstable_ImmediatePriority,et=o.unstable_UserBlockingPriority,tt=o.unstable_NormalPriority,nt=o.unstable_LowPriority,rt=o.unstable_IdlePriority,ot=null,at=null;var it=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(st(e)/lt|0)|0},st=Math.log,lt=Math.LN2;var ct=64,ut=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ft(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,o=e.suspendedLanes,a=e.pingedLanes,i=268435455&n;if(0!==i){var s=i&~o;0!==s?r=dt(s):0!==(a&=i)&&(r=dt(a))}else 0!==(i=n&~o)?r=dt(i):0!==a&&(r=dt(a));if(0===r)return 0;if(0!==t&&t!==r&&!(t&o)&&((o=r&-r)>=(a=t&-t)||16===o&&4194240&a))return t;if(4&r&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)o=1<<(n=31-it(t)),r|=e[n],t&=~o;return r}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function gt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function ht(){var e=ct;return!(4194240&(ct<<=1))&&(ct=64),e}function mt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function yt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-it(t)]=n}function vt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-it(n),o=1<<r;o&t|e[r]&t&&(e[r]|=t),n&=~o}}var xt=0;function bt(e){return 1<(e&=-e)?4<e?268435455&e?16:536870912:4:1}var wt,St,Ct,Et,kt,It=!1,At=[],_t=null,Tt=null,jt=null,Ft=new Map,Rt=new Map,Ot=[],Pt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Bt(e,t){switch(e){case"focusin":case"focusout":_t=null;break;case"dragenter":case"dragleave":Tt=null;break;case"mouseover":case"mouseout":jt=null;break;case"pointerover":case"pointerout":Ft.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Rt.delete(t.pointerId)}}function Nt(e,t,n,r,o,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[o]},null!==t&&(null!==(t=bo(t))&&St(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==o&&-1===t.indexOf(o)&&t.push(o),e)}function Lt(e){var t=xo(e.target);if(null!==t){var n=qe(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=We(n)))return e.blockedOn=t,void kt(e.priority,(function(){Ct(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function zt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=bo(n))&&St(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);be=r,n.target.dispatchEvent(r),be=null,t.shift()}return!0}function Dt(e,t,n){zt(e)&&n.delete(t)}function Mt(){It=!1,null!==_t&&zt(_t)&&(_t=null),null!==Tt&&zt(Tt)&&(Tt=null),null!==jt&&zt(jt)&&(jt=null),Ft.forEach(Dt),Rt.forEach(Dt)}function Ut(e,t){e.blockedOn===t&&(e.blockedOn=null,It||(It=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,Mt)))}function qt(e){function t(t){return Ut(t,e)}if(0<At.length){Ut(At[0],e);for(var n=1;n<At.length;n++){var r=At[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==_t&&Ut(_t,e),null!==Tt&&Ut(Tt,e),null!==jt&&Ut(jt,e),Ft.forEach(t),Rt.forEach(t),n=0;n<Ot.length;n++)(r=Ot[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Ot.length&&null===(n=Ot[0]).blockedOn;)Lt(n),null===n.blockedOn&&Ot.shift()}var Wt=b.ReactCurrentBatchConfig,Vt=!0;function $t(e,t,n,r){var o=xt,a=Wt.transition;Wt.transition=null;try{xt=1,Ht(e,t,n,r)}finally{xt=o,Wt.transition=a}}function Gt(e,t,n,r){var o=xt,a=Wt.transition;Wt.transition=null;try{xt=4,Ht(e,t,n,r)}finally{xt=o,Wt.transition=a}}function Ht(e,t,n,r){if(Vt){var o=Qt(e,t,n,r);if(null===o)Vr(e,t,r,Kt,n),Bt(e,r);else if(function(e,t,n,r,o){switch(t){case"focusin":return _t=Nt(_t,e,t,n,r,o),!0;case"dragenter":return Tt=Nt(Tt,e,t,n,r,o),!0;case"mouseover":return jt=Nt(jt,e,t,n,r,o),!0;case"pointerover":var a=o.pointerId;return Ft.set(a,Nt(Ft.get(a)||null,e,t,n,r,o)),!0;case"gotpointercapture":return a=o.pointerId,Rt.set(a,Nt(Rt.get(a)||null,e,t,n,r,o)),!0}return!1}(o,e,t,n,r))r.stopPropagation();else if(Bt(e,r),4&t&&-1<Pt.indexOf(e)){for(;null!==o;){var a=bo(o);if(null!==a&&wt(a),null===(a=Qt(e,t,n,r))&&Vr(e,t,r,Kt,n),a===o)break;o=a}null!==o&&r.stopPropagation()}else Vr(e,t,r,null,n)}}var Kt=null;function Qt(e,t,n,r){if(Kt=null,null!==(e=xo(e=we(r))))if(null===(t=qe(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=We(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Kt=e,null}function Yt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Xe()){case Ze:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Jt=null,Xt=null,Zt=null;function en(){if(Zt)return Zt;var e,t,n=Xt,r=n.length,o="value"in Jt?Jt.value:Jt.textContent,a=o.length;for(e=0;e<r&&n[e]===o[e];e++);var i=r-e;for(t=1;t<=i&&n[r-t]===o[a-t];t++);return Zt=o.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function on(e){function t(t,n,r,o,a){for(var i in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=o,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(i)&&(t=e[i],this[i]=t?t(o):o[i]);return this.isDefaultPrevented=(null!=o.defaultPrevented?o.defaultPrevented:!1===o.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return L(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var an,sn,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=on(cn),dn=L({},cn,{view:0,detail:0}),fn=on(dn),pn=L({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:kn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(an=e.screenX-ln.screenX,sn=e.screenY-ln.screenY):sn=an=0,ln=e),an)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),gn=on(pn),hn=on(L({},pn,{dataTransfer:0})),mn=on(L({},dn,{relatedTarget:0})),yn=on(L({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),vn=L({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),xn=on(vn),bn=on(L({},cn,{data:0})),wn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Cn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function En(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Cn[e])&&!!t[e]}function kn(){return En}var In=L({},dn,{key:function(e){if(e.key){var t=wn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Sn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:kn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),An=on(In),_n=on(L({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Tn=on(L({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:kn})),jn=on(L({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Fn=L({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Rn=on(Fn),On=[9,13,27,32],Pn=u&&"CompositionEvent"in window,Bn=null;u&&"documentMode"in document&&(Bn=document.documentMode);var Nn=u&&"TextEvent"in window&&!Bn,Ln=u&&(!Pn||Bn&&8<Bn&&11>=Bn),zn=String.fromCharCode(32),Dn=!1;function Mn(e,t){switch(e){case"keyup":return-1!==On.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Un(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var qn=!1;var Wn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Wn[e.type]:"textarea"===t}function $n(e,t,n,r){Ie(r),0<(t=Gr(t,"onChange")).length&&(n=new un("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Gn=null,Hn=null;function Kn(e){zr(e,0)}function Qn(e){if(H(wo(e)))return e}function Yn(e,t){if("change"===e)return t}var Jn=!1;if(u){var Xn;if(u){var Zn="oninput"in document;if(!Zn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Zn="function"==typeof er.oninput}Xn=Zn}else Xn=!1;Jn=Xn&&(!document.documentMode||9<document.documentMode)}function tr(){Gn&&(Gn.detachEvent("onpropertychange",nr),Hn=Gn=null)}function nr(e){if("value"===e.propertyName&&Qn(Hn)){var t=[];$n(t,Hn,e,we(e)),Fe(Kn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Hn=n,(Gn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function or(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Qn(Hn)}function ar(e,t){if("click"===e)return Qn(t)}function ir(e,t){if("input"===e||"change"===e)return Qn(t)}var sr="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function lr(e,t){if(sr(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var o=n[r];if(!d.call(t,o)||!sr(e[o],t[o]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ur(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function dr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?dr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function fr(){for(var e=window,t=K();t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(e){n=!1}if(!n)break;t=K((e=t.contentWindow).document)}return t}function pr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function gr(e){var t=fr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&dr(n.ownerDocument.documentElement,n)){if(null!==r&&pr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var o=n.textContent.length,a=Math.min(r.start,o);r=void 0===r.end?a:Math.min(r.end,o),!e.extend&&a>r&&(o=r,r=a,a=o),o=ur(n,a);var i=ur(n,r);o&&i&&(1!==e.rangeCount||e.anchorNode!==o.node||e.anchorOffset!==o.offset||e.focusNode!==i.node||e.focusOffset!==i.offset)&&((t=t.createRange()).setStart(o.node,o.offset),e.removeAllRanges(),a>r?(e.addRange(t),e.extend(i.node,i.offset)):(t.setEnd(i.node,i.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"==typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var hr=u&&"documentMode"in document&&11>=document.documentMode,mr=null,yr=null,vr=null,xr=!1;function br(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;xr||null==mr||mr!==K(r)||("selectionStart"in(r=mr)&&pr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},vr&&lr(vr,r)||(vr=r,0<(r=Gr(yr,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=mr)))}function wr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Sr={animationend:wr("Animation","AnimationEnd"),animationiteration:wr("Animation","AnimationIteration"),animationstart:wr("Animation","AnimationStart"),transitionend:wr("Transition","TransitionEnd")},Cr={},Er={};function kr(e){if(Cr[e])return Cr[e];if(!Sr[e])return e;var t,n=Sr[e];for(t in n)if(n.hasOwnProperty(t)&&t in Er)return Cr[e]=n[t];return e}u&&(Er=document.createElement("div").style,"AnimationEvent"in window||(delete Sr.animationend.animation,delete Sr.animationiteration.animation,delete Sr.animationstart.animation),"TransitionEvent"in window||delete Sr.transitionend.transition);var Ir=kr("animationend"),Ar=kr("animationiteration"),_r=kr("animationstart"),Tr=kr("transitionend"),jr=new Map,Fr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Rr(e,t){jr.set(e,t),l(t,[e])}for(var Or=0;Or<Fr.length;Or++){var Pr=Fr[Or];Rr(Pr.toLowerCase(),"on"+(Pr[0].toUpperCase()+Pr.slice(1)))}Rr(Ir,"onAnimationEnd"),Rr(Ar,"onAnimationIteration"),Rr(_r,"onAnimationStart"),Rr("dblclick","onDoubleClick"),Rr("focusin","onFocus"),Rr("focusout","onBlur"),Rr(Tr,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Br="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Nr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Br));function Lr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,o,i,s,l,c){if(Ue.apply(this,arguments),Ne){if(!Ne)throw Error(a(198));var u=Le;Ne=!1,Le=null,ze||(ze=!0,De=u)}}(r,t,void 0,e),e.currentTarget=null}function zr(e,t){t=!!(4&t);for(var n=0;n<e.length;n++){var r=e[n],o=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var i=r.length-1;0<=i;i--){var s=r[i],l=s.instance,c=s.currentTarget;if(s=s.listener,l!==a&&o.isPropagationStopped())break e;Lr(o,s,c),a=l}else for(i=0;i<r.length;i++){if(l=(s=r[i]).instance,c=s.currentTarget,s=s.listener,l!==a&&o.isPropagationStopped())break e;Lr(o,s,c),a=l}}}if(ze)throw e=De,ze=!1,De=null,e}function Dr(e,t){var n=t[mo];void 0===n&&(n=t[mo]=new Set);var r=e+"__bubble";n.has(r)||(Wr(t,e,2,!1),n.add(r))}function Mr(e,t,n){var r=0;t&&(r|=4),Wr(n,e,r,t)}var Ur="_reactListening"+Math.random().toString(36).slice(2);function qr(e){if(!e[Ur]){e[Ur]=!0,i.forEach((function(t){"selectionchange"!==t&&(Nr.has(t)||Mr(t,!1,e),Mr(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Ur]||(t[Ur]=!0,Mr("selectionchange",!1,t))}}function Wr(e,t,n,r){switch(Yt(t)){case 1:var o=$t;break;case 4:o=Gt;break;default:o=Ht}n=o.bind(null,t,n,e),o=void 0,!Oe||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(o=!0),r?void 0!==o?e.addEventListener(t,n,{capture:!0,passive:o}):e.addEventListener(t,n,!0):void 0!==o?e.addEventListener(t,n,{passive:o}):e.addEventListener(t,n,!1)}function Vr(e,t,n,r,o){var a=r;if(!(1&t||2&t||null===r))e:for(;;){if(null===r)return;var i=r.tag;if(3===i||4===i){var s=r.stateNode.containerInfo;if(s===o||8===s.nodeType&&s.parentNode===o)break;if(4===i)for(i=r.return;null!==i;){var l=i.tag;if((3===l||4===l)&&((l=i.stateNode.containerInfo)===o||8===l.nodeType&&l.parentNode===o))return;i=i.return}for(;null!==s;){if(null===(i=xo(s)))return;if(5===(l=i.tag)||6===l){r=a=i;continue e}s=s.parentNode}}r=r.return}Fe((function(){var r=a,o=we(n),i=[];e:{var s=jr.get(e);if(void 0!==s){var l=un,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=An;break;case"focusin":c="focus",l=mn;break;case"focusout":c="blur",l=mn;break;case"beforeblur":case"afterblur":l=mn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=gn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=hn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Tn;break;case Ir:case Ar:case _r:l=yn;break;case Tr:l=jn;break;case"scroll":l=fn;break;case"wheel":l=Rn;break;case"copy":case"cut":case"paste":l=xn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=_n}var u=!!(4&t),d=!u&&"scroll"===e,f=u?null!==s?s+"Capture":null:s;u=[];for(var p,g=r;null!==g;){var h=(p=g).stateNode;if(5===p.tag&&null!==h&&(p=h,null!==f&&(null!=(h=Re(g,f))&&u.push($r(g,h,p)))),d)break;g=g.return}0<u.length&&(s=new l(s,c,null,n,o),i.push({event:s,listeners:u}))}}if(!(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===be||!(c=n.relatedTarget||n.fromElement)||!xo(c)&&!c[ho])&&(l||s)&&(s=o.window===o?o:(s=o.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=r,null!==(c=(c=n.relatedTarget||n.toElement)?xo(c):null)&&(c!==(d=qe(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=r),l!==c)){if(u=gn,h="onMouseLeave",f="onMouseEnter",g="mouse","pointerout"!==e&&"pointerover"!==e||(u=_n,h="onPointerLeave",f="onPointerEnter",g="pointer"),d=null==l?s:wo(l),p=null==c?s:wo(c),(s=new u(h,g+"leave",l,n,o)).target=d,s.relatedTarget=p,h=null,xo(o)===r&&((u=new u(f,g+"enter",c,n,o)).target=p,u.relatedTarget=d,h=u),d=h,l&&c)e:{for(f=c,g=0,p=u=l;p;p=Hr(p))g++;for(p=0,h=f;h;h=Hr(h))p++;for(;0<g-p;)u=Hr(u),g--;for(;0<p-g;)f=Hr(f),p--;for(;g--;){if(u===f||null!==f&&u===f.alternate)break e;u=Hr(u),f=Hr(f)}u=null}else u=null;null!==l&&Kr(i,s,l,u,!1),null!==c&&null!==d&&Kr(i,d,c,u,!0)}if("select"===(l=(s=r?wo(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var m=Yn;else if(Vn(s))if(Jn)m=ir;else{m=or;var y=rr}else(l=s.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(m=ar);switch(m&&(m=m(e,r))?$n(i,m,n,o):(y&&y(e,s,r),"focusout"===e&&(y=s._wrapperState)&&y.controlled&&"number"===s.type&&ee(s,"number",s.value)),y=r?wo(r):window,e){case"focusin":(Vn(y)||"true"===y.contentEditable)&&(mr=y,yr=r,vr=null);break;case"focusout":vr=yr=mr=null;break;case"mousedown":xr=!0;break;case"contextmenu":case"mouseup":case"dragend":xr=!1,br(i,n,o);break;case"selectionchange":if(hr)break;case"keydown":case"keyup":br(i,n,o)}var v;if(Pn)e:{switch(e){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else qn?Mn(e,n)&&(x="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(x="onCompositionStart");x&&(Ln&&"ko"!==n.locale&&(qn||"onCompositionStart"!==x?"onCompositionEnd"===x&&qn&&(v=en()):(Xt="value"in(Jt=o)?Jt.value:Jt.textContent,qn=!0)),0<(y=Gr(r,x)).length&&(x=new bn(x,e,null,n,o),i.push({event:x,listeners:y}),v?x.data=v:null!==(v=Un(n))&&(x.data=v))),(v=Nn?function(e,t){switch(e){case"compositionend":return Un(t);case"keypress":return 32!==t.which?null:(Dn=!0,zn);case"textInput":return(e=t.data)===zn&&Dn?null:e;default:return null}}(e,n):function(e,t){if(qn)return"compositionend"===e||!Pn&&Mn(e,t)?(e=en(),Zt=Xt=Jt=null,qn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Ln&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Gr(r,"onBeforeInput")).length&&(o=new bn("onBeforeInput","beforeinput",null,n,o),i.push({event:o,listeners:r}),o.data=v))}zr(i,t)}))}function $r(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Gr(e,t){for(var n=t+"Capture",r=[];null!==e;){var o=e,a=o.stateNode;5===o.tag&&null!==a&&(o=a,null!=(a=Re(e,n))&&r.unshift($r(e,a,o)),null!=(a=Re(e,t))&&r.push($r(e,a,o))),e=e.return}return r}function Hr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Kr(e,t,n,r,o){for(var a=t._reactName,i=[];null!==n&&n!==r;){var s=n,l=s.alternate,c=s.stateNode;if(null!==l&&l===r)break;5===s.tag&&null!==c&&(s=c,o?null!=(l=Re(n,a))&&i.unshift($r(n,l,s)):o||null!=(l=Re(n,a))&&i.push($r(n,l,s))),n=n.return}0!==i.length&&e.push({event:t,listeners:i})}var Qr=/\r\n?/g,Yr=/\u0000|\uFFFD/g;function Jr(e){return("string"==typeof e?e:""+e).replace(Qr,"\n").replace(Yr,"")}function Xr(e,t,n){if(t=Jr(t),Jr(e)!==t&&n)throw Error(a(425))}function Zr(){}var eo=null,to=null;function no(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ro="function"==typeof setTimeout?setTimeout:void 0,oo="function"==typeof clearTimeout?clearTimeout:void 0,ao="function"==typeof Promise?Promise:void 0,io="function"==typeof queueMicrotask?queueMicrotask:void 0!==ao?function(e){return ao.resolve(null).then(e).catch(so)}:ro;function so(e){setTimeout((function(){throw e}))}function lo(e,t){var n=t,r=0;do{var o=n.nextSibling;if(e.removeChild(n),o&&8===o.nodeType)if("/$"===(n=o.data)){if(0===r)return e.removeChild(o),void qt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=o}while(n);qt(t)}function co(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function uo(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var fo=Math.random().toString(36).slice(2),po="__reactFiber$"+fo,go="__reactProps$"+fo,ho="__reactContainer$"+fo,mo="__reactEvents$"+fo,yo="__reactListeners$"+fo,vo="__reactHandles$"+fo;function xo(e){var t=e[po];if(t)return t;for(var n=e.parentNode;n;){if(t=n[ho]||n[po]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=uo(e);null!==e;){if(n=e[po])return n;e=uo(e)}return t}n=(e=n).parentNode}return null}function bo(e){return!(e=e[po]||e[ho])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function wo(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function So(e){return e[go]||null}var Co=[],Eo=-1;function ko(e){return{current:e}}function Io(e){0>Eo||(e.current=Co[Eo],Co[Eo]=null,Eo--)}function Ao(e,t){Eo++,Co[Eo]=e.current,e.current=t}var _o={},To=ko(_o),jo=ko(!1),Fo=_o;function Ro(e,t){var n=e.type.contextTypes;if(!n)return _o;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var o,a={};for(o in n)a[o]=t[o];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Oo(e){return null!=(e=e.childContextTypes)}function Po(){Io(jo),Io(To)}function Bo(e,t,n){if(To.current!==_o)throw Error(a(168));Ao(To,t),Ao(jo,n)}function No(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!=typeof r.getChildContext)return n;for(var o in r=r.getChildContext())if(!(o in t))throw Error(a(108,W(e)||"Unknown",o));return L({},n,r)}function Lo(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||_o,Fo=To.current,Ao(To,e),Ao(jo,jo.current),!0}function zo(e,t,n){var r=e.stateNode;if(!r)throw Error(a(169));n?(e=No(e,t,Fo),r.__reactInternalMemoizedMergedChildContext=e,Io(jo),Io(To),Ao(To,e)):Io(jo),Ao(jo,n)}var Do=null,Mo=!1,Uo=!1;function qo(e){null===Do?Do=[e]:Do.push(e)}function Wo(){if(!Uo&&null!==Do){Uo=!0;var e=0,t=xt;try{var n=Do;for(xt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Do=null,Mo=!1}catch(t){throw null!==Do&&(Do=Do.slice(e+1)),He(Ze,Wo),t}finally{xt=t,Uo=!1}}return null}var Vo=[],$o=0,Go=null,Ho=0,Ko=[],Qo=0,Yo=null,Jo=1,Xo="";function Zo(e,t){Vo[$o++]=Ho,Vo[$o++]=Go,Go=e,Ho=t}function ea(e,t,n){Ko[Qo++]=Jo,Ko[Qo++]=Xo,Ko[Qo++]=Yo,Yo=e;var r=Jo;e=Xo;var o=32-it(r)-1;r&=~(1<<o),n+=1;var a=32-it(t)+o;if(30<a){var i=o-o%5;a=(r&(1<<i)-1).toString(32),r>>=i,o-=i,Jo=1<<32-it(t)+o|n<<o|r,Xo=a+e}else Jo=1<<a|n<<o|r,Xo=e}function ta(e){null!==e.return&&(Zo(e,1),ea(e,1,0))}function na(e){for(;e===Go;)Go=Vo[--$o],Vo[$o]=null,Ho=Vo[--$o],Vo[$o]=null;for(;e===Yo;)Yo=Ko[--Qo],Ko[Qo]=null,Xo=Ko[--Qo],Ko[Qo]=null,Jo=Ko[--Qo],Ko[Qo]=null}var ra=null,oa=null,aa=!1,ia=null;function sa(e,t){var n=Rc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function la(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ra=e,oa=co(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ra=e,oa=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Yo?{id:Jo,overflow:Xo}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Rc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ra=e,oa=null,!0);default:return!1}}function ca(e){return!(!(1&e.mode)||128&e.flags)}function ua(e){if(aa){var t=oa;if(t){var n=t;if(!la(e,t)){if(ca(e))throw Error(a(418));t=co(n.nextSibling);var r=ra;t&&la(e,t)?sa(r,n):(e.flags=-4097&e.flags|2,aa=!1,ra=e)}}else{if(ca(e))throw Error(a(418));e.flags=-4097&e.flags|2,aa=!1,ra=e}}}function da(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ra=e}function fa(e){if(e!==ra)return!1;if(!aa)return da(e),aa=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!no(e.type,e.memoizedProps)),t&&(t=oa)){if(ca(e))throw pa(),Error(a(418));for(;t;)sa(e,t),t=co(t.nextSibling)}if(da(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){oa=co(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}oa=null}}else oa=ra?co(e.stateNode.nextSibling):null;return!0}function pa(){for(var e=oa;e;)e=co(e.nextSibling)}function ga(){oa=ra=null,aa=!1}function ha(e){null===ia?ia=[e]:ia.push(e)}var ma=b.ReactCurrentBatchConfig;function ya(e,t){if(e&&e.defaultProps){for(var n in t=L({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var va=ko(null),xa=null,ba=null,wa=null;function Sa(){wa=ba=xa=null}function Ca(e){var t=va.current;Io(va),e._currentValue=t}function Ea(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function ka(e,t){xa=e,wa=ba=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(!!(e.lanes&t)&&(bs=!0),e.firstContext=null)}function Ia(e){var t=e._currentValue;if(wa!==e)if(e={context:e,memoizedValue:t,next:null},null===ba){if(null===xa)throw Error(a(308));ba=e,xa.dependencies={lanes:0,firstContext:e}}else ba=ba.next=e;return t}var Aa=null;function _a(e){null===Aa?Aa=[e]:Aa.push(e)}function Ta(e,t,n,r){var o=t.interleaved;return null===o?(n.next=n,_a(t)):(n.next=o.next,o.next=n),t.interleaved=n,ja(e,r)}function ja(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Fa=!1;function Ra(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Oa(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Pa(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ba(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,2&Tl){var o=r.pending;return null===o?t.next=t:(t.next=o.next,o.next=t),r.pending=t,ja(e,n)}return null===(o=r.interleaved)?(t.next=t,_a(r)):(t.next=o.next,o.next=t),r.interleaved=t,ja(e,n)}function Na(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,vt(e,n)}}function La(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var o=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var i={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?o=a=i:a=a.next=i,n=n.next}while(null!==n);null===a?o=a=t:a=a.next=t}else o=a=t;return n={baseState:r.baseState,firstBaseUpdate:o,lastBaseUpdate:a,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function za(e,t,n,r){var o=e.updateQueue;Fa=!1;var a=o.firstBaseUpdate,i=o.lastBaseUpdate,s=o.shared.pending;if(null!==s){o.shared.pending=null;var l=s,c=l.next;l.next=null,null===i?a=c:i.next=c,i=l;var u=e.alternate;null!==u&&((s=(u=u.updateQueue).lastBaseUpdate)!==i&&(null===s?u.firstBaseUpdate=c:s.next=c,u.lastBaseUpdate=l))}if(null!==a){var d=o.baseState;for(i=0,u=c=l=null,s=a;;){var f=s.lane,p=s.eventTime;if((r&f)===f){null!==u&&(u=u.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var g=e,h=s;switch(f=t,p=n,h.tag){case 1:if("function"==typeof(g=h.payload)){d=g.call(p,d,f);break e}d=g;break e;case 3:g.flags=-65537&g.flags|128;case 0:if(null==(f="function"==typeof(g=h.payload)?g.call(p,d,f):g))break e;d=L({},d,f);break e;case 2:Fa=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(f=o.effects)?o.effects=[s]:f.push(s))}else p={eventTime:p,lane:f,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===u?(c=u=p,l=d):u=u.next=p,i|=f;if(null===(s=s.next)){if(null===(s=o.shared.pending))break;s=(f=s).next,f.next=null,o.lastBaseUpdate=f,o.shared.pending=null}}if(null===u&&(l=d),o.baseState=l,o.firstBaseUpdate=c,o.lastBaseUpdate=u,null!==(t=o.shared.interleaved)){o=t;do{i|=o.lane,o=o.next}while(o!==t)}else null===a&&(o.shared.lanes=0);Ll|=i,e.lanes=i,e.memoizedState=d}}function Da(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],o=r.callback;if(null!==o){if(r.callback=null,r=n,"function"!=typeof o)throw Error(a(191,o));o.call(r)}}}var Ma=(new r.Component).refs;function Ua(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:L({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var qa={isMounted:function(e){return!!(e=e._reactInternals)&&qe(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=tc(),o=nc(e),a=Pa(r,o);a.payload=t,null!=n&&(a.callback=n),null!==(t=Ba(e,a,o))&&(rc(t,e,o,r),Na(t,e,o))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=tc(),o=nc(e),a=Pa(r,o);a.tag=1,a.payload=t,null!=n&&(a.callback=n),null!==(t=Ba(e,a,o))&&(rc(t,e,o,r),Na(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tc(),r=nc(e),o=Pa(n,r);o.tag=2,null!=t&&(o.callback=t),null!==(t=Ba(e,o,r))&&(rc(t,e,r,n),Na(t,e,r))}};function Wa(e,t,n,r,o,a,i){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,i):!t.prototype||!t.prototype.isPureReactComponent||(!lr(n,r)||!lr(o,a))}function Va(e,t,n){var r=!1,o=_o,a=t.contextType;return"object"==typeof a&&null!==a?a=Ia(a):(o=Oo(t)?Fo:To.current,a=(r=null!=(r=t.contextTypes))?Ro(e,o):_o),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=qa,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=a),t}function $a(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&qa.enqueueReplaceState(t,t.state,null)}function Ga(e,t,n,r){var o=e.stateNode;o.props=n,o.state=e.memoizedState,o.refs=Ma,Ra(e);var a=t.contextType;"object"==typeof a&&null!==a?o.context=Ia(a):(a=Oo(t)?Fo:To.current,o.context=Ro(e,a)),o.state=e.memoizedState,"function"==typeof(a=t.getDerivedStateFromProps)&&(Ua(e,t,a,n),o.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof o.getSnapshotBeforeUpdate||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||(t=o.state,"function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount(),t!==o.state&&qa.enqueueReplaceState(o,o.state,null),za(e,n,o,r),o.state=e.memoizedState),"function"==typeof o.componentDidMount&&(e.flags|=4194308)}function Ha(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var r=n.stateNode}if(!r)throw Error(a(147,e));var o=r,i=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===i?t.ref:(t=function(e){var t=o.refs;t===Ma&&(t=o.refs={}),null===e?delete t[i]:t[i]=e},t._stringRef=i,t)}if("string"!=typeof e)throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function Ka(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Qa(e){return(0,e._init)(e._payload)}function Ya(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function o(e,t){return(e=Pc(e,t)).index=0,e.sibling=null,e}function i(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=zc(n,e.mode,r)).return=e,t):((t=o(t,n)).return=e,t)}function c(e,t,n,r){var a=n.type;return a===C?d(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===a||"object"==typeof a&&null!==a&&a.$$typeof===R&&Qa(a)===t.type)?((r=o(t,n.props)).ref=Ha(e,t,n),r.return=e,r):((r=Bc(n.type,n.key,n.props,null,e.mode,r)).ref=Ha(e,t,n),r.return=e,r)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Dc(n,e.mode,r)).return=e,t):((t=o(t,n.children||[])).return=e,t)}function d(e,t,n,r,a){return null===t||7!==t.tag?((t=Nc(n,e.mode,r,a)).return=e,t):((t=o(t,n)).return=e,t)}function f(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t)return(t=zc(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case w:return(n=Bc(t.type,t.key,t.props,null,e.mode,n)).ref=Ha(e,null,t),n.return=e,n;case S:return(t=Dc(t,e.mode,n)).return=e,t;case R:return f(e,(0,t._init)(t._payload),n)}if(te(t)||B(t))return(t=Nc(t,e.mode,n,null)).return=e,t;Ka(e,t)}return null}function p(e,t,n,r){var o=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n)return null!==o?null:l(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case w:return n.key===o?c(e,t,n,r):null;case S:return n.key===o?u(e,t,n,r):null;case R:return p(e,t,(o=n._init)(n._payload),r)}if(te(n)||B(n))return null!==o?null:d(e,t,n,r,null);Ka(e,n)}return null}function g(e,t,n,r,o){if("string"==typeof r&&""!==r||"number"==typeof r)return l(t,e=e.get(n)||null,""+r,o);if("object"==typeof r&&null!==r){switch(r.$$typeof){case w:return c(t,e=e.get(null===r.key?n:r.key)||null,r,o);case S:return u(t,e=e.get(null===r.key?n:r.key)||null,r,o);case R:return g(e,t,n,(0,r._init)(r._payload),o)}if(te(r)||B(r))return d(t,e=e.get(n)||null,r,o,null);Ka(t,r)}return null}function h(o,a,s,l){for(var c=null,u=null,d=a,h=a=0,m=null;null!==d&&h<s.length;h++){d.index>h?(m=d,d=null):m=d.sibling;var y=p(o,d,s[h],l);if(null===y){null===d&&(d=m);break}e&&d&&null===y.alternate&&t(o,d),a=i(y,a,h),null===u?c=y:u.sibling=y,u=y,d=m}if(h===s.length)return n(o,d),aa&&Zo(o,h),c;if(null===d){for(;h<s.length;h++)null!==(d=f(o,s[h],l))&&(a=i(d,a,h),null===u?c=d:u.sibling=d,u=d);return aa&&Zo(o,h),c}for(d=r(o,d);h<s.length;h++)null!==(m=g(d,o,h,s[h],l))&&(e&&null!==m.alternate&&d.delete(null===m.key?h:m.key),a=i(m,a,h),null===u?c=m:u.sibling=m,u=m);return e&&d.forEach((function(e){return t(o,e)})),aa&&Zo(o,h),c}function m(o,s,l,c){var u=B(l);if("function"!=typeof u)throw Error(a(150));if(null==(l=u.call(l)))throw Error(a(151));for(var d=u=null,h=s,m=s=0,y=null,v=l.next();null!==h&&!v.done;m++,v=l.next()){h.index>m?(y=h,h=null):y=h.sibling;var x=p(o,h,v.value,c);if(null===x){null===h&&(h=y);break}e&&h&&null===x.alternate&&t(o,h),s=i(x,s,m),null===d?u=x:d.sibling=x,d=x,h=y}if(v.done)return n(o,h),aa&&Zo(o,m),u;if(null===h){for(;!v.done;m++,v=l.next())null!==(v=f(o,v.value,c))&&(s=i(v,s,m),null===d?u=v:d.sibling=v,d=v);return aa&&Zo(o,m),u}for(h=r(o,h);!v.done;m++,v=l.next())null!==(v=g(h,o,m,v.value,c))&&(e&&null!==v.alternate&&h.delete(null===v.key?m:v.key),s=i(v,s,m),null===d?u=v:d.sibling=v,d=v);return e&&h.forEach((function(e){return t(o,e)})),aa&&Zo(o,m),u}return function e(r,a,i,l){if("object"==typeof i&&null!==i&&i.type===C&&null===i.key&&(i=i.props.children),"object"==typeof i&&null!==i){switch(i.$$typeof){case w:e:{for(var c=i.key,u=a;null!==u;){if(u.key===c){if((c=i.type)===C){if(7===u.tag){n(r,u.sibling),(a=o(u,i.props.children)).return=r,r=a;break e}}else if(u.elementType===c||"object"==typeof c&&null!==c&&c.$$typeof===R&&Qa(c)===u.type){n(r,u.sibling),(a=o(u,i.props)).ref=Ha(r,u,i),a.return=r,r=a;break e}n(r,u);break}t(r,u),u=u.sibling}i.type===C?((a=Nc(i.props.children,r.mode,l,i.key)).return=r,r=a):((l=Bc(i.type,i.key,i.props,null,r.mode,l)).ref=Ha(r,a,i),l.return=r,r=l)}return s(r);case S:e:{for(u=i.key;null!==a;){if(a.key===u){if(4===a.tag&&a.stateNode.containerInfo===i.containerInfo&&a.stateNode.implementation===i.implementation){n(r,a.sibling),(a=o(a,i.children||[])).return=r,r=a;break e}n(r,a);break}t(r,a),a=a.sibling}(a=Dc(i,r.mode,l)).return=r,r=a}return s(r);case R:return e(r,a,(u=i._init)(i._payload),l)}if(te(i))return h(r,a,i,l);if(B(i))return m(r,a,i,l);Ka(r,i)}return"string"==typeof i&&""!==i||"number"==typeof i?(i=""+i,null!==a&&6===a.tag?(n(r,a.sibling),(a=o(a,i)).return=r,r=a):(n(r,a),(a=zc(i,r.mode,l)).return=r,r=a),s(r)):n(r,a)}}var Ja=Ya(!0),Xa=Ya(!1),Za={},ei=ko(Za),ti=ko(Za),ni=ko(Za);function ri(e){if(e===Za)throw Error(a(174));return e}function oi(e,t){switch(Ao(ni,t),Ao(ti,e),Ao(ei,Za),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Io(ei),Ao(ei,t)}function ai(){Io(ei),Io(ti),Io(ni)}function ii(e){ri(ni.current);var t=ri(ei.current),n=le(t,e.type);t!==n&&(Ao(ti,e),Ao(ei,n))}function si(e){ti.current===e&&(Io(ei),Io(ti))}var li=ko(0);function ci(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(128&t.flags)return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ui=[];function di(){for(var e=0;e<ui.length;e++)ui[e]._workInProgressVersionPrimary=null;ui.length=0}var fi=b.ReactCurrentDispatcher,pi=b.ReactCurrentBatchConfig,gi=0,hi=null,mi=null,yi=null,vi=!1,xi=!1,bi=0,wi=0;function Si(){throw Error(a(321))}function Ci(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!sr(e[n],t[n]))return!1;return!0}function Ei(e,t,n,r,o,i){if(gi=i,hi=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,fi.current=null===e||null===e.memoizedState?ss:ls,e=n(r,o),xi){i=0;do{if(xi=!1,bi=0,25<=i)throw Error(a(301));i+=1,yi=mi=null,t.updateQueue=null,fi.current=cs,e=n(r,o)}while(xi)}if(fi.current=is,t=null!==mi&&null!==mi.next,gi=0,yi=mi=hi=null,vi=!1,t)throw Error(a(300));return e}function ki(){var e=0!==bi;return bi=0,e}function Ii(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===yi?hi.memoizedState=yi=e:yi=yi.next=e,yi}function Ai(){if(null===mi){var e=hi.alternate;e=null!==e?e.memoizedState:null}else e=mi.next;var t=null===yi?hi.memoizedState:yi.next;if(null!==t)yi=t,mi=e;else{if(null===e)throw Error(a(310));e={memoizedState:(mi=e).memoizedState,baseState:mi.baseState,baseQueue:mi.baseQueue,queue:mi.queue,next:null},null===yi?hi.memoizedState=yi=e:yi=yi.next=e}return yi}function _i(e,t){return"function"==typeof t?t(e):t}function Ti(e){var t=Ai(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=mi,o=r.baseQueue,i=n.pending;if(null!==i){if(null!==o){var s=o.next;o.next=i.next,i.next=s}r.baseQueue=o=i,n.pending=null}if(null!==o){i=o.next,r=r.baseState;var l=s=null,c=null,u=i;do{var d=u.lane;if((gi&d)===d)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var f={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=f,s=r):c=c.next=f,hi.lanes|=d,Ll|=d}u=u.next}while(null!==u&&u!==i);null===c?s=r:c.next=l,sr(r,t.memoizedState)||(bs=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){o=e;do{i=o.lane,hi.lanes|=i,Ll|=i,o=o.next}while(o!==e)}else null===o&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function ji(e){var t=Ai(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=n.dispatch,o=n.pending,i=t.memoizedState;if(null!==o){n.pending=null;var s=o=o.next;do{i=e(i,s.action),s=s.next}while(s!==o);sr(i,t.memoizedState)||(bs=!0),t.memoizedState=i,null===t.baseQueue&&(t.baseState=i),n.lastRenderedState=i}return[i,r]}function Fi(){}function Ri(e,t){var n=hi,r=Ai(),o=t(),i=!sr(r.memoizedState,o);if(i&&(r.memoizedState=o,bs=!0),r=r.queue,Vi(Bi.bind(null,n,r,e),[e]),r.getSnapshot!==t||i||null!==yi&&1&yi.memoizedState.tag){if(n.flags|=2048,Di(9,Pi.bind(null,n,r,o,t),void 0,null),null===jl)throw Error(a(349));30&gi||Oi(n,t,o)}return o}function Oi(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=hi.updateQueue)?(t={lastEffect:null,stores:null},hi.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Pi(e,t,n,r){t.value=n,t.getSnapshot=r,Ni(t)&&Li(e)}function Bi(e,t,n){return n((function(){Ni(t)&&Li(e)}))}function Ni(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!sr(e,n)}catch(e){return!0}}function Li(e){var t=ja(e,1);null!==t&&rc(t,e,1,-1)}function zi(e){var t=Ii();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:_i,lastRenderedState:e},t.queue=e,e=e.dispatch=ns.bind(null,hi,e),[t.memoizedState,e]}function Di(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=hi.updateQueue)?(t={lastEffect:null,stores:null},hi.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Mi(){return Ai().memoizedState}function Ui(e,t,n,r){var o=Ii();hi.flags|=e,o.memoizedState=Di(1|t,n,void 0,void 0===r?null:r)}function qi(e,t,n,r){var o=Ai();r=void 0===r?null:r;var a=void 0;if(null!==mi){var i=mi.memoizedState;if(a=i.destroy,null!==r&&Ci(r,i.deps))return void(o.memoizedState=Di(t,n,a,r))}hi.flags|=e,o.memoizedState=Di(1|t,n,a,r)}function Wi(e,t){return Ui(8390656,8,e,t)}function Vi(e,t){return qi(2048,8,e,t)}function $i(e,t){return qi(4,2,e,t)}function Gi(e,t){return qi(4,4,e,t)}function Hi(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ki(e,t,n){return n=null!=n?n.concat([e]):null,qi(4,4,Hi.bind(null,t,e),n)}function Qi(){}function Yi(e,t){var n=Ai();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Ci(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Ji(e,t){var n=Ai();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Ci(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Xi(e,t,n){return 21&gi?(sr(n,t)||(n=ht(),hi.lanes|=n,Ll|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,bs=!0),e.memoizedState=n)}function Zi(e,t){var n=xt;xt=0!==n&&4>n?n:4,e(!0);var r=pi.transition;pi.transition={};try{e(!1),t()}finally{xt=n,pi.transition=r}}function es(){return Ai().memoizedState}function ts(e,t,n){var r=nc(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},rs(e))os(t,n);else if(null!==(n=Ta(e,t,n,r))){rc(n,e,r,tc()),as(n,t,r)}}function ns(e,t,n){var r=nc(e),o={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(rs(e))os(t,o);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var i=t.lastRenderedState,s=a(i,n);if(o.hasEagerState=!0,o.eagerState=s,sr(s,i)){var l=t.interleaved;return null===l?(o.next=o,_a(t)):(o.next=l.next,l.next=o),void(t.interleaved=o)}}catch(e){}null!==(n=Ta(e,t,o,r))&&(rc(n,e,r,o=tc()),as(n,t,r))}}function rs(e){var t=e.alternate;return e===hi||null!==t&&t===hi}function os(e,t){xi=vi=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function as(e,t,n){if(4194240&n){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,vt(e,n)}}var is={readContext:Ia,useCallback:Si,useContext:Si,useEffect:Si,useImperativeHandle:Si,useInsertionEffect:Si,useLayoutEffect:Si,useMemo:Si,useReducer:Si,useRef:Si,useState:Si,useDebugValue:Si,useDeferredValue:Si,useTransition:Si,useMutableSource:Si,useSyncExternalStore:Si,useId:Si,unstable_isNewReconciler:!1},ss={readContext:Ia,useCallback:function(e,t){return Ii().memoizedState=[e,void 0===t?null:t],e},useContext:Ia,useEffect:Wi,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,Ui(4194308,4,Hi.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Ui(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ui(4,2,e,t)},useMemo:function(e,t){var n=Ii();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Ii();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=ts.bind(null,hi,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Ii().memoizedState=e},useState:zi,useDebugValue:Qi,useDeferredValue:function(e){return Ii().memoizedState=e},useTransition:function(){var e=zi(!1),t=e[0];return e=Zi.bind(null,e[1]),Ii().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=hi,o=Ii();if(aa){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===jl)throw Error(a(349));30&gi||Oi(r,t,n)}o.memoizedState=n;var i={value:n,getSnapshot:t};return o.queue=i,Wi(Bi.bind(null,r,i,e),[e]),r.flags|=2048,Di(9,Pi.bind(null,r,i,n,t),void 0,null),n},useId:function(){var e=Ii(),t=jl.identifierPrefix;if(aa){var n=Xo;t=":"+t+"R"+(n=(Jo&~(1<<32-it(Jo)-1)).toString(32)+n),0<(n=bi++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=wi++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ls={readContext:Ia,useCallback:Yi,useContext:Ia,useEffect:Vi,useImperativeHandle:Ki,useInsertionEffect:$i,useLayoutEffect:Gi,useMemo:Ji,useReducer:Ti,useRef:Mi,useState:function(){return Ti(_i)},useDebugValue:Qi,useDeferredValue:function(e){return Xi(Ai(),mi.memoizedState,e)},useTransition:function(){return[Ti(_i)[0],Ai().memoizedState]},useMutableSource:Fi,useSyncExternalStore:Ri,useId:es,unstable_isNewReconciler:!1},cs={readContext:Ia,useCallback:Yi,useContext:Ia,useEffect:Vi,useImperativeHandle:Ki,useInsertionEffect:$i,useLayoutEffect:Gi,useMemo:Ji,useReducer:ji,useRef:Mi,useState:function(){return ji(_i)},useDebugValue:Qi,useDeferredValue:function(e){var t=Ai();return null===mi?t.memoizedState=e:Xi(t,mi.memoizedState,e)},useTransition:function(){return[ji(_i)[0],Ai().memoizedState]},useMutableSource:Fi,useSyncExternalStore:Ri,useId:es,unstable_isNewReconciler:!1};function us(e,t){try{var n="",r=t;do{n+=U(r),r=r.return}while(r);var o=n}catch(e){o="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:t,stack:o,digest:null}}function ds(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function fs(e,t){try{console.error(t.value)}catch(e){setTimeout((function(){throw e}))}}var ps="function"==typeof WeakMap?WeakMap:Map;function gs(e,t,n){(n=Pa(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){$l||($l=!0,Gl=r),fs(0,t)},n}function hs(e,t,n){(n=Pa(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"==typeof r){var o=t.value;n.payload=function(){return r(o)},n.callback=function(){fs(0,t)}}var a=e.stateNode;return null!==a&&"function"==typeof a.componentDidCatch&&(n.callback=function(){fs(0,t),"function"!=typeof r&&(null===Hl?Hl=new Set([this]):Hl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ms(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new ps;var o=new Set;r.set(t,o)}else void 0===(o=r.get(t))&&(o=new Set,r.set(t,o));o.has(n)||(o.add(n),e=Ic.bind(null,e,t,n),t.then(e,e))}function ys(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function vs(e,t,n,r,o){return 1&e.mode?(e.flags|=65536,e.lanes=o,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Pa(-1,1)).tag=2,Ba(n,t,1))),n.lanes|=1),e)}var xs=b.ReactCurrentOwner,bs=!1;function ws(e,t,n,r){t.child=null===e?Xa(t,null,n,r):Ja(t,e.child,n,r)}function Ss(e,t,n,r,o){n=n.render;var a=t.ref;return ka(t,o),r=Ei(e,t,n,r,a,o),n=ki(),null===e||bs?(aa&&n&&ta(t),t.flags|=1,ws(e,t,r,o),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,$s(e,t,o))}function Cs(e,t,n,r,o){if(null===e){var a=n.type;return"function"!=typeof a||Oc(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Bc(n.type,null,r,t,t.mode,o)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,Es(e,t,a,r,o))}if(a=e.child,!(e.lanes&o)){var i=a.memoizedProps;if((n=null!==(n=n.compare)?n:lr)(i,r)&&e.ref===t.ref)return $s(e,t,o)}return t.flags|=1,(e=Pc(a,r)).ref=t.ref,e.return=t,t.child=e}function Es(e,t,n,r,o){if(null!==e){var a=e.memoizedProps;if(lr(a,r)&&e.ref===t.ref){if(bs=!1,t.pendingProps=r=a,!(e.lanes&o))return t.lanes=e.lanes,$s(e,t,o);131072&e.flags&&(bs=!0)}}return As(e,t,n,r,o)}function ks(e,t,n){var r=t.pendingProps,o=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(1&t.mode){if(!(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ao(Pl,Ol),Ol|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==a?a.baseLanes:n,Ao(Pl,Ol),Ol|=r}else t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ao(Pl,Ol),Ol|=n;else null!==a?(r=a.baseLanes|n,t.memoizedState=null):r=n,Ao(Pl,Ol),Ol|=r;return ws(e,t,o,n),t.child}function Is(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function As(e,t,n,r,o){var a=Oo(n)?Fo:To.current;return a=Ro(t,a),ka(t,o),n=Ei(e,t,n,r,a,o),r=ki(),null===e||bs?(aa&&r&&ta(t),t.flags|=1,ws(e,t,n,o),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,$s(e,t,o))}function _s(e,t,n,r,o){if(Oo(n)){var a=!0;Lo(t)}else a=!1;if(ka(t,o),null===t.stateNode)Vs(e,t),Va(t,n,r),Ga(t,n,r,o),r=!0;else if(null===e){var i=t.stateNode,s=t.memoizedProps;i.props=s;var l=i.context,c=n.contextType;"object"==typeof c&&null!==c?c=Ia(c):c=Ro(t,c=Oo(n)?Fo:To.current);var u=n.getDerivedStateFromProps,d="function"==typeof u||"function"==typeof i.getSnapshotBeforeUpdate;d||"function"!=typeof i.UNSAFE_componentWillReceiveProps&&"function"!=typeof i.componentWillReceiveProps||(s!==r||l!==c)&&$a(t,i,r,c),Fa=!1;var f=t.memoizedState;i.state=f,za(t,r,i,o),l=t.memoizedState,s!==r||f!==l||jo.current||Fa?("function"==typeof u&&(Ua(t,n,u,r),l=t.memoizedState),(s=Fa||Wa(t,n,s,r,f,l,c))?(d||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||("function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount()),"function"==typeof i.componentDidMount&&(t.flags|=4194308)):("function"==typeof i.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),i.props=r,i.state=l,i.context=c,r=s):("function"==typeof i.componentDidMount&&(t.flags|=4194308),r=!1)}else{i=t.stateNode,Oa(e,t),s=t.memoizedProps,c=t.type===t.elementType?s:ya(t.type,s),i.props=c,d=t.pendingProps,f=i.context,"object"==typeof(l=n.contextType)&&null!==l?l=Ia(l):l=Ro(t,l=Oo(n)?Fo:To.current);var p=n.getDerivedStateFromProps;(u="function"==typeof p||"function"==typeof i.getSnapshotBeforeUpdate)||"function"!=typeof i.UNSAFE_componentWillReceiveProps&&"function"!=typeof i.componentWillReceiveProps||(s!==d||f!==l)&&$a(t,i,r,l),Fa=!1,f=t.memoizedState,i.state=f,za(t,r,i,o);var g=t.memoizedState;s!==d||f!==g||jo.current||Fa?("function"==typeof p&&(Ua(t,n,p,r),g=t.memoizedState),(c=Fa||Wa(t,n,c,r,f,g,l)||!1)?(u||"function"!=typeof i.UNSAFE_componentWillUpdate&&"function"!=typeof i.componentWillUpdate||("function"==typeof i.componentWillUpdate&&i.componentWillUpdate(r,g,l),"function"==typeof i.UNSAFE_componentWillUpdate&&i.UNSAFE_componentWillUpdate(r,g,l)),"function"==typeof i.componentDidUpdate&&(t.flags|=4),"function"==typeof i.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof i.componentDidUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!=typeof i.getSnapshotBeforeUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=g),i.props=r,i.state=g,i.context=l,r=c):("function"!=typeof i.componentDidUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!=typeof i.getSnapshotBeforeUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),r=!1)}return Ts(e,t,n,r,a,o)}function Ts(e,t,n,r,o,a){Is(e,t);var i=!!(128&t.flags);if(!r&&!i)return o&&zo(t,n,!1),$s(e,t,a);r=t.stateNode,xs.current=t;var s=i&&"function"!=typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&i?(t.child=Ja(t,e.child,null,a),t.child=Ja(t,null,s,a)):ws(e,t,s,a),t.memoizedState=r.state,o&&zo(t,n,!0),t.child}function js(e){var t=e.stateNode;t.pendingContext?Bo(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Bo(0,t.context,!1),oi(e,t.containerInfo)}function Fs(e,t,n,r,o){return ga(),ha(o),t.flags|=256,ws(e,t,n,r),t.child}var Rs,Os,Ps,Bs,Ns={dehydrated:null,treeContext:null,retryLane:0};function Ls(e){return{baseLanes:e,cachePool:null,transitions:null}}function zs(e,t,n){var r,o=t.pendingProps,i=li.current,s=!1,l=!!(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&!!(2&i)),r?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(i|=1),Ao(li,1&i),null===e)return ua(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(1&t.mode?"$!"===e.data?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(l=o.children,e=o.fallback,s?(o=t.mode,s=t.child,l={mode:"hidden",children:l},1&o||null===s?s=Lc(l,o,0,null):(s.childLanes=0,s.pendingProps=l),e=Nc(e,o,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Ls(n),t.memoizedState=Ns,e):Ds(t,l));if(null!==(i=e.memoizedState)&&null!==(r=i.dehydrated))return function(e,t,n,r,o,i,s){if(n)return 256&t.flags?(t.flags&=-257,Ms(e,t,s,r=ds(Error(a(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(i=r.fallback,o=t.mode,r=Lc({mode:"visible",children:r.children},o,0,null),(i=Nc(i,o,s,null)).flags|=2,r.return=t,i.return=t,r.sibling=i,t.child=r,1&t.mode&&Ja(t,e.child,null,s),t.child.memoizedState=Ls(s),t.memoizedState=Ns,i);if(!(1&t.mode))return Ms(e,t,s,null);if("$!"===o.data){if(r=o.nextSibling&&o.nextSibling.dataset)var l=r.dgst;return r=l,Ms(e,t,s,r=ds(i=Error(a(419)),r,void 0))}if(l=!!(s&e.childLanes),bs||l){if(null!==(r=jl)){switch(s&-s){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}0!==(o=o&(r.suspendedLanes|s)?0:o)&&o!==i.retryLane&&(i.retryLane=o,ja(e,o),rc(r,e,o,-1))}return mc(),Ms(e,t,s,r=ds(Error(a(421))))}return"$?"===o.data?(t.flags|=128,t.child=e.child,t=_c.bind(null,e),o._reactRetry=t,null):(e=i.treeContext,oa=co(o.nextSibling),ra=t,aa=!0,ia=null,null!==e&&(Ko[Qo++]=Jo,Ko[Qo++]=Xo,Ko[Qo++]=Yo,Jo=e.id,Xo=e.overflow,Yo=t),t=Ds(t,r.children),t.flags|=4096,t)}(e,t,l,o,r,i,n);if(s){s=o.fallback,l=t.mode,r=(i=e.child).sibling;var c={mode:"hidden",children:o.children};return 1&l||t.child===i?(o=Pc(i,c)).subtreeFlags=14680064&i.subtreeFlags:((o=t.child).childLanes=0,o.pendingProps=c,t.deletions=null),null!==r?s=Pc(r,s):(s=Nc(s,l,n,null)).flags|=2,s.return=t,o.return=t,o.sibling=s,t.child=o,o=s,s=t.child,l=null===(l=e.child.memoizedState)?Ls(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},s.memoizedState=l,s.childLanes=e.childLanes&~n,t.memoizedState=Ns,o}return e=(s=e.child).sibling,o=Pc(s,{mode:"visible",children:o.children}),!(1&t.mode)&&(o.lanes=n),o.return=t,o.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=o,t.memoizedState=null,o}function Ds(e,t){return(t=Lc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Ms(e,t,n,r){return null!==r&&ha(r),Ja(t,e.child,null,n),(e=Ds(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Us(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Ea(e.return,t,n)}function qs(e,t,n,r,o){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:o}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=o)}function Ws(e,t,n){var r=t.pendingProps,o=r.revealOrder,a=r.tail;if(ws(e,t,r.children,n),2&(r=li.current))r=1&r|2,t.flags|=128;else{if(null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Us(e,n,t);else if(19===e.tag)Us(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ao(li,r),1&t.mode)switch(o){case"forwards":for(n=t.child,o=null;null!==n;)null!==(e=n.alternate)&&null===ci(e)&&(o=n),n=n.sibling;null===(n=o)?(o=t.child,t.child=null):(o=n.sibling,n.sibling=null),qs(t,!1,o,n,a);break;case"backwards":for(n=null,o=t.child,t.child=null;null!==o;){if(null!==(e=o.alternate)&&null===ci(e)){t.child=o;break}e=o.sibling,o.sibling=n,n=o,o=e}qs(t,!0,n,null,a);break;case"together":qs(t,!1,null,null,void 0);break;default:t.memoizedState=null}else t.memoizedState=null;return t.child}function Vs(e,t){!(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function $s(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Ll|=t.lanes,!(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Pc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Pc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Gs(e,t){if(!aa)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Hs(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var o=e.child;null!==o;)n|=o.lanes|o.childLanes,r|=14680064&o.subtreeFlags,r|=14680064&o.flags,o.return=e,o=o.sibling;else for(o=e.child;null!==o;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags,r|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Ks(e,t,n){var r=t.pendingProps;switch(na(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Hs(t),null;case 1:case 17:return Oo(t.type)&&Po(),Hs(t),null;case 3:return r=t.stateNode,ai(),Io(jo),Io(To),di(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(fa(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,null!==ia&&(sc(ia),ia=null))),Os(e,t),Hs(t),null;case 5:si(t);var o=ri(ni.current);if(n=t.type,null!==e&&null!=t.stateNode)Ps(e,t,n,r,o),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(a(166));return Hs(t),null}if(e=ri(ei.current),fa(t)){r=t.stateNode,n=t.type;var i=t.memoizedProps;switch(r[po]=t,r[go]=i,e=!!(1&t.mode),n){case"dialog":Dr("cancel",r),Dr("close",r);break;case"iframe":case"object":case"embed":Dr("load",r);break;case"video":case"audio":for(o=0;o<Br.length;o++)Dr(Br[o],r);break;case"source":Dr("error",r);break;case"img":case"image":case"link":Dr("error",r),Dr("load",r);break;case"details":Dr("toggle",r);break;case"input":Y(r,i),Dr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Dr("invalid",r);break;case"textarea":oe(r,i),Dr("invalid",r)}for(var l in ve(n,i),o=null,i)if(i.hasOwnProperty(l)){var c=i[l];"children"===l?"string"==typeof c?r.textContent!==c&&(!0!==i.suppressHydrationWarning&&Xr(r.textContent,c,e),o=["children",c]):"number"==typeof c&&r.textContent!==""+c&&(!0!==i.suppressHydrationWarning&&Xr(r.textContent,c,e),o=["children",""+c]):s.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Dr("scroll",r)}switch(n){case"input":G(r),Z(r,i,!0);break;case"textarea":G(r),ie(r);break;case"select":case"option":break;default:"function"==typeof i.onClick&&(r.onclick=Zr)}r=o,t.updateQueue=r,null!==r&&(t.flags|=4)}else{l=9===o.nodeType?o:o.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof r.is?e=l.createElement(n,{is:r.is}):(e=l.createElement(n),"select"===n&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,n),e[po]=t,e[go]=r,Rs(e,t,!1,!1),t.stateNode=e;e:{switch(l=xe(n,r),n){case"dialog":Dr("cancel",e),Dr("close",e),o=r;break;case"iframe":case"object":case"embed":Dr("load",e),o=r;break;case"video":case"audio":for(o=0;o<Br.length;o++)Dr(Br[o],e);o=r;break;case"source":Dr("error",e),o=r;break;case"img":case"image":case"link":Dr("error",e),Dr("load",e),o=r;break;case"details":Dr("toggle",e),o=r;break;case"input":Y(e,r),o=Q(e,r),Dr("invalid",e);break;case"option":default:o=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},o=L({},r,{value:void 0}),Dr("invalid",e);break;case"textarea":oe(e,r),o=re(e,r),Dr("invalid",e)}for(i in ve(n,o),c=o)if(c.hasOwnProperty(i)){var u=c[i];"style"===i?me(e,u):"dangerouslySetInnerHTML"===i?null!=(u=u?u.__html:void 0)&&de(e,u):"children"===i?"string"==typeof u?("textarea"!==n||""!==u)&&fe(e,u):"number"==typeof u&&fe(e,""+u):"suppressContentEditableWarning"!==i&&"suppressHydrationWarning"!==i&&"autoFocus"!==i&&(s.hasOwnProperty(i)?null!=u&&"onScroll"===i&&Dr("scroll",e):null!=u&&x(e,i,u,l))}switch(n){case"input":G(e),Z(e,r,!1);break;case"textarea":G(e),ie(e);break;case"option":null!=r.value&&e.setAttribute("value",""+V(r.value));break;case"select":e.multiple=!!r.multiple,null!=(i=r.value)?ne(e,!!r.multiple,i,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"==typeof o.onClick&&(e.onclick=Zr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Hs(t),null;case 6:if(e&&null!=t.stateNode)Bs(e,t,e.memoizedProps,r);else{if("string"!=typeof r&&null===t.stateNode)throw Error(a(166));if(n=ri(ni.current),ri(ei.current),fa(t)){if(r=t.stateNode,n=t.memoizedProps,r[po]=t,(i=r.nodeValue!==n)&&null!==(e=ra))switch(e.tag){case 3:Xr(r.nodeValue,n,!!(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Xr(r.nodeValue,n,!!(1&e.mode))}i&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[po]=t,t.stateNode=r}return Hs(t),null;case 13:if(Io(li),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(aa&&null!==oa&&1&t.mode&&!(128&t.flags))pa(),ga(),t.flags|=98560,i=!1;else if(i=fa(t),null!==r&&null!==r.dehydrated){if(null===e){if(!i)throw Error(a(318));if(!(i=null!==(i=t.memoizedState)?i.dehydrated:null))throw Error(a(317));i[po]=t}else ga(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Hs(t),i=!1}else null!==ia&&(sc(ia),ia=null),i=!0;if(!i)return 65536&t.flags?t:null}return 128&t.flags?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,1&t.mode&&(null===e||1&li.current?0===Bl&&(Bl=3):mc())),null!==t.updateQueue&&(t.flags|=4),Hs(t),null);case 4:return ai(),Os(e,t),null===e&&qr(t.stateNode.containerInfo),Hs(t),null;case 10:return Ca(t.type._context),Hs(t),null;case 19:if(Io(li),null===(i=t.memoizedState))return Hs(t),null;if(r=!!(128&t.flags),null===(l=i.rendering))if(r)Gs(i,!1);else{if(0!==Bl||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(l=ci(e))){for(t.flags|=128,Gs(i,!1),null!==(r=l.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(i=n).flags&=14680066,null===(l=i.alternate)?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=l.childLanes,i.lanes=l.lanes,i.child=l.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=l.memoizedProps,i.memoizedState=l.memoizedState,i.updateQueue=l.updateQueue,i.type=l.type,e=l.dependencies,i.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ao(li,1&li.current|2),t.child}e=e.sibling}null!==i.tail&&Je()>Wl&&(t.flags|=128,r=!0,Gs(i,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=ci(l))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Gs(i,!0),null===i.tail&&"hidden"===i.tailMode&&!l.alternate&&!aa)return Hs(t),null}else 2*Je()-i.renderingStartTime>Wl&&1073741824!==n&&(t.flags|=128,r=!0,Gs(i,!1),t.lanes=4194304);i.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=i.last)?n.sibling=l:t.child=l,i.last=l)}return null!==i.tail?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=Je(),t.sibling=null,n=li.current,Ao(li,r?1&n|2:1&n),t):(Hs(t),null);case 22:case 23:return fc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&1&t.mode?!!(1073741824&Ol)&&(Hs(t),6&t.subtreeFlags&&(t.flags|=8192)):Hs(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}function Qs(e,t){switch(na(t),t.tag){case 1:return Oo(t.type)&&Po(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return ai(),Io(jo),Io(To),di(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 5:return si(t),null;case 13:if(Io(li),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));ga()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Io(li),null;case 4:return ai(),null;case 10:return Ca(t.type._context),null;case 22:case 23:return fc(),null;default:return null}}Rs=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Os=function(){},Ps=function(e,t,n,r){var o=e.memoizedProps;if(o!==r){e=t.stateNode,ri(ei.current);var a,i=null;switch(n){case"input":o=Q(e,o),r=Q(e,r),i=[];break;case"select":o=L({},o,{value:void 0}),r=L({},r,{value:void 0}),i=[];break;case"textarea":o=re(e,o),r=re(e,r),i=[];break;default:"function"!=typeof o.onClick&&"function"==typeof r.onClick&&(e.onclick=Zr)}for(u in ve(n,r),n=null,o)if(!r.hasOwnProperty(u)&&o.hasOwnProperty(u)&&null!=o[u])if("style"===u){var l=o[u];for(a in l)l.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(s.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var c=r[u];if(l=null!=o?o[u]:void 0,r.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(a in l)!l.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in c)c.hasOwnProperty(a)&&l[a]!==c[a]&&(n||(n={}),n[a]=c[a])}else n||(i||(i=[]),i.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(i=i||[]).push(u,c)):"children"===u?"string"!=typeof c&&"number"!=typeof c||(i=i||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(s.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&Dr("scroll",e),i||l===c||(i=[])):(i=i||[]).push(u,c))}n&&(i=i||[]).push("style",n);var u=i;(t.updateQueue=u)&&(t.flags|=4)}},Bs=function(e,t,n,r){n!==r&&(t.flags|=4)};var Ys=!1,Js=!1,Xs="function"==typeof WeakSet?WeakSet:Set,Zs=null;function el(e,t){var n=e.ref;if(null!==n)if("function"==typeof n)try{n(null)}catch(n){kc(e,t,n)}else n.current=null}function tl(e,t,n){try{n()}catch(n){kc(e,t,n)}}var nl=!1;function rl(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var o=r=r.next;do{if((o.tag&e)===e){var a=o.destroy;o.destroy=void 0,void 0!==a&&tl(t,n,a)}o=o.next}while(o!==r)}}function ol(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function al(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"==typeof t?t(e):t.current=e}}function il(e){var t=e.alternate;null!==t&&(e.alternate=null,il(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[po],delete t[go],delete t[mo],delete t[yo],delete t[vo])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function sl(e){return 5===e.tag||3===e.tag||4===e.tag}function ll(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||sl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function cl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=Zr));else if(4!==r&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}function ul(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(ul(e,t,n),e=e.sibling;null!==e;)ul(e,t,n),e=e.sibling}var dl=null,fl=!1;function pl(e,t,n){for(n=n.child;null!==n;)gl(e,t,n),n=n.sibling}function gl(e,t,n){if(at&&"function"==typeof at.onCommitFiberUnmount)try{at.onCommitFiberUnmount(ot,n)}catch(e){}switch(n.tag){case 5:Js||el(n,t);case 6:var r=dl,o=fl;dl=null,pl(e,t,n),fl=o,null!==(dl=r)&&(fl?(e=dl,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):dl.removeChild(n.stateNode));break;case 18:null!==dl&&(fl?(e=dl,n=n.stateNode,8===e.nodeType?lo(e.parentNode,n):1===e.nodeType&&lo(e,n),qt(e)):lo(dl,n.stateNode));break;case 4:r=dl,o=fl,dl=n.stateNode.containerInfo,fl=!0,pl(e,t,n),dl=r,fl=o;break;case 0:case 11:case 14:case 15:if(!Js&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){o=r=r.next;do{var a=o,i=a.destroy;a=a.tag,void 0!==i&&(2&a||4&a)&&tl(n,t,i),o=o.next}while(o!==r)}pl(e,t,n);break;case 1:if(!Js&&(el(n,t),"function"==typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(e){kc(n,t,e)}pl(e,t,n);break;case 21:pl(e,t,n);break;case 22:1&n.mode?(Js=(r=Js)||null!==n.memoizedState,pl(e,t,n),Js=r):pl(e,t,n);break;default:pl(e,t,n)}}function hl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Xs),t.forEach((function(t){var r=Tc.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function ml(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var o=n[r];try{var i=e,s=t,l=s;e:for(;null!==l;){switch(l.tag){case 5:dl=l.stateNode,fl=!1;break e;case 3:case 4:dl=l.stateNode.containerInfo,fl=!0;break e}l=l.return}if(null===dl)throw Error(a(160));gl(i,s,o),dl=null,fl=!1;var c=o.alternate;null!==c&&(c.return=null),o.return=null}catch(e){kc(o,t,e)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)yl(t,e),t=t.sibling}function yl(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ml(t,e),vl(e),4&r){try{rl(3,e,e.return),ol(3,e)}catch(t){kc(e,e.return,t)}try{rl(5,e,e.return)}catch(t){kc(e,e.return,t)}}break;case 1:ml(t,e),vl(e),512&r&&null!==n&&el(n,n.return);break;case 5:if(ml(t,e),vl(e),512&r&&null!==n&&el(n,n.return),32&e.flags){var o=e.stateNode;try{fe(o,"")}catch(t){kc(e,e.return,t)}}if(4&r&&null!=(o=e.stateNode)){var i=e.memoizedProps,s=null!==n?n.memoizedProps:i,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===i.type&&null!=i.name&&J(o,i),xe(l,s);var u=xe(l,i);for(s=0;s<c.length;s+=2){var d=c[s],f=c[s+1];"style"===d?me(o,f):"dangerouslySetInnerHTML"===d?de(o,f):"children"===d?fe(o,f):x(o,d,f,u)}switch(l){case"input":X(o,i);break;case"textarea":ae(o,i);break;case"select":var p=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!i.multiple;var g=i.value;null!=g?ne(o,!!i.multiple,g,!1):p!==!!i.multiple&&(null!=i.defaultValue?ne(o,!!i.multiple,i.defaultValue,!0):ne(o,!!i.multiple,i.multiple?[]:"",!1))}o[go]=i}catch(t){kc(e,e.return,t)}}break;case 6:if(ml(t,e),vl(e),4&r){if(null===e.stateNode)throw Error(a(162));o=e.stateNode,i=e.memoizedProps;try{o.nodeValue=i}catch(t){kc(e,e.return,t)}}break;case 3:if(ml(t,e),vl(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{qt(t.containerInfo)}catch(t){kc(e,e.return,t)}break;case 4:default:ml(t,e),vl(e);break;case 13:ml(t,e),vl(e),8192&(o=e.child).flags&&(i=null!==o.memoizedState,o.stateNode.isHidden=i,!i||null!==o.alternate&&null!==o.alternate.memoizedState||(ql=Je())),4&r&&hl(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?(Js=(u=Js)||d,ml(t,e),Js=u):ml(t,e),vl(e),8192&r){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&1&e.mode)for(Zs=e,d=e.child;null!==d;){for(f=Zs=d;null!==Zs;){switch(g=(p=Zs).child,p.tag){case 0:case 11:case 14:case 15:rl(4,p,p.return);break;case 1:el(p,p.return);var h=p.stateNode;if("function"==typeof h.componentWillUnmount){r=p,n=p.return;try{t=r,h.props=t.memoizedProps,h.state=t.memoizedState,h.componentWillUnmount()}catch(e){kc(r,n,e)}}break;case 5:el(p,p.return);break;case 22:if(null!==p.memoizedState){Sl(f);continue}}null!==g?(g.return=p,Zs=g):Sl(f)}d=d.sibling}e:for(d=null,f=e;;){if(5===f.tag){if(null===d){d=f;try{o=f.stateNode,u?"function"==typeof(i=o.style).setProperty?i.setProperty("display","none","important"):i.display="none":(l=f.stateNode,s=null!=(c=f.memoizedProps.style)&&c.hasOwnProperty("display")?c.display:null,l.style.display=he("display",s))}catch(t){kc(e,e.return,t)}}}else if(6===f.tag){if(null===d)try{f.stateNode.nodeValue=u?"":f.memoizedProps}catch(t){kc(e,e.return,t)}}else if((22!==f.tag&&23!==f.tag||null===f.memoizedState||f===e)&&null!==f.child){f.child.return=f,f=f.child;continue}if(f===e)break e;for(;null===f.sibling;){if(null===f.return||f.return===e)break e;d===f&&(d=null),f=f.return}d===f&&(d=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:ml(t,e),vl(e),4&r&&hl(e);case 21:}}function vl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(sl(n)){var r=n;break e}n=n.return}throw Error(a(160))}switch(r.tag){case 5:var o=r.stateNode;32&r.flags&&(fe(o,""),r.flags&=-33),ul(e,ll(e),o);break;case 3:case 4:var i=r.stateNode.containerInfo;cl(e,ll(e),i);break;default:throw Error(a(161))}}catch(t){kc(e,e.return,t)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function xl(e,t,n){Zs=e,bl(e,t,n)}function bl(e,t,n){for(var r=!!(1&e.mode);null!==Zs;){var o=Zs,a=o.child;if(22===o.tag&&r){var i=null!==o.memoizedState||Ys;if(!i){var s=o.alternate,l=null!==s&&null!==s.memoizedState||Js;s=Ys;var c=Js;if(Ys=i,(Js=l)&&!c)for(Zs=o;null!==Zs;)l=(i=Zs).child,22===i.tag&&null!==i.memoizedState?Cl(o):null!==l?(l.return=i,Zs=l):Cl(o);for(;null!==a;)Zs=a,bl(a,t,n),a=a.sibling;Zs=o,Ys=s,Js=c}wl(e)}else 8772&o.subtreeFlags&&null!==a?(a.return=o,Zs=a):wl(e)}}function wl(e){for(;null!==Zs;){var t=Zs;if(8772&t.flags){var n=t.alternate;try{if(8772&t.flags)switch(t.tag){case 0:case 11:case 15:Js||ol(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Js)if(null===n)r.componentDidMount();else{var o=t.elementType===t.type?n.memoizedProps:ya(t.type,n.memoizedProps);r.componentDidUpdate(o,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;null!==i&&Da(t,i,r);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Da(t,s,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var f=d.dehydrated;null!==f&&qt(f)}}}break;default:throw Error(a(163))}Js||512&t.flags&&al(t)}catch(e){kc(t,t.return,e)}}if(t===e){Zs=null;break}if(null!==(n=t.sibling)){n.return=t.return,Zs=n;break}Zs=t.return}}function Sl(e){for(;null!==Zs;){var t=Zs;if(t===e){Zs=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Zs=n;break}Zs=t.return}}function Cl(e){for(;null!==Zs;){var t=Zs;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{ol(4,t)}catch(e){kc(t,n,e)}break;case 1:var r=t.stateNode;if("function"==typeof r.componentDidMount){var o=t.return;try{r.componentDidMount()}catch(e){kc(t,o,e)}}var a=t.return;try{al(t)}catch(e){kc(t,a,e)}break;case 5:var i=t.return;try{al(t)}catch(e){kc(t,i,e)}}}catch(e){kc(t,t.return,e)}if(t===e){Zs=null;break}var s=t.sibling;if(null!==s){s.return=t.return,Zs=s;break}Zs=t.return}}var El,kl=Math.ceil,Il=b.ReactCurrentDispatcher,Al=b.ReactCurrentOwner,_l=b.ReactCurrentBatchConfig,Tl=0,jl=null,Fl=null,Rl=0,Ol=0,Pl=ko(0),Bl=0,Nl=null,Ll=0,zl=0,Dl=0,Ml=null,Ul=null,ql=0,Wl=1/0,Vl=null,$l=!1,Gl=null,Hl=null,Kl=!1,Ql=null,Yl=0,Jl=0,Xl=null,Zl=-1,ec=0;function tc(){return 6&Tl?Je():-1!==Zl?Zl:Zl=Je()}function nc(e){return 1&e.mode?2&Tl&&0!==Rl?Rl&-Rl:null!==ma.transition?(0===ec&&(ec=ht()),ec):0!==(e=xt)?e:e=void 0===(e=window.event)?16:Yt(e.type):1}function rc(e,t,n,r){if(50<Jl)throw Jl=0,Xl=null,Error(a(185));yt(e,n,r),2&Tl&&e===jl||(e===jl&&(!(2&Tl)&&(zl|=n),4===Bl&&lc(e,Rl)),oc(e,r),1===n&&0===Tl&&!(1&t.mode)&&(Wl=Je()+500,Mo&&Wo()))}function oc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,o=e.expirationTimes,a=e.pendingLanes;0<a;){var i=31-it(a),s=1<<i,l=o[i];-1===l?s&n&&!(s&r)||(o[i]=pt(s,t)):l<=t&&(e.expiredLanes|=s),a&=~s}}(e,t);var r=ft(e,e===jl?Rl:0);if(0===r)null!==n&&Ke(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Ke(n),1===t)0===e.tag?function(e){Mo=!0,qo(e)}(cc.bind(null,e)):qo(cc.bind(null,e)),io((function(){!(6&Tl)&&Wo()})),n=null;else{switch(bt(r)){case 1:n=Ze;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=jc(n,ac.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function ac(e,t){if(Zl=-1,ec=0,6&Tl)throw Error(a(327));var n=e.callbackNode;if(Cc()&&e.callbackNode!==n)return null;var r=ft(e,e===jl?Rl:0);if(0===r)return null;if(30&r||r&e.expiredLanes||t)t=yc(e,r);else{t=r;var o=Tl;Tl|=2;var i=hc();for(jl===e&&Rl===t||(Vl=null,Wl=Je()+500,pc(e,t));;)try{xc();break}catch(t){gc(e,t)}Sa(),Il.current=i,Tl=o,null!==Fl?t=0:(jl=null,Rl=0,t=Bl)}if(0!==t){if(2===t&&(0!==(o=gt(e))&&(r=o,t=ic(e,o))),1===t)throw n=Nl,pc(e,0),lc(e,r),oc(e,Je()),n;if(6===t)lc(e,r);else{if(o=e.current.alternate,!(30&r||function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var o=n[r],a=o.getSnapshot;o=o.value;try{if(!sr(a(),o))return!1}catch(e){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(o)||(t=yc(e,r),2===t&&(i=gt(e),0!==i&&(r=i,t=ic(e,i))),1!==t)))throw n=Nl,pc(e,0),lc(e,r),oc(e,Je()),n;switch(e.finishedWork=o,e.finishedLanes=r,t){case 0:case 1:throw Error(a(345));case 2:case 5:Sc(e,Ul,Vl);break;case 3:if(lc(e,r),(130023424&r)===r&&10<(t=ql+500-Je())){if(0!==ft(e,0))break;if(((o=e.suspendedLanes)&r)!==r){tc(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=ro(Sc.bind(null,e,Ul,Vl),t);break}Sc(e,Ul,Vl);break;case 4:if(lc(e,r),(4194240&r)===r)break;for(t=e.eventTimes,o=-1;0<r;){var s=31-it(r);i=1<<s,(s=t[s])>o&&(o=s),r&=~i}if(r=o,10<(r=(120>(r=Je()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*kl(r/1960))-r)){e.timeoutHandle=ro(Sc.bind(null,e,Ul,Vl),r);break}Sc(e,Ul,Vl);break;default:throw Error(a(329))}}}return oc(e,Je()),e.callbackNode===n?ac.bind(null,e):null}function ic(e,t){var n=Ml;return e.current.memoizedState.isDehydrated&&(pc(e,t).flags|=256),2!==(e=yc(e,t))&&(t=Ul,Ul=n,null!==t&&sc(t)),e}function sc(e){null===Ul?Ul=e:Ul.push.apply(Ul,e)}function lc(e,t){for(t&=~Dl,t&=~zl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-it(t),r=1<<n;e[n]=-1,t&=~r}}function cc(e){if(6&Tl)throw Error(a(327));Cc();var t=ft(e,0);if(!(1&t))return oc(e,Je()),null;var n=yc(e,t);if(0!==e.tag&&2===n){var r=gt(e);0!==r&&(t=r,n=ic(e,r))}if(1===n)throw n=Nl,pc(e,0),lc(e,t),oc(e,Je()),n;if(6===n)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Sc(e,Ul,Vl),oc(e,Je()),null}function uc(e,t){var n=Tl;Tl|=1;try{return e(t)}finally{0===(Tl=n)&&(Wl=Je()+500,Mo&&Wo())}}function dc(e){null!==Ql&&0===Ql.tag&&!(6&Tl)&&Cc();var t=Tl;Tl|=1;var n=_l.transition,r=xt;try{if(_l.transition=null,xt=1,e)return e()}finally{xt=r,_l.transition=n,!(6&(Tl=t))&&Wo()}}function fc(){Ol=Pl.current,Io(Pl)}function pc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,oo(n)),null!==Fl)for(n=Fl.return;null!==n;){var r=n;switch(na(r),r.tag){case 1:null!=(r=r.type.childContextTypes)&&Po();break;case 3:ai(),Io(jo),Io(To),di();break;case 5:si(r);break;case 4:ai();break;case 13:case 19:Io(li);break;case 10:Ca(r.type._context);break;case 22:case 23:fc()}n=n.return}if(jl=e,Fl=e=Pc(e.current,null),Rl=Ol=t,Bl=0,Nl=null,Dl=zl=Ll=0,Ul=Ml=null,null!==Aa){for(t=0;t<Aa.length;t++)if(null!==(r=(n=Aa[t]).interleaved)){n.interleaved=null;var o=r.next,a=n.pending;if(null!==a){var i=a.next;a.next=o,r.next=i}n.pending=r}Aa=null}return e}function gc(e,t){for(;;){var n=Fl;try{if(Sa(),fi.current=is,vi){for(var r=hi.memoizedState;null!==r;){var o=r.queue;null!==o&&(o.pending=null),r=r.next}vi=!1}if(gi=0,yi=mi=hi=null,xi=!1,bi=0,Al.current=null,null===n||null===n.return){Bl=1,Nl=t,Fl=null;break}e:{var i=e,s=n.return,l=n,c=t;if(t=Rl,l.flags|=32768,null!==c&&"object"==typeof c&&"function"==typeof c.then){var u=c,d=l,f=d.tag;if(!(1&d.mode||0!==f&&11!==f&&15!==f)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var g=ys(s);if(null!==g){g.flags&=-257,vs(g,s,l,0,t),1&g.mode&&ms(i,u,t),c=u;var h=(t=g).updateQueue;if(null===h){var m=new Set;m.add(c),t.updateQueue=m}else h.add(c);break e}if(!(1&t)){ms(i,u,t),mc();break e}c=Error(a(426))}else if(aa&&1&l.mode){var y=ys(s);if(null!==y){!(65536&y.flags)&&(y.flags|=256),vs(y,s,l,0,t),ha(us(c,l));break e}}i=c=us(c,l),4!==Bl&&(Bl=2),null===Ml?Ml=[i]:Ml.push(i),i=s;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t,La(i,gs(0,c,t));break e;case 1:l=c;var v=i.type,x=i.stateNode;if(!(128&i.flags||"function"!=typeof v.getDerivedStateFromError&&(null===x||"function"!=typeof x.componentDidCatch||null!==Hl&&Hl.has(x)))){i.flags|=65536,t&=-t,i.lanes|=t,La(i,hs(i,l,t));break e}}i=i.return}while(null!==i)}wc(n)}catch(e){t=e,Fl===n&&null!==n&&(Fl=n=n.return);continue}break}}function hc(){var e=Il.current;return Il.current=is,null===e?is:e}function mc(){0!==Bl&&3!==Bl&&2!==Bl||(Bl=4),null===jl||!(268435455&Ll)&&!(268435455&zl)||lc(jl,Rl)}function yc(e,t){var n=Tl;Tl|=2;var r=hc();for(jl===e&&Rl===t||(Vl=null,pc(e,t));;)try{vc();break}catch(t){gc(e,t)}if(Sa(),Tl=n,Il.current=r,null!==Fl)throw Error(a(261));return jl=null,Rl=0,Bl}function vc(){for(;null!==Fl;)bc(Fl)}function xc(){for(;null!==Fl&&!Qe();)bc(Fl)}function bc(e){var t=El(e.alternate,e,Ol);e.memoizedProps=e.pendingProps,null===t?wc(e):Fl=t,Al.current=null}function wc(e){var t=e;do{var n=t.alternate;if(e=t.return,32768&t.flags){if(null!==(n=Qs(n,t)))return n.flags&=32767,void(Fl=n);if(null===e)return Bl=6,void(Fl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}else if(null!==(n=Ks(n,t,Ol)))return void(Fl=n);if(null!==(t=t.sibling))return void(Fl=t);Fl=t=e}while(null!==t);0===Bl&&(Bl=5)}function Sc(e,t,n){var r=xt,o=_l.transition;try{_l.transition=null,xt=1,function(e,t,n,r){do{Cc()}while(null!==Ql);if(6&Tl)throw Error(a(327));n=e.finishedWork;var o=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var i=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var o=31-it(n),a=1<<o;t[o]=0,r[o]=-1,e[o]=-1,n&=~a}}(e,i),e===jl&&(Fl=jl=null,Rl=0),!(2064&n.subtreeFlags)&&!(2064&n.flags)||Kl||(Kl=!0,jc(tt,(function(){return Cc(),null}))),i=!!(15990&n.flags),!!(15990&n.subtreeFlags)||i){i=_l.transition,_l.transition=null;var s=xt;xt=1;var l=Tl;Tl|=4,Al.current=null,function(e,t){if(eo=Vt,pr(e=fr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var o=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch(e){n=null;break e}var s=0,l=-1,c=-1,u=0,d=0,f=e,p=null;t:for(;;){for(var g;f!==n||0!==o&&3!==f.nodeType||(l=s+o),f!==i||0!==r&&3!==f.nodeType||(c=s+r),3===f.nodeType&&(s+=f.nodeValue.length),null!==(g=f.firstChild);)p=f,f=g;for(;;){if(f===e)break t;if(p===n&&++u===o&&(l=s),p===i&&++d===r&&(c=s),null!==(g=f.nextSibling))break;p=(f=p).parentNode}f=g}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(to={focusedElem:e,selectionRange:n},Vt=!1,Zs=t;null!==Zs;)if(e=(t=Zs).child,1028&t.subtreeFlags&&null!==e)e.return=t,Zs=e;else for(;null!==Zs;){t=Zs;try{var h=t.alternate;if(1024&t.flags)switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==h){var m=h.memoizedProps,y=h.memoizedState,v=t.stateNode,x=v.getSnapshotBeforeUpdate(t.elementType===t.type?m:ya(t.type,m),y);v.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var b=t.stateNode.containerInfo;1===b.nodeType?b.textContent="":9===b.nodeType&&b.documentElement&&b.removeChild(b.documentElement);break;default:throw Error(a(163))}}catch(e){kc(t,t.return,e)}if(null!==(e=t.sibling)){e.return=t.return,Zs=e;break}Zs=t.return}h=nl,nl=!1}(e,n),yl(n,e),gr(to),Vt=!!eo,to=eo=null,e.current=n,xl(n,e,o),Ye(),Tl=l,xt=s,_l.transition=i}else e.current=n;if(Kl&&(Kl=!1,Ql=e,Yl=o),i=e.pendingLanes,0===i&&(Hl=null),function(e){if(at&&"function"==typeof at.onCommitFiberRoot)try{at.onCommitFiberRoot(ot,e,void 0,!(128&~e.current.flags))}catch(e){}}(n.stateNode),oc(e,Je()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)o=t[n],r(o.value,{componentStack:o.stack,digest:o.digest});if($l)throw $l=!1,e=Gl,Gl=null,e;!!(1&Yl)&&0!==e.tag&&Cc(),i=e.pendingLanes,1&i?e===Xl?Jl++:(Jl=0,Xl=e):Jl=0,Wo()}(e,t,n,r)}finally{_l.transition=o,xt=r}return null}function Cc(){if(null!==Ql){var e=bt(Yl),t=_l.transition,n=xt;try{if(_l.transition=null,xt=16>e?16:e,null===Ql)var r=!1;else{if(e=Ql,Ql=null,Yl=0,6&Tl)throw Error(a(331));var o=Tl;for(Tl|=4,Zs=e.current;null!==Zs;){var i=Zs,s=i.child;if(16&Zs.flags){var l=i.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Zs=u;null!==Zs;){var d=Zs;switch(d.tag){case 0:case 11:case 15:rl(8,d,i)}var f=d.child;if(null!==f)f.return=d,Zs=f;else for(;null!==Zs;){var p=(d=Zs).sibling,g=d.return;if(il(d),d===u){Zs=null;break}if(null!==p){p.return=g,Zs=p;break}Zs=g}}}var h=i.alternate;if(null!==h){var m=h.child;if(null!==m){h.child=null;do{var y=m.sibling;m.sibling=null,m=y}while(null!==m)}}Zs=i}}if(2064&i.subtreeFlags&&null!==s)s.return=i,Zs=s;else e:for(;null!==Zs;){if(2048&(i=Zs).flags)switch(i.tag){case 0:case 11:case 15:rl(9,i,i.return)}var v=i.sibling;if(null!==v){v.return=i.return,Zs=v;break e}Zs=i.return}}var x=e.current;for(Zs=x;null!==Zs;){var b=(s=Zs).child;if(2064&s.subtreeFlags&&null!==b)b.return=s,Zs=b;else e:for(s=x;null!==Zs;){if(2048&(l=Zs).flags)try{switch(l.tag){case 0:case 11:case 15:ol(9,l)}}catch(e){kc(l,l.return,e)}if(l===s){Zs=null;break e}var w=l.sibling;if(null!==w){w.return=l.return,Zs=w;break e}Zs=l.return}}if(Tl=o,Wo(),at&&"function"==typeof at.onPostCommitFiberRoot)try{at.onPostCommitFiberRoot(ot,e)}catch(e){}r=!0}return r}finally{xt=n,_l.transition=t}}return!1}function Ec(e,t,n){e=Ba(e,t=gs(0,t=us(n,t),1),1),t=tc(),null!==e&&(yt(e,1,t),oc(e,t))}function kc(e,t,n){if(3===e.tag)Ec(e,e,n);else for(;null!==t;){if(3===t.tag){Ec(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===Hl||!Hl.has(r))){t=Ba(t,e=hs(t,e=us(n,e),1),1),e=tc(),null!==t&&(yt(t,1,e),oc(t,e));break}}t=t.return}}function Ic(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=tc(),e.pingedLanes|=e.suspendedLanes&n,jl===e&&(Rl&n)===n&&(4===Bl||3===Bl&&(130023424&Rl)===Rl&&500>Je()-ql?pc(e,0):Dl|=n),oc(e,t)}function Ac(e,t){0===t&&(1&e.mode?(t=ut,!(130023424&(ut<<=1))&&(ut=4194304)):t=1);var n=tc();null!==(e=ja(e,t))&&(yt(e,t,n),oc(e,n))}function _c(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Ac(e,n)}function Tc(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,o=e.memoizedState;null!==o&&(n=o.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(a(314))}null!==r&&r.delete(t),Ac(e,n)}function jc(e,t){return He(e,t)}function Fc(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Rc(e,t,n,r){return new Fc(e,t,n,r)}function Oc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Pc(e,t){var n=e.alternate;return null===n?((n=Rc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Bc(e,t,n,r,o,i){var s=2;if(r=e,"function"==typeof e)Oc(e)&&(s=1);else if("string"==typeof e)s=5;else e:switch(e){case C:return Nc(n.children,o,i,t);case E:s=8,o|=8;break;case k:return(e=Rc(12,n,t,2|o)).elementType=k,e.lanes=i,e;case T:return(e=Rc(13,n,t,o)).elementType=T,e.lanes=i,e;case j:return(e=Rc(19,n,t,o)).elementType=j,e.lanes=i,e;case O:return Lc(n,o,i,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case I:s=10;break e;case A:s=9;break e;case _:s=11;break e;case F:s=14;break e;case R:s=16,r=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=Rc(s,n,t,o)).elementType=e,t.type=r,t.lanes=i,t}function Nc(e,t,n,r){return(e=Rc(7,e,r,t)).lanes=n,e}function Lc(e,t,n,r){return(e=Rc(22,e,r,t)).elementType=O,e.lanes=n,e.stateNode={isHidden:!1},e}function zc(e,t,n){return(e=Rc(6,e,null,t)).lanes=n,e}function Dc(e,t,n){return(t=Rc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Mc(e,t,n,r,o){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mt(0),this.expirationTimes=mt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mt(0),this.identifierPrefix=r,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function Uc(e,t,n,r,o,a,i,s,l){return e=new Mc(e,t,n,s,l),1===t?(t=1,!0===a&&(t|=8)):t=0,a=Rc(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ra(a),e}function qc(e){if(!e)return _o;e:{if(qe(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Oo(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var n=e.type;if(Oo(n))return No(e,n,t)}return t}function Wc(e,t,n,r,o,a,i,s,l){return(e=Uc(n,r,!0,e,0,a,0,s,l)).context=qc(null),n=e.current,(a=Pa(r=tc(),o=nc(n))).callback=null!=t?t:null,Ba(n,a,o),e.current.lanes=o,yt(e,o,r),oc(e,r),e}function Vc(e,t,n,r){var o=t.current,a=tc(),i=nc(o);return n=qc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Pa(a,i)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Ba(o,t,i))&&(rc(e,o,i,a),Na(e,o,i)),i}function $c(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Gc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Hc(e,t){Gc(e,t),(e=e.alternate)&&Gc(e,t)}El=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||jo.current)bs=!0;else{if(!(e.lanes&n||128&t.flags))return bs=!1,function(e,t,n){switch(t.tag){case 3:js(t),ga();break;case 5:ii(t);break;case 1:Oo(t.type)&&Lo(t);break;case 4:oi(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,o=t.memoizedProps.value;Ao(va,r._currentValue),r._currentValue=o;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ao(li,1&li.current),t.flags|=128,null):n&t.child.childLanes?zs(e,t,n):(Ao(li,1&li.current),null!==(e=$s(e,t,n))?e.sibling:null);Ao(li,1&li.current);break;case 19:if(r=!!(n&t.childLanes),128&e.flags){if(r)return Ws(e,t,n);t.flags|=128}if(null!==(o=t.memoizedState)&&(o.rendering=null,o.tail=null,o.lastEffect=null),Ao(li,li.current),r)break;return null;case 22:case 23:return t.lanes=0,ks(e,t,n)}return $s(e,t,n)}(e,t,n);bs=!!(131072&e.flags)}else bs=!1,aa&&1048576&t.flags&&ea(t,Ho,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Vs(e,t),e=t.pendingProps;var o=Ro(t,To.current);ka(t,n),o=Ei(null,t,r,e,o,n);var i=ki();return t.flags|=1,"object"==typeof o&&null!==o&&"function"==typeof o.render&&void 0===o.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Oo(r)?(i=!0,Lo(t)):i=!1,t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null,Ra(t),o.updater=qa,t.stateNode=o,o._reactInternals=t,Ga(t,r,e,n),t=Ts(null,t,r,!0,i,n)):(t.tag=0,aa&&i&&ta(t),ws(null,t,o,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Vs(e,t),e=t.pendingProps,r=(o=r._init)(r._payload),t.type=r,o=t.tag=function(e){if("function"==typeof e)return Oc(e)?1:0;if(null!=e){if((e=e.$$typeof)===_)return 11;if(e===F)return 14}return 2}(r),e=ya(r,e),o){case 0:t=As(null,t,r,e,n);break e;case 1:t=_s(null,t,r,e,n);break e;case 11:t=Ss(null,t,r,e,n);break e;case 14:t=Cs(null,t,r,ya(r.type,e),n);break e}throw Error(a(306,r,""))}return t;case 0:return r=t.type,o=t.pendingProps,As(e,t,r,o=t.elementType===r?o:ya(r,o),n);case 1:return r=t.type,o=t.pendingProps,_s(e,t,r,o=t.elementType===r?o:ya(r,o),n);case 3:e:{if(js(t),null===e)throw Error(a(387));r=t.pendingProps,o=(i=t.memoizedState).element,Oa(e,t),za(t,r,null,n);var s=t.memoizedState;if(r=s.element,i.isDehydrated){if(i={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=i,t.memoizedState=i,256&t.flags){t=Fs(e,t,r,n,o=us(Error(a(423)),t));break e}if(r!==o){t=Fs(e,t,r,n,o=us(Error(a(424)),t));break e}for(oa=co(t.stateNode.containerInfo.firstChild),ra=t,aa=!0,ia=null,n=Xa(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(ga(),r===o){t=$s(e,t,n);break e}ws(e,t,r,n)}t=t.child}return t;case 5:return ii(t),null===e&&ua(t),r=t.type,o=t.pendingProps,i=null!==e?e.memoizedProps:null,s=o.children,no(r,o)?s=null:null!==i&&no(r,i)&&(t.flags|=32),Is(e,t),ws(e,t,s,n),t.child;case 6:return null===e&&ua(t),null;case 13:return zs(e,t,n);case 4:return oi(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Ja(t,null,r,n):ws(e,t,r,n),t.child;case 11:return r=t.type,o=t.pendingProps,Ss(e,t,r,o=t.elementType===r?o:ya(r,o),n);case 7:return ws(e,t,t.pendingProps,n),t.child;case 8:case 12:return ws(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,o=t.pendingProps,i=t.memoizedProps,s=o.value,Ao(va,r._currentValue),r._currentValue=s,null!==i)if(sr(i.value,s)){if(i.children===o.children&&!jo.current){t=$s(e,t,n);break e}}else for(null!==(i=t.child)&&(i.return=t);null!==i;){var l=i.dependencies;if(null!==l){s=i.child;for(var c=l.firstContext;null!==c;){if(c.context===r){if(1===i.tag){(c=Pa(-1,n&-n)).tag=2;var u=i.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}i.lanes|=n,null!==(c=i.alternate)&&(c.lanes|=n),Ea(i.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===i.tag)s=i.type===t.type?null:i.child;else if(18===i.tag){if(null===(s=i.return))throw Error(a(341));s.lanes|=n,null!==(l=s.alternate)&&(l.lanes|=n),Ea(s,n,t),s=i.sibling}else s=i.child;if(null!==s)s.return=i;else for(s=i;null!==s;){if(s===t){s=null;break}if(null!==(i=s.sibling)){i.return=s.return,s=i;break}s=s.return}i=s}ws(e,t,o.children,n),t=t.child}return t;case 9:return o=t.type,r=t.pendingProps.children,ka(t,n),r=r(o=Ia(o)),t.flags|=1,ws(e,t,r,n),t.child;case 14:return o=ya(r=t.type,t.pendingProps),Cs(e,t,r,o=ya(r.type,o),n);case 15:return Es(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:ya(r,o),Vs(e,t),t.tag=1,Oo(r)?(e=!0,Lo(t)):e=!1,ka(t,n),Va(t,r,o),Ga(t,r,o,n),Ts(null,t,r,!0,e,n);case 19:return Ws(e,t,n);case 22:return ks(e,t,n)}throw Error(a(156,t.tag))};var Kc="function"==typeof reportError?reportError:function(e){console.error(e)};function Qc(e){this._internalRoot=e}function Yc(e){this._internalRoot=e}function Jc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Xc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Zc(){}function eu(e,t,n,r,o){var a=n._reactRootContainer;if(a){var i=a;if("function"==typeof o){var s=o;o=function(){var e=$c(i);s.call(e)}}Vc(t,i,e,o)}else i=function(e,t,n,r,o){if(o){if("function"==typeof r){var a=r;r=function(){var e=$c(i);a.call(e)}}var i=Wc(t,r,e,0,null,!1,0,"",Zc);return e._reactRootContainer=i,e[ho]=i.current,qr(8===e.nodeType?e.parentNode:e),dc(),i}for(;o=e.lastChild;)e.removeChild(o);if("function"==typeof r){var s=r;r=function(){var e=$c(l);s.call(e)}}var l=Uc(e,0,!1,null,0,!1,0,"",Zc);return e._reactRootContainer=l,e[ho]=l.current,qr(8===e.nodeType?e.parentNode:e),dc((function(){Vc(t,l,n,r)})),l}(n,t,e,o,r);return $c(i)}Yc.prototype.render=Qc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));Vc(e,t,null,null)},Yc.prototype.unmount=Qc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;dc((function(){Vc(null,e,null,null)})),t[ho]=null}},Yc.prototype.unstable_scheduleHydration=function(e){if(e){var t=Et();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Ot.length&&0!==t&&t<Ot[n].priority;n++);Ot.splice(n,0,e),0===n&&Lt(e)}},wt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(vt(t,1|n),oc(t,Je()),!(6&Tl)&&(Wl=Je()+500,Wo()))}break;case 13:dc((function(){var t=ja(e,1);if(null!==t){var n=tc();rc(t,e,1,n)}})),Hc(e,1)}},St=function(e){if(13===e.tag){var t=ja(e,134217728);if(null!==t)rc(t,e,134217728,tc());Hc(e,134217728)}},Ct=function(e){if(13===e.tag){var t=nc(e),n=ja(e,t);if(null!==n)rc(n,e,t,tc());Hc(e,t)}},Et=function(){return xt},kt=function(e,t){var n=xt;try{return xt=e,t()}finally{xt=n}},Se=function(e,t,n){switch(t){case"input":if(X(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var o=So(r);if(!o)throw Error(a(90));H(r),X(r,o)}}}break;case"textarea":ae(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},_e=uc,Te=dc;var tu={usingClientEntryPoint:!1,Events:[bo,wo,So,Ie,Ae,uc]},nu={findFiberByHostInstance:xo,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},ru={bundleType:nu.bundleType,version:nu.version,rendererPackageName:nu.rendererPackageName,rendererConfig:nu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=$e(e))?null:e.stateNode},findFiberByHostInstance:nu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ou=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ou.isDisabled&&ou.supportsFiber)try{ot=ou.inject(ru),at=ou}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Jc(t))throw Error(a(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:S,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Jc(e))throw Error(a(299));var n=!1,r="",o=Kc;return null!=t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(o=t.onRecoverableError)),t=Uc(e,1,!1,null,0,n,0,r,o),e[ho]=t.current,qr(8===e.nodeType?e.parentNode:e),new Qc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=null===(e=$e(t))?null:e.stateNode},t.flushSync=function(e){return dc(e)},t.hydrate=function(e,t,n){if(!Xc(t))throw Error(a(200));return eu(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Jc(e))throw Error(a(405));var r=null!=n&&n.hydratedSources||null,o=!1,i="",s=Kc;if(null!=n&&(!0===n.unstable_strictMode&&(o=!0),void 0!==n.identifierPrefix&&(i=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Wc(t,null,e,1,null!=n?n:null,o,0,i,s),e[ho]=t.current,qr(e),r)for(e=0;e<r.length;e++)o=(o=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,o]:t.mutableSourceEagerHydrationData.push(n,o);return new Yc(t)},t.render=function(e,t,n){if(!Xc(t))throw Error(a(200));return eu(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Xc(e))throw Error(a(40));return!!e._reactRootContainer&&(dc((function(){eu(null,null,e,!1,(function(){e._reactRootContainer=null,e[ho]=null}))})),!0)},t.unstable_batchedUpdates=uc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Xc(n))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return eu(e,t,n,!1,r)},t.version="18.2.0-next-9e3b772b8-20220608"},338:(e,t,n)=>{var r=n(961);t.H=r.createRoot,r.hydrateRoot},961:(e,t,n)=>{!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=n(551)},799:(e,t)=>{
/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var n="function"==typeof Symbol&&Symbol.for,r=n?Symbol.for("react.element"):60103,o=n?Symbol.for("react.portal"):60106,a=n?Symbol.for("react.fragment"):60107,i=n?Symbol.for("react.strict_mode"):60108,s=n?Symbol.for("react.profiler"):60114,l=n?Symbol.for("react.provider"):60109,c=n?Symbol.for("react.context"):60110,u=n?Symbol.for("react.async_mode"):60111,d=n?Symbol.for("react.concurrent_mode"):60111,f=n?Symbol.for("react.forward_ref"):60112,p=n?Symbol.for("react.suspense"):60113,g=n?Symbol.for("react.suspense_list"):60120,h=n?Symbol.for("react.memo"):60115,m=n?Symbol.for("react.lazy"):60116,y=n?Symbol.for("react.block"):60121,v=n?Symbol.for("react.fundamental"):60117,x=n?Symbol.for("react.responder"):60118,b=n?Symbol.for("react.scope"):60119;function w(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type){case u:case d:case a:case s:case i:case p:return e;default:switch(e=e&&e.$$typeof){case c:case f:case m:case h:case l:return e;default:return t}}case o:return t}}}function S(e){return w(e)===d}t.AsyncMode=u,t.ConcurrentMode=d,t.ContextConsumer=c,t.ContextProvider=l,t.Element=r,t.ForwardRef=f,t.Fragment=a,t.Lazy=m,t.Memo=h,t.Portal=o,t.Profiler=s,t.StrictMode=i,t.Suspense=p,t.isAsyncMode=function(e){return S(e)||w(e)===u},t.isConcurrentMode=S,t.isContextConsumer=function(e){return w(e)===c},t.isContextProvider=function(e){return w(e)===l},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===r},t.isForwardRef=function(e){return w(e)===f},t.isFragment=function(e){return w(e)===a},t.isLazy=function(e){return w(e)===m},t.isMemo=function(e){return w(e)===h},t.isPortal=function(e){return w(e)===o},t.isProfiler=function(e){return w(e)===s},t.isStrictMode=function(e){return w(e)===i},t.isSuspense=function(e){return w(e)===p},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===a||e===d||e===s||e===i||e===p||e===g||"object"==typeof e&&null!==e&&(e.$$typeof===m||e.$$typeof===h||e.$$typeof===l||e.$$typeof===c||e.$$typeof===f||e.$$typeof===v||e.$$typeof===x||e.$$typeof===b||e.$$typeof===y)},t.typeOf=w},363:(e,t,n)=>{e.exports=n(799)},989:(e,t)=>{var n,r=Symbol.for("react.element"),o=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),c=Symbol.for("react.context"),u=Symbol.for("react.server_context"),d=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),p=Symbol.for("react.suspense_list"),g=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),m=Symbol.for("react.offscreen");
/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */function y(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type){case a:case s:case i:case f:case p:return e;default:switch(e=e&&e.$$typeof){case u:case c:case d:case h:case g:case l:return e;default:return t}}case o:return t}}}n=Symbol.for("react.module.reference")},737:(e,t,n)=>{n(989)},20:(e,t,n)=>{
/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var r=n(540),o=Symbol.for("react.element"),a=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,a={},c=null,u=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)i.call(t,r)&&!l.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===a[r]&&(a[r]=t[r]);return{$$typeof:o,type:e,key:c,ref:u,props:a,_owner:s.current}}t.Fragment=a,t.jsx=c,t.jsxs=c},287:(e,t)=>{
/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),p=Symbol.iterator;var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},h=Object.assign,m={};function y(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||g}function v(){}function x(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||g}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=y.prototype;var b=x.prototype=new v;b.constructor=x,h(b,y.prototype),b.isPureReactComponent=!0;var w=Array.isArray,S=Object.prototype.hasOwnProperty,C={current:null},E={key:!0,ref:!0,__self:!0,__source:!0};function k(e,t,r){var o,a={},i=null,s=null;if(null!=t)for(o in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(i=""+t.key),t)S.call(t,o)&&!E.hasOwnProperty(o)&&(a[o]=t[o]);var l=arguments.length-2;if(1===l)a.children=r;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];a.children=c}if(e&&e.defaultProps)for(o in l=e.defaultProps)void 0===a[o]&&(a[o]=l[o]);return{$$typeof:n,type:e,key:i,ref:s,props:a,_owner:C.current}}function I(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var A=/\/+/g;function _(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function T(e,t,o,a,i){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var l=!1;if(null===e)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case r:l=!0}}if(l)return i=i(l=e),e=""===a?"."+_(l,0):a,w(i)?(o="",null!=e&&(o=e.replace(A,"$&/")+"/"),T(i,t,o,"",(function(e){return e}))):null!=i&&(I(i)&&(i=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(i,o+(!i.key||l&&l.key===i.key?"":(""+i.key).replace(A,"$&/")+"/")+e)),t.push(i)),1;if(l=0,a=""===a?".":a+":",w(e))for(var c=0;c<e.length;c++){var u=a+_(s=e[c],c);l+=T(s,t,o,u,i)}else if(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"==typeof u)for(e=u.call(e),c=0;!(s=e.next()).done;)l+=T(s=s.value,t,o,u=a+_(s,c++),i);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function j(e,t,n){if(null==e)return e;var r=[],o=0;return T(e,r,"","",(function(e){return t.call(n,e,o++)})),r}function F(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var R={current:null},O={transition:null},P={ReactCurrentDispatcher:R,ReactCurrentBatchConfig:O,ReactCurrentOwner:C};function B(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:j,forEach:function(e,t,n){j(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return j(e,(function(){t++})),t},toArray:function(e){return j(e,(function(e){return e}))||[]},only:function(e){if(!I(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=o,t.Profiler=i,t.PureComponent=x,t.StrictMode=a,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=P,t.act=B,t.cloneElement=function(e,t,r){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var o=h({},e.props),a=e.key,i=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(i=t.ref,s=C.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)S.call(t,c)&&!E.hasOwnProperty(c)&&(o[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)o.children=r;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];o.children=l}return{$$typeof:n,type:e.type,key:a,ref:i,props:o,_owner:s}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=k,t.createFactory=function(e){var t=k.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=I,t.lazy=function(e){return{$$typeof:f,_payload:{_status:-1,_result:e},_init:F}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=O.transition;O.transition={};try{e()}finally{O.transition=t}},t.unstable_act=B,t.useCallback=function(e,t){return R.current.useCallback(e,t)},t.useContext=function(e){return R.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return R.current.useDeferredValue(e)},t.useEffect=function(e,t){return R.current.useEffect(e,t)},t.useId=function(){return R.current.useId()},t.useImperativeHandle=function(e,t,n){return R.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return R.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return R.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return R.current.useMemo(e,t)},t.useReducer=function(e,t,n){return R.current.useReducer(e,t,n)},t.useRef=function(e){return R.current.useRef(e)},t.useState=function(e){return R.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return R.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return R.current.useTransition()},t.version="18.3.1"},540:(e,t,n)=>{e.exports=n(287)},848:(e,t,n)=>{e.exports=n(20)},463:(e,t)=>{
/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,o=e[r];if(!(0<a(o,t)))break e;e[r]=t,e[n]=o,n=r}}function r(e){return 0===e.length?null:e[0]}function o(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,o=e.length,i=o>>>1;r<i;){var s=2*(r+1)-1,l=e[s],c=s+1,u=e[c];if(0>a(l,n))c<o&&0>a(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[s]=n,r=s);else{if(!(c<o&&0>a(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var i=performance;t.unstable_now=function(){return i.now()}}else{var s=Date,l=s.now();t.unstable_now=function(){return s.now()-l}}var c=[],u=[],d=1,f=null,p=3,g=!1,h=!1,m=!1,y="function"==typeof setTimeout?setTimeout:null,v="function"==typeof clearTimeout?clearTimeout:null,x="undefined"!=typeof setImmediate?setImmediate:null;function b(e){for(var t=r(u);null!==t;){if(null===t.callback)o(u);else{if(!(t.startTime<=e))break;o(u),t.sortIndex=t.expirationTime,n(c,t)}t=r(u)}}function w(e){if(m=!1,b(e),!h)if(null!==r(c))h=!0,O(S);else{var t=r(u);null!==t&&P(w,t.startTime-e)}}function S(e,n){h=!1,m&&(m=!1,v(I),I=-1),g=!0;var a=p;try{for(b(n),f=r(c);null!==f&&(!(f.expirationTime>n)||e&&!T());){var i=f.callback;if("function"==typeof i){f.callback=null,p=f.priorityLevel;var s=i(f.expirationTime<=n);n=t.unstable_now(),"function"==typeof s?f.callback=s:f===r(c)&&o(c),b(n)}else o(c);f=r(c)}if(null!==f)var l=!0;else{var d=r(u);null!==d&&P(w,d.startTime-n),l=!1}return l}finally{f=null,p=a,g=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var C,E=!1,k=null,I=-1,A=5,_=-1;function T(){return!(t.unstable_now()-_<A)}function j(){if(null!==k){var e=t.unstable_now();_=e;var n=!0;try{n=k(!0,e)}finally{n?C():(E=!1,k=null)}}else E=!1}if("function"==typeof x)C=function(){x(j)};else if("undefined"!=typeof MessageChannel){var F=new MessageChannel,R=F.port2;F.port1.onmessage=j,C=function(){R.postMessage(null)}}else C=function(){y(j,0)};function O(e){k=e,E||(E=!0,C())}function P(e,n){I=y((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){h||g||(h=!0,O(S))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,o,a){var i=t.unstable_now();switch("object"==typeof a&&null!==a?a="number"==typeof(a=a.delay)&&0<a?i+a:i:a=i,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:d++,callback:o,priorityLevel:e,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>i?(e.sortIndex=a,n(u,e),null===r(c)&&e===r(u)&&(m?(v(I),I=-1):m=!0,P(w,a-i))):(e.sortIndex=s,n(c,e),h||g||(h=!0,O(S))),e},t.unstable_shouldYield=T,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},982:(e,t,n)=>{e.exports=n(463)},797:(e,t,n)=>{var r;n.d(t,{d:()=>r}),function(e){e.LanguageLearning="language-learning",e.GeneralTopic="general-topic"}(r||(r={}))},505:(e,t,n)=>{n.r(t),n.d(t,{correctLinguisticInfo:()=>O,createCardComponentsParallel:()=>k,createExamples:()=>S,createFastLinguisticInfo:()=>z,createFlashcard:()=>C,createLinguisticInfo:()=>I,createOptimizedLinguisticInfo:()=>D,createTranscription:()=>E,createTranslation:()=>w,createValidatedLinguisticInfo:()=>j,createValidatedLinguisticInfoAdvanced:()=>N,createValidatedLinguisticInfoEnhanced:()=>L,getAIService:()=>x,getApiKeyForProvider:()=>b,runMultipleValidation:()=>B,validateLinguisticInfo:()=>R});var r,o=n(417),a=function(e,t,n){var r="".concat(e," - ");return r+=401===t?"Authentication error. Please check your API key.":429===t?"Rate limit exceeded. Please try again later.":500===t||503===t?"Service unavailable. The model might be overloaded or offline.":400===t?"Bad request. The input may be invalid.":"Error code ".concat(t,". ").concat(i(n))},i=function(e){if(!e)return"Unknown error";if(e.error){if("string"==typeof e.error)return e.error;if(e.error.message)return e.error.message;if(e.error.type)return"Error type: ".concat(e.error.type)}if(e.message)return e.message;try{return JSON.stringify(e)}catch(e){return"Unable to parse error details"}},s=n(743),l=n(178),c=(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),u=function(){return u=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},u.apply(this,arguments)},d=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},f=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},p=function(){function e(e,t){void 0===t&&(t=""),this.apiKey=e,this.modelName=t}return e.prototype.extractPlainText=function(e){if(!e)return null;var t=e.replace(/<\/?[^>]+(>|$)/g,"");return t=t.replace(/^#+\s+/gm,"").replace(/\*\*(.*?)\*\*/g,"$1").replace(/\*(.*?)\*/g,"$1").replace(/`(.*?)`/g,"$1").replace(/```[\s\S]*?```/g,"").replace(/\[(.*?)\]\((.*?)\)/g,"$1").trim()},e.prototype.getPrompts=function(){return{translate:function(e,t){return"Translate the following text to ".concat(t,': "').concat(e,'". \nOutput ONLY the direct translation, without any additional text, explanations, quotes, examples, or formatting.\nProvide the most common and appropriate translation. Only include multiple meanings if the word has distinctly different translations that are equally common.\nIf multiple translations are needed, separate them with commas (e.g., "перевод1, перевод2, перевод3").\nDo not include definitions, examples, notes, or part of speech information in English like (noun), (verb), (adjective), etc.\nOnly provide the clean translated word or phrase without any parenthetical information.')},examples:function(e,t){var n=t?"Give me exactly three example sentences using the word '".concat(e,"' in the language with code \"").concat(t,'".'):"Give me exactly three example sentences using the word '".concat(e,"' in its original language.");return"".concat(n,"\nEach sentence should show natural usage of '").concat(e,"' in that language.\nFormat your response as follows:\n1. [First example sentence here]\n2. [Second example sentence here] \n3. [Third example sentence here]\nDo not include definitions, explanations, or translations, ONLY the numbered example sentences as shown above.")},imageDescription:function(e){return'Create a short visual description of the word/concept "'.concat(e,'" for image generation.\nThe description should be concrete, visual, and focus on representational elements.\nKeep the description under 50 words and make sure it is purely descriptive without any formatting.')}}},e.prototype.translateText=function(e,t,n){return void 0===t&&(t="ru"),void 0===n&&(n=""),d(this,void 0,void 0,(function(){var r,o,a,i,s,c,u,d,p,g;return f(this,(function(f){switch(f.label){case 0:r=(0,l.cr)(),o=r.startRequest("Translating text","Converting your text to ".concat(t),"🌍","#3B82F6"),f.label=1;case 1:return f.trys.push([1,3,,4]),r.setInProgress(o),a=this.getPrompts().translate(e,t),i=n?"".concat(a,". ").concat(n):a,[4,this.sendRequest(i)];case 2:return(s=f.sent())?(c=this.extractPlainText(s))&&(c=c.replace(/^translation[:\s-]*/i,"").replace(/^["']|["']$/g,"").replace(/^.*?:\s*/i,"").replace(/^\s*-\s*/,"").replace(/^translated\s*as\s*:?\s*/i,"").replace(/^перевод\s*:?\s*/i,"").replace(/\s*definition:[\s\S]*$/i,"").replace(/\s*examples:[\s\S]*$/i,"").replace(/\s*example:[\s\S]*$/i,"").replace(/\s*example sentences:[\s\S]*$/i,"").replace(/\s*примеры:[\s\S]*$/i,"").replace(/\s*пример:[\s\S]*$/i,"").replace(/\s*notes:[\s\S]*$/i,"").replace(/\s*определение:[\s\S]*$/i,"").replace(/\s*here is the response[\s\S]*$/i,"").replace(/\s*\(adjective\)[\s\S]*$/i,"").replace(/\s*\(noun\)[\s\S]*$/i,"").replace(/\s*\(verb\)[\s\S]*$/i,"").replace(/\s*\(adverb\)[\s\S]*$/i,"").replace(/\s*\(preposition\)[\s\S]*$/i,"").replace(/\s*\(pronoun\)[\s\S]*$/i,"").replace(/\s*\(conjunction\)[\s\S]*$/i,"").replace(/\s*\(interjection\)[\s\S]*$/i,"").replace(/\s*\([^)]*\)[\s\S]*$/i,"").replace(/^the word[\s\S]*translated as[\s:]*/i,"").replace(/^словосочетание[\s\S]*переводится как[\s:]*/i,"").replace(/^слово[\s\S]*переводится как[\s:]*/i,"").replace(/^.*?это[\s:]*/i,"").replace(/^.*?означает[\s:]*/i,"").replace(/^.*?means[\s:]*/i,"").replace(/^the translation is[\s:]*/i,"").split("\n")[0].trim(),u=c.split(/\s+/),c.includes(",")?(d=c.split(",").map((function(e){return e.trim()})).filter((function(e){return e.length>0})).slice(0,3),c=d.join(", ")):u.length>8&&((p=e.split(/\s+/).length)<=5||u.length<=2*p||(console.log("Translation too long, trimming:",c),c=u.slice(0,8).join(" "))),!c&&s)?[2,s.split("\n")[0].trim()]:(console.log("Original translation:",s),console.log("Cleaned translation:",c),r.completeRequest(o),[2,c]):(r.errorRequest(o),[2,null]);case 3:throw g=f.sent(),console.error("Error during translation:",g),r.errorRequest(o),g;case 4:return[2]}}))}))},e.prototype.getExamples=function(e,t,n,r,o){return void 0===n&&(n=!1),void 0===r&&(r=""),d(this,void 0,void 0,(function(){var a,i,s,c,u,d,p,g,h,m,y,v,x,b,w,S,C;return f(this,(function(f){switch(f.label){case 0:a=(0,l.cr)(),i=a.startRequest("Creating example sentences",'Generating helpful examples for "'.concat(e,'"'),"💡","#F59E0B"),f.label=1;case 1:return f.trys.push([1,10,,11]),a.setInProgress(i),s=this.getPrompts().examples(e,o),c=r?"".concat(s," ").concat(r.replace(/\{word\}/g,e)):s,[4,this.sendRequest(c)];case 2:if(!(u=f.sent()))throw new Error("Failed to generate examples. Please try again with a different word.");for(console.log("Raw examples response:",u),d=this.extractPlainText(u)||"",p=d.replace(/^[\s\S]*?((?:\d+\s*\.\s*|•\s*|[\-\*]\s*).+$)/m,"$1").trim(),g=/(?:^|\n)(?:\d+\s*\.\s*|•\s*|[\-\*]\s*)(.+?)(?=(?:\n+(?:\d+\s*\.\s*|•\s*|[\-\*]\s*)|\n*$))/g,h=[],m=void 0;null!==(m=g.exec(p));)m[1]&&h.push(m[1].trim());0===h.length&&(h=p.split(/\n+/).map((function(e){return e.replace(/^\d+\s*\.\s*|^\s*•\s*|^\s*[\-\*]\s*/,"").trim()})).filter((function(t){return t.length>0&&t.toLowerCase().includes(e.toLowerCase())})).slice(0,3)),0===h.length&&(h=p.split(/\n+/).map((function(e){return e.replace(/^\d+\s*\.\s*|^\s*•\s*|^\s*[\-\*]\s*/,"").trim()})).filter((function(e){return e.length>0})).slice(0,3)),h=h.map((function(e){return e.replace(/^(example|sentence|пример|предложение)[\s:]*/i,"").replace(/^["']|["']$/g,"")})),console.log("Processed examples:",h),y=[],v=0,x=h,f.label=3;case 3:if(!(v<x.length))return[3,9];if(!(b=x[v]).trim())return[3,8];if(w=null,!n)return[3,7];f.label=4;case 4:return f.trys.push([4,6,,7]),[4,this.translateText(b,t)];case 5:return w=f.sent(),[3,7];case 6:return S=f.sent(),console.error("Error translating example:",S),[3,7];case 7:if(y.push([b,w]),y.length>=3)return[3,9];f.label=8;case 8:return v++,[3,3];case 9:return 0===y.length?(console.warn("No examples were generated, but continuing with card creation"),a.completeRequest(i),[2,[]]):(a.completeRequest(i),[2,y]);case 10:throw C=f.sent(),console.error("Error getting examples:",C),a.errorRequest(i),C;case 11:return[2]}}))}))},e.prototype.getDescriptionImage=function(e,t){return void 0===t&&(t=""),d(this,void 0,void 0,(function(){var n,r,o,a,i,s,c;return f(this,(function(u){switch(u.label){case 0:n=(0,l.cr)(),r=n.startRequest("Crafting image description",'Creating detailed prompt for "'.concat(e,'" visualization'),"🎨","#EC4899"),u.label=1;case 1:return u.trys.push([1,3,,4]),n.setInProgress(r),o=this.getPrompts().imageDescription(e),a=t?"".concat(o," ").concat(t):o,[4,this.sendRequest(a)];case 2:if(!(i=u.sent()))throw n.errorRequest(r),new Error("Failed to generate image description. Please try again.");return s=this.extractPlainText(i),n.completeRequest(r),[2,s||i];case 3:throw c=u.sent(),console.error("Error generating image description:",c),n.errorRequest(r),c;case 4:return[2]}}))}))},e.prototype.generateAnkiFront=function(e){return d(this,void 0,void 0,(function(){var t,n,r,o,a,i;return f(this,(function(s){switch(s.label){case 0:t=(0,l.cr)(),n=t.startRequest("Creating question","Crafting an effective question for your flashcard","❓","#10B981"),s.label=1;case 1:return s.trys.push([1,3,,4]),t.setInProgress(n),r='For the word or phrase "'.concat(e,'", provide ONLY the word itself without any pronunciation or additional formatting.\nJust return the clean word/phrase as it should appear on the front of an Anki card.\nFor example: if input is "hello", return "hello"\nIf input is "beautiful", return "beautiful"\nYour response should contain ONLY the word/phrase, no pronunciation, no IPA, no additional text.'),[4,this.sendRequest(r)];case 2:return(o=s.sent())?(a=(a=this.extractPlainText(o)||o).split("\n")[0].replace(/^["']|["']$/g,"").replace(/\/.*?\//g,"").replace(/\[.*?\]/g,"").replace(/\(.*?\)/g,"").replace(/^front:[\s:]*/i,"").replace(/^word:[\s:]*/i,"").trim(),console.log("Front card response:",a),t.completeRequest(n),[2,a||e]):(t.errorRequest(n),[2,e]);case 3:return i=s.sent(),console.error("Error generating Anki front:",i),t.errorRequest(n),[2,e];case 4:return[2]}}))}))},e.prototype.createTranscription=function(e,t,n){return d(this,void 0,void 0,(function(){var r,o,a,i,s,c;return f(this,(function(u){switch(u.label){case 0:r=(0,l.cr)(),o=r.startRequest("Creating transcription",'Generating pronunciation for "'.concat(e,'"'),"🔤","#8B5CF6"),u.label=1;case 1:return u.trys.push([1,3,,4]),r.setInProgress(o),a=this.createTranscriptionPrompt(e,t,n),[4,this.sendRequest(a)];case 2:return(i=u.sent())?(s=this.parseTranscriptionResponse(i),r.completeRequest(o),[2,s]):(r.errorRequest(o),[2,null]);case 3:return c=u.sent(),console.error("Error creating transcription:",c),r.errorRequest(o),[2,null];case 4:return[2]}}))}))},e.prototype.createTranscriptionPrompt=function(e,t,n){return'Create transcriptions for the word/phrase "'.concat(e,'" (in ').concat(t,"):\n\n1. User language transcription: Show how to pronounce this word using ").concat(n,' phonetics/script\n2. IPA transcription: International Phonetic Alphabet notation\n\nIMPORTANT:\n- For user language: Write how "').concat(e,'" sounds using ').concat(n," pronunciation system\n- For IPA: Use proper IPA symbols [ˈ ˌ ə ɪ ɛ æ ɑ ɔ ʊ ʌ θ ð ʃ ʒ ʧ ʤ ŋ etc.]\n- Format exactly as shown below:\n\nUSER_LANG: [how the word sounds in ").concat(n,']\nIPA: [ˈaɪ.pi.eɪ notation]\n\nExample for Russian "короткая" with Spanish user language:\nUSER_LANG: korotkaya\nIPA: [kəˈrotkəjə]\n\nProvide ONLY the two lines as shown above, no additional text.')},e.prototype.parseTranscriptionResponse=function(e){var t=this.extractPlainText(e)||e,n=null,r=null,o=t.match(/USER_LANG:\s*(.+)/i);o&&(n=o[1].trim());var a=t.match(/IPA:\s*(.+)/i);return a&&(r=a[1].trim().replace(/^\[|\]$/g,"").replace(/^\/|\/$/g,""))&&!r.startsWith("[")&&(r="[".concat(r,"]")),{userLanguageTranscription:n,ipaTranscription:r}},e}(),g=function(e){function t(t,n){void 0===n&&(n="gpt-5-nano");var r=e.call(this,t,n)||this;return r.openai=new s.z4({apiKey:t,dangerouslyAllowBrowser:!0}),r}return c(t,e),t.prototype.sendRequest=function(e,t){var n,r,o;return void 0===t&&(t={}),d(this,void 0,void 0,(function(){var a,i;return f(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this.openai.chat.completions.create(u({model:this.modelName,messages:[{role:"user",content:e}]},t))];case 1:return a=s.sent(),[2,(null===(o=null===(r=null===(n=a.choices[0])||void 0===n?void 0:n.message)||void 0===r?void 0:r.content)||void 0===o?void 0:o.trim())||null];case 2:throw i=s.sent(),console.error("Error in OpenAI request:",i),i;case 3:return[2]}}))}))},t.prototype.getImageUrl=function(e){var t,n;return d(this,void 0,void 0,(function(){var r,o,a,i,s;return f(this,(function(c){switch(c.label){case 0:r=(0,l.cr)(),o=r.startRequest("Generating image","Creating beautiful illustration with AI","🖼️","#6366F1"),c.label=1;case 1:return c.trys.push([1,3,,4]),r.setInProgress(o),[4,this.openai.images.generate({model:"dall-e-3",prompt:e,n:1,size:"1024x1024"})];case 2:return a=c.sent(),(i=(null===(n=null===(t=a.data)||void 0===t?void 0:t[0])||void 0===n?void 0:n.url)||null)?r.completeRequest(o):r.errorRequest(o),[2,i];case 3:throw s=c.sent(),console.error("Error generating image with OpenAI:",s),r.errorRequest(o),s;case 4:return[2]}}))}))},t.prototype.getOptimizedImageUrl=function(e,t){return void 0===t&&(t=""),d(this,void 0,void 0,(function(){var r,o;return f(this,(function(a){switch(a.label){case 0:return[4,Promise.resolve().then(n.bind(n,251))];case 1:r=a.sent().getOptimizedImageUrl,a.label=2;case 2:return a.trys.push([2,4,,5]),[4,r(this.openai,this.apiKey,e,t)];case 3:return[2,a.sent()];case 4:throw o=a.sent(),console.error("Error generating optimized image:",o),o;case 5:return[2]}}))}))},t.prototype.extractKeyTerms=function(e){return d(this,void 0,void 0,(function(){var t,n,r,o;return f(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),t="You are a helpful language learning assistant. Extract key terms from the text that would be useful to learn as flashcards. Limit to 5 most important terms max. Return only the terms, one per line, without any additional text or formatting.",[4,this.sendRequest(t,{messages:[{role:"system",content:t},{role:"user",content:e}]})];case 1:return n=a.sent(),(r=n||"")?[2,r.split("\n").map((function(e){return e.trim()})).filter((function(e){return e.length>0}))]:[2,[]];case 2:return o=a.sent(),console.error("Error extracting key terms with OpenAI:",o),[2,[]];case 3:return[2]}}))}))},t.prototype.createChatCompletion=function(e,t){var n,r,o;return d(this,void 0,void 0,(function(){var e,a,i,s,c,u;return f(this,(function(d){switch(d.label){case 0:e=(0,l.cr)(),a=e.startRequest("Creating grammar reference","Generating detailed grammar and linguistic information","📚","#9C27B0"),d.label=1;case 1:return d.trys.push([1,3,,4]),e.setInProgress(a),i=t.map((function(e){return{role:e.role,content:e.content}})),[4,this.openai.chat.completions.create({model:this.modelName,messages:i})];case 2:return s=d.sent(),(c=(null===(o=null===(r=null===(n=s.choices[0])||void 0===n?void 0:n.message)||void 0===r?void 0:r.content)||void 0===o?void 0:o.trim())||"")?(e.completeRequest(a),[2,{content:c}]):(e.errorRequest(a),[2,null]);case 3:throw u=d.sent(),console.error("Error in OpenAI chat completion:",u),e.errorRequest(a),u;case 4:return[2]}}))}))},t}(p),h=function(e){function t(t,n){void 0===n&&(n="llama3-8b-8192");var r=e.call(this,t,n)||this;return r.apiBaseUrl="https://api.groq.com/openai/v1",r}return c(t,e),t.prototype.sendRequest=function(e,t){var n,r,o,i,s;return void 0===t&&(t={}),d(this,void 0,void 0,(function(){var t,l,c,u;return f(this,(function(d){switch(d.label){case 0:if(d.trys.push([0,5,,6]),!this.apiKey)throw new Error("Groq API key is missing. Please check your settings.");return[4,fetch("".concat(this.apiBaseUrl,"/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)},body:JSON.stringify({model:this.modelName,messages:[{role:"user",content:e}]})})];case 1:return(t=d.sent()).ok?[3,3]:[4,t.json()];case 2:throw l=d.sent(),new Error(a("Groq API Error",t.status,l));case 3:return[4,t.json()];case 4:return c=d.sent(),[2,null!==(s=null===(i=null===(o=null===(r=null===(n=c.choices)||void 0===n?void 0:n[0])||void 0===r?void 0:r.message)||void 0===o?void 0:o.content)||void 0===i?void 0:i.trim())&&void 0!==s?s:null];case 5:throw u=d.sent(),console.error("Error in Groq API request:",u),u;case 6:return[2]}}))}))},t.prototype.getImageUrl=function(){throw new Error("Image generation is not supported by Groq.")},t.prototype.extractKeyTerms=function(e){return d(this,void 0,void 0,(function(){var t,n,r,o;return f(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),t="You are a helpful language learning assistant. Extract key terms from the text that would be useful to learn as flashcards. Limit to 5 most important terms max. Return only the terms, one per line, without any additional text or formatting.",[4,this.sendRequest(t,{messages:[{role:"system",content:t},{role:"user",content:e}]})];case 1:return n=a.sent(),(r=n||"")?[2,r.split("\n").map((function(e){return e.trim()})).filter((function(e){return e.length>0}))]:[2,[]];case 2:return o=a.sent(),console.error("Error extracting key terms with Groq:",o),[2,[]];case 3:return[2]}}))}))},t.prototype.createChatCompletion=function(e,t){var n,r,o,i,s;return d(this,void 0,void 0,(function(){var e,c,u,d,p,g,h;return f(this,(function(f){switch(f.label){case 0:e=(0,l.cr)(),c=e.startRequest("Creating grammar reference","Generating detailed grammar and linguistic information","📚","#9C27B0"),f.label=1;case 1:if(f.trys.push([1,6,,7]),e.setInProgress(c),!this.apiKey)throw new Error("Groq API key is missing. Please check your settings.");return[4,fetch("".concat(this.apiBaseUrl,"/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)},body:JSON.stringify({model:this.modelName,messages:t})})];case 2:return(u=f.sent()).ok?[3,4]:[4,u.json()];case 3:throw d=f.sent(),new Error(a("Groq API Error",u.status,d));case 4:return[4,u.json()];case 5:return p=f.sent(),(g=null!==(s=null===(i=null===(o=null===(r=null===(n=p.choices)||void 0===n?void 0:n[0])||void 0===r?void 0:r.message)||void 0===o?void 0:o.content)||void 0===i?void 0:i.trim())&&void 0!==s?s:"")?(e.completeRequest(c),[2,{content:g}]):(e.errorRequest(c),[2,null]);case 6:throw h=f.sent(),console.error("Error in Groq chat completion:",h),e.errorRequest(c),h;case 7:return[2]}}))}))},t}(p),m=function(e,t,n){switch(void 0===n&&(n=""),e){case o.l.OpenAI:return new g(t,n||"gpt-5-nano");case o.l.Groq:return new h(t,n||"llama3-8b-8192");default:return new g(t,n||"gpt-5-nano")}},y=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},v=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},x=function(e){return function(e){return{translateText:function(t,n,r,o,a){return void 0===r&&(r="ru"),void 0===o&&(o=""),y(void 0,void 0,void 0,(function(){return v(this,(function(i){if(null==a?void 0:a.aborted)throw new Error("Request cancelled");return[2,m(e,t).translateText(n,r,o)]}))}))},getExamples:function(t,n,r,o,a,i,s){return void 0===o&&(o=!1),void 0===a&&(a=""),y(void 0,void 0,void 0,(function(){return v(this,(function(l){if(null==s?void 0:s.aborted)throw new Error("Request cancelled");return[2,m(e,t).getExamples(n,r,o,a,i)]}))}))},getDescriptionImage:function(t,n,r,o){return void 0===r&&(r=""),y(void 0,void 0,void 0,(function(){return v(this,(function(a){if(null==o?void 0:o.aborted)throw new Error("Request cancelled");return[2,m(e,t).getDescriptionImage(n,r)]}))}))},getImageUrl:function(t,n){return y(void 0,void 0,void 0,(function(){var r;return v(this,(function(o){return[2,(r=m(e,t)).getImageUrl?r.getImageUrl(n):null]}))}))},getOptimizedImageUrl:function(t,n,r){return y(void 0,void 0,void 0,(function(){var o;return v(this,(function(a){return[2,(o=m(e,t)).getOptimizedImageUrl?o.getOptimizedImageUrl(n,r):null]}))}))},generateAnkiFront:function(t,n,r){return y(void 0,void 0,void 0,(function(){return v(this,(function(o){if(null==r?void 0:r.aborted)throw new Error("Request cancelled");return[2,m(e,t).generateAnkiFront(n)]}))}))},extractKeyTerms:function(t,n){return y(void 0,void 0,void 0,(function(){return v(this,(function(r){return[2,m(e,t).extractKeyTerms(n)]}))}))},createChatCompletion:function(t,n){return y(void 0,void 0,void 0,(function(){var r;return v(this,(function(o){return(r=m(e,t)).createChatCompletion?[2,r.createChatCompletion(t,n)]:(console.error("createChatCompletion not implemented in the provider"),[2,null])}))}))},createTranscription:function(t,n,r,o){return y(void 0,void 0,void 0,(function(){return v(this,(function(a){return[2,m(e,t).createTranscription(n,r,o)]}))}))}}}(e)},b=function(e,t,n){switch(void 0===n&&(n=""),e){case o.l.OpenAI:return t;case o.l.Groq:return n;default:return t}},w=function(e,t,n,r,o,a,i){return y(void 0,void 0,void 0,(function(){var a,s;return v(this,(function(l){switch(l.label){case 0:if(l.trys.push([0,2,,3]),!t)throw new Error("API key is missing. Please check your settings.");return[4,e.translateText(t,n,r,o,i)];case 1:return a=l.sent(),[2,{original:n,translated:a}];case 2:throw s=l.sent(),console.error("Error in unified translation:",s),s instanceof Error?s:new Error("Failed to translate text. Please check your API key and settings.");case 3:return[2]}}))}))},S=function(e,t,n,r,o,a,i,s){return void 0===o&&(o=!1),y(void 0,void 0,void 0,(function(){var l;return v(this,(function(c){switch(c.label){case 0:if(c.trys.push([0,2,,3]),!t)throw new Error("API key is missing. Please check your settings.");return[4,e.getExamples(t,n,r,o,a,i,s)];case 1:return[2,c.sent().map((function(e){return{original:e[0],translated:e[1]}}))];case 2:throw l=c.sent(),console.error("Error in unified examples generation:",l),l instanceof Error?l:new Error("Failed to generate examples. Please check your API key and settings.");case 3:return[2]}}))}))},C=function(e,t,n,r){return y(void 0,void 0,void 0,(function(){var o,a;return v(this,(function(i){switch(i.label){case 0:if(i.trys.push([0,2,,3]),!t)throw new Error("API key is missing. Please check your settings.");return[4,e.generateAnkiFront(t,n,r)];case 1:if(!(o=i.sent()))throw new Error("Failed to generate flashcard content. Please try again or check your API key.");return[2,{front:o}];case 2:throw a=i.sent(),console.error("Error in unified flashcard creation:",a),a instanceof Error?a:new Error("Failed to create flashcard. Please check your API key and settings.");case 3:return[2]}}))}))},E=function(e,t,n,r,o){return void 0===o&&(o="ru"),y(void 0,void 0,void 0,(function(){var a,i;return v(this,(function(s){switch(s.label){case 0:if(s.trys.push([0,2,,3]),!t)throw new Error("API key is missing. Please check your settings.");return[4,e.createTranscription(t,n,r,o)];case 1:if(!(a=s.sent()))throw new Error("Failed to generate transcription. Please try again or check your API key.");return[2,a];case 2:throw i=s.sent(),console.error("Error in unified transcription creation:",i),i instanceof Error?i:new Error("Failed to create transcription. Please check your API key and settings.");case 3:return[2]}}))}))},k=function(e,t,n,r,o,a,i,s,l){return void 0===i&&(i=!1),y(void 0,void 0,void 0,(function(){var c,u,d,f,p,g,h,m,x,b,E;return v(this,(function(k){switch(k.label){case 0:return c=Date.now(),console.log("🚀 Starting parallel card component creation..."),u=[],(d=[]).push((I=function(){return w(e,t,n,r,o,a,s)},void 0===A&&(A=2),void 0===_&&(_=1e3),y(void 0,void 0,void 0,(function(){var e,t,n,r;return v(this,(function(o){switch(o.label){case 0:t=function(t){var n,r,o;return v(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,4]),n={},[4,I()];case 1:return[2,(n.value=a.sent(),n)];case 2:if(r=a.sent(),(e=r).message.includes("quota")||e.message.includes("cancelled")||e.message.includes("aborted"))throw e;if(t===A)throw e;return o=_*Math.pow(2,t),console.log("Retry attempt ".concat(t+1,"/").concat(A," after ").concat(o,"ms delay")),[4,new Promise((function(e){return setTimeout(e,o)}))];case 3:return a.sent(),[3,4];case 4:return[2]}}))},n=0,o.label=1;case 1:return n<=A?[5,t(n)]:[3,4];case 2:if("object"==typeof(r=o.sent()))return[2,r.value];o.label=3;case 3:return n++,[3,1];case 4:throw e}}))}))).then((function(e){return{type:"translation",result:e}})).catch((function(e){return{type:"translation",error:e.message}}))),d.push(S(e,t,n,r,!0,o,a,s).then((function(e){return{type:"examples",result:e}})).catch((function(e){return{type:"examples",error:e.message}}))),d.push(C(e,t,n,s).then((function(e){return{type:"flashcard",result:e}})).catch((function(e){return{type:"flashcard",error:e.message}}))),a&&d.push(z(e,t,n,a,r).then((function(e){return{type:"linguisticInfo",result:e.linguisticInfo}})).catch((function(e){return{type:"linguisticInfo",error:e.message}}))),i&&"off"!==l&&(f=function(n){return y(void 0,void 0,void 0,(function(){var r,o,a,i,s,l;return v(this,(function(c){switch(c.label){case 0:if(!n||0===n.trim().length)return[2,{shouldGenerate:!1,reason:"No text provided"}];c.label=1;case 1:return c.trys.push([1,3,,4]),r='Analyze this word/phrase and determine if a visual image would be helpful for language learning: "'.concat(n,'"\n\nConsider these criteria:\n- Concrete objects, animals, places, foods, tools, vehicles = YES\n- Abstract concepts, emotions, actions, grammar terms = NO\n- People, professions, activities that can be visualized = YES\n- Numbers, prepositions, conjunctions, abstract ideas = NO\n\nRespond with ONLY "YES" or "NO" followed by a brief reason (max 10 words).\nFormat: "YES - concrete object that can be visualized" or "NO - abstract concept"'),[4,e.createChatCompletion(t,[{role:"user",content:r}])];case 2:return(o=c.sent())&&o.content?(a=o.content.trim(),i=a.toUpperCase().startsWith("YES"),s=a.includes(" - ")?a.split(" - ")[1]:"AI analysis",console.log('🤖 Smart image analysis for "'.concat(n,'": ').concat(i?"YES":"NO"," - ").concat(s)),[2,{shouldGenerate:i,reason:s}]):[2,{shouldGenerate:!1,reason:"AI analysis failed"}];case 3:return l=c.sent(),console.error("Error analyzing text for image generation:",l),[2,{shouldGenerate:!1,reason:"Analysis error"}];case 4:return[2]}}))}))},p=function(){return y(void 0,void 0,void 0,(function(){var r,o,a,i;return v(this,(function(s){switch(s.label){case 0:if(r="always"===l,o="","smart"!==l)return[3,4];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,f(n)];case 2:return a=s.sent(),r=a.shouldGenerate,o=a.reason,[3,4];case 3:return i=s.sent(),console.error("Error in Smart analysis:",i),r=!1,o="Analysis failed",[3,4];case 4:return r?e.getOptimizedImageUrl?[4,e.getOptimizedImageUrl(t,n)]:[3,6]:[3,9];case 5:return[2,s.sent()];case 6:return e.getImageUrl?[4,e.getImageUrl(t,n)]:[3,8];case 7:return[2,s.sent()];case 8:return[3,10];case 9:"smart"===l&&console.log('🚫 No image needed for "'.concat(n,'": ').concat(o)),s.label=10;case 10:return[2,null]}}))}))},d.push(p().then((function(e){return{type:"imageUrl",result:e}})).catch((function(e){return{type:"imageUrl",error:e.message}})))),[4,Promise.all(d)];case 1:for(g=k.sent(),h={errors:u},m=0,x=g;m<x.length;m++){if(b=x[m],null==s?void 0:s.aborted)throw new Error("Card creation was cancelled by user");"error"in b?u.push({component:b.type,error:b.error}):h[b.type]=b.result}return E=Date.now()-c,console.log("⚡ Parallel card creation completed in ".concat(E,"ms")),console.log("📊 Success: ".concat(Object.keys(h).length-1,"/").concat(d.length,", Errors: ").concat(u.length)),[2,h]}var I,A,_}))}))};function I(e,t,n,r,o){return void 0===o&&(o="ru"),y(this,void 0,void 0,(function(){var a,i;return v(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),console.log('Creating validated linguistic info for "'.concat(n,'" in ').concat(r,", interface: ").concat(o)),[4,j(e,t,n,r,o)];case 1:return(a=s.sent())?(console.log('Generated and validated linguistic info for "'.concat(n,'"')),[2,a]):[2,null];case 2:return i=s.sent(),console.error("Error creating linguistic info:",i),[2,null];case 3:return[2]}}))}))}function A(e,t,n){return void 0===n&&(n="ru"),'ЗАДАЧА: Создать КРАТКУЮ грамматическую справку для "'.concat(e,'" на языке ').concat(n,'.\n\nТРЕБОВАНИЯ:\n- Максимум 2-3 пункта\n- Каждый пункт: уникальный эмоджи + 1-2 слова\n- Только существенная информация по существу\n\nОБЯЗАТЕЛЬНО:\n1. 📚 Часть речи: [всегда первый пункт]\n2. Максимум ОДНА дополнительная характеристика (если релевантна)\n\nДОСТУПНЫЕ ЭМОДЖИ:\n- ⚥ Род | 📋 Число | 🎯 Падеж | ⏰ Время\n\nПРИМЕРЫ:\n"book" → "📚 Часть речи: существительное"\n"красивой" → "📚 Часть речи: прилагательное" + "⚥ Род: женский"\n\nФОРМАТ:\n<div class="grammar-item">\n  <span class="icon-pos">[эмоджи]</span> <strong>[название]:</strong> <span class="grammar-tag">[значение]</span>\n</div>\n\nСоздай справку для "').concat(e,'":')}function _(e,t,n){return'Проверь справку для "'.concat(t,'" и исправь только существенные ошибки:\n\nСПРАВКА:\n').concat(e,"\n\nПРОВЕРЬ ТОЛЬКО:\n1. Есть ли повторяющиеся эмоджи? (📚 📚 - плохо)\n2. На правильном ли языке термины? (должен быть ").concat(n,')\n3. Есть ли лишняя информация? (убери lemma, degree, notes, examples)\n\nЕсли справка в целом корректна → ответь "СПРАВКА КОРРЕКТНА"\nЕсли есть существенные ошибки → создай исправленную версию\n\nИСПРАВЬ если нужно:')}function T(e,t,n,r,o){return void 0===o&&(o="ru"),y(this,void 0,void 0,(function(){var a,i,s,l;return v(this,(function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),console.log('Validating linguistic reference for "'.concat(r,'"')),a=_(n,r,o),[4,e.createChatCompletion(t,[{role:"user",content:a}])];case 1:return(i=c.sent())&&i.content?(s=i.content.trim()).includes("СПРАВКА КОРРЕКТНА")||s.includes("КОРРЕКТНА")?(console.log("Reference validated as correct"),[2,n]):(console.log("Reference corrected by validator"),[2,s]):(console.log("Validator failed, returning original reference"),[2,n]);case 2:return l=c.sent(),console.error("Error in validator:",l),[2,n];case 3:return[2]}}))}))}function j(e,t,n,r,o){return void 0===o&&(o="ru"),y(this,void 0,void 0,(function(){var r,a,i,s,l;return v(this,(function(c){switch(c.label){case 0:return c.trys.push([0,3,,4]),console.log('Creating validated linguistic info for "'.concat(n,'"')),r=A(n,0,o),[4,e.createChatCompletion(t,[{role:"user",content:r}])];case 1:return(a=c.sent())&&a.content?(i=a.content.trim(),[4,T(e,t,i,n,o)]):[2,null];case 2:return s=c.sent(),console.log('Final linguistic info for "'.concat(n,'" created')),[2,s];case 3:return l=c.sent(),console.error("Error creating validated linguistic info:",l),[2,null];case 4:return[2]}}))}))}function F(e,t,n,r){return'You are an expert linguist specializing in grammar validation. Your task is to verify the grammatical accuracy of a linguistic reference.\n\nANALYSIS TARGET:\n- Word/Phrase: "'.concat(e,'"\n- Source Language: ').concat(n,"\n- Interface Language: ").concat(r,"\n\nLINGUISTIC REFERENCE TO VALIDATE:\n").concat(t,'\n\nVALIDATION INSTRUCTIONS:\n1. **Analyze the source word "').concat(e,'" in ').concat(n," language ONLY**\n2. **DO NOT analyze translations** - focus only on the original word\n3. **Check grammatical consistency** according to ").concat(n," language rules\n4. **Verify logical compatibility** of grammatical characteristics\n\nSPECIFIC CHECKS FOR ").concat(n.toUpperCase(),' LANGUAGE:\n• **Part of Speech**: Verify the word classification is correct\n• **Gender**: Check if gender is appropriate (singular forms only for most languages)\n• **Number**: Ensure number is correctly identified\n• **Case**: Validate case forms match the language\'s case system\n• **Tense/Aspect**: For verbs, check tense and aspect accuracy\n• **Degree**: Comparison degrees should only apply to adjectives/adverbs, NOT nouns\n• **Morphological Features**: Verify all features are linguistically valid\n\nCOMMON ERRORS TO DETECT:\n❌ Gender specified for plural forms (where not applicable)\n❌ Comparison degrees assigned to nouns\n❌ Incorrect case systems for the language\n❌ Wrong tense/aspect combinations\n❌ Analysis of translation instead of source word\n❌ Inconsistent grammatical categories\n\nRESPONSE FORMAT:\nVALIDATION: [VALID/INVALID]\n\nERRORS:\n[List specific errors found, or "None"]\n\nCORRECTIONS:\n[Suggest specific corrections, or "None"]\n\nBe thorough and precise. Focus on grammatical accuracy for ').concat(n," language rules.")}function R(e,t,n,r,o,a){return void 0===a&&(a="ru"),y(this,void 0,void 0,(function(){var i,s,l,c,u,d,f,p,g,h,m;return v(this,(function(y){switch(y.label){case 0:return y.trys.push([0,2,,3]),console.log('Validating linguistic info for "'.concat(n,'" in ').concat(o)),i=F(n,r,o,a),[4,e.createChatCompletion(t,[{role:"user",content:i}])];case 1:return(s=y.sent())&&s.content?(l=s.content.trim(),console.log("Validation response:",l),c=l.includes("VALIDATION: VALID")||l.includes("✅ VALID"),u=l.match(/ERRORS?:([\s\S]*?)(?:CORRECTIONS?:|$)/),d=l.match(/CORRECTIONS?:([\s\S]*?)$/),f=[],p=[],u&&u[1]&&(g=u[1].trim())&&"None"!==g&&"Нет"!==g&&f.push.apply(f,g.split("\n").filter((function(e){return e.trim()})).map((function(e){return e.replace(/^[•\-*]\s*/,"").trim()}))),d&&d[1]&&(h=d[1].trim())&&"None"!==h&&"Нет"!==h&&p.push.apply(p,h.split("\n").filter((function(e){return e.trim()})).map((function(e){return e.replace(/^[•\-*]\s*/,"").trim()}))),[2,{isValid:c,errors:f,corrections:p.length>0?p:void 0}]):[2,{isValid:!1,errors:["Failed to validate linguistic information"]}];case 2:return m=y.sent(),console.error("Error validating linguistic info:",m),[2,{isValid:!1,errors:["Validation service unavailable"]}];case 3:return[2]}}))}))}function O(e,t,n,r,o,a,i,s){return void 0===s&&(s="ru"),y(this,void 0,void 0,(function(){var l,c,u;return v(this,(function(d){switch(d.label){case 0:return d.trys.push([0,2,,3]),console.log('Correcting linguistic info for "'.concat(n,'" based on validation errors')),l=function(e,t,n,r,o,a){var i=n.map((function(e){return"• ".concat(e)})).join("\n"),s=r.map((function(e){return"• ".concat(e)})).join("\n");return'Ты эксперт-лингвист. Исправь грамматическую справку на основе найденных ошибок.\n\nСЛОВО ДЛЯ АНАЛИЗА: "'.concat(e,'" (язык: ').concat(o,")\n\nИСХОДНАЯ СПРАВКА:\n").concat(t,"\n\nНАЙДЕННЫЕ ОШИБКИ:\n").concat(i,"\n\nРЕКОМЕНДАЦИИ ПО ИСПРАВЛЕНИЮ:\n").concat(s,'\n\nЗАДАЧА: Создай исправленную версию грамматической справки, устранив все указанные ошибки.\n\nТРЕБОВАНИЯ:\n1. Сохрани исходное HTML-форматирование\n2. Исправь только грамматические ошибки\n3. Убери неприменимые характеристики (например, род для мн.ч., степени сравнения для существительных)\n4. Все термины должны быть на языке "').concat(a,'"\n5. Анализируй только исходное слово "').concat(e,'", не его перевод\n\nВыведи ТОЛЬКО исправленную справку без дополнительных комментариев:')}(n,r,o,a,i,s),[4,e.createChatCompletion(t,[{role:"user",content:l}])];case 1:return(c=d.sent())&&c.content?[2,c.content.trim()]:[2,null];case 2:return u=d.sent(),console.error("Error correcting linguistic info:",u),[2,null];case 3:return[2]}}))}))}function P(e,t,n,r,o,a,i){return y(this,void 0,void 0,(function(){var s,l,c,u,d,f,p,g,h,m,y,x,b;return v(this,(function(v){switch(v.label){case 0:return v.trys.push([0,2,,3]),console.log("Running ".concat(i,' validator for "').concat(n,'"')),s=function(e,t,n,r,o){var a='\nANALYSIS TARGET:\n- Word/Phrase: "'.concat(e,'"\n- Source Language: ').concat(n,"\n- Interface Language: ").concat(r,"\n\nLINGUISTIC REFERENCE TO VALIDATE:\n").concat(t);switch(o){case"morphology":return"".concat(a,"\n\n🔬 MORPHOLOGY SPECIALIST VALIDATION\n\nYou are a specialist in morphological analysis. Focus EXCLUSIVELY on word formation and morphological features:\n\nPRIMARY CHECKS:\n• **Part of Speech**: Is the word classification accurate?\n• **Morphological Form**: Are inflectional forms correctly identified?\n• **Gender/Number/Case**: Are these consistent with ").concat(n," morphology?\n• **Base Form**: Is the root/lemma correctly identified?\n• **Morphological Categories**: Do the features match the word class?\n\nCRITICAL ERROR DETECTION for ").concat(n.toUpperCase(),":\n❌ **Gender for plural forms**: In most languages (Russian, English, etc.), gender should NOT be specified for plural forms\n❌ **Impossible morphological combinations**: Check if all features can coexist\n❌ **Missing essential features**: Ensure number, case (where applicable) are present\n❌ **Wrong part of speech**: Verify the word actually belongs to the stated category\n\nSPECIFIC ").concat(n.toUpperCase(),' RULES:\n• If word ends in -и, -ы, -а (plural markers), check if it\'s truly plural\n• Plural nouns typically don\'t have gender specification\n• Adjectives in plural may have gender only in specific contexts\n• Verify case markers match the word form\n\nIGNORE: Syntax, semantics, context - focus ONLY on morphology.\n\nRESPONSE FORMAT:\nVALIDATION: [VALID/INVALID]\nCONFIDENCE: [0.0-1.0]\nERRORS: [morphological errors only, or "None"]\nCORRECTIONS: [morphological corrections only, or "None"]');case"syntax":return"".concat(a,"\n\n🏗️ SYNTAX SPECIALIST VALIDATION\n\nYou are a specialist in syntactic analysis. Focus EXCLUSIVELY on grammatical structure:\n\nPRIMARY CHECKS:\n• **Grammatical Role**: Does the word fit its syntactic position?\n• **Agreement**: Are agreement patterns consistent?\n• **Case Assignment**: Is case marking appropriate for syntax?\n• **Tense/Aspect**: Are verbal categories syntactically coherent?\n• **Syntactic Features**: Do features match syntactic requirements?\n\nCRITICAL SYNTAX VALIDATION for ").concat(n.toUpperCase(),':\n❌ **Agreement violations**: Check subject-verb, noun-adjective agreement\n❌ **Case mismatches**: Ensure case reflects syntactic role\n❌ **Tense inconsistencies**: Verify temporal features make syntactic sense\n❌ **Feature conflicts**: Look for syntactically impossible combinations\n\nIGNORE: Word-internal morphology, meaning - focus ONLY on syntax.\n\nRESPONSE FORMAT:\nVALIDATION: [VALID/INVALID]\nCONFIDENCE: [0.0-1.0]\nERRORS: [syntactic errors only, or "None"]\nCORRECTIONS: [syntactic corrections only, or "None"]');case"semantics":return"".concat(a,'\n\n💭 SEMANTICS SPECIALIST VALIDATION\n\nYou are a specialist in semantic analysis. Focus EXCLUSIVELY on meaning and usage:\n\nPRIMARY CHECKS:\n• **Semantic Category**: Does the classification match the word\'s meaning?\n• **Usage Context**: Are grammatical features appropriate for the word\'s usage?\n• **Semantic Agreement**: Do features align with semantic properties?\n• **Register/Style**: Are formal features appropriate for the word type?\n• **Semantic Coherence**: Do all features make sense together semantically?\n\nSEMANTIC VALIDATION PRIORITIES:\n❌ **Meaning mismatches**: Ensure part of speech matches actual meaning\n❌ **Register conflicts**: Check if formality level matches word type\n❌ **Usage inconsistencies**: Verify features match how word is actually used\n❌ **Semantic impossibilities**: Look for logically impossible feature combinations\n\nIGNORE: Pure morphological/syntactic technicalities - focus on meaning-based validation.\n\nRESPONSE FORMAT:\nVALIDATION: [VALID/INVALID]\nCONFIDENCE: [0.0-1.0]\nERRORS: [semantic errors only, or "None"]\nCORRECTIONS: [semantic corrections only, or "None"]');case"consistency":return"".concat(a,"\n\n⚖️ CONSISTENCY SPECIALIST VALIDATION\n\nYou are a specialist in logical consistency. Focus EXCLUSIVELY on internal coherence:\n\nPRIMARY CHECKS:\n• **Feature Compatibility**: Are all features mutually compatible?\n• **Language Rules**: Does everything follow ").concat(n," rules?\n• **Logical Contradictions**: Are there any impossible combinations?\n• **Completeness**: Are required features present/absent appropriately?\n• **Cross-feature Validation**: Do different features support each other?\n\nCONSISTENCY CRITICAL CHECKS for ").concat(n.toUpperCase(),":\n❌ **GENDER + PLURAL**: Major error - gender should NOT be specified for plural forms in ").concat(n,"\n❌ **Part of speech conflicts**: Ensure all features match the stated part of speech\n❌ **Missing essential info**: Check if number, case, or other required features are missing\n❌ **Redundant information**: Remove features that don't apply to this word form\n❌ **Language-specific violations**: Apply ").concat(n,' grammatical rules strictly\n\nEXAMPLE VIOLATIONS TO CATCH:\n• "заслуги" (plural) + "Gender: Masculine" → INVALID (plural has no gender)\n• "Noun" + "Degree of comparison" → INVALID (nouns don\'t have degrees)\n• "Singular" + plural word ending → INVALID (form/feature mismatch)\n\nIGNORE: Individual feature accuracy - focus ONLY on overall consistency.\n\nRESPONSE FORMAT:\nVALIDATION: [VALID/INVALID]\nCONFIDENCE: [0.0-1.0]\nERRORS: [consistency errors only, or "None"]\nCORRECTIONS: [consistency corrections only, or "None"]');case"completeness":return"".concat(a,"\n\n📋 COMPLETENESS SPECIALIST VALIDATION\n\nYou are a specialist in checking completeness of grammar information. Focus EXCLUSIVELY on whether essential information is provided:\n\nPRIMARY CHECKS:\n• **Essential Categories**: Are the most important grammatical features included?\n• **Missing Information**: What crucial details are missing for learners?\n• **Usefulness**: Is this enough for language learners to understand the word?\n• **Context Appropriateness**: Does this match the learner's needs?\n\nCOMPLETENESS REQUIREMENTS for ").concat(n.toUpperCase(),':\n• Part of Speech: MANDATORY for all words\n• For Nouns: Gender (if applicable), number if not obvious\n• For Verbs: Tense/form if not infinitive  \n• For Adjectives: Degree if comparative/superlative\n• For English: Usually part of speech is sufficient\n• For inflected languages: More morphological detail needed\n\nSPECIFIC CHECKS:\n✅ "another" (English) + "определитель" → INCOMPLETE (should add "неопределенный" or usage info)\n✅ "book" (English) + "существительное" → COMPLETE (sufficient for English)\n✅ "красивый" (Russian) + "прилагательное, мужской род" → COMPLETE\n❌ "books" (English) + "существительное" → INCOMPLETE (missing plural form info)\n\nCRITICAL EVALUATION:\n• Is this TOO brief to be helpful?\n• Are learners missing crucial information?\n• Should additional categories be included?\n\nIGNORE: Technical accuracy of provided info - focus ONLY on completeness.\n\nRESPONSE FORMAT:\nVALIDATION: [VALID/INVALID]\nCONFIDENCE: [0.0-1.0]\nERRORS: [completeness issues only, or "None"]\nCORRECTIONS: [suggestions for missing info, or "None"]');default:return F(e,t,n,r)}}(n,r,o,a,i),[4,e.createChatCompletion(t,[{role:"user",content:s}])];case 1:return(l=v.sent())&&l.content?(c=l.content.trim(),console.log("".concat(i," validator response:"),c),u=c.includes("VALIDATION: VALID"),d=c.match(/CONFIDENCE:\s*([\d.]+)/),f=d?parseFloat(d[1]):.5,p=c.match(/ERRORS?:([\s\S]*?)(?:CORRECTIONS?:|$)/),g=c.match(/CORRECTIONS?:([\s\S]*?)$/),h=[],m=[],p&&p[1]&&(y=p[1].trim())&&"None"!==y&&"Нет"!==y&&h.push.apply(h,y.split("\n").filter((function(e){return e.trim()})).map((function(e){return e.replace(/^[•\-*]\s*/,"").trim()})).filter((function(e){return e.length>0}))),g&&g[1]&&(x=g[1].trim())&&"None"!==x&&"Нет"!==x&&m.push.apply(m,x.split("\n").filter((function(e){return e.trim()})).map((function(e){return e.replace(/^[•\-*]\s*/,"").trim()})).filter((function(e){return e.length>0}))),[2,{isValid:u,errors:h,corrections:m.length>0?m:void 0,confidence:f,validatorType:i}]):[2,{isValid:!1,errors:["".concat(i," validation failed - no response")],confidence:0,validatorType:i}];case 2:return b=v.sent(),console.error("Error in ".concat(i," validator:"),b),[2,{isValid:!1,errors:["".concat(i," validator error: ").concat(b instanceof Error?b.message:"Unknown error")],confidence:0,validatorType:i}];case 3:return[2]}}))}))}function B(e,t,n,r,o,a){return void 0===a&&(a="ru"),y(this,void 0,void 0,(function(){var i,s,l,c,u,d,f,p,g;return v(this,(function(h){switch(h.label){case 0:return console.log('Running multiple validation for "'.concat(n,'"')),i=["morphology","syntax","semantics","consistency","completeness"].map((function(i){return P(e,t,n,r,o,a,i)})),[4,Promise.all(i)];case 1:return s=h.sent(),l=s.filter((function(e){return e.isValid})),c=s.filter((function(e){return!e.isValid})),u=s.reduce((function(e,t){return e+t.confidence}),0)/s.length,d=l.length/s.length,f=d>=.75,p=[],g=[],c.forEach((function(e){e.errors.forEach((function(t){p.includes(t)||p.push("[".concat(e.validatorType,"] ").concat(t))})),e.corrections&&e.corrections.forEach((function(t){g.includes(t)||g.push("[".concat(e.validatorType,"] ").concat(t))}))})),console.log("Multiple validation complete: ".concat(l.length,"/").concat(s.length," passed, confidence: ").concat(u.toFixed(2))),[2,{overallValid:f,confidence:u,validations:s,finalErrors:p,finalCorrections:g,attempts:1}]}}))}))}function N(e,t,n,r,o,a,i){return void 0===o&&(o="ru"),void 0===a&&(a=5),void 0===i&&(i=!0),y(this,void 0,void 0,(function(){var s,l,c,u,d,f,p;return v(this,(function(g){switch(g.label){case 0:s=0,l=null,console.log('Starting advanced iterative creation of linguistic info for "'.concat(n,'" (max ').concat(a," attempts, multiple validators: ").concat(i,")")),g.label=1;case 1:if(!(s<a))return[3,14];s++,console.log("Attempt ".concat(s,"/").concat(a)),g.label=2;case 2:return g.trys.push([2,12,,13]),l?[3,4]:[4,I(e,t,n,r,o)];case 3:if(!(l=g.sent()))return console.log("Failed to generate linguistic info on attempt ".concat(s)),[3,1];g.label=4;case 4:return u=void 0,i?[4,B(e,t,n,l,r,o)]:[3,6];case 5:return u=g.sent(),[3,8];case 6:return[4,R(e,t,n,l,r,o)];case 7:d=g.sent(),u={overallValid:d.isValid,confidence:.7,validations:[{isValid:d.isValid,errors:d.errors,corrections:d.corrections,confidence:.7,validatorType:"general"}],finalErrors:d.errors,finalCorrections:d.corrections||[],attempts:1},g.label=8;case 8:return c=u,u.overallValid?(console.log("Validation passed on attempt ".concat(s," with confidence ").concat(u.confidence.toFixed(2))),[2,{linguisticInfo:l,wasValidated:!0,attempts:s,confidence:u.confidence,validationDetails:u}]):u.finalErrors.length>0?(console.log("Validation failed on attempt ".concat(s,":"),u.finalErrors),u.finalCorrections.length>0&&s<a?(console.log("Attempting correction on attempt ".concat(s,"...")),[4,O(e,t,n,l,u.finalErrors,u.finalCorrections,r,o)]):[3,10]):[3,11];case 9:return(f=g.sent())?(l=f,console.log("Correction completed on attempt ".concat(s)),[3,1]):(console.log("Correction failed on attempt ".concat(s)),[3,11]);case 10:console.log("No corrections available or max attempts reached"),g.label=11;case 11:return s>=a?(console.log("Max attempts reached (".concat(a,"), returning current result")),[2,{linguisticInfo:l,wasValidated:!1,attempts:s,confidence:u.confidence,validationDetails:u}]):[3,13];case 12:return p=g.sent(),console.error("Error on attempt ".concat(s,":"),p),s>=a?[2,{linguisticInfo:null,wasValidated:!1,attempts:s,confidence:0,validationDetails:c}]:[3,13];case 13:return[3,1];case 14:return[2,{linguisticInfo:l,wasValidated:!1,attempts:s,confidence:(null==c?void 0:c.confidence)||0,validationDetails:c}]}}))}))}function L(e,t,n,r,o,a,i){return void 0===o&&(o="ru"),void 0===a&&(a=5),void 0===i&&(i=!0),y(this,void 0,void 0,(function(){return v(this,(function(s){return[2,N(e,t,n,r,o,a,i)]}))}))}function z(e,t,n,r,o){return void 0===o&&(o="ru"),y(this,void 0,void 0,(function(){var r,a,i,s;return v(this,(function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),console.log('Creating fast linguistic info for "'.concat(n,'" (1 request only)')),r=A(n,0,o),[4,e.createChatCompletion(t,[{role:"user",content:r}])];case 1:return(a=l.sent())&&a.content?(i=a.content.trim(),console.log("Fast linguistic info created successfully"),[2,{linguisticInfo:i,wasValidated:!1,attempts:1}]):(console.log("Failed to generate linguistic info"),[2,{linguisticInfo:null,wasValidated:!1,attempts:1}]);case 2:return s=l.sent(),console.error("Error creating fast linguistic info:",s),[2,{linguisticInfo:null,wasValidated:!1,attempts:1}];case 3:return[2]}}))}))}function D(e,t,n,r,o){return void 0===o&&(o="ru"),y(this,void 0,void 0,(function(){var r,a,i,s,l,c,u;return v(this,(function(d){switch(d.label){case 0:return d.trys.push([0,3,,4]),console.log('Creating optimized linguistic info for "'.concat(n,'" (max 2 requests)')),r=A(n,0,o),[4,e.createChatCompletion(t,[{role:"user",content:r}])];case 1:return(a=d.sent())&&a.content?(i=a.content.trim(),console.log("Initial reference created"),s=_(i,n,o),[4,e.createChatCompletion(t,[{role:"user",content:s}])]):(console.log("Failed to generate initial linguistic info"),[2,{linguisticInfo:null,wasValidated:!1,attempts:1}]);case 2:return(l=d.sent())&&l.content?(c=l.content.trim()).includes("СПРАВКА КОРРЕКТНА")||c.includes("КОРРЕКТНА")?(console.log("Reference validated as correct"),[2,{linguisticInfo:i,wasValidated:!0,attempts:2}]):(console.log("Reference was corrected by validator"),[2,{linguisticInfo:c,wasValidated:!0,attempts:2}]):(console.log("Validator failed, returning initial reference"),[2,{linguisticInfo:i,wasValidated:!1,attempts:2}]);case 3:return u=d.sent(),console.error("Error in optimized linguistic info creation:",u),[2,{linguisticInfo:null,wasValidated:!1,attempts:1}];case 4:return[2]}}))}))}},178:(e,t,n)=>{n.d(t,{Y3:()=>i,cr:()=>a});var r=function(){function e(e){this.requests=new Map,this.activeRequests=new Set,this.requestCounter=0,this.startTime=Date.now(),this.onProgressUpdate=e}return e.prototype.startRequest=function(e,t,n,r){var o="request_".concat(++this.requestCounter,"_").concat(Date.now()),a={id:o,operation:e,description:t,startTime:Date.now(),status:"pending",icon:n,color:r||this.getDefaultColor(e)};return this.requests.set(o,a),this.activeRequests.add(o),this.notifyProgressUpdate(),o},e.prototype.setInProgress=function(e){var t=this.requests.get(e);t&&(t.status="in-progress",this.notifyProgressUpdate())},e.prototype.completeRequest=function(e){var t=this.requests.get(e);t&&(t.status="completed",t.endTime=Date.now(),this.activeRequests.delete(e),this.notifyProgressUpdate())},e.prototype.errorRequest=function(e){var t=this.requests.get(e);t&&(t.status="error",t.endTime=Date.now(),this.activeRequests.delete(e),this.notifyProgressUpdate())},e.prototype.getCurrentProgress=function(){var e=this,t=Array.from(this.requests.values()),n=t.filter((function(e){return"completed"===e.status||"error"===e.status})).length,r=t.length,o=Array.from(this.activeRequests).map((function(t){return e.requests.get(t)})).find((function(e){return"in-progress"===(null==e?void 0:e.status)}));return{completed:n,total:r,currentRequest:o,progress:r>0?n/r*100:0,message:o?{title:o.operation,subtitle:o.description,icon:o.icon,color:o.color,currentStep:n+1,totalSteps:r,currentStepTitle:o.operation,currentStepSubtitle:o.description}:0===r?{title:"Ready",subtitle:"No active requests",icon:"✅",color:"#10B981"}:n===r&&r>0?{title:"Completed!",subtitle:"All ".concat(r," requests finished"),icon:"✅",color:"#10B981",currentStep:n,totalSteps:r,currentStepTitle:"Completed!",currentStepSubtitle:"All ".concat(r," requests finished")}:{title:"Processing...",subtitle:"".concat(n," of ").concat(r," requests completed"),icon:"⚡",color:"#3B82F6",currentStep:n,totalSteps:r,currentStepTitle:"Processing...",currentStepSubtitle:"".concat(n," of ").concat(r," requests completed")}}},e.prototype.getStats=function(){var e=Array.from(this.requests.values());return{total:e.length,completed:e.filter((function(e){return"completed"===e.status})).length,pending:e.filter((function(e){return"pending"===e.status})).length,inProgress:e.filter((function(e){return"in-progress"===e.status})).length,errors:e.filter((function(e){return"error"===e.status})).length,elapsedTime:Date.now()-this.startTime}},e.prototype.reset=function(){this.requests.clear(),this.activeRequests.clear(),this.requestCounter=0,this.startTime=Date.now(),this.notifyProgressUpdate()},e.prototype.getDefaultColor=function(e){for(var t=0,n=Object.entries({translate:"#3B82F6","generate-examples":"#F59E0B","analyze-word":"#8B5CF6","create-image-description":"#EC4899","generate-image":"#6366F1","create-card":"#10B981","save-card":"#EF4444",connect:"#6366F1"});t<n.length;t++){var r=n[t],o=r[0],a=r[1];if(e.toLowerCase().includes(o))return a}return"#6B7280"},e.prototype.getDefaultIcon=function(e){for(var t=0,n=Object.entries({translate:"🌍","generate-examples":"💡","analyze-word":"🔍","create-image-description":"🎨","generate-image":"🖼️","create-card":"🧠","save-card":"💾",connect:"🔗"});t<n.length;t++){var r=n[t],o=r[0],a=r[1];if(e.toLowerCase().includes(o))return a}return"⚡"},e.prototype.notifyProgressUpdate=function(){if(this.onProgressUpdate){var e=this.getCurrentProgress();this.onProgressUpdate(e)}},e}(),o=null,a=function(){return o||(o=new r),o},i=function(e){a().onProgressUpdate=e}},251:(e,t,n)=>{n.r(t),n.d(t,{cacheQuotaExceededError:()=>l,generateAnkiBack:()=>S,generateAnkiFront:()=>w,getCachedQuotaError:()=>d,getDescriptionImage:()=>m,getExamples:()=>g,getOpenAiImageUrl:()=>v,getOptimizedImageUrl:()=>x,isAbstract:()=>h,isQuotaExceededCached:()=>s,markQuotaNotificationShown:()=>c,shouldShowQuotaNotification:()=>u,translateText:()=>p});var r=n(178),o=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},a=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},i=null,s=function(){return!!i&&(!(Date.now()-i.timestamp>3e5)||(i=null,!1))},l=function(e){i={timestamp:Date.now(),message:e,notificationShown:!1}},c=function(){i&&(i.notificationShown=!0)},u=function(){return null!==i&&!i.notificationShown},d=function(){return(null==i?void 0:i.message)||null},f=function(e){if(!e||!e.error)return"Unknown OpenAI API error";var t=e.error,n=t.message,r=t.type,o=t.code,a="";return a="insufficient_quota"===o?"Your OpenAI account has exceeded its quota.\n\nPlease check your billing details or use a different API key.":"invalid_request_error"===r?"Invalid request to OpenAI.\n\nPlease check your API key and settings.":"rate_limit_exceeded"===r?"OpenAI rate limit exceeded.\n\nPlease try again in a few minutes.":"OpenAI API Error: ".concat(n||"Unknown error"),a+="\n\nDetails:\n- Type: ".concat(r||"unknown","\n- Code: ").concat(o||"none")},p=function(e,t,n,c,u){return void 0===n&&(n="ru"),void 0===c&&(c=""),o(void 0,void 0,void 0,(function(){var o,d,p,g,h,m,y,v,x,b,w,S,C,E;return a(this,(function(a){switch(a.label){case 0:o=(0,r.cr)(),d=o.startRequest("Translating text","Converting your text to ".concat(n),"🌍","#3B82F6"),a.label=1;case 1:if(a.trys.push([1,6,,7]),!e)throw o.errorRequest(d),new Error("OpenAI API key is missing. Please check your settings.");if(o.setInProgress(d),s())throw o.errorRequest(d),new Error(i.message);return p="Translate the following text to ".concat(n),g=c?"".concat(p,". ").concat(c):p,h={model:"gpt-3.5-turbo",messages:[{role:"system",content:g},{role:"user",content:"".concat(t)}]},[4,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(h),signal:u})];case 2:return(m=a.sent()).ok?[3,4]:[4,m.json()];case 3:if((y=a.sent())&&y.error)throw v=f(y),"insufficient_quota"!==y.error.code&&429!==m.status||l(v),new Error(v);throw new Error("OpenAI API error: ".concat(m.status," ").concat(m.statusText));case 4:return[4,m.json()];case 5:return x=a.sent(),o.completeRequest(d),[2,null!==(E=null===(C=null===(S=null===(w=x.choices[0])||void 0===w?void 0:w.message)||void 0===S?void 0:S.content)||void 0===C?void 0:C.trim())&&void 0!==E?E:null];case 6:if(b=a.sent(),console.error("Error during translation:",b),o.errorRequest(d),b instanceof Error){if(null==u?void 0:u.aborted)throw new Error("Translation cancelled by user");if(b.message.includes("quota")||b.message.includes("insufficient_quota"))throw new Error(b.message);throw new Error("Translation failed: ".concat(b.message))}throw b;case 7:return[2]}}))}))},g=function(e,t,n,c,u,d){return void 0===c&&(c=!1),void 0===u&&(u=""),o(void 0,void 0,void 0,(function(){var o,g,h,m,y,v,x,b,w,S,C,E,k,I,A,_,T,j,F,R,O,P;return a(this,(function(a){switch(a.label){case 0:o=(0,r.cr)(),g=o.startRequest("Creating example sentences",'Generating helpful examples for "'.concat(t,'"'),"💡","#F59E0B"),a.label=1;case 1:if(a.trys.push([1,14,,15]),!e)throw o.errorRequest(g),new Error("OpenAI API key is missing. Please check your settings.");if(o.setInProgress(g),s())throw o.errorRequest(g),new Error(i.message);return h=u.replace(/\{word\}/g,t),m="Give me three example sentences using the word '".concat(t,"' in the original language (the language of this word). \nEach example should show natural usage of '").concat(t,"' in its native language context.\nReturn ONLY the examples, one per line, without any numbering, explanations, or translations."),y=u?"".concat(m," ").concat(h):m,v={model:"gpt-3.5-turbo",messages:[{role:"system",content:y}]},[4,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(v),signal:d})];case 2:return(x=a.sent()).ok?[3,4]:[4,x.json()];case 3:if((b=a.sent())&&b.error)throw w=f(b),"insufficient_quota"!==b.error.code&&429!==x.status||l(w),new Error(w);throw new Error("Could not generate examples. OpenAI API error: ".concat(x.status," ").concat(x.statusText));case 4:return[4,x.json()];case 5:S=a.sent(),C=null===(O=null===(R=S.choices[0])||void 0===R?void 0:R.message)||void 0===O?void 0:O.content,E=null!==(P=null==C?void 0:C.trim().split("\n"))&&void 0!==P?P:[],k=[],I=0,A=E,a.label=6;case 6:if(!(I<A.length))return[3,13];if(!(_=A[I]).trim())return[3,12];if(T=null,!c)return[3,11];a.label=7;case 7:return a.trys.push([7,9,10,11]),[4,p(e,_,n)];case 8:return T=a.sent(),[3,11];case 9:return j=a.sent(),console.error("Error translating example:",j),[3,11];case 10:return[7];case 11:k.push([_,T]),a.label=12;case 12:return I++,[3,6];case 13:if(0===k.length)throw o.errorRequest(g),new Error("Could not generate examples. Please try again with a different word or check your API key.");return o.completeRequest(g),[2,k];case 14:throw F=a.sent(),console.error("Error during getting examples:",F),o.errorRequest(g),F;case 15:return[2]}}))}))},h=function(e,t){return o(void 0,void 0,void 0,(function(){var n,o,c,u,d,p,g,h,m,y,v,x,b,w;return a(this,(function(a){switch(a.label){case 0:n=(0,r.cr)(),o=n.startRequest("Analyzing word type",'Determining if "'.concat(t,'" can be visualized'),"🔍","#8B5CF6"),a.label=1;case 1:if(a.trys.push([1,6,,7]),!e)throw n.errorRequest(o),new Error("OpenAI API key is missing. Please check your settings.");if(n.setInProgress(o),s())throw n.errorRequest(o),new Error(i.message);return c=[{role:"system",content:"Is the word '".concat(t,"' an abstract concept or a concrete object? Answer 'abstract' or 'concrete':")}],u={model:"gpt-3.5-turbo",messages:c},[4,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(u),signal:void 0})];case 2:return(d=a.sent()).ok?[3,4]:[4,d.json()];case 3:if((p=a.sent())&&p.error)throw g=f(p),"insufficient_quota"!==p.error.code&&429!==d.status||l(g),new Error(g);throw new Error("OpenAI API error: ".concat(d.status," ").concat(d.statusText));case 4:return[4,d.json()];case 5:return h=a.sent(),m=null!==(w=null===(b=null===(x=null===(v=h.choices[0])||void 0===v?void 0:v.message)||void 0===x?void 0:x.content)||void 0===b?void 0:b.trim().toLowerCase())&&void 0!==w?w:"",n.completeRequest(o),[2,"abstract"===m];case 6:return y=a.sent(),console.error("Error during determining abstractness:",y),n.errorRequest(o),[2,!1];case 7:return[2]}}))}))},m=function(e,t,n,c){return void 0===n&&(n=""),o(void 0,void 0,void 0,(function(){var o,u,d,p,g,h,m,y,v,x,b,w,S,C,E;return a(this,(function(a){switch(a.label){case 0:o=(0,r.cr)(),u=o.startRequest("Crafting image description",'Creating detailed prompt for "'.concat(t,'" visualization'),"🎨","#EC4899"),a.label=1;case 1:if(a.trys.push([1,6,,7]),!e)throw o.errorRequest(u),new Error("OpenAI API key is missing. Please check your settings.");if(o.setInProgress(u),s())throw o.errorRequest(u),new Error(i.message);return d="Provide a detailed description for an image that represents the concept of '".concat(t,"'"),p=n?"".concat(d,". ").concat(n):d,g={model:"gpt-3.5-turbo",messages:[{role:"system",content:p}]},[4,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(g),signal:c})];case 2:return(h=a.sent()).ok?[3,4]:[4,h.json()];case 3:if((m=a.sent())&&m.error)throw y=f(m),"insufficient_quota"!==m.error.code&&429!==h.status||l(y),o.errorRequest(u),new Error(y);throw o.errorRequest(u),new Error("Could not generate image description. OpenAI API error: ".concat(h.status," ").concat(h.statusText));case 4:return[4,h.json()];case 5:if(v=a.sent(),!(x=null!==(E=null===(C=null===(S=null===(w=v.choices[0])||void 0===w?void 0:w.message)||void 0===S?void 0:S.content)||void 0===C?void 0:C.trim())&&void 0!==E?E:""))throw o.errorRequest(u),new Error("Could not generate a valid image description. Please try again.");return o.completeRequest(u),[2,x];case 6:throw b=a.sent(),console.error("Error during getting description image:",b),o.errorRequest(u),b;case 7:return[2]}}))}))},y=function(e,t,n){return void 0===n&&(n=""),o(void 0,void 0,void 0,(function(){var o,i,s,c,u,d,p,g,h,m;return a(this,(function(a){switch(a.label){case 0:o=(0,r.cr)(),i=o.startRequest("Generating image","Creating beautiful illustration with AI","🖼️","#6366F1"),a.label=1;case 1:return a.trys.push([1,3,,4]),o.setInProgress(i),s=n?"".concat(t,". ").concat(n):t,[4,e.images.generate({model:"dall-e-2",prompt:s,n:1,size:"512x512",response_format:"url"})];case 2:if(!(c=a.sent()).data||!(null===(m=c.data[0])||void 0===m?void 0:m.url))throw o.errorRequest(i),new Error("OpenAI did not return an image URL. Please try again.");return o.completeRequest(i),[2,c.data[0].url];case 3:if(u=a.sent(),console.error("Error during image generation:",u),o.errorRequest(i),u instanceof Error){if((d=u.message||"").includes("quota")||d.includes("billing"))throw l(p="Your OpenAI account has exceeded its quota.\n\nPlease check your billing details or use a different API key."),new Error(p);if(d.includes("rate limit"))throw new Error("OpenAI rate limit exceeded.\n\nPlease try again in a few minutes.");if(d.includes("invalid API key"))throw new Error("Invalid OpenAI API key.\n\nPlease check your API key in settings.");if(d.includes("moderation")||d.includes("policy"))throw new Error("OpenAI content policy violation.\n\nThe image request was flagged for content policy violation. Please modify your request.");if(d.includes("{")&&d.includes("}"))try{if(g=d.substring(d.indexOf("{"),d.lastIndexOf("}")+1),(h=JSON.parse(g))&&h.error)return[2,f(h)]}catch(e){}throw u}throw new Error("Failed to generate image.\n\nPlease check your OpenAI API key and try again.");case 4:return[2]}}))}))},v=function(e,t,n,l){return void 0===l&&(l=""),o(void 0,void 0,void 0,(function(){var o,c,u,d,f,p;return a(this,(function(a){switch(a.label){case 0:o=(0,r.cr)(),c=o.startRequest("Creating custom image",'Generating visual for "'.concat(n,'"'),"🖼️","#6366F1"),a.label=1;case 1:if(a.trys.push([1,8,,9]),!t)throw o.errorRequest(c),new Error("OpenAI API key is missing. Please check your settings.");if(o.setInProgress(c),s())throw o.errorRequest(c),new Error(i.message);return[4,h(t,n)];case 2:return a.sent()?[4,m(t,n,l)]:[3,5];case 3:return u=a.sent(),[4,y(e,"Create a vivid, high-quality illustration representing the concept of '".concat(u,"'"),l)];case 4:return f=a.sent(),o.completeRequest(c),[2,f];case 5:return d="Create a high-quality, photorealistic image of a ".concat(n," with a neutral expression and clear features"),[4,y(e,d,l)];case 6:return f=a.sent(),o.completeRequest(c),[2,f];case 7:return[3,9];case 8:throw p=a.sent(),console.error("Error during getting image for word:",p),o.errorRequest(c),p;case 9:return[2]}}))}))},x=function(e,t,n,l){return void 0===l&&(l=""),o(void 0,void 0,void 0,(function(){var o,c,u,d,f;return a(this,(function(a){switch(a.label){case 0:o=(0,r.cr)(),c=o.startRequest("Creating optimized image",'Fast generation for "'.concat(n,'"'),"🖼️","#6366F1"),a.label=1;case 1:if(a.trys.push([1,3,,4]),!t)throw o.errorRequest(c),new Error("OpenAI API key is missing. Please check your settings.");if(o.setInProgress(c),s())throw o.errorRequest(c),new Error(i.message);return u='Create a high-quality, clear image representing "'.concat(n,'".'),u=/^[A-Z]/.test(n)||n.length>15?'Create a symbolic, artistic illustration that clearly represents the concept of "'.concat(n,'". Use clear visual metaphors and symbols.'):'Create a photorealistic image of "'.concat(n,'" with good lighting and clear details on a neutral background.'),l&&(u+=" ".concat(l)),[4,y(e,u,"")];case 2:return d=a.sent(),o.completeRequest(c),[2,d];case 3:throw f=a.sent(),console.error("Error during optimized image generation:",f),o.errorRequest(c),f;case 4:return[2]}}))}))},b=function(e,t){return o(void 0,void 0,void 0,(function(){var n,o,c,u,d,p,g,h,m,y,v,x;return a(this,(function(a){switch(a.label){case 0:n=(0,r.cr)(),o=n.startRequest("Detecting language","Identifying the language of your text","🔤","#8B5CF6"),a.label=1;case 1:if(a.trys.push([1,6,,7]),!e)throw n.errorRequest(o),new Error("OpenAI API key is missing. Please check your settings.");if(n.setInProgress(o),s())throw n.errorRequest(o),new Error(i.message);return c={model:"gpt-3.5-turbo",messages:[{role:"system",content:"You are langauage expert"},{role:"user",content:"What is the name of this language: ".concat(t,". Give only name of this language in one word")}]},[4,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(c),signal:void 0})];case 2:return(u=a.sent()).ok?[3,4]:[4,u.json()];case 3:if((d=a.sent())&&d.error)throw p=f(d),"insufficient_quota"!==d.error.code&&429!==u.status||l(p),new Error(p);throw new Error("OpenAI API error: ".concat(u.status," ").concat(u.statusText));case 4:return[4,u.json()];case 5:return g=a.sent(),n.completeRequest(o),[2,null!==(x=null===(v=null===(y=null===(m=g.choices[0])||void 0===m?void 0:m.message)||void 0===y?void 0:y.content)||void 0===v?void 0:v.trim())&&void 0!==x?x:null];case 6:throw h=a.sent(),console.error("Error during language name detection:",h),n.errorRequest(o),h;case 7:return[2]}}))}))},w=function(e,t,n){return o(void 0,void 0,void 0,(function(){var o,l,c,u,d,f,p,g,h,m;return a(this,(function(a){switch(a.label){case 0:o=(0,r.cr)(),l=o.startRequest("Creating question","Crafting an effective question for your flashcard","❓","#10B981"),a.label=1;case 1:if(a.trys.push([1,5,,6]),!e)throw o.errorRequest(l),new Error("OpenAI API key is missing. Please check your settings.");if(o.setInProgress(l),s())throw o.errorRequest(l),new Error(i.message);return[4,b(e,t)];case 2:return c=a.sent(),u={model:"gpt-3.5-turbo",messages:[{role:"system",content:"You generate a question based on the text entered. You answer should be in ".concat(c)},{role:"user",content:"Give a main question of this text: ".concat(t,"'. You answer should be in ").concat(c)}]},[4,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(u),signal:n})];case 3:return[4,a.sent().json()];case 4:return d=a.sent(),o.completeRequest(l),[2,null!==(m=null===(h=null===(g=null===(p=d.choices[0])||void 0===p?void 0:p.message)||void 0===g?void 0:g.content)||void 0===h?void 0:h.trim())&&void 0!==m?m:null];case 5:return f=a.sent(),console.error("Error during generating front side of the Anki card:",f),o.errorRequest(l),[2,null];case 6:return[2]}}))}))},S=function(e,t){return o(void 0,void 0,void 0,(function(){var n,o,l,c,u,d,f,p,g,h;return a(this,(function(a){switch(a.label){case 0:n=(0,r.cr)(),o=n.startRequest("Creating answer","Developing comprehensive answer for your card","📖","#F59E0B"),a.label=1;case 1:if(a.trys.push([1,5,,6]),!e)throw n.errorRequest(o),new Error("OpenAI API key is missing. Please check your settings.");if(n.setInProgress(o),s())throw n.errorRequest(o),new Error(i.message);return[4,b(e,t)];case 2:return l=a.sent(),c={model:"gpt-3.5-turbo",messages:[{role:"system",content:"You generate a key point based on the text entered. For back of flash card. You answer should be in ".concat(l)},{role:"user",content:"Anilize text. Highlight the key points from this text. Put them in a list of senteses with dash points.\n                                Text: '".concat(t,"'. You answer should be in ").concat(l,". Key points should be competed and make sence")}]},[4,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(c),signal:void 0})];case 3:return[4,a.sent().json()];case 4:return u=a.sent(),n.completeRequest(o),[2,null!==(h=null===(g=null===(p=null===(f=u.choices[0])||void 0===f?void 0:f.message)||void 0===p?void 0:p.content)||void 0===g?void 0:g.trim())&&void 0!==h?h:null];case 5:return d=a.sent(),console.error("Error during generating back side of the Anki card:",d),n.errorRequest(o),[2,null];case 6:return[2]}}))}))}},393:(e,t,n)=>{n.d(t,{BE:()=>_,Br:()=>v,Fo:()=>A,GN:()=>d,H1:()=>j,K$:()=>y,KS:()=>F,OD:()=>g,R6:()=>u,Sv:()=>l,VM:()=>a,Wf:()=>p,Wy:()=>b,Xn:()=>c,ZJ:()=>C,Zm:()=>E,_W:()=>S,a0:()=>x,d$:()=>h,dU:()=>T,h9:()=>m,iY:()=>w,j9:()=>o,oV:()=>i,ow:()=>f,qM:()=>I,r:()=>r,x0:()=>s,yo:()=>k});var r="SET_OPEN_AI_KEY",o="SET_SELECTED_MODE",a="SET_TRANSLATE_TO_LANGUAGE",i="SET_ANKI_CONNECT_URL",s="SET_ANKI_CONNECT_API_KEY",l="SET_USE_ANKI_CONNECT",c="SET_VISIBLE_SIDEBAR",u="SET_SHOULD_GENERATE_IMAGE",d="SET_IMAGE_GENERATION_MODE",f="SET_TRANSLATION_PROMPT",p="SET_EXAMPLES_PROMPT",g="SET_AI_INSTRUCTIONS",h="SET_IMAGE_INSTRUCTIONS",m="SET_MODEL_PROVIDER",y="SET_GROQ_API_KEY",v="SET_GROQ_MODEL_NAME",x="SET_SOURCE_LANGUAGE",b=function(e){return{type:r,payload:e}},w=function(e){return{type:o,payload:e}},S=function(e){return{type:a,payload:e}},C=function(e){return{type:i,payload:e}},E=function(e){return{type:s,payload:e}},k=function(e){return{type:u,payload:e}},I=function(e){return{type:g,payload:e}},A=function(e){return{type:h,payload:e}},_=function(e){return{type:d,payload:e}},T=function(e){return{type:m,payload:e}},j=function(e){return{type:y,payload:e}},F=function(e){return{type:v,payload:e}}},417:(e,t,n)=>{n.d(t,{W:()=>l,l:()=>r});var r,o=n(393),a=n(797),i=function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},i.apply(this,arguments)};!function(e){e.OpenAI="openai",e.Groq="groq"}(r||(r={}));var s={openAiKey:"",mode:a.d.LanguageLearning,translateToLanguage:"ru",ankiConnectUrl:"http://127.0.0.1:8765",ankiConnectApiKey:null,useAnkiConnect:!1,visibleSideBar:!0,groqApiKey:"",groqModelName:"llama3-8b-8192",shouldGenerateImage:!0,imageGenerationMode:"smart",translationPrompt:"",examplesPrompt:"",aiInstructions:"",imageInstructions:"",modelProvider:r.OpenAI,sourceLanguage:"en"},l=function(e,t){switch(void 0===e&&(e=s),t.type){case o.r:return i(i({},e),{openAiKey:t.payload});case o.j9:return i(i({},e),{mode:t.payload});case o.VM:return i(i({},e),{translateToLanguage:t.payload});case o.oV:return i(i({},e),{ankiConnectUrl:t.payload});case o.x0:return i(i({},e),{ankiConnectApiKey:t.payload});case o.Sv:return i(i({},e),{useAnkiConnect:t.payload});case o.Xn:return i(i({},e),{visibleSideBar:t.visible});case o.K$:return i(i({},e),{groqApiKey:t.payload});case o.Br:return i(i({},e),{groqModelName:t.payload});case o.R6:return i(i({},e),{shouldGenerateImage:t.payload});case o.ow:return i(i({},e),{translationPrompt:t.payload});case o.Wf:return i(i({},e),{examplesPrompt:t.payload});case o.OD:return i(i({},e),{aiInstructions:t.payload});case o.d$:return i(i({},e),{imageInstructions:t.payload});case o.GN:return i(i({},e),{imageGenerationMode:t.payload});case o.h9:return i(i({},e),{modelProvider:t.payload});case o.a0:return i(i({},e),{sourceLanguage:t.payload});default:return e}}},63:(e,t,n)=>{
/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var r=n(540);var o="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},a=r.useState,i=r.useEffect,s=r.useLayoutEffect,l=r.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!o(e,n)}catch(e){return!0}}var u="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),r=a({inst:{value:n,getSnapshot:t}}),o=r[0].inst,u=r[1];return s((function(){o.value=n,o.getSnapshot=t,c(o)&&u({inst:o})}),[e,n,t]),i((function(){return c(o)&&u({inst:o}),e((function(){c(o)&&u({inst:o})}))}),[e]),l(n),n};t.useSyncExternalStore=void 0!==r.useSyncExternalStore?r.useSyncExternalStore:u},940:(e,t,n)=>{
/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var r=n(540),o=n(888);var a="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},i=o.useSyncExternalStore,s=r.useRef,l=r.useEffect,c=r.useMemo,u=r.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,n,r,o){var d=s(null);if(null===d.current){var f={hasValue:!1,value:null};d.current=f}else f=d.current;d=c((function(){function e(e){if(!l){if(l=!0,i=e,e=r(e),void 0!==o&&f.hasValue){var t=f.value;if(o(t,e))return s=t}return s=e}if(t=s,a(i,e))return t;var n=r(e);return void 0!==o&&o(t,n)?t:(i=e,s=n)}var i,s,l=!1,c=void 0===n?null:n;return[function(){return e(t())},null===c?void 0:function(){return e(c())}]}),[t,n,r,o]);var p=i(e,d[0],d[1]);return l((function(){f.hasValue=!0,f.value=p}),[p]),u(p),p}},888:(e,t,n)=>{e.exports=n(63)},242:(e,t,n)=>{e.exports=n(940)},743:(e,t,n)=>{n.d(t,{z4:()=>wr});const r="RFC3986",o={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:e=>String(e)},a=(Object.prototype.hasOwnProperty,Array.isArray),i=(()=>{const e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();const s=1024;function l(e,t){if(a(e)){const n=[];for(let r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)}const c=Object.prototype.hasOwnProperty,u={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},d=Array.isArray,f=Array.prototype.push,p=function(e,t){f.apply(e,d(t)?t:[t])},g=Date.prototype.toISOString,h={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,n,r,o)=>{if(0===e.length)return e;let a=e;if("symbol"==typeof e?a=Symbol.prototype.toString.call(e):"string"!=typeof e&&(a=String(e)),"iso-8859-1"===n)return escape(a).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));let l="";for(let e=0;e<a.length;e+=s){const t=a.length>=s?a.slice(e,e+s):a,n=[];for(let e=0;e<t.length;++e){let r=t.charCodeAt(e);45===r||46===r||95===r||126===r||r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122||"RFC1738"===o&&(40===r||41===r)?n[n.length]=t.charAt(e):r<128?n[n.length]=i[r]:r<2048?n[n.length]=i[192|r>>6]+i[128|63&r]:r<55296||r>=57344?n[n.length]=i[224|r>>12]+i[128|r>>6&63]+i[128|63&r]:(e+=1,r=65536+((1023&r)<<10|1023&t.charCodeAt(e)),n[n.length]=i[240|r>>18]+i[128|r>>12&63]+i[128|r>>6&63]+i[128|63&r])}l+=n.join("")}return l},encodeValuesOnly:!1,format:r,formatter:o[r],indices:!1,serializeDate:e=>g.call(e),skipNulls:!1,strictNullHandling:!1};const m={};function y(e,t,n,r,o,a,i,s,c,u,f,g,v,x,b,w,S,C){let E=e,k=C,I=0,A=!1;for(;void 0!==(k=k.get(m))&&!A;){const t=k.get(e);if(I+=1,void 0!==t){if(t===I)throw new RangeError("Cyclic object value");A=!0}void 0===k.get(m)&&(I=0)}if("function"==typeof u?E=u(t,E):E instanceof Date?E=v?.(E):"comma"===n&&d(E)&&(E=l(E,(function(e){return e instanceof Date?v?.(e):e}))),null===E){if(a)return c&&!w?c(t,h.encoder,S,"key",x):t;E=""}if("string"==typeof(_=E)||"number"==typeof _||"boolean"==typeof _||"symbol"==typeof _||"bigint"==typeof _||function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))}(E)){if(c){const e=w?t:c(t,h.encoder,S,"key",x);return[b?.(e)+"="+b?.(c(E,h.encoder,S,"value",x))]}return[b?.(t)+"="+b?.(String(E))]}var _;const T=[];if(void 0===E)return T;let j;if("comma"===n&&d(E))w&&c&&(E=l(E,c)),j=[{value:E.length>0?E.join(",")||null:void 0}];else if(d(u))j=u;else{const e=Object.keys(E);j=f?e.sort(f):e}const F=s?String(t).replace(/\./g,"%2E"):String(t),R=r&&d(E)&&1===E.length?F+"[]":F;if(o&&d(E)&&0===E.length)return R+"[]";for(let t=0;t<j.length;++t){const l=j[t],h="object"==typeof l&&void 0!==l.value?l.value:E[l];if(i&&null===h)continue;const k=g&&s?l.replace(/\./g,"%2E"):l,A=d(E)?"function"==typeof n?n(R,k):R:R+(g?"."+k:"["+k+"]");C.set(e,I);const _=new WeakMap;_.set(m,C),p(T,y(h,A,n,r,o,a,i,s,"comma"===n&&w&&d(E)?null:c,u,f,g,v,x,b,w,S,_))}return T}function v(e,t={}){let n=e;const a=function(e=h){if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");const t=e.charset||h.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=r;if(void 0!==e.format){if(!c.call(o,e.format))throw new TypeError("Unknown format option provided.");n=e.format}const a=o[n];let i,s=h.filter;if(("function"==typeof e.filter||d(e.filter))&&(s=e.filter),i=e.arrayFormat&&e.arrayFormat in u?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":h.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const l=void 0===e.allowDots?1==!!e.encodeDotInKeys||h.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:h.addQueryPrefix,allowDots:l,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:h.allowEmptyArrays,arrayFormat:i,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:h.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?h.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:h.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:h.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:h.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:h.encodeValuesOnly,filter:s,format:n,formatter:a,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:h.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:h.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:h.strictNullHandling}}(t);let i,s;"function"==typeof a.filter?(s=a.filter,n=s("",n)):d(a.filter)&&(s=a.filter,i=s);const l=[];if("object"!=typeof n||null===n)return"";const f=u[a.arrayFormat],g="comma"===f&&a.commaRoundTrip;i||(i=Object.keys(n)),a.sort&&i.sort(a.sort);const m=new WeakMap;for(let e=0;e<i.length;++e){const t=i[e];a.skipNulls&&null===n[t]||p(l,y(n[t],t,f,g,a.allowEmptyArrays,a.strictNullHandling,a.skipNulls,a.encodeDotInKeys,a.encode?a.encoder:null,a.filter,a.sort,a.allowDots,a.serializeDate,a.format,a.formatter,a.encodeValuesOnly,a.charset,m))}const v=l.join(a.delimiter);let x=!0===a.addQueryPrefix?"?":"";return a.charsetSentinel&&("iso-8859-1"===a.charset?x+="utf8=%26%2310003%3B&":x+="utf8=%E2%9C%93&"),v.length>0?x+v:""}const x="4.72.0";let b,w,S,C,E,k,I,A,_,T=!1,j=null,F=null,R=null,O=null;class P{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}b||function(e,t={auto:!1}){if(T)throw new Error(`you must \`import 'openai/shims/${e.kind}'\` before importing anything else from openai`);if(b)throw new Error(`can't \`import 'openai/shims/${e.kind}'\` after \`import 'openai/shims/${b}'\``);T=t.auto,b=e.kind,w=e.fetch,j=e.Request,F=e.Response,R=e.Headers,S=e.FormData,O=e.Blob,C=e.File,E=e.ReadableStream,k=e.getMultipartRequestOptions,I=e.getDefaultAgent,A=e.fileFromPath,_=e.isFsReadStream}(function({manuallyImported:e}={}){const t=e?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let n,r,o,a;try{n=fetch,r=Request,o=Response,a=Headers}catch(e){throw new Error(`this environment is missing the following Web Fetch API type: ${e.message}. ${t}`)}return{kind:"web",fetch:n,Request:r,Response:o,Headers:a,FormData:"undefined"!=typeof FormData?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${t}`)}},Blob:"undefined"!=typeof Blob?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${t}`)}},File:"undefined"!=typeof File?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${t}`)}},ReadableStream:"undefined"!=typeof ReadableStream?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${t}`)}},getMultipartRequestOptions:async(e,t)=>({...t,body:new P(e)}),getDefaultAgent:e=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:e=>!1}}(),{auto:!0});class B extends Error{}class N extends B{constructor(e,t,n,r){super(`${N.makeMessage(e,t,n)}`),this.status=e,this.headers=r,this.request_id=r?.["x-request-id"];const o=t;this.error=o,this.code=o?.code,this.param=o?.param,this.type=o?.type}static makeMessage(e,t,n){const r=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,n,r){if(!e)return new z({message:n,cause:Pe(t)});const o=t?.error;return 400===e?new M(e,o,n,r):401===e?new U(e,o,n,r):403===e?new q(e,o,n,r):404===e?new W(e,o,n,r):409===e?new V(e,o,n,r):422===e?new $(e,o,n,r):429===e?new G(e,o,n,r):e>=500?new H(e,o,n,r):new N(e,o,n,r)}}class L extends N{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}}class z extends N{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}}class D extends z{constructor({message:e}={}){super({message:e??"Request timed out."})}}class M extends N{constructor(){super(...arguments),this.status=400}}class U extends N{constructor(){super(...arguments),this.status=401}}class q extends N{constructor(){super(...arguments),this.status=403}}class W extends N{constructor(){super(...arguments),this.status=404}}class V extends N{constructor(){super(...arguments),this.status=409}}class $ extends N{constructor(){super(...arguments),this.status=422}}class G extends N{constructor(){super(...arguments),this.status=429}}class H extends N{}class K extends B{constructor(){super("Could not parse response content as the length limit was reached")}}class Q extends B{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class Y{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const n=Y.NEWLINE_CHARS.has(t[t.length-1]||"");let r=t.split(Y.NEWLINE_REGEXP);return n&&r.pop(),1!==r.length||n?(this.buffer.length>0&&(r=[this.buffer.join("")+r[0],...r.slice(1)],this.buffer=[]),n||(this.buffer=[r.pop()||""]),r):(this.buffer.push(r[0]),[])}decodeText(e){if(null==e)return"";if("string"==typeof e)return e;if("undefined"!=typeof Buffer){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new B(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new B(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new B("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}Y.NEWLINE_CHARS=new Set(["\n","\r"]),Y.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class J{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;return new J((async function*(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let r=!1;try{for await(const n of async function*(e,t){if(!e.body)throw t.abort(),new B("Attempted to iterate over a response with no body");const n=new Z,r=new Y,o=ee(e.body);for await(const e of async function*(e){let t=new Uint8Array;for await(const n of e){if(null==n)continue;const e=n instanceof ArrayBuffer?new Uint8Array(n):"string"==typeof n?(new TextEncoder).encode(n):n;let r,o=new Uint8Array(t.length+e.length);for(o.set(t),o.set(e,t.length),t=o;-1!==(r=X(t));)yield t.slice(0,r),t=t.slice(r)}t.length>0&&(yield t)}(o))for(const t of r.decode(e)){const e=n.decode(t);e&&(yield e)}for(const e of r.flush()){const t=n.decode(e);t&&(yield t)}}(e,t))if(!r)if(n.data.startsWith("[DONE]"))r=!0;else if(null===n.event){let e;try{e=JSON.parse(n.data)}catch(e){throw console.error("Could not parse message into JSON:",n.data),console.error("From chunk:",n.raw),e}if(e&&e.error)throw new N(void 0,e.error,void 0,void 0);yield e}else{let e;try{e=JSON.parse(n.data)}catch(e){throw console.error("Could not parse message into JSON:",n.data),console.error("From chunk:",n.raw),e}if("error"==n.event)throw new N(void 0,e.error,e.message,void 0);yield{event:n.event,data:e}}r=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{r||t.abort()}}),t)}static fromReadableStream(e,t){let n=!1;return new J((async function*(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let r=!1;try{for await(const t of async function*(){const t=new Y,n=ee(e);for await(const e of n)for(const n of t.decode(e))yield n;for(const e of t.flush())yield e}())r||t&&(yield JSON.parse(t));r=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{r||t.abort()}}),t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),r=r=>({next:()=>{if(0===r.length){const r=n.next();e.push(r),t.push(r)}return r.shift()}});return[new J((()=>r(e)),this.controller),new J((()=>r(t)),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new E({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{const{value:r,done:o}=await t.next();if(o)return e.close();const a=n.encode(JSON.stringify(r)+"\n");e.enqueue(a)}catch(t){e.error(t)}},async cancel(){await(t.return?.())}})}}function X(e){for(let t=0;t<e.length-2;t++){if(10===e[t]&&10===e[t+1])return t+2;if(13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return-1}class Z{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,r]=function(e,t){const n=e.indexOf(t);if(-1!==n)return[e.substring(0,n),t,e.substring(n+t.length)];return[e,"",""]}(e,":");return r.startsWith(" ")&&(r=r.substring(1)),"event"===t?this.event=r:"data"===t&&this.data.push(r),null}}function ee(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const te=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob,ne=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&re(e),re=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer,oe=e=>ne(e)||te(e)||_(e);async function ae(e,t,n){if(e=await e,ne(e))return e;if(te(e)){const r=await e.blob();t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()??"unknown_file");const o=re(r)?[await r.arrayBuffer()]:[r];return new C(o,t,n)}const r=await async function(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(re(e))t.push(await e.arrayBuffer());else{if(!se(e))throw new Error(`Unexpected data type: ${typeof e}; constructor: ${e?.constructor?.name}; props: ${function(e){const t=Object.getOwnPropertyNames(e);return`[${t.map((e=>`"${e}"`)).join(", ")}]`}(e)}`);for await(const n of e)t.push(n)}return t}(e);if(t||(t=function(e){return ie(e.name)||ie(e.filename)||ie(e.path)?.split(/[\\/]/).pop()}(e)??"unknown_file"),!n?.type){const e=r[0]?.type;"string"==typeof e&&(n={...n,type:e})}return new C(r,t,n)}const ie=e=>"string"==typeof e?e:"undefined"!=typeof Buffer&&e instanceof Buffer?String(e):void 0,se=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],le=e=>e&&"object"==typeof e&&e.body&&"MultipartBody"===e[Symbol.toStringTag],ce=async e=>{const t=await ue(e.body);return k(t,e)},ue=async e=>{const t=new S;return await Promise.all(Object.entries(e||{}).map((([e,n])=>de(t,e,n)))),t},de=async(e,t,n)=>{if(void 0!==n){if(null==n)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)e.append(t,String(n));else if(oe(n)){const r=await ae(n);e.append(t,r)}else if(Array.isArray(n))await Promise.all(n.map((n=>de(e,t+"[]",n))));else{if("object"!=typeof n)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`);await Promise.all(Object.entries(n).map((([n,r])=>de(e,`${t}[${n}]`,r))))}}};var fe,pe=function(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,n):o?o.value=n:t.set(e,n),n},ge=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};async function he(e){const{response:t}=e;if(e.options.stream)return De("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):J.fromSSEResponse(t,e.controller);if(204===t.status)return null;if(e.options.__binaryResponse)return t;const n=t.headers.get("content-type");if(n?.includes("application/json")||n?.includes("application/vnd.api+json")){const e=await t.json();return De("response",t.status,t.url,t.headers,e),me(e,t)}const r=await t.text();return De("response",t.status,t.url,t.headers,r),r}function me(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class ye extends Promise{constructor(e,t=he){super((e=>{e(null)})),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new ye(this.responsePromise,(async t=>me(e(await this.parseResponse(t),t),t.response)))}asResponse(){return this.responsePromise.then((e=>e.response))}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class ve{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:r,fetch:o}){this.baseURL=e,this.maxRetries=Oe("maxRetries",t),this.timeout=Oe("timeout",n),this.httpAgent=r,this.fetch=o??w}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),..._e(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${Me()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then((async n=>{const r=n&&re(n?.body)?new DataView(await n.body.arrayBuffer()):n?.body instanceof DataView?n.body:n?.body instanceof ArrayBuffer?new DataView(n.body):n&&ArrayBuffer.isView(n?.body)?new DataView(n.body.buffer):n?.body;return{method:e,path:t,...n,body:r}})))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if("string"==typeof e){if("undefined"!=typeof Buffer)return Buffer.byteLength(e,"utf8").toString();if("undefined"!=typeof TextEncoder){return(new TextEncoder).encode(e).length.toString()}}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){const{method:n,path:r,query:o,headers:a={}}=e,i=ArrayBuffer.isView(e.body)||e.__binaryRequest&&"string"==typeof e.body?e.body:le(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,s=this.calculateContentLength(i),l=this.buildURL(r,o);"timeout"in e&&Oe("timeout",e.timeout);const c=e.timeout??this.timeout,u=e.httpAgent??this.httpAgent??I(l),d=c+1e3;"number"==typeof u?.options?.timeout&&d>(u.options.timeout??0)&&(u.options.timeout=d),this.idempotencyHeader&&"get"!==n&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);return{req:{method:n,...i&&{body:i},headers:this.buildHeaders({options:e,headers:a,contentLength:s,retryCount:t}),...u&&{agent:u},signal:e.signal??null},url:l,timeout:c}}buildHeaders({options:e,headers:t,contentLength:n,retryCount:r}){const o={};n&&(o["content-length"]=n);const a=this.defaultHeaders(e);return ze(o,a),ze(o,t),le(e.body)&&"node"!==b&&delete o["content-type"],void 0===Ue(a,"x-stainless-retry-count")&&void 0===Ue(t,"x-stainless-retry-count")&&(o["x-stainless-retry-count"]=String(r)),this.validateHeaders(o,t),o}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map((e=>[...e]))):{...e}:{}}makeStatusError(e,t,n,r){return N.generate(e,t,n,r)}request(e,t=null){return new ye(this.makeRequest(e,t))}async makeRequest(e,t){const n=await e,r=n.maxRetries??this.maxRetries;null==t&&(t=r),await this.prepareOptions(n);const{req:o,url:a,timeout:i}=this.buildRequest(n,{retryCount:r-t});if(await this.prepareRequest(o,{url:a,options:n}),De("request",a,n,o.headers),n.signal?.aborted)throw new L;const s=new AbortController,l=await this.fetchWithTimeout(a,o,i,s).catch(Pe);if(l instanceof Error){if(n.signal?.aborted)throw new L;if(t)return this.retryRequest(n,t);if("AbortError"===l.name)throw new D;throw new z({cause:l})}const c=we(l.headers);if(!l.ok){if(t&&this.shouldRetry(l)){return De(`response (error; ${`retrying, ${t} attempts remaining`})`,l.status,a,c),this.retryRequest(n,t,c)}const e=await l.text().catch((e=>Pe(e).message)),r=Te(e),o=r?void 0:e;De(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,l.status,a,c,o);throw this.makeStatusError(l.status,r,o,c)}return{response:l,options:n,controller:s}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new be(this,n,e)}buildURL(e,t){const n=Fe(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),r=this.defaultQuery();return Ne(r)||(t={...r,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter((([e,t])=>void 0!==t)).map((([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new B(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)})).join("&")}async fetchWithTimeout(e,t,n,r){const{signal:o,...a}=t||{};o&&o.addEventListener("abort",(()=>r.abort()));const i=setTimeout((()=>r.abort()),n);return this.getRequestClient().fetch.call(void 0,e,{signal:r.signal,...a}).finally((()=>{clearTimeout(i)}))}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||(409===e.status||(429===e.status||e.status>=500)))}async retryRequest(e,t,n){let r;const o=n?.["retry-after-ms"];if(o){const e=parseFloat(o);Number.isNaN(e)||(r=e)}const a=n?.["retry-after"];if(a&&!r){const e=parseFloat(a);r=Number.isNaN(e)?Date.parse(a)-Date.now():1e3*e}if(!(r&&0<=r&&r<6e4)){const n=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,n)}return await Re(r),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const n=t-e;return Math.min(.5*Math.pow(2,n),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS ${x}`}}class xe{constructor(e,t,n,r){fe.set(this,void 0),pe(this,fe,e,"f"),this.options=r,this.response=t,this.body=n}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageInfo()}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new B("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&"object"==typeof t.query)t.query={...t.query,...e.params};else if("url"in e){const n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[t,r]of n)e.url.searchParams.set(t,r);t.query=void 0,t.path=e.url.toString()}return await ge(this,fe,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(fe=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class be extends ye{constructor(e,t,n){super(t,(async t=>new n(e,t.response,await he(t),t.options)))}async*[Symbol.asyncIterator](){const e=await(this);for await(const t of e)yield t}}const we=e=>new Proxy(Object.fromEntries(e.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),Se={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},Ce=e=>"object"==typeof e&&null!==e&&!Ne(e)&&Object.keys(e).every((e=>Le(Se,e))),Ee=()=>{if("undefined"!=typeof Deno&&null!=Deno.build)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":x,"X-Stainless-OS":Ie(Deno.build.os),"X-Stainless-Arch":ke(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":x,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if("[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0))return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":x,"X-Stainless-OS":Ie(process.platform),"X-Stainless-Arch":ke(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const e=function(){if("undefined"==typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:n}of e){const e=n.exec(navigator.userAgent);if(e){return{browser:t,version:`${e[1]||0}.${e[2]||0}.${e[3]||0}`}}}return null}();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":x,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":x,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};const ke=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",Ie=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";let Ae;const _e=()=>Ae??(Ae=Ee()),Te=e=>{try{return JSON.parse(e)}catch(e){return}},je=new RegExp("^(?:[a-z]+:)?//","i"),Fe=e=>je.test(e),Re=e=>new Promise((t=>setTimeout(t,e))),Oe=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new B(`${e} must be an integer`);if(t<0)throw new B(`${e} must be a positive integer`);return t},Pe=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e)try{return new Error(JSON.stringify(e))}catch{}return new Error(e)},Be=e=>"undefined"!=typeof process?process.env?.[e]?.trim()??void 0:"undefined"!=typeof Deno?Deno.env?.get?.(e)?.trim():void 0;function Ne(e){if(!e)return!0;for(const t in e)return!1;return!0}function Le(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function ze(e,t){for(const n in t){if(!Le(t,n))continue;const r=n.toLowerCase();if(!r)continue;const o=t[n];null===o?delete e[r]:void 0!==o&&(e[r]=o)}}function De(e,...t){"undefined"!=typeof process&&"true"===process?.env?.DEBUG&&console.log(`OpenAI:DEBUG:${e}`,...t)}const Me=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),Ue=(e,t)=>{const n=t.toLowerCase();if((e=>"function"==typeof e?.get)(e)){const r=t[0]?.toUpperCase()+t.substring(1).replace(/([^\w])(\w)/g,((e,t,n)=>t+n.toUpperCase()));for(const o of[t,n,t.toUpperCase(),r]){const t=e.get(o);if(t)return t}}for(const[r,o]of Object.entries(e))if(r.toLowerCase()===n)return Array.isArray(o)?(o.length<=1||console.warn(`Received ${o.length} entries for the ${t} header, using the first entry.`),o[0]):o};function qe(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}class We{constructor(e){this._client=e}}class Ve extends We{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class $e extends We{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}}class Ge extends We{constructor(){super(...arguments),this.completions=new $e(this._client)}}Ge.Completions=$e;class He extends We{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}class Ke extends xe{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class Qe extends xe{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){const e=this.getPaginatedItems();if(!e.length)return null;const t=e[e.length-1]?.id;return t?{params:{after:t}}:null}}class Ye extends We{create(e,t){return this._client.post("/files",ce({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return Ce(e)?this.list({},e):this._client.getAPIList("/files",Je,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t?.headers}})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=18e5}={}){const r=new Set(["processed","error","deleted"]),o=Date.now();let a=await this.retrieve(e);for(;!a.status||!r.has(a.status);)if(await Re(t),a=await this.retrieve(e),Date.now()-o>n)throw new D({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return a}}class Je extends Qe{}Ye.FileObjectsPage=Je;class Xe extends We{createVariation(e,t){return this._client.post("/images/variations",ce({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",ce({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class Ze extends We{create(e,t){return this._client.post("/audio/speech",{body:e,...t,__binaryResponse:!0})}}class et extends We{create(e,t){return this._client.post("/audio/transcriptions",ce({body:e,...t}))}}class tt extends We{create(e,t){return this._client.post("/audio/translations",ce({body:e,...t}))}}class nt extends We{constructor(){super(...arguments),this.transcriptions=new et(this._client),this.translations=new tt(this._client),this.speech=new Ze(this._client)}}nt.Transcriptions=et,nt.Translations=tt,nt.Speech=Ze;class rt extends We{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class ot extends We{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",at,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class at extends Ke{}ot.ModelsPage=at;class it extends We{list(e,t={},n){return Ce(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,st,{query:t,...n})}}class st extends Qe{}it.FineTuningJobCheckpointsPage=st;class lt extends We{constructor(){super(...arguments),this.checkpoints=new it(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return Ce(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",ct,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return Ce(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,ut,{query:t,...n})}}class ct extends Qe{}class ut extends Qe{}lt.FineTuningJobsPage=ct,lt.FineTuningJobEventsPage=ut,lt.Checkpoints=it,lt.FineTuningJobCheckpointsPage=st;class dt extends We{constructor(){super(...arguments),this.jobs=new lt(this._client)}}dt.Jobs=lt,dt.FineTuningJobsPage=ct,dt.FineTuningJobEventsPage=ut;class ft extends We{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e={},t){return Ce(e)?this.list({},e):this._client.getAPIList("/assistants",pt,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class pt extends Qe{}function gt(e){return"function"==typeof e.parse}ft.AssistantsPage=pt;const ht=e=>"assistant"===e?.role,mt=e=>"function"===e?.role,yt=e=>"tool"===e?.role;var vt,xt,bt,wt,St,Ct,Et,kt,It,At,_t,Tt,jt,Ft=function(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,n):o?o.value=n:t.set(e,n),n},Rt=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class Ot{constructor(){vt.add(this),this.controller=new AbortController,xt.set(this,void 0),bt.set(this,(()=>{})),wt.set(this,(()=>{})),St.set(this,void 0),Ct.set(this,(()=>{})),Et.set(this,(()=>{})),kt.set(this,{}),It.set(this,!1),At.set(this,!1),_t.set(this,!1),Tt.set(this,!1),Ft(this,xt,new Promise(((e,t)=>{Ft(this,bt,e,"f"),Ft(this,wt,t,"f")})),"f"),Ft(this,St,new Promise(((e,t)=>{Ft(this,Ct,e,"f"),Ft(this,Et,t,"f")})),"f"),Rt(this,xt,"f").catch((()=>{})),Rt(this,St,"f").catch((()=>{}))}_run(e){setTimeout((()=>{e().then((()=>{this._emitFinal(),this._emit("end")}),Rt(this,vt,"m",jt).bind(this))}),0)}_connected(){this.ended||(Rt(this,bt,"f").call(this),this._emit("connect"))}get ended(){return Rt(this,It,"f")}get errored(){return Rt(this,At,"f")}get aborted(){return Rt(this,_t,"f")}abort(){this.controller.abort()}on(e,t){return(Rt(this,kt,"f")[e]||(Rt(this,kt,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=Rt(this,kt,"f")[e];if(!n)return this;const r=n.findIndex((e=>e.listener===t));return r>=0&&n.splice(r,1),this}once(e,t){return(Rt(this,kt,"f")[e]||(Rt(this,kt,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise(((t,n)=>{Ft(this,Tt,!0,"f"),"error"!==e&&this.once("error",n),this.once(e,t)}))}async done(){Ft(this,Tt,!0,"f"),await Rt(this,St,"f")}_emit(e,...t){if(Rt(this,It,"f"))return;"end"===e&&(Ft(this,It,!0,"f"),Rt(this,Ct,"f").call(this));const n=Rt(this,kt,"f")[e];if(n&&(Rt(this,kt,"f")[e]=n.filter((e=>!e.once)),n.forEach((({listener:e})=>e(...t)))),"abort"===e){const e=t[0];return Rt(this,Tt,"f")||n?.length||Promise.reject(e),Rt(this,wt,"f").call(this,e),Rt(this,Et,"f").call(this,e),void this._emit("end")}if("error"===e){const e=t[0];Rt(this,Tt,"f")||n?.length||Promise.reject(e),Rt(this,wt,"f").call(this,e),Rt(this,Et,"f").call(this,e),this._emit("end")}}_emitFinal(){}}function Pt(e){return"auto-parseable-response-format"===e?.$brand}function Bt(e){return"auto-parseable-tool"===e?.$brand}function Nt(e,t){const n=e.choices.map((e=>{if("length"===e.finish_reason)throw new K;if("content_filter"===e.finish_reason)throw new Q;return{...e,message:{...e.message,tool_calls:e.message.tool_calls?.map((e=>function(e,t){const n=e.tools?.find((e=>e.function?.name===t.function.name));return{...t,function:{...t.function,parsed_arguments:Bt(n)?n.$parseRaw(t.function.arguments):n?.function.strict?JSON.parse(t.function.arguments):null}}}(t,e)))??[],parsed:e.message.content&&!e.message.refusal?Lt(t,e.message.content):null}}}));return{...e,choices:n}}function Lt(e,t){if("json_schema"!==e.response_format?.type)return null;if("json_schema"===e.response_format?.type){if("$parseRaw"in e.response_format){return e.response_format.$parseRaw(t)}return JSON.parse(t)}return null}function zt(e,t){if(!e)return!1;const n=e.tools?.find((e=>e.function?.name===t.function.name));return Bt(n)||n?.function.strict||!1}function Dt(e){return!!Pt(e.response_format)||(e.tools?.some((e=>Bt(e)||"function"===e.type&&!0===e.function.strict))??!1)}xt=new WeakMap,bt=new WeakMap,wt=new WeakMap,St=new WeakMap,Ct=new WeakMap,Et=new WeakMap,kt=new WeakMap,It=new WeakMap,At=new WeakMap,_t=new WeakMap,Tt=new WeakMap,vt=new WeakSet,jt=function(e){if(Ft(this,At,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new L),e instanceof L)return Ft(this,_t,!0,"f"),this._emit("abort",e);if(e instanceof B)return this._emit("error",e);if(e instanceof Error){const t=new B(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new B(String(e)))};var Mt,Ut,qt,Wt,Vt,$t,Gt,Ht,Kt=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};const Qt=10;class Yt extends Ot{constructor(){super(...arguments),Mt.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t)if(this._emit("message",e),(mt(e)||yt(e))&&e.content)this._emit("functionCallResult",e.content);else if(ht(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(ht(e)&&e.tool_calls)for(const t of e.tool_calls)"function"===t.type&&this._emit("functionCall",t.function)}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new B("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),Kt(this,Mt,"m",Ut).call(this)}async finalMessage(){return await this.done(),Kt(this,Mt,"m",qt).call(this)}async finalFunctionCall(){return await this.done(),Kt(this,Mt,"m",Wt).call(this)}async finalFunctionCallResult(){return await this.done(),Kt(this,Mt,"m",Vt).call(this)}async totalUsage(){return await this.done(),Kt(this,Mt,"m",$t).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=Kt(this,Mt,"m",qt).call(this);t&&this._emit("finalMessage",t);const n=Kt(this,Mt,"m",Ut).call(this);n&&this._emit("finalContent",n);const r=Kt(this,Mt,"m",Wt).call(this);r&&this._emit("finalFunctionCall",r);const o=Kt(this,Mt,"m",Vt).call(this);null!=o&&this._emit("finalFunctionCallResult",o),this._chatCompletions.some((e=>e.usage))&&this._emit("totalUsage",Kt(this,Mt,"m",$t).call(this))}async _createChatCompletion(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort()))),Kt(this,Mt,"m",Gt).call(this,t);const o=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Nt(o,t))}async _runChatCompletion(e,t,n){for(const e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){const r="function",{function_call:o="auto",stream:a,...i}=t,s="string"!=typeof o&&o?.name,{maxChatCompletions:l=Qt}=n||{},c={};for(const e of t.functions)c[e.name||e.function.name]=e;const u=t.functions.map((e=>({name:e.name||e.function.name,parameters:e.parameters,description:e.description})));for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){const t=await this._createChatCompletion(e,{...i,function_call:o,functions:u,messages:[...this.messages]},n),a=t.choices[0]?.message;if(!a)throw new B("missing message in ChatCompletion response");if(!a.function_call)return;const{name:l,arguments:d}=a.function_call,f=c[l];if(!f){const e=`Invalid function_call: ${JSON.stringify(l)}. Available options are: ${u.map((e=>JSON.stringify(e.name))).join(", ")}. Please try again`;this._addMessage({role:r,name:l,content:e});continue}if(s&&s!==l){const e=`Invalid function_call: ${JSON.stringify(l)}. ${JSON.stringify(s)} requested. Please try again`;this._addMessage({role:r,name:l,content:e});continue}let p;try{p=gt(f)?await f.parse(d):d}catch(e){this._addMessage({role:r,name:l,content:e instanceof Error?e.message:String(e)});continue}const g=await f.function(p,this),h=Kt(this,Mt,"m",Ht).call(this,g);if(this._addMessage({role:r,name:l,content:h}),s)return}}async _runTools(e,t,n){const r="tool",{tool_choice:o="auto",stream:a,...i}=t,s="string"!=typeof o&&o?.function?.name,{maxChatCompletions:l=Qt}=n||{},c=t.tools.map((e=>{if(Bt(e)){if(!e.$callback)throw new B("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e})),u={};for(const e of c)"function"===e.type&&(u[e.function.name||e.function.function.name]=e.function);const d="tools"in t?c.map((e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e)):void 0;for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){const t=await this._createChatCompletion(e,{...i,tool_choice:o,tools:d,messages:[...this.messages]},n),a=t.choices[0]?.message;if(!a)throw new B("missing message in ChatCompletion response");if(!a.tool_calls?.length)return;for(const e of a.tool_calls){if("function"!==e.type)continue;const t=e.id,{name:n,arguments:o}=e.function,a=u[n];if(!a){const e=`Invalid tool_call: ${JSON.stringify(n)}. Available options are: ${Object.keys(u).map((e=>JSON.stringify(e))).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:t,content:e});continue}if(s&&s!==n){const e=`Invalid tool_call: ${JSON.stringify(n)}. ${JSON.stringify(s)} requested. Please try again`;this._addMessage({role:r,tool_call_id:t,content:e});continue}let i;try{i=gt(a)?await a.parse(o):o}catch(e){const n=e instanceof Error?e.message:String(e);this._addMessage({role:r,tool_call_id:t,content:n});continue}const l=await a.function(i,this),c=Kt(this,Mt,"m",Ht).call(this,l);if(this._addMessage({role:r,tool_call_id:t,content:c}),s)return}}}}Mt=new WeakSet,Ut=function(){return Kt(this,Mt,"m",qt).call(this).content??null},qt=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(ht(t)){const{function_call:e,...n}=t,r={...n,content:t.content??null,refusal:t.refusal??null};return e&&(r.function_call=e),r}}throw new B("stream ended without producing a ChatCompletionMessage with role=assistant")},Wt=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(ht(t)&&t?.function_call)return t.function_call;if(ht(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},Vt=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(mt(t)&&null!=t.content)return t.content;if(yt(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some((e=>"assistant"===e.role&&e.tool_calls?.some((e=>"function"===e.type&&e.id===t.tool_call_id)))))return t.content}},$t=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Gt=function(e){if(null!=e.n&&e.n>1)throw new B("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Ht=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class Jt extends Yt{static runFunctions(e,t,n){const r=new Jt,o={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run((()=>r._runFunctions(e,t,o))),r}static runTools(e,t,n){const r=new Jt,o={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run((()=>r._runTools(e,t,o))),r}_addMessage(e,t=!0){super._addMessage(e,t),ht(e)&&e.content&&this._emit("content",e.content)}}const Xt=1,Zt=2,en=4,tn=8,nn=16,rn=32,on=64,an=128,sn=256,ln=511;class cn extends Error{}class un extends Error{}const dn=(e,t)=>{const n=e.length;let r=0;const o=e=>{throw new cn(`${e} at position ${r}`)},a=e=>{throw new un(`${e} at position ${r}`)},i=()=>(d(),r>=n&&o("Unexpected end of input"),'"'===e[r]?s():"{"===e[r]?l():"["===e[r]?c():"null"===e.substring(r,r+4)||nn&t&&n-r<4&&"null".startsWith(e.substring(r))?(r+=4,null):"true"===e.substring(r,r+4)||rn&t&&n-r<4&&"true".startsWith(e.substring(r))?(r+=4,!0):"false"===e.substring(r,r+5)||rn&t&&n-r<5&&"false".startsWith(e.substring(r))?(r+=5,!1):"Infinity"===e.substring(r,r+8)||an&t&&n-r<8&&"Infinity".startsWith(e.substring(r))?(r+=8,1/0):"-Infinity"===e.substring(r,r+9)||sn&t&&1<n-r&&n-r<9&&"-Infinity".startsWith(e.substring(r))?(r+=9,-1/0):"NaN"===e.substring(r,r+3)||on&t&&n-r<3&&"NaN".startsWith(e.substring(r))?(r+=3,NaN):u()),s=()=>{const i=r;let s=!1;for(r++;r<n&&('"'!==e[r]||s&&"\\"===e[r-1]);)s="\\"===e[r]&&!s,r++;if('"'==e.charAt(r))try{return JSON.parse(e.substring(i,++r-Number(s)))}catch(e){a(String(e))}else if(Xt&t)try{return JSON.parse(e.substring(i,r-Number(s))+'"')}catch(t){return JSON.parse(e.substring(i,e.lastIndexOf("\\"))+'"')}o("Unterminated string literal")},l=()=>{r++,d();const a={};try{for(;"}"!==e[r];){if(d(),r>=n&&tn&t)return a;const o=s();d(),r++;try{const e=i();Object.defineProperty(a,o,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(e){if(tn&t)return a;throw e}d(),","===e[r]&&r++}}catch(e){if(tn&t)return a;o("Expected '}' at end of object")}return r++,a},c=()=>{r++;const n=[];try{for(;"]"!==e[r];)n.push(i()),d(),","===e[r]&&r++}catch(e){if(en&t)return n;o("Expected ']' at end of array")}return r++,n},u=()=>{if(0===r){"-"===e&&Zt&t&&o("Not sure what '-' is");try{return JSON.parse(e)}catch(n){if(Zt&t)try{return"."===e[e.length-1]?JSON.parse(e.substring(0,e.lastIndexOf("."))):JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(e){}a(String(n))}}const i=r;for("-"===e[r]&&r++;e[r]&&!",]}".includes(e[r]);)r++;r!=n||Zt&t||o("Unterminated number literal");try{return JSON.parse(e.substring(i,r))}catch(n){"-"===e.substring(i,r)&&Zt&t&&o("Not sure what '-' is");try{return JSON.parse(e.substring(i,e.lastIndexOf("e")))}catch(e){a(String(e))}}},d=()=>{for(;r<n&&" \n\r\t".includes(e[r]);)r++};return i()},fn=e=>function(e,t=ln){if("string"!=typeof e)throw new TypeError("expecting str, got "+typeof e);if(!e.trim())throw new Error(`${e} is empty`);return dn(e.trim(),t)}(e,ln^Zt);var pn,gn,hn,mn,yn,vn,xn,bn,wn,Sn,Cn,En,kn=function(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,n):o?o.value=n:t.set(e,n),n},In=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class An extends Yt{constructor(e){super(),pn.add(this),gn.set(this,void 0),hn.set(this,void 0),mn.set(this,void 0),kn(this,gn,e,"f"),kn(this,hn,[],"f")}get currentChatCompletionSnapshot(){return In(this,mn,"f")}static fromReadableStream(e){const t=new An(null);return t._run((()=>t._fromReadableStream(e))),t}static createChatCompletion(e,t,n){const r=new An(t);return r._run((()=>r._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}}))),r}async _createChatCompletion(e,t,n){super._createChatCompletion;const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort()))),In(this,pn,"m",yn).call(this);const o=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const e of o)In(this,pn,"m",xn).call(this,e);if(o.controller.signal?.aborted)throw new L;return this._addChatCompletion(In(this,pn,"m",Sn).call(this))}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),In(this,pn,"m",yn).call(this),this._connected();const r=J.fromReadableStream(e,this.controller);let o;for await(const e of r)o&&o!==e.id&&this._addChatCompletion(In(this,pn,"m",Sn).call(this)),In(this,pn,"m",xn).call(this,e),o=e.id;if(r.controller.signal?.aborted)throw new L;return this._addChatCompletion(In(this,pn,"m",Sn).call(this))}[(gn=new WeakMap,hn=new WeakMap,mn=new WeakMap,pn=new WeakSet,yn=function(){this.ended||kn(this,mn,void 0,"f")},vn=function(e){let t=In(this,hn,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},In(this,hn,"f")[e.index]=t,t)},xn=function(e){if(this.ended)return;const t=In(this,pn,"m",En).call(this,e);this._emit("chunk",e,t);for(const n of e.choices){const e=t.choices[n.index];null!=n.delta.content&&"assistant"===e.message?.role&&e.message?.content&&(this._emit("content",n.delta.content,e.message.content),this._emit("content.delta",{delta:n.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=n.delta.refusal&&"assistant"===e.message?.role&&e.message?.refusal&&this._emit("refusal.delta",{delta:n.delta.refusal,snapshot:e.message.refusal}),null!=n.logprobs?.content&&"assistant"===e.message?.role&&this._emit("logprobs.content.delta",{content:n.logprobs?.content,snapshot:e.logprobs?.content??[]}),null!=n.logprobs?.refusal&&"assistant"===e.message?.role&&this._emit("logprobs.refusal.delta",{refusal:n.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});const r=In(this,pn,"m",vn).call(this,e);e.finish_reason&&(In(this,pn,"m",wn).call(this,e),null!=r.current_tool_call_index&&In(this,pn,"m",bn).call(this,e,r.current_tool_call_index));for(const t of n.delta.tool_calls??[])r.current_tool_call_index!==t.index&&(In(this,pn,"m",wn).call(this,e),null!=r.current_tool_call_index&&In(this,pn,"m",bn).call(this,e,r.current_tool_call_index)),r.current_tool_call_index=t.index;for(const t of n.delta.tool_calls??[]){const n=e.message.tool_calls?.[t.index];n?.type&&("function"===n?.type&&this._emit("tool_calls.function.arguments.delta",{name:n.function?.name,index:t.index,arguments:n.function.arguments,parsed_arguments:n.function.parsed_arguments,arguments_delta:t.function?.arguments??""}))}}},bn=function(e,t){if(In(this,pn,"m",vn).call(this,e).done_tool_calls.has(t))return;const n=e.message.tool_calls?.[t];if(!n)throw new Error("no tool call snapshot");if(!n.type)throw new Error("tool call snapshot missing `type`");if("function"===n.type){const e=In(this,gn,"f")?.tools?.find((e=>"function"===e.type&&e.function.name===n.function.name));this._emit("tool_calls.function.arguments.done",{name:n.function.name,index:t,arguments:n.function.arguments,parsed_arguments:Bt(e)?e.$parseRaw(n.function.arguments):e?.function.strict?JSON.parse(n.function.arguments):null})}else n.type},wn=function(e){const t=In(this,pn,"m",vn).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;const n=In(this,pn,"m",Cn).call(this);this._emit("content.done",{content:e.message.content,parsed:n?n.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},Sn=function(){if(this.ended)throw new B("stream has ended, this shouldn't happen");const e=In(this,mn,"f");if(!e)throw new B("request ended without sending any chunks");return kn(this,mn,void 0,"f"),kn(this,hn,[],"f"),function(e,t){const{id:n,choices:r,created:o,model:a,system_fingerprint:i,...s}=e,l={...s,id:n,choices:r.map((({message:t,finish_reason:n,index:r,logprobs:o,...a})=>{if(!n)throw new B(`missing finish_reason for choice ${r}`);const{content:i=null,function_call:s,tool_calls:l,...c}=t,u=t.role;if(!u)throw new B(`missing role for choice ${r}`);if(s){const{arguments:e,name:l}=s;if(null==e)throw new B(`missing function_call.arguments for choice ${r}`);if(!l)throw new B(`missing function_call.name for choice ${r}`);return{...a,message:{content:i,function_call:{arguments:e,name:l},role:u,refusal:t.refusal??null},finish_reason:n,index:r,logprobs:o}}return l?{...a,index:r,finish_reason:n,logprobs:o,message:{...c,role:u,content:i,refusal:t.refusal??null,tool_calls:l.map(((t,n)=>{const{function:o,type:a,id:i,...s}=t,{arguments:l,name:c,...u}=o||{};if(null==i)throw new B(`missing choices[${r}].tool_calls[${n}].id\n${_n(e)}`);if(null==a)throw new B(`missing choices[${r}].tool_calls[${n}].type\n${_n(e)}`);if(null==c)throw new B(`missing choices[${r}].tool_calls[${n}].function.name\n${_n(e)}`);if(null==l)throw new B(`missing choices[${r}].tool_calls[${n}].function.arguments\n${_n(e)}`);return{...s,id:i,type:a,function:{...u,name:c,arguments:l}}}))}}:{...a,message:{...c,content:i,role:u,refusal:t.refusal??null},finish_reason:n,index:r,logprobs:o}})),created:o,model:a,object:"chat.completion",...i?{system_fingerprint:i}:{}};return function(e,t){return t&&Dt(t)?Nt(e,t):{...e,choices:e.choices.map((e=>({...e,message:{...e.message,parsed:null,tool_calls:e.message.tool_calls??[]}})))}}(l,t)}(e,In(this,gn,"f"))},Cn=function(){const e=In(this,gn,"f")?.response_format;return Pt(e)?e:null},En=function(e){var t,n,r,o;let a=In(this,mn,"f");const{choices:i,...s}=e;a?Object.assign(a,s):a=kn(this,mn,{...s,choices:[]},"f");for(const{delta:i,finish_reason:s,index:l,logprobs:c=null,...u}of e.choices){let e=a.choices[l];if(e||(e=a.choices[l]={finish_reason:s,index:l,message:{},logprobs:c,...u}),c)if(e.logprobs){const{content:r,refusal:o,...a}=c;Object.assign(e.logprobs,a),r&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...r)),o&&((n=e.logprobs).refusal??(n.refusal=[]),e.logprobs.refusal.push(...o))}else e.logprobs=Object.assign({},c);if(s&&(e.finish_reason=s,In(this,gn,"f")&&Dt(In(this,gn,"f")))){if("length"===s)throw new K;if("content_filter"===s)throw new Q}if(Object.assign(e,u),!i)continue;const{content:d,refusal:f,function_call:p,role:g,tool_calls:h,...m}=i;if(Object.assign(e.message,m),f&&(e.message.refusal=(e.message.refusal||"")+f),g&&(e.message.role=g),p&&(e.message.function_call?(p.name&&(e.message.function_call.name=p.name),p.arguments&&((r=e.message.function_call).arguments??(r.arguments=""),e.message.function_call.arguments+=p.arguments)):e.message.function_call=p),d&&(e.message.content=(e.message.content||"")+d,!e.message.refusal&&In(this,pn,"m",Cn).call(this)&&(e.message.parsed=fn(e.message.content))),h){e.message.tool_calls||(e.message.tool_calls=[]);for(const{index:t,id:n,type:r,function:a,...i}of h){const s=(o=e.message.tool_calls)[t]??(o[t]={});Object.assign(s,i),n&&(s.id=n),r&&(s.type=r),a&&(s.function??(s.function={name:a.name??"",arguments:""})),a?.name&&(s.function.name=a.name),a?.arguments&&(s.function.arguments+=a.arguments,zt(In(this,gn,"f"),s)&&(s.function.parsed_arguments=fn(s.function.arguments)))}}}return a},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",(n=>{const r=t.shift();r?r.resolve(n):e.push(n)})),this.on("end",(()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),this.on("error",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),{next:async()=>{if(!e.length)return n?{value:void 0,done:!0}:new Promise(((e,n)=>t.push({resolve:e,reject:n}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0}));return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new J(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function _n(e){return JSON.stringify(e)}class Tn extends An{static fromReadableStream(e){const t=new Tn(null);return t._run((()=>t._fromReadableStream(e))),t}static runFunctions(e,t,n){const r=new Tn(null),o={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run((()=>r._runFunctions(e,t,o))),r}static runTools(e,t,n){const r=new Tn(t),o={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run((()=>r._runTools(e,t,o))),r}}class jn extends We{parse(e,t){return function(e){for(const t of e??[]){if("function"!==t.type)throw new B(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new B(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap((t=>Nt(t,e)))}runFunctions(e,t){return e.stream?Tn.runFunctions(this._client,e,t):Jt.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?Tn.runTools(this._client,e,t):Jt.runTools(this._client,e,t)}stream(e,t){return An.createChatCompletion(this._client,e,t)}}class Fn extends We{constructor(){super(...arguments),this.completions=new jn(this._client)}}!function(e){e.Completions=jn}(Fn||(Fn={}));var Rn,On,Pn,Bn,Nn,Ln,zn,Dn,Mn,Un,qn,Wn,Vn,$n,Gn,Hn,Kn,Qn,Yn,Jn,Xn,Zn,er=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},tr=function(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,n):o?o.value=n:t.set(e,n),n};class nr extends Ot{constructor(){super(...arguments),Rn.add(this),On.set(this,[]),Pn.set(this,{}),Bn.set(this,{}),Nn.set(this,void 0),Ln.set(this,void 0),zn.set(this,void 0),Dn.set(this,void 0),Mn.set(this,void 0),Un.set(this,void 0),qn.set(this,void 0),Wn.set(this,void 0),Vn.set(this,void 0)}[(On=new WeakMap,Pn=new WeakMap,Bn=new WeakMap,Nn=new WeakMap,Ln=new WeakMap,zn=new WeakMap,Dn=new WeakMap,Mn=new WeakMap,Un=new WeakMap,qn=new WeakMap,Wn=new WeakMap,Vn=new WeakMap,Rn=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",(n=>{const r=t.shift();r?r.resolve(n):e.push(n)})),this.on("end",(()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),this.on("error",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),{next:async()=>{if(!e.length)return n?{value:void 0,done:!0}:new Promise(((e,n)=>t.push({resolve:e,reject:n}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0}));return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new nr;return t._run((()=>t._fromReadableStream(e))),t}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),this._connected();const r=J.fromReadableStream(e,this.controller);for await(const e of r)er(this,Rn,"m",$n).call(this,e);if(r.controller.signal?.aborted)throw new L;return this._addRun(er(this,Rn,"m",Gn).call(this))}toReadableStream(){return new J(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,r,o){const a=new nr;return a._run((()=>a._runToolAssistantStream(e,t,n,r,{...o,headers:{...o?.headers,"X-Stainless-Helper-Method":"stream"}}))),a}async _createToolAssistantStream(e,t,n,r,o){const a=o?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",(()=>this.controller.abort())));const i={...r,stream:!0},s=await e.submitToolOutputs(t,n,i,{...o,signal:this.controller.signal});this._connected();for await(const e of s)er(this,Rn,"m",$n).call(this,e);if(s.controller.signal?.aborted)throw new L;return this._addRun(er(this,Rn,"m",Gn).call(this))}static createThreadAssistantStream(e,t,n){const r=new nr;return r._run((()=>r._threadAssistantStream(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}}))),r}static createAssistantStream(e,t,n,r){const o=new nr;return o._run((()=>o._runAssistantStream(e,t,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}}))),o}currentEvent(){return er(this,qn,"f")}currentRun(){return er(this,Wn,"f")}currentMessageSnapshot(){return er(this,Nn,"f")}currentRunStepSnapshot(){return er(this,Vn,"f")}async finalRunSteps(){return await this.done(),Object.values(er(this,Pn,"f"))}async finalMessages(){return await this.done(),Object.values(er(this,Bn,"f"))}async finalRun(){if(await this.done(),!er(this,Ln,"f"))throw Error("Final run was not received.");return er(this,Ln,"f")}async _createThreadAssistantStream(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort())));const o={...t,stream:!0},a=await e.createAndRun(o,{...n,signal:this.controller.signal});this._connected();for await(const e of a)er(this,Rn,"m",$n).call(this,e);if(a.controller.signal?.aborted)throw new L;return this._addRun(er(this,Rn,"m",Gn).call(this))}async _createAssistantStream(e,t,n,r){const o=r?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",(()=>this.controller.abort())));const a={...n,stream:!0},i=await e.create(t,a,{...r,signal:this.controller.signal});this._connected();for await(const e of i)er(this,Rn,"m",$n).call(this,e);if(i.controller.signal?.aborted)throw new L;return this._addRun(er(this,Rn,"m",Gn).call(this))}static accumulateDelta(e,t){for(const[n,r]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=r;continue}let t=e[n];if(null!=t)if("index"!==n&&"type"!==n){if("string"==typeof t&&"string"==typeof r)t+=r;else if("number"==typeof t&&"number"==typeof r)t+=r;else{if(!qe(t)||!qe(r)){if(Array.isArray(t)&&Array.isArray(r)){if(t.every((e=>"string"==typeof e||"number"==typeof e))){t.push(...r);continue}for(const e of r){if(!qe(e))throw new Error(`Expected array delta entry to be an object but got: ${e}`);const n=e.index;if(null==n)throw console.error(e),new Error("Expected array delta entry to have an `index` property");if("number"!=typeof n)throw new Error(`Expected array delta entry \`index\` property to be a number but got ${n}`);const r=t[n];null==r?t.push(e):t[n]=this.accumulateDelta(r,e)}continue}throw Error(`Unhandled record type: ${n}, deltaValue: ${r}, accValue: ${t}`)}t=this.accumulateDelta(t,r)}e[n]=t}else e[n]=r;else e[n]=r}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,r){return await this._createAssistantStream(t,e,n,r)}async _runToolAssistantStream(e,t,n,r,o){return await this._createToolAssistantStream(n,e,t,r,o)}}$n=function(e){if(!this.ended)switch(tr(this,qn,e,"f"),er(this,Rn,"m",Qn).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":er(this,Rn,"m",Zn).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":er(this,Rn,"m",Kn).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":er(this,Rn,"m",Hn).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Gn=function(){if(this.ended)throw new B("stream has ended, this shouldn't happen");if(!er(this,Ln,"f"))throw Error("Final run has not been received");return er(this,Ln,"f")},Hn=function(e){const[t,n]=er(this,Rn,"m",Jn).call(this,e,er(this,Nn,"f"));tr(this,Nn,t,"f"),er(this,Bn,"f")[t.id]=t;for(const e of n){const n=t.content[e.index];"text"==n?.type&&this._emit("textCreated",n.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const n of e.data.delta.content){if("text"==n.type&&n.text){let e=n.text,r=t.content[n.index];if(!r||"text"!=r.type)throw Error("The snapshot associated with this text delta is not text or missing");this._emit("textDelta",e,r.text)}if(n.index!=er(this,zn,"f")){if(er(this,Dn,"f"))switch(er(this,Dn,"f").type){case"text":this._emit("textDone",er(this,Dn,"f").text,er(this,Nn,"f"));break;case"image_file":this._emit("imageFileDone",er(this,Dn,"f").image_file,er(this,Nn,"f"))}tr(this,zn,n.index,"f")}tr(this,Dn,t.content[n.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==er(this,zn,"f")){const t=e.data.content[er(this,zn,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,er(this,Nn,"f"));break;case"text":this._emit("textDone",t.text,er(this,Nn,"f"))}}er(this,Nn,"f")&&this._emit("messageDone",e.data),tr(this,Nn,void 0,"f")}},Kn=function(e){const t=er(this,Rn,"m",Yn).call(this,e);switch(tr(this,Vn,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&"tool_calls"==n.step_details.type&&n.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(const e of n.step_details.tool_calls)e.index==er(this,Mn,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(er(this,Un,"f")&&this._emit("toolCallDone",er(this,Un,"f")),tr(this,Mn,e.index,"f"),tr(this,Un,t.step_details.tool_calls[e.index],"f"),er(this,Un,"f")&&this._emit("toolCallCreated",er(this,Un,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":tr(this,Vn,void 0,"f");"tool_calls"==e.data.step_details.type&&er(this,Un,"f")&&(this._emit("toolCallDone",er(this,Un,"f")),tr(this,Un,void 0,"f")),this._emit("runStepDone",e.data,t)}},Qn=function(e){er(this,On,"f").push(e),this._emit("event",e)},Yn=function(e){switch(e.event){case"thread.run.step.created":return er(this,Pn,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=er(this,Pn,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const r=nr.accumulateDelta(t,n.delta);er(this,Pn,"f")[e.data.id]=r}return er(this,Pn,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":er(this,Pn,"f")[e.data.id]=e.data}if(er(this,Pn,"f")[e.data.id])return er(this,Pn,"f")[e.data.id];throw new Error("No snapshot available")},Jn=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let r=e.data;if(r.delta.content)for(const e of r.delta.content)if(e.index in t.content){let n=t.content[e.index];t.content[e.index]=er(this,Rn,"m",Xn).call(this,e,n)}else t.content[e.index]=e,n.push(e);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Xn=function(e,t){return nr.accumulateDelta(t,e)},Zn=function(e){switch(tr(this,Wn,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.cancelling":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":tr(this,Ln,e.data,"f"),er(this,Un,"f")&&(this._emit("toolCallDone",er(this,Un,"f")),tr(this,Un,void 0,"f"))}};class rr extends We{create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e,t={},n){return Ce(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,or,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t,n){return this._client.delete(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}}class or extends Qe{}rr.MessagesPage=or;class ar extends We{retrieve(e,t,n,r={},o){return Ce(r)?this.retrieve(e,t,n,{},r):this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{query:r,...o,headers:{"OpenAI-Beta":"assistants=v2",...o?.headers}})}list(e,t,n={},r){return Ce(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,ir,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}}class ir extends Qe{}ar.RunStepsPage=ir;class sr extends We{constructor(){super(...arguments),this.steps=new ar(this._client)}create(e,t,n){const{include:r,...o}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:r},body:o,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers},stream:t.stream??!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e,t={},n){return Ce(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,lr,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}createAndStream(e,t,n){return nr.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const r={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:o,response:a}=await this.retrieve(e,t,{...n,headers:{...n?.headers,...r}}).withResponse();switch(o.status){case"queued":case"in_progress":case"cancelling":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=a.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await Re(e);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return o}}}stream(e,t,n){return nr.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,r){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(e,t,n,r){const o=await this.submitToolOutputs(e,t,n,r);return await this.poll(e,o.id,r)}submitToolOutputsStream(e,t,n,r){return nr.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,r)}}class lr extends Qe{}sr.RunsPage=lr,sr.Steps=ar,sr.RunStepsPage=ir;class cr extends We{constructor(){super(...arguments),this.runs=new sr(this._client),this.messages=new rr(this._client)}create(e={},t){return Ce(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.thread_id,n.id,t)}createAndRunStream(e,t){return nr.createThreadAssistantStream(e,this._client.beta.threads,t)}}cr.Runs=sr,cr.RunsPage=lr,cr.Messages=rr,cr.MessagesPage=or;class ur extends We{create(e,t,n){return this._client.post(`/vector_stores/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e,t={},n){return Ce(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,dr,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t,n){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}async poll(e,t,n){const r={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const o=await this.retrieve(e,t,{...n,headers:r}).withResponse(),a=o.data;switch(a.status){case"in_progress":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=o.response.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await Re(e);break;case"failed":case"completed":return a}}}async upload(e,t,n){const r=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:r.id},n)}async uploadAndPoll(e,t,n){const r=await this.upload(e,t,n);return await this.poll(e,r.id,n)}}class dr extends Qe{}ur.VectorStoreFilesPage=dr;class fr extends We{create(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}cancel(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t);return await this.poll(e,r.id,n)}listFiles(e,t,n={},r){return Ce(n)?this.listFiles(e,t,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,dr,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async poll(e,t,n){const r={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:o,response:a}=await this.retrieve(e,t,{...n,headers:r}).withResponse();switch(o.status){case"in_progress":let e=5e3;if(n?.pollIntervalMs)e=n.pollIntervalMs;else{const t=a.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await Re(e);break;case"failed":case"cancelled":case"completed":return o}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},r){if(null==t||0==t.length)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const o=r?.maxConcurrency??5,a=Math.min(o,t.length),i=this._client,s=t.values(),l=[...n];const c=Array(a).fill(s).map((async function(e){for(let t of e){const e=await i.files.create({file:t,purpose:"assistants"},r);l.push(e.id)}}));return await(async e=>{const t=await Promise.allSettled(e),n=t.filter((e=>"rejected"===e.status));if(n.length){for(const e of n)console.error(e.reason);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const r=[];for(const e of t)"fulfilled"===e.status&&r.push(e.value);return r})(c),await this.createAndPoll(e,{file_ids:l})}}class pr extends We{constructor(){super(...arguments),this.files=new ur(this._client),this.fileBatches=new fr(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/vector_stores/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e={},t){return Ce(e)?this.list({},e):this._client.getAPIList("/vector_stores",gr,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class gr extends Qe{}pr.VectorStoresPage=gr,pr.Files=ur,pr.VectorStoreFilesPage=dr,pr.FileBatches=fr;class hr extends We{constructor(){super(...arguments),this.vectorStores=new pr(this._client),this.chat=new Fn(this._client),this.assistants=new ft(this._client),this.threads=new cr(this._client)}}hr.VectorStores=pr,hr.VectorStoresPage=gr,hr.Assistants=ft,hr.AssistantsPage=pt,hr.Threads=cr;class mr extends We{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return Ce(e)?this.list({},e):this._client.getAPIList("/batches",yr,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class yr extends Qe{}mr.BatchesPage=yr;class vr extends We{create(e,t,n){return this._client.post(`/uploads/${e}/parts`,ce({body:t,...n}))}}class xr extends We{constructor(){super(...arguments),this.parts=new vr(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(`/uploads/${e}/complete`,{body:t,...n})}}var br;xr.Parts=vr;class wr extends ve{constructor({baseURL:e=Be("OPENAI_BASE_URL"),apiKey:t=Be("OPENAI_API_KEY"),organization:n=Be("OPENAI_ORG_ID")??null,project:r=Be("OPENAI_PROJECT_ID")??null,...o}={}){if(void 0===t)throw new B("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const a={apiKey:t,organization:n,project:r,...o,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator)throw new B("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new Ve(this),this.chat=new Ge(this),this.embeddings=new He(this),this.files=new Ye(this),this.images=new Xe(this),this.audio=new nt(this),this.moderations=new rt(this),this.models=new ot(this),this.fineTuning=new dt(this),this.beta=new hr(this),this.batches=new mr(this),this.uploads=new xr(this),this._options=a,this.apiKey=t,this.organization=n,this.project=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return v(e,{arrayFormat:"brackets"})}}br=wr,wr.OpenAI=br,wr.DEFAULT_TIMEOUT=6e5,wr.OpenAIError=B,wr.APIError=N,wr.APIConnectionError=z,wr.APIConnectionTimeoutError=D,wr.APIUserAbortError=L,wr.NotFoundError=W,wr.ConflictError=V,wr.RateLimitError=G,wr.BadRequestError=M,wr.AuthenticationError=U,wr.InternalServerError=H,wr.PermissionDeniedError=q,wr.UnprocessableEntityError=$,wr.toFile=ae,wr.fileFromPath=A;wr.Completions=Ve,wr.Chat=Ge,wr.Embeddings=He,wr.Files=Ye,wr.FileObjectsPage=Je,wr.Images=Xe,wr.Audio=nt,wr.Moderations=rt,wr.Models=ot,wr.ModelsPage=at,wr.FineTuning=dt,wr.Beta=hr,wr.Batches=mr,wr.BatchesPage=yr,wr.Uploads=xr;new Set(["/completions","/chat/completions","/embeddings","/audio/transcriptions","/audio/translations","/audio/speech","/images/generations"])}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/";var r=n(540),o=n(338),a=n(848),i=n(888),s=n(242),l=n(961);let c=function(e){e()};const u=()=>c,d=(0,r.createContext)(null);function f(){return(0,r.useContext)(d)}let p=()=>{throw new Error("uSES not initialized!")};const g=(e,t)=>e===t;function h(e=d){const t=e===d?f:()=>(0,r.useContext)(e);return function(e,n=g){const{store:o,subscription:a,getServerState:i}=t(),s=p(a.addNestedSub,o.getState,i||o.getState,e,n);return(0,r.useDebugValue)(s),s}}const m=h();n(146),n(737);const y={notify(){},get:()=>[]};function v(e,t){let n,r=y;function o(){i.onStateChange&&i.onStateChange()}function a(){n||(n=t?t.addNestedSub(o):e.subscribe(o),r=function(){const e=u();let t=null,n=null;return{clear(){t=null,n=null},notify(){e((()=>{let e=t;for(;e;)e.callback(),e=e.next}))},get(){let e=[],n=t;for(;n;)e.push(n),n=n.next;return e},subscribe(e){let r=!0,o=n={callback:e,next:null,prev:n};return o.prev?o.prev.next=o:t=o,function(){r&&null!==t&&(r=!1,o.next?o.next.prev=o.prev:n=o.prev,o.prev?o.prev.next=o.next:t=o.next)}}}}())}const i={addNestedSub:function(e){return a(),r.subscribe(e)},notifyNestedSubs:function(){r.notify()},handleChangeWrapper:o,isSubscribed:function(){return Boolean(n)},trySubscribe:a,tryUnsubscribe:function(){n&&(n(),n=void 0,r.clear(),r=y)},getListeners:()=>r};return i}const x=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement)?r.useLayoutEffect:r.useEffect;let b=null;const w=function({store:e,context:t,children:n,serverState:o}){const a=(0,r.useMemo)((()=>{const t=v(e);return{store:e,subscription:t,getServerState:o?()=>o:void 0}}),[e,o]),i=(0,r.useMemo)((()=>e.getState()),[e]);x((()=>{const{subscription:t}=a;return t.onStateChange=t.notifyNestedSubs,t.trySubscribe(),i!==e.getState()&&t.notifyNestedSubs(),()=>{t.tryUnsubscribe(),t.onStateChange=void 0}}),[a,i]);const s=t||d;return r.createElement(s.Provider,{value:a},n)};function S(e=d){const t=e===d?f:()=>(0,r.useContext)(e);return function(){const{store:e}=t();return e}}const C=S();function E(e=d){const t=e===d?C:S(e);return function(){return t().dispatch}}const k=E();var I,A;I=s.useSyncExternalStoreWithSelector,p=I,(e=>{b=e})(i.useSyncExternalStore),A=l.unstable_batchedUpdates,c=A;var _="SET_CURRENT_TAB_ID",T="SET_TAB_CARD_FIELD",j="CLEAR_TAB_CARD_DATA",F="SAVE_TAB_CARD",R="DELETE_TAB_CARD",O="SET_TAB_STORED_CARDS",P="UPDATE_TAB_CARD_EXPORT_STATUS",B="UPDATE_TAB_STORED_CARD",N="SET_TAB_CURRENT_PAGE",L=function(e,t,n){return{type:T,payload:{tabId:e,field:t,value:n}}},z=function(e,t){return L(e,"text",t)},D=function(e,t){return L(e,"translation",t)},M=function(e,t){return L(e,"examples",t)},U=function(e,t){return L(e,"image",t)},q=function(e,t){return L(e,"imageUrl",t)},W=function(e,t){return L(e,"front",t)},V=function(e,t){return L(e,"back",t)},$=function(e,t){return L(e,"linguisticInfo",t)},G=function(e,t){return L(e,"transcription",t)},H=function(e,t){return L(e,"isGeneratingCard",t)},K=function(e,t){return L(e,"currentCardId",t)},Q=n(797),Y=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},J=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}};function X(e){var t=e.examples.map((function(t){return function(e,t,n,r){void 0===n&&(n=null),void 0===r&&(r="0.8em");var o=e.replace(t,"<b>".concat(t,"</b>"));if(n){var a=n.split(" ").slice(1).join(" ");return"".concat(o,"<br><span style='font-size: ").concat(r,";'><i>").concat(a,"</i></span>")}return o}(t[0],e.text,t[1])})).join("<br><br>"),n="";if(e.image_base64){var r=e.image_base64;if(r.startsWith("data:")){var o="base64,",a=r.indexOf(o);if(-1!==a){var i=r.substring(a+7);n='<div><img src="data:image/jpeg;base64,'.concat(i,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else n='<div><img src="'.concat(r,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else n='<div><img src="data:image/jpeg;base64,'.concat(r,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}var s="";if(e.linguisticInfo&&e.linguisticInfo.trim()){var l=e.linguisticInfo.trim().split("\n").filter((function(e){return e.trim()})),c="";l.forEach((function(e){var t=e.trim();if(t.match(/^[А-ЯЁA-Z][^:]*:$/))c+='<div style="color: #2563EB; font-weight: bold; margin-top: 12px; margin-bottom: 4px;">'.concat(t,"</div>");else if(t.startsWith("•")||t.startsWith("-")||t.startsWith("*")){var n=t.replace(/^[•\-*]\s*/,"");c+='<div style="margin-left: 16px; margin-bottom: 2px; color: #374151;">• '.concat(n,"</div>")}else if(t.includes(":")&&!t.endsWith(":")){var r=t.split(":"),o=r[0],a=r.slice(1).join(":").trim();c+='<div style="margin-bottom: 4px;"><span style="color: #6B7280; font-weight: 500;">'.concat(o.trim(),':</span> <span style="color: #111827;">').concat(a,"</span></div>")}else t&&(c+='<div style="margin-bottom: 6px; color: #374151; line-height: 1.4;">'.concat(t,"</div>"))})),c&&(s='\n                <div style="margin-top: 20px; padding: 12px; background-color: #F8FAFC; border-left: 4px solid #2563EB; border-radius: 0 6px 6px 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">\n                    <div style="color: #1E40AF; font-weight: bold; font-size: 14px; margin-bottom: 8px; display: flex; align-items: center;">\n                        <span style="margin-right: 6px;">📚</span>\n                        Grammar & Linguistics\n                    </div>\n                    '.concat(c,"\n                </div>\n            "))}return"\n        <b>".concat(e.translation,"</b>\n        <br><br>").concat(t,"<br><br>\n        ").concat(n,"\n        ").concat(s,"\n    ")}function Z(e,t){var n=e.replace("Key points:","").trim().split("-").map((function(e){return"<li>".concat(e.trim(),"</li>")})).join(""),r="";if(t){var o=t;if(o.startsWith("data:")){var a="base64,",i=o.indexOf(a);if(-1!==i){var s=o.substring(i+7);r='<div><img src="data:image/jpeg;base64,'.concat(s,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else r='<div><img src="'.concat(o,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else r='<div><img src="data:image/jpeg;base64,'.concat(o,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}return"\n        <b>Key points:</b>\n        <ul>\n            ".concat(n,"\n        </ul>\n        ").concat(r,"\n    ")}var ee=function(e,t,n,r,o,a){return Y(void 0,void 0,void 0,(function(){var i,s,l,c,u;return J(this,(function(d){switch(d.label){case 0:return d.trys.push([0,4,,5]),i=JSON.stringify({action:"createDeck",version:6,key:n,params:{deck:r}}),[4,fetch(t,{method:"POST",body:i,headers:{"Content-Type":"application/json"}})];case 1:if(!d.sent().ok)throw new Error("Failed to create deck.");return s=a.map((function(t){var n;if(e===Q.d.LanguageLearning&&"translation"in t&&"examples"in t&&"image_base64"in t)n={Front:t.text,Back:X(t)};else if(e===Q.d.GeneralTopic&&"back"in t){var a=t;n={Front:a.front,Back:Z(a.back,a.image_base64)}}return{deckName:r,modelName:o,fields:n,options:{allowDuplicate:!1},tags:[]}})),l=JSON.stringify({action:"addNotes",version:6,key:n,params:{notes:s}}),[4,fetch(t,{method:"POST",body:l,headers:{"Content-Type":"application/json"}})];case 2:if(!(c=d.sent()).ok)throw new Error("Failed to add notes.");return[4,c.json()];case 3:if((u=d.sent()).error)throw new Error("Anki error: ".concat(u.error));return[2,u.result];case 4:throw d.sent();case 5:return[2]}}))}))};function te(e){return Y(this,void 0,void 0,(function(){return J(this,(function(t){return[2,new Promise((function(t,n){chrome.runtime.sendMessage(e,(function(e){e.status&&void 0!==e.data?t(e.data):(console.error("Error fetching image:",e.error),n(null))}))}))]}))}))}var ne=function(e){return Y(void 0,void 0,void 0,(function(){var t,n,r;return J(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,fetch("http://localhost:8765",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"deckNames",version:6,key:e})})];case 1:if(!(t=o.sent()).ok)throw new Error("HTTP error! Status: ".concat(t.status));return[4,t.json()];case 2:return(n=o.sent()).result?[2,{result:n.result.map((function(e){return{deckId:e,name:e}})),error:n.error}]:[2,n];case 3:throw r=o.sent(),console.error("Error fetching decks:",r),r;case 4:return[2]}}))}))},re=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},oe=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},ae="SAVE_ANKI_CARDS",ie="SET_TEXT",se="SET_TRANSLATION",le="SET_EXAMPLES",ce="SET_IMAGE",ue="SET_IMAGE_URL",de="SET_BACK",fe="SET_FRONT",pe="SAVE_CARD_TO_STORAGE",ge="LOAD_STORED_CARDS",he="DELETE_STORED_CARD",me="SET_STORED_CARDS",ye="UPDATE_CARD_EXPORT_STATUS",ve="UPDATE_STORED_CARD",xe="SET_CURRENT_CARD_ID",be="SET_LINGUISTIC_INFO",we="SET_TRANSCRIPTION",Se="SET_IS_GENERATING_CARD",Ce=function(e,t,n,r,o,a){return void 0===n&&(n=null),function(i){return re(void 0,void 0,void 0,(function(){var s,l;return oe(this,(function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,ee(e,t,n,r,o,a)];case 1:return s=c.sent(),i({type:ae,payload:s}),[3,3];case 2:throw l=c.sent(),console.error("Error saving Anki cards:",l),l;case 3:return[2]}}))}))}},Ee=function(e){var t,n,r,o;return console.log("*** ACTION: saveCardToStorage called with card data ***"),console.log("Action payload image info:",{hasImage:!!e.image,hasImageUrl:!!e.imageUrl,imageType:typeof e.image,imageUrlType:typeof e.imageUrl,imageLength:null===(t=e.image)||void 0===t?void 0:t.length,imageUrlLength:null===(n=e.imageUrl)||void 0===n?void 0:n.length,imageValue:e.image,imageUrlValue:e.imageUrl,imagePreview:null===(r=e.image)||void 0===r?void 0:r.substring(0,50),imageUrlPreview:null===(o=e.imageUrl)||void 0===o?void 0:o.substring(0,50)}),{type:pe,payload:e}},ke=function(){return{type:ge}},Ie=function(e){return{type:ie,payload:e}},Ae=function(e){return{type:le,payload:e}},_e=function(e){return{type:se,payload:e}},Te=function(e){return{type:ce,payload:e}},je=function(e){return{type:ue,payload:e}},Fe=function(e){return{type:de,payload:e}},Re=function(e){return{type:fe,payload:e}},Oe=function(e){var t,n,r,o;return console.log("*** ACTION: updateStoredCard called ***"),console.log("Updated card image info:",{cardId:e.id,hasImage:!!e.image,hasImageUrl:!!e.imageUrl,imageType:typeof e.image,imageUrlType:typeof e.imageUrl,imageLength:null===(t=e.image)||void 0===t?void 0:t.length,imageUrlLength:null===(n=e.imageUrl)||void 0===n?void 0:n.length,imageValue:e.image,imageUrlValue:e.imageUrl,imagePreview:null===(r=e.image)||void 0===r?void 0:r.substring(0,50),imageUrlPreview:null===(o=e.imageUrl)||void 0===o?void 0:o.substring(0,50)}),{type:ve,payload:e}},Pe=function(e){return{type:xe,payload:e}},Be=function(e){return{type:be,payload:e}},Ne=function(e){return{type:we,payload:e}},Le=function(e){return{type:Se,payload:e}},ze=function(){return ze=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},ze.apply(this,arguments)},De=(0,r.createContext)(null),Me=function(e){var t=e.tabId,n=e.children,o=k(),i=m((function(e){return e.tabState.tabStates[t]})),s=m((function(e){return e.cards})),l=(0,r.useMemo)((function(){var e=(null==i?void 0:i.cardData)||{text:s.text,translation:s.translation,examples:s.examples,image:s.image,imageUrl:s.imageUrl,front:s.front,back:s.back,linguisticInfo:s.linguisticInfo,transcription:s.transcription,isGeneratingCard:s.isGeneratingCard,currentCardId:s.currentCardId},n=s.storedCards,r=(null==i?void 0:i.fieldIdPrefix)||"fallback_".concat(Date.now(),"_"),a=m((function(e){return e.currentPage})),l=(null==i?void 0:i.currentPage)||a;return{text:e.text,translation:e.translation,examples:e.examples,image:e.image,imageUrl:e.imageUrl,front:e.front,back:e.back,linguisticInfo:e.linguisticInfo,transcription:e.transcription,isGeneratingCard:e.isGeneratingCard,currentCardId:e.currentCardId,storedCards:n,fieldIdPrefix:r,currentPage:l,setText:function(e){o(i?z(t,e):Ie(e))},setTranslation:function(e){o(i?D(t,e):_e(e))},setExamples:function(e){o(i?M(t,e):Ae(e))},setImage:function(e){o(i?U(t,e):Te(e))},setImageUrl:function(e){o(i?q(t,e):je(e))},setFront:function(e){o(i?W(t,e):Re(e))},setBack:function(e){o(i?V(t,e):Fe(e))},setLinguisticInfo:function(e){o(i?$(t,e):Be(e))},setTranscription:function(e){o(i?G(t,e):Ne(e))},setIsGeneratingCard:function(e){o(i?H(t,e):Le(e))},setCurrentCardId:function(e){o(i?K(t,e):Pe(e))},saveCardToStorage:function(e){o(Ee(e))},updateStoredCard:function(e){o(Oe(e))},deleteStoredCard:function(e){o(function(e){return{type:he,payload:e}}(e))},updateCardExportStatus:function(e,t){o(function(e,t){return{type:ye,payload:{cardId:e,status:t}}}(e,t))},setCurrentPage:function(e){o(i?function(e,t){return{type:N,payload:{tabId:e,currentPage:t}}}(t,e):function(e){return{type:"SET_CURRENT_PAGE",currentPage:e}}(e))},updateCard:function(e){Object.keys(e).forEach((function(n){var r=e[n];if(void 0!==r)switch(n){case"text":o(i?z(t,r):Ie(r));break;case"translation":o(i?D(t,r):_e(r));break;case"examples":o(i?M(t,r):Ae(r));break;case"image":o(i?U(t,r):Te(r));break;case"imageUrl":o(i?q(t,r):je(r));break;case"front":o(i?W(t,r):Re(r));break;case"back":o(i?V(t,r):Fe(r));break;case"linguisticInfo":o(i?$(t,r):Be(r));break;case"transcription":o(i?G(t,r):Ne(r));break;case"isGeneratingCard":o(i?H(t,r):Le(r));break;case"currentCardId":o(i?K(t,r):Pe(r))}}))}}}),[i,s,t,o]);return(0,a.jsx)(De.Provider,ze({value:l},{children:n}))},Ue=function(){var e=(0,r.useContext)(De);if(!e)throw new Error("useTabAware must be used within a TabAwareProvider");return e},qe=n(251),We=n(393),Ve={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},$e=r.createContext&&r.createContext(Ve),Ge=function(){return Ge=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Ge.apply(this,arguments)},He=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n};function Ke(e){return e&&e.map((function(e,t){return r.createElement(e.tag,Ge({key:t},e.attr),Ke(e.child))}))}function Qe(e){return function(t){return r.createElement(Ye,Ge({attr:Ge({},e.attr)},t),Ke(e.child))}}function Ye(e){var t=function(t){var n,o=e.attr,a=e.size,i=e.title,s=He(e,["attr","size","title"]),l=a||t.size||"1em";return t.className&&(n=t.className),e.className&&(n=(n?n+" ":"")+e.className),r.createElement("svg",Ge({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,o,s,{className:n,style:Ge(Ge({color:e.color||t.color},t.style),e.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),i&&r.createElement("title",null,i),e.children)};return void 0!==$e?r.createElement($e.Consumer,null,(function(e){return t(e)})):t(Ve)}function Je(e){return Qe({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M208 0c-29.9 0-54.7 20.5-61.8 48.2-.8 0-1.4-.2-2.2-.2-35.3 0-64 28.7-64 64 0 4.8.6 9.5 1.7 14C52.5 138 32 166.6 32 200c0 12.6 3.2 24.3 8.3 34.9C16.3 248.7 0 274.3 0 304c0 33.3 20.4 61.9 49.4 73.9-.9 4.6-1.4 9.3-1.4 14.1 0 39.8 32.2 72 72 72 4.1 0 8.1-.5 12-1.2 9.6 28.5 36.2 49.2 68 49.2 39.8 0 72-32.2 72-72V64c0-35.3-28.7-64-64-64zm368 304c0-29.7-16.3-55.3-40.3-69.1 5.2-10.6 8.3-22.3 8.3-34.9 0-33.4-20.5-62-49.7-74 1-4.5 1.7-9.2 1.7-14 0-35.3-28.7-64-64-64-.8 0-1.5.2-2.2.2C422.7 20.5 397.9 0 368 0c-35.3 0-64 28.6-64 64v376c0 39.8 32.2 72 72 72 31.8 0 58.4-20.7 68-49.2 3.9.7 7.9 1.2 12 1.2 39.8 0 72-32.2 72-72 0-4.8-.5-9.5-1.4-14.1 29-12 49.4-40.6 49.4-73.9z"}}]})(e)}function Xe(e){return Qe({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"}}]})(e)}function Ze(e){return Qe({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"}}]})(e)}function et(e){return Qe({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M207.029 381.476L12.686 187.132c-9.373-9.373-9.373-24.569 0-33.941l22.667-22.667c9.357-9.357 24.522-9.375 33.901-.04L224 284.505l154.745-154.021c9.379-9.335 24.544-9.317 33.901.04l22.667 22.667c9.373 9.373 9.373 24.569 0 33.941L240.971 381.476c-9.373 9.372-24.569 9.372-33.942 0z"}}]})(e)}function tt(e){return Qe({tag:"svg",attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M34.52 239.03L228.87 44.69c9.37-9.37 24.57-9.37 33.94 0l22.67 22.67c9.36 9.36 9.37 24.52.04 33.9L131.49 256l154.02 154.75c9.34 9.38 9.32 24.54-.04 33.9l-22.67 22.67c-9.37 9.37-24.57 9.37-33.94 0L34.52 272.97c-9.37-9.37-9.37-24.57 0-33.94z"}}]})(e)}function nt(e){return Qe({tag:"svg",attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"}}]})(e)}function rt(e){return Qe({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M240.971 130.524l194.343 194.343c9.373 9.373 9.373 24.569 0 33.941l-22.667 22.667c-9.357 9.357-24.522 9.375-33.901.04L224 227.495 69.255 381.516c-9.379 9.335-24.544 9.317-33.901-.04l-22.667-22.667c-9.373-9.373-9.373-24.569 0-33.941L207.03 130.525c9.372-9.373 24.568-9.373 33.941-.001z"}}]})(e)}function ot(e){return Qe({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"}}]})(e)}function at(e){return Qe({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M278.9 511.5l-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2l43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6l144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z"}}]})(e)}function it(e){return Qe({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"}}]})(e)}function st(e){return Qe({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"}}]})(e)}function lt(e){return Qe({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"}}]})(e)}function ct(e){return Qe({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M0 168v-16c0-13.255 10.745-24 24-24h360V80c0-21.367 25.899-32.042 40.971-16.971l80 80c9.372 9.373 9.372 24.569 0 33.941l-80 80C409.956 271.982 384 261.456 384 240v-48H24c-13.255 0-24-10.745-24-24zm488 152H128v-48c0-21.314-25.862-32.08-40.971-16.971l-80 80c-9.372 9.373-9.372 24.569 0 33.941l80 80C102.057 463.997 128 453.437 128 432v-48h360c13.255 0 24-10.745 24-24v-16c0-13.255-10.745-24-24-24z"}}]})(e)}function ut(e){return Qe({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"}}]})(e)}function dt(e){return Qe({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M432 416h-23.41L277.88 53.69A32 32 0 0 0 247.58 32h-47.16a32 32 0 0 0-30.3 21.69L39.41 416H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h128a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16h-19.58l23.3-64h152.56l23.3 64H304a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h128a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM176.85 272L224 142.51 271.15 272z"}}]})(e)}function ft(e){return Qe({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M622.34 153.2L343.4 67.5c-15.2-4.67-31.6-4.67-46.79 0L17.66 153.2c-23.54 7.23-23.54 38.36 0 45.59l48.63 14.94c-10.67 13.19-17.23 29.28-17.88 46.9C38.78 266.15 32 276.11 32 288c0 10.78 5.68 19.85 13.86 25.65L20.33 428.53C18.11 438.52 25.71 448 35.94 448h56.11c10.24 0 17.84-9.48 15.62-19.47L82.14 313.65C90.32 307.85 96 298.78 96 288c0-11.57-6.47-21.25-15.66-26.87.76-15.02 8.44-28.3 20.69-36.72L296.6 284.5c9.06 2.78 26.44 6.25 46.79 0l278.95-85.7c23.55-7.24 23.55-38.36 0-45.6zM352.79 315.09c-28.53 8.76-52.84 3.92-65.59 0l-145.02-44.55L128 384c0 35.35 85.96 64 192 64s192-28.65 192-64l-14.18-113.47-145.03 44.56z"}}]})(e)}function pt(e){return Qe({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h416c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM112 120c-30.928 0-56 25.072-56 56s25.072 56 56 56 56-25.072 56-56-25.072-56-56-56zM64 384h384V272l-87.515-87.515c-4.686-4.686-12.284-4.686-16.971 0L208 320l-55.515-55.515c-4.686-4.686-12.284-4.686-16.971 0L64 336v48z"}}]})(e)}function gt(e){return Qe({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}}]})(e)}function ht(e){return Qe({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M152.1 236.2c-3.5-12.1-7.8-33.2-7.8-33.2h-.5s-4.3 21.1-7.8 33.2l-11.1 37.5H163zM616 96H336v320h280c13.3 0 24-10.7 24-24V120c0-13.3-10.7-24-24-24zm-24 120c0 6.6-5.4 12-12 12h-11.4c-6.9 23.6-21.7 47.4-42.7 69.9 8.4 6.4 17.1 12.5 26.1 18 5.5 3.4 7.3 10.5 4.1 16.2l-7.9 13.9c-3.4 5.9-10.9 7.8-16.7 4.3-12.6-7.8-24.5-16.1-35.4-24.9-10.9 8.7-22.7 17.1-35.4 24.9-5.8 3.5-13.3 1.6-16.7-4.3l-7.9-13.9c-3.2-5.6-1.4-12.8 4.2-16.2 9.3-5.7 18-11.7 26.1-18-7.9-8.4-14.9-17-21-25.7-4-5.7-2.2-13.6 3.7-17.1l6.5-3.9 7.3-4.3c5.4-3.2 12.4-1.7 16 3.4 5 7 10.8 14 17.4 20.9 13.5-14.2 23.8-28.9 30-43.2H412c-6.6 0-12-5.4-12-12v-16c0-6.6 5.4-12 12-12h64v-16c0-6.6 5.4-12 12-12h16c6.6 0 12 5.4 12 12v16h64c6.6 0 12 5.4 12 12zM0 120v272c0 13.3 10.7 24 24 24h280V96H24c-13.3 0-24 10.7-24 24zm58.9 216.1L116.4 167c1.7-4.9 6.2-8.1 11.4-8.1h32.5c5.1 0 9.7 3.3 11.4 8.1l57.5 169.1c2.6 7.8-3.1 15.9-11.4 15.9h-22.9a12 12 0 0 1-11.5-8.6l-9.4-31.9h-60.2l-9.1 31.8c-1.5 5.1-6.2 8.7-11.5 8.7H70.3c-8.2 0-14-8.1-11.4-15.9z"}}]})(e)}function mt(e){return Qe({tag:"svg",attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M96.06 454.35c.01 6.29 1.87 12.45 5.36 17.69l17.09 25.69a31.99 31.99 0 0 0 26.64 14.28h61.71a31.99 31.99 0 0 0 26.64-14.28l17.09-25.69a31.989 31.989 0 0 0 5.36-17.69l.04-38.35H96.01l.05 38.35zM0 176c0 44.37 16.45 84.85 43.56 115.78 16.52 18.85 42.36 58.23 52.21 91.45.04.26.07.52.11.78h160.24c.04-.26.07-.51.11-.78 9.85-33.22 35.69-72.6 52.21-91.45C335.55 260.85 352 220.37 352 176 352 78.61 272.91-.3 175.45 0 73.44.31 0 82.97 0 176zm176-80c-44.11 0-80 35.89-80 80 0 8.84-7.16 16-16 16s-16-7.16-16-16c0-61.76 50.24-112 112-112 8.84 0 16 7.16 16 16s-7.16 16-16 16z"}}]})(e)}function yt(e){return Qe({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M80 368H16a16 16 0 0 0-16 16v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16v-64a16 16 0 0 0-16-16zm0-320H16A16 16 0 0 0 0 64v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16V64a16 16 0 0 0-16-16zm0 160H16a16 16 0 0 0-16 16v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16v-64a16 16 0 0 0-16-16zm416 176H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z"}}]})(e)}function vt(e){return Qe({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M224 96l16-32 32-16-32-16-16-32-16 32-32 16 32 16 16 32zM80 160l26.66-53.33L160 80l-53.34-26.67L80 0 53.34 53.33 0 80l53.34 26.67L80 160zm352 128l-26.66 53.33L352 368l53.34 26.67L432 448l26.66-53.33L512 368l-53.34-26.67L432 288zm70.62-193.77L417.77 9.38C411.53 3.12 403.34 0 395.15 0c-8.19 0-16.38 3.12-22.63 9.38L9.38 372.52c-12.5 12.5-12.5 32.76 0 45.25l84.85 84.85c6.25 6.25 14.44 9.37 22.62 9.37 8.19 0 16.38-3.12 22.63-9.37l363.14-363.15c12.5-12.48 12.5-32.75 0-45.24zM359.45 203.46l-50.91-50.91 86.6-86.6 50.91 50.91-86.6 86.6z"}}]})(e)}function xt(e){return Qe({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M290.74 93.24l128.02 128.02-277.99 277.99-114.14 12.6C11.35 513.54-1.56 500.62.14 485.34l12.7-114.22 277.9-277.88zm207.2-19.06l-60.11-60.11c-18.75-18.75-49.16-18.75-67.91 0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.76 18.75-49.16 0-67.91z"}}]})(e)}function bt(e){return Qe({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(e)}function wt(e){return Qe({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M32,224H64V416H32A31.96166,31.96166,0,0,1,0,384V256A31.96166,31.96166,0,0,1,32,224Zm512-48V448a64.06328,64.06328,0,0,1-64,64H160a64.06328,64.06328,0,0,1-64-64V176a79.974,79.974,0,0,1,80-80H288V32a32,32,0,0,1,64,0V96H464A79.974,79.974,0,0,1,544,176ZM264,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,264,256Zm-8,128H192v32h64Zm96,0H288v32h64ZM456,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,456,256Zm-8,128H384v32h64ZM640,256V384a31.96166,31.96166,0,0,1-32,32H576V224h32A31.96166,31.96166,0,0,1,640,256Z"}}]})(e)}function St(e){return Qe({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"}}]})(e)}function Ct(e){return Qe({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M440.65 12.57l4 82.77A247.16 247.16 0 0 0 255.83 8C134.73 8 33.91 94.92 12.29 209.82A12 12 0 0 0 24.09 224h49.05a12 12 0 0 0 11.67-9.26 175.91 175.91 0 0 1 317-56.94l-101.46-4.86a12 12 0 0 0-12.57 12v47.41a12 12 0 0 0 12 12H500a12 12 0 0 0 12-12V12a12 12 0 0 0-12-12h-47.37a12 12 0 0 0-11.98 12.57zM255.83 432a175.61 175.61 0 0 1-146-77.8l101.8 4.87a12 12 0 0 0 12.57-12v-47.4a12 12 0 0 0-12-12H12a12 12 0 0 0-12 12V500a12 12 0 0 0 12 12h47.35a12 12 0 0 0 12-12.6l-4.15-82.57A247.17 247.17 0 0 0 255.83 504c121.11 0 221.93-86.92 243.55-201.82a12 12 0 0 0-11.8-14.18h-49.05a12 12 0 0 0-11.67 9.26A175.86 175.86 0 0 1 255.83 432z"}}]})(e)}function Et(e){return Qe({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"}}]})(e)}function kt(e){return Qe({tag:"svg",attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"}}]})(e)}function It(e){return Qe({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z"}}]})(e)}var At=function(){return At=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},At.apply(this,arguments)};const _t=function(e){var t=e.size,n=void 0===t?"medium":t,r=e.type,o=void 0===r?"spinner":r,i=e.color,s=void 0===i?"#3B82F6":i,l=e.text,c=e.fullScreen,u=void 0!==c&&c,d=e.overlay,f=void 0!==d&&d,p=e.inline,g=void 0!==p&&p,h={small:{container:"16px",fontSize:"12px",spacing:"8px"},medium:{container:"24px",fontSize:"14px",spacing:"12px"},large:{container:"32px",fontSize:"16px",spacing:"16px"}}[n],m={display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:h.spacing,zIndex:1e3};return u&&(m.position="fixed",m.top=0,m.left=0,m.right=0,m.bottom=0),f&&(m.position="absolute",m.top=0,m.left=0,m.right=0,m.bottom=0,m.backgroundColor="rgba(255, 255, 255, 0.8)"),g&&(m.display="inline-flex",m.flexDirection="row",m.marginLeft="8px",m.marginRight="8px"),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("style",{children:["\n    @keyframes spin {\n      0% { transform: rotate(0deg); }\n      100% { transform: rotate(360deg); }\n    }\n  ","\n    @keyframes pulse {\n      0%, 100% { opacity: 1; transform: scale(1); }\n      50% { opacity: 0.5; transform: scale(0.8); }\n    }\n  ","\n    @keyframes dots1 {\n      0%, 80%, 100% { transform: scale(0); }\n      40% { transform: scale(1); }\n    }\n    @keyframes dots2 {\n      0%, 80%, 100% { transform: scale(0); }\n      40% { transform: scale(1); }\n      animation-delay: 0.2s;\n    }\n    @keyframes dots3 {\n      0%, 80%, 100% { transform: scale(0); }\n      40% { transform: scale(1); }\n      animation-delay: 0.4s;\n    }\n  "]}),(0,a.jsxs)("div",At({style:m},{children:[function(){switch(o){case"spinner":return(0,a.jsx)("div",{style:{width:h.container,height:h.container,border:"2px solid ".concat(s),borderTopColor:"transparent",borderRadius:"50%",animation:"spin 0.8s linear infinite"}});case"pulse":return(0,a.jsx)("div",{style:{width:h.container,height:h.container,backgroundColor:s,borderRadius:"50%",animation:"pulse 1.2s ease-in-out infinite"}});case"dots":return(0,a.jsx)("div",At({style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"}},{children:[1,2,3].map((function(e){return(0,a.jsx)("div",{style:{width:"calc(".concat(h.container," / 3)"),height:"calc(".concat(h.container," / 3)"),backgroundColor:s,borderRadius:"50%",animation:"dots".concat(e," 1.4s infinite ease-in-out both"),animationDelay:"".concat(.2*(e-1),"s")}},e)}))}));default:return null}}(),l&&(0,a.jsx)("div",At({style:{color:s,fontSize:h.fontSize,fontWeight:500,textAlign:"center"}},{children:l}))]}))]})};var Tt=function(){return Tt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Tt.apply(this,arguments)};const jt=function(e){var t=e.content,n=e.isEditable,r=void 0!==n&&n,o=e.onEditClick;return(0,a.jsxs)("div",Tt({className:"grammar-card-container",style:{position:"relative"},onClick:function(e){e.stopPropagation()}},{children:[(0,a.jsx)("div",{className:"grammar-card grammar-reference",dangerouslySetInnerHTML:{__html:t||""},onClick:function(e){e.stopPropagation()}}),r&&o&&(0,a.jsxs)("button",Tt({onClick:function(e){e.stopPropagation(),o()},style:{position:"absolute",top:"8px",right:"8px",background:"rgba(255, 255, 255, 0.8)",border:"1px solid #E5E7EB",color:"#3B82F6",fontSize:"12px",padding:"4px 8px",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",borderRadius:"4px",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"}},{children:[(0,a.jsx)(lt,{size:12}),"Edit"]}))]}))};var Ft=function(){return Ft=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Ft.apply(this,arguments)},Rt={TRANSLATING_TEXT:{title:"Translating text...",subtitle:"Converting your text to the target language",icon:"🌍",color:"#3B82F6",steps:[{title:"Preparing translation...",subtitle:"Setting up translation parameters"},{title:"Sending to translation AI...",subtitle:"Communicating with OpenAI servers"},{title:"Processing translation...",subtitle:"AI is analyzing and translating your text"},{title:"Finalizing translation...",subtitle:"Applying final touches to the translation"}]},TRANSLATING_EXAMPLES:{title:"Translating examples...",subtitle:"Making example sentences available in your language",icon:"📝",color:"#10B981",steps:[{title:"Preparing examples...",subtitle:"Organizing example sentences for translation"},{title:"Translating examples...",subtitle:"Converting examples to your target language"},{title:"Processing translations...",subtitle:"Ensuring translation quality and accuracy"}]},GENERATING_EXAMPLES:{title:"Generating examples...",subtitle:"Creating meaningful example sentences for better understanding",icon:"💡",color:"#F59E0B",steps:[{title:"Analyzing word context...",subtitle:"Understanding word usage and meaning"},{title:"Creating example prompts...",subtitle:"Preparing AI prompts for example generation"},{title:"Generating examples...",subtitle:"AI is crafting relevant example sentences"},{title:"Refining examples...",subtitle:"Ensuring examples are clear and educational"}]},ANALYZING_WORD_FOR_IMAGE:{title:"Analyzing word...",subtitle:"Determining if this is a concept or object for optimal visualization",icon:"🔍",color:"#8B5CF6",steps:[{title:"Classifying word type...",subtitle:"Determining if word represents concept or object"},{title:"Evaluating visual potential...",subtitle:"Assessing how well this can be visualized"},{title:"Preparing visualization strategy...",subtitle:"Choosing optimal image generation approach"}]},CREATING_IMAGE_DESCRIPTION:{title:"Creating image description...",subtitle:"Crafting detailed prompts for AI image generation",icon:"🎨",color:"#EC4899",steps:[{title:"Building image prompt...",subtitle:"Creating detailed description for image generation"},{title:"Optimizing prompt...",subtitle:"Refining prompt for best AI image results"},{title:"Finalizing description...",subtitle:"Preparing final prompt for image generation"}]},GENERATING_IMAGE:{title:"Generating image...",subtitle:"AI is creating a beautiful illustration just for you",icon:"🖼️",color:"#6366F1",steps:[{title:"Sending to image AI...",subtitle:"Transmitting prompt to OpenAI DALL-E"},{title:"AI generating image...",subtitle:"Neural network is creating your custom illustration"},{title:"Processing image...",subtitle:"Applying final touches and optimizations"},{title:"Preparing image for display...",subtitle:"Finalizing image for your flashcard"}]},GENERATING_CARD_CONTENT:{title:"Generating card content...",subtitle:"AI is analyzing your text and creating the perfect flashcard",icon:"🧠",color:"#3B82F6",steps:[{title:"Analyzing input text...",subtitle:"Understanding the content and context"},{title:"Extracting key information...",subtitle:"Identifying main concepts and details"},{title:"Structuring card content...",subtitle:"Organizing information for optimal learning"},{title:"Generating front side...",subtitle:"Creating effective question or prompt"},{title:"Generating back side...",subtitle:"Developing comprehensive answer or explanation"},{title:"Finalizing card format...",subtitle:"Ensuring proper flashcard structure"}]},GENERATING_FRONT_SIDE:{title:"Creating front side...",subtitle:"Crafting an effective question or prompt",icon:"❓",color:"#10B981",steps:[{title:"Designing question format...",subtitle:"Choosing optimal question structure"},{title:"Crafting question text...",subtitle:"Writing clear and effective question"},{title:"Optimizing for learning...",subtitle:"Ensuring question promotes active recall"}]},GENERATING_BACK_SIDE:{title:"Creating back side...",subtitle:"Developing comprehensive answers and explanations",icon:"📖",color:"#F59E0B",steps:[{title:"Compiling answer content...",subtitle:"Gathering comprehensive information"},{title:"Structuring explanation...",subtitle:"Organizing answer for clarity"},{title:"Adding learning elements...",subtitle:"Including helpful context and examples"}]},SAVING_TO_ANKI:{title:"Saving to Anki...",subtitle:"Your card is being added to your Anki collection",icon:"💾",color:"#EF4444",steps:[{title:"Connecting to Anki...",subtitle:"Establishing connection with Anki application"},{title:"Validating card data...",subtitle:"Ensuring card format is correct"},{title:"Saving to collection...",subtitle:"Adding card to your Anki deck"},{title:"Confirming save...",subtitle:"Verifying card was saved successfully"}]},CONNECTING_TO_ANKI:{title:"Connecting to Anki...",subtitle:"Establishing connection with your Anki application",icon:"🔗",color:"#6366F1",steps:[{title:"Locating Anki application...",subtitle:"Finding Anki on your system"},{title:"Establishing connection...",subtitle:"Setting up communication with Anki"},{title:"Verifying connection...",subtitle:"Ensuring stable connection is established"}]},DETECTING_LANGUAGE:{title:"Detecting language...",subtitle:"Analyzing text to determine the source language",icon:"🔤",color:"#8B5CF6",steps:[{title:"Analyzing text patterns...",subtitle:"Examining linguistic characteristics"},{title:"Identifying language...",subtitle:"Determining the most likely language"},{title:"Confirming detection...",subtitle:"Validating language identification"}]},PROCESSING_REQUEST:{title:"Processing your request...",subtitle:"Please wait while we work our magic",icon:"⚡",color:"#6B7280",steps:[{title:"Initializing request...",subtitle:"Setting up your request parameters"},{title:"Processing...",subtitle:"Working on your request"},{title:"Almost done...",subtitle:"Finalizing your request"}]},FINALIZING:{title:"Finalizing...",subtitle:"Putting everything together nicely",icon:"✨",color:"#10B981",steps:[{title:"Assembling results...",subtitle:"Combining all processed information"},{title:"Applying final touches...",subtitle:"Making everything look perfect"},{title:"Ready!",subtitle:"Your request has been completed successfully"}]}},Ot=function(e,t){var n=Rt[e],r=n.steps||[];if(!t||t<=0)return Ft(Ft({},n),{currentStep:0,totalSteps:r.length,currentStepTitle:n.title,currentStepSubtitle:n.subtitle});var o=r[Math.min(t-1,r.length-1)];return Ft(Ft({},n),{currentStep:t,totalSteps:r.length,currentStepTitle:(null==o?void 0:o.title)||n.title,currentStepSubtitle:(null==o?void 0:o.subtitle)||n.subtitle})},Pt=(function(){function e(e,t){this.currentStep=0,this.startTime=Date.now(),this.operation=e,this.onProgressUpdate=t,this.startTime=Date.now()}e.prototype.nextStep=function(){this.currentStep++;var e=Ot(this.operation,this.currentStep);return this.onProgressUpdate&&e&&this.onProgressUpdate(e),e},e.prototype.setStep=function(e){this.currentStep=e;var t=Ot(this.operation,this.currentStep);return this.onProgressUpdate&&t&&this.onProgressUpdate(t),t},e.prototype.getCurrentProgress=function(){return Ot(this.operation,this.currentStep)},e.prototype.getElapsedTime=function(){return Math.floor((Date.now()-this.startTime)/1e3)},e.prototype.isComplete=function(){var e=Rt[this.operation].steps||[];return this.currentStep>=e.length},e.prototype.reset=function(){this.currentStep=0,this.startTime=Date.now()}}(),function(){return Pt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Pt.apply(this,arguments)}),Bt=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))};const Nt=function(e){var t=e.front,n=e.back,o=e.translation,i=e.examples,s=e.imageUrl,l=e.image,c=e.linguisticInfo,u=e.transcription,d=e.onNewImage,f=e.onNewExamples,p=e.onAccept,g=e.onViewSavedCards,h=e.onCancel,m=e.mode,y=void 0===m?Q.d.LanguageLearning:m,v=e.loadingNewImage,x=e.loadingNewExamples,b=e.loadingAccept,w=e.loadingGetResult,S=void 0!==w&&w,C=(e.shouldGenerateImage,e.isSaved),E=void 0!==C&&C,k=(e.isEdited,e.isGeneratingCard),I=e.setTranslation,A=e.setBack,_=e.setExamples,T=e.setLinguisticInfo,j=e.hideActionButtons,F=void 0!==j&&j,R=e.createdAt,O=(0,r.useState)(!1),P=O[0],B=O[1],N=(0,r.useState)(o||""),L=N[0],z=N[1],D=(0,r.useState)(!1),M=D[0],U=D[1],q=(0,r.useState)(n||""),W=q[0],V=q[1],$=(0,r.useState)(!1),G=$[0],H=$[1],K=(0,r.useState)(!0),Y=(K[0],K[1],(0,r.useState)(!0)),J=Y[0],X=Y[1],Z=(0,r.useState)(null),ee=Z[0],te=Z[1],ne=(0,r.useState)(null),re=ne[0],oe=ne[1],ae=(0,r.useState)(null),ie=ae[0],se=ae[1];(0,r.useEffect)((function(){z(o||"")}),[o]),(0,r.useEffect)((function(){V(n||"")}),[n]),(0,r.useEffect)((function(){te(v?Ot("GENERATING_IMAGE",1):null)}),[v]),(0,r.useEffect)((function(){oe(x?Ot("GENERATING_EXAMPLES",1):null)}),[x]),(0,r.useEffect)((function(){se(b?Ot("SAVING_TO_ANKI",1):null)}),[b]),(0,r.useEffect)((function(){Fe(c||"")}),[c]);var le,ce,ue=function(){H(!0)},de=function(){if(P&&I&&(I(L),B(!1)),M&&A&&(A(W),U(!1)),null!==be&&_){var e=Bt([],i,!0);e[be]=[Ce,ke],_(e),we(null)}Ae&&T&&(T(je),_e(!1)),E&&p(),H(!1)},fe=function(){G&&(B(!0),z(o||""))},pe=function(){I&&I(L),B(!1)},ge=function(){G&&(U(!0),V(n||""))},he=function(){A&&A(W),U(!1)},me=function(e,t,n){if(G&&_&&i){var r=Bt([],i,!0);t?r[e][0]=n:r[e][1]=n||null,_(r)}},ye=(0,r.useState)(!1),ve=(ye[0],ye[1],(0,r.useState)(o||"")),xe=(ve[0],ve[1],(0,r.useState)(null)),be=xe[0],we=xe[1],Se=(0,r.useState)(""),Ce=Se[0],Ee=(Se[1],(0,r.useState)("")),ke=Ee[0],Ie=(Ee[1],(0,r.useState)(!1)),Ae=Ie[0],_e=Ie[1],Te=(0,r.useState)(c||""),je=Te[0],Fe=Te[1];return(0,a.jsxs)("div",Pt({style:{padding:"16px",borderRadius:"8px",width:"100%",maxWidth:"100%",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",overflowX:"hidden",backgroundColor:G?"#FAFAFA":"#ffffff",borderLeft:G?"3px solid #3B82F6":"3px solid transparent"}},{children:[(0,a.jsxs)("div",Pt({style:{fontSize:"10px",color:"#9CA3AF",marginBottom:"12px",textAlign:"right",display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"4px",padding:"6px 8px",backgroundColor:G?"#EFF6FF":E?"#ECFDF5":"#F9FAFB",borderRadius:"4px",border:G?"1px solid #DBEAFE":E?"1px solid #D1FAE5":"1px solid #F3F4F6"}},{children:[(0,a.jsxs)("div",Pt({style:{display:"flex",alignItems:"center",gap:"4px"}},{children:[(0,a.jsx)("span",{style:{display:"inline-block",width:"8px",height:"8px",borderRadius:"50%",backgroundColor:G?"#3B82F6":E?"#10B981":"#6B7280"}}),(0,a.jsx)("strong",Pt({style:{color:G?"#1E40AF":E?"#059669":"#4B5563"}},{children:G?"Editing":E?"Saved to Collection":"New - Not Saved Yet"}))]})),(0,a.jsxs)("div",Pt({style:{fontSize:"9px",color:"#9CA3AF",fontStyle:"italic",display:"flex",alignItems:"center",gap:"3px"}},{children:[(0,a.jsx)("span",{children:"📅"}),(R||new Date).toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]}))]})),G?(0,a.jsxs)("button",Pt({onClick:de,disabled:b,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",backgroundColor:"#3B82F6",color:"white",border:"none",borderRadius:"6px",padding:"10px 12px",fontSize:"14px",fontWeight:"600",cursor:"pointer",marginBottom:"12px",width:"100%",opacity:b?.7:1},onMouseOver:function(e){return!b&&(e.currentTarget.style.backgroundColor="#2563EB")},onMouseOut:function(e){return!b&&(e.currentTarget.style.backgroundColor="#3B82F6")}},{children:[(0,a.jsx)(St,{size:14}),b?(0,a.jsxs)("div",Pt({style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"}},{children:[(0,a.jsx)(_t,{type:"spinner",size:"small",inline:!0,color:"#ffffff"}),(0,a.jsx)("span",Pt({style:{fontSize:"12px",fontWeight:"500"}},{children:(null==ie?void 0:ie.currentStepTitle)||(null==ie?void 0:ie.title)||"Saving"}))]})):E?"Save & Finish Editing":"Finish Editing"]})):G?null:(0,a.jsxs)("button",Pt({onClick:ue,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",backgroundColor:"#F3F4F6",color:"#4B5563",border:"1px solid #E5E7EB",borderRadius:"6px",padding:"10px 12px",fontSize:"14px",fontWeight:"600",cursor:"pointer",marginBottom:"12px",width:"100%"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#E5E7EB",e.currentTarget.style.color="#1F2937"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.color="#4B5563"}},{children:[(0,a.jsx)(lt,{size:14}),"Edit Card"]})),G?(0,a.jsxs)("div",Pt({style:{marginBottom:"16px",backgroundColor:"#EFF6FF",borderRadius:"6px",padding:"10px",border:"1px solid #DBEAFE",fontSize:"13px",color:"#1E40AF"}},{children:[(0,a.jsxs)("div",Pt({style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"6px",fontWeight:"600"}},{children:[(0,a.jsx)(lt,{size:12}),"Editing Mode"]})),(0,a.jsxs)("p",Pt({style:{margin:0,fontSize:"12px"}},{children:['Click on text elements to edit them. When finished, click "',E?"Save & Finish Editing":"Finish Editing",'" at the top of the card.']}))]})):null,t&&(0,a.jsx)("div",Pt({style:{marginBottom:"12px"}},{children:t.includes("/")?function(){var e,n=t.split(/\s*\//),r=(null===(e=n[0])||void 0===e?void 0:e.trim())||"",o=n.length>1?"/".concat(n.slice(1).join("/").replace(/\/$/,"")):"";return(0,a.jsxs)("div",Pt({style:{textAlign:"center",padding:"12px",backgroundColor:"#F3F4F6",borderRadius:"8px"}},{children:[(0,a.jsx)("h3",Pt({style:{fontSize:"20px",fontWeight:"700",margin:"0 0 6px 0",color:"#111827"}},{children:r})),o&&(0,a.jsx)("div",Pt({style:{fontSize:"14px",color:"#6B7280",fontStyle:"italic"}},{children:o}))]}))}():(0,a.jsx)("h3",Pt({style:{fontSize:"18px",fontWeight:"600",textAlign:"center",margin:"2px 0",color:"#111827",padding:"10px",backgroundColor:"#F3F4F6",borderRadius:"8px"}},{children:t}))})),u&&(0,a.jsx)("div",Pt({style:{marginBottom:"12px",textAlign:"center",padding:"8px 12px",backgroundColor:"#F8FAFC",border:"1px solid #E2E8F0",borderRadius:"6px"}},{children:(0,a.jsx)("div",{style:{fontSize:"14px",lineHeight:"1.6",color:"#475569"},dangerouslySetInnerHTML:{__html:u}})})),(y===Q.d.LanguageLearning?o:n)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("hr",{style:{margin:"10px 0",border:"none",borderTop:"1px solid #E5E7EB"}}),(y===Q.d.LanguageLearning?P:M)&&G?(0,a.jsxs)("div",Pt({style:{marginBottom:"12px",position:"relative"}},{children:[y===Q.d.LanguageLearning?(0,a.jsx)("input",{type:"text",value:L,onChange:function(e){return z(e.target.value)},style:{width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #3B82F6",backgroundColor:"#ffffff",color:"#111827",fontSize:"14px",outline:"none",fontWeight:"600",textAlign:"center"},autoFocus:!0,onBlur:pe,onKeyDown:function(e){"Enter"===e.key&&pe()}}):(0,a.jsx)("textarea",{value:W,onChange:function(e){return V(e.target.value)},style:{width:"100%",minHeight:"120px",padding:"12px",borderRadius:"6px",border:"1px solid #3B82F6",backgroundColor:"#ffffff",color:"#111827",fontSize:"14px",outline:"none",fontWeight:"400",lineHeight:"1.5",resize:"vertical"},autoFocus:!0,onBlur:he,onKeyDown:function(e){"Enter"===e.key&&e.ctrlKey&&he()}}),(0,a.jsx)("div",Pt({style:{fontSize:"11px",color:"#6B7280",textAlign:"center",marginTop:"4px"}},{children:y===Q.d.LanguageLearning?"Press Enter or click outside to save":"Press Ctrl+Enter or click outside to save"}))]})):(0,a.jsxs)("div",Pt({style:Pt({marginBottom:"12px",textAlign:y===Q.d.LanguageLearning?"center":"left",position:"relative",paddingRight:G?"24px":"0"},G?{padding:"8px",border:"1px dashed #E5E7EB",borderRadius:"4px",transition:"all 0.2s ease",cursor:"pointer",backgroundColor:"#FAFAFA"}:{}),onClick:G?y===Q.d.LanguageLearning?fe:ge:void 0,onMouseOver:function(e){G&&(e.currentTarget.style.borderColor="#3B82F6",e.currentTarget.style.backgroundColor="#F9FAFB")},onMouseOut:function(e){G&&(e.currentTarget.style.borderColor="#E5E7EB",e.currentTarget.style.backgroundColor="#FAFAFA")}},{children:[y===Q.d.LanguageLearning?(0,a.jsx)("p",Pt({style:{fontWeight:"600",color:"#111827",fontSize:"14px",margin:0}},{children:o})):(0,a.jsx)("div",{style:{color:"#111827",fontSize:"14px",lineHeight:"1.6",margin:0,whiteSpace:"pre-wrap",wordWrap:"break-word"},dangerouslySetInnerHTML:{__html:(le=n||"",ce=le,ce=(ce=(ce=(ce=(ce=ce.replace(/!\[([^\]]*)\]\(([^)]+)\)/g,(function(e,t,n){var r=t&&"Изображение"!==t&&"Image"!==t?t:"";return'<div style="text-align: center; margin: 4px 0;">\n            <img src="'.concat(n,'" alt="').concat(r,'" style="max-width: 100%; height: auto; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); display: block; margin: 0 auto;" />\n            ').concat(r?'<div style="font-size: 11px; color: #6B7280; margin-top: 2px; font-style: italic;">'.concat(r,"</div>"):"","\n        </div>")}))).replace(/\$\$([^$]+)\$\$/g,(function(e,t){return'<div style="text-align: center; margin: 12px 0; padding: 8px; background: #F8FAFC; border-radius: 6px; font-family: serif;">\n            <strong>Формула:</strong> '.concat(t,"\n        </div>")}))).replace(/```(\w*)\n([\s\S]*?)\n```/g,(function(e,t,n){return'<div style="margin: 12px 0;">\n            <div style="background: #2D2D2D; color: #F8F8F2; padding: 12px; border-radius: 6px; font-family: monospace; overflow-x: auto; white-space: pre; font-size: 13px;">\n                '.concat(t?'<div style="color: #6B7280; margin-bottom: 8px; font-size: 11px;">'.concat(t,"</div>"):"","\n                ").concat(n,"\n            </div>\n        </div>")}))).replace(/`([^`]+)`/g,'<code style="background: #F3F4F6; padding: 2px 4px; border-radius: 3px; font-family: monospace; font-size: 13px;">$1</code>')).replace(/\n/g,"<br />"))}}),G&&(0,a.jsx)("button",Pt({onClick:function(e){e.stopPropagation(),y===Q.d.LanguageLearning?fe():ge()},style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",background:"#F3F4F6",border:"none",borderRadius:"4px",cursor:"pointer",color:"#6B7280",display:"flex",padding:"4px",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},title:y===Q.d.LanguageLearning?"Edit translation":"Edit content",onMouseOver:function(e){e.currentTarget.style.backgroundColor="#E5E7EB",e.currentTarget.style.color="#3B82F6"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.color="#6B7280"}},{children:(0,a.jsx)(xt,{size:12})}))]}))]}),c&&(0,a.jsxs)("div",Pt({style:{marginTop:"12px",marginBottom:"16px",borderRadius:"10px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.05)",border:"1px solid",borderColor:J?"#BFDBFE":"#E5E7EB",backgroundColor:J?"#EFF6FF":"#F9FAFB",transition:"all 0.3s ease",overflow:"hidden"}},{children:[(0,a.jsxs)("div",Pt({style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",borderBottom:J?"1px solid #BFDBFE":"none",transition:"background-color 0.2s"}},{children:[(0,a.jsxs)("div",Pt({style:{display:"flex",alignItems:"center",gap:"10px",fontWeight:600,fontSize:"14px",color:J?"#1D4ED8":"#4B5563",flex:1}},{children:[(0,a.jsx)(ft,{size:16,color:J?"#2563EB":"#6B7280"}),(0,a.jsx)("span",{children:"Grammar & Linguistics"})]})),(0,a.jsx)("button",Pt({onClick:function(e){e.stopPropagation(),X(!J)},style:{background:"none",border:"none",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px",transition:"background-color 0.2s"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="rgba(0,0,0,0.05)"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="transparent"}},{children:J?(0,a.jsx)(rt,{size:14,color:"#6B7280"}):(0,a.jsx)(et,{size:14,color:"#6B7280"})}))]})),J&&(0,a.jsx)("div",Pt({style:{padding:"16px"}},{children:Ae?(0,a.jsxs)("div",Pt({style:{width:"100%"}},{children:[(0,a.jsx)("textarea",{value:je,onChange:function(e){Fe(e.target.value)},style:{width:"100%",minHeight:"120px",padding:"10px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",fontSize:"14px",lineHeight:"1.5",resize:"vertical",marginBottom:"8px"}}),(0,a.jsxs)("div",Pt({style:{display:"flex",justifyContent:"flex-end",gap:"8px"}},{children:[(0,a.jsx)("button",Pt({onClick:function(){Fe(c||""),_e(!1)},style:{padding:"6px 12px",backgroundColor:"#F3F4F6",color:"#4B5563",border:"1px solid #E5E7EB",borderRadius:"6px",fontSize:"13px",cursor:"pointer"}},{children:"Cancel"})),(0,a.jsx)("button",Pt({onClick:function(){T&&T(je),_e(!1)},style:{padding:"6px 12px",backgroundColor:"#2563EB",color:"white",border:"none",borderRadius:"6px",fontSize:"13px",cursor:"pointer"}},{children:"Save"}))]}))]})):(0,a.jsx)("div",Pt({style:{position:"relative"}},{children:(0,a.jsx)(jt,{content:c||"",isEditable:G,onEditClick:function(){return _e(!0)}})}))}))]})),i.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("hr",{style:{margin:"10px 0",border:"none",borderTop:"1px solid #E5E7EB"}}),(0,a.jsxs)("div",Pt({style:{marginBottom:"12px"}},{children:[(0,a.jsx)("div",Pt({style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"}},{children:(0,a.jsx)("h4",Pt({style:{fontSize:"14px",fontWeight:"600",color:"#374151",margin:0}},{children:"Examples"}))})),(0,a.jsx)("ul",Pt({style:{listStyle:"none",padding:0,margin:0,display:"flex",flexDirection:"column",gap:"8px"}},{children:i.map((function(e,t){var n=e[0],r=e[1];return(0,a.jsxs)("li",Pt({style:Pt({padding:"12px",backgroundColor:"#F9FAFB",borderRadius:"6px",position:"relative",minHeight:"auto",wordWrap:"break-word",overflow:"visible"},G?{border:"1px dashed #CBD5E1",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"}:{})},{children:[G&&(0,a.jsx)("div",Pt({style:{position:"absolute",top:"8px",right:"8px",display:"flex",gap:"8px",zIndex:5}},{children:(0,a.jsxs)("button",Pt({onClick:function(){return function(e){if(G&&_&&i){var t=Bt([],i,!0);t.splice(e,1),_(t)}}(t)},style:{background:"#FEE2E2",border:"none",borderRadius:"4px",cursor:"pointer",color:"#EF4444",padding:"4px 6px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"11px",fontWeight:"500"},title:"Delete example",onMouseOver:function(e){e.currentTarget.style.backgroundColor="#FECACA"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#FEE2E2"}},{children:[(0,a.jsx)(It,{size:10,style:{marginRight:"4px"}}),"Delete"]}))})),G?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",Pt({style:{marginBottom:"8px"}},{children:(0,a.jsx)("textarea",{value:n,onChange:function(e){return me(t,!0,e.target.value)},style:{width:"100%",padding:"6px 8px",borderRadius:"4px",border:"1px solid #E5E7EB",fontSize:"13px",color:"#111827",fontWeight:"500",backgroundColor:"#ffffff",minHeight:"40px",resize:"vertical",fontFamily:"inherit",lineHeight:"1.4"},placeholder:"Example sentence"})})),(0,a.jsx)("div",{children:(0,a.jsx)("textarea",{value:r||"",onChange:function(e){return me(t,!1,e.target.value)},style:{width:"100%",padding:"6px 8px",borderRadius:"4px",border:"1px solid #E5E7EB",fontSize:"13px",color:"#6B7280",fontStyle:"italic",backgroundColor:"#ffffff",minHeight:"40px",resize:"vertical",fontFamily:"inherit",lineHeight:"1.4"},placeholder:"Translation (optional)"})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",Pt({style:{fontWeight:"500",color:"#111827",fontSize:"13px",marginBottom:r?"6px":0,lineHeight:"1.4",wordWrap:"break-word",overflow:"visible",whiteSpace:"normal"}},{children:n})),r&&(0,a.jsx)("div",Pt({style:{color:"#6B7280",fontSize:"13px",fontStyle:"italic",lineHeight:"1.4",wordWrap:"break-word",overflow:"visible",whiteSpace:"normal"}},{children:r}))]})]}),t)}))})),G&&(0,a.jsxs)("button",Pt({onClick:function(){if(G&&_&&i){var e=Bt([],i,!0);e.push(["",null]),_(e)}},style:{width:"100%",padding:"10px",borderRadius:"6px",backgroundColor:"#EFF6FF",color:"#3B82F6",fontSize:"14px",fontWeight:"500",border:"1px dashed #BFDBFE",cursor:"pointer",marginTop:"12px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"all 0.2s ease"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#DBEAFE",e.currentTarget.style.borderColor="#93C5FD"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#EFF6FF",e.currentTarget.style.borderColor="#BFDBFE"}},{children:[(0,a.jsx)(bt,{size:12}),"Add Example"]}))]}))]}),(l||s)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("hr",{style:{margin:"16px 0",border:"none",borderTop:"1px solid #E5E7EB"}}),(0,a.jsx)("div",Pt({style:{marginBottom:"16px"}},{children:(0,a.jsx)("img",{src:l||s||"",alt:"",style:{width:"100%",borderRadius:"6px",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)"}})}))]}),!E&&(0,a.jsxs)("div",Pt({style:{display:"flex",gap:"6px",marginBottom:"8px"}},{children:[(l||s)&&(0,a.jsx)("button",Pt({onClick:d,disabled:v,style:{flex:1,padding:"8px 12px",borderRadius:"6px",backgroundColor:"#F59E0B",color:"#ffffff",fontWeight:"600",fontSize:"13px",border:"none",cursor:"pointer",transition:"all 0.2s ease",opacity:v?.7:1},onMouseOver:function(e){return!v&&(e.currentTarget.style.backgroundColor="#D97706")},onMouseOut:function(e){return!v&&(e.currentTarget.style.backgroundColor="#F59E0B")}},{children:v?(0,a.jsxs)("div",Pt({style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"}},{children:[(0,a.jsx)(_t,{type:"spinner",size:"small",inline:!0,color:"#ffffff"}),(0,a.jsx)("span",Pt({style:{fontSize:"12px",fontWeight:"500"}},{children:(null==ee?void 0:ee.currentStepTitle)||(null==ee?void 0:ee.title)||"Generating"}))]})):"New Image"})),i.length>0&&(0,a.jsx)("button",Pt({onClick:f,disabled:x,style:{flex:1,padding:"8px 12px",borderRadius:"6px",backgroundColor:"#F59E0B",color:"#ffffff",fontWeight:"600",fontSize:"13px",border:"none",cursor:"pointer",transition:"all 0.2s ease",opacity:x?.7:1},onMouseOver:function(e){return!x&&(e.currentTarget.style.backgroundColor="#D97706")},onMouseOut:function(e){return!x&&(e.currentTarget.style.backgroundColor="#F59E0B")}},{children:x?(0,a.jsxs)("div",Pt({style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"}},{children:[(0,a.jsx)(_t,{type:"spinner",size:"small",inline:!0,color:"#ffffff"}),(0,a.jsx)("span",Pt({style:{fontSize:"12px",fontWeight:"500"}},{children:(null==re?void 0:re.currentStepTitle)||(null==re?void 0:re.title)||"Loading"}))]})):"New Examples"}))]})),!F&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",Pt({style:{marginBottom:"10px"}},{children:[!G&&(!E||k||S)&&(0,a.jsxs)("div",Pt({style:{display:"flex",gap:"8px",width:"100%"}},{children:[(0,a.jsxs)("button",Pt({onClick:h,disabled:b,style:{flex:"1",padding:"10px",borderRadius:"6px",backgroundColor:"#F3F4F6",color:"#4B5563",fontWeight:"600",fontSize:"14px",border:"1px solid #E5E7EB",cursor:b?"not-allowed":"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",opacity:b?.7:1},onMouseOver:function(e){b||(e.currentTarget.style.backgroundColor="#E5E7EB",e.currentTarget.style.color="#374151")},onMouseOut:function(e){b||(e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.color="#4B5563")}},{children:[(0,a.jsx)(kt,{}),k||S?"Cancel Generation":"Cancel"]})),!k&&!S&&(0,a.jsxs)("button",Pt({onClick:p,disabled:b,style:{flex:"2",padding:"10px",borderRadius:"6px",backgroundColor:"#22C55E",color:"#ffffff",fontWeight:"600",fontSize:"14px",border:"none",cursor:"pointer",transition:"all 0.2s ease",opacity:b?.7:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},onMouseOver:function(e){return!b&&(e.currentTarget.style.backgroundColor="#15803D")},onMouseOut:function(e){return!b&&(e.currentTarget.style.backgroundColor="#22C55E")}},{children:[(0,a.jsx)(Ze,{}),b?(0,a.jsx)("div",Pt({style:{display:"flex",alignItems:"center",justifyContent:"center"}},{children:(0,a.jsx)(_t,{type:"spinner",size:"small",inline:!0,color:"#ffffff",text:"Saving"})})):"Save Card"]}))]})),!G&&E&&(0,a.jsxs)("div",Pt({style:{width:"100%",padding:"10px",borderRadius:"6px",backgroundColor:"#ECFDF5",border:"1px solid #D1FAE5",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"}},{children:[(0,a.jsx)("div",Pt({style:{display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",borderRadius:"50%",backgroundColor:"#10B981",color:"white"}},{children:(0,a.jsx)(Ze,{size:12})})),(0,a.jsx)("span",Pt({style:{fontWeight:"600",fontSize:"14px",color:"#059669"}},{children:"Saved to Collection"}))]})),!G&&!E&&(0,a.jsx)("p",Pt({style:{fontSize:"11px",color:"#6B7280",textAlign:"center",margin:"4px 0 0 0"}},{children:"The card will be saved to your collection"}))]})),(0,a.jsxs)("button",Pt({onClick:g,style:{width:"100%",padding:"10px",borderRadius:"6px",backgroundColor:"#4B5563",color:"#ffffff",fontWeight:"600",fontSize:"13px",border:"none",cursor:"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="#374151"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="#4B5563"}},{children:[(0,a.jsx)(yt,{size:14}),"View Saved Cards"]}))]})]}))};var Lt=n(178),zt=n(743),Dt=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},Mt=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}};function Ut(e,t,n,r,o){return void 0===o&&(o=""),Dt(this,void 0,void 0,(function(){var e,a,i,s,l;return Mt(this,(function(c){switch(c.label){case 0:if(console.log("getImage called with description:",r),e=null,a=null,!r)throw new Error("Cannot generate image: missing description");if(!n)throw new Error("Cannot generate image: no OpenAI API key provided. Please check your settings.");c.label=1;case 1:return c.trys.push([1,7,,8]),console.log("Using OpenAI with key:",n?n.substring(0,5)+"...":"null"),[4,(0,qe.getOpenAiImageUrl)(t,n,r,o)];case 2:if(e=c.sent(),console.log("OpenAI returned URL:",e?"success":"null"),!e)return[3,6];c.label=3;case 3:return c.trys.push([3,5,,6]),console.log("Converting image URL to base64 for permanent storage..."),[4,te(e)];case 4:return a=c.sent(),console.log("Image URL converted to base64:",a?"success":"null"),a?console.log("✅ Image successfully converted to base64 - keeping both URL and base64 for reliability"):console.warn("⚠️ Failed to convert image to base64 - keeping temporary URL as fallback"),[3,6];case 5:return i=c.sent(),console.error("❌ Error converting URL to base64:",i),console.warn("⚠️ Will use temporary URL as fallback, but it may disappear later"),[3,6];case 6:return[3,8];case 7:throw s=c.sent(),console.error("OpenAI image generation error:",s),s instanceof Error?s:new Error("Failed to generate image with OpenAI. Please check your API key and try again.");case 8:if(!e&&!a)throw new Error("Failed to generate image. Please check your API key and try again.");return l=a?null:e,console.log("Final result:",{hasBase64:!!a,hasUrl:!!l,status:a?"Base64 (permanent)":l?"URL only (temporary)":"No image"}),[2,{imageUrl:l,imageBase64:a}]}}))}))}var qt=function(){return qt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},qt.apply(this,arguments)};const Wt=function(){var e=(0,r.useState)(null),t=e[0],n=e[1],o=(0,r.useState)("error"),i=o[0],s=o[1],l=(0,r.useState)(!1),c=l[0],u=l[1],d=(0,r.useState)(!1),f=d[0],p=d[1],g=function(){p(!1),setTimeout((function(){u(!1),n(null)}),300)};return{showError:function(e,t){void 0===t&&(t="error"),console.log("showError called:",{message:e,errorType:t,visible:c,isAnimating:f}),e?(n(e),s(t),u(!0),setTimeout((function(){p(!0)}),50),setTimeout((function(){g()}),5e3)):g()},renderErrorNotification:function(){if(console.log("renderErrorNotification called:",{visible:c,error:t,isAnimating:f,type:i}),!c||!t)return null;var e,n=function(){switch(i){case"success":return{icon:(0,a.jsx)(Xe,{size:16}),color:"#059669",bgColor:"#ECFDF5",borderColor:"#10B981"};case"warning":return{icon:(0,a.jsx)(ut,{size:16}),color:"#D97706",bgColor:"#FFFBEB",borderColor:"#F59E0B"};case"info":return{icon:(0,a.jsx)(gt,{size:16}),color:"#2563EB",bgColor:"#EFF6FF",borderColor:"#3B82F6"};default:return{icon:(0,a.jsx)(Et,{size:16}),color:"#DC2626",bgColor:"#FEF2F2",borderColor:"#EF4444"}}}(),r=n.icon,o=n.color,s=n.bgColor,l=n.borderColor,u=(e=t).includes("401")||e.includes("Unauthorized")||e.includes("Authentication")?"API Authentication failed: Please check your API key in Settings.":e.includes("429")||e.includes("Rate limit")?"API rate limit exceeded: Please try again in a few minutes.":e.includes("500")||e.includes("502")||e.includes("503")||e.includes("504")?"AI service is currently unavailable. Please try again later.":e.includes("key is missing")||e.includes("API key")?"API key is missing or invalid. Please check your settings.":e.includes("OpenAI")?"OpenAI API error: ".concat(e.split("OpenAI").pop()):e.includes("Groq")?"Groq API error: ".concat(e.split("Groq").pop()):e;return(0,a.jsxs)("div",qt({style:{transform:f?"translateX(0)":"translateX(100%)",opacity:f?1:0,transition:"all 0.3s ease-out",backgroundColor:s,border:"1px solid ".concat(l),borderRadius:"12px",padding:"16px",minWidth:"280px",maxWidth:"320px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",position:"relative",display:"flex",alignItems:"flex-start",gap:"12px",marginBottom:"8px"},role:"alert","aria-live":"polite"},{children:[(0,a.jsx)("div",qt({style:{color:o,marginTop:"2px",flexShrink:0}},{children:r})),(0,a.jsx)("div",qt({style:{flex:1,paddingRight:"8px"}},{children:(0,a.jsx)("p",qt({style:{color:"#374151",margin:0,fontSize:"14px",lineHeight:"1.5",fontWeight:500}},{children:u}))})),(0,a.jsx)("button",qt({onClick:g,style:{position:"absolute",top:"8px",right:"8px",background:"transparent",border:"none",color:"#9CA3AF",cursor:"pointer",padding:"4px",borderRadius:"4px",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="rgba(0, 0, 0, 0.1)",e.currentTarget.style.color="#374151"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="#9CA3AF"},"aria-label":"Close notification"},{children:(0,a.jsx)(kt,{size:12})})),(0,a.jsx)("div",qt({style:{position:"absolute",bottom:0,left:0,right:0,height:"3px",backgroundColor:"rgba(0, 0, 0, 0.1)",borderRadius:"0 0 12px 12px",overflow:"hidden"}},{children:(0,a.jsx)("div",{style:{height:"100%",backgroundColor:l,width:"100%",transition:"width 5s linear",transformOrigin:"left"}})}))]}))}}};var Vt=function(){return Vt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Vt.apply(this,arguments)},$t=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},Gt="anki_stored_cards",Ht="anki_tab_cards",Kt=function(e){try{return e.startsWith("data:image/")&&e.length>1e5?(console.log("Large image detected, applying basic compression"),console.warn("Large image (".concat(Math.round(e.length/1024),"KB) detected. Consider using smaller images.")),e):e}catch(t){return console.error("Error compressing image:",t),e}},Qt=function(e){try{var t=JSON.stringify(e,(function(e,t){return t instanceof Date?t.toISOString():t})),n=new Blob([t]).size/1048576;if(console.log("Storage analysis: ".concat(e.length," cards, ").concat(n.toFixed(2),"MB")),n<4)return e;console.warn("Storage size is large, optimizing...");for(var r=$t([],e,!0).sort((function(e,t){return new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()})),o=[],a=0,i=0,s=r;i<s.length;i++){var l=s[i],c=JSON.stringify(l,(function(e,t){return t instanceof Date?t.toISOString():t})),u=new Blob([c]).size;if(a+u>4194304){console.warn("Stopping at ".concat(o.length," cards to stay within storage limit"));break}o.push(l),a+=u}return o}catch(t){return console.error("Error managing storage quota:",t),e}},Yt=function(){console.warn("⚠️ Storage quota exceeded! This usually happens when you have many cards with large images."),console.warn("💡 To fix this:"),console.warn("   • Use smaller images"),console.warn("   • Export older cards and delete them"),console.warn("   • Consider using image URLs instead of embedded images")},Jt=function(){try{var e=localStorage.getItem(Gt);if(console.log("Loading cards from localStorage. Data exists:",!!e),e)try{var t=JSON.parse(e);if(console.log("Successfully parsed cards from localStorage, total count:",t.length),t.length>0){var n=t.slice(0,Math.min(3,t.length)),r=t.length>3?t.slice(-3):[];console.log("First few cards:",n.map((function(e){var t;return{id:e.id,text:null===(t=e.text)||void 0===t?void 0:t.substring(0,20)}}))),r.length>0&&console.log("Last few cards:",r.map((function(e){var t;return{id:e.id,text:null===(t=e.text)||void 0===t?void 0:t.substring(0,20)}})))}if(!Array.isArray(t))return console.error("Stored cards is not an array!",t),[];var o=t.filter((function(e){var t=!!e.id,n=!!e.text,r=!!e.createdAt;return!!(t&&n&&r)||(console.warn("Found invalid card, removing from results:",e),!1)}));console.log("Card validation: ".concat(o.length," valid out of ").concat(t.length," total"));var a=o.map((function(e){return Vt(Vt({},e),{createdAt:new Date(e.createdAt)})})),i=a.filter((function(e){return e.image||e.imageUrl}));return console.log("Loaded cards with images:",i.length),i.forEach((function(e){var t,n,r,o;console.log("Loaded card ".concat(e.id," image data:"),{hasImage:!!e.image,hasImageUrl:!!e.imageUrl,imageLength:null===(t=e.image)||void 0===t?void 0:t.length,imageUrlLength:null===(n=e.imageUrl)||void 0===n?void 0:n.length,imagePreview:null===(r=e.image)||void 0===r?void 0:r.substring(0,50),imageUrlPreview:null===(o=e.imageUrl)||void 0===o?void 0:o.substring(0,50)})})),a}catch(e){return console.error("JSON parse error:",e),localStorage.removeItem(Gt),[]}}catch(e){console.error("Error loading cards from localStorage:",e);try{localStorage.removeItem(Gt)}catch(e){console.error("Could not clean up localStorage:",e)}}return[]},Xt=function(e,t,n){var r="".concat(Ht,"_").concat(e);try{var o=JSON.stringify(t,(function(e,t){return t instanceof Date?t.toISOString():t}));new Blob([o]).size}catch(e){console.error("Could not determine original size:",e)}if(n instanceof DOMException&&("QuotaExceededError"===n.name||"NS_ERROR_DOM_QUOTA_REACHED"===n.name)){console.error("localStorage quota exceeded for tab ".concat(e,". Using storage optimization.")),Yt();var a=Qt(t);try{var i=JSON.stringify(a,(function(e,t){return t instanceof Date?t.toISOString():t}));localStorage.setItem(r,i),console.warn("Smart optimization for tab ".concat(e,": Saved ").concat(a.length," of ").concat(t.length," cards"))}catch(t){console.error("Failed to save optimized cards for tab ".concat(e,":"),t)}}};const Zt=function(e){return function(t){return function(n){var r=t(n);switch(n.type){case ge:try{var o=Jt();e.dispatch({type:"SET_STORED_CARDS",payload:o})}catch(t){console.error("Error in LOAD_STORED_CARDS middleware:",t),e.dispatch({type:"SET_STORED_CARDS",payload:[]})}break;case pe:case he:case ve:case ye:try{!function(e){try{console.log("Saving cards to localStorage:",e),console.log("Total cards count:",e.length);var t=e.filter((function(e){return e.image||e.imageUrl}));console.log("Cards with images:",t.length),t.forEach((function(e){var t,n,r,o;console.log("Card ".concat(e.id," image data:"),{hasImage:!!e.image,hasImageUrl:!!e.imageUrl,imageLength:null===(t=e.image)||void 0===t?void 0:t.length,imageUrlLength:null===(n=e.imageUrl)||void 0===n?void 0:n.length,imagePreview:null===(r=e.image)||void 0===r?void 0:r.substring(0,50),imageUrlPreview:null===(o=e.imageUrl)||void 0===o?void 0:o.substring(0,50)})}));var n=Qt(e);n.length<e.length&&console.warn("Storage optimization: keeping ".concat(n.length," of ").concat(e.length," cards to preserve images"));var r=JSON.stringify(n,(function(e,t){return t instanceof Date?t.toISOString():t})),o=new Blob([r]).size;console.log("Storage size in bytes:",o,"Approximate max size: ~5MB"),o>4194304&&console.warn("Warning: localStorage size is getting large (>4MB). This might cause issues in some browsers."),localStorage.setItem(Gt,r),console.log("Cards saved successfully to localStorage with image preservation")}catch(t){console.error("Error saving cards to localStorage:",t);var a=0;try{var i=JSON.stringify(e,(function(e,t){return t instanceof Date?t.toISOString():t}));a=new Blob([i]).size}catch(e){console.error("Could not determine original size:",e)}if(t instanceof DOMException&&("QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&(console.error("localStorage quota exceeded. Cannot save more cards. Trying to preserve images by using other strategies."),Yt(),e.length>0)){console.warn("CRITICAL: Storage quota exceeded. Attempting to preserve images while managing storage.");try{console.warn("Storage quota exceeded. Using intelligent optimization to preserve images...");var s=Qt(e);if(s.length>0){var l=JSON.stringify(s,(function(e,t){return t instanceof Date?t.toISOString():t}));if(new Blob([l]).size<=4718592)return localStorage.setItem(Gt,l),void console.warn("Smart optimization: Saved ".concat(s.length," of ").concat(e.length," cards with images preserved"))}var c=e.map((function(e){return Vt(Vt({},e),{image:e.image?Kt(e.image):null,id:e.id,text:e.text,translation:e.translation,front:e.front,back:e.back,examples:e.examples,imageUrl:e.imageUrl,createdAt:e.createdAt,exportStatus:e.exportStatus,linguisticInfo:e.linguisticInfo,transcription:e.transcription})}));console.warn("Attempting to save cards with compressed images instead of removing them.");var u=JSON.stringify(c,(function(e,t){return t instanceof Date?t.toISOString():t})),d=new Blob([u]).size;if(console.log("Reduced size from ".concat(a," to ").concat(d," bytes")),d>4718592){console.warn("Still too large after size reduction, falling back to limiting card count");for(var f=$t([],c,!0).sort((function(e,t){return new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime()})),p=Math.min(10,f.length),g=void 0;p<f.length;){g=f.slice(0,p);var h=JSON.stringify(g,(function(e,t){return t instanceof Date?t.toISOString():t}));if(new Blob([h]).size>4718592)break;p+=5}console.warn("Emergency preservation: keeping ".concat(p," cards out of ").concat(f.length," total (removing oldest to preserve newest with images)"));var m=f.slice(-p);localStorage.setItem(Gt,JSON.stringify(m,(function(e,t){return t instanceof Date?t.toISOString():t})))}else localStorage.setItem(Gt,u);return void console.log("Saved cards with image preservation strategy to fit within quota")}catch(e){console.error("Failed to save with data reduction:",e)}}}}(e.getState().cards.storedCards)}catch(e){console.error("Error in card storage middleware:",e)}break;case F:case R:case B:case P:try{var a=e.getState().tabState.tabStates,i=n.payload.tabId;if(i&&a[i])!function(e,t){try{var n="".concat(Ht,"_").concat(e);console.log("Saving ".concat(t.length," cards for tab ").concat(e));var r=Qt(t),o=JSON.stringify(r,(function(e,t){return t instanceof Date?t.toISOString():t}));localStorage.setItem(n,o),console.log("Successfully saved ".concat(r.length," cards for tab ").concat(e))}catch(n){console.error("Error saving cards for tab ".concat(e,":"),n),Xt(e,t,n)}}(i,a[i].storedCards)}catch(e){console.error("Error in tab storage middleware:",e)}break;case xe:n.payload?localStorage.setItem("current_card_id",n.payload):(localStorage.removeItem("current_card_id"),localStorage.removeItem("explicitly_saved"));break;case ie:0===e.getState().cards.storedCards.length&&e.dispatch({type:ge})}return r}}};var en=n(505),tn=n(417),nn=function(){return nn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},nn.apply(this,arguments)},rn=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},on=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},an=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},sn=function(){function e(e,t){this.aiService=e,this.apiKey=t,this.agents=this.initializeAgents()}return e.prototype.initializeAgents=function(){return{supervisor:{name:"Supervisor",role:"Управляющий агент",systemPrompt:"Ты - Supervisor AI Agent, который управляет процессом создания образовательных карточек.\n                Твоя задача - проанализировать текст и определить оптимальную стратегию создания карточек.\n                Ты координируешь работу других агентов и принимаешь решения о том, какие агенты должны работать и как.",execute:this.executeSupervisor.bind(this)},contentAnalyzer:{name:"Content Analyzer",role:"Анализатор контента",systemPrompt:"Ты - Content Analyzer Agent, эксперт по анализу образовательного контента.\n                Твоя задача - глубоко проанализировать текст, выделить ключевые концепции, определить связи между ними.\n                Ты определяешь что важно изучать и как это лучше структурировать для запоминания.",execute:this.executeContentAnalyzer.bind(this)},questionQuality:{name:"Question Quality",role:"Контролер качества вопросов",systemPrompt:'Ты - Question Quality Agent, эксперт по разумной оценке качества образовательных вопросов.\n\nТВОЯ ЗАДАЧА: \nОтфильтровывать только СЕРЬЕЗНО некачественные карточки, пропускать приемлемые.\n\nКРИТЕРИИ ОТКЛОНЕНИЯ (isWorthwhile: false) - ТОЛЬКО СЕРЬЕЗНЫЕ ПРОБЛЕМЫ:\n1. ПОЛНОЕ ДУБЛИРОВАНИЕ - вопрос и ответ идентичны по смыслу\n2. ТАВТОЛОГИЯ - ответ ничего не объясняет ("X это X")\n3. ФАКТИЧЕСКИЕ ОШИБКИ - неправильная информация\n4. ПОЛНАЯ БЕССМЫСЛИЦА - невозможно понять\n\nПРИМЕРЫ ПЛОХИХ КАРТОЧЕК (ОТКЛОНЯЙ):\n❌ "Что такое HTML?" → "HTML - это HTML" (ТАВТОЛОГИЯ)\n❌ "Что такое лев?" → "Лев - это лев" (ТАВТОЛОГИЯ)\n❌ Фактически неверная информация\n\nПРИМЕРЫ ПРИЕМЛЕМЫХ КАРТОЧЕК (ПРИНИМАЙ):\n✅ "Где живут львы?" → "Львы живут в Африке" (простой, но полезный факт)\n✅ "Что такое HTML?" → "HTML - язык разметки для веб-страниц" (базовое определение)\n✅ "Какие особенности у львов?" → "Грива у самцов, социальный образ жизни" (конкретные факты)\n\nОПТИМИЗИРОВАННЫЕ ТРЕБОВАНИЯ:\n- qualityScore < 5 → isWorthwhile: false (было 6, стало 5)\n- Только явная тавтология → серьезный штраф\n- Простые факты = приемлемы\n- Неточная информация → isWorthwhile: false\n\nБУДЬ РАЗУМНЫМ! Простая карточка лучше, чем отсутствие карточки.',execute:this.executeQuestionQuality.bind(this)},cardGenerator:{name:"Card Generator",role:"Генератор карточек",systemPrompt:'Ты - Card Generator Agent, эксперт по созданию высококачественных образовательных карточек.\n\nТВОЯ ГЛАВНАЯ ЗАДАЧА:\nСоздавать карточки, которые действительно помогают понять и запомнить материал.\n\nПРИНЦИПЫ КАЧЕСТВЕННЫХ КАРТОЧЕК:\n1. ИЗБЕГАЙ ОЧЕВИДНОГО - не создавай карточки где ответ содержится в вопросе\n2. СОЗДАВАЙ ПОНИМАНИЕ - вопросы должны проверять понимание, а не механическое запоминание\n3. БУДЬ КОНКРЕТНЫМ - избегай расплывчатых формулировок\n4. ДОБАВЛЯЙ КОНТЕКСТ - объясняй "почему" и "как", а не только "что"\n5. РАЗНООБРАЗЬ ТИПЫ - определения, примеры, применение, сравнения\n\nПЛОХИЕ ПРИМЕРЫ (НЕ ДЕЛАЙ ТАК):\n❌ "Какой вид хищных млекопитающих представляет собой лев?" → "Лев - вид хищных млекопитающих"\n❌ "Что такое фотосинтез?" → "Фотосинтез - это процесс фотосинтеза"\n\nХОРОШИЕ ПРИМЕРЫ:\n✅ "К какому семейству относится лев и какие особенности это определяют?" → "Лев относится к семейству кошачьих. Основные особенности: втяжные когти, клыки для захвата добычи, бинокулярное зрение для охоты, гибкое тело для прыжков"\n✅ "Почему львы живут прайдами, в отличие от других больших кошек?" → "Львы - единственные социальные большие кошки. Прайд помогает: совместно охотиться на крупную добычу, защищать территорию, воспитывать потомство"\n\nОБЯЗАТЕЛЬНЫЕ ТРЕБОВАНИЯ:\n- Каждый вопрос должен проверять ПОНИМАНИЕ, а не память\n- Ответы должны быть информативными и обучающими\n- Избегай дублирования слов из вопроса в ответе\n- Добавляй примеры и контекст где возможно',execute:this.executeCardGenerator.bind(this)},validator:{name:"Validator",role:"Валидатор и улучшатель",systemPrompt:"Ты - Validator Agent, эксперт по быстрой финальной проверке карточек.\n                Твоя задача - провести БЫСТРУЮ финальную оценку и дать только КРИТИЧЕСКИ важные рекомендации.\n                Сосредоточься только на серьезных проблемах качества, не придирайся к мелочам.\n                \n                ПРИНЦИПЫ БЫСТРОЙ ВАЛИДАЦИИ:\n                1. Только критические проблемы (ошибки фактов, неясности)\n                2. Максимум 1-2 конкретных улучшения если они ДЕЙСТВИТЕЛЬНО нужны\n                3. Если карточки приемлемы (6+/10) - просто одобряй\n                4. НЕ переписывай карточки полностью без крайней необходимости",execute:this.executeValidator.bind(this)},pageContentAnalyzer:{name:"Page Content Analyzer",role:"Анализатор мультимедийного контента страницы",systemPrompt:"Ты - Page Content Analyzer Agent, эксперт по анализу веб-страниц и мультимедийного контента.\n                Твоя задача - интеллектуально определить, какие элементы страницы (изображения, формулы, код) \n                должны быть включены в образовательную карточку для лучшего понимания материала.\n                Ты принимаешь решения на основе контекста и релевантности контента.",execute:this.executePageContentAnalyzer.bind(this)},contentEnhancer:{name:"Content Enhancer",role:"Интеллектуальный улучшатель контента карточек",systemPrompt:'Ты - Content Enhancer Agent, эксперт по созданию богатого мультимедийного образовательного контента.\n                Твоя главная задача - для КАЖДОЙ карточки ИНДИВИДУАЛЬНО определить, какой мультимедиа контент действительно поможет её пониманию.\n                НЕ добавляй контент "на всякий случай" - только если он ПРЯМО СВЯЗАН с темой конкретной карточки.\n                \n                ПРИНЦИПЫ РАБОТЫ:\n                1. Анализируй тему каждой карточки отдельно\n                2. Добавляй контент только при высокой релевантности (>7/10)\n                3. Предпочитай качество количеству\n                4. Учитывай контекст: теория, практика, математика, программирование',execute:this.executeContentEnhancer.bind(this)},cardContentMatcher:{name:"Card Content Matcher",role:"Аналитик соответствия контента карточкам",systemPrompt:"Ты - Card Content Matcher Agent, эксперт по анализу соответствия мультимедиа контента конкретным образовательным карточкам.\n                Твоя задача - точно определить, какой контент подходит к каждой карточке, основываясь на семантическом анализе и образовательной ценности.",execute:this.executeCardContentMatcher.bind(this)},textAnalyst:{name:"Text Analyst",role:"Аналитик текста и планировщик обучения",systemPrompt:"Ты - Text Analyst Agent, эксперт по глубокому анализу образовательного текста.\n                \n                ТВОЯ ГЛАВНАЯ ЗАДАЧА:\n                1. Анализируй размер и сложность текста\n                2. Определи основные темы и подтемы\n                3. Оцени, сколько карточек ДЕЙСТВИТЕЛЬНО нужно для понимания\n                4. Приоритизируй темы по важности\n                5. Учитывай наличие мультимедиа контента\n                \n                ПРИНЦИПЫ:\n                - Большой текст ≠ много карточек (только важные концепты)\n                - Качество > количества\n                - Фокус на ключевых знаниях для понимания темы\n                - Если есть изображения - ОБЯЗАТЕЛЬНО включай их в планирование",execute:this.executeTextAnalyst.bind(this)},cardPlanner:{name:"Card Planner",role:"Планировщик структуры карточек",systemPrompt:"Ты - Card Planner Agent, эксперт по планированию оптимальной структуры образовательных карточек.\n                \n                ТВОЯ ЗАДАЧА:\n                1. Получи анализ от Text Analyst\n                2. Создай детальный план карточек\n                3. Определи тип каждой карточки (концепт, пример, применение, сравнение)\n                4. Спланируй распределение мультимедиа контента\n                5. Оптимизируй количество карточек для эффективного обучения\n                \n                ТИПЫ КАРТОЧЕК:\n                - Основные концепты (с изображениями/схемами)\n                - Формулы и определения (с формулами)\n                - Примеры применения (с кодом/диаграммами)\n                - Сравнения и связи\n                - Практические вопросы",execute:this.executeCardPlanner.bind(this)},multimediaAssigner:{name:"Multimedia Assigner",role:"Распределитель мультимедиа контента",systemPrompt:"Ты - Multimedia Assigner Agent, эксперт по интеллектуальному распределению мультимедиа контента.\n                \n                ОСОБОЕ ВНИМАНИЕ К ИЗОБРАЖЕНИЯМ:\n                - Если пользователь выделил изображение - оно ДОЛЖНО попасть в карточку\n                - Изображения помогают лучше запомнить материал\n                - Каждое изображение должно иметь четкую образовательную цель\n                \n                ТВОЯ ЗАДАЧА:\n                1. Анализируй план карточек от Card Planner\n                2. Точно определи, какой мультимедиа контент к какой карточке подходит\n                3. ПРИОРИТЕТ: выделенные пользователем изображения\n                4. Обеспечь максимальную образовательную ценность",execute:this.executeMultimediaAssigner.bind(this)}}},e.prototype.createCardsFromText=function(e,t,n){var r,o,a,i,s;return rn(this,void 0,void 0,(function(){var l,c,u,d,f,p,g,h,m,y,v,x,b,w,S,C,E,k,I,A,_,T;return on(this,(function(j){switch(j.label){case 0:if(j.trys.push([0,16,,17]),console.log("🚀 AI Agent Workflow: Starting intelligent card creation with advanced analysis"),l={originalText:e,currentStep:"initialization",previousResults:{},metadata:{textLength:e.length,language:this.detectLanguage(e),topic:"",complexity:this.estimateComplexity(e)}},t?(l.previousResults.pageContext=t,console.log("📋 Page context: ".concat((null===(r=t.pageImages)||void 0===r?void 0:r.length)||0," images, ").concat((null===(o=t.formulas)||void 0===o?void 0:o.length)||0," formulas, ").concat((null===(a=t.codeBlocks)||void 0===a?void 0:a.length)||0," code blocks")),t.pageImages&&t.pageImages.length>0?(console.log("🖼️ Selected images details:"),t.pageImages.forEach((function(e,t){var n;console.log("  ".concat(t+1,'. "').concat(e.alt||"No alt",'" - ').concat((null===(n=e.src)||void 0===n?void 0:n.substring(0,50))||"No src","...")),console.log("      base64 available: ".concat(!!e.base64,", relevance: ").concat(e.relevanceScore))}))):console.log("⚠️ No images found in pageContext")):console.log("⚠️ No pageContext provided - no multimedia content available"),null==n?void 0:n.aborted)throw new Error("AI card creation was cancelled by user");return console.log("📊 Step 1: Deep text analysis and learning strategy"),l.currentStep="text_analysis",[4,this.agents.textAnalyst.execute({text:e,pageContext:t},l)];case 1:if(c=j.sent(),l.previousResults.textAnalysis=c,l.metadata.topic=(null===(i=c.mainTopics[0])||void 0===i?void 0:i.name)||"Общая тема",console.log("📋 Text analysis: ".concat(c.estimatedCards," cards recommended for ").concat(c.mainTopics.length," topics")),null==n?void 0:n.aborted)throw new Error("AI card creation was cancelled by user");return console.log("🎯 Step 2: Card structure planning"),l.currentStep="card_planning",[4,this.agents.cardPlanner.execute({textAnalysis:c,originalText:e,pageContext:t},l)];case 2:if(u=j.sent(),l.previousResults.cardPlan=u,console.log("📋 Card plan: ".concat(u.totalCards," cards planned with multimedia distribution")),null==n?void 0:n.aborted)throw new Error("AI card creation was cancelled by user");return d=null,t&&(t.pageImages.length>0||t.formulas.length>0||t.codeBlocks.length>0)?(console.log("🎨 Step 3: Intelligent multimedia assignment"),l.currentStep="multimedia_assignment",[4,this.agents.multimediaAssigner.execute({cardPlan:u,pageContext:t,originalText:e},l)]):[3,4];case 3:d=j.sent(),l.previousResults.multimediaDistribution=d,console.log("🎨 Multimedia assigned: ".concat((null===(s=null==d?void 0:d.assignments)||void 0===s?void 0:s.length)||0," assignments created")),j.label=4;case 4:if(null==n?void 0:n.aborted)throw new Error("AI card creation was cancelled by user");return console.log("🎯 Step 4: Structured card generation"),l.currentStep="card_generation",[4,this.agents.cardGenerator.execute({text:e,cardPlan:u,multimediaDistribution:d,textAnalysis:c},l)];case 5:if(f=j.sent(),l.previousResults.generatedCards=f,console.log("🎯 Generated ".concat(f.length," cards based on plan")),null==n?void 0:n.aborted)throw new Error("AI card creation was cancelled by user");console.log("🔍 Step 5: Question quality validation"),l.currentStep="quality_check",p=[],g=0,h=f,j.label=6;case 6:if(!(g<h.length))return[3,9];if(m=h[g],null==n?void 0:n.aborted)throw new Error("AI card creation was cancelled by user");return[4,this.agents.questionQuality.execute(m,l)];case 7:y=j.sent(),p.push(y),j.label=8;case 8:return g++,[3,6];case 9:if(l.previousResults.qualityResults=p,v=f.filter((function(e,t){var n=p[t],r=n.isWorthwhile&&n.qualityScore>=5&&n.relevanceScore>=5;return r||(console.log("❌ Card ".concat(t+1," rejected: Q=").concat(n.qualityScore,", R=").concat(n.relevanceScore,", W=").concat(n.isWorthwhile)),console.log("   Reason: ".concat(n.reasoning)),console.log("   Issues: ".concat(n.issues.join(", ")))),r})),console.log("✅ Quality filter: ".concat(v.length,"/").concat(f.length," cards passed optimized quality check")),0===v.length&&f.length>0&&(console.log("🚨 All cards rejected by quality filter! Creating fallback quality card"),x={front:"Какие ключевые концепты раскрывает данный материал?",back:"Материал раскрывает следующие концепты: ".concat(e.substring(0,200),"... (требует дополнительного анализа для создания более конкретных вопросов)"),tags:[l.metadata.topic||"общее"],difficulty:"medium",concept:"Общий анализ материала"},v.push(x),console.log("✅ Fallback card created to ensure user gets at least one card")),null==n?void 0:n.aborted)throw new Error("AI card creation was cancelled by user");if(b=v,w=t&&t.pageImages&&t.pageImages.length>0,console.log("🖼️ Selected images available: ".concat(w?null==t?void 0:t.pageImages.length:0)),w?(console.log("🎨 Step 6: Applying multimedia to quality cards"),d&&d.assignments.length>0?(console.log("📊 Using intelligent multimedia distribution"),b=v.map((function(e,n){var r,o=null===(r=u.cardSpecs[n])||void 0===r?void 0:r.id,a=null==d?void 0:d.assignments.find((function(e){return e.cardId===o}));if(a){var i=nn({},e);if(a.imageIndices.length>0&&(i.attachedImages=a.imageIndices.map((function(e){return null==t?void 0:t.pageImages[e]})).filter(Boolean)),a.formulaIndices.length>0&&(i.attachedFormulas=a.formulaIndices.map((function(e){return null==t?void 0:t.formulas[e]})).filter(Boolean)),a.codeIndices.length>0&&(i.attachedCode=a.codeIndices.map((function(e){return null==t?void 0:t.codeBlocks[e]})).filter(Boolean)),console.log("🎨 Card ".concat(n+1,": added ").concat(a.imageIndices.length," images, ").concat(a.formulaIndices.length," formulas, ").concat(a.codeIndices.length," code blocks")),i.attachedImages&&i.attachedImages.length>0){var s=i.attachedImages[0];s.base64?(i.image=s.base64,console.log("📱 Установлено image для предпросмотра карточки",n+1)):s.src&&(i.imageUrl=s.src,console.log("📱 Установлено imageUrl для предпросмотра карточки",n+1))}return i}return e}))):(console.log("🚨 No multimedia distribution found, using fallback logic to ensure images are included"),console.log("🖼️ Forcing inclusion of ".concat(null==t?void 0:t.pageImages.length," selected images")),b.length>0&&(null==t?void 0:t.pageImages.length)>0&&(S=t.pageImages[0],b[0]=nn(nn({},b[0]),{attachedImages:t.pageImages,image:S.base64||null,imageUrl:S.src||null}),console.log("🎯 FALLBACK: Added all ".concat(t.pageImages.length," images to first card")),console.log("📱 FALLBACK: Установлено image/imageUrl для предпросмотра первой карточки")),b.length>1&&(null==t?void 0:t.pageImages.length)>1&&(C=Math.ceil(t.pageImages.length/b.length),b=b.map((function(e,n){var r=n*C,o=Math.min(r+C,t.pageImages.length),a=t.pageImages.slice(r,o);if(a.length>0){console.log("🎯 FALLBACK: Added ".concat(a.length," images to card ").concat(n+1));var i=a[0];return nn(nn({},e),{attachedImages:a,image:i.base64||null,imageUrl:i.src||null})}return e})))),E=b.reduce((function(e,t){var n;return e+((null===(n=t.attachedImages)||void 0===n?void 0:n.length)||0)}),0),console.log("✅ Total images attached to cards: ".concat(E,"/").concat((null==t?void 0:t.pageImages.length)||0)),0===E&&(null==t?void 0:t.pageImages.length)>0&&(console.log("🚨 CRITICAL: No images were attached despite having selected images!"),console.log("🎯 Emergency fallback: Adding all images to all cards"),b=b.map((function(e,n){var r=t.pageImages[0];return nn(nn({},e),{attachedImages:t.pageImages,image:r.base64||null,imageUrl:r.src||null})})),console.log("🎯 Emergency: Added ".concat(t.pageImages.length," images to ").concat(b.length," cards")))):console.log("ℹ️ No selected images to apply"),k=b,I=b.length<2||b.some((function(e){return e.front.length<10||e.back.length<20})),!I)return[3,14];console.log("🔬 Step 7: Quick final validation (detected potential issues)"),l.currentStep="final_validation",j.label=10;case 10:return j.trys.push([10,12,,13]),[4,this.agents.validator.execute({cards:b,originalText:e,context:l},l)];case 11:return(A=j.sent()).improvedCards&&A.overallScore>80?(k=A.improvedCards,console.log("🔧 Applied validator improvements (score: ".concat(A.overallScore,")"))):console.log("⏭️ Skipped validator improvements (score: ".concat(A.overallScore,")")),[3,13];case 12:return _=j.sent(),console.log("⚠️ Validator failed, using cards as-is:",_),[3,13];case 13:return[3,15];case 14:console.log("⏭️ Step 7: Skipped validation - cards appear good quality"),j.label=15;case 15:return console.log("🎉 Workflow completed: ".concat(k.length," high-quality cards created")),[2,this.convertToStoredCards(k,e)];case 16:throw T=j.sent(),console.error("❌ Error in AI agent workflow:",T),T;case 17:return[2]}}))}))},e.prototype.executeSupervisor=function(e,t){return rn(this,void 0,void 0,(function(){var n,r,o;return on(this,(function(a){switch(a.label){case 0:n='Ты - Supervisor AI Agent. Проанализируй текст и определи оптимальную стратегию создания карточек.\n\nТЕКСТ: "'.concat(e,'"\n\nКОНТЕКСТ:\n- Длина: ').concat(t.metadata.textLength," символов\n- Сложность: ").concat(t.metadata.complexity,"\n- Язык: ").concat(t.metadata.language,'\n\nТВОЯ ЗАДАЧА:\n1. Определи стратегию обучения (single_concept, multiple_concepts, step_by_step, comparison)\n2. Реши какие агенты должны работать и как\n3. Дай четкие инструкции каждому агенту\n4. Определи ожидаемый результат\n\nСТРАТЕГИИ:\n- single_concept: один ключевой концепт\n- multiple_concepts: несколько независимых концептов  \n- step_by_step: пошаговый процесс или алгоритм\n- comparison: сравнение или противопоставление\n\nJSON ответ:\n{\n  "strategy": "step_by_step",\n  "agents": ["contentAnalyzer", "cardGenerator", "questionQuality", "validator"],\n  "instructions": {\n    "contentAnalyzer": "Выдели основные шаги процесса и их последовательность",\n    "cardGenerator": "Создай карточки для каждого шага с акцентом на практическое применение",\n    "questionQuality": "Проверь что каждый вопрос помогает понять последовательность действий",\n    "validator": "Убедись что карточки образуют логическую последовательность обучения"\n  },\n  "expectedOutput": "Набор карточек покрывающих пошаговый процесс",\n  "reasoning": "Текст описывает процедуру, лучше изучать по шагам"\n}'),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.supervisor.systemPrompt},{role:"user",content:n}])];case 2:if(!(null==(r=a.sent())?void 0:r.content))throw new Error("No response from supervisor agent");return[2,this.parseJSONResponse(r.content,"supervisor")];case 3:return o=a.sent(),console.error("Supervisor agent error:",o),[2,this.createFallbackSupervisorDecision()];case 4:return[2]}}))}))},e.prototype.executeContentAnalyzer=function(e,t){var n,r;return rn(this,void 0,void 0,(function(){var o,a,i,s;return on(this,(function(l){switch(l.label){case 0:o=(null===(r=null===(n=t.previousResults.supervisor)||void 0===n?void 0:n.instructions)||void 0===r?void 0:r.contentAnalyzer)||"Проведи глубокий анализ контента",a='Ты - Content Analyzer Agent. Глубоко проанализируй образовательный контент.\n\nТЕКСТ: "'.concat(e,'"\n\nИНСТРУКЦИИ ОТ SUPERVISOR: ').concat(o,'\n\nТВОЯ ЗАДАЧА:\n1. Определи основную тему и ключевые понятия\n2. Выяви связи между концептами\n3. Определи цели обучения\n4. Оцени сложность материала\n5. Оцени сколько карточек нужно\n\nJSON ответ:\n{\n  "mainTopic": "Основная тема",\n  "keyPoints": ["пункт1", "пункт2"],\n  "concepts": [\n    {\n      "name": "Концепт1",\n      "definition": "Определение",\n      "importance": "high",\n      "prerequisites": ["предпосылка1"],\n      "examples": ["пример1"]\n    }\n  ],\n  "relationships": [\n    {\n      "from": "Концепт1",\n      "to": "Концепт2", \n      "type": "depends_on"\n    }\n  ],\n  "learningObjectives": ["цель1", "цель2"],\n  "complexity": "medium",\n  "estimatedCards": 3\n}'),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.contentAnalyzer.systemPrompt},{role:"user",content:a}])];case 2:if(!(null==(i=l.sent())?void 0:i.content))throw new Error("No response from content analyzer agent");return[2,this.parseJSONResponse(i.content,"contentAnalyzer")];case 3:return s=l.sent(),console.error("Content analyzer error:",s),[2,this.createFallbackContentAnalysis(e)];case 4:return[2]}}))}))},e.prototype.executeCardGenerator=function(e,t){var n,r,o,a;return rn(this,void 0,void 0,(function(){var t,i,s,l,c,u,d,f;return on(this,(function(p){switch(p.label){case 0:t=e.text,i=e.cardPlan,s=e.textAnalysis,e.multimediaDistribution,l=e.analysis,c=e.instructions,u=i&&s?'Ты - Card Generator Agent. Создай высококачественные образовательные карточки ТОЧНО по плану.\n\nТЕКСТ: "'.concat(t,'"\n\nАНАЛИЗ ТЕКСТА:\n- Основные темы: ').concat(s.mainTopics.map((function(e){return e.name})).join(", "),"\n- Рекомендуемые карточки: ").concat(s.estimatedCards,"\n- Сложность: ").concat(s.complexity,"\n- Мультимедиа доступно: ").concat(s.hasMultimedia?"ДА":"НЕТ","\n\nПЛАН КАРТОЧЕК (СЛЕДУЙ ТОЧНО):\n").concat(i.cardSpecs.map((function(e,t){return"\nКарточка ".concat(t+1," (").concat(e.id,"):\n- Тип: ").concat(e.type,"\n- Тема: ").concat(e.topic,"\n- Приоритет: ").concat(e.priority,"\n- Сложность: ").concat(e.difficulty,"\n- Описание: ").concat(e.description,"\n- Нужен мультимедиа: ").concat(e.needsMultimedia?"ДА":"НЕТ","\n")})).join(""),'\n\nКРИТИЧЕСКИЕ ТРЕБОВАНИЯ К КАЧЕСТВУ:\n1. НИКОГДА НЕ ДУБЛИРУЙ ключевые слова из вопроса в ответе\n2. Вопросы должны проверять ПОНИМАНИЕ, не память\n3. Ответы должны быть ИНФОРМАТИВНЫМИ и ОБУЧАЮЩИМИ\n4. Добавляй КОНТЕКСТ и ОБЪЯСНЕНИЯ\n5. Избегай ОЧЕВИДНЫХ вопросов\n\nПЛОХИЕ ПРИМЕРЫ (НЕ ДЕЛАЙ ТАК):\n❌ "Что такое лев?" → "Лев - это лев"\n❌ "Какой вид млекопитающих лев?" → "Лев - вид хищных млекопитающих"\n❌ "Где живут львы?" → "Львы живут в Африке"\n\nХОРОШИЕ ПРИМЕРЫ:\n✅ "Почему львы единственные социальные большие кошки?" → "Львы живут прайдами для совместной охоты на крупную добычу, защиты территории и воспитания потомства. Другие большие кошки (тигры, леопарды) - одиночки"\n✅ "Какие адаптации помогают львам охотиться в группе?" → "Специализация ролей: самки-охотницы используют скрытность и координацию, самцы защищают прайд. Развитая коммуникация через рык и жесты"\n\nТВОЯ ЗАДАЧА:\n1. Создай РОВНО ').concat(i.totalCards,' карточек по плану\n2. Каждая карточка должна соответствовать своему CardSpec\n3. НЕ добавляй мультимедиа сейчас - это будет сделано отдельно\n4. Сосредоточься на качественном содержании\n5. ПРОВЕРЬ каждую карточку на дублирование слов\n\nJSON ответ:\n{\n  "cards": [\n    {\n      "front": "Вопрос для карточки 1 (БЕЗ дублирования ключевых слов из ответа)",\n      "back": "Информативный ответ с контекстом и объяснениями",\n      "tags": ["').concat((null===(n=s.mainTopics[0])||void 0===n?void 0:n.name)||"общее",'"],\n      "difficulty": "medium",\n      "concept": "').concat((null===(r=i.cardSpecs[0])||void 0===r?void 0:r.topic)||"концепт",'"\n    }\n  ]\n}'):'Ты - Card Generator Agent. Создай высококачественные образовательные карточки.\n\nТЕКСТ: "'.concat(t,'"\n\nАНАЛИЗ КОНТЕНТА:\n- Тема: ').concat((null==l?void 0:l.mainTopic)||"Общая тема","\n- Ключевые понятия: ").concat((null===(o=null==l?void 0:l.concepts)||void 0===o?void 0:o.map((function(e){return e.name})).join(", "))||"Основные концепты","\n- Цели обучения: ").concat((null===(a=null==l?void 0:l.learningObjectives)||void 0===a?void 0:a.join(", "))||"Изучение материала","\n- Сложность: ").concat((null==l?void 0:l.complexity)||"medium","\n\nИНСТРУКЦИИ: ").concat(c||"Создай качественные образовательные карточки",'\n\nКРИТИЧЕСКИЕ ТРЕБОВАНИЯ К КАЧЕСТВУ:\n1. НИКОГДА НЕ ДУБЛИРУЙ ключевые слова из вопроса в ответе\n2. Вопросы должны проверять ПОНИМАНИЕ, не память\n3. Ответы должны быть ИНФОРМАТИВНЫМИ и ОБУЧАЮЩИМИ\n4. Добавляй КОНТЕКСТ и ОБЪЯСНЕНИЯ\n5. Избегай ОЧЕВИДНЫХ вопросов\n\nПЛОХИЕ ПРИМЕРЫ (НЕ ДЕЛАЙ ТАК):\n❌ "Что такое HTML?" → "HTML - это HTML"\n❌ "Какой язык программирования Python?" → "Python - язык программирования"\n❌ "Где используется JavaScript?" → "JavaScript используется в веб-разработке"\n\nХОРОШИЕ ПРИМЕРЫ:\n✅ "Почему Python считается подходящим для начинающих программистов?" → "Python имеет простой синтаксис, близкий к английскому языку, автоматическое управление памятью, богатую стандартную библиотеку и активное сообщество"\n✅ "Какие преимущества дает использование JavaScript на сервере?" → "Node.js позволяет использовать один язык для фронтенда и бэкенда, имеет высокую производительность благодаря V8, большую экосистему npm пакетов"\n\nПРИНЦИПЫ КАЧЕСТВЕННЫХ КАРТОЧЕК:\n1. Один вопрос - один концепт\n2. Четкие, конкретные вопросы БЕЗ дублирования\n3. Полные, точные ответы с контекстом\n4. Практическая применимость\n5. Прогрессивная сложность\n\nJSON ответ:\n{\n  "cards": [\n    {\n      "front": "Четкий вопрос БЕЗ дублирования ключевых слов",\n      "back": "Полный информативный ответ с объяснениями",\n      "tags": ["тег1"],\n      "difficulty": "medium",\n      "concept": "Название концепта"\n    }\n  ]\n}'),p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.cardGenerator.systemPrompt},{role:"user",content:u}])];case 2:if(!(null==(d=p.sent())?void 0:d.content))throw new Error("No response from card generator agent");return[2,this.parseJSONResponse(d.content,"cardGenerator").cards||[]];case 3:return f=p.sent(),console.error("Card generator error:",f),[2,this.createFallbackCards(t)];case 4:return[2]}}))}))},e.prototype.executeQuestionQuality=function(e,t){return rn(this,void 0,void 0,(function(){var n,r,o;return on(this,(function(a){switch(a.label){case 0:n='Ты - Question Quality Agent. СТРОГО оцени качество образовательного вопроса.\n\nКАРТОЧКА ДЛЯ АНАЛИЗА:\nВопрос: "'.concat(e.front,'"\nОтвет: "').concat(e.back,'"\nКонцепт: ').concat(e.concept||"не указан",'\n\nОРИГИНАЛЬНЫЙ ТЕКСТ: "').concat(t.originalText.substring(0,500),'..."\n\nКРИТИЧЕСКИЙ АНАЛИЗ:\n1. ПРОВЕРЬ НА ДУБЛИРОВАНИЕ:\n   - Есть ли одинаковые ключевые слова в вопросе и ответе?\n   - Повторяет ли ответ формулировку вопроса?\n\n2. ПРОВЕРЬ ОБРАЗОВАТЕЛЬНУЮ ЦЕННОСТЬ:\n   - Учит ли что-то новое?\n   - Проверяет ли понимание, а не память?\n   - Добавляет ли контекст и объяснения?\n\n3. ПРОВЕРЬ КАЧЕСТВО ФОРМУЛИРОВКИ:\n   - Ясен ли вопрос?\n   - Полон ли ответ?\n   - Есть ли конкретные детали?\n\nШКАЛА ОЦЕНКИ:\n- 9-10: Отличная карточка, учит и проверяет понимание\n- 7-8: Хорошая карточка с небольшими недостатками\n- 5-6: Посредственная карточка, требует улучшений\n- 3-4: Плохая карточка, серьезные проблемы\n- 1-2: Очень плохая карточка, бесполезна\n\nАВТОМАТИЧЕСКОЕ ОТКЛОНЕНИЕ (isWorthwhile: false) ЕСЛИ:\n- Вопрос содержит те же ключевые слова что и ответ\n- Ответ просто переформулирует вопрос\n- Качество меньше 6 баллов\n- Нет образовательной ценности\n\nJSON ответ:\n{\n  "question": "').concat(e.front,'",\n  "answer": "').concat(e.back,'",\n  "qualityScore": 3,\n  "relevanceScore": 4,\n  "difficultyScore": 2,\n  "issues": ["Дублирование ключевых слов", "Ответ повторяет вопрос", "Нет образовательной ценности"],\n  "improvements": ["Переформулировать вопрос", "Добавить контекст в ответ", "Сделать вопрос более конкретным"],\n  "isWorthwhile": false,\n  "reasoning": "Карточка отклонена из-за дублирования: вопрос \'Какой вид хищных млекопитающих представляет собой лев?\' и ответ \'Лев - вид хищных млекопитающих\' содержат одинаковые слова. Нет образовательной ценности."\n}'),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.questionQuality.systemPrompt},{role:"user",content:n}])];case 2:if(!(null==(r=a.sent())?void 0:r.content))throw new Error("No response from question quality agent");return[2,this.parseJSONResponse(r.content,"questionQuality")];case 3:return o=a.sent(),console.error("Question quality error:",o),[2,this.createFallbackQualityCheck(e)];case 4:return[2]}}))}))},e.prototype.executeValidator=function(e,t){return rn(this,void 0,void 0,(function(){var t,n,r,o,a;return on(this,(function(i){switch(i.label){case 0:t=e.cards,n=e.originalText,r='Ты - Validator Agent. Проведи БЫСТРУЮ финальную проверку карточек.\n\nОРИГИНАЛЬНЫЙ ТЕКСТ: "'.concat(n.substring(0,300),'..."\n\nКАРТОЧКИ (').concat(t.length," шт):\n").concat(t.map((function(e,t){return"\n".concat(t+1,". Q: ").concat(e.front,"\n   A: ").concat(e.back,"\n")})).join(""),'\n\nБЫСТРАЯ ПРОВЕРКА:\n1. Есть ли критические ошибки? (фактические, логические)\n2. Понятны ли карточки?\n3. Имеют ли образовательную ценность?\n\nПРАВИЛА:\n- Если карточки приемлемы (70+) → не предлагай улучшений\n- Только критические проблемы требуют исправления\n- НЕ переписывай карточки без серьезной необходимости\n\nJSON ответ:\n{\n  "isValid": true,\n  "overallScore": 75,\n  "cardScores": {0: 75, 1: 80},\n  "issues": [],\n  "suggestions": [],\n  "improvedCards": null,\n  "finalRecommendation": "Карточки приемлемого качества"\n}'),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.validator.systemPrompt},{role:"user",content:r}])];case 2:if(!(null==(o=i.sent())?void 0:o.content))throw new Error("No response from validator agent");return[2,this.parseJSONResponse(o.content,"validator")];case 3:return a=i.sent(),console.error("Validator error:",a),[2,this.createFallbackValidation(t)];case 4:return[2]}}))}))},e.prototype.executePageContentAnalyzer=function(e,t){var n,r,o;return rn(this,void 0,void 0,(function(){var t,a,i,s,l,c,u,d,f;return on(this,(function(p){switch(p.label){case 0:t=e.text,a=e.pageContext,i='Ты - Page Content Analyzer Agent. Проанализируй страницу и определи, какие элементы помогут в обучении.\n\nВЫДЕЛЕННЫЙ ТЕКСТ: "'.concat(t,'"\n\nКОНТЕНТ СТРАНИЦЫ:\nИзображения (').concat(a.pageImages.length,"):\n").concat(a.pageImages.map((function(e,t){return"".concat(t+1,". ").concat(e.alt||"Без описания"," (").concat(e.isNearText?"рядом с текстом":"далеко от текста",")")})).join("\n"),"\n\nФормулы (").concat(a.formulas.length,"):\n").concat(a.formulas.map((function(e,t){return"".concat(t+1,". ").concat(e.text," (").concat(e.type,")")})).join("\n"),"\n\nКод (").concat(a.codeBlocks.length,"):\n").concat(a.codeBlocks.map((function(e,t){return"".concat(t+1,". ").concat(e.language||"unknown",": ").concat(e.code.substring(0,100),"...")})).join("\n"),'\n\nТВОЯ ЗАДАЧА:\n1. Определи, какие изображения релевантны для понимания текста\n2. Определи, какие формулы важны для объяснения\n3. Определи, какие блоки кода нужны для примеров\n4. Обоснуй каждое решение\n\nКРИТЕРИИ ОТБОРА:\n- Изображения: диаграммы, схемы, иллюстрации концептов\n- Формулы: математические выражения, связанные с текстом\n- Код: примеры, алгоритмы, упомянутые в тексте\n\nJSON ответ:\n{\n  "shouldIncludeImages": true,\n  "selectedImages": [0, 2],\n  "shouldIncludeFormulas": false,\n  "selectedFormulas": [],\n  "shouldIncludeCode": true,\n  "selectedCode": [0],\n  "reasoning": "Изображение 1 и 3 иллюстрируют основные концепты. Код показывает практическое применение."\n}'),p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.pageContentAnalyzer.systemPrompt},{role:"user",content:i}])];case 2:if(!(null==(s=p.sent())?void 0:s.content))throw new Error("No response from page content analyzer agent");return l=this.parseJSONResponse(s.content,"pageContentAnalyzer"),c=(null===(n=l.selectedImages)||void 0===n?void 0:n.map((function(e){return a.pageImages[e]})).filter(Boolean))||[],u=(null===(r=l.selectedFormulas)||void 0===r?void 0:r.map((function(e){return a.formulas[e]})).filter(Boolean))||[],d=(null===(o=l.selectedCode)||void 0===o?void 0:o.map((function(e){return a.codeBlocks[e]})).filter(Boolean))||[],[2,{shouldIncludeImages:l.shouldIncludeImages||!1,selectedImages:c,shouldIncludeFormulas:l.shouldIncludeFormulas||!1,selectedFormulas:u,shouldIncludeCode:l.shouldIncludeCode||!1,selectedCode:d,reasoning:l.reasoning||"No reasoning provided"}];case 3:return f=p.sent(),console.error("Page content analyzer error:",f),[2,this.createFallbackContentEnhancement()];case 4:return[2]}}))}))},e.prototype.executeContentEnhancer=function(e,t){var n;return rn(this,void 0,void 0,(function(){var t,r,o,a,i,s,l,c,u,d,f=this;return on(this,(function(p){switch(p.label){case 0:t=e.cards,r=e.contentEnhancement,o=e.originalText,a=e.contentMatches,i=a&&a.cardMatches&&a.cardMatches.length>0,s="Ты - Content Enhancer Agent. Улучши карточки на основе ТОЧНОГО анализа соответствия контента.\n\n".concat(i?"СПЕЦИАЛЬНЫЕ ИНСТРУКЦИИ: Используй ТОЧНЫЕ РЕЗУЛЬТАТЫ анализа соответствия - добавляй контент только к тем карточкам, где это прямо указано.":"ОБЩИЕ ИНСТРУКЦИИ: Анализируй каждую карточку индивидуально.",'\n\nОРИГИНАЛЬНЫЙ ТЕКСТ: "').concat(o,'"\n\nКАРТОЧКИ (').concat(t.length,"):\n").concat(t.map((function(e,t){return"\nКарточка ".concat(t+1,":\nВопрос: ").concat(e.front,"\nОтвет: ").concat(e.back,"\nТема: ").concat(f.extractCardTopic(e.front,e.back),"\n").concat(i?"Рекомендованный контент: ".concat(f.getMatchedContentForCard(t,a)):"","\n")})).join(""),"\n\nДОСТУПНЫЙ КОНТЕНТ:\n").concat(r.shouldIncludeImages?"Изображения (".concat(r.selectedImages.length,"):\n").concat(r.selectedImages.map((function(e,t){return"".concat(t+1,'. "').concat(e.alt||"без описания",'" (релевантность: ').concat(e.relevanceScore,"/10)")})).join("\n")):"Изображения: отсутствуют","\n\n").concat(r.shouldIncludeFormulas?"Формулы (".concat(r.selectedFormulas.length,"):\n").concat(r.selectedFormulas.map((function(e,t){return"".concat(t+1,'. "').concat(e.text,'" (релевантность: ').concat(e.relevanceScore,"/10)")})).join("\n")):"Формулы: отсутствуют","\n\n").concat(r.shouldIncludeCode?"Код (".concat(r.selectedCode.length,"):\n").concat(r.selectedCode.map((function(e,t){return"".concat(t+1,". ").concat(e.language||"text",': "').concat(e.code.substring(0,60),'..." (релевантность: ').concat(e.relevanceScore,"/10)")})).join("\n")):"Код: отсутствует","\n\n").concat(i?"\nРЕЗУЛЬТАТЫ АНАЛИЗА СООТВЕТСТВИЯ:\n".concat(a.cardMatches.map((function(e){return"\nКарточка ".concat(e.cardIndex+1,":\n- Изображения: [").concat(e.relevantImages.join(", "),"]\n- Формулы: [").concat(e.relevantFormulas.join(", "),"] \n- Код: [").concat(e.relevantCode.join(", "),"]\n- Обоснование: ").concat(e.reasoning,"\n")})).join(""),"\n\nСТРОГО СЛЕДУЙ РЕЗУЛЬТАТАМ АНАЛИЗА! Добавляй контент только к указанным карточкам."):'\nПРАВИЛА САМОСТОЯТЕЛЬНОГО АНАЛИЗА:\n1. Анализируй каждую карточку отдельно\n2. Добавляй контент только при релевантности ≥8/10\n3. Учитывай тематику: математика→формулы, код→программирование, процессы→схемы\n4. НЕ добавляй контент "на всякий случай"','\n\nJSON ответ:\n{\n  "enhancedCards": [\n    {\n      "front": "Что такое фотосинтез?",\n      "back": "Фотосинтез - это процесс преобразования углекислого газа и воды в глюкозу с помощью солнечного света.\n\n[IMAGE:0]\n\nХимическая формула: [FORMULA:0]",\n      "multimedia": {\n        "images": [0],\n        "formulas": [0], \n        "code": []\n      },\n      "reasoning": "Добавил схему фотосинтеза и химическую формулу, так как они прямо иллюстрируют процесс"\n    },\n    {\n      "front": "Какие факторы влияют на скорость фотосинтеза?",\n      "back": "Температура, освещенность, концентрация CO2 и доступность воды влияют на скорость фотосинтеза.",\n      "multimedia": {\n        "images": [],\n        "formulas": [],\n        "code": []\n      },\n      "reasoning": "Эта карточка о факторах - не нужен мультимедиа контент, текст достаточно ясен"\n    }\n  ]\n}\n\nВАЖНО: Используй плейсхолдеры [IMAGE:N], [FORMULA:N], [CODE:N] только когда контент ДЕЙСТВИТЕЛЬНО нужен для этой конкретной карточки.'),p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.contentEnhancer.systemPrompt},{role:"user",content:s}])];case 2:if(!(null==(l=p.sent())?void 0:l.content))throw new Error("No response from content enhancer agent");return c=this.parseJSONResponse(l.content,"contentEnhancer"),console.log("🎨 Content enhancer parsed result:",c),u=(null===(n=c.enhancedCards)||void 0===n?void 0:n.map((function(e,t){var n,o,a,i,s,l,c,u,d,f,p,g,h=e.back;console.log("🔧 Обработка карточки ".concat(t+1,": ").concat(e.front)),console.log("📋 Мультимедиа для карточки:",e.multimedia);var m=h.match(/\[IMAGE:(\d+)\]/g);m&&(console.log("🔍 Найдены плейсхолдеры изображений в карточке ".concat(t+1,":"),m),m.forEach((function(e){var n=e.match(/\[IMAGE:(\d+)\]/);if(n){var o=parseInt(n[1]),a=r.selectedImages[o];if(console.log("🔄 Замена ".concat(e," на изображение ").concat(o," в карточке ").concat(t+1,":"),(null==a?void 0:a.src)||"НЕ НАЙДЕНО"),a){var i=a.base64||a.src;console.log("🖼️ Используем ".concat(a.base64?"base64":"URL"," для изображения в карточке ").concat(t+1));var s=a.alt&&""!==a.alt.trim()?a.alt:"";h=h.replace(e,"\n![".concat(s,"](").concat(i,")\n"))}else console.warn("⚠️ Изображение с индексом ".concat(o," не найдено в selectedImages")),h=h.replace(e,"")}})));var y=h.match(/\[FORMULA:(\d+)\]/g);y&&(console.log("🔍 Найдены плейсхолдеры формул в карточке ".concat(t+1,":"),y),y.forEach((function(e){var n=e.match(/\[FORMULA:(\d+)\]/);if(n){var o=parseInt(n[1]),a=r.selectedFormulas[o];console.log("🔄 Замена ".concat(e," на формулу ").concat(o," в карточке ").concat(t+1,":"),(null==a?void 0:a.text)||"НЕ НАЙДЕНО"),a?h=h.replace(e,"\n$$".concat(a.text,"$$\n")):(console.warn("⚠️ Формула с индексом ".concat(o," не найдена в selectedFormulas")),h=h.replace(e,""))}})));var v=h.match(/\[CODE:(\d+)\]/g);return v&&(console.log("🔍 Найдены плейсхолдеры кода в карточке ".concat(t+1,":"),v),v.forEach((function(e){var n,o=e.match(/\[CODE:(\d+)\]/);if(o){var a=parseInt(o[1]),i=r.selectedCode[a];console.log("🔄 Замена ".concat(e," на код ").concat(a," в карточке ").concat(t+1,":"),(null===(n=null==i?void 0:i.code)||void 0===n?void 0:n.substring(0,30))||"НЕ НАЙДЕНО"),i?h=h.replace(e,"\n```".concat(i.language||"","\n").concat(i.code,"\n```\n")):(console.warn("⚠️ Код с индексом ".concat(a," не найден в selectedCode")),h=h.replace(e,""))}}))),h=h.replace(/\n{3,}/g,"\n\n"),console.log("✅ Карточка ".concat(t+1," обработана. Мультимедиа:"),{images:(null===(o=null===(n=e.multimedia)||void 0===n?void 0:n.images)||void 0===o?void 0:o.length)||0,formulas:(null===(i=null===(a=e.multimedia)||void 0===a?void 0:a.formulas)||void 0===i?void 0:i.length)||0,code:(null===(l=null===(s=e.multimedia)||void 0===s?void 0:s.code)||void 0===l?void 0:l.length)||0}),nn(nn({},e),{back:h,multimedia:e.multimedia,attachedImages:(null===(u=null===(c=e.multimedia)||void 0===c?void 0:c.images)||void 0===u?void 0:u.map((function(e){return r.selectedImages[e]})).filter(Boolean))||[],attachedFormulas:(null===(f=null===(d=e.multimedia)||void 0===d?void 0:d.formulas)||void 0===f?void 0:f.map((function(e){return r.selectedFormulas[e]})).filter(Boolean))||[],attachedCode:(null===(g=null===(p=e.multimedia)||void 0===p?void 0:p.code)||void 0===g?void 0:g.map((function(e){return r.selectedCode[e]})).filter(Boolean))||[]})})))||t,console.log("🎉 Content Enhancement завершен. Обработано ".concat(u.length," карточек")),[2,{enhancedCards:u}];case 3:return d=p.sent(),console.error("Content enhancer error:",d),[2,{enhancedCards:t}];case 4:return[2]}}))}))},e.prototype.executeCardContentMatcher=function(e,t){return rn(this,void 0,void 0,(function(){var t,n,r,o,a,i,s,l=this;return on(this,(function(c){switch(c.label){case 0:t=e.cards,n=e.contentEnhancement,r=e.originalText,o='Ты - Card Content Matcher Agent. Проанализируй каждую карточку и точно определи, какой мультимедиа контент ей подходит.\n\nОРИГИНАЛЬНЫЙ ТЕКСТ: "'.concat(r,'"\n\nКАРТОЧКИ ДЛЯ АНАЛИЗА (').concat(t.length,"):\n").concat(t.map((function(e,t){return"\nКарточка ".concat(t+1,":\nВопрос: ").concat(e.front,"\nОтвет: ").concat(e.back,"\nТема: ").concat(l.extractCardTopic(e.front,e.back),"\n")})).join(""),"\n\nДОСТУПНЫЙ КОНТЕНТ:\n").concat(n.shouldIncludeImages?"Изображения (".concat(n.selectedImages.length,"):\n").concat(n.selectedImages.map((function(e,t){return"".concat(t+1,'. Alt: "').concat(e.alt||"без описания",'" | Релевантность: ').concat(e.relevanceScore,"/10")})).join("\n")):"Изображения: отсутствуют","\n\n").concat(n.shouldIncludeFormulas?"Формулы (".concat(n.selectedFormulas.length,"):\n").concat(n.selectedFormulas.map((function(e,t){return"".concat(t+1,'. "').concat(e.text,'" | Релевантность: ').concat(e.relevanceScore,"/10")})).join("\n")):"Формулы: отсутствуют","\n\n").concat(n.shouldIncludeCode?"Код (".concat(n.selectedCode.length,"):\n").concat(n.selectedCode.map((function(e,t){return"".concat(t+1,". ").concat(e.language||"text",': "').concat(e.code.substring(0,80),'..." | Релевантность: ').concat(e.relevanceScore,"/10")})).join("\n")):"Код: отсутствует",'\n\nПРАВИЛА АНАЛИЗА:\n1. Для каждой карточки определи степень соответствия (0-10) каждого элемента контента\n2. Элемент добавляется к карточке только при соответствии ≥ 8/10\n3. Учитывай тематику: математика→формулы, программирование→код, процессы→схемы\n4. НЕ добавляй контент если он не добавляет образовательной ценности\n5. Приоритет: специфичность > общность\n\nJSON ответ:\n{\n  "cardMatches": [\n    {\n      "cardIndex": 0,\n      "relevantImages": [0],\n      "relevantFormulas": [],\n      "relevantCode": [],\n      "reasoning": "Изображение 1 прямо иллюстрирует концепт из вопроса"\n    },\n    {\n      "cardIndex": 1,\n      "relevantImages": [],\n      "relevantFormulas": [0],\n      "relevantCode": [],\n      "reasoning": "Формула 1 объясняет математическую зависимость из ответа"\n    }\n  ]\n}'),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.cardContentMatcher.systemPrompt},{role:"user",content:o}])];case 2:if(!(null==(a=c.sent())?void 0:a.content))throw new Error("No response from card content matcher agent");return i=this.parseJSONResponse(a.content,"cardContentMatcher"),console.log("🎯 Card content matcher result:",i),[2,i];case 3:return s=c.sent(),console.error("Card content matcher error:",s),[2,{cardMatches:[]}];case 4:return[2]}}))}))},e.prototype.extractCardTopic=function(e,t){var n=(e+" "+t).toLowerCase();return n.includes("формула")||n.includes("уравнение")||n.includes("математ")?"математика":n.includes("код")||n.includes("программ")||n.includes("алгоритм")?"программирование":n.includes("схема")||n.includes("диаграмма")||n.includes("процесс")?"схематика":n.includes("история")||n.includes("дата")||n.includes("событие")?"история":n.includes("определение")||n.includes("понятие")||n.includes("термин")?"теория":"общая"},e.prototype.executeTextAnalyst=function(e,t){var n,r,o;return rn(this,void 0,void 0,(function(){var t,a,i,s,l,c,u,d,f;return on(this,(function(p){switch(p.label){case 0:t=e.text,a=e.pageContext,i=(null===(n=null==a?void 0:a.pageImages)||void 0===n?void 0:n.length)>0,s=(null===(r=null==a?void 0:a.formulas)||void 0===r?void 0:r.length)>0,l=(null===(o=null==a?void 0:a.codeBlocks)||void 0===o?void 0:o.length)>0,c="Ты - Text Analyst Agent. Проведи глубокий анализ текста и определи оптимальную стратегию обучения.\n\nТЕКСТ ДЛЯ АНАЛИЗА (".concat(t.length,' символов):\n"').concat(t,'"\n\nДОСТУПНЫЙ МУЛЬТИМЕДИА КОНТЕНТ:\n- Изображения: ').concat(i?a.pageImages.length:0," ").concat(i?"(ЕСТЬ - обязательно учти!)":"","\n- Формулы: ").concat(s?a.formulas.length:0,"\n- Код: ").concat(l?a.codeBlocks.length:0,'\n\nТВОЯ ЗАДАЧА:\n1. Определи основные темы и их важность\n2. Оцени сложность материала\n3. ТОЧНО определи сколько карточек ДЕЙСТВИТЕЛЬНО нужно (не переборщи!)\n4. Учти мультимедиа контент в планировании\n5. Приоритизируй темы\n\nПРИНЦИПЫ:\n- Большой текст ≠ много карточек\n- Фокус на ключевых концептах для понимания\n- Если есть изображения - они ДОЛЖНЫ быть использованы\n- Качество > количество\n\nJSON ответ:\n{\n  "textLength": ').concat(t.length,',\n  "complexity": "medium",\n  "mainTopics": [\n    {\n      "name": "Основная тема",\n      "importance": "critical",\n      "complexity": "medium",\n      "estimatedCards": 2,\n      "needsMultimedia": true,\n      "multimediaTypes": ["images"],\n      "subtopics": ["подтема1", "подтема2"]\n    }\n  ],\n  "estimatedCards": 3,\n  "learningObjectives": ["понять X", "запомнить Y"],\n  "hasMultimedia": ').concat(i||s||l,',\n  "multimediaTypes": [').concat(i?'"images"':"").concat(s?', "formulas"':"").concat(l?', "code"':"",'],\n  "priority": "high",\n  "reasoning": "Объяснение стратегии"\n}'),p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.textAnalyst.systemPrompt},{role:"user",content:c}])];case 2:if(!(null==(u=p.sent())?void 0:u.content))throw new Error("No response from text analyst agent");return d=this.parseJSONResponse(u.content,"textAnalyst"),console.log("📋 Text analysis result:",d),[2,d];case 3:return f=p.sent(),console.error("Text analyst error:",f),[2,{textLength:t.length,complexity:this.estimateComplexity(t),mainTopics:[{name:"Основная тема",importance:"important",complexity:"medium",estimatedCards:Math.min(5,Math.ceil(t.length/1e3)),needsMultimedia:i||s||l,multimediaTypes:an(an(an([],i?["images"]:[],!0),s?["formulas"]:[],!0),l?["code"]:[],!0),subtopics:[]}],estimatedCards:Math.min(5,Math.ceil(t.length/1e3)),learningObjectives:["Понимание основных концептов"],hasMultimedia:i||s||l,multimediaTypes:an(an(an([],i?["images"]:[],!0),s?["formulas"]:[],!0),l?["code"]:[],!0),priority:"medium",reasoning:"Fallback analysis due to error"}];case 4:return[2]}}))}))},e.prototype.executeCardPlanner=function(e,t){var n,r,o,a,i,s,l,c,u,d,f,p;return rn(this,void 0,void 0,(function(){var t,g,h,m,y,v,x;return on(this,(function(b){switch(b.label){case 0:t=e.textAnalysis,e.originalText,g=e.pageContext,h="Ты - Card Planner Agent. Создай детальный план карточек на основе анализа текста.\n\nАНАЛИЗ ТЕКСТА:\nОсновные темы: ".concat((null===(n=t.mainTopics)||void 0===n?void 0:n.map((function(e){return"".concat(e.name," (важность: ").concat(e.importance,")")})).join(", "))||"Основные темы","\nРекомендуемое количество карточек: ").concat(t.estimatedCards,"\nСложность: ").concat(t.complexity,"\nЕсть мультимедиа: ").concat(t.hasMultimedia?"ДА":"НЕТ","\nТипы мультимедиа: ").concat((null===(r=t.multimediaTypes)||void 0===r?void 0:r.join(", "))||"нет типов","\n\nДОСТУПНЫЙ КОНТЕНТ:\n").concat((null===(o=null==g?void 0:g.pageImages)||void 0===o?void 0:o.length)>0?"- Изображения: ".concat(g.pageImages.length," (ПРИОРИТЕТ - пользователь выделил!)"):"","\n").concat((null===(a=null==g?void 0:g.formulas)||void 0===a?void 0:a.length)>0?"- Формулы: ".concat(g.formulas.length):"","\n").concat((null===(i=null==g?void 0:g.codeBlocks)||void 0===i?void 0:i.length)>0?"- Код: ".concat(g.codeBlocks.length):"",'\n\nТВОЯ ЗАДАЧА:\n1. Создай точный план каждой карточки\n2. Определи тип карточки (концепт, пример, формула, код)\n3. Спланируй распределение мультимедиа\n4. Оптимизируй для эффективного обучения\n5. ОБЯЗАТЕЛЬНО включи изображения если они есть\n\nТИПЫ КАРТОЧЕК:\n- concept: основные понятия (с изображениями/схемами)\n- definition: определения терминов\n- formula: формулы и уравнения (с формулами)\n- code: примеры кода (с кодом)\n- example: практические примеры\n- application: применение знаний\n\nJSON ответ:\n{\n  "totalCards": 3,\n  "cardSpecs": [\n    {\n      "id": "card_1",\n      "type": "concept",\n      "topic": "Основное понятие",\n      "priority": "high",\n      "difficulty": "medium",\n      "needsMultimedia": true,\n      "multimediaTypes": ["images"],\n      "estimatedLength": "medium",\n      "description": "Карточка объясняет основной концепт с использованием схемы"\n    }\n  ],\n  "multimediaDistribution": {\n    "totalImages": ').concat((null===(s=null==g?void 0:g.pageImages)||void 0===s?void 0:s.length)||0,',\n    "totalFormulas": ').concat((null===(l=null==g?void 0:g.formulas)||void 0===l?void 0:l.length)||0,',\n    "totalCode": ').concat((null===(c=null==g?void 0:g.codeBlocks)||void 0===c?void 0:c.length)||0,',\n    "assignments": [],\n    "userSelectedImages": [0, 1],\n    "reasoning": "Распределение мультимедиа"\n  },\n  "learningFlow": ["card_1", "card_2", "card_3"],\n  "reasoning": "Объяснение плана"\n}'),b.label=1;case 1:return b.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.cardPlanner.systemPrompt},{role:"user",content:h}])];case 2:if(!(null==(m=b.sent())?void 0:m.content))throw new Error("No response from card planner agent");return y=this.parseJSONResponse(m.content,"cardPlanner"),console.log("📋 Card plan result:",y),[2,y];case 3:return v=b.sent(),console.error("Card planner error:",v),[2,{totalCards:x=Math.min(t.estimatedCards,5),cardSpecs:Array.from({length:x},(function(e,n){return{id:"card_".concat(n+1),type:"concept",topic:"Тема ".concat(n+1),priority:"medium",difficulty:"medium",needsMultimedia:t.hasMultimedia,multimediaTypes:t.multimediaTypes||[],estimatedLength:"medium",description:"Карточка ".concat(n+1)}})),multimediaDistribution:{totalImages:(null===(u=null==g?void 0:g.pageImages)||void 0===u?void 0:u.length)||0,totalFormulas:(null===(d=null==g?void 0:g.formulas)||void 0===d?void 0:d.length)||0,totalCode:(null===(f=null==g?void 0:g.codeBlocks)||void 0===f?void 0:f.length)||0,assignments:[],userSelectedImages:(null===(p=null==g?void 0:g.pageImages)||void 0===p?void 0:p.map((function(e,t){return t})))||[],reasoning:"Fallback distribution"},learningFlow:Array.from({length:x},(function(e,t){return"card_".concat(t+1)})),reasoning:"Fallback plan due to error"}];case 4:return[2]}}))}))},e.prototype.executeMultimediaAssigner=function(e,t){var n,r,o,a,i,s,l,c,u,d;return rn(this,void 0,void 0,(function(){var t,f,p,g,h,m,y,v,x,b;return on(this,(function(w){switch(w.label){case 0:t=e.cardPlan,f=e.pageContext,e.originalText,p="Ты - Multimedia Assigner Agent. Точно распредели мультимедиа контент по карточкам.\n\nПЛАН КАРТОЧЕК:\n".concat(t.cardSpecs.map((function(e,t){var n;return"\nКарточка ".concat(t+1," (").concat(e.id,"):\n- Тип: ").concat(e.type,"\n- Тема: ").concat(e.topic,"\n- Нужен мультимедиа: ").concat(e.needsMultimedia?"ДА":"НЕТ","\n- Типы: ").concat((null===(n=e.multimediaTypes)||void 0===n?void 0:n.join(", "))||"нет типов","\n- Описание: ").concat(e.description,"\n")})).join(""),"\n\nДОСТУПНЫЙ МУЛЬТИМЕДИА:\n").concat((null===(n=null==f?void 0:f.pageImages)||void 0===n?void 0:n.length)>0?"\nИЗОБРАЖЕНИЯ (".concat(f.pageImages.length,") - ПРИОРИТЕТ:\n").concat(f.pageImages.map((function(e,t){return"".concat(t,'. "').concat(e.alt||"без описания",'" (релевантность: ').concat(e.relevanceScore,"/10)")})).join("\n"),"\n"):"Изображения: нет","\n\n").concat((null===(r=null==f?void 0:f.formulas)||void 0===r?void 0:r.length)>0?"\nФОРМУЛЫ (".concat(f.formulas.length,"):\n").concat(f.formulas.map((function(e,t){return"".concat(t,'. "').concat(e.text,'" (тип: ').concat(e.type,")")})).join("\n"),"\n"):"Формулы: нет","\n\n").concat((null===(o=null==f?void 0:f.codeBlocks)||void 0===o?void 0:o.length)>0?"\nКОД (".concat(f.codeBlocks.length,"):\n").concat(f.codeBlocks.map((function(e,t){return"".concat(t,". ").concat(e.language||"text",': "').concat(e.code.substring(0,60),'..."')})).join("\n"),"\n"):"Код: нет",'\n\nОСОБЫЕ ТРЕБОВАНИЯ:\n- Если пользователь выделил изображение - оно ДОЛЖНО попасть в карточку\n- Каждое изображение должно иметь четкую образовательную цель\n- Распределяй контент только при высокой релевантности (≥8/10)\n- Один элемент мультимедиа может использоваться в нескольких карточках если это оправдано\n\nJSON ответ:\n{\n  "totalImages": ').concat((null===(a=null==f?void 0:f.pageImages)||void 0===a?void 0:a.length)||0,',\n  "totalFormulas": ').concat((null===(i=null==f?void 0:f.formulas)||void 0===i?void 0:i.length)||0,',\n  "totalCode": ').concat((null===(s=null==f?void 0:f.codeBlocks)||void 0===s?void 0:s.length)||0,',\n  "assignments": [\n    {\n      "cardId": "card_1",\n      "imageIndices": [0],\n      "formulaIndices": [],\n      "codeIndices": [],\n      "reasoning": "Изображение 0 прямо иллюстрирует концепт карточки"\n    }\n  ],\n  "userSelectedImages": [').concat((null===(l=null==f?void 0:f.pageImages)||void 0===l?void 0:l.map((function(e,t){return t})).join(", "))||"",'],\n  "reasoning": "Объяснение распределения"\n}'),w.label=1;case 1:return w.trys.push([1,3,,4]),[4,this.aiService.createChatCompletion(this.apiKey,[{role:"system",content:this.agents.multimediaAssigner.systemPrompt},{role:"user",content:p}])];case 2:if(!(null==(g=w.sent())?void 0:g.content))throw new Error("No response from multimedia assigner agent");return h=this.parseJSONResponse(g.content,"multimediaAssigner"),console.log("🎯 Multimedia assignment result:",h),[2,h];case 3:return m=w.sent(),console.error("Multimedia assigner error:",m),y=[],v=(null===(c=null==f?void 0:f.pageImages)||void 0===c?void 0:c.length)||0,x=(null===(u=null==f?void 0:f.formulas)||void 0===u?void 0:u.length)||0,b=(null===(d=null==f?void 0:f.codeBlocks)||void 0===d?void 0:d.length)||0,t.cardSpecs.forEach((function(e,n){var r={cardId:e.id,imageIndices:[],formulaIndices:[],codeIndices:[],reasoning:"Fallback assignment"};if(e.needsMultimedia&&Array.isArray(e.multimediaTypes)&&e.multimediaTypes.includes("images")&&v>0){var o=Math.ceil(v/t.cardSpecs.length),a=n*o,i=Math.min(a+o,v);r.imageIndices=Array.from({length:i-a},(function(e,t){return a+t}))}y.push(r)})),[2,{totalImages:v,totalFormulas:x,totalCode:b,assignments:y,userSelectedImages:Array.from({length:v},(function(e,t){return t})),reasoning:"Fallback distribution due to error"}];case 4:return[2]}}))}))},e.prototype.getMatchedContentForCard=function(e,t){if(!t||!t.cardMatches)return"нет рекомендаций";var n=t.cardMatches.find((function(t){return t.cardIndex===e}));if(!n)return"нет соответствий";var r=[];return n.relevantImages&&Array.isArray(n.relevantImages)&&n.relevantImages.length>0&&r.push("изображения [".concat(n.relevantImages.join(", "),"]")),n.relevantFormulas&&Array.isArray(n.relevantFormulas)&&n.relevantFormulas.length>0&&r.push("формулы [".concat(n.relevantFormulas.join(", "),"]")),n.relevantCode&&Array.isArray(n.relevantCode)&&n.relevantCode.length>0&&r.push("код [".concat(n.relevantCode.join(", "),"]")),r.length>0?r.join(", "):"нет подходящего контента"},e.prototype.detectLanguage=function(e){return/[а-яё]/i.test(e)?"russian":"english"},e.prototype.estimateComplexity=function(e){var t=e.split(/\s+/).length,n=t/e.split(/[.!?]+/).length;return n<10&&t<100?"simple":n<20&&t<500?"medium":"advanced"},e.prototype.parseJSONResponse=function(e,t){try{var n=e.match(/\{[\s\S]*\}/);if(!n)throw new Error("No JSON found in ".concat(t," response"));return JSON.parse(n[0])}catch(e){throw console.error("Error parsing ".concat(t," response:"),e),e}},e.prototype.createFallbackSupervisorDecision=function(){return{strategy:"multiple_concepts",agents:["contentAnalyzer","cardGenerator","questionQuality","validator"],instructions:{contentAnalyzer:"Проанализируй ключевые понятия в тексте",cardGenerator:"Создай карточки для основных понятий",questionQuality:"Проверь качество каждого вопроса",validator:"Проведи финальную проверку"},expectedOutput:"Набор качественных карточек",reasoning:"Fallback strategy - general approach"}},e.prototype.createFallbackContentAnalysis=function(e){return{mainTopic:"Анализ контента",keyPoints:[e.substring(0,100)],concepts:[{name:"Основной концепт",definition:e.substring(0,200),importance:"medium",prerequisites:[],examples:[]}],relationships:[],learningObjectives:["Понять основную идею"],complexity:"medium",estimatedCards:2}},e.prototype.createFallbackCards=function(e){return[{front:"What is discussed in this text?",back:e.substring(0,200)+(e.length>200?"...":""),difficulty:"medium",concept:"Main idea"}]},e.prototype.createFallbackQualityCheck=function(e){return{question:e.front,answer:e.back,qualityScore:7,relevanceScore:7,difficultyScore:7,issues:[],improvements:[],isWorthwhile:!0,reasoning:"Fallback quality check - acceptable card"}},e.prototype.createFallbackValidation=function(e){return{isValid:!0,overallScore:75,cardScores:e.reduce((function(e,t,n){var r;return nn(nn({},e),((r={})[n]=75,r))}),{}),issues:[],suggestions:[],finalRecommendation:"Cards passed basic validation"}},e.prototype.createFallbackContentEnhancement=function(){return{shouldIncludeImages:!1,selectedImages:[],shouldIncludeFormulas:!1,selectedFormulas:[],shouldIncludeCode:!1,selectedCode:[],reasoning:"Fallback - no multimedia content analysis"}},e.prototype.convertToStoredCards=function(e,t){return e.map((function(e,n){var r=nn(nn(nn(nn({id:"ai_agent_".concat(Date.now(),"_").concat(n,"_").concat(Math.random().toString(36).substr(2,9)),mode:Q.d.GeneralTopic,front:e.front,back:e.back,text:t,createdAt:new Date,exportStatus:"not_exported"},e.tags&&{tags:e.tags}),e.difficulty&&{difficulty:e.difficulty}),e.concept&&{concept:e.concept}),e.qualityScore&&{qualityScore:e.qualityScore});if(e.attachedImages&&e.attachedImages.length>0){var o=e.attachedImages[0];o.base64?(r.image=o.base64,console.log("💾 Сохранено изображение в base64 формате для карточки:",r.id)):o.src&&(r.imageUrl=o.src,console.log("💾 Сохранена ссылка на изображение для карточки:",r.id))}return e.image&&(r.image=e.image,console.log("💾 Скопировано изображение из card.image для карточки:",r.id)),e.imageUrl&&(r.imageUrl=e.imageUrl,console.log("💾 Скопирована ссылка из card.imageUrl для карточки:",r.id)),r}))},e}(),ln=function(e,t){return new sn(e,t)},cn=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},un=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},dn=function(){function e(){}return e.extractPageContent=function(e,t){return{selectedText:e,pageImages:this.extractImages(e,t),formulas:this.extractFormulas(e,t),codeBlocks:this.extractCodeBlocks(e,t),links:this.extractLinks(e,t),metadata:this.extractMetadata()}},e.extractPageContentAsync=function(e,t){return cn(this,void 0,void 0,(function(){var n,r,o,a,i;return un(this,(function(s){switch(s.label){case 0:return console.log("🔍 Асинхронно извлекаем контент страницы..."),[4,this.extractImagesAsync(e,t)];case 1:return n=s.sent(),r=this.extractFormulas(e,t),o=this.extractCodeBlocks(e,t),a=this.extractLinks(e,t),i=this.extractMetadata(),console.log("📄 Асинхронная экстракция завершена:",{images:n.length,formulas:r.length,codeBlocks:o.length,links:a.length}),[2,{selectedText:e,pageImages:n,formulas:r,codeBlocks:o,links:a,metadata:i}]}}))}))},e.extractImages=function(e,t){var n=this,r=[],o=document.querySelectorAll("img");console.log("🔍 Найдено ".concat(o.length," изображений на странице")),o.forEach((function(o,a){if(o.width<30||o.height<30)console.log("⏭️ Пропускаем маленькое изображение ".concat(a,": ").concat(o.width,"x").concat(o.height));else if(o.src)if(o.src.startsWith("data:image")&&o.src.length>5e3)console.log("⏭️ Пропускаем изображение ".concat(a,": слишком длинный data URL"));else{var i=n.isElementNearSelection(o,t,e),s=n.calculateImageRelevance(o,e,i);if(console.log("🖼️ Изображение ".concat(a,":"),{src:o.src.substring(0,50)+"...",alt:o.alt,size:"".concat(o.width,"x").concat(o.height),isNearText:i,relevanceScore:s,willInclude:s>.1}),s>.1){var l=n.convertImageToBase64(o);r.push({src:o.src,alt:o.alt||o.title||"",title:o.title,width:o.naturalWidth||o.width,height:o.naturalHeight||o.height,isNearText:i,relevanceScore:s,base64:l}),console.log("✅ Добавлено изображение ".concat(a," (score: ").concat(s,")"))}else console.log("❌ Изображение ".concat(a," не прошло порог (score: ").concat(s,")"))}else console.log("⏭️ Пропускаем изображение ".concat(a,": нет src"))}));var a=document.querySelectorAll("svg");console.log("🔍 Найдено ".concat(a.length," SVG элементов")),a.forEach((function(o,a){var i,s,l=(null===(i=o.width.baseVal)||void 0===i?void 0:i.value)||0,c=(null===(s=o.height.baseVal)||void 0===s?void 0:s.value)||0;if(l<30||c<30)console.log("⏭️ Пропускаем маленький SVG ".concat(a,": ").concat(l,"x").concat(c));else{var u=n.isElementNearSelection(o,t,e),d=n.calculateSvgRelevance(o,e,u);console.log("🎨 SVG ".concat(a,":"),{size:"".concat(l,"x").concat(c),isNearText:u,relevanceScore:d,willInclude:d>.1}),d>.1&&(r.push({src:n.svgToDataUrl(o),alt:o.getAttribute("aria-label")||o.getAttribute("title")||"SVG диаграмма",width:l||200,height:c||200,isNearText:u,relevanceScore:d,base64:n.svgToDataUrl(o)}),console.log("✅ Добавлен SVG ".concat(a," (score: ").concat(d,")")))}}));var i=r.sort((function(e,t){return t.relevanceScore-e.relevanceScore})).slice(0,10);if(0===i.length){console.log("🚨 Не найдено релевантных изображений, применяем аварийную логику");var s=[];o.forEach((function(e,t){if(e.width>=30&&e.height>=30&&e.src){var r=n.convertImageToBase64(e);s.push({src:e.src,alt:e.alt||e.title||"Изображение ".concat(t+1),title:e.title,width:e.naturalWidth||e.width,height:e.naturalHeight||e.height,isNearText:!1,relevanceScore:.5,base64:r})}})),i=s.slice(0,5),console.log("🎯 АВАРИЙНЫЙ РЕЖИМ: Добавлено ".concat(i.length," изображений"))}return console.log("🎯 Финальный результат: ".concat(i.length," изображений из ").concat(r.length," найденных")),i},e.extractImagesAsync=function(e,t){return cn(this,void 0,void 0,(function(){var n,r,o,a=this;return un(this,(function(i){switch(i.label){case 0:return n=[],r=document.querySelectorAll("img"),o=Array.from(r).map((function(n){return cn(a,void 0,void 0,(function(){var r,o,a;return un(this,(function(i){switch(i.label){case 0:return n.width<50||n.height<50||(!n.src||n.src.startsWith("data:image")&&n.src.length>1e3)?[2,null]:(r=this.isElementNearSelection(n,t,e),(o=this.calculateImageRelevance(n,e,r))<=.3?[2,null]:!n.src.startsWith("http")||n.src.includes(window.location.origin)?[3,2]:(console.log("🖼️ Загружаем внешнее изображение:",n.src),[4,this.fetchImageAsBase64(n.src)]));case 1:return a=i.sent(),[3,3];case 2:a=this.convertImageToBase64(n),i.label=3;case 3:return[2,{src:n.src,alt:n.alt||n.title||"",title:n.title,width:n.naturalWidth||n.width,height:n.naturalHeight||n.height,isNearText:r,relevanceScore:o,base64:a}]}}))}))})),[4,Promise.all(o)];case 1:return i.sent().forEach((function(e){e&&n.push(e)})),document.querySelectorAll("svg").forEach((function(r){var o,i,s=(null===(o=r.width.baseVal)||void 0===o?void 0:o.value)||0,l=(null===(i=r.height.baseVal)||void 0===i?void 0:i.value)||0;if(!(s<50||l<50)){var c=a.isElementNearSelection(r,t,e),u=a.calculateSvgRelevance(r,e,c);u>.3&&n.push({src:a.svgToDataUrl(r),alt:r.getAttribute("aria-label")||r.getAttribute("title")||"SVG диаграмма",width:s||200,height:l||200,isNearText:c,relevanceScore:u,base64:a.svgToDataUrl(r)})}})),console.log("🖼️ Найдено ".concat(n.length," релевантных изображений (включая ").concat(n.filter((function(e){return e.base64})).length," с base64)")),[2,n.sort((function(e,t){return t.relevanceScore-e.relevanceScore})).slice(0,5)]}}))}))},e.extractFormulas=function(e,t){var n=this,r=[];document.querySelectorAll('.MathJax, .math, [class*="math"]').forEach((function(o){var a=n.extractFormulaText(o);if(a){var i=n.isElementNearSelection(o,t,e);r.push({text:a,type:n.detectFormulaType(o),isNearText:i,relevanceScore:n.calculateFormulaRelevance(a,e,i)})}}));var o=[/\$\$([^$]+)\$\$/g,/\$([^$]+)\$/g,/\\begin\{[^}]+\}[\s\S]*?\\end\{[^}]+\}/g],a=document.body.textContent||"";return o.forEach((function(t){for(var i;null!==(i=t.exec(a));){var s=i[1]||i[0],l=a.toLowerCase().includes(e.toLowerCase());r.push({text:s,type:t===o[0]?"block":"inline",isNearText:l,relevanceScore:n.calculateFormulaRelevance(s,e,l)})}})),r.filter((function(e){return e.relevanceScore>.2})).sort((function(e,t){return t.relevanceScore-e.relevanceScore})).slice(0,3)},e.extractCodeBlocks=function(e,t){var n=this,r=[];return document.querySelectorAll("pre code, .highlight code, .code-block, .codehilite").forEach((function(o){var a,i=null===(a=o.textContent)||void 0===a?void 0:a.trim();if(i&&i.length>10&&i.length<2e3){var s=n.isElementNearSelection(o,t,e),l=n.detectCodeLanguage(o);r.push({code:i,language:l,isNearText:s,relevanceScore:n.calculateCodeRelevance(i,e,s)})}})),document.querySelectorAll("code:not(pre code)").forEach((function(o){var a,i=null===(a=o.textContent)||void 0===a?void 0:a.trim();if(i&&i.length>3&&i.length<100){var s=n.isElementNearSelection(o,t,e);r.push({code:i,language:"inline",isNearText:s,relevanceScore:n.calculateCodeRelevance(i,e,s)})}})),r.filter((function(e){return e.relevanceScore>.3})).sort((function(e,t){return t.relevanceScore-e.relevanceScore})).slice(0,5)},e.extractLinks=function(e,t){var n=this,r=[];return document.querySelectorAll("a[href]").forEach((function(o){var a,i=o.getAttribute("href"),s=null===(a=o.textContent)||void 0===a?void 0:a.trim();if(i&&s&&i.startsWith("http")){var l=n.isElementNearSelection(o,t,e),c=n.calculateLinkRelevance(s,i,e,l);c>.2&&r.push({url:i,text:s,isNearText:l,relevanceScore:c})}})),r.sort((function(e,t){return t.relevanceScore-e.relevanceScore})).slice(0,3)},e.extractMetadata=function(){return{url:window.location.href,title:document.title,domain:window.location.hostname,language:document.documentElement.lang||"en",hasImages:document.querySelectorAll("img").length>0,hasFormulas:document.querySelectorAll('.MathJax, .math, [class*="math"]').length>0||(document.body.textContent||"").includes("$"),hasCode:document.querySelectorAll("pre code, .highlight, .code-block").length>0}},e.isElementNearSelection=function(e,t,n){var r;if(!t){var o=e.textContent||"",a=(null===(r=e.parentElement)||void 0===r?void 0:r.textContent)||"";return o.toLowerCase().includes((n||"").toLowerCase())||a.toLowerCase().includes((n||"").toLowerCase())}var i=e.getBoundingClientRect(),s=t.getBoundingClientRect();return Math.sqrt(Math.pow(i.left-s.left,2)+Math.pow(i.top-s.top,2))<500},e.calculateImageRelevance=function(e,t,n){var r=.3;n&&(r+=.4);var o=(e.alt||"").toLowerCase(),a=t.toLowerCase();(o.includes(a)||a.includes(o))&&(r+=.3);var i=e.naturalWidth||e.width,s=e.naturalHeight||e.height;return i>=50&&s>=50&&(r+=.2),(o.includes("icon")||o.includes("logo")||i<50||s<50)&&(r-=.2),(o.includes("diagram")||o.includes("chart")||o.includes("graph")||o.includes("figure")||o.includes("схема")||o.includes("диаграмма")||o.includes("рисунок")||o.includes("изображение"))&&(r+=.3),console.log("📊 Relevance calculation for image:",{alt:o.substring(0,30),size:"".concat(i,"x").concat(s),isNearText:n,finalScore:Math.max(0,Math.min(1,r))}),Math.max(0,Math.min(1,r))},e.calculateSvgRelevance=function(e,t,n){var r=0;n&&(r+=.5),r+=.3;var o=e.textContent||"";return(o.toLowerCase().includes(t.toLowerCase())||t.toLowerCase().includes(o.toLowerCase()))&&(r+=.2),Math.max(0,Math.min(1,r))},e.calculateFormulaRelevance=function(e,t,n){var r=0;n&&(r+=.4);var o=t.toLowerCase().match(/\b(формула|уравнение|функция|интеграл|производная|матрица|вектор|логарифм|синус|косинус|тангенс|предел|сумма|произведение)\b/g);return o&&o.length>0&&(r+=.4),e.length>20&&(r+=.2),Math.max(0,Math.min(1,r))},e.calculateCodeRelevance=function(e,t,n){var r=0;n&&(r+=.4);var o=t.toLowerCase().match(/\b(алгоритм|функция|метод|класс|переменная|массив|цикл|условие|код|программа|скрипт)\b/g);return o&&o.length>0&&(r+=.4),e.includes("\n")&&e.includes("{")&&e.includes("}")&&(r+=.2),Math.max(0,Math.min(1,r))},e.calculateLinkRelevance=function(e,t,n,r){var o=0;return r&&(o+=.3),(e.toLowerCase().includes(n.toLowerCase())||n.toLowerCase().includes(e.toLowerCase()))&&(o+=.4),(t.includes("wikipedia")||t.includes("edu")||t.includes("documentation"))&&(o+=.3),Math.max(0,Math.min(1,o))},e.convertImageToBase64=function(e){try{if(!e.complete||0===e.naturalWidth)return void console.warn("Image not loaded yet:",e.src);var t=document.createElement("canvas"),n=t.getContext("2d");if(!n)return;return t.width=e.naturalWidth||e.width,t.height=e.naturalHeight||e.height,n.fillStyle="#FFFFFF",n.fillRect(0,0,t.width,t.height),n.drawImage(e,0,0),t.toDataURL("image/png",1)}catch(e){return void console.warn("Could not convert image to base64:",e)}},e.fetchImageAsBase64=function(e){return cn(this,void 0,void 0,(function(){var t;return un(this,(function(n){try{return console.log("🖼️ Загружаем внешнее изображение:",e),(t=new Image).crossOrigin="anonymous",[2,new Promise((function(n){t.onload=function(){try{var e=document.createElement("canvas"),r=e.getContext("2d");if(!r)return void n(void 0);e.width=t.naturalWidth,e.height=t.naturalHeight,r.fillStyle="#FFFFFF",r.fillRect(0,0,e.width,e.height),r.drawImage(t,0,0);var o=e.toDataURL("image/png",1);console.log("✅ Изображение успешно конвертировано в base64"),n(o)}catch(e){console.warn("Ошибка при конвертации изображения:",e),n(void 0)}},t.onerror=function(){console.warn("Ошибка загрузки изображения:",e),n(void 0)},t.src=e}))]}catch(e){return console.warn("Failed to fetch image as base64:",e),[2,void 0]}return[2]}))}))},e.svgToDataUrl=function(e){var t=(new XMLSerializer).serializeToString(e);return"data:image/svg+xml;base64,".concat(btoa(t))},e.extractFormulaText=function(e){var t=e.querySelector("math");return t?t.textContent||t.innerHTML:e.getAttribute("data-latex")||e.getAttribute("data-math")||e.textContent||null},e.detectFormulaType=function(e){if(e.querySelector("math"))return"mathml";var t=e.className.toLowerCase();return t.includes("display")||t.includes("block")?"block":t.includes("inline")?"inline":"latex"},e.detectCodeLanguage=function(e){var t=e.className.match(/language-(\w+)|lang-(\w+)|highlight-(\w+)/);if(t)return t[1]||t[2]||t[3];var n=e.getAttribute("data-lang")||e.getAttribute("data-language");if(n)return n;var r=e.textContent||"";return r.includes("function")&&r.includes("{")?"javascript":r.includes("def ")&&r.includes(":")?"python":r.includes("#include")||r.includes("int main")?"cpp":r.includes("public class")||r.includes("System.out")?"java":void 0},e}(),fn=function(){return fn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},fn.apply(this,arguments)},pn=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},gn=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},hn=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))};const mn=function(){r.useEffect((function(){var e=document.createElement("style");return e.textContent="\n            @keyframes fadeIn {\n                from { opacity: 0; }\n                to { opacity: 1; }\n            }\n            @keyframes slideUp {\n                from { \n                    opacity: 0;\n                    transform: translateY(30px) scale(0.95);\n                }\n                to { \n                    opacity: 1;\n                    transform: translateY(0) scale(1);\n                }\n            }\n            @keyframes slideIn {\n                from { \n                    opacity: 0;\n                    transform: translateX(-20px);\n                }\n                to { \n                    opacity: 1;\n                    transform: translateX(0);\n                }\n            }\n        ",document.head.appendChild(e),function(){document.head.removeChild(e)}}),[]);var e=(0,r.useState)(!1),t=e[0],o=e[1],i=(m((function(e){return e.deck.deckId})),Ue()),s=k(),l=(0,r.useCallback)((function(e){s({type:"SET_SOURCE_LANGUAGE",payload:e}),localStorage.setItem("source_language",e)}),[s]),c=i.text,u=i.translation,d=i.examples,f=i.image,p=i.imageUrl,g=i.front,h=i.back,y=i.currentCardId,v=i.linguisticInfo,x=i.transcription,b=(i.fieldIdPrefix,m((function(e){return e.settings.translateToLanguage}))),w=m((function(e){return e.settings.aiInstructions})),S=m((function(e){return e.settings.imageInstructions})),C=(m((function(e){return e.deck.decks})),m((function(e){return e.settings.mode}))),E=(0,r.useState)(""),I=E[0],A=E[1],_=(0,r.useCallback)((function(){var e=C===Q.d.LanguageLearning?Q.d.GeneralTopic:Q.d.LanguageLearning;s((0,We.iY)(e)),localStorage.setItem("selected_mode",e),s(Ie("")),s(Re("")),s(Fe(null)),s(_e(null)),s(Ae([])),s(Te(null)),s(je(null)),s(Be("")),s(Ne("")),s(Pe(null)),Gt(null),Xt(""),Kt(!1),o(!1),Vt(!1),Ot([]),Dt(0)}),[C,s]),T=(m((function(e){return e.settings.useAnkiConnect})),m((function(e){return e.settings.ankiConnectUrl})),m((function(e){return e.settings.ankiConnectApiKey})),(0,r.useState)(!1)),j=T[0],F=T[1],R=(0,r.useState)(!1),O=R[0],P=R[1],B=(0,r.useState)(!1),N=B[0],L=B[1],z=(0,r.useState)(!1),D=z[0],M=z[1],U=(0,r.useState)(null),q=U[0],W=U[1],V=(0,r.useState)({completed:0,total:0}),$=V[0],G=V[1],H=(0,r.useState)(!1),K=H[0],Y=H[1],J=(0,r.useState)(0),X=J[0],Z=J[1],ee=(0,r.useRef)(null),te=(0,r.useState)(!0),ne=te[0],re=te[1],oe=(0,r.useState)(!1),ae=oe[0],ie=oe[1],se=m((function(e){return e.settings.openAiKey})),le=m((function(e){return e.settings.groqApiKey})),ce=m((function(e){return e.settings.groqModelName})),ue=m((function(e){return e.settings.modelProvider})),de=m((function(e){return e.settings.shouldGenerateImage})),fe=m((function(e){return e.settings.imageGenerationMode})),pe=(0,r.useState)(!1),ge=pe[0],he=pe[1];r.useEffect((function(){"smart"!==fe&&"always"!==fe||de||(console.log("🔧 Initializing: Setting shouldGenerateImage=true for ".concat(fe," mode")),s((0,We.yo)(!0)))}),[fe,de,s]);var me=(0,r.useState)(!1),ye=me[0],ve=me[1],xe=(0,r.useState)(w),be=xe[0],we=xe[1],Se=(0,r.useState)(S),Ce=Se[0],Le=Se[1],ze=Wt(),De=ze.showError,Me=ze.renderErrorNotification,Ve=function(e){var t=e.message.toLowerCase();return t.includes("quota")||t.includes("insufficient_quota")||t.includes("billing")||t.includes("exceeded")||t.includes("429")},$e=new zt.z4({apiKey:se,dangerouslyAllowBrowser:!0}),Ge=(0,r.useState)(""),He=Ge[0],Ke=Ge[1],Qe=(0,r.useState)(!1),Ye=Qe[0],Xe=Qe[1],et=(0,r.useState)(!1),tt=et[0],nt=et[1],rt=(0,r.useState)([]),st=rt[0],ut=rt[1],gt=(0,r.useState)(!1),xt=gt[0],bt=gt[1],Ct=(0,r.useState)(!1),Et=Ct[0],It=Ct[1],At=(0,r.useState)({}),Tt=At[0],jt=At[1],Ft=(0,r.useState)([]),Rt=Ft[0],Ot=Ft[1],Pt=(0,r.useState)(0),Bt=Pt[0],Dt=Pt[1],Mt=(0,r.useState)(!1),qt=Mt[0],Vt=Mt[1],$t=(0,r.useState)(null),Gt=($t[0],$t[1]),Ht=(0,r.useState)(!1),Kt=(Ht[0],Ht[1]),Qt=(0,r.useState)(""),Yt=Qt[0],Xt=Qt[1],Zt=(0,r.useState)([]),nn=Zt[0],rn=Zt[1],on=(0,r.useState)(!1),an=on[0],sn=on[1],cn=(0,r.useState)(0),un=cn[0],mn=cn[1],yn=(0,r.useState)(new Set),vn=yn[0],xn=yn[1],bn=(0,r.useState)(!1),wn=bn[0],Sn=bn[1],Cn=(0,r.useState)(""),En=Cn[0],kn=Cn[1],In=(0,r.useRef)(null),An=i.storedCards,_n=(0,r.useMemo)((function(){return(0,en.getAIService)(ue)}),[ue]),Tn=(0,r.useMemo)((function(){return(0,en.getApiKeyForProvider)(ue,se,le)}),[ue,se,le]),jn=(0,r.useState)([]),Fn=jn[0],Rn=jn[1],On=(0,r.useCallback)((function(e){return!!e&&Fn.includes(e)}),[Fn]),Pn=(0,r.useMemo)((function(){if(console.log("Calculating isSaved:",{currentCardId:y,explicitlySaved:ae,isMultipleCards:qt,currentCardIndex:Bt,createdCardsLength:Rt.length,explicitlySavedIds:Fn}),qt&&Rt.length>0){var e=Rt[Bt];return!!e&&On(e.id)}return!(!y||!ae)}),[y,ae,qt,Bt,Rt,On]);console.log("Card state details:",{isNewSubmission:ne,explicitlySaved:ae,isSaved:Pn,currentCardId:y,text:c.substring(0,20)+(c.length>20?"...":""),localStorage_explicitly_saved:localStorage.getItem("explicitly_saved")});(0,r.useEffect)((function(){return console.log("🔄 Loading state changed:",{loadingGetResult:j,isProcessingCustomInstruction:Ye,loadingNewImage:O,loadingNewExamples:N}),j?(console.log("⏱️ Starting timer for card creation"),Z(0),ee.current=setInterval((function(){Z((function(e){return e+1}))}),1e3)):ee.current&&(console.log("⏱️ Stopping timer for card creation"),clearInterval(ee.current),ee.current=null),function(){ee.current&&clearInterval(ee.current)}}),[j,Ye,O,N]);(0,r.useEffect)((function(){Pn&&Y(!0)}),[c,u,d,f,p,g,Pn]);var Bn=(0,r.useCallback)((function(e){if(e&&""!==e.trim()){var t=Jt().find((function(t){return t.text===e}));return!!t&&(console.log("Found existing card with matching text:",(null==t?void 0:t.text)||e,"ID:",t.id),console.log("Setting currentCardId but NOT setting explicitlySaved"),s(Pe(t.id)),!0)}}),[s]),Nn=function(e){i.setText(e),Pn?Y(!0):Bn(e)},Ln=function(e){i.setTranslation(e),Pn&&Y(!0)},zn=function(e){i.setExamples(e),Pn&&Y(!0)},Dn=function(){return pn(void 0,void 0,void 0,(function(){var e,t,n,r,o,a,s;return gn(this,(function(l){switch(l.label){case 0:P(!0),l.label=1;case 1:return l.trys.push([1,6,7,8]),(null===(a=In.current)||void 0===a?void 0:a.signal.aborted)?(console.log("New image generation cancelled"),[2]):[4,_n.getDescriptionImage(Tn,c,S,null===(s=In.current)||void 0===s?void 0:s.signal)];case 2:return e=l.sent(),ue!==tn.l.OpenAI?[3,4]:[4,Ut(0,$e,se,e,S)];case 3:return t=l.sent(),n=t.imageUrl,r=t.imageBase64,n&&i.setImageUrl(n),r&&i.setImage(r),[3,5];case 4:De("Image generation is not supported with the selected provider."),l.label=5;case 5:return[3,8];case 6:return(o=l.sent())instanceof Error&&Ve(o)?(console.error("Quota error detected in image generation:",o.message),De(o.message),[2]):(console.error("Error generating image:",o),De(o instanceof Error?o.message:"Failed to generate image"),[3,8]);case 7:return P(!1),[7];case 8:return Pn&&Y(!0),[2]}}))}))},Mn=function(){return pn(void 0,void 0,void 0,(function(){var e,t,n,r,o,a;return gn(this,(function(s){switch(s.label){case 0:L(!0),s.label=1;case 1:return s.trys.push([1,3,4,5]),(null===(o=In.current)||void 0===o?void 0:o.signal.aborted)?(console.log("New examples generation cancelled"),[2]):(e=Fr?xr:mr,[4,(0,en.createExamples)(_n,Tn,c,b,!0,w,e||void 0,null===(a=In.current)||void 0===a?void 0:a.signal)]);case 2:return(t=s.sent())&&t.length>0&&(n=t.map((function(e){return[e.original,e.translated]})),i.setExamples(n)),[3,5];case 3:return(r=s.sent())instanceof Error&&Ve(r)?(console.error("Quota error detected in examples generation:",r.message),De(r.message),[2]):(console.error("Error getting examples:",r),De(r instanceof Error?r.message:"Failed to generate examples"),[3,5]);case 4:return L(!1),[7];case 5:return Pn&&Y(!0),[2]}}))}))},Un=function(){return pn(void 0,void 0,void 0,(function(){var e,t,n,r,o,a,s,l,u;return gn(this,(function(d){switch(d.label){case 0:if(!He.trim()||Ye)return[2];Xe(!0),d.label=1;case 1:return d.trys.push([1,15,16,17]),He.toLowerCase().includes("image")||He.toLowerCase().includes("picture")||He.toLowerCase().includes("изображени")||He.toLowerCase().includes("картин")?[4,(0,qe.getDescriptionImage)(se,c,He)]:[3,4];case 2:return a=d.sent(),[4,Ut(0,$e,se,a,He)];case 3:return e=d.sent(),t=e.imageUrl,n=e.imageBase64,t&&i.setImageUrl(t),n&&i.setImage(n),[3,14];case 4:return He.toLowerCase().includes("example")||He.toLowerCase().includes("sentence")||He.toLowerCase().includes("пример")||He.toLowerCase().includes("предложение")?(console.log("📚 Starting examples generation..."),[4,_n.getExamples(Tn,c,b,!0,He)]):[3,6];case 5:return o=d.sent(),console.log("📚 Examples generation completed"),i.setExamples(o),[3,14];case 6:return He.toLowerCase().includes("translat")||He.toLowerCase().includes("перевод")?[4,_n.translateText(Tn,c,b,He)]:[3,8];case 7:return(r=d.sent())&&i.setTranslation(r),[3,14];case 8:return[4,_n.translateText(Tn,c,b,He)];case 9:return r=d.sent(),console.log("📚 Starting examples generation (combined)..."),[4,_n.getExamples(Tn,c,b,!0,He)];case 10:return o=d.sent(),console.log("📚 Examples generation completed (combined)"),de?[4,_n.getDescriptionImage(Tn,c,He)]:[3,13];case 11:return a=d.sent(),[4,null===(u=_n.getImageUrl)||void 0===u?void 0:u.call(_n,Tn,a)];case 12:(s=d.sent())&&i.setImageUrl(s),d.label=13;case 13:r&&i.setTranslation(r),i.setExamples(o),d.label=14;case 14:return Ke(""),[3,17];case 15:return(l=d.sent())instanceof Error&&Ve(l)?(console.error("Quota error detected in custom instructions:",l.message),De(l.message),[2]):(console.error("Error applying custom instructions:",l),De(l instanceof Error?l.message:"Failed to apply custom instructions"),[3,17]);case 16:return console.log("📝 Custom instruction processing completed"),Xe(!1),[7];case 17:return[2]}}))}))},qn=function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),Un())},Wn=function(){return ue!==tn.l.Groq},Vn=function(){return pn(void 0,void 0,void 0,(function(){var e,t,n,r,o,a,i,l,m;return gn(this,(function(y){console.log("*** HANDLE SAVE ALL CARDS: Starting ***"),console.log("Current Redux state at save all cards time:",{text:c,translation:u,image:f,imageUrl:p,hasImage:!!f,hasImageUrl:!!p,imageType:typeof f,imageUrlType:typeof p,shouldGenerateImage:de,mode:C,createdCardsCount:Rt.length}),De(null);try{for(M(!0),(e=hn([],Rt,!0))[Bt]&&(e[Bt]=fn(fn({},e[Bt]),{text:c,translation:u,examples:d,image:f,imageUrl:p,front:g,back:h||null,linguisticInfo:v||"",transcription:x||""})),t=0,n=0,r=0,o=0,a=hn([],Fn,!0),console.log("Starting to save cards. Total cards:",e.length,"Already saved:",Fn.length),console.log("Cards to save:",e.map((function(e){var t;return{id:e.id,text:null===(t=e.text)||void 0===t?void 0:t.substring(0,30)}}))),i=function(i){var l=e[i];if(Fn.includes(l.id))return console.log("Card #".concat(i," (").concat(l.id,") already explicitly saved, skipping")),t++,"continue";try{console.log("Saving card #".concat(i," (").concat(l.id,") from multi-card set")),-1===An.findIndex((function(e){return e.id===l.id}))?(s(Ee(l)),r++,a.push(l.id),console.log("Card #".concat(i," (").concat(l.id,") saved as new")),t++):(console.log("Card #".concat(i," (").concat(l.id,") already in storage, updating")),s(Oe(l)),o++,a.push(l.id),t++)}catch(e){console.error("Error saving card #".concat(i," (").concat(l.id,"):"),e),n++}},l=0;l<e.length;l++)i(l);console.log("Save all complete. Saved:",r,"Updated:",o,"Errors:",n),Rn(a),Ot(e),ie(!0),localStorage.setItem("explicitly_saved","true"),(m=e[Bt])&&m.id&&(s(Pe(m.id)),localStorage.setItem("current_card_id",m.id)),0===n?r>0&&o>0?"Saved ".concat(r," new cards and updated ").concat(o," existing cards."):r>0?"Saved ".concat(r," cards successfully!"):o>0?"Updated ".concat(o," cards successfully!"):"All ".concat(t," cards are now saved!"):De("Saved ".concat(t," cards, ").concat(n," failed."),"warning"),Y(!1),re(!1),s(ke())}catch(e){console.error("Error in save all cards operation:",e),De("Error saving cards. Please try again.")}finally{M(!1)}return[2]}))}))},$n=function(){return pn(void 0,void 0,void 0,(function(){var e,t,n,r,o,a,l;return gn(this,(function(h){console.log("*** HANDLE ACCEPT: Starting to save card ***"),console.log("Current Redux state at save time:",{text:c,translation:u,image:f,imageUrl:p,hasImage:!!f,hasImageUrl:!!p,imageType:typeof f,imageUrlType:typeof p,imageLength:null==f?void 0:f.length,imageUrlLength:null==p?void 0:p.length,shouldGenerateImage:de,mode:C}),De(null);try{if(M(!0),qt&&Rt.length>0)return nr(),(e=Rt[Bt])?(console.log("Saving current card from multi-card set:",e.id),-1===An.findIndex((function(t){return t.id===e.id||t.text===e.text&&t.mode===e.mode}))?(i.saveCardToStorage(e),console.log("Saved new card: ".concat(e.id))):(i.updateStoredCard(e),console.log("Updated existing card: ".concat(e.id))),Rn((function(t){if(t.includes(e.id))return t;var n=hn(hn([],t,!0),[e.id],!1);return console.log("Updated explicitly saved IDs:",n),n})),s(ke()),i.setCurrentCardId(e.id),localStorage.setItem("current_card_id",e.id),ie(!0),localStorage.setItem("explicitly_saved","true"),Y(!1),[2]):(De("Card data not found"),[2]);if(t=y||Date.now().toString(),console.log("Saving card with data:",{originalSelectedText:I,text:c,translation:u,examples:d.length,mode:C,currentCardId:y,linguisticInfo:v?"present":"absent"}),C===Q.d.LanguageLearning){if(!c&&!I)return console.error("Missing text data for card"),De("Please enter or select some text for your card before saving."),[2];n={id:t,mode:C,text:I||c,translation:u,examples:d,linguisticInfo:v,transcription:x||"",image:f,imageUrl:p,createdAt:new Date,exportStatus:"not_exported"},console.log("*** CREATECARD: Preparing to save card to storage ***"),console.log("Card data being sent to Redux:",{id:n.id,text:n.text,mode:n.mode,hasImage:!!n.image,hasImageUrl:!!n.imageUrl,imageType:typeof n.image,imageUrlType:typeof n.imageUrl,imageLength:null===(r=n.image)||void 0===r?void 0:r.length,imageUrlLength:null===(o=n.imageUrl)||void 0===o?void 0:o.length,imageActualValue:n.image,imageUrlActualValue:n.imageUrl,imagePreview:null===(a=n.image)||void 0===a?void 0:a.substring(0,50),imageUrlPreview:null===(l=n.imageUrl)||void 0===l?void 0:l.substring(0,50)}),y?(console.log("Updating existing card by user action:",t),i.updateStoredCard(n)):(console.log("Saving new card by user action:",t),i.saveCardToStorage(n),i.setCurrentCardId(t))}else if(C===Q.d.GeneralTopic){if(!g)return console.error("Missing front data for general topic card"),De("Please generate card content before saving."),[2];n={id:t,mode:C,front:g,back:u||g,text:I||c||"",linguisticInfo:v,transcription:x||"",image:f,imageUrl:p,createdAt:new Date,exportStatus:"not_exported"},console.log("Saving general topic card to storage:",n),y?(console.log("Updating existing general topic card by user action:",t),i.updateStoredCard(n)):(console.log("Saving new general topic card by user action:",t),i.saveCardToStorage(n),i.setCurrentCardId(t))}ie(!0),localStorage.setItem("explicitly_saved","true"),Y(!1),re(!1)}catch(e){console.error("Error saving card:",e),De("Error saving card. Please try again.")}finally{M(!1)}return[2]}))}))},Gn=function(){i.setCurrentPage("storedCards")},Hn=(0,r.useCallback)((function(e){console.log("Text selection handled for tab-specific state:",e),bt(!1),jt({}),ut([]),i.setText(e),console.log("Text set via tabAware.setText:",e)}),[i]);(0,r.useEffect)((function(){var e=function(e){var t,n=document.getElementById("sidebar");if(!n||!n.contains(e.target)){if(e.target&&e.composedPath)for(var r=0,o=e.composedPath();r<o.length;r++){var a=o[r];if(a instanceof Element&&"sidebar"===a.id)return;if(a instanceof ShadowRoot&&a.host&&"sidebar"===a.host.id)return}var i=null===(t=window.getSelection())||void 0===t?void 0:t.toString().trim();i&&i.length>0&&Hn(i)}};return document.addEventListener("mouseup",e),function(){document.removeEventListener("mouseup",e)}}),[Hn]),(0,r.useEffect)((function(){var e=localStorage.getItem("selected_mode");s(e?(0,We.iY)(e):(0,We.iY)(Q.d.LanguageLearning)),c&&u&&d.length>0?o(!0):o(!1),s(ke())}),[s]),(0,r.useEffect)((function(){pn(void 0,void 0,void 0,(function(){return gn(this,(function(e){return console.log("Running saved cards check on mount"),s(ke()),setTimeout((function(){var e=Jt();console.log("Loaded cards from storage:",e.length);var t=localStorage.getItem("current_card_id"),n=localStorage.getItem("explicitly_saved");if(console.log("localStorage values on mount:",{savedCardId:t,explicitlySavedFlag:n,cardCount:e.length}),t){console.log("Found current card ID in localStorage:",t);var r=e.find((function(e){return e.id===t}));r?(console.log("Restoring card from storage:",r),Y(!1),re(!1),"true"===n?(console.log("Setting explicitlySaved to TRUE based on localStorage flag"),ie(!0)):(console.log("Setting explicitlySaved to FALSE based on localStorage flag"),ie(!1)),i.setCurrentCardId(t),i.setText(r.text),r.translation&&i.setTranslation(r.translation),r.examples&&i.setExamples(r.examples),r.image&&i.setImage(r.image),r.imageUrl&&i.setImageUrl(r.imageUrl),r.front&&i.setFront(r.front),r.back&&i.setBack(r.back),r.linguisticInfo&&i.setLinguisticInfo(r.linguisticInfo),r.transcription&&i.setTranscription(r.transcription),A(r.text),o(!0)):(console.log("Card ID from localStorage not found in storage, resetting"),localStorage.removeItem("current_card_id"),localStorage.removeItem("explicitly_saved"),i.setCurrentCardId(null),re(!0),ie(!1))}else console.log("No current card ID in localStorage"),re(!0),ie(!1)}),200),[2]}))}))}),[]),(0,r.useEffect)((function(){c&&!ne&&""!==c.trim()&&(!t||y?(y||(console.log("Actively typing new card text - ensuring not marked as saved"),ie(!1),localStorage.removeItem("explicitly_saved")),Bn(c)):console.log("New card being created, skipping automatic saved detection"))}),[c,y,ne,t,Bn]);var Kn=function(){s((0,We.qM)(be)),he(!1)},Qn=function(){s((0,We.Fo)(Ce)),ve(!1)},Yn=function(){console.log("Canceling current card, clearing all state"),In.current&&(console.log("Aborting ongoing AI requests"),In.current.abort(),In.current=null),o(!1),Y(!1),s(Pe(null)),re(!0),ie(!1),localStorage.removeItem("explicitly_saved"),localStorage.removeItem("current_card_id"),i.setIsGeneratingCard(!1),F(!1),Ot([]),Vt(!1),Dt(0),s(Ie("")),s(_e("")),s(Ae([])),s(Te(null)),s(je(null)),s(Re("")),s(Fe(null)),s(Be("")),s(Ne("")),A("")},Jn=function(){switch(ue){case tn.l.OpenAI:return(0,a.jsx)("span",fn({style:{display:"inline-flex",alignItems:"center",marginLeft:"8px",padding:"2px 6px",borderRadius:"4px",backgroundColor:"#10a37f",color:"white",fontSize:"10px",fontWeight:"600"}},{children:"OpenAI"}));case tn.l.Groq:return(0,a.jsx)("span",fn({style:{display:"inline-flex",alignItems:"center",marginLeft:"8px",padding:"2px 6px",borderRadius:"4px",backgroundColor:"#7c3aed",color:"white",fontSize:"10px",fontWeight:"600"}},{children:"Groq"}));default:return null}},Xn=function(){if(console.log("Modal close handler. Card saved status:",Pn,"isEdited:",K),qt)return console.log("Closing modal for multiple cards without automatic saving"),void nt(!1);!t||Pn||K||!u||qt?Pn||(console.log("Card not saved, clearing all data"),s(Ie("")),s(_e("")),s(Ae([])),s(Te(null)),s(je(null)),s(Re("")),s(Fe(null)),s(Be("")),s(Ne("")),o(!1)):(console.log("Closing without saving, clearing all card data"),s(Ie("")),s(_e("")),s(Ae([])),s(Te(null)),s(je(null)),s(Re("")),s(Fe(null)),s(Be("")),s(Ne("")),o(!1)),nt(!1)},Zn=function(){return pn(void 0,void 0,void 0,(function(){var e,t,n,r,a,l,c,u,d,f,p,g,h,m,y,v,x,E,k,I,_,T,j,R,O,P,B,N,L,z,D,M,U,q,W,V,$,G,H;return gn(this,(function(K){switch(K.label){case 0:if(0===(e=Object.keys(Tt).filter((function(e){return Tt[e]}))).length)return De("Please select at least one text option","warning"),[2];In.current=new AbortController,t=In.current.signal,console.log("*** MULTIPLE CARDS CREATION STARTED ***"),console.log("Image generation settings:",{imageGenerationMode:fe,modelProvider:ue,isImageGenerationAvailable:Wn(),selectedOptionsCount:e.length}),bt(!1),F(!0),i.setIsGeneratingCard(!0),K.label=1;case 1:K.trys.push([1,29,30,31]),n=[],r=0,a=e,K.label=2;case 2:if(!(r<a.length))return[3,28];if(l=a[r],t.aborted)return console.log("Multiple cards creation cancelled by user"),[2];s(Ie("")),s(_e("")),s(Ae([])),s(Be("")),s(Ie(l)),A(l),ie(!1),localStorage.removeItem("explicitly_saved"),K.label=3;case 3:return K.trys.push([3,26,,27]),[4,(0,en.createTranslation)(_n,Tn,l,b,w,void 0,t)];case 4:return c=K.sent(),t.aborted?(console.log("Multiple cards creation cancelled by user after translation"),[2]):(c.translated&&s(_e(c.translated)),u=Fr?xr:mr,[4,(0,en.createExamples)(_n,Tn,l,b,!0,w,u||void 0,t)]);case 5:return d=K.sent(),t.aborted?(console.log("Multiple cards creation cancelled by user after examples"),[2]):(d&&d.length>0&&(f=d.map((function(e){return[e.original,e.translated]})),s(Ae(f))),[4,(0,en.createFlashcard)(_n,Tn,l,t)]);case 6:return p=K.sent(),t.aborted?(console.log("Multiple cards creation cancelled by user after flashcard"),[2]):(p.front&&s(Re(p.front)),h="",(g=Fr?xr:mr)?(m=void 0,console.log('Using optimized linguistic info creation for "'.concat(l,'" (max 2 requests)')),[4,(0,en.createOptimizedLinguisticInfo)(_n,Tn,l,g,b)]):[3,8]);case 7:(m=K.sent()).linguisticInfo?(h=m.linguisticInfo,s(Be(m.linguisticInfo)),m.wasValidated?console.log('Linguistic info for "'.concat(l,'" created and validated')):console.warn('Linguistic info for "'.concat(l,'" created but not fully validated'))):console.warn('Failed to generate linguistic info for "'.concat(l,'"')),K.label=8;case 8:y="",K.label=9;case 9:return K.trys.push([9,15,,16]),(v=Fr?xr:mr)?(console.log('Creating transcription for "'.concat(l,'" using source language: ').concat(v,", user language: ").concat(b)),[4,(0,en.createTranscription)(_n,Tn,l,v,b)]):[3,13];case 10:return(x=K.sent())?[4,Hr(b)]:[3,12];case 11:E=K.sent(),(k=[x.userLanguageTranscription&&'<div class="transcription-item user-lang">\n                                            <span class="transcription-label">'.concat(E,':</span>\n                                            <span class="transcription-text">').concat(x.userLanguageTranscription,"</span>\n                                        </div>"),x.ipaTranscription&&'<div class="transcription-item ipa">\n                                            <span class="transcription-label">IPA:</span>\n                                            <span class="transcription-text">'.concat(x.ipaTranscription,"</span>\n                                        </div>")].filter(Boolean).join("\n"))&&(y=k,s(Ne(k)),console.log('Transcription created successfully for "'.concat(l,'"'))),K.label=12;case 12:return[3,14];case 13:console.warn('No source language available for transcription of "'.concat(l,'"')),K.label=14;case 14:return[3,16];case 15:return I=K.sent(),console.error('Transcription generation failed for "'.concat(l,'":'),I),[3,16];case 16:if(_=null,T=null,"off"===fe||!Wn())return[3,25];K.label=17;case 17:return K.trys.push([17,24,,25]),j="always"===fe,R="","smart"!==fe?[3,19]:[4,Kr(l)];case 18:O=K.sent(),j=O.shouldGenerate,R=O.reason,console.log('Smart image analysis for "'.concat(l,'": ').concat(j?"YES":"NO"," - ").concat(R)),K.label=19;case 19:return j?(console.log('Generating image for "'.concat(l,'"')),[4,_n.getDescriptionImage(Tn,l,S)]):[3,22];case 20:return P=K.sent(),[4,Ut(0,$e,se,P,S)];case 21:return B=K.sent(),N=B.imageUrl,L=B.imageBase64,N&&(_=N,console.log('Image URL generated for "'.concat(l,'": ').concat(N.substring(0,50),"..."))),L&&(T=L,console.log('Image base64 generated for "'.concat(l,'": ').concat(L.substring(0,50),"..."))),[3,23];case 22:"smart"===fe&&console.log('No image needed for "'.concat(l,'": ').concat(R)),K.label=23;case 23:return[3,25];case 24:return z=K.sent(),console.error('Image generation failed for "'.concat(l,'":'),z),[3,25];case 25:return D="general_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9),"_").concat(n.length),M={id:D,mode:C,text:l,translation:c.translated||"",examples:d.map((function(e){return[e.original,e.translated]})),linguisticInfo:h,transcription:y,front:p.front||"",back:c.translated||"",image:T,imageUrl:_,createdAt:new Date,exportStatus:"not_exported"},console.log("Created card ".concat(M.id," but NOT saving to storage yet. Image info:"),{hasImage:!!M.image,hasImageUrl:!!M.imageUrl,imageLength:null===(V=M.image)||void 0===V?void 0:V.length,imageUrlLength:null===($=M.imageUrl)||void 0===$?void 0:$.length}),n.push(M),[3,27];case 26:if((U=K.sent())instanceof Error&&Ve(U))throw console.error("Quota error detected, stopping multiple cards creation:",U.message),De(U.message),U;return console.error('Error creating card for "'.concat(l,'":'),U),De('Failed to create card for "'.concat(l.substring(0,20),'...": ').concat(U instanceof Error?U.message:"Unknown error"),"error"),[3,27];case 27:return r++,[3,2];case 28:return n.length>0?(Ot(n),Dt(0),Vt(n.length>1),(q=n[0])&&(console.log("Loading first card into Redux state:",{cardId:q.id,hasImage:!!q.image,hasImageUrl:!!q.imageUrl,imageLength:null===(G=q.image)||void 0===G?void 0:G.length,imageUrlLength:null===(H=q.imageUrl)||void 0===H?void 0:H.length}),"string"==typeof q.text&&s(Ie(q.text)),s(_e(void 0===q.translation?null:q.translation)),s(Ae(Array.isArray(q.examples)?q.examples:[])),s(Te(void 0===q.image?null:q.image)),s(je(void 0===q.imageUrl?null:q.imageUrl)),"string"==typeof q.front&&s(Re(q.front)),s(Fe(void 0===q.back?null:q.back)),s(Be(q.linguisticInfo||"")),q.transcription?s(Ne(q.transcription)):s(Ne("")),console.log("First card loaded into Redux state successfully")),ie(!1),Rn([]),localStorage.removeItem("explicitly_saved"),console.log("Reset saved status for new multiple cards"),Rn([]),localStorage.removeItem("explicitly_saved"),ie(!1),o(!0),nt(!0),console.log("Created new cards, none saved yet. Card IDs:",n.map((function(e){return e.id})))):De("Failed to create cards. Please try again.","error"),[3,31];case 29:if(W=K.sent(),t.aborted)throw console.log("Multiple cards creation was cancelled by user"),new Error("Operation cancelled by user");return W instanceof Error&&Ve(W)?(console.error("Quota error detected in multiple cards creation:",W.message),De(W.message),[2]):(console.error("Error processing selected options:",W),De(W instanceof Error?W.message:"Failed to create cards. Please try again."),[3,31]);case 30:return console.log("🎯 Multiple cards creation finally block reached"),setTimeout((function(){console.log("⏳ Checking for pending operations in multiple cards creation...");var e=(0,Lt.cr)(),t=e.getStats(),n=t.inProgress>0;console.log("📊 Multiple cards tracker stats:",t),n?(console.log("⏸️ Keeping loader visible for multiple cards - operations still running"),setTimeout((function(){console.log("⏳ Final check for multiple cards..."),0===e.getStats().inProgress&&(console.log("✅ Multiple cards operations completed - hiding loader"),F(!1),i.setIsGeneratingCard(!1),jt({}))}),3e3)):(console.log("✅ No pending operations in multiple cards - hiding loader"),F(!1),i.setIsGeneratingCard(!1),jt({}))}),1e3),In.current=null,[7];case 31:return[2]}}))}))},er=function(e){!function(e){jt((function(t){var n;return fn(fn({},t),((n={})[e]=!t[e],n))}))}(e)},tr=function(){if(!(Rt.length<=1||Bt>=Rt.length-1)){nr();var e=Bt+1;console.log("Moving from card ".concat(Bt," to card ").concat(e));var t=Rt[e];t&&(console.log("Loading next card data: ".concat(t.id,", text: ").concat(t.text,", linguistic info: ").concat(t.linguisticInfo?"yes":"no")),rr(t),Dt(e))}},nr=function(){if(Rt[Bt]){console.log("Saving current card state:",{index:Bt,text:c,linguisticInfo:v?v.substring(0,30)+"...":"empty"});var e=fn(fn({},Rt[Bt]),{text:c,translation:u,examples:d,image:f,imageUrl:p,front:g,back:h||null,linguisticInfo:v||"",transcription:x||""}),t=hn([],Rt,!0);t[Bt]=e,Ot(t),console.log("Updated card saved:",e.id)}},rr=function(e){var t,n;console.log("Loading card data for card:",{id:e.id,text:e.text,hasLinguisticInfo:Boolean(e.linguisticInfo),hasImage:!!e.image,hasImageUrl:!!e.imageUrl,imageLength:null===(t=e.image)||void 0===t?void 0:t.length,imageUrlLength:null===(n=e.imageUrl)||void 0===n?void 0:n.length}),s(Ie("")),s(_e(null)),s(Ae([])),s(Te(null)),s(je(null)),s(Re("")),s(Fe(null)),s(Be("")),s(Ne("")),"string"==typeof e.text&&s(Ie(e.text)),s(_e(void 0===e.translation?null:e.translation)),s(Ae(Array.isArray(e.examples)?e.examples:[])),s(Te(void 0===e.image?null:e.image)),s(je(void 0===e.imageUrl?null:e.imageUrl)),"string"==typeof e.front&&s(Re(e.front)),s(Fe(void 0===e.back?null:e.back)),e.linguisticInfo?(console.log("Setting linguistic info:",e.linguisticInfo.substring(0,30)+"..."),s(Be(e.linguisticInfo))):(console.log("No linguistic info found for this card"),s(Be(""))),e.transcription?(console.log("Setting transcription:",e.transcription.substring(0,30)+"..."),s(Ne(e.transcription))):(console.log("No transcription found for this card"),s(Ne(""))),console.log("Card data loaded successfully, image status:",{hasImage:!!e.image,hasImageUrl:!!e.imageUrl})},or=function(){if(!(Rt.length<=1||Bt<=0)){nr();var e=Bt-1;console.log("Moving from card ".concat(Bt," to card ").concat(e));var t=Rt[e];t&&(console.log("Loading previous card data: ".concat(t.id,", text: ").concat(t.text,", linguistic info: ").concat(t.linguisticInfo?"yes":"no")),rr(t),Dt(e))}},ar=[{code:"ru",name:"Русский",flag:"🇷🇺",englishName:"Russian"},{code:"en",name:"English",flag:"🇬🇧",englishName:"English"},{code:"es",name:"Español",flag:"🇪🇸",englishName:"Spanish"},{code:"fr",name:"Français",flag:"🇫🇷",englishName:"French"},{code:"de",name:"Deutsch",flag:"🇩🇪",englishName:"German"},{code:"it",name:"Italiano",flag:"🇮🇹",englishName:"Italian"},{code:"pt",name:"Português",flag:"🇵🇹",englishName:"Portuguese"},{code:"ja",name:"日本語",flag:"🇯🇵",englishName:"Japanese"},{code:"ko",name:"한국어",flag:"🇰🇷",englishName:"Korean"},{code:"zh",name:"中文",flag:"🇨🇳",englishName:"Chinese"},{code:"ar",name:"العربية",flag:"🇦🇪",englishName:"Arabic"},{code:"hi",name:"हिंदी",flag:"🇮🇳",englishName:"Hindi"},{code:"bn",name:"বাংলা",flag:"🇧🇩",englishName:"Bengali"},{code:"tr",name:"Türkçe",flag:"🇹🇷",englishName:"Turkish"},{code:"pl",name:"Polski",flag:"🇵🇱",englishName:"Polish"},{code:"nl",name:"Nederlands",flag:"🇳🇱",englishName:"Dutch"},{code:"cs",name:"Čeština",flag:"🇨🇿",englishName:"Czech"},{code:"sv",name:"Svenska",flag:"🇸🇪",englishName:"Swedish"},{code:"vi",name:"Tiếng Việt",flag:"🇻🇳",englishName:"Vietnamese"},{code:"th",name:"ภาษาไทย",flag:"🇹🇭",englishName:"Thai"},{code:"he",name:"עִבְרִית",flag:"🇮🇱",englishName:"Hebrew"},{code:"id",name:"Bahasa Indonesia",flag:"🇮🇩",englishName:"Indonesian"},{code:"uk",name:"Українська",flag:"🇺🇦",englishName:"Ukrainian"},{code:"el",name:"Ελληνικά",flag:"🇬🇷",englishName:"Greek"},{code:"ro",name:"Română",flag:"🇷🇴",englishName:"Romanian"},{code:"hu",name:"Magyar",flag:"🇭🇺",englishName:"Hungarian"},{code:"fi",name:"Suomi",flag:"🇫🇮",englishName:"Finnish"},{code:"da",name:"Dansk",flag:"🇩🇰",englishName:"Danish"},{code:"no",name:"Norsk",flag:"🇳🇴",englishName:"Norwegian"},{code:"sk",name:"Slovenčina",flag:"🇸🇰",englishName:"Slovak"},{code:"lt",name:"Lietuvių",flag:"🇱🇹",englishName:"Lithuanian"},{code:"lv",name:"Latviešu",flag:"🇱🇻",englishName:"Latvian"},{code:"bg",name:"Български",flag:"🇧🇬",englishName:"Bulgarian"},{code:"hr",name:"Hrvatski",flag:"🇭🇷",englishName:"Croatian"},{code:"sr",name:"Српски",flag:"🇷🇸",englishName:"Serbian"},{code:"et",name:"Eesti",flag:"🇪🇪",englishName:"Estonian"},{code:"sl",name:"Slovenščina",flag:"🇸🇮",englishName:"Slovenian"}],ir=(0,r.useState)(!1),sr=ir[0],lr=ir[1],cr=(0,r.useState)(""),ur=cr[0],dr=cr[1],fr=(0,r.useMemo)((function(){if(!ur)return ar;var e=ur.toLowerCase();return ar.filter((function(t){return t.name.toLowerCase().includes(e)||t.englishName.toLowerCase().includes(e)||t.code.toLowerCase().includes(e)}))}),[ur]),pr=(0,r.useMemo)((function(){return ar.find((function(e){return e.code===b}))||ar[0]}),[b]),gr=function(){return sr?(0,a.jsx)("div",fn({style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(2px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"16px"},onClick:function(){return lr(!1)}},{children:(0,a.jsxs)("div",fn({style:{backgroundColor:"#FFFFFF",borderRadius:"12px",width:"90%",maxWidth:"360px",maxHeight:"80vh",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",overflow:"hidden",display:"flex",flexDirection:"column"},onClick:function(e){return e.stopPropagation()}},{children:[(0,a.jsxs)("div",fn({style:{padding:"16px",borderBottom:"1px solid #E5E7EB",display:"flex",flexDirection:"column",gap:"12px"}},{children:[(0,a.jsxs)("div",fn({style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},{children:[(0,a.jsx)("h3",fn({style:{margin:0,fontSize:"16px",fontWeight:600,color:"#111827"}},{children:"Select Your Language"})),(0,a.jsx)("button",fn({onClick:function(){return lr(!1)},style:{background:"none",border:"none",cursor:"pointer",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"6px"}},{children:(0,a.jsx)("svg",fn({xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"#6B7280",viewBox:"0 0 16 16"},{children:(0,a.jsx)("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})}))}))]})),(0,a.jsxs)("div",fn({style:{position:"relative",width:"100%"}},{children:[(0,a.jsx)("input",{type:"text",value:ur,onChange:function(e){return dr(e.target.value)},placeholder:"Search languages...",style:{width:"100%",padding:"10px 12px 10px 36px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#F9FAFB",fontSize:"14px",color:"#374151",outline:"none"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}}),(0,a.jsx)("svg",fn({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"#9CA3AF",viewBox:"0 0 16 16",style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)"}},{children:(0,a.jsx)("path",{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"})})),ur&&(0,a.jsx)("button",fn({onClick:function(){return dr("")},style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",backgroundColor:"#E5E7EB"}},{children:(0,a.jsx)("svg",fn({xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"#6B7280",viewBox:"0 0 16 16"},{children:(0,a.jsx)("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})}))}))]})),(0,a.jsx)("p",fn({style:{margin:0,fontSize:"12px",color:"#6B7280",lineHeight:1.5}},{children:"This will be used for both the interface language and translations. Your cards will be created in this language."}))]})),(0,a.jsx)("div",fn({style:{overflowY:"auto",maxHeight:"calc(80vh - 135px)",padding:"8px 0"}},{children:0===fr.length?(0,a.jsxs)("div",fn({style:{padding:"16px",textAlign:"center",color:"#6B7280",fontSize:"14px"}},{children:['No languages found matching "',ur,'"']})):fr.map((function(e){return(0,a.jsxs)("button",fn({onClick:function(){s((0,We._W)(e.code)),lr(!1)},style:{display:"flex",alignItems:"center",width:"100%",padding:"12px 16px",backgroundColor:e.code===b?"#EFF6FF":"transparent",border:"none",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s"},onMouseOver:function(t){e.code!==b&&(t.currentTarget.style.backgroundColor="#F3F4F6")},onMouseOut:function(t){e.code!==b&&(t.currentTarget.style.backgroundColor="transparent")}},{children:[(0,a.jsx)("span",fn({style:{fontSize:"22px",marginRight:"12px",width:"28px",textAlign:"center"}},{children:e.flag})),(0,a.jsxs)("div",fn({style:{display:"flex",flexDirection:"column",alignItems:"flex-start"}},{children:[(0,a.jsx)("span",fn({style:{color:e.code===b?"#2563EB":"#111827",fontWeight:e.code===b?"600":"normal",fontSize:"14px"}},{children:e.name})),e.englishName!==e.name&&(0,a.jsx)("span",fn({style:{color:"#6B7280",fontSize:"12px"}},{children:e.englishName}))]})),e.code===b&&(0,a.jsx)("svg",fn({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"#2563EB",viewBox:"0 0 16 16",style:{marginLeft:"auto"}},{children:(0,a.jsx)("path",{d:"M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"})}))]}),e.code)}))}))]}))})):(0,a.jsxs)("div",fn({style:{position:"relative",width:"100%",display:"flex",flexDirection:"column",gap:"8px"}},{children:[(0,a.jsxs)("label",fn({style:{color:"#111827",fontWeight:"600",fontSize:"14px",margin:0,display:"flex",alignItems:"center",gap:"6px"}},{children:["Your Language",(0,a.jsx)("span",fn({style:{fontSize:"12px",color:"#6B7280",fontWeight:"normal",fontStyle:"italic"}},{children:"(translations)"}))]})),(0,a.jsxs)("button",fn({onClick:function(){return lr(!0)},style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#F9FAFB",color:"#374151",fontSize:"14px",cursor:"pointer",transition:"all 0.2s ease",textAlign:"left"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="#F3F4F6"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="#F9FAFB"}},{children:[(0,a.jsxs)("span",fn({style:{display:"flex",alignItems:"center",gap:"8px"}},{children:[(0,a.jsx)("span",fn({style:{fontSize:"18px"}},{children:pr.flag})),(0,a.jsx)("span",{children:pr.name})]})),(0,a.jsx)("svg",fn({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},{children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"})}))]}))]}))},hr=(0,r.useState)((function(){return localStorage.getItem("source_language")||""})),mr=hr[0],yr=hr[1],vr=(0,r.useState)((function(){return localStorage.getItem("detected_language")||null})),xr=vr[0],br=vr[1],wr=(0,r.useState)(!1),Sr=wr[0],Cr=wr[1],Er=(0,r.useState)(!1),kr=Er[0],Ir=Er[1],Ar=(0,r.useState)(""),_r=Ar[0],Tr=Ar[1],jr=(0,r.useState)((function(){return"false"!==localStorage.getItem("auto_detect_language")})),Fr=jr[0],Rr=jr[1],Or=(0,r.useMemo)((function(){if(!_r)return ar;var e=_r.toLowerCase();return ar.filter((function(t){return t.name.toLowerCase().includes(e)||t.englishName.toLowerCase().includes(e)||t.code.toLowerCase().includes(e)}))}),[_r]),Pr=(0,r.useMemo)((function(){return mr?ar.find((function(e){return e.code===mr}))||null:xr&&ar.find((function(e){return e.code===xr}))||null}),[mr,xr]),Br=(0,r.useState)(!1),Nr=(Br[0],Br[1]),Lr=(0,r.useCallback)((function(e){var t=e.trim().toLowerCase();if(/[а-яё]/i.test(t))return"ru";if(/^[a-z\s\.,!?\-'"]+$/i.test(t)){var n=["the","and","is","in","to","of","a","for","with","on","at","by","from","this","that","it","he","she","they","we","you","was","were","are","have","has","had","can","will","would","could","should"],r=t.split(/\s+/);if(r.filter((function(e){return n.includes(e.replace(/[^\w]/g,""))})).length>0||1===r.length)return"en"}return/[ñáéíóúü]/i.test(t)?"es":/[àâäéèêëïîôöùûüÿç]/i.test(t)?"fr":/[äöüß]/i.test(t)?"de":/[àèéìíîòóù]/i.test(t)?"it":null}),[]),zr=(0,r.useCallback)((function(e){var t=e.trim().toLowerCase(),n=t.replace(/[а-яё]/g,"C").replace(/[a-z]/g,"L").replace(/[0-9]/g,"N").replace(/\s+/g,"S").replace(/[^\w\s]/g,"P").slice(0,50);return"lang_pattern_".concat(n,"_").concat(t.length<20?t:t.slice(0,20))}),[]),Dr=(0,r.useCallback)((function(e){return pn(void 0,void 0,void 0,(function(){var t,n,r,o,a,i,s,c,u,d,f,p,g,h,m,y,v,x,b,w,S,C,E,k,I,A,_,T,j,F,R,O,P,B,N,L,z,D,M;return gn(this,(function(U){switch(U.label){case 0:if(console.log("=== LANGUAGE DETECTION START ==="),console.log("Input text:",e.substring(0,100)+(e.length>100?"...":"")),console.log("Text length:",e.length),!e||e.trim().length<2)return console.log("Text too short for language detection"),[2];if(t=Lr(e))return console.log("Language detected offline:",t),br(t),l(t),n=zr(e),localStorage.setItem(n,t),[2];if(r=zr(e),(o=localStorage.getItem(r))&&xr!==o)return console.log("Using smart cached language detection result:",o),br(o),l(o),[2];if(xr&&o===xr)return console.log("Language already detected for this text:",xr),[2];if((0,qe.isQuotaExceededCached)())return console.log("Language detection skipped due to cached quota error"),(0,qe.shouldShowQuotaNotification)()&&(d=(0,qe.getCachedQuotaError)())&&(De(d),(0,qe.markQuotaNotificationShown)()),[2];if(a=localStorage.getItem("last_language_api_call"),i=Date.now(),a&&i-parseInt(a)<2e3)return console.log("Language detection API call skipped - too frequent calls"),[2];console.log("Making API call for language detection..."),localStorage.setItem("last_language_api_call",i.toString()),Cr(!0),U.label=1;case 1:if(U.trys.push([1,14,15,16]),!(ue===tn.l.OpenAI&&se||ue===tn.l.Groq&&le))return[3,12];if(ue!==tn.l.OpenAI)return[3,6];if((0,qe.isQuotaExceededCached)()){if(console.log("OpenAI language detection skipped due to cached quota error"),(0,qe.shouldShowQuotaNotification)()&&(d=(0,qe.getCachedQuotaError)()))throw new Error(d);return[2]}U.label=2;case 2:return U.trys.push([2,4,,5]),[4,$e.chat.completions.create({model:"gpt-5-nano",messages:[{role:"system",content:"You are a language detection assistant. Respond only with the ISO 639-1 language code."},{role:"user",content:"Detect the language of this text and respond only with the ISO 639-1 language code (e.g. 'en', 'ru', 'fr', etc.): \"".concat(e,'"')}]})];case 3:return c=U.sent(),s=null===(R=c.choices[0].message.content)||void 0===R?void 0:R.trim().toLowerCase(),console.log("Language detected via OpenAI:",s),[3,5];case 4:throw(u=U.sent())instanceof Error&&((x=u.message).includes("quota")||x.includes("insufficient_quota")||x.includes("billing")||x.includes("exceeded")||x.includes("429"))&&((0,qe.cacheQuotaExceededError)(x),console.log("Quota error detected and cached in OpenAI language detection")),u;case 5:return[3,11];case 6:if(ue!==tn.l.Groq)return[3,11];if((0,qe.isQuotaExceededCached)()){if(console.log("Groq language detection skipped due to cached quota error"),(0,qe.shouldShowQuotaNotification)()&&(d=(0,qe.getCachedQuotaError)()))throw new Error(d);return[2]}return[4,fetch("https://api.groq.com/openai/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(le)},body:JSON.stringify({model:ce,messages:[{role:"system",content:"You are a language detection assistant. Respond only with the ISO 639-1 language code."},{role:"user",content:"Detect the language of this text and respond only with the ISO 639-1 language code (e.g. 'en', 'ru', 'fr', etc.): \"".concat(e,'"')}]})})];case 7:return(f=U.sent()).ok?[3,9]:[4,f.json()];case 8:if(p=U.sent(),x="Groq API error: ".concat(f.status," ").concat(f.statusText," - ").concat(JSON.stringify(p)),429===f.status||p&&((null===(P=null===(O=p.error)||void 0===O?void 0:O.includes)||void 0===P?void 0:P.call(O,"quota"))||(null===(N=null===(B=p.error)||void 0===B?void 0:B.includes)||void 0===N?void 0:N.call(B,"limit"))))throw new Error("API rate limit exceeded. Please try again in a few minutes.");throw new Error(x);case 9:return[4,f.json()];case 10:g=U.sent(),s=null===(M=null===(D=null===(z=null===(L=g.choices)||void 0===L?void 0:L[0])||void 0===z?void 0:z.message)||void 0===D?void 0:D.content)||void 0===M?void 0:M.trim().toLowerCase(),console.log("Language detected via Groq:",s),U.label=11;case 11:return s&&ar.some((function(e){return e.code===s}))?(console.log("Language successfully detected:",s),br(s),localStorage.setItem("detected_language",s),h=zr(e),localStorage.setItem(h,s),l(s)):console.log("Invalid or unrecognized language code:",s),[3,13];case 12:m=e.trim().toLowerCase().slice(0,100),S=/[а-яё]/gi,C=/[a-z]/gi,E=/[\u4e00-\u9fff]/gi,k=/[\u3040-\u309f\u30a0-\u30ff]/gi,I=/[\uac00-\ud7af]/gi,A=/[\u0600-\u06ff]/gi,_=/[áéíóúüñ¿¡]/gi,T=["hasta","desde","como","pero","porque","adonde","quien","para","por"].some((function(e){return m===e||m.startsWith(e+" ")||m.includes(" "+e+" ")})),j="",S.test(m)?(console.log("Detected Cyrillic script - setting Russian"),j="ru"):E.test(m)?(console.log("Detected Chinese characters"),j="zh"):k.test(m)?(console.log("Detected Japanese characters"),j="ja"):I.test(m)?(console.log("Detected Korean characters"),j="ko"):A.test(m)?(console.log("Detected Arabic script"),j="ar"):_.test(m)||T?(console.log("Detected Spanish text or common Spanish word"),j="es"):C.test(m)&&(console.log("Detected Latin script, defaulting to English"),j="en"),j&&(console.log("Language detected using fallback method:",j),br(j),localStorage.setItem("detected_language",j),y=zr(e),localStorage.setItem(y,j),l(j)),U.label=13;case 13:return[3,16];case 14:return v=U.sent(),console.error("Error detecting language:",v),v instanceof Error&&Ve(v)?(console.error("Quota error detected in language detection:",v.message),De(v.message),(0,qe.markQuotaNotificationShown)(),[2]):(x=v instanceof Error?v.message:String(v),(x.includes("401")||x.includes("Unauthorized")||x.includes("Authentication")||x.includes("Invalid API key")||x.includes("Incorrect API key")||x.includes("API key is missing"))&&(console.warn("API key error detected, disabling auto-detection to prevent infinite retries"),Rr(!1),localStorage.setItem("auto_detect_language","false"),b=ue===tn.l.OpenAI?"OpenAI":ue===tn.l.Groq?"Groq":"AI","function"==typeof De&&De("Language detection failed: Invalid ".concat(b," API key. Please check your API key in settings."),"error"),w=e.trim().toLowerCase().slice(0,100),S=/[а-яё]/gi,C=/[a-z]/gi,E=/[\u4e00-\u9fff]/gi,k=/[\u3040-\u309f\u30a0-\u30ff]/gi,I=/[\uac00-\ud7af]/gi,A=/[\u0600-\u06ff]/gi,_=/[áéíóúüñ¿¡]/gi,T=["hasta","desde","como","pero","porque","adonde","quien","para","por"].some((function(e){return w===e||w.startsWith(e+" ")||w.includes(" "+e+" ")})),j="",S.test(w)?j="ru":E.test(w)?j="zh":k.test(w)?j="ja":I.test(w)?j="ko":A.test(w)?j="ar":_.test(w)||T?j="es":C.test(w)&&(j="en"),j&&(console.log("Language detected using fallback method in error handler:",j),br(j),localStorage.setItem("detected_language",j),F=zr(e),localStorage.setItem(F,j),l(j))),[3,16]);case 15:return Cr(!1),console.log("=== LANGUAGE DETECTION END ==="),[7];case 16:return[2]}}))}))}),[$e,se,ue,le,ce,s,ar]);(0,r.useEffect)((function(){if(c&&c.trim().length>2&&Fr){if((0,qe.isQuotaExceededCached)()){if(console.log("Language detection skipped in useEffect due to cached quota error"),(0,qe.shouldShowQuotaNotification)()){var e=(0,qe.getCachedQuotaError)();e&&(De(e),(0,qe.markQuotaNotificationShown)())}return}var t=setTimeout((function(){console.log("Attempting to detect language for text:",c.substring(0,50)+"..."),Dr(c)}),1500);return function(){return clearTimeout(t)}}}),[c,Dr,Fr]);var Mr=function(){var e=!Fr;if(Rr(e),localStorage.setItem("auto_detect_language",e?"true":"false"),Fr)xr&&l(xr);else if(l(""),c){if((0,qe.isQuotaExceededCached)()){if(console.log("Language detection skipped in toggleAutoDetect due to cached quota error"),(0,qe.shouldShowQuotaNotification)()){var t=(0,qe.getCachedQuotaError)();t&&(De(t),(0,qe.markQuotaNotificationShown)())}return}Dr(c)}},Ur=function(){return kr?(0,a.jsx)("div",fn({style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(2px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"16px"},onClick:function(){return Ir(!1)}},{children:(0,a.jsxs)("div",fn({style:{backgroundColor:"#FFFFFF",borderRadius:"12px",width:"90%",maxWidth:"360px",maxHeight:"80vh",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",overflow:"hidden",display:"flex",flexDirection:"column"},onClick:function(e){return e.stopPropagation()}},{children:[(0,a.jsxs)("div",fn({style:{padding:"16px",borderBottom:"1px solid #E5E7EB",display:"flex",flexDirection:"column",gap:"12px"}},{children:[(0,a.jsxs)("div",fn({style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},{children:[(0,a.jsxs)("h3",fn({style:{margin:0,fontSize:"16px",fontWeight:600,color:"#111827",display:"flex",alignItems:"center",gap:"8px"}},{children:[(0,a.jsx)(ht,{color:"#6366F1",size:18}),(0,a.jsx)("span",{children:"Select Source Language"})]})),(0,a.jsx)("button",fn({onClick:function(){return Ir(!1)},style:{background:"none",border:"none",cursor:"pointer",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"6px"}},{children:(0,a.jsx)("svg",fn({xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"#6B7280",viewBox:"0 0 16 16"},{children:(0,a.jsx)("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})}))}))]})),(0,a.jsxs)("div",fn({style:{position:"relative",width:"100%"}},{children:[(0,a.jsx)("input",{type:"text",value:_r,onChange:function(e){return Tr(e.target.value)},placeholder:"Search languages...",style:{width:"100%",padding:"10px 12px 10px 36px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#F9FAFB",fontSize:"14px",color:"#374151",outline:"none"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}}),(0,a.jsx)("svg",fn({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"#9CA3AF",viewBox:"0 0 16 16",style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)"}},{children:(0,a.jsx)("path",{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"})})),_r&&(0,a.jsx)("button",fn({onClick:function(){return Tr("")},style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",backgroundColor:"#E5E7EB"}},{children:(0,a.jsx)("svg",fn({xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"#6B7280",viewBox:"0 0 16 16"},{children:(0,a.jsx)("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})}))}))]})),(0,a.jsx)("p",fn({style:{margin:0,fontSize:"12px",color:"#6B7280",lineHeight:1.5}},{children:"Select the language of your text. This helps generate more accurate translations and examples."}))]})),(0,a.jsx)("div",fn({style:{overflowY:"auto",maxHeight:"calc(80vh - 135px)",padding:"8px 0"}},{children:0===Or.length?(0,a.jsxs)("div",fn({style:{padding:"16px",textAlign:"center",color:"#6B7280",fontSize:"14px"}},{children:['No languages found matching "',_r,'"']})):Or.map((function(e){return(0,a.jsxs)("button",fn({onClick:function(){yr(e.code),Ir(!1),Rr(!1)},style:{display:"flex",alignItems:"center",width:"100%",padding:"12px 16px",backgroundColor:e.code===mr?"#EFF6FF":"transparent",border:"none",textAlign:"left",cursor:"pointer",transition:"background-color 0.2s"},onMouseOver:function(t){e.code!==mr&&(t.currentTarget.style.backgroundColor="#F3F4F6")},onMouseOut:function(t){e.code!==mr&&(t.currentTarget.style.backgroundColor="transparent")}},{children:[(0,a.jsx)("span",fn({style:{fontSize:"22px",marginRight:"12px",width:"28px",textAlign:"center"}},{children:e.flag})),(0,a.jsxs)("div",fn({style:{display:"flex",flexDirection:"column",alignItems:"flex-start"}},{children:[(0,a.jsx)("span",fn({style:{color:e.code===mr?"#2563EB":"#111827",fontWeight:e.code===mr?"600":"normal",fontSize:"14px"}},{children:e.name})),e.englishName!==e.name&&(0,a.jsx)("span",fn({style:{color:"#6B7280",fontSize:"12px"}},{children:e.englishName}))]})),e.code===mr&&(0,a.jsx)("svg",fn({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"#2563EB",viewBox:"0 0 16 16",style:{marginLeft:"auto"}},{children:(0,a.jsx)("path",{d:"M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"})}))]}),e.code)}))}))]}))})):(0,a.jsxs)("div",fn({style:{position:"relative",width:"100%",display:"flex",flexDirection:"column",gap:"8px"}},{children:[(0,a.jsxs)("div",fn({style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"}},{children:[(0,a.jsxs)("label",fn({style:{color:"#111827",fontWeight:"600",fontSize:"14px",margin:0,display:"flex",alignItems:"center",gap:"6px"}},{children:[(0,a.jsx)("span",{children:"Source Language"}),(0,a.jsx)("span",fn({style:{fontSize:"12px",color:"#6B7280",fontWeight:"normal",fontStyle:"italic"}},{children:"(of your text)"}))]})),(0,a.jsxs)("div",fn({style:{display:"flex",alignItems:"center",gap:"8px"}},{children:[(0,a.jsx)("span",fn({style:{fontSize:"12px",color:Fr?"#10B981":"#9CA3AF",transition:"color 0.2s ease"}},{children:"Auto"})),(0,a.jsx)("button",fn({onClick:Mr,style:{width:"36px",height:"20px",backgroundColor:Fr?"#10B981":"#E5E7EB",border:"none",borderRadius:"10px",position:"relative",cursor:"pointer",transition:"background-color 0.2s ease"}},{children:(0,a.jsx)("span",{style:{position:"absolute",width:"16px",height:"16px",backgroundColor:"white",borderRadius:"50%",top:"2px",left:Fr?"18px":"2px",transition:"left 0.2s ease",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.1)"}})}))]}))]})),(0,a.jsxs)("button",fn({onClick:function(){return Ir(!0)},disabled:Fr,style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:Fr?"#F3F4F6":"#F9FAFB",color:"#374151",fontSize:"14px",cursor:Fr?"not-allowed":"pointer",opacity:Fr?.7:1,transition:"all 0.2s ease",textAlign:"left"},onMouseOver:function(e){return!Fr&&(e.currentTarget.style.backgroundColor="#F3F4F6")},onMouseOut:function(e){return!Fr&&(e.currentTarget.style.backgroundColor="#F9FAFB")}},{children:[(0,a.jsx)("span",fn({style:{display:"flex",alignItems:"center",gap:"8px"}},{children:Sr?(0,a.jsx)(_t,{type:"spinner",size:"small",inline:!0,color:"#6B7280"}):Pr?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",fn({style:{fontSize:"18px"}},{children:Pr.flag})),(0,a.jsx)("span",{children:Pr.name}),Fr&&(0,a.jsxs)("span",fn({style:{fontSize:"12px",color:"#10B981",backgroundColor:"#ECFDF5",padding:"2px 6px",borderRadius:"4px",marginLeft:"4px",display:"flex",alignItems:"center",gap:"3px"}},{children:[(0,a.jsx)(Ze,{size:10}),(0,a.jsx)("span",{children:"Detected"})]}))]}):(0,a.jsx)("span",fn({style:{color:"#9CA3AF"}},{children:Fr?"Detecting language...":"Select source language"}))})),!Fr&&(0,a.jsx)("svg",fn({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},{children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"})}))]})),(0,a.jsxs)("div",fn({style:{display:"flex",alignItems:"center",gap:"8px",padding:"6px 8px",backgroundColor:"#F3F4F6",borderRadius:"6px",marginTop:"4px"}},{children:[(0,a.jsxs)("div",fn({style:{display:"flex",alignItems:"center",gap:"4px"}},{children:[(0,a.jsx)("span",fn({style:{fontSize:"14px"}},{children:Pr?Pr.flag:"🌐"})),(0,a.jsx)(ct,{size:12,color:"#6B7280"}),(0,a.jsx)("span",fn({style:{fontSize:"14px"}},{children:pr.flag}))]})),(0,a.jsxs)("span",fn({style:{fontSize:"12px",color:"#4B5563"}},{children:["Translating ",Pr?"from ".concat(Pr.englishName):""," to ",pr.englishName]})),Fr&&(0,a.jsx)("button",fn({onClick:function(){if((0,qe.isQuotaExceededCached)()){if(console.log("Language detection reset skipped due to cached quota error"),(0,qe.shouldShowQuotaNotification)()){var e=(0,qe.getCachedQuotaError)();e&&(De(e),(0,qe.markQuotaNotificationShown)())}}else c&&(console.log("Manually triggering language detection for:",c.substring(0,50)+"..."),Dr(c))},title:"Reset language detection",style:{marginLeft:"auto",background:"none",border:"none",display:"flex",padding:"2px",cursor:"pointer",color:"#6B7280"}},{children:(0,a.jsxs)("svg",fn({xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",fill:"currentColor",viewBox:"0 0 16 16"},{children:[(0,a.jsx)("path",{d:"M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"}),(0,a.jsx)("path",{d:"M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"})]}))}))]}))]}))},qr=function(e){s(Be(e)),Pn&&Y(!0)};(0,r.useEffect)((function(){var e=localStorage.getItem("source_language"),t=localStorage.getItem("detected_language"),n=localStorage.getItem("auto_detect_language");console.log("Initializing language settings from localStorage:",{savedSourceLanguage:e,savedDetectedLanguage:t,savedAutoDetect:n}),e?l(e):t&&"false"!==n&&l(t),"false"===n&&Rr(!1)}),[]);var Wr,Vr,$r,Gr=(0,r.useCallback)((function(e){return pn(void 0,void 0,void 0,(function(){var t,n,r,o;return gn(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),Tn?(t='Return only the native name of the language with ISO 639-1 code "'.concat(e,'".\nExamples: \n- "en" -> "English"\n- "ru" -> "Русский" \n- "es" -> "Español"\n- "fr" -> "Français"\n- "de" -> "Deutsch"\n- "zh" -> "中文"\n- "ja" -> "日本語"\n- "ar" -> "العربية"\n\nRespond with ONLY the native language name, no additional text.'),[4,_n.createChatCompletion(Tn,[{role:"user",content:t}])]):[2,e.toUpperCase()];case 1:return(n=a.sent())&&n.content?(r=n.content.trim(),localStorage.setItem("language_name_".concat(e),r),[2,r]):[2,e.toUpperCase()];case 2:return o=a.sent(),console.error("Error getting language name from AI:",o),[2,e.toUpperCase()];case 3:return[2]}}))}))}),[Tn,_n]),Hr=(0,r.useCallback)((function(e){return pn(void 0,void 0,void 0,(function(){var t;return gn(this,(function(n){switch(n.label){case 0:return(t=localStorage.getItem("language_name_".concat(e)))?[2,t]:[4,Gr(e)];case 1:return[2,n.sent()]}}))}))}),[Gr]),Kr=(0,r.useCallback)((function(e){return pn(void 0,void 0,void 0,(function(){var t,n,r,o,a,i;return gn(this,(function(s){switch(s.label){case 0:if(!e||0===e.trim().length)return[2,{shouldGenerate:!1,reason:"No text provided"}];s.label=1;case 1:return s.trys.push([1,3,,4]),t='Analyze this word/phrase and determine if a visual image would be helpful for language learning: "'.concat(e,'"\n\nConsider these criteria:\n- Concrete objects, animals, places, foods, tools, vehicles = YES\n- Abstract concepts, emotions, actions, grammar terms = NO\n- People, professions, activities that can be visualized = YES\n- Numbers, prepositions, conjunctions, abstract ideas = NO\n\nRespond with ONLY "YES" or "NO" followed by a brief reason (max 10 words).\nFormat: "YES - concrete object that can be visualized" or "NO - abstract concept"'),[4,_n.createChatCompletion(Tn,[{role:"user",content:t}])];case 2:return(n=s.sent())&&n.content?(r=n.content.trim(),o=r.toUpperCase().startsWith("YES"),a=r.includes(" - ")?r.split(" - ")[1]:"AI analysis",[2,{shouldGenerate:o,reason:a}]):[2,{shouldGenerate:!1,reason:"AI analysis failed"}];case 3:return i=s.sent(),console.error("Error analyzing text for image generation:",i),[2,{shouldGenerate:!1,reason:"Analysis error"}];case 4:return[2]}}))}))}),[_n,Tn]),Qr=function(e){s((0,We.BE)(e)),"smart"===e||"always"===e?(console.log("🔧 Automatically enabling shouldGenerateImage for ".concat(e," mode")),s((0,We.yo)(!0)),setTimeout((function(){console.log("🔍 Verification: shouldGenerateImage should now be true for ".concat(e," mode"))}),100)):"off"===e&&(console.log("🔧 Disabling shouldGenerateImage for off mode"),s((0,We.yo)(!1))),"always"===e&&c&&Wn()&&Dn(),"off"===e&&(s(Te(null)),s(je(null)))},Yr=(0,r.useCallback)((function(e,t,n){return pn(void 0,void 0,void 0,(function(){var r,a,i,l,c,u,d,f,p,g,h,m,y,v,x,b,w,C;return gn(this,(function(E){switch(E.label){case 0:if(!t.trim())return De("Please enter some text to create a card from","error"),[2];E.label=1;case 1:return E.trys.push([1,9,10,11]),r=n||e.prompt,a="".concat(r,'\n\nText: "').concat(t,'"\n\nProvide a clear, educational response that would work well as flashcard content. Be concise but informative.'),[4,_n.translateText(a,"en")];case 2:if(!(i=E.sent()))throw new Error("Failed to generate card content");if(l=e.name,c=i,"qa"===e.id&&i.includes("Q:")&&i.includes("A:")?(u=i.indexOf("Q:"),d=i.indexOf("A:"),-1!==u&&-1!==d&&d>u&&(l=i.substring(u+2,d).trim(),c=i.substring(d+2).trim())):"definition"===e.id?(f=i.split("\n").filter((function(e){return e.trim()}))).length>0&&((p=f[0]).includes(":")?(g=p.split(":"),l=g[0].trim(),c=g.slice(1).join(":").trim(),f.length>1&&(c+="\n"+f.slice(1).join("\n"))):(h=t.split(" ").filter((function(e){return e.length>3})),l=h.slice(0,3).join(" ")+(h.length>3?"...":""),c=i)):(m=t.length>50?t.substring(0,50)+"...":t,l="".concat(e.name,": ").concat(m),c=i),y=null,!de||"off"===fe||!Wn())return[3,8];E.label=3;case 3:return E.trys.push([3,7,,8]),[4,_n.getDescriptionImage(Tn,t,S)];case 4:return(v=E.sent())?[4,null===(C=_n.getImageUrl)||void 0===C?void 0:C.call(_n,Tn,v)]:[3,6];case 5:(x=E.sent())&&(y=x),E.label=6;case 6:return[3,8];case 7:return b=E.sent(),console.warn("Failed to generate image:",b),[3,8];case 8:return s(Re(l)),s(Fe(c)),s(Ie(t)),y&&s(je(y)),o(!0),[3,11];case 9:return w=E.sent(),console.error("Error generating general card:",w),De("Failed to generate card: ".concat(w instanceof Error?w.message:"Unknown error"),"error"),[3,11];case 10:return[7];case 11:return[2]}}))}))}),[_n,De,s,de,fe,Wn,S]),Jr=((0,r.useCallback)((function(e){Gt(e),c.trim()&&Yr(e,c),Kt(!1)}),[c,Yr]),(0,r.useCallback)((function(){return pn(void 0,void 0,void 0,(function(){return gn(this,(function(e){switch(e.label){case 0:return Yt.trim()&&c.trim()?[4,Yr({id:"custom",name:"Custom",description:"Custom prompt",icon:"⚡",prompt:Yt},c,Yt)]:(De("Please enter both text and a custom prompt","error"),[2]);case 1:return e.sent(),Xt(""),[2]}}))}))}),[Yt,c,Yr,De]),(0,r.useCallback)((function(){return pn(void 0,void 0,void 0,(function(){var e,t,n,r,o,a,i,s,l,u;return gn(this,(function(d){switch(d.label){case 0:if(!c.trim())return De("Please enter or select text to create cards","error"),[2];In.current=new AbortController,e=In.current.signal,F(!0),d.label=1;case 1:if(d.trys.push([1,7,8,9]),e.aborted)throw new Error("Generation cancelled by user");t=ln(_n,Tn),n=void 0,d.label=2;case 2:return d.trys.push([2,4,,5]),r=window.getSelection(),o=void 0,r&&r.rangeCount>0&&(a=r.getRangeAt(0),o=a.commonAncestorContainer.nodeType===Node.ELEMENT_NODE?a.commonAncestorContainer:a.commonAncestorContainer.parentElement||void 0),[4,dn.extractPageContentAsync(c,o)];case 3:return n=d.sent(),console.log("📄 Extracted page content:",{images:n.pageImages.length,formulas:n.formulas.length,codeBlocks:n.codeBlocks.length,links:n.links.length,metadata:n.metadata,selectedText:c.substring(0,100)+"..."}),n.pageImages.forEach((function(e,t){console.log("🖼️ Изображение ".concat(t,":"),{src:e.src,alt:e.alt,relevanceScore:e.relevanceScore,isRelevant:e.relevanceScore>.3,hasBase64:!!e.base64})})),[3,5];case 4:return i=d.sent(),console.warn("Failed to extract page content, proceeding without multimedia:",i),n=void 0,[3,5];case 5:return[4,t.createCardsFromText(c,n,e)];case 6:return s=d.sent(),e.aborted?(console.log("AI card creation was cancelled by user"),[2]):(console.log("🎉 AI Agents created ".concat(s.length," cards successfully")),s.forEach((function(e,t){var n;console.log("🃏 Карточка ".concat(t,":"),{front:e.front,backPreview:e.back.substring(0,200)+"...",hasAttachedImages:!!e.attachedImages&&e.attachedImages.length>0,attachedImagesCount:(null===(n=e.attachedImages)||void 0===n?void 0:n.length)||0,multimedia:e.multimedia,hasImageInBack:e.back.includes("[IMAGE:")||e.back.includes("!["),hasFormulaInBack:e.back.includes("[FORMULA:")||e.back.includes("$$"),hasCodeInBack:e.back.includes("[CODE:")||e.back.includes("```")}),0===t&&console.log("🃏 Полный back карточки 0:",e.back)})),rn(s),mn(0),sn(!0),[3,9]);case 7:return l=d.sent(),e.aborted?(console.log("AI card creation was cancelled by user"),[2]):(console.error("❌ Error in AI agent card creation:",l),u=l instanceof Error?l.message:"Unknown error",De("Card creation error: ".concat(u),"error"),[3,9]);case 8:return console.log("🎯 Main card creation function finally block reached"),setTimeout((function(){console.log("⏳ Checking for pending operations before hiding loader...");var e=(0,Lt.cr)(),t=e.getStats(),n=t.inProgress>0;console.log("📊 Tracker stats:",t),console.log("🔄 Has pending requests:",n);var r=Ye||O||N;console.log("🏠 Local loading states:",{isProcessingCustomInstruction:Ye,loadingNewImage:O,loadingNewExamples:N,hasLocalOperations:r}),n||r?(console.log("⏸️ Keeping loader visible - operations still running"),setTimeout((function(){console.log("⏳ Second check after additional delay..."),e.getStats().inProgress>0||Ye||O||N?console.log("⏸️ Still has pending operations - keeping loader"):(console.log("✅ Second check passed - hiding loader"),F(!1),W(null),G({completed:0,total:0}))}),2e3)):(console.log("✅ No pending operations - hiding loader"),F(!1),W(null),G({completed:0,total:0}))}),1500),In.current=null,[7];case 9:return[2]}}))}))}),[c,_n,Tn,De])),Xr=function(){sn(!1),rn([]),mn(0),xn(new Set),kn("")},Zr=function(){return pn(void 0,void 0,void 0,(function(){var e;return gn(this,(function(t){M(!0);try{if(!(e=nn[un]))return De("No card to save","error"),[2];s(Ee(e)),xn((function(e){return new Set(e).add(un)}))}catch(e){console.error("Error saving current card:",e),De("Error saving card","error")}finally{M(!1)}return[2]}))}))},eo=m((function(e){return e.cards.isGeneratingCard}));return(0,a.jsxs)("div",fn({style:{display:"flex",flexDirection:"column",flex:1,width:"100%",height:"100%",position:"relative"}},{children:[j&&(0,a.jsxs)("div",fn({className:"loading-overlay",style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.9)",backdropFilter:"blur(4px)",zIndex:10,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"20px",padding:"0 20px",borderRadius:"12px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)"}},{children:[(0,a.jsxs)("div",fn({style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"12px"}},{children:[(0,a.jsx)(_t,{type:"spinner",size:"large",color:(null==q?void 0:q.color)||"#3B82F6"}),q&&(0,a.jsx)("div",fn({style:{fontSize:"20px",opacity:.8}},{children:q.icon}))]})),(0,a.jsxs)("div",fn({style:{textAlign:"center",color:"#374151",maxWidth:"400px"}},{children:[(0,a.jsx)("div",fn({style:{fontSize:"18px",fontWeight:"600",marginBottom:"8px",color:(null==q?void 0:q.color)||"#1f2937"}},{children:(null==q?void 0:q.currentStepTitle)||(null==q?void 0:q.title)||"Starting..."})),(0,a.jsx)("div",fn({style:{fontSize:"14px",color:"#6b7280",lineHeight:"1.5"}},{children:(null==q?void 0:q.currentStepSubtitle)||(null==q?void 0:q.subtitle)||"Preparing your request..."}))]})),(0,a.jsx)("div",fn({style:{width:"280px",height:"8px",backgroundColor:"#f3f4f6",borderRadius:"4px",overflow:"hidden",marginTop:"12px",boxShadow:"inset 0 1px 2px rgba(0, 0, 0, 0.1)"}},{children:(0,a.jsx)("div",fn({style:{height:"100%",width:"".concat($.total>0?Math.max(5,$.completed/$.total*100):15,"%"),background:"linear-gradient(90deg, ".concat((null==q?void 0:q.color)||"#3B82F6"," 0%, ").concat((null==q?void 0:q.color)||"#3B82F6","dd 50%, ").concat((null==q?void 0:q.color)||"#3B82F6"," 100%)"),borderRadius:"4px",transition:"width 0.6s ease-out, background 0.3s ease-in-out",boxShadow:"0 0 10px ".concat((null==q?void 0:q.color)||"#3B82F6","40"),position:"relative",overflow:"hidden"}},{children:(0,a.jsx)("div",{style:{position:"absolute",top:0,left:"-100%",width:"100%",height:"100%",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent)",animation:"shimmer 2s infinite"}})}))})),(0,a.jsxs)("div",fn({style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",marginTop:"16px",padding:"8px 16px",backgroundColor:"rgba(255, 255, 255, 0.1)",borderRadius:"20px",border:"1px solid ".concat((null==q?void 0:q.color)||"#3B82F6","20"),boxShadow:"0 0 15px ".concat((null==q?void 0:q.color)||"#3B82F6","20")}},{children:[(0,a.jsx)(ot,{style:{color:(null==q?void 0:q.color)||"#3B82F6",fontSize:"14px",animation:"pulse 2s ease-in-out infinite"}}),(0,a.jsx)("span",fn({style:{fontSize:"16px",fontWeight:"600",color:(null==q?void 0:q.color)||"#3B82F6",fontFamily:"monospace",letterSpacing:"1px"}},{children:(Wr=X,Vr=Math.floor(Wr/60),$r=Wr%60,"".concat(Vr,":").concat($r.toString().padStart(2,"0")))}))]})),(0,a.jsxs)("button",fn({onClick:Yn,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",backgroundColor:"#F3F4F6",color:"#4B5563",border:"1px solid #E5E7EB",borderRadius:"6px",padding:"10px 16px",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",marginTop:"10px"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#E5E7EB",e.currentTarget.style.color="#374151"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.color="#4B5563"},title:"Cancel card generation"},{children:[(0,a.jsx)(kt,{}),"Cancel Generation"]}))]})),Et&&(0,a.jsxs)("div",fn({style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.8)",zIndex:5,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"20px",padding:"0 20px"}},{children:[(0,a.jsx)(_t,{type:"spinner",size:"large",color:"#3B82F6",text:"Analyzing selected text..."}),(0,a.jsxs)("button",fn({onClick:function(){return It(!1)},style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",backgroundColor:"#F3F4F6",color:"#4B5563",border:"1px solid #E5E7EB",borderRadius:"6px",padding:"10px 16px",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",marginTop:"10px"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#E5E7EB",e.currentTarget.style.color="#374151"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.color="#4B5563"},title:"Cancel text analysis"},{children:[(0,a.jsx)(kt,{}),"Cancel Analysis"]}))]})),(0,a.jsx)("div",fn({style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",gap:"12px",width:"100%",padding:"12px",paddingTop:"16px",height:"100%",overflowY:"auto",backgroundColor:"#ffffff",paddingBottom:"16px"}},{children:(0,a.jsxs)("div",fn({style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"12px",width:"100%",maxWidth:"320px"}},{children:[(0,a.jsxs)("div",fn({style:{display:"flex",alignItems:"center",gap:"12px",width:"100%",padding:"12px",backgroundColor:"#F8FAFC",border:"1px solid #E2E8F0",borderRadius:"8px",marginBottom:"8px"}},{children:[(0,a.jsxs)("div",fn({style:{display:"flex",alignItems:"center",gap:"8px",color:C===Q.d.LanguageLearning?"#3B82F6":"#6B7280",fontSize:"14px",fontWeight:"500",transition:"color 0.2s ease"}},{children:[(0,a.jsx)(ft,{}),"Language Learning"]})),(0,a.jsx)("button",fn({onClick:_,style:{position:"relative",width:"48px",height:"24px",backgroundColor:C===Q.d.GeneralTopic?"#3B82F6":"#CBD5E1",borderRadius:"12px",border:"none",cursor:"pointer",transition:"background-color 0.2s ease",outline:"none"},title:"Switch to ".concat(C===Q.d.LanguageLearning?"General Cards":"Language Learning")},{children:(0,a.jsx)("div",{style:{position:"absolute",top:"2px",left:C===Q.d.GeneralTopic?"26px":"2px",width:"20px",height:"20px",backgroundColor:"#ffffff",borderRadius:"50%",transition:"left 0.2s ease",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.2)"}})})),(0,a.jsxs)("div",fn({style:{display:"flex",alignItems:"center",gap:"8px",color:C===Q.d.GeneralTopic?"#3B82F6":"#6B7280",fontSize:"14px",fontWeight:"500",transition:"color 0.2s ease"}},{children:[(0,a.jsx)(Je,{}),"General Cards"]}))]})),C===Q.d.LanguageLearning&&(0,a.jsxs)("div",fn({style:{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%",gap:"8px"}},{children:[gr(),Ur(),(0,a.jsxs)("div",fn({style:{display:"flex",flexDirection:"column",width:"100%",gap:"8px",marginTop:"4px"}},{children:[(0,a.jsx)("label",fn({style:{color:"#111827",fontWeight:"600",fontSize:"14px",margin:0}},{children:"Image Generation:"})),(0,a.jsxs)("div",fn({style:{display:"flex",width:"100%",backgroundColor:"#F3F4F6",borderRadius:"8px",padding:"4px",gap:"2px",opacity:Wn()?1:.5}},{children:[(0,a.jsx)("button",fn({type:"button",onClick:function(){return Qr("off")},disabled:!Wn(),style:{flex:1,whiteSpace:"nowrap",padding:"8px 12px",borderRadius:"6px",border:"none",backgroundColor:"off"===fe?"#FFFFFF":"transparent",color:"off"===fe?"#111827":"#6B7280",fontSize:"12px",fontWeight:"off"===fe?"600":"500",cursor:Wn()?"pointer":"not-allowed",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",boxShadow:"off"===fe?"0 1px 2px rgba(0, 0, 0, 0.05)":"none"}},{children:"🚫 Off"})),(0,a.jsx)("button",fn({type:"button",onClick:function(){return Qr("smart")},disabled:!Wn(),style:{flex:1,whiteSpace:"nowrap",padding:"8px 12px",borderRadius:"6px",border:"none",backgroundColor:"smart"===fe?"#FFFFFF":"transparent",color:"smart"===fe?"#111827":"#6B7280",fontSize:"12px",fontWeight:"smart"===fe?"600":"500",cursor:Wn()?"pointer":"not-allowed",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",boxShadow:"smart"===fe?"0 1px 2px rgba(0, 0, 0, 0.05)":"none"}},{children:"🧠 Smart"})),(0,a.jsx)("button",fn({type:"button",onClick:function(){return Qr("always")},disabled:!Wn(),style:{flex:1,whiteSpace:"nowrap",padding:"8px 12px",borderRadius:"6px",border:"none",backgroundColor:"always"===fe?"#FFFFFF":"transparent",color:"always"===fe?"#111827":"#6B7280",fontSize:"12px",fontWeight:"always"===fe?"600":"500",cursor:Wn()?"pointer":"not-allowed",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",boxShadow:"always"===fe?"0 1px 2px rgba(0, 0, 0, 0.05)":"none"}},{children:"🎨 Always"}))]})),(0,a.jsx)("div",fn({style:{position:"relative",height:"2.8em",marginTop:"2px"}},{children:(0,a.jsxs)("div",fn({style:{position:"absolute",top:0,left:0,right:0,fontSize:"11px",color:"#6B7280",lineHeight:"1.4",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"}},{children:["off"===fe&&"No images will be generated","smart"===fe&&"AI decides: Images only for concrete objects, places, and visual concepts. Saves API costs by skipping abstract terms.","always"===fe&&"Images generated for all cards"]}))})),!Wn()&&(0,a.jsx)("div",fn({style:{fontSize:"12px",color:"#EF4444",backgroundColor:"#FEF2F2",padding:"6px 8px",borderRadius:"6px",border:"1px solid #FECACA"}},{children:"Image generation not available with Groq provider"}))]})),"off"!==fe&&Wn()&&(de?ye?(0,a.jsxs)("div",fn({style:{backgroundColor:"#F9FAFB",border:"1px solid #E5E7EB",borderRadius:"8px",padding:"16px",width:"100%",marginBottom:"12px",marginTop:"8px"}},{children:[(0,a.jsxs)("div",fn({style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"}},{children:[(0,a.jsxs)("h3",fn({style:{margin:0,fontSize:"16px",fontWeight:600,display:"flex",alignItems:"center",gap:"8px"}},{children:[(0,a.jsx)(pt,{size:14,color:"#10B981"}),"Image Instructions"]})),(0,a.jsx)("button",fn({onClick:function(){return ve(!1)},style:{background:"transparent",border:"none",cursor:"pointer",color:"#6B7280",fontSize:"13px"}},{children:"Cancel"}))]})),(0,a.jsxs)("div",fn({style:{marginBottom:"16px"}},{children:[(0,a.jsx)("label",fn({style:{display:"block",marginBottom:"4px",fontSize:"14px",fontWeight:500,color:"#374151"}},{children:"Image generation style"})),(0,a.jsx)("textarea",{value:Ce,onChange:function(e){return Le(e.target.value)},placeholder:"E.g., use anime style, make it minimalist, use pastel colors, make it black and white",style:{width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",fontSize:"14px",minHeight:"100px",resize:"vertical"}}),(0,a.jsxs)("div",fn({style:{fontSize:"12px",color:"#6B7280",marginTop:"8px",lineHeight:"1.4"}},{children:[(0,a.jsx)("p",fn({style:{margin:"0 0 6px 0",fontWeight:"500"}},{children:"How to use:"})),(0,a.jsxs)("ul",fn({style:{margin:0,paddingLeft:"16px"}},{children:[(0,a.jsxs)("li",{children:["These are ",(0,a.jsx)("strong",{children:"style instructions"})," for image generation"]}),(0,a.jsx)("li",{children:"The image will still be related to the word you're learning"}),(0,a.jsx)("li",{children:"Focus on artistic style, mood, colors, composition, etc."}),(0,a.jsx)("li",{children:'Examples: "watercolor style", "dark background", "realistic rendering"'})]}))]}))]})),(0,a.jsxs)("button",fn({onClick:Qn,style:{backgroundColor:"#10B981",color:"white",border:"none",borderRadius:"6px",padding:"8px 16px",fontSize:"14px",fontWeight:500,cursor:"pointer",width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"}},{children:[(0,a.jsx)(pt,{size:14}),"Save Image Instructions"]}))]})):(0,a.jsxs)("button",fn({onClick:function(){return ve(!0)},style:{display:"flex",alignItems:"center",gap:"6px",backgroundColor:"#F3F4F6",border:"1px solid #E5E7EB",borderRadius:"6px",padding:"6px 12px",fontSize:"13px",color:"#4B5563",cursor:"pointer",width:"100%",justifyContent:"center",marginTop:"8px"}},{children:[(0,a.jsx)(pt,{size:14}),"Customize image generation"]})):null)]})),C===Q.d.GeneralTopic&&(0,a.jsxs)("div",fn({style:{display:"flex",flexDirection:"column",gap:"12px",padding:"16px",backgroundColor:"#F8FAFC",borderRadius:"8px",border:"1px solid #E2E8F0"}},{children:[(0,a.jsxs)("div",fn({style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"}},{children:[(0,a.jsx)(wt,{style:{color:"#6366F1"}}),(0,a.jsx)("h4",fn({style:{fontSize:"16px",fontWeight:"600",color:"#111827",margin:0}},{children:"AI Agent Card Creator"}))]})),(0,a.jsx)("p",fn({style:{fontSize:"14px",color:"#6B7280",margin:0,lineHeight:"1.4"}},{children:"Select text on any page and AI agents will automatically create optimal cards for learning. The system analyzes content and creates 1 to several cards with quality validation."})),(0,a.jsxs)("div",fn({style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 12px",backgroundColor:"#FEF3C7",borderRadius:"6px",border:"1px solid #F59E0B"}},{children:[(0,a.jsx)(mt,{style:{color:"#F59E0B"}}),(0,a.jsx)("span",fn({style:{fontSize:"12px",color:"#92400E",fontWeight:"500"}},{children:"AI analyzes text, creates cards and validates results"}))]})),!j&&(0,a.jsxs)("button",fn({onClick:Jr,disabled:!c.trim()||j,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",width:"100%",padding:"8px 10px",backgroundColor:c.trim()&&!j?"#2563EB":"#E5E7EB",color:c.trim()&&!j?"#ffffff":"#9CA3AF",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:"600",cursor:c.trim()&&!j?"pointer":"not-allowed",transition:"all 0.2s ease",marginTop:"4px",opacity:j?.7:1},onMouseOver:function(e){c.trim()&&!j&&(e.currentTarget.style.backgroundColor="#1D4ED8")},onMouseOut:function(e){c.trim()&&!j&&(e.currentTarget.style.backgroundColor="#2563EB")}},{children:[j?(0,a.jsx)(_t,{type:"spinner",size:"small",inline:!0,color:"#ffffff"}):(0,a.jsx)(wt,{}),"Create Cards with AI"]}))]})),ge?(0,a.jsxs)("div",fn({style:{backgroundColor:"#F9FAFB",border:"1px solid #E5E7EB",borderRadius:"8px",padding:"16px",width:"100%",marginBottom:"12px"}},{children:[(0,a.jsxs)("div",fn({style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"}},{children:[(0,a.jsxs)("h3",fn({style:{margin:0,fontSize:"16px",fontWeight:600,display:"flex",alignItems:"center",gap:"8px"}},{children:[(0,a.jsx)(mt,{size:14,color:"#2563EB"}),"AI Instructions"]})),(0,a.jsx)("button",fn({onClick:function(){return he(!1)},style:{background:"transparent",border:"none",cursor:"pointer",color:"#6B7280",fontSize:"13px"}},{children:"Cancel"}))]})),(0,a.jsxs)("div",fn({style:{marginBottom:"16px"}},{children:[(0,a.jsx)("label",fn({style:{display:"block",marginBottom:"4px",fontSize:"14px",fontWeight:500,color:"#374151"}},{children:"Additional instructions for AI"})),(0,a.jsx)("textarea",{value:be,onChange:function(e){return we(e.target.value)},placeholder:"E.g., Keep specialized terms untranslated. Make examples more advanced. Use formal language.",style:{width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",fontSize:"14px",minHeight:"100px",resize:"vertical"}}),(0,a.jsxs)("div",fn({style:{fontSize:"12px",color:"#6B7280",marginTop:"8px",lineHeight:"1.4"}},{children:[(0,a.jsx)("p",fn({style:{margin:"0 0 6px 0",fontWeight:"500"}},{children:"How to use:"})),(0,a.jsxs)("ul",fn({style:{margin:0,paddingLeft:"16px"}},{children:[(0,a.jsxs)("li",{children:["These are ",(0,a.jsx)("strong",{children:"additional"})," instructions that supplement the basic AI behavior"]}),(0,a.jsx)("li",{children:"The original word will always be used (no need to specify it)"}),(0,a.jsx)("li",{children:"Examples will always be generated for the word you're learning"}),(0,a.jsx)("li",{children:"Use this for style guidance, preferences, or special requirements"})]}))]}))]})),(0,a.jsxs)("button",fn({onClick:Kn,style:{backgroundColor:"#2563EB",color:"white",border:"none",borderRadius:"6px",padding:"8px 16px",fontSize:"14px",fontWeight:500,cursor:"pointer",width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",marginBottom:"8px"}},{children:[(0,a.jsx)(at,{size:14}),"Save Instructions"]}))]})):(0,a.jsxs)("button",fn({onClick:function(){return he(!0)},style:{display:"flex",alignItems:"center",gap:"6px",backgroundColor:"#F3F4F6",border:"1px solid #E5E7EB",borderRadius:"6px",padding:"6px 12px",fontSize:"13px",color:"#4B5563",cursor:"pointer",width:"100%",justifyContent:"center"}},{children:[(0,a.jsx)(it,{size:14}),"Customize AI behavior"]})),C===Q.d.LanguageLearning&&(0,a.jsxs)("form",fn({onSubmit:function(e){return pn(void 0,void 0,void 0,(function(){var t,r,a,s,l,u,d,f,p,g,h,m,y,v,x;return gn(this,(function(S){switch(S.label){case 0:if(e.preventDefault(),!c.trim())return[2];In.current=new AbortController,t=In.current.signal,Nr(!0),i.setIsGeneratingCard(!0),ie(!1),localStorage.removeItem("explicitly_saved"),Ot([]),Vt(!1),i.setCurrentCardId(null),de?I!==c&&(console.log("Text has changed, clearing existing images for new generation"),i.setImage(null),i.setImageUrl(null)):(console.log("Image generation is disabled, clearing existing images"),i.setImage(null),i.setImageUrl(null)),i.setLinguisticInfo(""),i.setTranscription(""),F(!0),W(null),(0,Lt.cr)().reset(),(0,Lt.Y3)((function(e){console.log("🔄 Progress update: ".concat(e.completed,"/").concat(e.total," - ").concat(e.message.title)),W(e.message),G({completed:e.completed,total:e.total})})),A(c),De(null),S.label=1;case 1:if(S.trys.push([1,4,5,6]),console.log("=== DEBUG INFO ==="),console.log("Model Provider:",ue),console.log("API Key available:",Boolean(Tn)),console.log("Model Name (if Groq):",ue===tn.l.Groq?ce:"N/A"),console.log("AI Service:",Object.keys(_n)),console.log("Source Language:",Fr?xr:mr),!Tn)throw new Error("API key for ".concat(ue," is missing. Please go to settings and add your API key."));return r=Fr?xr:mr,console.log("🚀 Using parallel card creation for maximum speed..."),[4,Promise.resolve().then(n.bind(n,505))];case 2:return a=S.sent().createCardComponentsParallel,s=Date.now(),[4,a(_n,Tn,c,b,w,r||void 0,de,t,fe)];case 3:if(l=S.sent(),u=Date.now()-s,console.log("⚡ Parallel card creation completed in ".concat(u,"ms")),t.aborted)throw new Error("Generation cancelled by user");if(d={translation:!1,examples:!1,flashcard:!1,image:!1,linguisticInfo:!1},(null===(v=l.translation)||void 0===v?void 0:v.translated)&&(i.setTranslation(l.translation.translated),d.translation=!0),l.examples&&l.examples.length>0&&(f=l.examples.map((function(e){return[e.original,e.translated]})),i.setExamples(f),d.examples=!0),(null===(x=l.flashcard)||void 0===x?void 0:x.front)&&(i.setFront(l.flashcard.front),d.flashcard=!0),l.linguisticInfo&&(i.setLinguisticInfo(l.linguisticInfo),d.linguisticInfo=!0),l.imageUrl&&(i.setImageUrl(l.imageUrl),d.image=!0),l.errors.length>0){for(console.warn("Some components failed:",l.errors),p=0,g=l.errors;p<g.length;p++)"translation"===(h=g[p]).component?De("Translation failed: ".concat(h.error),"error"):De("".concat(h.component," generation failed: ").concat(h.error),"warning");if(!d.translation)throw new Error("Translation failed - cannot create card without translation")}if(!d.translation)throw new Error("Translation failed - cannot create card without translation");if(console.log("Parallel card creation completed with:",d),o(!0),ie(!1),localStorage.removeItem("explicitly_saved"),console.log("Setting showResult to true after successful parallel card creation"),m="".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),i.setCurrentCardId(m),console.log("Created card with ID:",m),!d.translation)throw new Error("Failed to create card: No data was successfully generated. Please check your API key and try again.");return o(!0),nt(!0),re(!0),setTimeout((function(){console.log("🎯 Parallel content is ready - hiding loading"),F(!1),W(null),G({completed:0,total:0})}),500),[3,6];case 4:if(y=S.sent(),t.aborted)throw console.log("Card generation was cancelled by user"),new Error("Operation cancelled by user");return y instanceof Error&&Ve(y)?(console.error("Quota error detected in main catch:",y.message),De(y.message),F(!1),W(null),G({completed:0,total:0}),[2]):(console.error("Error processing text:",y),De(y instanceof Error?"".concat(y.message):"Failed to create card. Please check your API key and try again."),F(!1),W(null),G({completed:0,total:0}),[3,6]);case 5:return i.setIsGeneratingCard(!1),In.current=null,[7];case 6:return[2]}}))}))},style:{width:"100%",display:"flex",flexDirection:"column",gap:"8px",marginTop:"4px",marginBottom:"0"}},{children:[(0,a.jsxs)("div",fn({style:{display:"flex",flexDirection:"column",gap:"4px",width:"100%"}},{children:[(0,a.jsxs)("label",fn({htmlFor:"text",style:{color:"#111827",fontWeight:"600",fontSize:"14px",display:"flex",alignItems:"center"}},{children:["Text:",Jn()]})),(0,a.jsx)("textarea",{id:"text",value:c,onChange:function(e){return Nn(e.target.value)},placeholder:"Enter text to translate or select text from a webpage",style:{width:"100%",minHeight:"80px",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"14px",resize:"vertical",outline:"none",transition:"all 0.2s ease"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}})]})),(0,a.jsx)("button",fn({type:"submit",disabled:j,style:{width:"100%",padding:"8px 10px",marginTop:"4px",borderRadius:"6px",backgroundColor:"#2563EB",color:"#ffffff",fontWeight:"600",fontSize:"14px",border:"none",cursor:"pointer",transition:"all 0.2s ease",opacity:j?.7:1},onMouseOver:function(e){return!j&&(e.currentTarget.style.backgroundColor="#1D4ED8")},onMouseOut:function(e){return!j&&(e.currentTarget.style.backgroundColor="#2563EB")}},{children:j?(0,a.jsx)("div",fn({style:{display:"flex",alignItems:"center",justifyContent:"center"}},{children:(0,a.jsx)(_t,{type:"spinner",size:"small",inline:!0,color:"#ffffff",text:"Creating card"})})):"Create Card"}))]})),C===Q.d.GeneralTopic&&(0,a.jsxs)("div",fn({style:{width:"100%",display:"flex",flexDirection:"column",gap:"8px",marginTop:"4px"}},{children:[(0,a.jsxs)("label",fn({htmlFor:"general-text",style:{color:"#111827",fontWeight:"600",fontSize:"14px",display:"flex",alignItems:"center"}},{children:["Text for Analysis:",Jn()]})),(0,a.jsx)("textarea",{id:"general-text",value:c,onChange:function(e){return Nn(e.target.value)},placeholder:"Enter or select text from the page to create cards",style:{width:"100%",minHeight:"80px",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"14px",resize:"vertical",outline:"none",transition:"all 0.2s ease"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}})]}))]}))})),function(){if(!xt)return null;var e=Object.values(Tt).filter(Boolean).length;return(0,a.jsx)("div",fn({style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(2px)",padding:"16px"},onClick:function(){jt({}),bt(!1)}},{children:(0,a.jsxs)("div",fn({style:{backgroundColor:"#ffffff",borderRadius:"12px",maxWidth:"360px",width:"100%",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",position:"relative",padding:"16px"},onClick:function(e){return e.stopPropagation()}},{children:[(0,a.jsxs)("div",fn({style:{position:"sticky",top:0,display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid #E5E7EB",paddingBottom:"12px",marginBottom:"16px",backgroundColor:"#ffffff",zIndex:2}},{children:[(0,a.jsxs)("h3",fn({style:{margin:0,fontSize:"16px",fontWeight:600,color:"#111827",display:"flex",alignItems:"center",gap:"8px"}},{children:[(0,a.jsx)(dt,{size:14,color:"#2563EB"}),"Select Terms for Cards"]})),(0,a.jsx)("button",fn({onClick:function(){jt({}),ut([]),bt(!1)},style:{background:"none",border:"none",display:"flex",alignItems:"center",justifyContent:"center",padding:"8px",borderRadius:"50%",cursor:"pointer",transition:"background-color 0.2s"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="#F3F4F6"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="transparent"},"aria-label":"Close"},{children:(0,a.jsx)(kt,{size:16,color:"#6B7280"})}))]})),(0,a.jsxs)("div",fn({style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"14px"}},{children:[(0,a.jsxs)("p",fn({style:{fontSize:"14px",color:"#4B5563",margin:0,lineHeight:"1.4"}},{children:["Found ",st.length," key terms"]})),e>0&&(0,a.jsxs)("span",fn({style:{fontSize:"13px",fontWeight:500,color:"#2563EB",padding:"3px 8px",backgroundColor:"#EFF6FF",borderRadius:"6px"}},{children:[e," selected"]}))]})),(0,a.jsxs)("div",fn({style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 4px",marginBottom:"12px"}},{children:[(0,a.jsx)("button",fn({onClick:function(){var t=e<st.length,n={};st.forEach((function(e){n[e]=t})),jt(n)},style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"13px",background:"none",border:"none",padding:"4px 8px",borderRadius:"4px",color:"#4B5563",cursor:"pointer"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="#F3F4F6"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="transparent"}},{children:e===st.length?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",fn({style:{fontSize:"13px"}},{children:"✓"}))," Deselect all"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",fn({style:{fontSize:"13px"}},{children:"☐"}))," Select all"]})})),(0,a.jsx)("span",fn({style:{fontSize:"12px",color:"#6B7280",fontStyle:"italic"}},{children:"Tap to select"}))]})),(0,a.jsx)("div",fn({style:{display:"flex",flexDirection:"column",gap:"8px",marginBottom:"16px",maxHeight:"300px",overflowY:"auto",padding:"4px",listStyle:"none"}},{children:Et?(0,a.jsx)("div",fn({style:{display:"flex",justifyContent:"center",padding:"20px"}},{children:(0,a.jsx)(_t,{type:"spinner",size:"large",color:"#3B82F6",text:"Analyzing selected text..."})})):st.map((function(e,t){return(0,a.jsxs)("div",fn({style:{display:"flex",alignItems:"center",padding:"10px 12px",backgroundColor:Tt[e]?"#EFF6FF":"#F9FAFB",border:"1px solid ".concat(Tt[e]?"#BFDBFE":"#E5E7EB"),borderRadius:"8px",cursor:"pointer",transition:"all 0.2s ease",position:"relative",listStyleType:"none"},onClick:function(){return er(e)}},{children:[(0,a.jsx)("input",{type:"checkbox",checked:!!Tt[e],onChange:function(){return er(e)},style:{marginRight:"12px",width:"16px",height:"16px",accentColor:"#2563EB",minWidth:"16px"},id:"option-".concat(t)}),(0,a.jsx)("span",fn({style:{fontSize:"14px",color:"#374151",flex:1,cursor:"pointer",wordBreak:"break-word",textAlign:"left",paddingLeft:"0",marginLeft:"0",display:"inline-block"}},{children:e.replace(/^[-–—•\s]+/,"")})),(0,a.jsx)("span",fn({style:{position:"absolute",right:"10px",top:"10px",fontSize:"10px",padding:"2px 6px",borderRadius:"10px",backgroundColor:e.split(/\s+/).length>1?"#DBEAFE":"#F3F4F6",color:e.split(/\s+/).length>1?"#1E40AF":"#6B7280",fontWeight:e.split(/\s+/).length>1?"500":"normal"}},{children:e.split(/\s+/).length>1?"phrase":"word"}))]}),t)}))})),(0,a.jsxs)("div",fn({style:{display:"flex",gap:"8px",marginTop:"12px"}},{children:[(0,a.jsx)("button",fn({onClick:function(){jt({}),bt(!1)},style:{flex:"1",padding:"10px 12px",backgroundColor:"#F9FAFB",color:"#4B5563",border:"1px solid #E5E7EB",borderRadius:"6px",fontSize:"14px",fontWeight:500,cursor:"pointer",transition:"all 0.2s ease"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#F3F4F6"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#F9FAFB"}},{children:"Cancel"})),(0,a.jsxs)("button",fn({onClick:Zn,disabled:0===e,style:{flex:"2",padding:"10px 12px",backgroundColor:0===e?"#E5E7EB":"#2563EB",color:0===e?"#9CA3AF":"#FFFFFF",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:500,cursor:0===e?"not-allowed":"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},onMouseOver:function(t){e>0&&(t.currentTarget.style.backgroundColor="#1D4ED8")},onMouseOut:function(t){e>0&&(t.currentTarget.style.backgroundColor="#2563EB")}},{children:[(0,a.jsx)(yt,{size:14}),"Create ",e>0?"".concat(e," Card").concat(e>1?"s":""):"Cards"]}))]}))]}))}))}(),tt&&t?(0,a.jsx)("div",fn({style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(2px)",padding:"16px"},onClick:Xn},{children:(0,a.jsxs)("div",fn({style:{backgroundColor:"#ffffff",borderRadius:"12px",maxWidth:"340px",width:"100%",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",position:"relative",padding:"16px"},onClick:function(e){return e.stopPropagation()}},{children:[(0,a.jsxs)("div",fn({style:{position:"sticky",top:0,display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid #E5E7EB",paddingBottom:"12px",marginBottom:"16px",backgroundColor:"#ffffff",zIndex:2}},{children:[(0,a.jsx)("h3",fn({style:{margin:0,fontSize:"16px",fontWeight:600,color:"#111827"}},{children:qt?"Card ".concat(Bt+1," of ").concat(Rt.length):"Your Card"})),(0,a.jsx)("button",fn({onClick:Xn,style:{background:"none",border:"none",display:"flex",alignItems:"center",justifyContent:"center",padding:"8px",borderRadius:"50%",cursor:"pointer",transition:"background-color 0.2s"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="#F3F4F6"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="transparent"},"aria-label":"Close"},{children:(0,a.jsx)(kt,{size:16,color:"#6B7280"})}))]})),(0,a.jsxs)("div",fn({style:{width:"100%",marginBottom:"12px"}},{children:[(0,a.jsxs)("div",fn({style:{position:"relative",width:"100%"}},{children:[(0,a.jsx)("input",{type:"text",value:He,onChange:function(e){return Ke(e.target.value)},onKeyDown:qn,placeholder:"Enter custom instructions (e.g., 'more formal examples', 'change image style')",style:{width:"100%",padding:"10px 12px",paddingRight:"44px",borderRadius:"8px",border:"1px solid #E5E7EB",fontSize:"14px",color:"#374151",backgroundColor:Ye?"#F9FAFB":"#FFFFFF",transition:"all 0.2s ease",boxShadow:Ye?"inset 0 1px 2px rgba(0, 0, 0, 0.05)":"none"},disabled:Ye}),Ye?(0,a.jsx)("div",fn({style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",padding:"6px",borderRadius:"50%",color:"#4F46E5"}},{children:(0,a.jsx)(_t,{type:"spinner",size:"small",inline:!0,color:"#4F46E5"})})):(0,a.jsx)("button",fn({onClick:Un,disabled:!He.trim()||Ye,style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",background:He.trim()?"linear-gradient(to right, #4F46E5, #6366F1)":"none",border:"none",color:He.trim()?"#FFFFFF":"#9CA3AF",cursor:He.trim()?"pointer":"not-allowed",display:"flex",alignItems:"center",justifyContent:"center",padding:"6px",borderRadius:"50%",width:"28px",height:"28px",boxShadow:He.trim()?"0 1px 3px rgba(0, 0, 0, 0.1)":"none",transition:"all 0.2s ease"},title:"Apply instructions"},{children:(0,a.jsx)(vt,{size:14})}))]})),(0,a.jsxs)("div",fn({style:{fontSize:"12px",color:Ye?"#4F46E5":"#6B7280",marginTop:"6px",display:"flex",alignItems:"center",gap:"6px",fontWeight:Ye?"500":"normal"}},{children:[Ye&&(0,a.jsx)("span",{style:{display:"inline-block",width:"6px",height:"6px",borderRadius:"50%",backgroundColor:"#4F46E5",animation:"pulse 1.5s infinite"}}),Ye?"Applying your instructions...":"Type instructions and press Enter or click the magic wand"]})),(0,a.jsx)("style",{children:"\n                            @keyframes pulse {\n                                0% { opacity: 1; }\n                                50% { opacity: 0.4; }\n                                100% { opacity: 1; }\n                            }\n                        "})]})),qt&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",fn({style:{marginBottom:"8px",display:"flex",justifyContent:"center",alignItems:"center"}},{children:(0,a.jsxs)("div",fn({style:{fontSize:"13px",color:"#4B5563",backgroundColor:"#F9FAFB",padding:"4px 10px",borderRadius:"16px",display:"flex",alignItems:"center",gap:"4px"}},{children:["Card ",Bt+1," of ",Rt.length,Rt[Bt]&&On(Rt[Bt].id)&&(0,a.jsxs)("span",fn({style:{display:"inline-flex",alignItems:"center",gap:"3px",backgroundColor:"#ECFDF5",color:"#10B981",padding:"2px 6px",borderRadius:"10px",fontSize:"11px",fontWeight:"bold"}},{children:[(0,a.jsx)(Ze,{size:8}),"SAVED"]}))]}))})),(0,a.jsxs)("div",fn({style:{display:"flex",justifyContent:"space-between",gap:"8px",marginBottom:"12px"}},{children:[(0,a.jsxs)("button",fn({onClick:or,disabled:0===Bt,style:{padding:"8px 16px",backgroundColor:0===Bt?"#F3F4F6":"#EFF6FF",color:0===Bt?"#9CA3AF":"#2563EB",border:"1px solid ".concat(0===Bt?"#E5E7EB":"#BFDBFE"),borderRadius:"6px",fontSize:"14px",fontWeight:500,cursor:0===Bt?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"8px",flex:1}},{children:["← Prev",Bt>0&&Rt[Bt-1]&&(On(Rt[Bt-1].id)?(0,a.jsx)("span",{style:{width:"6px",height:"6px",borderRadius:"50%",backgroundColor:"#10B981",marginLeft:"auto"}}):null)]})),(0,a.jsxs)("button",fn({onClick:tr,disabled:Bt===Rt.length-1,style:{padding:"8px 16px",backgroundColor:Bt===Rt.length-1?"#F3F4F6":"#EFF6FF",color:Bt===Rt.length-1?"#9CA3AF":"#2563EB",border:"1px solid ".concat(Bt===Rt.length-1?"#E5E7EB":"#BFDBFE"),borderRadius:"6px",fontSize:"14px",fontWeight:500,cursor:Bt===Rt.length-1?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"8px",flex:1,justifyContent:"flex-end"}},{children:[Bt<Rt.length-1&&Rt[Bt+1]&&(On(Rt[Bt+1].id)?(0,a.jsx)("span",{style:{width:"6px",height:"6px",borderRadius:"50%",backgroundColor:"#10B981",marginRight:"auto"}}):null),"Next →"]}))]})),(0,a.jsx)("button",fn({onClick:Vn,style:{width:"100%",padding:"10px 12px",backgroundColor:"#10B981",color:"white",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:500,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",marginBottom:"12px",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"},disabled:D},{children:D?(0,a.jsx)(_t,{type:"spinner",size:"small",inline:!0,color:"#ffffff",text:"Saving"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("svg",fn({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},{children:(0,a.jsx)("path",{d:"M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022Z"})})),Fn.length>0?(0,a.jsxs)(a.Fragment,{children:["Save ",Rt.length-Fn.length," Remaining Cards",(0,a.jsxs)("span",fn({style:{fontSize:"12px",backgroundColor:"rgba(255,255,255,0.25)",borderRadius:"4px",padding:"1px 6px",marginLeft:"4px"}},{children:[Fn.length," saved"]}))]}):(0,a.jsxs)(a.Fragment,{children:["Save All Cards (",Rt.length,")"]})]})}))]}),(0,a.jsx)(Nt,{mode:C,front:g,translation:u,examples:d,imageUrl:p,image:f,linguisticInfo:v,transcription:x,onNewImage:Dn,onNewExamples:Mn,onAccept:$n,onViewSavedCards:Gn,onCancel:Yn,loadingNewImage:O,loadingNewExamples:N,createdAt:new Date,loadingAccept:D,loadingGetResult:j,shouldGenerateImage:de,isSaved:Pn,isEdited:K,isGeneratingCard:eo,setTranslation:Ln,setExamples:zn,setLinguisticInfo:qr})]}))})):null,kr&&Ur(),sr&&gr(),an&&nn.length>0&&(0,a.jsx)("div",fn({style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.8)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px",animation:"fadeIn 0.3s ease-out"}},{children:(0,a.jsxs)("div",fn({style:{backgroundColor:"#ffffff",borderRadius:"8px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",maxWidth:"640px",width:"100%",maxHeight:"90vh",overflow:"hidden",display:"flex",flexDirection:"column",border:"1px solid #EAEAEA",animation:"slideUp 0.4s ease-out"}},{children:[(0,a.jsx)("div",fn({style:{padding:"20px 24px 16px 24px",borderBottom:"1px solid #EAEAEA"}},{children:(0,a.jsxs)("div",fn({style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",fn({style:{margin:0,fontSize:"18px",fontWeight:"600",color:"#000000",letterSpacing:"-0.025em"}},{children:"Review Cards"})),(0,a.jsxs)("p",fn({style:{margin:"4px 0 0 0",fontSize:"14px",color:"#666666",fontWeight:"400"}},{children:[nn.length," cards generated by AI"]}))]}),(0,a.jsx)("button",fn({onClick:Xr,style:{background:"none",border:"none",fontSize:"16px",color:"#999999",cursor:"pointer",padding:"6px",borderRadius:"4px",transition:"all 0.15s ease"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#F5F5F5",e.currentTarget.style.color="#666666"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="#999999"}},{children:(0,a.jsx)(kt,{})}))]}))})),nn.length>1&&(0,a.jsx)("div",fn({style:{padding:"12px 24px",backgroundColor:"#FAFAFA",borderBottom:"1px solid #EAEAEA",display:"flex",alignItems:"center",justifyContent:"center"}},{children:(0,a.jsxs)("div",fn({style:{display:"flex",alignItems:"center",gap:"12px"}},{children:[(0,a.jsx)("button",fn({onClick:function(){un>0&&mn(un-1)},disabled:0===un,style:{backgroundColor:"transparent",color:0===un?"#CCCCCC":"#666666",border:"1px solid ".concat(0===un?"#EAEAEA":"#DDDDD"),borderRadius:"6px",padding:"6px 10px",fontSize:"13px",fontWeight:"500",cursor:0===un?"not-allowed":"pointer",transition:"all 0.15s ease",display:"flex",alignItems:"center",gap:"4px"},onMouseOver:function(e){0!==un&&(e.currentTarget.style.borderColor="#999999",e.currentTarget.style.color="#333333")},onMouseOut:function(e){0!==un&&(e.currentTarget.style.borderColor="#DDDDDD",e.currentTarget.style.color="#666666")}},{children:"←"})),(0,a.jsxs)("div",fn({style:{fontSize:"13px",color:"#666666",fontWeight:"500",padding:"0 8px"}},{children:[un+1," of ",nn.length]})),(0,a.jsx)("button",fn({onClick:function(){un<nn.length-1&&mn(un+1)},disabled:un===nn.length-1,style:{backgroundColor:"transparent",color:un===nn.length-1?"#CCCCCC":"#666666",border:"1px solid ".concat(un===nn.length-1?"#EAEAEA":"#DDDDDD"),borderRadius:"6px",padding:"6px 10px",fontSize:"13px",fontWeight:"500",cursor:un===nn.length-1?"not-allowed":"pointer",transition:"all 0.15s ease",display:"flex",alignItems:"center",gap:"4px"},onMouseOver:function(e){un!==nn.length-1&&(e.currentTarget.style.borderColor="#999999",e.currentTarget.style.color="#333333")},onMouseOut:function(e){un!==nn.length-1&&(e.currentTarget.style.borderColor="#DDDDDD",e.currentTarget.style.color="#666666")}},{children:"→"}))]}))})),(0,a.jsx)("div",fn({style:{flex:1,overflow:"auto",padding:"16px",backgroundColor:"#ffffff"}},{children:nn[un]&&(0,a.jsx)("div",fn({style:{animation:"slideIn 0.3s ease-out"}},{children:(0,a.jsx)(Nt,{front:nn[un].front||null,back:nn[un].back||null,translation:null,examples:[],imageUrl:nn[un].imageUrl||null,image:nn[un].image||null,linguisticInfo:"",transcription:null,onNewImage:function(){},onNewExamples:function(){},onAccept:Zr,onViewSavedCards:function(){},loadingNewImage:!1,loadingNewExamples:!1,loadingAccept:D,createdAt:new Date,mode:Q.d.GeneralTopic,shouldGenerateImage:!1,isSaved:vn.has(un),isEdited:!1,isGeneratingCard:!1,hideActionButtons:!0,setBack:function(e){var t=hn([],nn,!0);t[un]=fn(fn({},t[un]),{back:e}),rn(t)}})}))})),(0,a.jsxs)("div",fn({style:{padding:"16px 20px",borderTop:"1px solid #EAEAEA",backgroundColor:"#FAFAFA",display:"flex",flexDirection:"column",gap:"12px"}},{children:[(0,a.jsxs)("div",fn({style:{display:"flex",justifyContent:"center",gap:"8px"}},{children:[(0,a.jsx)("button",fn({onClick:Zr,disabled:D||vn.has(un),style:{backgroundColor:vn.has(un)?"#10B981":"#ffffff",color:vn.has(un)?"#ffffff":"#374151",border:"1px solid ".concat(vn.has(un)?"#10B981":"#D1D5DB"),borderRadius:"6px",padding:"8px 16px",fontSize:"14px",fontWeight:"500",cursor:D||vn.has(un)?"not-allowed":"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"6px",minWidth:"100px",justifyContent:"center",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",opacity:D||vn.has(un)?.7:1},onMouseOver:function(e){D||vn.has(un)||(e.currentTarget.style.borderColor="#9CA3AF",e.currentTarget.style.boxShadow="0 4px 6px -1px rgba(0, 0, 0, 0.1)")},onMouseOut:function(e){D||vn.has(un)||(e.currentTarget.style.borderColor="#D1D5DB",e.currentTarget.style.boxShadow="0 1px 2px 0 rgba(0, 0, 0, 0.05)")}},{children:vn.has(un)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Ze,{size:14}),"Saved"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(St,{size:14}),"Save"]})})),(0,a.jsxs)("button",fn({onClick:function(){Sn(!0),kn("")},disabled:D,style:{backgroundColor:"#ffffff",color:"#F59E0B",border:"1px solid #F59E0B",borderRadius:"6px",padding:"8px 16px",fontSize:"14px",fontWeight:"500",cursor:D?"not-allowed":"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"6px",minWidth:"100px",justifyContent:"center",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",opacity:D?.7:1},onMouseOver:function(e){D||(e.currentTarget.style.backgroundColor="#F59E0B",e.currentTarget.style.color="#ffffff",e.currentTarget.style.boxShadow="0 4px 6px -1px rgba(0, 0, 0, 0.1)")},onMouseOut:function(e){D||(e.currentTarget.style.backgroundColor="#ffffff",e.currentTarget.style.color="#F59E0B",e.currentTarget.style.boxShadow="0 1px 2px 0 rgba(0, 0, 0, 0.05)")}},{children:[(0,a.jsx)(lt,{size:14}),"Improve"]}))]})),(0,a.jsxs)("div",fn({style:{display:"flex",justifyContent:"center",gap:"8px"}},{children:[(0,a.jsx)("button",fn({onClick:Xr,disabled:D,style:{backgroundColor:"#ffffff",color:"#6B7280",border:"1px solid #D1D5DB",borderRadius:"6px",padding:"8px 16px",fontSize:"14px",fontWeight:"500",cursor:D?"not-allowed":"pointer",transition:"all 0.2s ease",minWidth:"100px",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",opacity:D?.7:1},onMouseOver:function(e){D||(e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.boxShadow="0 4px 6px -1px rgba(0, 0, 0, 0.1)")},onMouseOut:function(e){D||(e.currentTarget.style.backgroundColor="#ffffff",e.currentTarget.style.boxShadow="0 1px 2px 0 rgba(0, 0, 0, 0.05)")}},{children:"Cancel"})),(0,a.jsx)("button",fn({onClick:function(){return pn(void 0,void 0,void 0,(function(){var e,t,n;return gn(this,(function(r){M(!0);try{for(e=0,t=nn;e<t.length;e++)n=t[e],s(Ee(n));sn(!1),rn([]),mn(0),s(Ie(""))}catch(e){console.error("Error saving preview cards:",e),De("Error saving cards","error")}finally{M(!1)}return[2]}))}))},disabled:D,style:{backgroundColor:D?"#9CA3AF":"#3B82F6",color:"#ffffff",border:"none",borderRadius:"6px",padding:"8px 20px",fontSize:"14px",fontWeight:"600",cursor:D?"not-allowed":"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"6px",minWidth:"140px",justifyContent:"center",boxShadow:"0 4px 6px -1px rgba(59, 130, 246, 0.3)",opacity:D?.7:1},onMouseOver:function(e){D||(e.currentTarget.style.backgroundColor="#2563EB",e.currentTarget.style.boxShadow="0 6px 10px -1px rgba(59, 130, 246, 0.4)",e.currentTarget.style.transform="translateY(-1px)")},onMouseOut:function(e){D||(e.currentTarget.style.backgroundColor="#3B82F6",e.currentTarget.style.boxShadow="0 4px 6px -1px rgba(59, 130, 246, 0.3)",e.currentTarget.style.transform="translateY(0)")}},{children:D?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(_t,{type:"spinner",size:"small",inline:!0,color:"#ffffff"}),"Saving..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Ze,{size:14}),"Save All (",nn.length,")"]})}))]}))]}))]}))})),wn&&(0,a.jsx)("div",fn({style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:1e4,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"}},{children:(0,a.jsxs)("div",fn({style:{backgroundColor:"#ffffff",borderRadius:"8px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",maxWidth:"520px",width:"100%",maxHeight:"80vh",overflow:"hidden",display:"flex",flexDirection:"column",border:"1px solid #EAEAEA"}},{children:[(0,a.jsx)("div",fn({style:{padding:"20px 24px 16px 24px",borderBottom:"1px solid #EAEAEA"}},{children:(0,a.jsxs)("div",fn({style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",fn({style:{margin:0,fontSize:"18px",fontWeight:"600",color:"#000000",letterSpacing:"-0.025em"}},{children:"Improve Card"})),(0,a.jsx)("p",fn({style:{margin:"4px 0 0 0",fontSize:"14px",color:"#666666",fontWeight:"400"}},{children:"Provide feedback to create a better version"}))]}),(0,a.jsx)("button",fn({onClick:function(){return Sn(!1)},style:{background:"none",border:"none",fontSize:"16px",color:"#999999",cursor:"pointer",padding:"6px",borderRadius:"4px",transition:"all 0.15s ease"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#F5F5F5",e.currentTarget.style.color="#666666"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="#999999"}},{children:(0,a.jsx)(kt,{})}))]}))})),(0,a.jsxs)("div",fn({style:{padding:"24px",flex:1,overflow:"auto"}},{children:[(0,a.jsx)("textarea",{value:En,onChange:function(e){return kn(e.target.value)},placeholder:"Example: Make the question more specific, simplify the answer, add more context, focus on practical examples...",style:{width:"100%",minHeight:"140px",padding:"16px",borderRadius:"6px",border:"1px solid #EAEAEA",backgroundColor:"#FAFAFA",fontSize:"14px",lineHeight:"1.6",resize:"vertical",fontFamily:"inherit",outline:"none",transition:"all 0.15s ease"},onFocus:function(e){e.currentTarget.style.borderColor="#0070F3",e.currentTarget.style.backgroundColor="#ffffff"},onBlur:function(e){e.currentTarget.style.borderColor="#EAEAEA",e.currentTarget.style.backgroundColor="#FAFAFA"}}),(0,a.jsx)("div",fn({style:{marginTop:"16px",padding:"12px 16px",backgroundColor:"#F9F9F9",borderRadius:"6px",border:"1px solid #EAEAEA"}},{children:(0,a.jsxs)("div",fn({style:{display:"flex",alignItems:"flex-start",gap:"8px",fontSize:"13px",color:"#666666",lineHeight:"1.5"}},{children:[(0,a.jsx)(mt,{size:14,style:{color:"#999999",marginTop:"1px"}}),(0,a.jsx)("span",{children:"Be specific about what you want to change for better results"})]}))}))]})),(0,a.jsxs)("div",fn({style:{padding:"20px 24px",borderTop:"1px solid #EAEAEA",backgroundColor:"#FAFAFA",display:"flex",justifyContent:"flex-end",gap:"8px"}},{children:[(0,a.jsx)("button",fn({onClick:function(){return Sn(!1)},style:{backgroundColor:"transparent",color:"#999999",border:"none",padding:"8px 12px",fontSize:"13px",fontWeight:"500",cursor:"pointer",transition:"all 0.15s ease",borderRadius:"5px"},onMouseOver:function(e){e.currentTarget.style.color="#666666",e.currentTarget.style.backgroundColor="#F5F5F5"},onMouseOut:function(e){e.currentTarget.style.color="#999999",e.currentTarget.style.backgroundColor="transparent"}},{children:"Cancel"})),(0,a.jsx)("button",fn({onClick:function(){return pn(void 0,void 0,void 0,(function(){var e,t,n,r,o,a,i,s,l,u,d,f;return gn(this,(function(p){switch(p.label){case 0:Sn(!1),M(!0),p.label=1;case 1:if(p.trys.push([1,7,8,9]),!(e=nn[un]))return De("No card to recreate","error"),[2];t=ln(_n,Tn),n="Please recreate this card with improvements. Original card:\nQuestion: ".concat(e.front,"\nAnswer: ").concat(e.back,"\nOriginal text: ").concat(c),En.trim()&&(n+="\n\nUser feedback: ".concat(En.trim())),n+="\n\nPlease create an improved version based on the feedback.",r=void 0,p.label=2;case 2:return p.trys.push([2,4,,5]),o=window.getSelection(),a=void 0,o&&o.rangeCount>0&&(i=o.getRangeAt(0),a=i.commonAncestorContainer.nodeType===Node.ELEMENT_NODE?i.commonAncestorContainer:i.commonAncestorContainer.parentElement||void 0),[4,dn.extractPageContentAsync(c,a)];case 3:return r=p.sent(),[3,5];case 4:return s=p.sent(),console.warn("Failed to extract page content for recreation:",s),r=void 0,[3,5];case 5:return[4,t.createCardsFromText(n,r)];case 6:return(l=p.sent()).length>0?((u=hn([],nn,!0))[un]=l[0],rn(u),xn((function(e){var t=new Set(e);return t.delete(un),t}))):De("Failed to recreate card","error"),[3,9];case 7:return d=p.sent(),console.error("Error recreating card:",d),f=d instanceof Error?d.message:"Unknown error",De("Card recreation error: ".concat(f),"error"),[3,9];case 8:return M(!1),kn(""),[7];case 9:return[2]}}))}))},disabled:D,style:{backgroundColor:D?"#F5F5F5":"#000000",color:D?"#999999":"#ffffff",border:"none",borderRadius:"5px",padding:"8px 16px",fontSize:"13px",fontWeight:"500",cursor:D?"not-allowed":"pointer",transition:"all 0.15s ease",display:"flex",alignItems:"center",gap:"6px",opacity:D?.6:1},onMouseOver:function(e){D||(e.currentTarget.style.backgroundColor="#333333")},onMouseOut:function(e){D||(e.currentTarget.style.backgroundColor="#000000")}},{children:D?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(_t,{type:"spinner",size:"small",inline:!0,color:"#999999"}),"Improving..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(lt,{size:11}),"Improve Card"]})}))]}))]}))})),(0,a.jsx)("div",fn({style:{position:"absolute",top:"16px",right:"16px",zIndex:9999,pointerEvents:"none"}},{children:(0,a.jsx)("div",fn({style:{pointerEvents:"auto"}},{children:Me()}))})),(0,a.jsx)("style",{children:"\n                    @keyframes shimmer {\n                        0% {\n                            left: -100%;\n                        }\n                        100% {\n                            left: 100%;\n                        }\n                    }\n                "})]}))},yn=n.p+"assets/img/chat-gpt39f424be38a6852eb2c5.png",vn=n.p+"assets/img/copy-iconb2b0ec637a2b0fd4ca40.svg";var xn=function(){return xn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},xn.apply(this,arguments)},bn=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},wn=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}};const Sn=function(e){e.onBackClick,e.popup;var t=k(),n=(0,r.useState)(null),o=n[0],i=n[1],s=m((function(e){return e.settings.openAiKey})),l=(m((function(e){return e.settings.ankiConnectUrl})),m((function(e){return e.settings.ankiConnectApiKey}))),c=m((function(e){return e.settings.groqApiKey})),u=m((function(e){return e.settings.groqModelName})),d=m((function(e){return e.settings.modelProvider})),f=function(e){t((0,We.Wy)(e.target.value))},p=function(e){t((0,We.H1)(e.target.value))},g=function(e){t((0,We.KS)(e.target.value))},h=chrome.runtime.getURL(yn),y=chrome.runtime.getURL(vn),v=function(e){return bn(void 0,void 0,void 0,(function(){var t,n,r,o,a,l,d,f;return wn(this,(function(p){switch(p.label){case 0:i(null),p.label=1;case 1:switch(p.trys.push([1,4,,5]),t="",n={},r={},o="",e){case tn.l.OpenAI:t="https://api.openai.com/v1/chat/completions",n={"Content-Type":"application/json",Authorization:"Bearer ".concat(o=s)},r={model:"gpt-5-nano",messages:[{role:"user",content:"Say hello"}]};break;case tn.l.Groq:t="https://api.groq.com/openai/v1/chat/completions",n={"Content-Type":"application/json",Authorization:"Bearer ".concat(o=c)},r={model:u,messages:[{role:"user",content:"Say hello"}]}}return o.trim()?[4,fetch(t,{method:"POST",headers:n,body:JSON.stringify(r)})]:(i({success:!1,message:"API key is missing. Please enter your API key."}),[2]);case 2:return[4,(a=p.sent()).json()];case 3:return l=p.sent(),a.ok?(console.log("API test response:",l),i({success:!0,message:"Connection successful! API is working properly."})):(console.error("API test error:",l),i({success:!1,message:"Error: ".concat((null===(f=l.error)||void 0===f?void 0:f.message)||"Unknown error occurred")})),[3,5];case 4:return d=p.sent(),console.error("API connection test error:",d),i({success:!1,message:"Error: ".concat(d instanceof Error?d.message:"Unknown error occurred")}),[3,5];case 5:return[2]}}))}))},x=function(){return o?(0,a.jsx)("div",xn({style:{padding:"10px",marginTop:"10px",borderRadius:"6px",backgroundColor:o.success?"#ECFDF5":"#FEF2F2",color:o.success?"#065F46":"#B91C1C",fontSize:"14px",borderLeft:"4px solid ".concat(o.success?"#10B981":"#EF4444")}},{children:o.message})):null};return(0,a.jsxs)("div",xn({style:{padding:"12px",backgroundColor:"#ffffff",height:"100%",width:"100%",maxWidth:"320px",margin:"0 auto",overflowY:"auto",paddingBottom:"16px",marginTop:"20px"}},{children:[(0,a.jsxs)("div",xn({style:{marginBottom:"20px",backgroundColor:"#F9FAFB",padding:"12px",borderRadius:"8px"}},{children:[(0,a.jsx)("label",xn({htmlFor:"modelProvider",style:{display:"block",fontWeight:"600",marginBottom:"8px",color:"#111827",fontSize:"14px"}},{children:"AI Provider"})),(0,a.jsx)("p",xn({style:{fontSize:"12px",marginBottom:"8px",color:"#6B7280"}},{children:"Select which provider to use for generating flashcards"})),(0,a.jsxs)("select",xn({id:"modelProvider",value:d,onChange:function(e){t((0,We.dU)(e.target.value)),i(null)},style:{width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"13px",outline:"none",transition:"all 0.2s ease",cursor:"pointer"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}},{children:[(0,a.jsx)("option",xn({value:tn.l.OpenAI},{children:"OpenAI"})),(0,a.jsx)("option",xn({value:tn.l.Groq},{children:"Groq"}))]}))]})),(0,a.jsxs)("div",{children:[d!==tn.l.OpenAI?null:(0,a.jsxs)("div",xn({style:{marginBottom:"20px"}},{children:[(0,a.jsxs)("div",xn({style:{display:"flex",alignItems:"center",marginBottom:"8px"}},{children:[(0,a.jsx)("label",xn({htmlFor:"openAiKey",style:{display:"block",fontWeight:"600",marginBottom:"0",marginRight:"8px",color:"#111827",fontSize:"14px"}},{children:"OpenAI API Key"})),(0,a.jsx)("img",{src:h,alt:"ChatGPT Logo",style:{width:"16px",height:"16px",marginTop:"-2px"}})]})),(0,a.jsxs)("p",xn({style:{fontSize:"12px",marginBottom:"6px",color:"#6B7280"}},{children:["You can get your OpenAI API key from ",(0,a.jsx)("a",xn({href:"https://platform.openai.com/account/api-keys",target:"_blank",rel:"noopener noreferrer",style:{color:"#2563EB",textDecoration:"underline"}},{children:"here"})),"."]})),(0,a.jsx)("div",xn({style:{position:"relative",marginBottom:"16px"}},{children:(0,a.jsx)("input",{type:"text",id:"openAiKey",value:s,onChange:f,style:{width:"100%",padding:"8px 10px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"13px",outline:"none",transition:"all 0.2s ease"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}})})),(0,a.jsx)("button",xn({onClick:function(){return v(tn.l.OpenAI)},style:{marginTop:"8px",padding:"6px 12px",backgroundColor:"#10a37f",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px"}},{children:"Test API Connection"})),x()]})),d!==tn.l.Groq?null:(0,a.jsxs)("div",xn({style:{marginBottom:"20px"}},{children:[(0,a.jsx)("label",xn({htmlFor:"groqApiKey",style:{display:"block",fontWeight:"600",marginBottom:"8px",color:"#111827",fontSize:"14px"}},{children:"Groq API Key"})),(0,a.jsxs)("p",xn({style:{fontSize:"12px",marginBottom:"8px",color:"#6B7280"}},{children:["You can get your Groq API key from ",(0,a.jsx)("a",xn({href:"https://console.groq.com/keys",target:"_blank",rel:"noopener noreferrer",style:{color:"#2563EB",textDecoration:"underline"}},{children:"here"})),"."]})),(0,a.jsx)("input",{type:"text",id:"groqApiKey",value:c,onChange:p,style:{width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"13px",outline:"none",transition:"all 0.2s ease",marginBottom:"16px"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}}),(0,a.jsx)("div",xn({style:{padding:"8px",backgroundColor:"#DBEAFE",borderRadius:"6px",marginBottom:"16px"}},{children:(0,a.jsxs)("p",xn({style:{fontSize:"12px",color:"#1E40AF",margin:0}},{children:[(0,a.jsx)("strong",{children:"Note:"})," Image generation is not available with Groq."]}))})),(0,a.jsx)("label",xn({htmlFor:"groqModelName",style:{display:"block",fontWeight:"600",marginBottom:"8px",color:"#111827",fontSize:"14px"}},{children:"Groq Model"})),(0,a.jsxs)("select",xn({id:"groqModelName",value:u,onChange:g,style:{width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"13px",outline:"none",transition:"all 0.2s ease",cursor:"pointer",marginBottom:"16px"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}},{children:[(0,a.jsx)("option",xn({value:"llama3-8b-8192"},{children:"Llama-3 8B"})),(0,a.jsx)("option",xn({value:"llama3-70b-8192"},{children:"Llama-3 70B"})),(0,a.jsx)("option",xn({value:"mixtral-8x7b-32768"},{children:"Mixtral 8x7B"})),(0,a.jsx)("option",xn({value:"gemma-7b-it"},{children:"Gemma 7B"}))]})),(0,a.jsx)("button",xn({onClick:function(){return v(tn.l.Groq)},style:{marginTop:"8px",padding:"6px 12px",backgroundColor:"#7c3aed",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"13px"}},{children:"Test API Connection"})),x()]})),(0,a.jsx)("div",{style:{marginBottom:"20px"}})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",xn({htmlFor:"ankiConnectApiKey",style:{display:"block",fontWeight:"600",marginBottom:"8px",color:"#111827",fontSize:"14px"}},{children:"AnkiConnect API Key (optional)"})),(0,a.jsx)("input",{type:"text",id:"ankiConnectApiKey",value:null!==l?l:"",onChange:function(e){t((0,We.Zm)(e.target.value))},style:{width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"13px",outline:"none",transition:"all 0.2s ease",marginBottom:"20px"},onFocus:function(e){return e.target.style.borderColor="#2563EB"},onBlur:function(e){return e.target.style.borderColor="#E5E7EB"}})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",xn({style:{fontSize:"13px",marginBottom:"8px",color:"#6B7280"}},{children:["Install the Anki plugin ",(0,a.jsx)("strong",{children:"AnkiConnect"})," and configure it as follows:"]})),(0,a.jsxs)("ul",xn({style:{fontSize:"13px",listStyle:"disc",paddingLeft:"20px",marginBottom:"8px",color:"#6B7280"}},{children:[(0,a.jsxs)("li",xn({style:{marginBottom:"4px"}},{children:["Go to ",(0,a.jsx)("strong",{children:"Tools"})," then ",(0,a.jsx)("strong",{children:"Add-ons"})," then ",(0,a.jsx)("strong",{children:"Get Add-ons..."})]})),(0,a.jsxs)("li",xn({style:{marginBottom:"4px",display:"flex",alignItems:"center"}},{children:["Paste Code  ",(0,a.jsxs)("button",xn({onClick:function(){return navigator.clipboard.writeText("2055492159")},style:{display:"flex",alignItems:"center",backgroundColor:"#F3F4F6",padding:"4px 6px",borderRadius:"4px",color:"#2563EB",transition:"all 0.2s ease",border:"none",cursor:"pointer"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="#E5E7EB"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="#F3F4F6"}},{children:[(0,a.jsx)("img",{src:y,alt:"Copy Icon",style:{width:"16px",height:"16px",marginRight:"4px"}}),(0,a.jsx)("code",xn({style:{backgroundColor:"transparent",fontSize:"12px"}},{children:"2055492159"}))]}))]})),(0,a.jsxs)("li",xn({style:{marginBottom:"4px"}},{children:["Then click ",(0,a.jsx)("strong",{children:"OK"})]})),(0,a.jsx)("li",xn({style:{marginBottom:"4px"}},{children:"Restart Anki"})),(0,a.jsxs)("li",xn({style:{marginBottom:"4px"}},{children:["Navigate to ",(0,a.jsx)("strong",{children:"Tools"})," > ",(0,a.jsx)("strong",{children:"Add-ons"})," > ",(0,a.jsx)("strong",{children:"AnkiConnect"})," >",(0,a.jsx)("strong",{children:"Config"})]}))]})),(0,a.jsxs)("div",xn({style:{position:"relative",backgroundColor:"#F9FAFB",padding:"12px",borderRadius:"6px",marginBottom:"20px"}},{children:[(0,a.jsxs)("p",xn({style:{fontSize:"13px",marginBottom:"8px",color:"#6B7280"}},{children:["Copy paste the following config, you can change the ",(0,a.jsx)("code",{children:"apiKey"}),":"]})),(0,a.jsx)("pre",xn({style:{display:"block",overflow:"auto",padding:"10px",backgroundColor:"#F3F4F6",borderRadius:"4px",whiteSpace:"pre-wrap",cursor:"pointer",fontSize:"12px",color:"#374151",margin:0},onClick:function(){return navigator.clipboard.writeText(JSON.stringify({apiKey:l||"your_api_key",webCorsOriginList:["http://localhost","*"],webBindPort:8765},null,2))},title:"Click to copy"},{children:JSON.stringify({apiKey:l||"your_api_key",webCorsOriginList:["http://localhost","*"],webBindPort:8765},null,2)})),(0,a.jsx)("button",xn({onClick:function(){return navigator.clipboard.writeText(JSON.stringify({apiKey:l||"your_api_key",webCorsOriginList:["http://localhost","*"],webBindPort:8765},null,2))},style:{position:"absolute",top:"8px",right:"8px",background:"transparent",border:"none",cursor:"pointer",padding:"4px"},title:"Copy to clipboard"},{children:(0,a.jsx)("img",{src:y,alt:"Copy Icon",style:{width:"16px",height:"16px"}})}))]}))]})]}))};var Cn="FETCH_DECKS_SUCCESS",En="SET_DECK_ID",kn=function(e){return{type:En,payload:e}},In=function(){return In=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},In.apply(this,arguments)},An=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},_n=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},Tn=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))};const jn=function(e){e.onBackClick;var t=k(),n=Ue(),o=n.storedCards,i=m((function(e){return e.deck.deckId})),s=m((function(e){return e.deck.decks})),l=m((function(e){return e.settings.useAnkiConnect})),c=m((function(e){return e.settings.ankiConnectUrl})),u=m((function(e){return e.settings.ankiConnectApiKey})),d=m((function(e){return e.settings.openAiKey})),f=m((function(e){return e.settings.imageInstructions})),p=m((function(e){return e.cards})),g=(0,r.useState)([]),h=g[0],y=g[1],v=(0,r.useState)(!1),x=v[0],b=v[1],w=(0,r.useState)(!1),S=w[0],C=w[1],E=(0,r.useState)("not_exported"),I=E[0],A=E[1],_=(0,r.useState)(!1),T=_[0],j=_[1],F=(0,r.useState)(null),R=F[0],O=F[1],P=(0,r.useState)(!1),B=P[0],N=P[1],L=(0,r.useState)(!1),z=(L[0],L[1]),D=(0,r.useState)(""),M=D[0],U=D[1],q=(0,r.useState)(!1),W=q[0],V=q[1],$=(0,r.useState)(null),G=$[0],H=$[1],K=(0,r.useState)(!1),Y=K[0],J=K[1],X=(0,r.useState)(!1),Z=X[0],ee=X[1],te=(0,r.useState)(1),re=te[0],oe=te[1],ae=(0,r.useState)(10),ie=ae[0],se=ae[1],le=(0,r.useState)(1),ce=le[0],ue=le[1],de=(0,r.useState)(!1),fe=de[0],pe=de[1],ge=(0,r.useState)("anki_cards"),he=ge[0],me=ge[1],ye=(0,r.useState)(!1),ve=ye[0],xe=ye[1],be=Wt(),we=be.showError,Se=be.renderErrorNotification;new zt.z4({apiKey:d,dangerouslyAllowBrowser:!0});(0,r.useEffect)((function(){An(void 0,void 0,void 0,(function(){var e,n,r;return _n(this,(function(a){console.log("StoredCards component mounted, forcing complete reload of cards...");try{if(e=localStorage.getItem("anki_stored_cards"))try{n=JSON.parse(e),console.log("Direct from localStorage, found cards:",n.length)}catch(e){console.error("Failed to parse localStorage data directly:",e)}else console.log("No cards found directly in localStorage")}catch(e){console.error("Error accessing localStorage directly:",e)}return t(ke()),r=setTimeout((function(){if(console.log("Current stored cards after initial load:",o.length),0===o.length){console.log("No cards loaded, trying to load directly from localStorage...");try{var e=localStorage.getItem("anki_stored_cards");if(e){var n=JSON.parse(e);Array.isArray(n)&&n.length>0&&(console.log("Found cards directly in localStorage, manually setting in Redux..."),t({type:"SET_STORED_CARDS",payload:n}))}}catch(e){console.error("Failed to manually load cards:",e)}}if(o.length>0){var r=o.filter((function(e){return"not_exported"===e.exportStatus})).length,a=o.filter((function(e){return"exported_to_anki"===e.exportStatus||"exported_to_file"===e.exportStatus})).length;console.log("Card stats: total=",o.length,"not_exported=",r,"exported=",a),o.forEach((function(e,t){var n,r,o,a;(e.image||e.imageUrl)&&console.log("Card ".concat(t," (").concat(e.id,") has images:"),{hasImage:!!e.image,hasImageUrl:!!e.imageUrl,imageType:typeof e.image,imageUrlType:typeof e.imageUrl,imageLength:null===(n=e.image)||void 0===n?void 0:n.length,imageUrlLength:null===(r=e.imageUrl)||void 0===r?void 0:r.length,imageStart:null===(o=e.image)||void 0===o?void 0:o.substring(0,30),imageUrlStart:null===(a=e.imageUrl)||void 0===a?void 0:a.substring(0,30)})}))}}),500),[2,function(){return clearTimeout(r)}]}))}))}),[t,o.length]),(0,r.useEffect)((function(){console.log("Stored cards updated:",o)}),[o]);var Ee=function(){return An(void 0,void 0,void 0,(function(){var e,n;return _n(this,(function(r){switch(r.label){case 0:if(!l)return[2];r.label=1;case 1:return r.trys.push([1,3,4,5]),C(!0),[4,ne(u)];case 2:return(e=r.sent()).result&&(t({type:"FETCH_DECKS_SUCCESS",payload:e.result}),!i&&e.result.length>0&&t(kn(e.result[0].deckId))),[3,5];case 3:return n=r.sent(),console.error("Error loading decks:",n),l&&we("Failed to load Anki decks. Make sure Anki is running with AnkiConnect plugin."),[3,5];case 4:return C(!1),[7];case 5:return[2]}}))}))};(0,r.useEffect)((function(){l&&0===s.length&&Ee()}),[l]);var Ie=function(){if(console.log("All cards in store:",o.length,"cards"),!Array.isArray(o)||0===o.length)return console.log("No cards to filter"),[];var e,t={not_exported:0,exported_to_anki:0,exported_to_file:0,unknown:0};switch(o.forEach((function(e){"not_exported"===e.exportStatus?t.not_exported++:"exported_to_anki"===e.exportStatus?t.exported_to_anki++:"exported_to_file"===e.exportStatus?t.exported_to_file++:t.unknown++})),console.log("Card status counts:",t),I){case"not_exported":e=o.filter((function(e){return"not_exported"===e.exportStatus})),console.log("Filtered to not_exported cards:",e.length);break;case"exported":e=o.filter((function(e){return"exported_to_anki"===e.exportStatus||"exported_to_file"===e.exportStatus})),console.log("Filtered to exported cards:",e.length);break;default:e=Tn([],o,!0),console.log("Using all cards:",e.length)}var n=e.sort((function(e,t){return new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()}));return console.log("Final filtered and sorted cards:",n.length),n}(),Ae=function(){if(0===Ie.length)return[];var e=(re-1)*ie,t=e+ie;return e>=Ie.length?(oe(1),Ie.slice(0,ie)):(console.log("Pagination debug:",{totalCards:o.length,filteredCards:Ie.length,currentPage:re,itemsPerPage:ie,startIndex:e,endIndex:t,cardsOnThisPage:Ie.slice(e,t).length}),Ie.slice(e,t))}();(0,r.useEffect)((function(){var e=Math.max(1,Math.ceil(Ie.length/ie));ue(e),re>e&&oe(1)}),[Ie.length,ie]);var _e={all:o.length,not_exported:o.filter((function(e){return"not_exported"===e.exportStatus})).length,exported:o.filter((function(e){return"exported_to_anki"===e.exportStatus||"exported_to_file"===e.exportStatus})).length},Te=function(e){var t=new Date(e),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),o=String(t.getHours()).padStart(2,"0"),a=String(t.getMinutes()).padStart(2,"0");return"".concat(r,"/").concat(n," ").concat(o,":").concat(a)},je=function(e){switch(e){case"exported_to_anki":return(0,a.jsx)("span",In({style:{fontSize:"11px",color:"#10B981",marginLeft:"8px"}},{children:"✓ Anki"}));case"exported_to_file":return(0,a.jsx)("span",In({style:{fontSize:"11px",color:"#2563EB",marginLeft:"8px"}},{children:"✓ File"}));default:return null}},Fe=function(e){return R===e?null:(0,a.jsxs)("div",In({style:{padding:"8px"}},{children:[(e.text||e.front)&&(0,a.jsx)("p",In({style:{fontWeight:"bold",fontSize:"14px",marginBottom:"4px",color:"#111827",lineHeight:"1.4",wordWrap:"break-word"}},{children:e.mode===Q.d.LanguageLearning?e.text:e.front})),(e.translation||e.back)&&(0,a.jsx)("div",In({style:{color:"#374151",fontSize:"13px",marginBottom:"8px",lineHeight:"1.4",wordWrap:"break-word"}},{children:e.mode===Q.d.LanguageLearning?e.translation:e.back&&(0,a.jsx)("div",{dangerouslySetInnerHTML:{__html:(t=e.back.length>150?e.back.substring(0,150)+"...":e.back,n=t,n=(n=(n=(n=(n=n.replace(/!\[([^\]]*)\]\(([^)]+)\)/g,(function(e,t,n){var r=t&&"Изображение"!==t&&"Image"!==t?t:"";return'<div style="text-align: center; margin: 6px 0;">\n            <img src="'.concat(n,'" alt="').concat(r,'" style="max-width: 100%; max-height: 120px; height: auto; border-radius: 3px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); display: block; margin: 0 auto;" />\n            ').concat(r?'<div style="font-size: 9px; color: #6B7280; margin-top: 2px; font-style: italic;">'.concat(r,"</div>"):"","\n        </div>")}))).replace(/\$\$([^$]+)\$\$/g,(function(e,t){return'<div style="text-align: center; margin: 8px 0; padding: 6px; background: #F8FAFC; border-radius: 4px; font-family: serif; font-size: 12px;">\n            <strong>Формула:</strong> '.concat(t,"\n        </div>")}))).replace(/```(\w*)\n([\s\S]*?)\n```/g,(function(e,t,n){return'<div style="margin: 8px 0;">\n            <div style="background: #2D2D2D; color: #F8F8F2; padding: 8px; border-radius: 4px; font-family: monospace; overflow-x: auto; white-space: pre; font-size: 11px;">\n                '.concat(t?'<div style="color: #6B7280; margin-bottom: 4px; font-size: 9px;">'.concat(t,"</div>"):"","\n                ").concat(n,"\n            </div>\n        </div>")}))).replace(/`([^`]+)`/g,'<code style="background: #F3F4F6; padding: 1px 3px; border-radius: 2px; font-family: monospace; font-size: 11px;">$1</code>')).replace(/\n/g,"<br />"))}})})),e.mode===Q.d.LanguageLearning&&e.examples&&e.examples.length>0&&(0,a.jsxs)("div",In({style:{marginTop:"8px"}},{children:[(0,a.jsx)("p",In({style:{fontSize:"12px",color:"#6B7280",marginBottom:"4px"}},{children:"Examples:"})),e.examples.slice(0,1).map((function(e,t){var n=e[0],r=e[1];return(0,a.jsxs)("div",In({style:{fontSize:"12px",marginBottom:"2px"}},{children:[(0,a.jsx)("p",In({style:{color:"#111827",marginBottom:"2px",lineHeight:"1.4",wordWrap:"break-word",overflow:"visible",whiteSpace:"normal"}},{children:n})),r&&(0,a.jsx)("p",In({style:{color:"#6B7280",fontStyle:"italic",lineHeight:"1.4",wordWrap:"break-word",overflow:"visible",whiteSpace:"normal"}},{children:r}))]}),t)})),e.examples.length>1&&(0,a.jsxs)("p",In({style:{fontSize:"11px",color:"#6B7280"}},{children:["+",e.examples.length-1," more examples"]}))]})),(e.image||e.imageUrl)&&(0,a.jsx)("div",In({style:{marginTop:"8px",textAlign:"center"}},{children:(0,a.jsx)("img",{src:e.image||e.imageUrl||"",alt:"Card image",style:{maxWidth:"100%",maxHeight:"80px",borderRadius:"4px",border:"1px solid #E5E7EB",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"},onError:function(t){var n,r,o,a,i;console.error("Image failed to load for card:",e.id,"image data:",{hasImage:!!e.image,hasImageUrl:!!e.imageUrl,imageLength:null===(n=e.image)||void 0===n?void 0:n.length,imageUrlLength:null===(r=e.imageUrl)||void 0===r?void 0:r.length,imagePreview:null===(o=e.image)||void 0===o?void 0:o.substring(0,50),imageUrlPreview:null===(a=e.imageUrl)||void 0===a?void 0:a.substring(0,50),imageSrc:(e.image||e.imageUrl||"").substring(0,100),usingType:e.image?"base64 (permanent)":"url (temporary)"});var s=t.target;s.style.display="none";var l=document.createElement("div");l.style.cssText="\n                                    width: 100%;\n                                    height: 60px;\n                                    background-color: #F3F4F6;\n                                    border: 1px dashed #D1D5DB;\n                                    border-radius: 4px;\n                                    display: flex;\n                                    align-items: center;\n                                    justify-content: center;\n                                    color: #6B7280;\n                                    font-size: 12px;\n                                ",l.textContent=e.image?"🖼️ Image error":"🖼️ URL expired",null===(i=s.parentNode)||void 0===i||i.insertBefore(l,s.nextSibling)},onLoad:function(){var t,n;console.log("✅ Image loaded successfully for card:",e.id,{usingType:e.image?"base64 (permanent)":"url (temporary)",imageLength:null===(t=e.image)||void 0===t?void 0:t.length,imageUrlLength:null===(n=e.imageUrl)||void 0===n?void 0:n.length})}})})),(0,a.jsxs)("div",In({style:{marginTop:"8px",display:"flex",justifyContent:"space-between",alignItems:"center"}},{children:[(0,a.jsx)("span",In({style:{fontSize:"10px",color:"#6B7280",backgroundColor:e.mode===Q.d.LanguageLearning?"#EEF2FF":"#F0FDF4",padding:"2px 6px",borderRadius:"12px",border:"1px solid ".concat(e.mode===Q.d.LanguageLearning?"#C7D2FE":"#BBF7D0"),fontWeight:"500"}},{children:e.mode===Q.d.LanguageLearning?"🗣️ Language":"📚 General"})),(0,a.jsx)("span",In({style:{fontSize:"10px",color:"#9CA3AF"}},{children:Te(e.createdAt)}))]}))]}));var t,n},Re=function(e){t(kn(e.target.value))},Oe=function(){j((function(e){return!e}))},Pe=function(e){console.log("Starting to edit card:",e.id),console.log("Card data:",e),O(e),H(In({},e)),N(!0),z(!0),U(""),V(!1),J(!1),ee(!1),console.log("Modal state set for editing card:",e.id)},Be=function(){console.log("Canceling edit, resetting modal state..."),O(null),H(null),N(!1),z(!1),U(""),V(!1),J(!1),ee(!1),console.log("Edit canceled, modal should be hidden now.")},Ne=function(){return An(void 0,void 0,void 0,(function(){var e,t;return _n(this,(function(r){if(!R||!G)return[2];try{if(ee(!0),(e=In(In({},R),{text:G.text||R.text||"",translation:G.translation||R.translation||"",examples:Array.isArray(G.examples)?G.examples:Array.isArray(R.examples)?R.examples:[],front:G.front||R.front||"",back:G.back||R.back||"",image:G.image||R.image||null,imageUrl:G.imageUrl||R.imageUrl||null,linguisticInfo:G.linguisticInfo||R.linguisticInfo||"",transcription:G.transcription||R.transcription||""})).mode===Q.d.LanguageLearning){if(!e.text||!e.translation)return we("Please provide both text and translation"),[2];e.text=e.text.trim(),e.translation=e.translation.trim()}else{if(!e.front||!e.back)return we("Please provide both front and back content"),[2];e.front=e.front.trim(),e.back=(null===(t=e.back)||void 0===t?void 0:t.trim())||null}console.log("Final data being saved to Redux:",e),n.updateStoredCard(e),Be()}catch(e){console.error("Error saving card:",e),we("Failed to update card. Please try again.")}finally{ee(!1)}return[2]}))}))},Le=function(){return An(void 0,void 0,void 0,(function(){var e,t,n,r,o,a,i;return _n(this,(function(s){switch(s.label){case 0:if(!R)return[2];s.label=1;case 1:if(s.trys.push([1,6,,7]),!d)throw new Error("OpenAI API key is not configured. Please add it in the settings.");return e=(null==G?void 0:G.text)||R.text,console.log("Starting image generation for text:",e),[4,(0,qe.getDescriptionImage)(d,e,f)];case 2:if(t=s.sent(),console.log("Description generated:",t),!t)throw new Error("Failed to generate image description");return n=f?"".concat(t,". ").concat(f):t,[4,fetch("https://api.openai.com/v1/images/generations",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(d)},body:JSON.stringify({prompt:n,n:1,size:"512x512",response_format:"url"})})];case 3:return[4,s.sent().json()];case 4:if(r=s.sent(),console.log("OpenAI direct API response:",r),!r.data||!r.data[0]||!r.data[0].url)throw new Error("OpenAI did not return an image URL");return o=r.data[0].url,console.log("Image URL generated:",o),[4,new Promise((function(e,t){chrome.runtime.sendMessage(o,(function(n){if(chrome.runtime.lastError)return console.error("Error sending message:",chrome.runtime.lastError),void t(chrome.runtime.lastError);console.log("Response from background script:",n),n&&n.status&&n.data?e(n.data):t(new Error("Failed to get image data from background script"))}))}))];case 5:return a=s.sent(),console.log("Image data received from background"),G&&H(In(In({},G),{imageUrl:a,image:a})),[3,7];case 6:return i=s.sent(),console.error("Error generating image:",i),we("Image generation failed: ".concat((null==i?void 0:i.message)||"Unknown error")),[3,7];case 7:return[2]}}))}))},ze=function(){return An(void 0,void 0,void 0,(function(){return _n(this,(function(e){if(!R)return[2];try{J(!0),(null==G?void 0:G.text)||R.text,we("Examples generation would be implemented here","info")}catch(e){console.error("Error generating examples:",e),we("Examples generation failed: ".concat((null==e?void 0:e.message)||"Unknown error"))}finally{J(!1)}return[2]}))}))},De=function(){return An(void 0,void 0,void 0,(function(){return _n(this,(function(e){if(!M.trim()||W||!R)return[2];V(!0);try{we('Custom instruction "'.concat(M,'" would be applied here'),"info"),U("")}catch(e){console.error("Error applying custom instructions:",e),we("Failed to apply custom instructions")}finally{V(!1)}return[2]}))}))},Me=function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),De())},We=function(e){G&&H(In(In({},G),{translation:e}))},Ve=function(e){G&&H(In(In({},G),{examples:e}))},$e=function(e){G&&H(In(In({},G),{back:e}))},Ge=function(e){G&&H(In(In({},G),{linguisticInfo:e}))},He=function(e){e>=1&&e<=ce&&oe(e)},Ke=function(e){se(Number(e.target.value)),oe(1)};(0,r.useEffect)((function(){var e,t;console.log("Modal state changed:",{showEditModal:B,editingCard:null==R?void 0:R.id,currentCardData:{text:(null===(e=p.text)||void 0===e?void 0:e.substring(0,20))+"...",translation:(null===(t=p.translation)||void 0===t?void 0:t.substring(0,20))+"..."}})}),[B,R,p.text,p.translation]);var Qe,Ye=function(){return An(void 0,void 0,void 0,(function(){var e,t,r,a,i,s,l,c;return _n(this,(function(u){if(0===h.length)return we("Please select at least one card to export"),[2];try{xe(!0),e=o.filter((function(e){return h.includes(e.id)})),t="#separator:tab\n#html:true\n",e.forEach((function(e,n){var r,o,a,i;if(console.log("Processing card ".concat(n," for file export:"),{id:e.id,mode:e.mode,hasImage:!!e.image,hasImageUrl:!!e.imageUrl,imageType:typeof e.image,imageUrlType:typeof e.imageUrl,imageLength:null===(r=e.image)||void 0===r?void 0:r.length,imageUrlLength:null===(o=e.imageUrl)||void 0===o?void 0:o.length,imagePreview:null===(a=e.image)||void 0===a?void 0:a.substring(0,50),imageUrlPreview:null===(i=e.imageUrl)||void 0===i?void 0:i.substring(0,50),hasLinguisticInfo:!!e.linguisticInfo}),e.mode===Q.d.LanguageLearning){var s=e.text.trim(),l="";if(e.translation&&(l+="<b>".concat(e.translation,"</b>")),e.examples&&e.examples.length>0&&(l+="<br><br>",e.examples.forEach((function(e,t){var n=e[0],r=e[1];l+="".concat(t+1,". ").concat(n),r&&(l+="<br><span style='font-size: 0.8em;'><i>".concat(r,"</i></span>")),l+="<br><br>"}))),e.image)if((h=e.image).startsWith("data:")){var c="base64,";if(-1!==(v=h.indexOf(c))){var u=h.substring(v+c.length);l+='<div><img src="data:image/jpeg;base64,'.concat(u,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else l+='<div><img src="'.concat(h,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else l+='<div><img src="data:image/jpeg;base64,'.concat(h,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>');else if(e.imageUrl){if((y=e.imageUrl).startsWith("data:")){c="base64,";if(-1!==(v=y.indexOf(c))){u=y.substring(v+c.length);l+='<div><img src="data:image/jpeg;base64,'.concat(u,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else l+='<div><img src="'.concat(y,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else y.startsWith("http")?l+='<div><img src="'.concat(y,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>'):l+='<div><img src="data:image/jpeg;base64,'.concat(y,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}if(e.linguisticInfo&&e.linguisticInfo.trim()){var d=e.linguisticInfo.trim().split("\n").filter((function(e){return e.trim()})),f="";d.forEach((function(e){var t=e.trim();if(t.match(/^[А-ЯЁA-Z][^:]*:$/))f+='<div style="color: #2563EB; font-weight: bold; margin-top: 12px; margin-bottom: 4px;">'.concat(t,"</div>");else if(t.startsWith("•")||t.startsWith("-")||t.startsWith("*")){var n=t.replace(/^[•\-*]\s*/,"");f+='<div style="margin-left: 16px; margin-bottom: 2px; color: #374151;">• '.concat(n,"</div>")}else if(t.includes(":")&&!t.endsWith(":")){var r=t.split(":"),o=r[0],a=r.slice(1).join(":").trim();f+='<div style="margin-bottom: 4px;"><span style="color: #6B7280; font-weight: 500;">'.concat(o.trim(),':</span> <span style="color: #111827;">').concat(a,"</span></div>")}else t&&(f+='<div style="margin-bottom: 6px; color: #374151; line-height: 1.4;">'.concat(t,"</div>"))})),f&&(l+='<div style="margin-top: 20px; padding: 12px; background-color: #F8FAFC; border-left: 4px solid #2563EB; border-radius: 0 6px 6px 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1);"><div style="color: #1E40AF; font-weight: bold; font-size: 14px; margin-bottom: 8px; display: flex; align-items: center;"><span style="margin-right: 6px;">📚</span>Grammar & Linguistics</div>'.concat(f,"</div>"))}var p=s.replace(/\t/g," ").replace(/\n/g," ").trim(),g=l.replace(/\t/g," ").replace(/\r?\n/g,"<br>").trim();t+="".concat(p,"\t").concat(g,"\n"),console.log("Exported card ".concat(n,":"),{front:p.substring(0,50),backLength:g.length,hasLinguisticInfo:g.includes("Grammar & Linguistics")})}else if(e.mode===Q.d.GeneralTopic){s=(e.front||e.text||"No content").trim();var h,m=(e.back||e.text||"").trim();if(e.image)if((h=e.image).startsWith("data:")){c="base64,";if(-1!==(v=h.indexOf(c))){u=h.substring(v+c.length);m+='<div><img src="data:image/jpeg;base64,'.concat(u,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else m+='<div><img src="'.concat(h,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else m+='<div><img src="data:image/jpeg;base64,'.concat(h,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>');else if(e.imageUrl){var y;if((y=e.imageUrl).startsWith("data:")){var v;c="base64,";if(-1!==(v=y.indexOf(c))){u=y.substring(v+c.length);m+='<div><img src="data:image/jpeg;base64,'.concat(u,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else m+='<div><img src="'.concat(y,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}else y.startsWith("http")?m+='<div><img src="'.concat(y,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>'):m+='<div><img src="data:image/jpeg;base64,'.concat(y,'" style="max-width: 350px; max-height: 350px; margin: 0 auto;"></div>')}p=s.replace(/\t/g," ").replace(/\n/g," ").trim(),g=m.replace(/\t/g," ").replace(/\r?\n/g,"<br>").trim();t+="".concat(p,"\t").concat(g,"\n"),console.log("Exported General Topic card ".concat(n,":"),{front:p.substring(0,50),backLength:g.length,hasImage:!(!e.image&&!e.imageUrl),imageSource:e.image?"image field":e.imageUrl?"imageUrl field":"none"})}})),(r=he.trim())||(r="anki_cards"),(r=r.replace(/[<>:"/\\|?*]/g,"_")).toLowerCase().endsWith(".txt")||(r+=".txt"),a=new Blob([t],{type:"text/plain;charset=utf-8;"}),i=URL.createObjectURL(a),(s=document.createElement("a")).setAttribute("href",i),s.setAttribute("download",r),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),l=e.length,c=e.filter((function(e){return e.linguisticInfo&&e.linguisticInfo.trim()})).length,console.log("Export complete: ".concat(l," cards exported, ").concat(c," with grammar information")),h.forEach((function(e){n.updateCardExportStatus(e,"exported_to_file"),console.log("Updated card ".concat(e," export status to 'exported_to_file'"))})),pe(!1),setTimeout((function(){try{var e=localStorage.getItem("anki_stored_cards");if(e){var t=JSON.parse(e);console.log("Verified localStorage after file export:",t.filter((function(e){return e.id&&h.includes(e.id)})).map((function(e){return{id:e.id,status:e.exportStatus}})))}}catch(e){console.error("Error verifying localStorage after file export:",e)}}),500)}catch(e){console.error("Error during file export:",e),we("Failed to export cards. Please try again.")}finally{xe(!1)}return[2]}))}))};return(0,a.jsxs)("div",In({style:{display:"flex",flexDirection:"column",height:"100%",padding:"12px",paddingBottom:"20px",overflowY:"auto",width:"100%",maxWidth:"320px",margin:"0 auto",position:"relative"}},{children:[(0,a.jsx)("div",In({style:{display:"flex",justifyContent:"center",alignItems:"center",marginBottom:"16px",paddingBottom:"12px",borderBottom:"1px solid #E5E7EB",marginTop:"20px"}},{children:(0,a.jsxs)("div",In({style:{fontWeight:"600",fontSize:"16px",color:"#111827",background:"linear-gradient(to right, #4F46E5, #2563EB)",backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",padding:"4px 12px",borderRadius:"16px",border:"1px solid #E5E7EB",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"}},{children:["Saved Cards (",o.length,")"]}))})),o.length>0?(0,a.jsxs)(a.Fragment,{children:[(Qe={base:{padding:"8px 16px",fontSize:"14px",fontWeight:"500",borderRadius:"6px 6px 0 0",cursor:"pointer",textAlign:"center",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"6px"},active:{backgroundColor:"#ffffff",color:"#2563EB",borderBottom:"2px solid #2563EB"},inactive:{backgroundColor:"#F3F4F6",color:"#6B7280",borderBottom:"2px solid transparent"}},(0,a.jsxs)("div",In({style:{display:"flex",width:"100%",borderBottom:"1px solid #E5E7EB",marginBottom:"16px",backgroundColor:"#F3F4F6"}},{children:[(0,a.jsxs)("div",In({onClick:function(){return A("not_exported")},style:In(In(In({},Qe.base),"not_exported"===I?Qe.active:Qe.inactive),{flex:1})},{children:["New",(0,a.jsx)("span",In({style:{backgroundColor:"not_exported"===I?"#2563EB":"#9CA3AF",color:"white",borderRadius:"9999px",fontSize:"12px",padding:"1px 6px",minWidth:"20px"}},{children:_e.not_exported}))]})),(0,a.jsxs)("div",In({onClick:function(){return A("all")},style:In(In(In({},Qe.base),"all"===I?Qe.active:Qe.inactive),{flex:1})},{children:["All",(0,a.jsx)("span",In({style:{backgroundColor:"all"===I?"#2563EB":"#9CA3AF",color:"white",borderRadius:"9999px",fontSize:"12px",padding:"1px 6px",minWidth:"20px"}},{children:_e.all}))]})),(0,a.jsxs)("div",In({onClick:function(){return A("exported")},style:In(In(In({},Qe.base),"exported"===I?Qe.active:Qe.inactive),{flex:1})},{children:["Exported",(0,a.jsx)("span",In({style:{backgroundColor:"exported"===I?"#2563EB":"#9CA3AF",color:"white",borderRadius:"9999px",fontSize:"12px",padding:"1px 6px",minWidth:"20px"}},{children:_e.exported}))]}))]}))),l&&function(){var e;if(!l)return null;var t={container:{display:"flex",flexDirection:"column",gap:"8px",marginBottom:"16px",backgroundColor:"#F9FAFB",padding:"12px",borderRadius:"8px",border:"1px solid #E5E7EB"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},title:{fontSize:"14px",fontWeight:"600",color:"#111827"},button:{backgroundColor:"transparent",border:"none",cursor:"pointer",color:"#6B7280",display:"flex",alignItems:"center",padding:"0",fontSize:"12px"},selectContainer:{display:"flex",alignItems:"center",gap:"8px",width:"100%"},select:{flex:1,padding:"8px 12px",borderRadius:"6px",border:"1px solid #E5E7EB",backgroundColor:"#ffffff",color:"#374151",fontSize:"14px",cursor:"pointer"},refreshButton:{backgroundColor:"#F3F4F6",border:"1px solid #E5E7EB",borderRadius:"6px",cursor:"pointer",color:"#6B7280",display:"flex",alignItems:"center",justifyContent:"center",padding:"8px",minWidth:"36px",height:"38px"}};return T?(0,a.jsxs)("div",In({style:t.container},{children:[(0,a.jsxs)("div",In({style:t.header},{children:[(0,a.jsx)("span",In({style:t.title},{children:"Select Anki Deck"})),(0,a.jsx)("button",In({onClick:Oe,style:t.button},{children:"Hide"}))]})),(0,a.jsxs)("div",In({style:t.selectContainer},{children:[(0,a.jsxs)("select",In({value:i,onChange:Re,style:t.select,disabled:S},{children:[0===s.length&&(0,a.jsx)("option",In({value:""},{children:"No decks available"})),s.map((function(e){return(0,a.jsx)("option",In({value:e.deckId},{children:e.name}),e.deckId)}))]})),(0,a.jsx)("button",In({onClick:Ee,disabled:S,title:"Refresh decks list",style:t.refreshButton,"aria-label":"Refresh decks"},{children:S?(0,a.jsx)("span",In({style:{marginLeft:"2px"}},{children:(0,a.jsx)(_t,{type:"spinner",size:"small",color:"#4B5563"})})):(0,a.jsx)(Ct,{size:14})}))]})),(0,a.jsx)("style",{children:"\n                    @keyframes spin {\n                        0% { transform: rotate(0deg); }\n                        100% { transform: rotate(360deg); }\n                    }\n                    "})]})):(0,a.jsxs)("div",In({style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",marginBottom:"12px",padding:"8px 12px",backgroundColor:"#F9FAFB",borderRadius:"6px",border:"1px solid #E5E7EB"}},{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",In({style:{fontSize:"13px",color:"#6B7280"}},{children:"Anki Deck:"})),(0,a.jsx)("span",In({style:{fontSize:"14px",fontWeight:"500",marginLeft:"8px",color:"#111827"}},{children:(null===(e=s.find((function(e){return e.deckId===i})))||void 0===e?void 0:e.name)||"None selected"}))]}),(0,a.jsx)("button",In({onClick:Oe,style:{backgroundColor:"transparent",border:"none",cursor:"pointer",color:"#2563EB",fontSize:"13px"}},{children:"Change"}))]}))}(),(0,a.jsxs)("div",In({style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"}},{children:[(0,a.jsxs)("div",In({style:{display:"flex",alignItems:"center"}},{children:[(0,a.jsx)("input",{type:"checkbox",id:"selectAll",checked:h.length===Ie.length&&Ie.length>0,onChange:function(){R||(h.length===Ie.length?y([]):y(Ie.map((function(e){return e.id}))))},style:{marginRight:"8px"},disabled:null!==R}),(0,a.jsx)("label",In({htmlFor:"selectAll",style:{fontSize:"14px",cursor:null!==R?"default":"pointer",opacity:null!==R?.6:1}},{children:h.length===Ie.length&&Ie.length>0?"Deselect All":"Select All"}))]})),(0,a.jsxs)("div",In({style:{display:"flex",gap:"8px",flexWrap:"wrap"}},{children:[(0,a.jsx)("button",In({onClick:function(){return An(void 0,void 0,void 0,(function(){var e,r,a,s,l,d,f,p;return _n(this,(function(g){switch(g.label){case 0:if(0===h.length)return we("Please select at least one card to save"),[2];b(!0),g.label=1;case 1:g.trys.push([1,10,11,12]),e="Basic",r=o.filter((function(e){return h.includes(e.id)})),a=[],s=[],l=function(e){var t,n,r,o,i,l,c,u,d,f;return _n(this,(function(p){switch(p.label){case 0:return e.mode===Q.d.LanguageLearning&&e.translation?(n=null,e.image&&(e.image.startsWith("data:")?(o="base64,",i=e.image.indexOf(o),n=-1!==i?e.image.substring(i+o.length):e.image):n=e.image),t={text:e.text,translation:e.translation,examples:e.examples||[],image_base64:n,linguisticInfo:e.linguisticInfo},console.log("Adding language learning card to Anki export:",{cardId:e.id,text:e.text,hasImage:!!n,imageLength:null==n?void 0:n.length,imagePreview:null==n?void 0:n.substring(0,30)}),a.push(t),[3,13]):[3,1];case 1:return e.mode!==Q.d.GeneralTopic||!e.front&&!e.text||!e.back&&!e.text?[3,13]:(n=null,(r=e.image||e.imageUrl)?r.startsWith("data:")?(o="base64,",i=r.indexOf(o),n=-1!==i?r.substring(i+o.length):r,[3,12]):[3,2]:[3,12]);case 2:if(!r.startsWith("http://")&&!r.startsWith("https://"))return[3,11];p.label=3;case 3:return p.trys.push([3,9,,10]),console.log("Fetching image from URL for card ".concat(e.id,": ").concat(r)),[4,fetch(r)];case 4:return(l=p.sent()).ok?[4,l.blob()]:[3,7];case 5:return c=p.sent(),[4,new Promise((function(e){var t=new FileReader;t.onloadend=function(){var n=t.result,r="base64,",o=n.indexOf(r);e(-1!==o?n.substring(o+7):n)},t.readAsDataURL(c)}))];case 6:return u=p.sent(),n=u,console.log("Successfully converted URL to base64 for card ".concat(e.id)),[3,8];case 7:console.warn("Failed to fetch image from URL for card ".concat(e.id,": ").concat(l.status)),p.label=8;case 8:return[3,10];case 9:return d=p.sent(),console.error("Error fetching image from URL for card ".concat(e.id,":"),d),[3,10];case 10:return[3,12];case 11:n=r,p.label=12;case 12:f={front:e.front||e.text||"No content",back:e.back||e.text||"No content",text:e.text,image_base64:n},console.log("Adding general topic card to Anki export:",{cardId:e.id,text:e.text,hasImage:!!n,imageLength:null==n?void 0:n.length,imagePreview:null==n?void 0:n.substring(0,30),originalImageSource:null==r?void 0:r.substring(0,50),hadImageField:!!e.image,hadImageUrlField:!!e.imageUrl,usedField:e.image?"image":e.imageUrl?"imageUrl":"none"}),s.push(f),p.label=13;case 13:return[2]}}))},d=0,f=r,g.label=2;case 2:return d<f.length?(p=f[d],[5,l(p)]):[3,5];case 3:g.sent(),g.label=4;case 4:return d++,[3,2];case 5:return a.length>0?[4,t(Ce(Q.d.LanguageLearning,c,u,i,e,a))]:[3,7];case 6:g.sent(),g.label=7;case 7:return s.length>0?[4,t(Ce(Q.d.GeneralTopic,c,u,i,e,s))]:[3,9];case 8:g.sent(),g.label=9;case 9:return h.forEach((function(e){n.updateCardExportStatus(e,"exported_to_anki"),console.log("Updated card ".concat(e," export status to 'exported_to_anki'"))})),setTimeout((function(){try{var e=localStorage.getItem("anki_stored_cards");if(e){var t=JSON.parse(e);console.log("Verified localStorage after export:",t.filter((function(e){return e.id&&h.includes(e.id)})).map((function(e){return{id:e.id,status:e.exportStatus}})))}}catch(e){console.error("Error verifying localStorage after export:",e)}}),500),[3,12];case 10:return g.sent(),we("Failed to save cards to Anki. Make sure Anki is running and AnkiConnect is properly configured."),[3,12];case 11:return b(!1),[7];case 12:return[2]}}))}))},disabled:x||0===h.length||!l||!i||null!==R,style:{padding:"6px 10px",borderRadius:"6px",backgroundColor:"#10B981",color:"#ffffff",fontSize:"13px",border:"none",cursor:"pointer",opacity:!x&&0!==h.length&&l&&i&&null===R?1:.6},title:null!==R?"Finish editing first":!i&&l?"Please select a deck first":""},{children:x?(0,a.jsx)("div",In({style:{display:"flex",alignItems:"center",justifyContent:"center"}},{children:(0,a.jsx)(_t,{type:"spinner",size:"small",inline:!0,color:"#ffffff",text:"Saving to Anki"})})):"Save to Anki"})),(0,a.jsxs)("button",In({onClick:function(){if(0!==h.length){var e=(new Date).toISOString().split("T")[0],t="anki_cards_".concat(e);me(t),pe(!0)}else we("Please select at least one card to export")},disabled:x||0===h.length||null!==R,style:{padding:"6px 10px",borderRadius:"6px",backgroundColor:"#2563EB",color:"#ffffff",fontSize:"13px",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",opacity:x||0===h.length||null!==R?.6:1}},{children:[(0,a.jsx)(st,{size:12}),(0,a.jsx)("span",{children:"Export"})]}))]}))]})),(0,a.jsx)("div",In({style:{flex:1,overflow:"auto",marginBottom:"16px"}},{children:0===Ie.length?(0,a.jsx)("div",In({style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"200px",color:"#6B7280",textAlign:"center",padding:"20px"}},{children:(0,a.jsx)("p",In({style:{fontSize:"14px"}},{children:"all"===I?"No cards yet":"not_exported"===I?"No new cards":"No exported cards"}))})):Ae.map((function(e){return(0,a.jsxs)("div",In({style:{border:"1px solid #E5E7EB",borderRadius:"6px",marginBottom:"8px",backgroundColor:h.includes(e.id)?"#F3F4F6":"#ffffff"}},{children:[(0,a.jsxs)("div",In({style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",borderBottom:R===e?"none":"1px solid #E5E7EB"}},{children:[(0,a.jsxs)("div",In({style:{display:"flex",alignItems:"center"}},{children:[(0,a.jsx)("input",{type:"checkbox",checked:h.includes(e.id),onChange:function(){return t=e.id,void(R||(h.includes(t)?y(h.filter((function(e){return e!==t}))):y(Tn(Tn([],h,!0),[t],!1))));var t},style:{marginRight:"8px"},disabled:null!==R}),(0,a.jsx)("div",In({style:{flex:1,minWidth:0}},{children:(0,a.jsxs)("div",In({style:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:"4px"}},{children:[(0,a.jsx)("span",In({style:{fontSize:"12px",color:"#6B7280"}},{children:e.mode===Q.d.LanguageLearning?"Language":"Topic"})),(0,a.jsx)("span",In({style:{fontSize:"10px",color:"#9CA3AF"}},{children:Te(e.createdAt)})),je(e.exportStatus)]}))}))]})),(0,a.jsx)("div",In({style:{display:"flex",alignItems:"center",gap:"4px"}},{children:R!==e&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",In({onClick:function(){return Pe(e)},style:{backgroundColor:"transparent",border:"1px solid #E5E7EB",borderRadius:"6px",cursor:"pointer",color:"#2563EB",display:"flex",alignItems:"center",justifyContent:"center",padding:"6px 8px",fontSize:"12px",minWidth:"70px",height:"32px",transition:"all 0.2s ease",gap:"4px"},title:"Edit card",onMouseOver:function(e){e.currentTarget.style.backgroundColor="#EFF6FF",e.currentTarget.style.borderColor="#2563EB"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.borderColor="#E5E7EB"}},{children:[(0,a.jsx)(lt,{size:12}),"Edit"]})),(0,a.jsxs)("button",In({onClick:function(){return t=e.id,n.deleteStoredCard(t),void y((function(e){return e.filter((function(e){return e!==t}))}));var t},style:{backgroundColor:"transparent",border:"1px solid #E5E7EB",borderRadius:"6px",cursor:"pointer",color:"#EF4444",display:"flex",alignItems:"center",justifyContent:"center",padding:"6px 8px",fontSize:"12px",minWidth:"70px",height:"32px",transition:"all 0.2s ease",gap:"4px"},title:"Delete card",onMouseOver:function(e){e.currentTarget.style.backgroundColor="#FEF2F2",e.currentTarget.style.borderColor="#EF4444"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.borderColor="#E5E7EB"}},{children:[(0,a.jsx)(It,{size:12}),"Delete"]}))]})}))]})),Fe(e)]}),e.id)}))})),(0,a.jsxs)("div",In({style:{display:"flex",flexDirection:"column",gap:"12px",marginTop:"16px",marginBottom:"16px",padding:"12px",backgroundColor:"#F9FAFB",borderRadius:"8px",border:"1px solid #E5E7EB"}},{children:[(0,a.jsxs)("div",In({style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},{children:[(0,a.jsx)("div",In({style:{display:"flex",alignItems:"center",gap:"8px"}},{children:(0,a.jsxs)("select",In({value:ie,onChange:Ke,style:{padding:"6px 8px",borderRadius:"6px",border:"1px solid #D1D5DB",fontSize:"13px",backgroundColor:"#FFFFFF",color:"#111827",fontWeight:"500",cursor:"pointer",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)",WebkitAppearance:"none",MozAppearance:"none",appearance:"none",backgroundImage:'url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2212%22%20height%3D%2212%22%20viewBox%3D%220%200%2012%2012%22%3E%3Cpath%20fill%3D%22%23424242%22%20d%3D%22M6%2C9L1.2%2C4.2%20c-0.4-0.4-0.4-1%2C0-1.4s1-0.4%2C1.4%2C0L6%2C6.2l3.4-3.4c0.4-0.4%2C1-0.4%2C1.4%2C0s0.4%2C1%2C0%2C1.4L6%2C9z%22%2F%3E%3C%2Fsvg%3E")',backgroundRepeat:"no-repeat",backgroundPosition:"right 8px center",paddingRight:"28px",minWidth:"90px"},"aria-label":"Cards per page"},{children:[(0,a.jsx)("option",In({value:5},{children:"5 per page"})),(0,a.jsx)("option",In({value:10},{children:"10 per page"})),(0,a.jsx)("option",In({value:20},{children:"20 per page"})),(0,a.jsx)("option",In({value:50},{children:"50 per page"}))]}))})),(0,a.jsx)("div",In({style:{display:"flex",alignItems:"center",fontSize:"13px",fontWeight:"500",color:"#4B5563"}},{children:Ie.length>0?"".concat(Math.min((re-1)*ie+1,Ie.length),"-").concat(Math.min(re*ie,Ie.length)," of ").concat(Ie.length," cards"):"0 cards"}))]})),(0,a.jsx)("div",In({style:{display:"flex",justifyContent:"center",alignItems:"center"}},{children:(0,a.jsxs)("div",In({style:{display:"flex",alignItems:"center",border:"1px solid #D1D5DB",borderRadius:"8px",overflow:"hidden",backgroundColor:"#FFFFFF",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"}},{children:[(0,a.jsx)("button",In({onClick:function(){return He(1)},disabled:1===re,style:{padding:"8px 10px",backgroundColor:"transparent",border:"none",borderRight:"1px solid #E5E7EB",cursor:1===re?"default":"pointer",color:1===re?"#9CA3AF":"#111827",display:"flex",alignItems:"center",justifyContent:"center",transition:"background-color 0.2s"},onMouseOver:function(e){1!==re&&(e.currentTarget.style.backgroundColor="#F9FAFB")},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent"},"aria-label":"Go to first page",title:"First page"},{children:(0,a.jsx)("svg",In({width:"14",height:"14",fill:"currentColor",viewBox:"0 0 20 20"},{children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M15.707 15.707a1 1 0 01-1.414 0l-5-5a1 1 0 010-1.414l5-5a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 010 1.414zm-6 0a1 1 0 01-1.414 0l-5-5a1 1 0 010-1.414l5-5a1 1 0 011.414 1.414L5.414 10l4.293 4.293a1 1 0 010 1.414z",clipRule:"evenodd"})}))})),(0,a.jsx)("button",In({onClick:function(){return He(re-1)},disabled:1===re,style:{padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRight:"1px solid #E5E7EB",cursor:1===re?"default":"pointer",color:1===re?"#9CA3AF":"#111827",display:"flex",alignItems:"center",justifyContent:"center",transition:"background-color 0.2s"},onMouseOver:function(e){1!==re&&(e.currentTarget.style.backgroundColor="#F9FAFB")},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent"},"aria-label":"Previous page",title:"Previous page"},{children:(0,a.jsx)(tt,{size:14})})),(0,a.jsxs)("div",In({style:{padding:"6px 16px",fontSize:"13px",fontWeight:"500",color:"#111827",display:"flex",alignItems:"center",backgroundColor:"transparent",borderRight:"1px solid #E5E7EB",minWidth:"60px",justifyContent:"center"}},{children:[re," / ",ce||1]})),(0,a.jsx)("button",In({onClick:function(){return He(re+1)},disabled:re===ce||0===ce,style:{padding:"8px 12px",backgroundColor:"transparent",border:"none",borderRight:"1px solid #E5E7EB",cursor:re===ce||0===ce?"default":"pointer",color:re===ce||0===ce?"#9CA3AF":"#111827",display:"flex",alignItems:"center",justifyContent:"center",transition:"background-color 0.2s"},onMouseOver:function(e){re!==ce&&0!==ce&&(e.currentTarget.style.backgroundColor="#F9FAFB")},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent"},"aria-label":"Next page",title:"Next page"},{children:(0,a.jsx)(nt,{size:14})})),(0,a.jsx)("button",In({onClick:function(){return He(ce)},disabled:re===ce||0===ce,style:{padding:"8px 10px",backgroundColor:"transparent",border:"none",cursor:re===ce||0===ce?"default":"pointer",color:re===ce||0===ce?"#9CA3AF":"#111827",display:"flex",alignItems:"center",justifyContent:"center",transition:"background-color 0.2s"},onMouseOver:function(e){re!==ce&&0!==ce&&(e.currentTarget.style.backgroundColor="#F9FAFB")},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent"},"aria-label":"Go to last page",title:"Last page"},{children:(0,a.jsx)("svg",In({width:"14",height:"14",fill:"currentColor",viewBox:"0 0 20 20"},{children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M4.293 15.707a1 1 0 001.414 0l5-5a1 1 0 000-1.414l-5-5a1 1 0 00-1.414 1.414L8.586 10l-4.293 4.293a1 1 0 000 1.414zm6 0a1 1 0 001.414 0l5-5a1 1 0 000-1.414l-5-5a1 1 0 00-1.414 1.414L14.586 10l-4.293 4.293a1 1 0 000 1.414z",clipRule:"evenodd"})}))}))]}))}))]}))]}):(0,a.jsx)("div",In({style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"300px",color:"#6B7280",textAlign:"center"}},{children:(0,a.jsx)("p",{children:"No saved cards yet."})})),fe&&(0,a.jsx)("div",In({style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(4px)"}},{children:(0,a.jsxs)("div",In({style:{backgroundColor:"#ffffff",borderRadius:"12px",padding:"24px",maxWidth:"400px",width:"90%",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",border:"1px solid #E5E7EB"}},{children:[(0,a.jsxs)("div",In({style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"20px"}},{children:[(0,a.jsxs)("h3",In({style:{margin:0,fontSize:"18px",fontWeight:"600",color:"#111827",display:"flex",alignItems:"center",gap:"8px"}},{children:[(0,a.jsx)(st,{size:16,style:{color:"#2563EB"}}),"Export Cards"]})),(0,a.jsx)("button",In({onClick:function(){return pe(!1)},disabled:ve,style:{backgroundColor:"transparent",border:"none",cursor:ve?"default":"pointer",padding:"4px",borderRadius:"4px",color:"#6B7280",opacity:ve?.5:1}},{children:(0,a.jsx)(kt,{size:16})}))]})),(0,a.jsxs)("div",In({style:{marginBottom:"20px"}},{children:[(0,a.jsxs)("p",In({style:{margin:"0 0 16px 0",fontSize:"14px",color:"#6B7280",lineHeight:"1.5"}},{children:["Export ",h.length," selected cards to a file. Choose a filename or use the default."]})),(0,a.jsx)("label",In({style:{display:"block",fontSize:"14px",fontWeight:"500",color:"#374151",marginBottom:"8px"}},{children:"Filename"})),(0,a.jsxs)("div",In({style:{position:"relative"}},{children:[(0,a.jsx)("input",{type:"text",value:he,onChange:function(e){return me(e.target.value)},placeholder:"Enter filename (without extension)",disabled:ve,style:{width:"100%",padding:"10px 12px",paddingRight:"48px",border:"1px solid #D1D5DB",borderRadius:"8px",fontSize:"14px",outline:"none",transition:"border-color 0.2s ease",backgroundColor:ve?"#F9FAFB":"#ffffff",opacity:ve?.7:1,boxSizing:"border-box"},onFocus:function(e){ve||(e.target.style.borderColor="#2563EB",e.target.style.boxShadow="0 0 0 3px rgba(37, 99, 235, 0.1)")},onBlur:function(e){e.target.style.borderColor="#D1D5DB",e.target.style.boxShadow="none"},onKeyDown:function(e){"Enter"!==e.key||ve||Ye(),"Escape"===e.key&&pe(!1)}}),(0,a.jsx)("span",In({style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",fontSize:"13px",color:"#9CA3AF",pointerEvents:"none"}},{children:".txt"}))]})),(0,a.jsx)("p",In({style:{margin:"6px 0 0 0",fontSize:"12px",color:"#6B7280"}},{children:"The .txt extension will be added automatically"}))]})),(0,a.jsxs)("div",In({style:{display:"flex",gap:"12px",justifyContent:"flex-end"}},{children:[(0,a.jsx)("button",In({onClick:function(){return pe(!1)},disabled:ve,style:{padding:"10px 16px",border:"1px solid #D1D5DB",borderRadius:"8px",backgroundColor:"#ffffff",color:"#374151",fontSize:"14px",fontWeight:"500",cursor:ve?"default":"pointer",transition:"all 0.2s ease",opacity:ve?.5:1},onMouseOver:function(e){ve||(e.currentTarget.style.backgroundColor="#F9FAFB",e.currentTarget.style.borderColor="#9CA3AF")},onMouseOut:function(e){ve||(e.currentTarget.style.backgroundColor="#ffffff",e.currentTarget.style.borderColor="#D1D5DB")}},{children:"Cancel"})),(0,a.jsx)("button",In({onClick:Ye,disabled:ve||!he.trim(),style:{padding:"10px 16px",border:"none",borderRadius:"8px",backgroundColor:!he.trim()||ve?"#9CA3AF":"#2563EB",color:"#ffffff",fontSize:"14px",fontWeight:"500",cursor:!he.trim()||ve?"default":"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"8px",minWidth:"100px",justifyContent:"center"},onMouseOver:function(e){!ve&&he.trim()&&(e.currentTarget.style.backgroundColor="#1D4ED8")},onMouseOut:function(e){!ve&&he.trim()&&(e.currentTarget.style.backgroundColor="#2563EB")}},{children:ve?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(_t,{type:"spinner",size:"small",inline:!0,color:"#ffffff"}),(0,a.jsx)("span",{children:"Exporting..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(st,{size:14}),(0,a.jsx)("span",{children:"Export"})]})}))]}))]}))})),function(){if(console.log("renderEditModal called. showEditModal:",B,"editingCard:",R),!B||!R)return console.log("Modal not showing because showEditModal:",B,"editingCard:",!!R),null;if(!G)return console.log("No local editing card data available"),null;var e=G.text,t=G.translation,n=G.examples,r=G.front,o=G.back,i=G.image,s=G.imageUrl,l=G.linguisticInfo,c=G.transcription;return console.log("Rendering edit modal with local data:",{text:(null==e?void 0:e.substring(0,20))+"...",translation:(null==t?void 0:t.substring(0,20))+"...",examplesCount:null==n?void 0:n.length,hasImage:!!i,hasImageUrl:!!s}),(0,a.jsx)("div",In({style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(2px)",padding:"16px"},onClick:Be},{children:(0,a.jsxs)("div",In({style:{backgroundColor:"#ffffff",borderRadius:"12px",maxWidth:"340px",width:"100%",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",position:"relative",padding:"16px"},onClick:function(e){return e.stopPropagation()}},{children:[(0,a.jsxs)("div",In({style:{position:"sticky",top:0,display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid #E5E7EB",paddingBottom:"12px",marginBottom:"16px",backgroundColor:"#ffffff",zIndex:2}},{children:[(0,a.jsx)("h3",In({style:{margin:0,fontSize:"16px",fontWeight:600,color:"#111827"}},{children:"Edit Card"})),(0,a.jsx)("button",In({onClick:Be,style:{background:"none",border:"none",display:"flex",alignItems:"center",justifyContent:"center",padding:"8px",borderRadius:"50%",cursor:"pointer",transition:"background-color 0.2s"},onMouseOver:function(e){return e.currentTarget.style.backgroundColor="#F3F4F6"},onMouseOut:function(e){return e.currentTarget.style.backgroundColor="transparent"},"aria-label":"Close"},{children:(0,a.jsx)(kt,{size:16,color:"#6B7280"})}))]})),(0,a.jsxs)("div",In({style:{width:"100%",marginBottom:"12px"}},{children:[(0,a.jsxs)("div",In({style:{position:"relative",width:"100%"}},{children:[(0,a.jsx)("input",{type:"text",value:M,onChange:function(e){return U(e.target.value)},onKeyDown:Me,placeholder:"Enter custom instructions for this card (e.g., 'regenerate examples', 'change image style')",style:{width:"100%",padding:"10px 12px",paddingRight:"44px",borderRadius:"8px",border:"1px solid #E5E7EB",fontSize:"14px",color:"#374151",backgroundColor:W?"#F9FAFB":"#FFFFFF",transition:"all 0.2s ease",boxShadow:W?"inset 0 1px 2px rgba(0, 0, 0, 0.05)":"none"},disabled:W}),W?(0,a.jsx)("div",In({style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",justifyContent:"center",padding:"6px",borderRadius:"50%",color:"#4F46E5"}},{children:(0,a.jsx)(_t,{type:"spinner",size:"small",inline:!0,color:"#4F46E5"})})):(0,a.jsx)("button",In({onClick:De,disabled:!M.trim()||W,style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",background:M.trim()?"linear-gradient(to right, #4F46E5, #6366F1)":"none",border:"none",color:M.trim()?"#FFFFFF":"#9CA3AF",cursor:M.trim()?"pointer":"not-allowed",display:"flex",alignItems:"center",justifyContent:"center",padding:"6px",borderRadius:"50%",width:"28px",height:"28px",boxShadow:M.trim()?"0 1px 3px rgba(0, 0, 0, 0.1)":"none",transition:"all 0.2s ease"},title:"Apply instructions"},{children:(0,a.jsx)(vt,{size:14})}))]})),(0,a.jsxs)("div",In({style:{fontSize:"12px",color:W?"#4F46E5":"#6B7280",marginTop:"6px",display:"flex",alignItems:"center",gap:"6px",fontWeight:W?"500":"normal"}},{children:[W&&(0,a.jsx)("span",{style:{display:"inline-block",width:"6px",height:"6px",borderRadius:"50%",backgroundColor:"#4F46E5",animation:"pulse 1.5s infinite"}}),W?"Applying your instructions...":"Type instructions and press Enter or click the magic wand"]}))]})),(0,a.jsx)(Nt,{mode:R.mode,front:r||null,back:o||null,translation:t||null,examples:n||[],imageUrl:s||null,image:i||null,linguisticInfo:l||void 0,transcription:c||null,onNewImage:Le,onNewExamples:ze,onAccept:Ne,onViewSavedCards:function(){},onCancel:Be,loadingNewImage:!1,loadingNewExamples:Y,loadingAccept:Z,shouldGenerateImage:!0,isSaved:!0,isEdited:!0,createdAt:R.createdAt?new Date(R.createdAt):new Date,setTranslation:We,setBack:$e,setExamples:Ve,setLinguisticInfo:Ge})]}))}))}(),(0,a.jsx)("div",In({style:{position:"absolute",top:"16px",right:"16px",zIndex:9999,pointerEvents:"none"}},{children:(0,a.jsx)("div",In({style:{pointerEvents:"auto"}},{children:Se()}))}))]}))};var Fn="SET_ANKI_AVAILABILITY",Rn=function(e){return{type:Fn,payload:e}},On="TOGGLE_SIDEBAR",Pn="SET_SIDEBAR_VISIBILITY",Bn="SET_GLOBAL_SIDEBAR_STATE",Nn="INHERIT_SIDEBAR_STATE",Ln="SHOW_NOTIFICATION",zn="HIDE_NOTIFICATION",Dn=function(e){return{type:zn,payload:{id:e}}},Mn=function(){return Mn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Mn.apply(this,arguments)};const Un=function(){var e=m((function(e){return e.notifications.notifications})),t=k();(0,r.useEffect)((function(){e.forEach((function(e){var n=e.id,r=e.type,o=0;"success"===r||"info"===r?o=5e3:"warning"===r&&(o=6e3),o>0&&setTimeout((function(){t(Dn(n))}),o)}))}),[e,t]);return 0===e.length?null:(0,a.jsx)("div",Mn({style:{position:"absolute",top:"16px",right:"16px",zIndex:9999,maxWidth:"300px",width:"auto",display:"flex",flexDirection:"column",gap:"8px"}},{children:e.map((function(e){var n=function(e){switch(e){case"success":return{icon:(0,a.jsx)(Xe,{size:16}),color:"#059669",bgColor:"#ECFDF5",borderColor:"#10B981"};case"warning":return{icon:(0,a.jsx)(ut,{size:16}),color:"#D97706",bgColor:"#FFFBEB",borderColor:"#F59E0B"};case"info":return{icon:(0,a.jsx)(gt,{size:16}),color:"#2563EB",bgColor:"#EFF6FF",borderColor:"#3B82F6"};default:return{icon:(0,a.jsx)(Et,{size:16}),color:"#DC2626",bgColor:"#FEF2F2",borderColor:"#EF4444"}}}(e.type),r=n.icon,o=n.color,i=n.bgColor,s=n.borderColor;return(0,a.jsxs)("div",Mn({style:{transform:"translateX(0)",opacity:1,transition:"all 0.3s ease-out",backgroundColor:i,border:"1px solid ".concat(s),borderRadius:"12px",padding:"16px",minWidth:"280px",maxWidth:"320px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",position:"relative",display:"flex",alignItems:"flex-start",gap:"12px"},role:"alert","aria-live":"polite"},{children:[(0,a.jsx)("div",Mn({style:{color:o,marginTop:"2px",flexShrink:0}},{children:r})),(0,a.jsx)("div",Mn({style:{flex:1,paddingRight:"8px"}},{children:(0,a.jsx)("p",Mn({style:{color:"#374151",margin:0,fontSize:"14px",lineHeight:"1.5",fontWeight:500}},{children:e.message}))})),(0,a.jsx)("button",Mn({onClick:function(){return n=e.id,void t(Dn(n));var n},style:{position:"absolute",top:"8px",right:"8px",background:"transparent",border:"none",color:"#9CA3AF",cursor:"pointer",padding:"4px",borderRadius:"4px",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center"},onMouseOver:function(e){e.currentTarget.style.backgroundColor="rgba(0, 0, 0, 0.1)",e.currentTarget.style.color="#374151"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="#9CA3AF"},"aria-label":"Close notification"},{children:(0,a.jsx)(kt,{size:12})}))]}),e.id)}))}))};var qn=function(){return qn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},qn.apply(this,arguments)},Wn=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},Vn=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},$n=function(e){var t=e.tabId,n=Ue(),o=n.currentPage,i=n.setCurrentPage,s=(m((function(e){return e.anki.isAnkiAvailable})),(0,r.useState)(!0)),l=s[0],c=s[1],u=k(),d=m((function(e){return e.settings.ankiConnectApiKey})),f=n.storedCards,p=n.isGeneratingCard;(0,r.useEffect)((function(){l&&Wn(void 0,void 0,void 0,(function(){var e,n,r;return Vn(this,(function(o){switch(o.label){case 0:o.trys.push([0,5,6,7]),u(ke()),console.log("Initial card load from App component for tab:",t),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,ne(d)];case 2:return(e=o.sent()).error?(console.error("Anki returned an error:",e.error),u(Rn(!1))):(u(function(e){return{type:Cn,payload:e}}(e.result)),u(Rn(!0)),console.log("Anki is available")),[3,4];case 3:return n=o.sent(),console.error("Anki is unavailable:",n),u(Rn(!1)),[3,4];case 4:return[3,7];case 5:return r=o.sent(),console.error("Error initializing app:",r),[3,7];case 6:return c(!1),[7];case 7:return[2]}}))}))}),[u,d,l,t]),(0,r.useEffect)((function(){console.log("App: Stored cards count for tab ".concat(t,":"),f.length)}),[f,t]);var g,h=(0,r.useCallback)((function(e){i(e)}),[i]),y=(0,r.useCallback)((function(){u(function(e,t){return void 0===t&&(t=!0),{type:On,payload:{tabId:e,persist:t}}}(t)),chrome.runtime.sendMessage({action:"toggleSidebar",tabId:t},(function(e){chrome.runtime.lastError?console.error("Error sending message:",chrome.runtime.lastError.message):console.log("Extension closed:",e)}))}),[u,t]);return(0,a.jsx)("div",qn({className:"App",style:{backgroundColor:"#ffffff",height:"100vh",display:"flex",flexDirection:"column",position:"absolute",right:0,top:0,width:"350px",fontFamily:"Inter, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, sans-serif",boxShadow:"0 0 0 1px rgba(0, 0, 0, 0.05), 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"}},{children:(0,a.jsxs)("div",qn({style:{flex:1,width:"100%",height:"100%",position:"relative",display:"flex",flexDirection:"column"}},{children:[(g=f.filter((function(e){return"not_exported"===e.exportStatus})).length,(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",qn({onClick:y,className:"close-button",style:{position:"absolute",top:"6px",right:"12px",backgroundColor:"transparent",border:"none",cursor:"pointer",padding:"6px",color:"#6B7280",borderRadius:"5px",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",width:"28px",height:"28px",zIndex:200},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.color="#EF4444"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.color="#6B7280"},title:"Close extension"},{children:(0,a.jsx)(kt,{size:14})})),"createCard"!==o&&(0,a.jsx)("div",qn({style:{position:"absolute",top:"6px",left:"12px",right:"50px",zIndex:100}},{children:(0,a.jsxs)("button",qn({onClick:function(){return h("createCard")},className:"new-card-button",style:{backgroundColor:"#2563EB",border:"none",cursor:"pointer",padding:"6px 14px",color:"#FFFFFF",borderRadius:"7px",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"32px",boxShadow:"0 1px 3px rgba(37, 99, 235, 0.2)",fontSize:"13px",fontWeight:600},onMouseOver:function(e){e.currentTarget.style.backgroundColor="#1D4ED8",e.currentTarget.style.transform="translateY(-0.5px)",e.currentTarget.style.boxShadow="0 2px 6px rgba(37, 99, 235, 0.25)"},onMouseOut:function(e){e.currentTarget.style.backgroundColor="#2563EB",e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="0 1px 3px rgba(37, 99, 235, 0.2)"},title:"Create a new card"},{children:[(0,a.jsx)(bt,{style:{marginRight:"5px"},size:13}),"New Card"]}))})),(0,a.jsxs)("div",qn({style:{position:"absolute",bottom:"8px",left:"12px",right:"12px",display:"flex",gap:"6px",zIndex:100}},{children:[(0,a.jsxs)("button",qn({onClick:function(){return h("storedCards")},disabled:p,className:"nav-button",style:{backgroundColor:"storedCards"===o?"#EFF6FF":"#F9FAFB",border:"1px solid ".concat("storedCards"===o?"#BFDBFE":"#E5E7EB"),cursor:p?"not-allowed":"pointer",padding:"10px 14px",color:p?"#9CA3AF":"storedCards"===o?"#2563EB":"#6B7280",borderRadius:"10px",transition:"all 0.2s ease",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flex:1,gap:"3px",fontSize:"11px",fontWeight:"storedCards"===o?600:500,boxShadow:"storedCards"===o?"0 2px 4px rgba(37, 99, 235, 0.1)":"0 1px 2px rgba(0, 0, 0, 0.05)",position:"relative",opacity:p?.6:1},onMouseOver:function(e){"storedCards"===o||p||(e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.borderColor="#D1D5DB",e.currentTarget.style.color="#374151")},onMouseOut:function(e){"storedCards"===o||p||(e.currentTarget.style.backgroundColor="#F9FAFB",e.currentTarget.style.borderColor="#E5E7EB",e.currentTarget.style.color="#6B7280")},title:p?"Please wait while card is being generated":"View your saved cards"},{children:[(0,a.jsxs)("div",qn({style:{position:"relative",display:"flex",alignItems:"center"}},{children:[(0,a.jsx)(yt,{size:16}),g>0&&(0,a.jsx)("span",qn({style:{position:"absolute",top:"-6px",right:"-8px",backgroundColor:"#EF4444",color:"white",borderRadius:"10px",fontSize:"10px",fontWeight:"bold",padding:"2px 6px",minWidth:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.1)"}},{children:g>99?"99+":g}))]})),(0,a.jsx)("span",{children:"Cards"})]})),(0,a.jsxs)("button",qn({onClick:function(){return h("settings")},disabled:p,className:"nav-button",style:{backgroundColor:"settings"===o?"#EFF6FF":"#F9FAFB",border:"1px solid ".concat("settings"===o?"#BFDBFE":"#E5E7EB"),cursor:p?"not-allowed":"pointer",padding:"10px 14px",color:p?"#9CA3AF":"settings"===o?"#2563EB":"#6B7280",borderRadius:"10px",transition:"all 0.2s ease",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flex:1,gap:"3px",fontSize:"11px",fontWeight:"settings"===o?600:500,boxShadow:"settings"===o?"0 2px 4px rgba(37, 99, 235, 0.1)":"0 1px 2px rgba(0, 0, 0, 0.05)",opacity:p?.6:1},onMouseOver:function(e){"settings"===o||p||(e.currentTarget.style.backgroundColor="#F3F4F6",e.currentTarget.style.borderColor="#D1D5DB",e.currentTarget.style.color="#374151")},onMouseOut:function(e){"settings"===o||p||(e.currentTarget.style.backgroundColor="#F9FAFB",e.currentTarget.style.borderColor="#E5E7EB",e.currentTarget.style.color="#6B7280")},title:p?"Please wait while card is being generated":"App settings and API configuration"},{children:[(0,a.jsx)(it,{size:16}),(0,a.jsx)("span",{children:"Settings"})]}))]}))]})),(0,a.jsxs)("header",qn({className:"App-header",style:{width:"100%",flex:1,display:"flex",flexDirection:"column",backgroundColor:"#ffffff",marginTop:"0px",height:"100%",overflow:"auto"}},{children:[function(){var e="createCard"!==o?"46px":"12px",t="58px",n={width:"100%",height:"100%",paddingTop:e,paddingBottom:t,overflow:"auto",opacity:1,transform:"translateX(0)",transition:"all 0.3s ease-in-out"};switch(o){case"settings":return(0,a.jsx)("div",qn({style:n},{children:(0,a.jsx)(Sn,{onBackClick:function(){return h("createCard")},popup:!1})}));case"storedCards":return(0,a.jsx)("div",qn({style:n},{children:(0,a.jsx)(jn,{onBackClick:function(){return h("createCard")}})}));default:return(0,a.jsx)("div",qn({style:{width:"100%",flex:1,display:"flex",flexDirection:"column",overflow:"auto",height:"100%",position:"relative",paddingTop:e,paddingBottom:t,opacity:1,transform:"translateX(0)",transition:"all 0.3s ease-in-out"}},{children:(0,a.jsx)(mn,{})}))}}(),(0,a.jsx)("div",qn({style:{position:"absolute",top:"16px",right:"16px",zIndex:9999,maxWidth:"300px",width:"auto",pointerEvents:"none"}},{children:(0,a.jsxs)("div",qn({style:{pointerEvents:"auto"}},{children:[" ",(0,a.jsx)(Un,{})]}))}))]}))]}))}))};const Gn=function(e){var t=e.tabId,n=k();return(0,r.useEffect)((function(){n(function(e){return{type:_,payload:e}}(t)),console.log("App initialized for tab:",t)}),[n,t]),(0,a.jsx)(Me,qn({tabId:t},{children:(0,a.jsx)($n,{tabId:t})}))};
/**
 * @license
 * ReduxedChromeStorage v3.0.10
 * https://github.com/hindmost/reduxed-chrome-storage
 * Copyright (c) Savr Goryaev aka hindmost
 *
 * This source code is licensed under the MIT license
 * https://github.com/hindmost/reduxed-chrome-storage/blob/master/LICENSE
 *
 * Dependencies:
 *
 * uuid v8.3.2
 */
var Hn,Kn=new Uint8Array(16);function Qn(){if(!Hn&&!(Hn="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Hn(Kn)}var Yn=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var Jn=[],Xn=0;Xn<256;++Xn)Jn.push((Xn+256).toString(16).substr(1));function Zn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(Jn[e[t+0]]+Jn[e[t+1]]+Jn[e[t+2]]+Jn[e[t+3]]+"-"+Jn[e[t+4]]+Jn[e[t+5]]+"-"+Jn[e[t+6]]+Jn[e[t+7]]+"-"+Jn[e[t+8]]+Jn[e[t+9]]+"-"+Jn[e[t+10]]+Jn[e[t+11]]+Jn[e[t+12]]+Jn[e[t+13]]+Jn[e[t+14]]+Jn[e[t+15]]).toLowerCase();if(!function(e){return"string"==typeof e&&Yn.test(e)}(n))throw TypeError("Stringified UUID is invalid");return n}function er(e,t,n){var r=(e=e||{}).random||(e.rng||Qn)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var o=0;o<16;++o)t[n+o]=r[o];return t}return Zn(r)}function tr(e){return null==e||"object"!=typeof e?e:JSON.parse(JSON.stringify(e))}function nr(e,t){if(e===t)return!0;if(null==e||"object"!=typeof e||null==t||"object"!=typeof t||Array.isArray(e)!==Array.isArray(t))return!1;const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(const o of n)if(r.indexOf(o)<=-1||!nr(e[o],t[o]))return!1;return!0}function rr(e,t){if(e===t)return;if(null==e||"object"!=typeof e||null==t||"object"!=typeof t)return e;if(Array.isArray(e)||Array.isArray(t))return nr(e,t)?void 0:e;const n=Object.keys(e),r=Object.keys(t);let o=!0;const a=n.reduce(((n,a)=>{const i=r.indexOf(a)>-1?rr(e[a],t[a]):e[a];return void 0===i||(o=!1,n[a]=i),n}),{});return r.forEach((e=>{n.indexOf(e)>-1||(o=!1,a[e]=void 0)})),o?void 0:a}function or(e,t,n){if(Array.isArray(t))return tr(t);if(null==e||"object"!=typeof e||Array.isArray(e)||null==t||"object"!=typeof t)return tr(void 0!==t?t:e);const r=Object.keys(e).concat(Object.keys(t).filter((t=>!(t in e)))).reduce(((r,o)=>(r[o]=or(e[o],t[o],n),r)),{});if(!n)return r;const o=Object.keys(t);return Object.keys(e).forEach((e=>{o.indexOf(e)>-1||delete r[e]})),r}const ar=e=>{if(void 0===e||!Array.isArray(e)||3!==e.length)return[e,"",0];const[t,n,r]=e;return"string"==typeof t&&"number"==typeof n?[r,t,n]:[e,"",0]};class ir{constructor(e,t,n,r,o,a,i){this.container=e,this.storage=t,this.isolated=n,this.plain=r,this.timeout=o?Math.max(o,500):1e3,this.resetState=i,this.store=this._instantiateStore(),this.state=null,this.id=er(),this.tmstamp=0,this.outdted=[],"function"==typeof a&&(this.lisner=a),this.lisners=[],this.getState=this.getState.bind(this),this.subscribe=this.subscribe.bind(this),this.dispatch=this.dispatch.bind(this),this.replaceReducer=this.replaceReducer.bind(this),this[Symbol.observable]=this[Symbol.observable].bind(this)}init(){this.tmstamp||this.isolated||this.storage.subscribe(((e,t)=>{const[n,r,o]=ar(e);if(r===this.id||nr(n,this.state))return;const a=o>=this.tmstamp,i=a?or(this.state,n,!0):or(n,this.state,!0);!a&&nr(i,this.state)||(this._setState(i,o),this._renewStore(),nr(i,n)||this._send2Storage(),this._callListeners())}));const e=this.store.getState();return new Promise((t=>{this.storage.load((n=>{const[r,,o]=ar(n);let a=r?or(e,r):e;this.resetState&&(a=or(a,this.resetState)),this._setState(a,o),this._renewStore(),nr(a,r)||this._send2Storage(),t(this)}))}))}initFrom(e){return this._setState(e,0),this._renewStore(),this}_setState(e,t){this.state=tr(e),(t=void 0!==t?t:Date.now())>this.tmstamp&&(this.tmstamp=t)}_renewStore(){this.plain?this.unsub&&this.unsub():this._clean();const e=this.store=this._instantiateStore(this.state),t=Date.now(),n=this.outdted.length;this.outdted=this.outdted.map((([e,r],o)=>e||o>=n-1?[e,r]:[t,r]));let r=tr(this.state);const o=this.store.subscribe((()=>{const t=e&&e.getState(),n=this.store===e;if(this._clean(),!nr(t,this.state)){if(n)this._setState(t);else{const e=rr(t,r);if(void 0===e)return;this._setState(or(this.state,e)),this._renewStore()}this._send2Storage(),this._callListeners(!0,r),r=tr(t)}}));this.plain?this.unsub=o:this.outdted.push([0,o])}_clean(){if(this.plain)return;const e=Date.now(),t=this.outdted.length;this.outdted.forEach((([n,r],o)=>{o>=t-1||e-n<this.timeout||(r(),delete this.outdted[o])}))}_instantiateStore(e){const t=this.container(e);if("object"!=typeof t||"function"!=typeof t.getState)throw new Error("Invalid 'storeCreatorContainer' supplied");return t}_send2Storage(){var e,t,n;this.storage.save((e=this.state,t=this.id,n=this.tmstamp,[t,n,e]))}_callListeners(e,t){e&&this.lisner&&this.lisner(this,t);for(const e of this.lisners)e()}getState(){return this.state}subscribe(e){return"function"==typeof e&&this.lisners.push(e),()=>{"function"==typeof e&&(this.lisners=this.lisners.filter((t=>t!==e)))}}dispatch(e){return this.store.dispatch(e)}replaceReducer(e){return"function"==typeof e&&this.store.replaceReducer(e),this}[Symbol.observable](){const e=this.getState,t=this.subscribe;return{subscribe(n){if("object"!=typeof n||null===n)throw new TypeError("Expected the observer to be an object.");function r(){const t=n;t.next&&t.next(e())}r();return{unsubscribe:t(r)}},[Symbol.observable](){return this}}}}var sr;!function(e){e.local="local",e.sync="sync"}(sr||(sr={}));const lr=e=>(new TextEncoder).encode(Object.entries(e).map((([e,t])=>e+JSON.stringify(t))).join("")).length;class cr{constructor({namespace:e,area:t,key:n}){this.ns=e,this.areaName=t===sr.sync?sr.sync:sr.local,this.key=n||"reduxed",this.listeners=[],this.errListeners=[]}regShared(){this.regListener(((e,t)=>{for(const n of this.listeners)n(e,t)}))}regListener(e){this.ns.storage.onChanged.addListener(((t,n)=>{if(n!==this.areaName||!(this.key in t))return;const{newValue:r,oldValue:o}=t[this.key];r&&e(r,o)}))}subscribe(e){"function"==typeof e&&this.listeners.push(e)}subscribeForError(e){"function"==typeof e&&this.errListeners.push(e)}fireErrorListeners(e,t){for(const n of this.errListeners)n(e,t)}callbackOnLoad(e,t,n){t(!this.ns.runtime.lastError&&(n?e:e&&e[this.key]))}callbackOnSave(e,t){if(!this.ns.runtime.lastError)return;const{message:n}=this.ns.runtime.lastError;if(!n||!e||!t)return void this.fireErrorListeners(n||"",!1);this.areaName===sr.sync&&t.QUOTA_BYTES_PER_ITEM&&lr({[this.key]:e})>t.QUOTA_BYTES_PER_ITEM?this.fireErrorListeners(n,!0):this.load((r=>{const o="object"==typeof r&&t.QUOTA_BYTES>0&&lr(Object.assign(Object.assign({},r),{[this.key]:e}))>t.QUOTA_BYTES;this.fireErrorListeners(n,o)}),!0)}}class ur extends cr{constructor({namespace:e,area:t,key:n}){super({namespace:e,area:t,key:n}),this.areaApi=this.ns.storage[this.areaName]}load(e,t){"function"==typeof e&&this.areaApi.get(t?null:this.key,(n=>{this.callbackOnLoad(n,e,t)}))}save(e){this.areaApi.set({[this.key]:e},(()=>{this.callbackOnSave(e,this.areaApi)}))}}class dr extends cr{constructor({namespace:e,area:t,key:n}){super({namespace:e,area:t,key:n}),this.areaApi=this.ns.storage[this.areaName]}load(e,t){"function"==typeof e&&this.areaApi.get(t?null:this.key).then((t=>{this.callbackOnLoad(t,e)}))}save(e){this.areaApi.set({[this.key]:e}).then((()=>{this.callbackOnSave(e,this.areaApi)}))}}var fr;function pr(e){return pr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pr(e)}function gr(e){var t=function(e,t){if("object"!==pr(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==pr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===pr(t)?t:String(t)}function hr(e,t,n){return(t=gr(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function mr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function yr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?mr(Object(n),!0).forEach((function(t){hr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function vr(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}!function(e){e.chrome="chrome",e.browser="browser"}(fr||(fr={}));var xr="function"==typeof Symbol&&Symbol.observable||"@@observable",br=function(){return Math.random().toString(36).substring(7).split("").join(".")},wr={INIT:"@@redux/INIT"+br(),REPLACE:"@@redux/REPLACE"+br(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+br()}};function Sr(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function Cr(e,t,n){var r;if("function"==typeof t&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw new Error(vr(0));if("function"==typeof t&&void 0===n&&(n=t,t=void 0),void 0!==n){if("function"!=typeof n)throw new Error(vr(1));return n(Cr)(e,t)}if("function"!=typeof e)throw new Error(vr(2));var o=e,a=t,i=[],s=i,l=!1;function c(){s===i&&(s=i.slice())}function u(){if(l)throw new Error(vr(3));return a}function d(e){if("function"!=typeof e)throw new Error(vr(4));if(l)throw new Error(vr(5));var t=!0;return c(),s.push(e),function(){if(t){if(l)throw new Error(vr(6));t=!1,c();var n=s.indexOf(e);s.splice(n,1),i=null}}}function f(e){if(!Sr(e))throw new Error(vr(7));if(void 0===e.type)throw new Error(vr(8));if(l)throw new Error(vr(9));try{l=!0,a=o(a,e)}finally{l=!1}for(var t=i=s,n=0;n<t.length;n++){(0,t[n])()}return e}return f({type:wr.INIT}),(r={dispatch:f,subscribe:d,getState:u,replaceReducer:function(e){if("function"!=typeof e)throw new Error(vr(10));o=e,f({type:wr.REPLACE})}})[xr]=function(){var e,t=d;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new Error(vr(11));function n(){e.next&&e.next(u())}return n(),{unsubscribe:t(n)}}})[xr]=function(){return this},e},r}function Er(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}function kr(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return function(){var n=e.apply(void 0,arguments),r=function(){throw new Error(vr(15))},o={getState:n.getState,dispatch:function(){return r.apply(void 0,arguments)}},a=t.map((function(e){return e(o)}));return r=Er.apply(void 0,a)(n.dispatch),yr(yr({},n),{},{dispatch:r})}}}function Ir(e){return function(t){var n=t.dispatch,r=t.getState;return function(t){return function(o){return"function"==typeof o?o(n,r,e):t(o)}}}}var Ar=Ir();Ar.withExtraArgument=Ir;const _r=Ar;var Tr=function(){return Tr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Tr.apply(this,arguments)},jr={decks:[],deckId:""};var Fr=function(){return Fr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Fr.apply(this,arguments)},Rr=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},Or=Fr({savedCards:[],storedCards:[],text:"",translation:"",examples:[],image:null,imageUrl:null,error:void 0,back:null,front:"",currentCardId:null,linguisticInfo:"",transcription:"",isGeneratingCard:!1});const Pr=function(e,t){var n,r,o,a,i,s,l,c,u,d;void 0===e&&(e=Or);var f=Fr({},e);switch(t.type){case ae:f.savedCards=Rr(Rr([],e.savedCards,!0),t.payload,!0);break;case pe:console.log("*** REDUCER: SAVE_CARD_TO_STORAGE action received ***"),console.log("Action payload raw:",t.payload),console.log("Action payload image data:",{hasImage:!!t.payload.image,hasImageUrl:!!t.payload.imageUrl,imageType:typeof t.payload.image,imageUrlType:typeof t.payload.imageUrl,imageValue:t.payload.image,imageUrlValue:t.payload.imageUrl,imageUndefinedCheck:void 0!==t.payload.image,imageUrlUndefinedCheck:void 0!==t.payload.imageUrl});var p=Fr(Fr({},t.payload.id?t.payload:Fr(Fr({},t.payload),{id:Date.now().toString()})),{image:void 0!==t.payload.image?t.payload.image:null,imageUrl:void 0!==t.payload.imageUrl?t.payload.imageUrl:null,exportStatus:t.payload.exportStatus||"not_exported",linguisticInfo:t.payload.linguisticInfo||"",transcription:t.payload.transcription||""});console.log("REDUCER: Final card object created:",{cardId:p.id,hasImage:!!p.image,hasImageUrl:!!p.imageUrl,imageType:typeof p.image,imageUrlType:typeof p.imageUrl,imageLength:null===(n=p.image)||void 0===n?void 0:n.length,imageUrlLength:null===(r=p.imageUrl)||void 0===r?void 0:r.length,imageActualValue:p.image,imageUrlActualValue:p.imageUrl,imagePreview:null===(o=p.image)||void 0===o?void 0:o.substring(0,50),imageUrlPreview:null===(a=p.imageUrl)||void 0===a?void 0:a.substring(0,50)});var g=e.storedCards.find((function(e){return e.id===p.id}));g?(f.storedCards=e.storedCards.map((function(e){return e.id===g.id?Fr(Fr({},p),{id:g.id}):e})),console.log("Updated existing card with ID:",p.id,"text:",p.text)):(f.storedCards=Rr(Rr([],e.storedCards,!0),[p],!1),console.log("Added new card with ID:",p.id,"text:",p.text),console.log("Total stored cards after addition:",f.storedCards.length));break;case ye:f.storedCards=e.storedCards.map((function(e){return e.id===t.payload.cardId?Fr(Fr({},e),{exportStatus:t.payload.status}):e}));break;case ve:if(console.log("*** REDUCER: UPDATE_STORED_CARD action received ***"),console.log("Update payload image info:",{cardId:t.payload.id,hasImage:!!t.payload.image,hasImageUrl:!!t.payload.imageUrl,imageType:typeof t.payload.image,imageUrlType:typeof t.payload.imageUrl,imageValue:t.payload.image,imageUrlValue:t.payload.imageUrl,imageLength:null===(i=t.payload.image)||void 0===i?void 0:i.length,imageUrlLength:null===(s=t.payload.imageUrl)||void 0===s?void 0:s.length}),!t.payload.id)return console.error("Cannot update card without ID"),e;if(e.storedCards.some((function(e){return e.id===t.payload.id})))f.storedCards=e.storedCards.map((function(e){return e.id===t.payload.id?Fr(Fr({},t.payload),{exportStatus:t.payload.exportStatus||e.exportStatus,linguisticInfo:t.payload.linguisticInfo||e.linguisticInfo,transcription:t.payload.transcription||e.transcription}):e})),console.log("UPDATE_STORED_CARD: Updated existing card with ID:",t.payload.id,"image:",!!t.payload.image);else{var h=Fr(Fr({},t.payload),{exportStatus:t.payload.exportStatus||"not_exported",linguisticInfo:t.payload.linguisticInfo||"",transcription:t.payload.transcription||""});f.storedCards=Rr(Rr([],e.storedCards,!0),[h],!1),console.log("UPDATE_STORED_CARD: Added new card with ID:",t.payload.id,"image:",!!h.image)}break;case ge:break;case me:f.storedCards=t.payload;break;case he:f.storedCards=e.storedCards.filter((function(e){return e.id!==t.payload}));break;case ie:f.text=t.payload,""!==t.payload&&""!==t.payload.trim()||(console.log("Text cleared completely, also clearing images"),f.image=null,f.imageUrl=null);break;case se:f.translation=t.payload;break;case le:f.examples=t.payload;break;case ce:console.log("*** REDUCER: SET_IMAGE called with:",{hasPayload:!!t.payload,payloadType:typeof t.payload,payloadLength:null===(l=t.payload)||void 0===l?void 0:l.length,payloadPreview:null===(c=t.payload)||void 0===c?void 0:c.substring(0,50)}),f.image=t.payload;break;case ue:return console.log("*** REDUCER: SET_IMAGE_URL called with:",{hasPayload:!!t.payload,payloadType:typeof t.payload,payloadLength:null===(u=t.payload)||void 0===u?void 0:u.length,payloadPreview:null===(d=t.payload)||void 0===d?void 0:d.substring(0,50)}),Fr(Fr({},e),{imageUrl:t.payload});case de:return Fr(Fr({},e),{back:t.payload});case fe:return Fr(Fr({},e),{front:t.payload});case xe:return Fr(Fr({},e),{currentCardId:t.payload});case be:return Fr(Fr({},e),{linguisticInfo:t.payload});case we:return Fr(Fr({},e),{transcription:t.payload});case Se:return Fr(Fr({},e),{isGeneratingCard:t.payload});default:return e}return f};const Br=function(e,t){return void 0===e&&(e="createCard"),"SET_CURRENT_PAGE"===t.type?t.currentPage:e};var Nr=function(){return Nr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Nr.apply(this,arguments)},Lr={isAnkiAvailable:!1};const zr=function(e,t){return void 0===e&&(e=Lr),t.type===Fn?Nr(Nr({},e),{isAnkiAvailable:t.payload}):e};var Dr=function(){return Dr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Dr.apply(this,arguments)},Mr={globalState:{isVisible:!1,lastToggleTime:Date.now()},tabStates:{},inheritanceSettings:{enabled:!0,mode:"lastActive"}},Ur=function(e,t){return e.tabStates[t]||{isVisible:e.globalState.isVisible,lastToggleTime:Date.now()}};const qr=function(e,t){var n,r,o;switch(void 0===e&&(e=Mr),t.type){case On:var a=t.payload||{},i=a.tabId,s=a.persist,l=void 0===s||s,c=Date.now();if(i){var u=!(h=Ur(e,i)).isVisible,d=Dr(Dr({},e),{tabStates:Dr(Dr({},e.tabStates),(n={},n[i]=Dr(Dr({},h),{isVisible:u,lastToggleTime:c}),n))});return l&&(d.globalState=Dr(Dr({},e.globalState),{isVisible:u,lastActiveTabId:i,lastToggleTime:c})),d}return Dr(Dr({},e),{globalState:Dr(Dr({},e.globalState),{isVisible:!e.globalState.isVisible,lastToggleTime:c})});case Pn:var f=t.payload,p=f.isVisible,g=(i=f.tabId,f.persist);l=void 0===g||g,c=Date.now();if(i){var h=Ur(e,i);d=Dr(Dr({},e),{tabStates:Dr(Dr({},e.tabStates),(r={},r[i]=Dr(Dr({},h),{isVisible:p,lastToggleTime:c}),r))});return l&&(d.globalState=Dr(Dr({},e.globalState),{isVisible:p,lastActiveTabId:i,lastToggleTime:c})),d}return Dr(Dr({},e),{globalState:Dr(Dr({},e.globalState),{isVisible:p,lastToggleTime:c})});case Bn:var m=t.payload,y=(p=m.isVisible,m.lastActiveTabId);return Dr(Dr({},e),{globalState:Dr(Dr({},e.globalState),{isVisible:p,lastActiveTabId:y||e.globalState.lastActiveTabId,lastToggleTime:Date.now()})});case Nn:var v=t.payload,x=v.fromTabId,b=v.toTabId,w=void 0,S=void 0;return x&&e.tabStates[x]?(w=e.tabStates[x].isVisible,S=x):(w=function(e){return e.globalState.lastActiveTabId&&e.tabStates[e.globalState.lastActiveTabId]?e.tabStates[e.globalState.lastActiveTabId].isVisible:e.globalState.isVisible}(e),S=e.globalState.lastActiveTabId),Dr(Dr({},e),{tabStates:Dr(Dr({},e.tabStates),(o={},o[b]={isVisible:w,inheritedFrom:S,lastToggleTime:Date.now()},o))});default:return e}};var Wr=function(){return Wr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Wr.apply(this,arguments)},Vr=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},$r={notifications:[]};const Gr=function(e,t){switch(void 0===e&&(e=$r),t.type){case Ln:return e.notifications.find((function(e){return e.message===t.payload.message&&e.type===t.payload.type}))?e:Wr(Wr({},e),{notifications:Vr(Vr([],e.notifications,!0),[t.payload],!1)});case zn:return Wr(Wr({},e),{notifications:e.notifications.filter((function(e){return e.id!==t.payload.id}))});default:return e}};var Hr=function(){return Hr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Hr.apply(this,arguments)},Kr=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},Qr={currentTabId:null,tabStates:{}};const Yr=function(e,t){var n,r,o,a,i,s,l,c,u,d;void 0===e&&(e=Qr);var f=Hr({},e);switch(t.type){case _:var p=t.payload;f.currentTabId=p,p&&!f.tabStates[p]&&(f.tabStates=Hr(Hr({},f.tabStates),((n={})[p]=function(e){return{cardData:{text:"",translation:"",examples:[],image:null,imageUrl:null,front:"",back:null,linguisticInfo:"",transcription:"",isGeneratingCard:!1,currentCardId:null},storedCards:[],fieldIdPrefix:"tab_".concat(e,"_").concat(Date.now(),"_"),currentPage:"createCard"}}(p),n)));break;case T:var g=t.payload,h=g.tabId,m=g.field,y=g.value;h&&f.tabStates[h]&&(f.tabStates=Hr(Hr({},f.tabStates),((r={})[h]=Hr(Hr({},f.tabStates[h]),{cardData:Hr(Hr({},f.tabStates[h].cardData),(o={},o[m]=y,o))}),r)));break;case j:var v=t.payload.tabId;v&&f.tabStates[v]&&(f.tabStates=Hr(Hr({},f.tabStates),((a={})[v]=Hr(Hr({},f.tabStates[v]),{cardData:{text:"",translation:"",examples:[],image:null,imageUrl:null,front:"",back:null,linguisticInfo:"",transcription:"",isGeneratingCard:!1,currentCardId:null}}),a)));break;case F:var x=t.payload,b=x.tabId,w=x.card;if(b&&f.tabStates[b]){var S=f.tabStates[b],C=Hr(Hr({},w),{id:w.id||"".concat(S.fieldIdPrefix).concat(Date.now()),createdAt:w.createdAt||new Date}),E=S.storedCards.findIndex((function(e){return e.text===C.text})),k=void 0;E>=0?(k=Kr([],S.storedCards,!0))[E]=Hr(Hr({},C),{id:S.storedCards[E].id}):k=Kr(Kr([],S.storedCards,!0),[C],!1),f.tabStates=Hr(Hr({},f.tabStates),((i={})[b]=Hr(Hr({},S),{storedCards:k}),i))}break;case R:var I=t.payload,A=I.tabId,L=I.cardId;if(A&&f.tabStates[A]){S=f.tabStates[A];f.tabStates=Hr(Hr({},f.tabStates),((s={})[A]=Hr(Hr({},S),{storedCards:S.storedCards.filter((function(e){return e.id!==L}))}),s))}break;case O:var z=t.payload,D=z.tabId,M=z.cards;D&&f.tabStates[D]&&(f.tabStates=Hr(Hr({},f.tabStates),((l={})[D]=Hr(Hr({},f.tabStates[D]),{storedCards:M}),l)));break;case P:var U=t.payload,q=U.tabId,W=U.cardId,V=U.status;if(q&&f.tabStates[q]){S=f.tabStates[q];f.tabStates=Hr(Hr({},f.tabStates),((c={})[q]=Hr(Hr({},S),{storedCards:S.storedCards.map((function(e){return e.id===W?Hr(Hr({},e),{exportStatus:V}):e}))}),c))}break;case B:var $=t.payload,G=$.tabId,H=$.card;if(G&&f.tabStates[G]&&H.id){var K=(S=f.tabStates[G]).storedCards.some((function(e){return e.id===H.id}));k=void 0;k=K?S.storedCards.map((function(e){return e.id===H.id?Hr({},H):e})):Kr(Kr([],S.storedCards,!0),[H],!1),f.tabStates=Hr(Hr({},f.tabStates),((u={})[G]=Hr(Hr({},S),{storedCards:k}),u))}break;case N:var Q=t.payload,Y=Q.tabId,J=Q.currentPage;Y&&f.tabStates[Y]&&(f.tabStates=Hr(Hr({},f.tabStates),((d={})[Y]=Hr(Hr({},f.tabStates[Y]),{currentPage:J}),d)))}return f};var Jr,Xr=function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++){var o=t[r];0,"function"==typeof e[o]&&(n[o]=e[o])}var a,i=Object.keys(n);try{!function(e){Object.keys(e).forEach((function(t){var n=e[t];if(void 0===n(void 0,{type:wr.INIT}))throw new Error(vr(12));if(void 0===n(void 0,{type:wr.PROBE_UNKNOWN_ACTION()}))throw new Error(vr(13))}))}(n)}catch(e){a=e}return function(e,t){if(void 0===e&&(e={}),a)throw a;for(var r=!1,o={},s=0;s<i.length;s++){var l=i[s],c=n[l],u=e[l],d=c(u,t);if(void 0===d){t&&t.type;throw new Error(vr(14))}o[l]=d,r=r||d!==u}return(r=r||i.length!==Object.keys(e).length)?o:e}}({deck:function(e,t){switch(void 0===e&&(e=jr),t.type){case Cn:return Tr(Tr({},e),{decks:t.payload});case En:return Tr(Tr({},e),{deckId:t.payload});default:return e}},cards:Pr,settings:tn.W,currentPage:Br,anki:zr,sidebar:qr,notifications:Gr,tabState:Yr}),Zr=function(e,t,n){const{namespace:r,chromeNs:o,browserNs:a,storageArea:i,storageKey:s,isolated:l,plainActions:c,outdatedTimeout:u}=t||{},{onGlobalChange:d,onLocalChange:f,onError:p}=n||{};if("function"!=typeof e)throw new Error("Missing argument for 'storeCreatorContainer'");const g=a||r===fr.browser?new dr({namespace:a||browser,area:i,key:s}):new ur({namespace:o||chrome,area:i,key:s});return"function"==typeof d&&g.regListener(((t,n)=>{const r=new ir(e,g,!0,c),[o]=ar(t),[a]=ar(n);d(r.initFrom(o),a)})),l||g.regShared(),t=>{p&&g.subscribeForError(p);return new ir(e,g,l,c,u,f,t).init()}}((function(e){return Cr(Xr,e,kr(_r,Zt))}));console.log("Content script works!"),console.log("Must reload extension for modifications to take effect."),Jr="Using the 'printLine' function from the Print Module",console.log("===> FROM THE PRINT MODULE:",Jr);const eo=document.createElement("div");eo.id="sidebar",eo.setAttribute("style","\n  all: initial;\n  position: fixed;\n  top: 0;\n  right: 0;\n  width: 350px;\n  height: 100%;\n  overflow: auto;\n  z-index: 9999;\n  background-color: #ffffff;\n  box-shadow: -2px 0 5px rgba(0, 0, 0, 0.15);\n  transform: translateX(100%); /* по умолчанию скрыто */\n  transition: transform 0.3s ease-in-out;\n");const to=eo.attachShadow({mode:"open"}),no=document.createElement("link");no.setAttribute("rel","stylesheet");const ro=chrome.runtime.getURL("tailwind.css");no.setAttribute("href",ro),to.appendChild(no),document.body.appendChild(eo);const oo=(0,o.H)(to),ao=()=>r.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",background:"linear-gradient(135deg, #2563EB 0%, #1D4ED8 100%)",fontFamily:"system-ui, -apple-system, sans-serif",color:"#ffffff"}},[r.createElement("div",{key:"logo",style:{width:"48px",height:"48px",background:"rgba(255,255,255,0.2)",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:"24px",animation:"pulse 2s ease-in-out infinite"}},"🧠"),r.createElement("div",{key:"spinner",style:{width:"32px",height:"32px",border:"2px solid rgba(255,255,255,0.3)",borderTop:"2px solid #ffffff",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:"20px"}}),r.createElement("h2",{key:"title",style:{color:"#ffffff",fontSize:"20px",fontWeight:"700",marginBottom:"8px",textAlign:"center",letterSpacing:"-0.025em"}},"Anki Flash Cards"),r.createElement("p",{key:"subtitle",style:{color:"rgba(255,255,255,0.8)",fontSize:"14px",textAlign:"center",fontWeight:"400"}},"Initializing your learning assistant..."),r.createElement("div",{key:"progress-bar",style:{width:"200px",height:"2px",backgroundColor:"rgba(255,255,255,0.3)",borderRadius:"1px",marginTop:"24px",overflow:"hidden"}},r.createElement("div",{style:{width:"100%",height:"100%",backgroundColor:"#ffffff",animation:"progressBar 2s ease-in-out infinite"}})),r.createElement("style",{key:"styles"},"\n      @keyframes spin {\n        0% { transform: rotate(0deg); }\n        100% { transform: rotate(360deg); }\n      }\n      @keyframes pulse {\n        0%, 100% { transform: scale(1); opacity: 1; }\n        50% { transform: scale(1.05); opacity: 0.8; }\n      }\n      @keyframes progressBar {\n        0% { transform: translateX(-100%); }\n        50% { transform: translateX(0%); }\n        100% { transform: translateX(100%); }\n      }\n    ")]);const io=new class{constructor(){this.storageKeys={globalState:"sidebar_global_state",tabPrefix:"sidebar_tab_"}}getTabKey(e){return`${this.storageKeys.tabPrefix}${e}`}async getInheritanceSettings(){return{enabled:!0,mode:"lastActive"}}async getGlobalState(){return new Promise((e=>{chrome.storage.local.get([this.storageKeys.globalState],(t=>{const n={isVisible:!1,lastActiveTabId:null,lastToggleTime:Date.now()};e(t[this.storageKeys.globalState]||n)}))}))}async getTabState(e){const t=this.getTabKey(e);return new Promise((e=>{chrome.storage.local.get([t],(n=>{e(n[t]||null)}))}))}async saveGlobalState(e){return new Promise((t=>{chrome.storage.local.set({[this.storageKeys.globalState]:e},t)}))}async saveTabState(e,t){const n=this.getTabKey(e);return new Promise((e=>{chrome.storage.local.set({[n]:t},e)}))}async determineInitialState(e){const t=await this.getGlobalState();if(t.lastActiveTabId){const e=await this.getTabState(t.lastActiveTabId);if(e)return{isVisible:e.isVisible,source:"lastActive",inheritedFrom:t.lastActiveTabId}}return{isVisible:t.isVisible,source:"global_fallback",inheritedFrom:null}}async toggleSidebar(e){const t=await this.getTabState(e),n=await this.getGlobalState();let r;if(t)r=t.isVisible;else{r=(await this.determineInitialState(e)).isVisible}const o=!r,a=Date.now(),i={isVisible:o,lastToggleTime:a,...t?.inheritedFrom&&{inheritedFrom:t.inheritedFrom}},s={...n,isVisible:o,lastActiveTabId:e,lastToggleTime:a};return await Promise.all([this.saveTabState(e,i),this.saveGlobalState(s)]),{isVisible:o,wasInherited:!!t?.inheritedFrom}}async getCurrentState(e){const t=await this.getTabState(e);return t?{isVisible:t.isVisible,source:"existing",inheritedFrom:t.inheritedFrom}:await this.determineInitialState(e)}},so=(e,t,n="unknown")=>{e?(eo.style.transform="translateX(0)",document.body.style.marginRight="350px"):(eo.style.transform="translateX(100%)",document.body.style.marginRight="0"),console.log(`Sidebar state applied for tab ${t}: ${e?"visible":"hidden"} (source: ${n})`)},lo=()=>{const[e,t]=(0,r.useState)(null),[n,o]=(0,r.useState)(!0),[a,i]=(0,r.useState)(null);return(0,r.useEffect)((()=>{(async()=>{try{chrome.runtime.sendMessage({action:"getTabId"},(async e=>{const t=e?.tabId||Math.floor(1e6*Math.random());i(t),console.log("Content script initialized with tab ID:",t);try{const e=await io.getCurrentState(t);so(e.isVisible,t,e.source),e.inheritedFrom&&console.log(`Sidebar state inherited from tab ${e.inheritedFrom}`)}catch(e){console.error("Error determining initial sidebar state:",e),so(!1,t,"error_fallback")}}));const e=await Zr();t(e),setTimeout((()=>o(!1)),100)}catch(e){console.error("Error loading state from Chrome storage:",e),o(!1)}})()}),[]),n||!e||null===a?r.createElement(ao):r.createElement(w,{store:e},r.createElement(Gn,{tabId:a}))},co=r.createElement(lo,{});oo.render(co),chrome.runtime.onMessage.addListener(((e,t,n)=>{if("toggleSidebar"===e.action){const t=e.tabId||"unknown";return"unknown"===t?(console.error("Cannot toggle sidebar: unknown tab ID"),n({status:"error",message:"Unknown tab ID"}),!0):(io.toggleSidebar(t).then((e=>{so(e.isVisible,t,"toggle"),n({status:"Sidebar toggled",visible:e.isVisible,tabId:t,wasInherited:e.wasInherited}),console.log(`Sidebar toggled for tab ${t}: ${e.isVisible?"visible":"hidden"}${e.wasInherited?" (was inherited)":""}`)})).catch((e=>{console.error("Error toggling sidebar:",e),n({status:"error",message:e.toString()})})),!0)}}))})();